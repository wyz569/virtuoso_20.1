
<html><head><title>Simulating Mixers</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2020-01-08" />
<meta name="CreateTime" content="1578555450" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Provides user information for Virtuoso Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis" />
<meta name="DocTitle" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer Workshop" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Simulating Mixers" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.1" />
<meta name="Keyword" content="spectreRFexplorerWorkshop" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2020-01-08" />
<meta name="ModifiedTime" content="1578555450" />
<meta name="NextFile" content="" />
<meta name="Group" content="SpectreRF" />
<meta name="Platform" content="Custom IC Design" />
<meta name="PrevFile" content="chap3.html" />
<meta name="Product" content="Spectre" />
<meta name="ProductFamily" content="Spectre" />
<meta name="ProductVersion" content="19.1" />
<meta name="RightsManagement" content="Copyright 2012-2020 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer Workshop -- Simulating Mixers" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="product_feature" content="" />
<meta name="product_subfeature" content="" />
<meta name="Version" content="19.1" />
<meta name="SpaceKey" content="spectreRFexplorerWorkshop191" />
<meta name="webflare-version" content="1.4" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="spectreRFexplorerWorkshopTOC.html">Contents</a></li><li><a class="prev" href="chap3.html" title="Simulating Oscillators">Simulating Oscillators</a></li><li style="float: right;"><a class="viewPrint" href="spectreRFexplorerWorkshop.pdf">View/Print PDF</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer Workshop<br />Product Version 19.1, January 2020</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>4
<a id="pgfId-1065082"></a></h1>
<h1>
<a id="pgfId-1065083"></a><hr />
Simulating Mixers<hr />
</h1>

<p>
<a id="pgfId-1103254"></a>The SpectreRF simulator can simulate circuits, such as mixers, that show frequency conversion effects. </p>
<p>
<a id="pgfId-1103255"></a>This section uses two double balanced mixer circuits,&#160;&#160;<code>db_mixer</code> and <code>db_mixer_xmit</code>, to illustrate how the SpectreRF simulator can determine the characteristics of a mixer design. </p>
<p>
<a id="pgfId-1142666"></a>In the mixer examples that follow, you will plot the following nonlinear characteristics of the <code>db_mixer</code> and <code>db_mixer_xmit mixer</code> circuits.</p>
<table class="webflareTable" id="#id1142667">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1142669">
<a id="pgfId-1142669"></a>Receive Mixer Measurements (db_mixer)</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1142671">
<a id="pgfId-1142671"></a>Analyses</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142673">
<a id="pgfId-1142673"></a>Mixer Conversion Gain and RF to IF Isolation</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142675">
<a id="pgfId-1142675"></a>HB and HBAC</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142677">
<a id="pgfId-1142677"></a>LO Leakage (LO to IF Leakage)</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142679">
<a id="pgfId-1142679"></a>HB </blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142681">
<a id="pgfId-1142681"></a>Noise Figure Measurement, Noise Summary Table</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142683">
<a id="pgfId-1142683"></a>HB and HBnoise</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142685">
<a id="pgfId-1142685"></a>1dB Compression Point, Desensitization and Blocking</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142687">
<a id="pgfId-1142687"></a>HB, HBAC, and HBnoise</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142689">
<a id="pgfId-1142689"></a>Third-Order Intercept measurement with HB</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142691">
<a id="pgfId-1142691"></a>HB </blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142693">
<a id="pgfId-1142693"></a>Rapid IP2, Rapid IP3</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142695">
<a id="pgfId-1142695"></a>Specialized HBAC</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142697">
<a id="pgfId-1142697"></a>Compression Distortion Summary</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142699">
<a id="pgfId-1142699"></a>HB, HBAC</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">

<p>
<a id="pgfId-1142701"></a><strong>Transmit Mixer Measurements (db_mixer_xmit)</strong></p>

</td>
<td class="webflareTd" colspan="1" rowspan="1">

<p>
<a id="pgfId-1142703"></a><strong>Analyses</strong></p>

</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142705">
<a id="pgfId-1142705"></a>Image Rejection</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142707">
<a id="pgfId-1142707"></a>HB</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142709">
<a id="pgfId-1142709"></a>Three tone Swept IP3 (large signal)</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142711">
<a id="pgfId-1142711"></a>HB</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142713">
<a id="pgfId-1142713"></a>Noise Figure</blockquote>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1142715">
<a id="pgfId-1142715"></a>HB and HBnoise</blockquote>
</td>
</tr>
</tbody></table>
<p>
<a id="pgfId-1142716"></a>To use the examples in this section, you must be familiar with the SpectreRF simulator analyses as well as know about mixer design. For more information about the SpectreRF simulator analyses, see <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">SpectreRF Simulation Option Theory</a></em>.</p>

<h2>
<a id="pgfId-1103310"></a>The db_mixer and db_mixer_xmit Mixer C<a id="ne600p Circuit Description"></a>ircuits</h2>

<p>
<a id="pgfId-1103311"></a>The <code>db_mixer</code> and <code>db_mixer_xmit</code> circuits can be found in the <em>ExampleLibRF</em> library. See the <a href="DesignWorkshop.html#59142">Introduction</a> chapter for the instructions on accessing the <em>ExampleLibRF </em>library. </p>
<p>
<a id="pgfId-1143189"></a>The <code>db_mixer</code> integrated circuit is a Gilbert cell (down-converting double balanced) mixer.</p>
<p>
<a id="pgfId-1143190"></a>The schematic for the <code>db_mixer</code> circuit is shown below.</p>

<p><strong>Figure 4-1
<a id="pgfId-1219454"></a><a id="41643"></a>Schematic for the db_mixer Mixer Circuit</strong></p>
<p>
<a id="pgfId-1219458"></a></p>
<div class="webflare-div-image">
<img width="643" height="458" src="images/chap4-2.gif" /></div>

<p>
<a id="pgfId-1219459"></a>On the left side of the schematic there is a port labeled <em>Input</em> which generates the input signal. To the right of that is a matching network and a behavioral balun from rfLib. This feeds the input to a double-balanced mixer. There are two LO sources in the circuit (in the middle of the schematic) between the bottom devices. The LO operates at 1.9GHz. Next to the label <em>Output</em>, is the output port of the mixer. </p>
<p>
<a id="pgfId-1211587"></a>The <code>db_mixer_xmit</code> circuit is a similar circuit, but an up-converting double-balanced mixer with image rejection. </p>
<p>
<a id="pgfId-1211514"></a>The following tables lists some measured values for different aspects of the <code>db_mixer</code> down-converting mixer.</p>
<table class="webflareTable" id="#id1211515">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1211517">
<a id="pgfId-1211517"></a>Measurement</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1211519">
<a id="pgfId-1211519"></a>Measured</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211521"></a>LO frequency (Hz)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211523"></a>1.9 GHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211525"></a>RF frequencies (Hz)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211527"></a>1.904 GHz, 1.905 GHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211529"></a>IF frequency (Hz)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211531"></a> 4 MHz, 5 MHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211533"></a>LO voltage</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211535"></a>200mV peak</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211537"></a>RF power</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211539"></a>-30 dBm</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211541"></a>Conversion gain</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211543"></a><em>measurement needed</em></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211545"></a>Double Sideband Noise figure</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211547"></a><em>measurement needed</em></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211549"></a>Input 1dB compression point</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211551"></a><em>measurement needed</em></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211553"></a>Input IP3 (from swept power)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211555"></a><em>measurement needed</em></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211557"></a>Input IP3 (from HBAC analysis)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211559"></a><em>measurement needed</em></p>
</td>
</tr>
</tbody></table>
<table class="webflareTable" id="#id1211560">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1211562">
<a id="pgfId-1211562"></a>Design Variable</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1211564">
<a id="pgfId-1211564"></a>Default Value</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211566"></a>prf (RF power)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211568"></a>-30 dBm</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211570"></a>vlo (LO magnitude)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211572"></a>200 m</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211574"></a>frf1 and frf2 (RF frequencies)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211576"></a>1.904 GHz, 1.905 GHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211578"></a>flo (LO frequency)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1211580"></a>1.9 GHz</p>
</td>
</tr>
</tbody></table>

<h2>
<a id="pgfId-1211510"></a>Setting Up to Simulate the db_mixer Mixer</h2>

<p>
<a id="pgfId-1103389"></a>In a Unix window, type <code>virtuoso &amp; </code>to start the Cadence software. (For more information, see the <a href="DesignWorkshop.html#59142">Introduction</a> chapter.)</p>

<h3>
<a id="pgfId-1103391"></a>Opening the db_mixer Mixer Circuit in the Schematic W<a id="Opening ne600p Schematic"></a>indow</h3>

<ol><li>
<a id="pgfId-1103392"></a>In the CIW (Command Interpreter Window), select <em>File &#8211; Open</em>.<br />
<a id="pgfId-1103393"></a>The Open File form is displayed.</li><li>
<a id="pgfId-1103394"></a>In the Open File form, choose <em>ExampleLibRF</em> from the Library drop-down list. </li><li>
<a id="pgfId-1103395"></a>Type <code>db_mixer</code> in the Cell field or select the cell from the <em>Cells</em> list box.<br />
<a id="pgfId-1103396"></a>The completed <em>Open File</em> form appears like the one below.<br /><strong class="webflare-fig-line-height">Figure 4-2
<a id="pgfId-1103401"></a>Open File Form</strong>
<a id="pgfId-1143491"></a><div class="webflare-div-image">
<img width="527" height="364" src="images/chap4-3.gif" /></div></li><li>
<a id="pgfId-1143525"></a>Click <em>OK</em>.<br />
<a id="pgfId-1143526"></a>The Schematic window for <em>db_mixer</em> mixer is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-3
<a id="pgfId-1143527"></a>db_mixer Schematic</strong>
<a id="pgfId-1211367"></a><div class="webflare-div-image">
<img width="670" height="464" src="images/chap4-4.gif" /></div></li><li>
<a id="pgfId-1211368"></a>In the Schematic window, choose <em>Launch &#8211; ADE Explorer</em>.</li><li>
<a id="pgfId-1294956"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1294957"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-4
<a id="pgfId-1294958"></a>Create new ADE Explorer view</strong>
<a id="pgfId-1294962"></a><div class="webflare-div-image">
<img width="627" height="307" src="images/chap4-5.gif" /></div></li><li>
<a id="pgfId-1294947"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1211369"></a>The ADE Explorer window is displayed. <br /><strong class="webflare-fig-line-height">Figure 4-5
<a id="pgfId-1103411"></a>ADE Explorer Window</strong>
<a id="pgfId-1103415"></a><div class="webflare-div-image">
<img width="671" height="358" src="images/chap4-6.gif" /></div></li></ol>






























<h3>
<a id="pgfId-1103417"></a>Choosing Simulator O<a id="Choosing Simulator Options"></a>ptions</h3>

<ol><li>
<a id="pgfId-1103418"></a>In ADE Explorer, select <em>Setup &#8211; Simulator</em>.<br />
<a id="pgfId-1103419"></a>The <em>Choosing Simulator</em> form is displayed.</li><li>
<a id="pgfId-1277766"></a>Select <em>spectre</em> from the <em>Simulator</em> drop-down list.<br /><strong class="webflare-fig-line-height">Figure 4-6
<a id="pgfId-1277768"></a>Choosing Simulator/Directory/Host Form - Completed</strong>
<a id="pgfId-1103429"></a><div class="webflare-div-image">
<img width="613" height="89" src="images/chap4-7.gif" /></div></li><li>
<a id="pgfId-1103430"></a>Click <em>OK to close the Choosing Simulator </em>form.</li><li>
<a id="pgfId-1103432"></a>Set up the High Performance Simulation Options, as follows:<br />
<a id="pgfId-1190818"></a>In the ADE window, choose <em>Setup - High Performance Simulation</em>. The <em>High Performance Simulation Options</em> window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-7
<a id="pgfId-1103434"></a>High Performance Simulation Options</strong>
<a id="pgfId-1103439"></a><div class="webflare-div-image">
<img width="668" height="570" src="images/chap4-8.gif" /></div>
<a id="pgfId-1103440"></a>Select <em>APS </em>as the simulation performance mode. Note that <em>Auto</em> is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 64) and then multi-thread on all the available cores. <br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1103441"></a>The bigger the circuit, the more threads you should use. For a small circuit such as this, you may want to set the number of threads to 2. Using 16 threads on a small circuit might actually slow things down because of the overhead associated with multithreading. For more information, see the Virtuoso Spectre User Guide.</div><ol><li>
<a id="pgfId-1103442"></a>Click <em>OK</em>.</li></ol></li><li>
<a id="pgfId-1144036"></a>Select <em>Outputs &#8211; Save All</em>.<br />
<a id="pgfId-1144037"></a>The <em>Save Options</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-8
<a id="pgfId-1144038"></a>Save Options Form</strong>
<a id="pgfId-1144009"></a><div class="webflare-div-image">
<img width="656" height="722" src="images/chap4-9.gif" /></div></li><li>
<a id="pgfId-1103445"></a>In the <em>Select signals to output</em> section, make sure that <em>allpub</em> is selected.<br />
<a id="pgfId-1103451"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1103452"></a>To save the currents, use the <em>Select device currents (currents)</em> option, and select <em>nonlinear</em> if you just want to save the device currents, or <em>all</em> if you want to save all the currents in the circuit. </li><li>
<a id="pgfId-1103455"></a>Click <em>OK</em>.</li></ol>






























<h4>
<a id="pgfId-1103458"></a>Setting Up Model L<a id="Setting Up Model Libs"></a>ibraries</h4>

<ol><li>
<a id="pgfId-1103459"></a>In ADE Explorer, select <em>Setup - Simulation Files</em>. The <em>Simulation Files Setup</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-9
<a id="pgfId-1103463"></a>Simulation Files Setup Form</strong>
<a id="pgfId-1144234"></a><div class="webflare-div-image">
<img width="670" height="357" src="images/chap4-10.gif" /></div></li><li>
<a id="pgfId-1103464"></a>Verify that the <em>Include Path</em> is set as shown above.</li><li>
<a id="pgfId-1144263"></a>Select <em>Setup &#8211; Model Libraries.</em><br />
<a id="pgfId-1211359"></a>The <em>Model Library Setup</em> form is displayed. </li><li>
<a id="pgfId-1211360"></a>In the <em>Model Library File</em> field, type the following for the name of the model file:<br />
<a id="pgfId-1211361"></a><code>models/modelsRF.scs</code></li><li>
<a id="pgfId-1103469"></a>Click <em>Add</em>.<br />
<a id="pgfId-1103470"></a>The <em>Model Library Setup</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-10
<a id="pgfId-1103474"></a>Model Library Setup</strong>
<a id="pgfId-1144372"></a><div class="webflare-div-image">
<img width="641" height="224" src="images/chap4-11.gif" /></div></li><li>
<a id="pgfId-1103475"></a>Click <em>OK</em>.</li></ol>



















<h4>
<a id="pgfId-1103477"></a>Mixer Conversion Gain, RF to IF Isolation, LO to IF Leakage, and Noise Figure</h4>

<p>
<a id="pgfId-1103478"></a>You can measure the conversion gain using hb (Harmonic Balance) by applying the signal which causes the frequency conversion (the LO) in a hb analysis and follow this with hbac (Harmonic Balance AC) to measure the small-signal conversion gain. This will also be used to measure RF to IF isolation. Because hbac is based on the hb result with all the harmonics that hb solved for, the mixing products produced by mixing the input frequency with any or all of those harmonics can be calculated with hbac. In addition, hbnoise (Harmonic Balance noise) will be used to calculate the output noise and noise figure with all the frequency translations inherent in the mixer. </p>
<p>
<a id="pgfId-1103479"></a>Hb solves for the steady-state solution produced by the LO and captures the nonlinearity of the mixer. Hb calculates the nonlinearity in the frequency domain as a series of harmonics.</p>
<p>
<a id="pgfId-1103480"></a>The hbac analysis calculates the conversion gain based on the nonlinearity created by the LO. Hbac is also used to calculate the RF to IF isolation. This measurement is not a simple AC frequency response. It is the frequency response from RF to IF with the LO applied to the mixer.</p>
<p>
<a id="pgfId-1103481"></a>Hbnoise also uses the nonlinearity from the hb large-signal analysis in order to calculate how noise is folded to the desired output frequency. Both of these analyses are quite fast and accurate.</p>
<p>
<a id="pgfId-1211353"></a>Hbac and hbnoise are both small-signal analyses. Both are nonlinear in the sense of being able to take into account the frequency conversions created by the LO. Noise is almost certainly a small-signal problem. In practice, hbac calculates the correct conversion gain for the cases where the RF input causes little compression (that is, the input is 10dB or more below the 1dB compression point.)</p>

<h3>
<a id="pgfId-1211355"></a>Setting Up the Simulation - Setting Design V<a id="Setting Design Variables"></a>ariables</h3>

<p>
<a id="pgfId-1211356"></a>To set the design variables to the values required for each simulation, perform the following steps: </p>
<ol><li>
<a id="pgfId-1191117"></a>In the Design Variables section of ADE Explorer, change the design variables <em>frf1</em><code> </code>and <em>frf2</em> to <em>0</em><code>.</code> <em>flo</em> should already be set to <em>1.9G</em>. To edit the values, simply click on the value to the right of the variable name, and type in a value. Then, press <em>Enter</em>. Setting the input frequencies to 0 disables the production of waveforms for the large-signal analyses like tran, pss, and hb (harmonic balance).<br /><strong class="webflare-fig-line-height">Figure 4-11
<a id="pgfId-1103498"></a>Design Variables Section of ADE Explorer Window</strong>
<a id="pgfId-1144637"></a><div class="webflare-div-image">
<img width="310" height="157" src="images/chap4-12.gif" /></div></li></ol>




<h4>
<a id="pgfId-1211348"></a>Setting Up the Harmonic Balance A<a id="PSS Analysis Only"></a>nalysis</h4>

<ol><li>
<a id="pgfId-1211349"></a>In ADE Explorer, select <em>Analyses &#8211; Choose</em>.<br />
<a id="pgfId-1211350"></a>The <em>Choosing Analyses</em> form is displayed.</li><li>
<a id="pgfId-1103503"></a>In the <em>Choosing Analyses</em> form, select <em>hb</em>. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-12
<a id="pgfId-1103507"></a>The hb Choosing Analyses Form</strong>
<a id="pgfId-1144758"></a><div class="webflare-div-image">
<img width="668" height="764" src="images/chap4-13.gif" /></div></li><li>
<a id="pgfId-1103508"></a>In the <em>Transient-Aided Options section</em>, leave the settings at their default value:<ol><li>
<a id="pgfId-1103509"></a>Leave <em>Run Transient?</em> to the default value of <em>Decide Automatically.</em><br />
<a id="pgfId-1103510"></a>Run transient will run the LO signal using the transient (In SpectreRF, this is called the tstab interval) for a short period of time. At the end of tstab, an FFT is performed, and this is used as the starting point in the harmonic balance analysis. Doing this improves the convergence of hb by giving it a better starting point at the cost of a short transient analysis.<em>Stop Time (tstab) </em><em>auto</em>.<br />
<a id="pgfId-1279036"></a>When <em>auto</em> is selected for <em>Stop Time (tstab)</em>, a small number of periods of the LO is run using the transient analysis. During this time, the signal is checked for steady-state conditions. If steady-state is not reached in the initial number of periods, more periods can be added automatically by the simulator. Using this feature allows an accurate FFT for the starting point in the hb iterations.</li><li>
<a id="pgfId-1103513"></a>When <em>Run transient</em> is set to <em>Decide automatically</em>, The <em>Detect Steady State </em>option is selected automatically. When this is set, when steady-state is detected in the tstab interval, the simulator stops the transient analysis, runs the FFT, and starts iterating in the frequency domain. Using <em>Decide automatically</em> simplifies the setup for harmonic balance, and produces correct answers from hb without needing to know how to set hb up manually.</li><li>
<a id="pgfId-1103514"></a>Leave <em>Save Initial Transient Results (saveinit)</em><em> </em>blank.</li></ol></li><li>
<a id="pgfId-1103515"></a>In the <em>Tones</em> section, ensure that <em>Frequencies</em> is selected. This is the default.<br />
<a id="pgfId-1103516"></a>Harmonic balance can now set the harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. A transient analysis runs until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has tstab enabled (when <em>Names</em> is selected). If you want to manually set transient-aided hb, select <em>Yes</em> from the <em>Run Transient?</em> drop-down list and set a time for the transient in the <em>Stop Time (tstab)</em> field. In this mode, the stop time of the transient analysis in the tstab interval cannot be automatically extended.<br />
<a id="pgfId-1103517"></a>If you want to see the startup waveform, select <em>yes</em> for <em>Save Initial Transient Results (saveinit)</em>.</li><li>
<a id="pgfId-1103518"></a>In the <em>Number of Tones </em>section, note that the number of tones is set to <em>1</em>. (This is the default in hb). Since the RF tones were disabled, only the LO tone remains.</li><li>
<a id="pgfId-1103519"></a>Enter <code>1.9G </code>as the <em>Fundamental Frequency.</em></li><li>
<a id="pgfId-1103520"></a>Leave <em>Number of Harmonics</em> set to <em>auto</em>. This is the default. Spectre will choose the appropriate number of harmonics for you. <em>auto</em> is allowed if <em>Decide automatically</em> or <em>Yes</em> are selected from the <em>Run transient?</em> drop-down list.</li><li>
<a id="pgfId-1211344"></a>When you choose <em>auto</em> for the number of harmonics, leave <em>Oversample Factor</em> set to the default value of <code>1</code>. When all the signals in the system (including currents) are nearly sinusoidal, then, <em>Oversample Factor</em> should also be set to 1. Set <em>Accuracy Defaults (errpreset)</em> to <em>moderate</em>. Exceptional accuracy is not needed because only the high amplitude LO signal needs to be solved for, so <em>moderate</em> (the default) is selected.</li><li>
<a id="pgfId-1211341"></a>Leave the rest of the form set to the default values. The hb <em>Choosing Analyses</em> form should look like the following figure:<br /><strong class="webflare-fig-line-height">Figure 4-13
<a id="pgfId-1103527"></a>hb Choosing Analyses Form</strong>
<a id="pgfId-1145329"></a><div class="webflare-div-image">
<img width="668" height="767" src="images/chap4-14.gif" /></div>
<a id="pgfId-1103528"></a>For more information on setting up the <em>Choosing Analyses</em><a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple"> form, see </a>Chapter 3: Frequency Domain Analyses: Harmonic Balance in the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide.</li><li>
<a id="pgfId-1103529"></a>Click <em>Apply</em>.</li></ol>































<h4>
<a id="pgfId-1103530"></a>Set up the HBAC Choosing Analysis form.</h4>

<ol><li>
<a id="pgfId-1103531"></a>In the Choosing Analyses form, select <em>hbac</em>. The form changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-14
<a id="pgfId-1103535"></a>hbac Choosing Analysis Form</strong>
<a id="pgfId-1145512"></a><div class="webflare-div-image">
<img width="668" height="651" src="images/chap4-15.gif" /></div></li><li>
<a id="pgfId-1103536"></a>Leave the <em>Sweeptype</em> set to <em>default</em> (absolute). </li><li>
<a id="pgfId-1103537"></a>Set the <em>Input Frequency Sweep Range</em>.<br />
<a id="pgfId-1103538"></a>Absolute takes the frequency range as specified with no frequency translation. Relative is also available where the input frequency can be shifted up or down in multiples of the PSS frequency. This is useful for having log sweeps above or below a PSS harmonic.<br />
<a id="pgfId-1103539"></a>The frequency sweep range is always the input frequency range in hbac. Because hbac has the ability to calculate the outputs at different frequencies based on the nonlinearity caused by the LO, we choose which output frequencies to calculate in the Sidebands area of the Choosing Analyses form. Sideband is the name of the different output signals that are produced when mixing the input with harmonics of the LO signal.<ol><li>
<a id="pgfId-1103540"></a>Type <code>1.9001G </code>in the <em>Start</em> field.</li><li>
<a id="pgfId-1103541"></a>Type <code>2G </code>in the <em>Stop</em> field.</li><li>
<a id="pgfId-1103542"></a>Set the <em>Sweep Type</em> to <em>Linear</em>.</li><li>
<a id="pgfId-1103543"></a>Set <em>Number of Steps</em> to <code>10</code>.</li></ol></li><li>
<a id="pgfId-1211333"></a>The amplitude for the hbac analysis is set in the input source (port <em>rf </em>with <em>PAC magnitude </em>=<code>1 </code>in this case) in the schematic. 1 is convenient because it is 0 dBV. This allows direct conversion gain measurement by using the dB20 function when the output signal is plotted.<br />
<a id="pgfId-1103548"></a>Below are the steps showing how to set the <em>PAC Magnitude </em>in the schematic<ol><li>
<a id="pgfId-1103549"></a>To set the amplitude for hbac, select the <em>Input</em> port in the schematic. <br /><strong class="webflare-fig-line-height">Figure 4-15
<a id="pgfId-1103553"></a>Input Port on Schematic</strong>
<a id="pgfId-1145685"></a><div class="webflare-div-image">
<img width="549" height="198" src="images/chap4-16.gif" /></div></li><li>
<a id="pgfId-1145686"></a>After you click on the port, refer to the <em>Property Editor</em> on the left side of the schematic. You can scroll through the <em>Property Editor</em> by moving the scroll bar on the right side of the <em>Property Editor</em>.<br /><strong class="webflare-fig-line-height">Figure 4-16
<a id="pgfId-1103559"></a>Property Editor</strong>
<a id="pgfId-1145803"></a><div class="webflare-div-image">
<img width="668" height="433" src="images/chap4-17.gif" /></div></li><li>
<a id="pgfId-1145804"></a>Select the <em>Display Small Signal Params</em> option near the bottom of the <em>Property Edito</em>r, and set its value to <em>true</em>. This expands the <em>Property Editor</em> form.<br />
<a id="pgfId-1103561"></a>The value for<em> PAC Magnitude</em> should be set to <code>1 V</code>. If it is not, set it to <code>1 V</code>. </li><li>
<a id="pgfId-1103562"></a>From the Schematic, select <em>Check - Current Cellview.</em> You do not have to save the design to simulate it. This allows &#8220;what if&#8221; analysis. If you like the results, you can then save the design. If you do not like the results, you do not have to save it.<br />
<a id="pgfId-1103563"></a>In the hbac <em>Choosing Analyses</em> form, you will be selecting the direct conversion IF sideband and the output with no frequency translation from the <em>Sidebands</em> section under <em>Select from Range.</em></li></ol></li><li>
<a id="pgfId-1103567"></a>In the <em>Sidebands</em> section, select <em>Select from range</em>.<br />
<a id="pgfId-1103568"></a>Sidebands define the output frequencies to be calculated. In this setup, the direct conversion IF (1.9001G~2G-1*1.9G=100K~100M) is selected. In addition, hbac also calculates the outputs with no frequency translation (1.9001G~2G-0*1.9G=1.9001G~2G). You will be choosing these two sidebands.<br />
<a id="pgfId-1103569"></a>The levels that are produced at each node at all the selected frequencies are also calculated by the hbac analysis. <ol><li>
<a id="pgfId-1146067"></a>Highlight the<code> </code><em>l 100K 100M -1</em><code> </code>entry. This is the direct conversion IF sideband.</li><li>
<a id="pgfId-1146068"></a>To select another sidebands, press and hold the <em>Ctrl</em> key, and select the<code> </code><em>u 1.9001G 2G 0</em><code> </code>entry. This is the output with no frequency translation.</li></ol><br />
<a id="pgfId-1146096"></a>The hbac <em>Choosing Analyses</em> form looks like the figure below:<br /><strong class="webflare-fig-line-height">Figure 4-17
<a id="pgfId-1103576"></a>hbac Choosing Analyses Form -Set up the hbnoise Choosing Analyses form</strong>
<a id="pgfId-1211328"></a><div class="webflare-div-image">
<img width="488" height="721" src="images/chap4-18.gif" /></div></li><li>
<a id="pgfId-1279400"></a>Click <em>Apply</em>. </li></ol>















































<p>
<a id="pgfId-1222202"></a>Set up the hbnoise <em>Choosing Analyses</em> form, as follows:</p>
<ol><li>
<a id="pgfId-1211329"></a>In the <em>Choosing Analyses</em> form, select <em>hbnoise</em><em>. </em>The form changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-18
<a id="pgfId-1211330"></a>hbnoise Choosing Analyses Form</strong>
<a id="pgfId-1146290"></a><div class="webflare-div-image">
<img width="668" height="726" src="images/chap4-19.gif" /></div></li><li>
<a id="pgfId-1103585"></a>Leave the <em>Sweeptype</em> set to <em>default</em>.</li><li>
<a id="pgfId-1279837"></a>In the <em>Relative Harmonic</em> field, type <code>1</code>.</li><li>
<a id="pgfId-1103586"></a>Set the <em>Output Frequency Sweep Range</em>.<br />
<a id="pgfId-1103587"></a>The <em>Frequency Sweep Range </em>fields are always the output frequency range in hbnoise. <em>Maximum sideband</em> specifies the highest harmonic of the LO we want to calculate the down converted noise from. In this case, noise through the 10th harmonic of the LO will be calculated.</li><li>
<a id="pgfId-1103588"></a>Type <code>1K </code>in the <em>Start</em> field.</li><li>
<a id="pgfId-1103589"></a>Type <code>100M</code> in the <em>Stop</em> field.</li><li>
<a id="pgfId-1103590"></a>Select <em>Logarithmic</em> sweep.</li><li>
<a id="pgfId-1103591"></a>Type <code>3</code> in the <em>Points Per Decade </em>field.</li><li>
<a id="pgfId-1103592"></a>Leave the <em>Maximum sideband </em>field blank.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1103593"></a>When left blank, the form uses the <em>number of harmonics</em> from the hb analysis.</div></li><li>
<a id="pgfId-1103594"></a>Select the <em>Noise Figure</em> option.</li><li>
<a id="pgfId-1241943"></a>In the <em>Output</em> section of the form, by default, the <em>Output</em> is set to <em>probe</em>. Click <em>Select</em> to the right of the <em>Output Probe Instance </em>field and select the source to the right of the label <em>Output</em> in the schematic window.<br />
<a id="pgfId-1103596"></a>When a port or a resistor is selected in this way, the noise of this component is excluded for the noise figure calculation. A port is a voltage source in series with a resistor as a single component and it is located in analogLib.</li><li>
<a id="pgfId-1103597"></a>In the <em>Output</em> section, by default, <em>Input Source</em> is set to type <em>port</em>.  If you want a noise figure calculation, you must select a port as the input. Click <em>Select</em> to the right of the <em>Input Port Source</em> field and select the source to the right of the label <em>Input</em> in the schematic window.<br />
<a id="pgfId-1103599"></a>In hbnoise, only output-referred and input-referred noise measurements are made, so both the input and output frequencies are declared in the Choosing Analyses form. In linear noise, the input-referred noise is the output-referred noise divided by the transfer function from input to output. <br />
<a id="pgfId-1103600"></a>In hbnoise, because we have the ability to calculate frequency conversion, the design input frequency range is chosen in the reference sideband section in order to get the correct input-referred noise and noise figure at the design input frequency. This can also be referred to as the passband frequency.<br />
<a id="pgfId-1103601"></a>In the <em>select from </em><em>range</em> field, you will specify the input frequency range that goes with the output frequency range specified at the top of the form. </li><li>
<a id="pgfId-1103602"></a>In the <em>Reference side-band label</em> section, choose <em>Select from list</em> from the drop-down list.</li><li>
<a id="pgfId-1103606"></a>Select the<em> u 1.9G 2G 1</em><code> </code>line.<br />
<a id="pgfId-1103607"></a>Here is an example of how the reference sideband field is calculated:<br />
<a id="pgfId-1103608"></a>suppose the reference sideband=k,<br />
<a id="pgfId-1211320"></a><code>|fin|=|fout|+k*fundamental frequency</code>.<br />
<a id="pgfId-1211321"></a>Here, <code>fout=1K~100M</code> and the fundamental frequency is 1.9G.<br />
<a id="pgfId-1211322"></a><code>fin</code> should be <code>(1K~100M)+1.9G</code>,<br />
<a id="pgfId-1103612"></a>thus the reference sideband <code>k</code> is <code>1</code>.</li><li>
<a id="pgfId-1242059"></a>Select the <em>Do Noise</em> check box (this is the default). </li><li>
<a id="pgfId-1242060"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop down list.</li><li>
<a id="pgfId-1242092"></a>Select the <em>All (AM,PM,USB,LSB)</em>.<br />
<a id="pgfId-1242093"></a>When <em>Noise Type</em> is set to <em>timeaverage</em>, USB, LSB, AM and PM noise are directly available.You can choose, for example, PM noise alone, or you can select the ALL(AM,PM,USB,LSB) option, if you need all four types of noise.</li><li>
<a id="pgfId-1242094"></a>Select the <em>Noise Separation </em><a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple">check box.In addition to the total output noise, the individual noise contributions can be plotted when noise separation is selected. For more information on Noise Separation, see </a>Chapter 3: Frequency Domain Analyses: Harmonic Balance in the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide.<br /><strong class="webflare-fig-line-height">Figure 4-19
<a id="pgfId-1103616"></a>hbnoise Noise Separation Check Box.</strong>
<a id="pgfId-1103620"></a><div class="webflare-div-image">
<img width="432" height="226" src="images/chap4-20.gif" /></div>
<a id="pgfId-1103621"></a>Your completed hbnoise <em>Choosing Analyses</em> form should look like the following figure.<br /><strong class="webflare-fig-line-height">Figure 4-20
<a id="pgfId-1103626"></a>hbnoise Choosing Analyses Form</strong>
<a id="pgfId-1146857"></a><div class="webflare-div-image">
<img width="662" height="736" src="images/chap4-21.gif" /></div></li><li>
<a id="pgfId-1103628"></a>Click <em>OK</em> at the bottom of the form.<br /><strong class="webflare-fig-line-height">Figure 4-21
<a id="pgfId-1103632"></a>ADE Explorer Simulation Window</strong>
<a id="pgfId-1146925"></a><div class="webflare-div-image">
<img width="668" height="404" src="images/chap4-22.gif" /></div></li></ol>



















































<h4>
<a id="pgfId-1146974"></a>Running the Simulation and Plotting the Results</h4>

<p>
<a id="pgfId-1146978"></a>Start the analyses by clicking the green arrow icon.<img width="38" height="35" src="images/chap4-23.gif" /><span> in ADE Explorer or in the Schematic Editor.</span></p>

<p>
<a id="pgfId-1211314"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</p>
<p>
<a id="pgfId-1211315"></a>Next, you will plot the following: </p>
<ul><li>
<a id="pgfId-1211316"></a>Mixer Conversion Gain, </li><li>
<a id="pgfId-1211317"></a>RF to IF Isolation, LO to IF Leakage</li><li>
<a id="pgfId-1147080"></a>Noise Figure</li></ul>



<h4>
<a id="pgfId-1103646"></a>Measuring Mixer LO to IF Leakage</h4>

<ol><li>
<a id="pgfId-1103647"></a>In ADE Explorer, select <em>Results - Direct Plot -Main Form</em>. <br />
<a id="pgfId-1147173"></a>The <em>Direct Plot Form</em> is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-22
<a id="pgfId-1103651"></a>hb Direct Plot Form</strong>
<a id="pgfId-1147203"></a><div class="webflare-div-image">
<img width="664" height="722" src="images/chap4-24.gif" /></div>
<a id="pgfId-1103652"></a>Note that there is an entry for hb noise separation. This is because you have selected <em>Noise Separation</em> option on the hb Choosing Analyses form.</li></ol>








<h4>
<a id="pgfId-1103653"></a>First, plot the output spectrum</h4>

<ol><li>
<a id="pgfId-1103654"></a>In the<em> Analysis </em>section, select <em>hb</em>.</li><li>
<a id="pgfId-1103655"></a>In the<em> Function s</em>ection, select <em>Voltage</em>.</li><li>
<a id="pgfId-1211309"></a><em>Select</em> <code>Net</code> in the center of the form. (This is the default. You can also select <em>differential nets</em>).</li><li>
<a id="pgfId-1211310"></a>In the <em>Sweep </em>section, select <em>spectrum </em>(this is the default).</li><li>
<a id="pgfId-1211311"></a>In the <em>Signal Level </em>section<em>, </em>select <em>rms</em> (the default is <em>peak</em>). </li><li>
<a id="pgfId-1103659"></a>In the <em>Modifier</em> section, select <em>dB20</em>. <br />
<a id="pgfId-1103660"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-23
<a id="pgfId-1103664"></a>Completed Direct Plot Form - Measuring Mixer LO Leakage</strong>
<a id="pgfId-1147454"></a><div class="webflare-div-image">
<img width="668" height="725" src="images/chap4-25.gif" /></div></li><li>
<a id="pgfId-1147455"></a>Select the <em>out1</em><code> </code>net in the schematic. It is located just below the <em>Output</em> label.<br />
<a id="pgfId-1147456"></a>The waveform window is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-24
<a id="pgfId-1103670"></a>Harmonic Balance Response of /out1 net</strong>
<a id="pgfId-1147512"></a><div class="webflare-div-image">
<img width="664" height="587" src="images/chap4-26.gif" /></div>
<a id="pgfId-1103671"></a><strong>Measure LO leakage on the IF Output</strong></li><li>
<a id="pgfId-1147571"></a>Move the mouse cursor to the tip of the spike at<code> </code><em>1.9GHz</em><code> </code>and type <code>m</code>. <br />
<a id="pgfId-1280085"></a>A marker appears on the plot. Click and hold on the marker readout and move it to a place where you can see all the harmonics, then release the mouse button. The LO amplitude is about <em>-59.72 dB</em>.<br /><strong class="webflare-fig-line-height">Figure 4-25
<a id="pgfId-1103676"></a><strong>Measuring LO leakage on the IF Output</strong></strong>
<a id="pgfId-1147612"></a><div class="webflare-div-image">
<img width="666" height="580" src="images/chap4-27.gif" /></div></li></ol>

























<h4>
<a id="pgfId-1103678"></a><strong>Plot the conversion gain and RF to IF isolation</strong></h4>

<p>
<a id="pgfId-1147687"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1147710"></a>Change <em>Plotting Mode </em>to <em>New SubWin</em>.</li><li>
<a id="pgfId-1211304"></a>In the <em>Analysis</em> section, select <em>hbac</em>.</li><li>
<a id="pgfId-1211305"></a>In the <em>Function</em> section, select <em>Voltage</em> (this is the default).</li><li>
<a id="pgfId-1211306"></a>In the <em>Sweep</em> section, select <em>spectrum </em>(this is the default).</li><li>
<a id="pgfId-1103684"></a>In the <em>Modifier </em>section, select <em>dB20</em>. <br />
<a id="pgfId-1147887"></a>The <em>Direct Plot Form</em> looks like this.<br /><strong class="webflare-fig-line-height">Figure 4-26
<a id="pgfId-1103688"></a>Direct Plot Form - Plotting <strong>Conversion Gain and RF to IF isolation</strong></strong>
<a id="pgfId-1147952"></a><div class="webflare-div-image">
<img width="381" height="457" src="images/chap4-28.gif" /></div></li><li>
<a id="pgfId-1147953"></a>Click <em>Replot</em>. The waveform window updates, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-27
<a id="pgfId-1147957"></a>Conversion Gain and RF to IF Leakage</strong>
<a id="pgfId-1148020"></a><div class="webflare-div-image">
<img width="659" height="581" src="images/chap4-29.gif" /></div>
<a id="pgfId-1103694"></a>Look at the bottom subwindow for the HBAC results. The mixer circuit is deliberately very slightly unbalanced. In the HBAC <em>Choosing Analyses</em> form, you defined an input frequency range to be swept. HBAC calculates the amplitudes of the output signals at the frequencies you chose in the sidebands section of the <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1103695"></a>Note that the trace near 2GHz is about<em> -43.4dB</em>, and measures the gain from input to output with no frequency conversion. This is due to RF to IF leakage. <br />
<a id="pgfId-1103696"></a>If you want, place a marker at that location by moving the mouse cursor to the tip of the spike at 2GHz and typing <code>m</code>. Click and hold on the marker readout and move it to a place where you can see all the sidebands, then release the mouse button. <br />
<a id="pgfId-1103697"></a>Next, move the cursor to 1.9001GHz and just below -40dB, read the value of the cursor marker. In this case, the RF to IF isolation is about <em>43.4 dB</em>. If you want, place a marker at that location as well.</li></ol>





















<h4>
<a id="pgfId-1103699"></a>Measure Voltage Gain vs Output Frequency</h4>

<ol><li>
<a id="pgfId-1103700"></a><strong>Optional</strong>: Remove the markers from the Waveform window by choosing<em> </em><em>Marker - Delete All</em><em> </em>or by pressing the <em>Ctrl+E</em> bindKey. <br />
<a id="pgfId-1103701"></a>You may need to zoom in close to the waveform. To do that, click and hold the right mouse button and drag a square outline around the waveform, as shown in the next figure. <br /><strong class="webflare-fig-line-height">Figure 4-28
<a id="pgfId-1103706"></a>: Choosing Sideband of Interest</strong>
<a id="pgfId-1148295"></a><div class="webflare-div-image">
<img width="591" height="334" src="images/chap4-30.gif" /></div></li><li>
<a id="pgfId-1148296"></a>Delete the result near 2GHz. To do this, in the waveform window, click the trace near 2GHz and just below -40 dB. Press the <em>Delete</em> key. To see the remaining trace, you may need use the bindkey <em>f</em> to fit (resize) the window so that the entire plot is shown. <br />
<a id="pgfId-1103709"></a>The waveform window redraws, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-29
<a id="pgfId-1103713"></a>Voltage Conversion Gain vs. Output Frequency</strong>
<a id="pgfId-1148340"></a><div class="webflare-div-image">
<img width="668" height="524" src="images/chap4-31.gif" /></div>
<a id="pgfId-1103715"></a>The lower subwindow displays the plot of the Voltage Conversion Gain versus the Output frequency. It rolls off at higher frequencies due to the degraded input match as the input moves above 1.9GHz. Since in the HBAC <em>Choosing Analyses</em> form, you set the <em>Sweep Type</em> to be <em>linear</em>, the plot has linear spacing on X-axis.<br />
<a id="pgfId-1103716"></a>If you hold the cursor over the curve at 100KHz, you can read the low frequency conversion gain off the plot as shown in the above figure. It is <em>14.25dB</em><code>.</code> </li></ol>
















<h4>
<a id="pgfId-1103718"></a><strong>Plotting Mixer Noise Figure</strong></h4>

<ol><li>
<a id="pgfId-1103719"></a>In the <em>Direct Plot Form</em>, select <em>hbnoise</em>.<br /><strong class="webflare-fig-line-height">Figure 4-30
<a id="pgfId-1243035"></a>Direct Plot Form - Plotting Mixer Noise Figure</strong>
<a id="pgfId-1243039"></a><div class="webflare-div-image">
<img width="668" height="516" src="images/chap4-32.gif" /></div></li><li>
<a id="pgfId-1103724"></a>Change the <em>Plotting Mode</em> to <em>New Win</em><em>.</em></li><li>
<a id="pgfId-1243084"></a>Select <em>USB</em> from the <em>Noise Type</em> section (this is the default).</li><li>
<a id="pgfId-1211300"></a>Select <em>NFdsb</em><em>, </em>in the <em>Function</em> section. NFdsb is double sideband noise figure. The form will change, as shown in the figure below</li><li>
<a id="pgfId-1103730"></a>Select <em>Integrated Over Bandwidth</em>.</li><li>
<a id="pgfId-1103731"></a>Type<em> </em><code>1K</code><em> </em>in the <em>Start Frequency (Hz)</em> field and <code>1M</code><em> </em>in the <em>Stop Frequency (Hz)</em> field.<br />
<a id="pgfId-1243152"></a>The Direct Plot Form should look like below.<br /><strong class="webflare-fig-line-height">Figure 4-31
<a id="pgfId-1243193"></a>Direct Plot Form DSB Noise Figure Setup</strong>
<a id="pgfId-1243197"></a><div class="webflare-div-image">
<img width="378" height="517" src="images/chap4-33.gif" /></div></li><li>
<a id="pgfId-1103732"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1148803"></a>The Integrated Noise Figure Plot is shown below:<br /><strong class="webflare-fig-line-height">Figure 4-32
<a id="pgfId-1103736"></a>Integrated Noise Figure Plot</strong>
<a id="pgfId-1148823"></a><div class="webflare-div-image">
<img width="661" height="676" src="images/chap4-34.gif" /></div>
<a id="pgfId-1148855"></a>To determine the noise figure at different frequencies, move the cursor along the noise figure curve in the waveform window. <br />
<a id="pgfId-1148856"></a>Next, you will plot hbnoise separation. When you want to understand the specifics about your noise problem, you can use hbnoise separation. The Noise Summary is not able to differentiate how much noise is coming from the noise source and how much from the transfer function. With noise separation, you can attempt to decrease the output noise by decreasing the noise sources with different device dimensions or by decreasing the transfer function by choosing alternative circuit architectures. When <em>Noise separation</em> is set to <em>yes</em> in the <em>Choos</em>in<em>g Analyses</em> form, the hbnoise separation feature is included during the simulation and the corresponding results are saved. </li><li>
<a id="pgfId-1103741"></a>In the <em>Direct Plot Form</em>, select <em>hbnoise separation</em> in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1103749"></a>In the <em>Function</em> section, select <em>Sideband Output</em><em>.</em> <br />
<a id="pgfId-1280188"></a><em>Sideband Output </em>plots the noise contribution of selected sidebands to the output. Different sideband numbers measure the noise from different noise frequencies when mixed with different harmonics of the hb analysis. In this example, noise frequencies near zero Hz and the noise that mixes from just below the first and second harmonics of the LO are selected.</li><li>
<a id="pgfId-1103750"></a>In the<em> </em><em>Signal Level </em>section, select<em> </em><em>V/sqrt(Hz)</em><em>.</em></li><li>
<a id="pgfId-1103751"></a>Choose <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1211296"></a>Select the <em>0, -1, and -2</em> in the <em>Output Sideband </em>section. This will plot the noise contribution of the<code> </code><em>0, -1, and -2</em><code> </code>sidebands to the output. This allows the identification of which noise frequencies are causing the largest noise contribution at he output of the circuit. <br /><div class="webflare-information-macro webflare-macro-tip">
<a id="pgfId-1211297"></a>
 You can hold cursor over the<em> 0 </em>output sideband and slide the cursor to include the <em>-2</em> output sideband. </div>
<a id="pgfId-1243356"></a>The Direct Plot Form should look like below.<br /><strong>Figure 4-33
<a id="pgfId-1243378"></a>Direct Plot Form for hbnoise Separation </strong>
<a id="pgfId-1243384"></a><div class="webflare-div-image">
<img width="668" height="617" src="images/chap4-36.gif" /></div></li><li>
<a id="pgfId-1103753"></a>Click <em>Plot</em>. The hbnoise separation is plotted, as shown in the figure below. Note that the harmonic numbers plotted are in the legend on the left side of the screen. HBnoise Separation, 0, -1, -2 Sideband.<br /><strong class="webflare-fig-line-height">Figure 4-34
<a id="pgfId-1222605"></a>HBnoise Separation, 0, -1, -2 Sideband</strong>
<a id="pgfId-1211292"></a><div class="webflare-div-image">
<img width="668" height="565" src="images/chap4-37.gif" /></div></li><li>
<a id="pgfId-1211293"></a>Click the <em>+</em> sign to the left of <em>output noise</em> in the legend on the left side of the waveform window. The legend expands. You can see that the<em> 0</em> <em>Output sideband</em> corresponds to the green trace. The<em> 0 Output sideband</em> contributes the most noise and is the worst noise offender. Next, plot<em> Instance Output</em> for the largest noise contributor above. (The zero sideband) This will show which components contribute the most noise at the output. <ol><li>
<a id="pgfId-1103761"></a>In the <em>Direct Plot Form</em>, select <em>Instance Output</em> in the <em>Function</em> section. </li><li>
<a id="pgfId-1103762"></a>Set the <em>Signal Level</em> to <em>V/sqrt(Hz)</em> and the Modifier to <em>Magnitude</em>. </li><li>
<a id="pgfId-1103763"></a>Select the<em> 0 </em>Output Sideband.</li><li>
<a id="pgfId-1103764"></a>In the Filter section, select <em>Include All Types</em>. </li><li>
<a id="pgfId-1103765"></a>In the Truncate section, type <code>3</code> in the by top text field. <br />
<a id="pgfId-1103766"></a>The <em>Direct Plot Form</em> should look like the one below.<br /><strong class="webflare-fig-line-height">Figure 4-35
<a id="pgfId-1103767"></a>Direct Plot Form for Plotting Instance Output for Noise Contribution of instances</strong>
<a id="pgfId-1149398"></a><div class="webflare-div-image">
<img width="652" height="775" src="images/chap4-38.gif" /></div></li></ol></li><li>
<a id="pgfId-1103771"></a>Click <em>Plot</em>. The plot showing the top three noise contributors is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-36
<a id="pgfId-1103775"></a>Output Noise Top Instance Contributors</strong>
<a id="pgfId-1149514"></a><div class="webflare-div-image">
<img width="662" height="647" src="images/chap4-39.gif" /></div></li></ol>
































































<p>
<a id="pgfId-1149505"></a>Click the <em>+</em> sign to the left of <em>output noise</em> in the legend on the left side of the waveform window. The legend expands to show the top three instance noise contributors.</p>
<ol><li>
<a id="pgfId-1103777"></a>If you move your mouse cursor over one of the traces, you can read the instance from the cursor readout and identify which instance contributes the most amount of noise. Above, the red line represents the noise contribution from instance Q6 (legend shown), the yellow line below represents the noise contribution from instance Q2, and the bottom green line represents the noise contribution from instance Q7. </li><li>
<a id="pgfId-1103778"></a>To find Q6 in the schematic, choose <em>Edit</em> - <em>Find</em> in the schematic. The <em>Schematic Find</em> form is displayed. Search for <em>instanceName == Q6</em> in the <em>cellview</em> and click <em>Apply</em>. <br /><strong class="webflare-fig-line-height">Figure 4-37
<a id="pgfId-1103779"></a>Schematic Find Form</strong>
<a id="pgfId-1211277"></a><div class="webflare-div-image">
<img width="668" height="175" src="images/chap4-40.gif" /></div>
<a id="pgfId-1211278"></a>Q6 is highlighted in the db_mixer schematic below in pink, as shown below.<br /><strong>Figure 4-38
<a id="pgfId-1211279"></a>Q6 Highlighted in dbmixer Schematic</strong>
<a id="pgfId-1103789"></a><div class="webflare-div-image">
<img width="635" height="383" src="images/chap4-41.gif" /></div></li><li>
<a id="pgfId-1103790"></a>Next, plot the Source Output so you can see which individual noise sources within the circuit are contributing the most noise. In the <em>Direct Plot Form</em>: <ol><li>
<a id="pgfId-1103791"></a>In the <em>Function</em> section, select <em>Source Output</em>. </li><li>
<a id="pgfId-1103792"></a>In the Signal Level section, select V/sqrt(Hz). </li><li>
<a id="pgfId-1103793"></a>In the Modifier section, select Magnitude.</li><li>
<a id="pgfId-1103794"></a>Leave the Output Sideband at<code> 0</code>.</li><li>
<a id="pgfId-1103795"></a>In the Filter section, select Include All Types.</li><li>
<a id="pgfId-1103796"></a>In the Truncate section, type <code>3</code> in the <em>by top number of source output</em> text field </li><li>
<a id="pgfId-1103797"></a>The Plotting Mode should still be set to New Window. <br />
<a id="pgfId-1103798"></a>The <em>Direct Plot Form</em> should look like the one below.<br /><strong class="webflare-fig-line-height">Figure 4-39
<a id="pgfId-1103802"></a>Direct Plot Form for Plotting by Top 3 Source Noise Contributors</strong>
<a id="pgfId-1150126"></a><div class="webflare-div-image">
<img width="668" height="768" src="images/chap4-42.gif" /></div></li></ol></li><li>
<a id="pgfId-1150127"></a>Click <em>Plot</em> to see which individual sources within the circuit are making the most noise.</li><li>
<a id="pgfId-1211266"></a>In the waveform window, click the <em>+</em> sign to the left of <em>output noise</em> in the legend on the left side of the waveform window. The legend expands to show the top three source noise contributors. <br /><strong class="webflare-fig-line-height">Figure 4-40
<a id="pgfId-1211267"></a>Top 3 Source Noise Contributors </strong>
<a id="pgfId-1211271"></a><div class="webflare-div-image">
<img width="668" height="590" src="images/chap4-43.gif" /></div>
<a id="pgfId-1150247"></a>Note that the top three Source Output contributors are displayed in the legend on the left side of the graph: <em>Q6: fn</em>, <em>Q2: fn</em>, and<em> Q7:fn</em>. <em>fn</em> refers to flicker noise. <a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple">Refer to the Noise Summary section in </a>Chapter 3: Frequency Domain Analyses: Harmonic Balance of the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide to get a description of the parameter names for the different device types.</li><li>
<a id="pgfId-1103812"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. </li><li>
<a id="pgfId-1150413"></a>In the waveform window, choose <em>File</em><em> - </em><em>Close All Windows</em><em>.</em> </li><li>
<a id="pgfId-1211262"></a>Next, look at the top noise contributors using the <em>Noise Summary Form</em>. In ADE Explorer, select <em>Results - Print - Noise Summary</em><em>.</em><br /><strong class="webflare-fig-line-height">Figure 4-41
<a id="pgfId-1211263"></a>Invoking Noise Summary Form</strong>
<a id="pgfId-1150460"></a><div class="webflare-div-image">
<img width="668" height="466" src="images/chap4-44.gif" /></div>
<a id="pgfId-1103820"></a>The Noise Summary window is displayed, as shown below.<br /><strong>Figure 4-42
<a id="pgfId-1103824"></a>Noise Summary Window</strong>
<a id="pgfId-1150580"></a><div class="webflare-div-image">
<img width="668" height="495" src="images/chap4-45.gif" /></div></li><li>
<a id="pgfId-1150581"></a>In the <em>Noise Summary</em> window, select <em>hbnoise_src</em> from the Data from<code> </code><em>section</em><code>.</code> This prints the output noise of the hbnoise-rif analysis. Note that the selection<em> hbnoise_src </em>lists the noise at the source, not at the output of the circuit.</li><li>
<a id="pgfId-1150673"></a><em>Select</em><em> integrated noise </em>from the <em>Type</em> section</li><li>
<a id="pgfId-1243828"></a><em>Select flat</em> from the <em>weighting </em>section (this is the default). <br />
<a id="pgfId-1150674"></a>Integrated noise produces a noise summary integrated over a frequency range using the specified weighting. If you choose integrated noise, you have the option of using a weighting factor. The flat weighting factor specifies that the integration be performed on the original unweighted waveform. The<em> from weight file selection </em>option specifies that, before the integration is performed, the noise contributions of particular frequencies in the original waveform be weighted by factors supplied from an input file.</li><li>
<a id="pgfId-1103828"></a>Select<em> A</em> from the the <em>noise unit</em> <em>drop-down list</em>. This will be the noise units used in the hbnoise_src summary.</li><li>
<a id="pgfId-1103829"></a>Type <code>1K </code>in the <em>From (Hz)</em> text field.</li><li>
<a id="pgfId-1150793"></a>Type <code>1M </code>in the <em>To (Hz)</em> text field.</li><li>
<a id="pgfId-1103830"></a>You can choose filtering details to include or exclude particular instances in your hbnoise summary. In the <em>FILTER</em> section, click <em>Include All Types</em>.</li><li>
<a id="pgfId-1103831"></a>You can shorten your summary by specifying how many of the highest contributors to include in the summary, by specifying the percentage of noise a device must contribute to be included in the summary, or by specifying the level of noise a device must contribute to be included in the summary. <br />
<a id="pgfId-1280573"></a>Select<em>by number</em> in the <em>truncate</em><em> </em>section<em> </em>and type <code>20</code> in the <em>top</em> field. You will be printing the top 20 noise contributors.</li><li>
<a id="pgfId-1103832"></a>Select <em>noise contributors</em> from the <em>sortby</em><em> section</em>.<br />
<a id="pgfId-1103833"></a>The <em>Noise Summary </em>form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-43
<a id="pgfId-1103839"></a>HBnoise Summary Form</strong>
<a id="pgfId-1151188"></a><div class="webflare-div-image">
<img width="668" height="525" src="images/chap4-46.gif" /></div></li><li>
<a id="pgfId-1103840"></a>Click <em>OK</em>. <br />
<a id="pgfId-1151237"></a>The <em>Results Display Window </em>is displayed containing the noise summary results, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-44
<a id="pgfId-1103845"></a>Noise Summary Results</strong>
<a id="pgfId-1151311"></a><div class="webflare-div-image">
<img width="623" height="506" src="images/chap4-47.gif" /></div>
<a id="pgfId-1103846"></a>The <em>Results Display Window</em> lists the individual contributors, the specific noise mechanism within the semiconductors causing the noise, and the noise contribution. The total input-referred noise voltage and output-referred noise voltage is shown at the bottom of the <em>Results Display Window</em>. You may need to use the scroll bar at the right side of the <em>Results Display Window</em> to see the bottom part of the results.<br />
<a id="pgfId-1103847"></a>Note that the output and input noise include the noise from all the noise contributors, and not just the contributors in the form. The <em>Param</em> column uses the same abbreviations as seen in the legend on the left side of the waveform window. For example, <em>fn</em> refers to flicker noise. Refer to the<em> Noise Summary</em><a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple"> section in </a>Chapter 3: Frequency Domain Analyses: Harmonic Balance of the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide to get a description of the parameter names for the different device types.</li><li>
<a id="pgfId-1103848"></a>Clean up the screen for the next set of measurements.<ol><li>
<a id="pgfId-1103849"></a>Close the <em>Results Display Window</em> by choosing <em>Window</em><em> - </em><em>Close</em>. </li><li>
<a id="pgfId-1103850"></a>Close the <em>Analog Design Environment</em> window by choosing <em>Session</em><em> -</em><em>Quit</em><em>.</em></li><li>
<a id="pgfId-1103852"></a>In the Schematic window, choose <em>File - Close.</em></li></ol></li></ol>

















































































<h4>
<a id="pgfId-1103854"></a>Summary</h4>

<p>
<a id="pgfId-1103855"></a>Harmonic Balance (hb), hbac, and hbnoise analyses were setup and simulations were run to determine the Mixer Conversion Gain, RF to IF Isolation, LO to IF Leakage, and Noise Figure for a receive mixer. In addition, you identified different ways to view noise in the receiver using the Noise Separation feature and Noise Summary form</p>
<p>
<a id="pgfId-1103856"></a>In the next section, you will measure 1dB Compression Point and Desensitization with an RF blocking signal present.</p>
<p>
<a id="pgfId-1222672"></a>1dB Compression Point, Desensitization, and Blocking</p>
<p>
<a id="pgfId-1103859"></a>All circuits reach a compression point. The large signal effects at this point cause the gain to stop increasing in a linear fashion. Since this is a large-signal effect, a large-signal analysis is required. When measuring 1dB Gain compression point, the idea is to sweep the input power over a range of power levels, and then plot the output power versus the input power. From the plot, the 1dB compression point can be determined (the 1dB compression point is the input signal level at with the receiver gain drops 1dB when compared to the ideal linear gain).</p>
<p>
<a id="pgfId-1103860"></a>Receiver desensitization interference occurs when a strong off-channel signal overloads a receiver front end and thus reduces the sensitivity to weaker on-channel signals.</p>
<p>
<a id="pgfId-1211259"></a>The setup for 1dB Compression Point is the same as that required by a desensitization measurement, except for the frequency of the RF input.&#160;&#160;For the compression point measurement, the RF signal is in the passband.&#160;&#160;For the desensitization measurement, the RF frequency is at the blocker frequency.&#160;&#160;Here, we show both the 1dB compression point and the desensitization measurement using the passband frequency.&#160;&#160;Usually, they are separate simulations with different frequencies for the RF signal. (This is done to save time in the workshop.)</p>
<p>
<a id="pgfId-1103862"></a>For 1dB gain compression point measurement, the frequency component set in the RF input port is considered as the RF signal frequency. </p>
<p>
<a id="pgfId-1103863"></a>For desensitization measurement, the frequency component set in the RF input port is considered the RF blocker frequency. </p>
<p>
<a id="pgfId-1103864"></a>You can set up the simulation to measure the conversion gain and noise figure as a function of RF blocker power.</p>
<p>
<a id="pgfId-1103865"></a><strong>Setting Up to Simulate 1dB CP and Desensitization</strong></p>
<ol><li>
<a id="pgfId-1103866"></a>In the CIW, choose<em> </em><em>File</em><em> - </em><em>Open</em><em> - </em><em>CellView</em>. The Open File form is displayed. Choose the <em>db_mixer schematic</em> from <em>ExampleLibRF</em>, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-45
<a id="pgfId-1103870"></a>Open File Form</strong>
<a id="pgfId-1151728"></a><div class="webflare-div-image">
<img width="561" height="345" src="images/chap4-48.gif" /></div></li><li>
<a id="pgfId-1103871"></a>Click <em>OK</em>. The <code>db_mixer</code> schematic appears, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-46
<a id="pgfId-1103875"></a>db_mixer Schematic</strong>
<a id="pgfId-1151858"></a><div class="webflare-div-image">
<img width="665" height="476" src="images/chap4-49.gif" /></div></li><li>
<a id="pgfId-1151859"></a>Start the <em>Analog Design Environment</em> from the schematic by choosing <em>Launch</em><em> - </em><em>ADE Explorer</em>. The Simulation Window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-47
<a id="pgfId-1103880"></a>Analog Design Environment Simulation Window</strong>
<a id="pgfId-1151934"></a><div class="webflare-div-image">
<img width="662" height="356" src="images/chap4-50.gif" /></div></li><li>
<a id="pgfId-1151993"></a>In ADE Explorer, select <em>Setup &#8211; Simulator</em>.<br />
<a id="pgfId-1151994"></a>The <em>Choosing Simulator</em> form is displayed.</li><li>
<a id="pgfId-1151995"></a>Choose <em>spectre</em> as the <em>Simulator</em>.<br /><strong class="webflare-fig-line-height">Figure 4-48
<a id="pgfId-1103892"></a>Choosing Simulator/Director/Host Form</strong>
<a id="pgfId-1152128"></a><div class="webflare-div-image">
<img width="601" height="84" src="images/chap4-51.gif" /></div></li><li>
<a id="pgfId-1103893"></a>Click <em>OK </em>to close the <em>Choosing Simulator</em> form.</li><li>
<a id="pgfId-1103895"></a>Set up the High Performance Simulation Options, as follows:<br />
<a id="pgfId-1103896"></a>In ADE Explorer, choose <em>Setup</em><em> - </em><em>High Performance Simulation</em>. The High Performance Simulation Options window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-49
<a id="pgfId-1103902"></a>High Performance Simulation Options Form</strong>
<a id="pgfId-1152231"></a><div class="webflare-div-image">
<img width="668" height="585" src="images/chap4-52.gif" /></div><ol><li>
<a id="pgfId-1103903"></a>In the High Performance Simulation window, select <em>APS</em>. Note that <em>auto</em> is selected for multithreading. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. <br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1103904"></a>The bigger the circuit, the more threads you should use. For a small circuit such as this, you may want to set the number of threads to 2. Using 16 threads on a small circuit might actually slow things down because of the overhead associated with multithreading. For more information, see the <em><a actuate="user" class="URL" href="../spectreuser/titlecopy.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator and Accelerated Parallel Simulator User guide</a></em>.</div></li><li>
<a id="pgfId-1103905"></a>Click <em>OK</em><em>.</em></li></ol></li><li>
<a id="pgfId-1103906"></a>Select <em>Outputs &#8211; Save All</em>.<br />
<a id="pgfId-1103907"></a>The <em>Save Options</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-50
<a id="pgfId-1103913"></a>Save Options Form</strong>
<a id="pgfId-1152390"></a><div class="webflare-div-image">
<img width="646" height="635" src="images/chap4-53.gif" /></div></li><li>
<a id="pgfId-1103914"></a>In the <em>Select signals to output</em><em> </em>section, make sure that <em>allpub</em> is selected. This is the default which saves all node voltages at all levels of hierarchy, but it does not include the node voltages inside the device models.</li><li>
<a id="pgfId-1103919"></a>Click <em>OK</em> to close the <em>Save Options </em>form.</li></ol>














































<h3>
<a id="pgfId-1103922"></a>Setting Up Model L<a id="Setting Up Model Libs"></a>ibraries</h3>

<ol><li>
<a id="pgfId-1211254"></a>In ADE Explorer, choose<em> </em><em>Setup</em><em> - </em><em>Simulation Files</em><em>. </em><br />
<a id="pgfId-1211255"></a>The <em>Simulation Files Setup</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-51
<a id="pgfId-1211256"></a>Simulation Files Setup Form</strong>
<a id="pgfId-1152574"></a><div class="webflare-div-image">
<img width="670" height="342" src="images/chap4-54.gif" /></div></li><li>
<a id="pgfId-1103928"></a>Verify that <em>Include Paths</em> is set as shown above.</li><li>
<a id="pgfId-1103929"></a>Select <em>Setup &#8211; Model Libraries</em>.<br />
<a id="pgfId-1103930"></a>The Model Library Setup form is displayed.</li><li>
<a id="pgfId-1103931"></a>In the<em> Model Library File</em> field, type the following path to the model file including the file name:<br /><pre class="webflare-pre-block webflare-courier-new" id="#id1103932">
<a id="pgfId-1103932"></a><code>models/modelsRF.scs</code></pre>
<a id="pgfId-1103933"></a>Alternately, you can browse to the location of your model files. <br />
<a id="pgfId-1103934"></a>The <em>Model Library Setup</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-52
<a id="pgfId-1103939"></a>Model Library Setup Form</strong>
<a id="pgfId-1152732"></a><div class="webflare-div-image">
<img width="650" height="232" src="images/chap4-55.gif" /></div></li><li>
<a id="pgfId-1152733"></a>When you are finished adding model files, click <em>OK</em> to close the <em>Model Library Setup</em> form.</li></ol>






















<h3>
<a id="pgfId-1103942"></a>Setting Design V<a id="Setting Design Variables"></a>ariables</h3>

<p>
<a id="pgfId-1103943"></a>In this simulation, the RF input frequency is set to 1.904G, and prf is the RF input power.</p>
<ol><li>
<a id="pgfId-1103944"></a>In ADE Explorer, change the value of the <code>frf2</code> to <em>0</em> in the <em>Design Variables</em> section.</li><li>
<a id="pgfId-1103946"></a>Ensure that the frf1 variable is set to<code> </code><em>1.904G</em><code>.</code> If not, change the value to 1.904G. </li><li>
<a id="pgfId-1152922"></a>Press <em>Enter</em>. <br />
<a id="pgfId-1103947"></a>Your <em>Design Variables</em> section looks like the following figure:<br /><strong class="webflare-fig-line-height">Figure 4-53
<a id="pgfId-1103952"></a>Design Variables Section of ADE</strong>
<a id="pgfId-1152952"></a><div class="webflare-div-image">
<img width="635" height="160" src="images/chap4-56.gif" /></div></li></ol>








<p>
<a id="pgfId-1103953"></a><strong>Set up the HB analysis</strong></p>
<ol><li>
<a id="pgfId-1103957"></a>Click the <em>Choosing Analyses</em> icon on the right side of ADE Explorer.<img width="49" height="40" src="images/chap4-57.gif" />
<br />
<a id="pgfId-1103958"></a>The <em>Choosing Analyses</em> form is displayed, as shown below. <br /><p class="webflare-indent1"><strong>Figure 4-54
<a id="pgfId-1103962"></a>hb Choosing Analyses Form</strong></p><div class="webflare-div-image">
<img width="652" height="773" src="images/chap4-58.gif" /></div>
<a id="pgfId-1211249"></a>Fill in the form as follows:</li><li>
<a id="pgfId-1211250"></a>Select <em>hb</em> analysis.</li><li>
<a id="pgfId-1211251"></a>Harmonic balance can set the harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically</em><code> </code>or <em>Yes</em> for the<em> </em><em>Run Transient </em>selection in the <em>Transient-Aided Options </em>section. This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has tstab enabled (when <em>Names</em> is selected).<ol><li>
<a id="pgfId-1211242"></a>In the <em>Transient Aided Options</em> section, leave Run transient? at the default value of <em>Decide automatically</em>. <br />
<a id="pgfId-1103966"></a><em>Run transient? </em>will run the LO signal using the transient (In SpectreRF, this is called the <em>tstab</em> interval) for a short period of time. At the end of <em>tstab</em>, an FFT is performed, and this is used as the starting point in the harmonic balance analysis. Doing this improves the convergence of hb by giving it a better starting point at the cost of a short transient analysis.</li><li>
<a id="pgfId-1103967"></a>Leave <em>Stop Time (tstab)</em> set to the default value of <em>auto</em>. <br />
<a id="pgfId-1211237"></a>When <em>auto</em> is selected for <em>Stop time</em>, a small number of periods of the LO is run using the transient analysis.  During this time, the signal is checked for steady-state conditions.  If steady-state is not reached in the initial number of periods, more periods can be added automatically by the simulator.  Using this feature allows an accurate FFT for the starting point in the hb iterations.</li><li>
<a id="pgfId-1211238"></a>When <em>Run transient?</em> is set to <em>Decide automatically</em>, the<em> Detect Steady State</em> option is checked automatically. When this is set, when steady-state is detected in the <em>tstab</em> interval, the simulator stops the transient analysis, runs the FFT, and starts iterating in the frequency domain. Using <em>Decide automatically</em> simplifies the setup for harmonic balance, and produces correct answers from hb without needing to know how to set hb up manually.</li><li>
<a id="pgfId-1103970"></a>If you want to see the startup waveform, set <em>Save Initial Transient Results (saveinit)</em> to <em>yes</em>.</li><li>
<a id="pgfId-1103971"></a>In the <em>Tones</em> section, choose <em>Frequencies</em> (this is the default value).<br />
<a id="pgfId-1103972"></a>Harmonic balance can now set harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. A transient analysis runs until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has <em>tstab</em> enabled (when <em>Names</em> is selected). If you want to manually set transient-aided hb, select <em>Yes</em> from the <em>Run Transient?</em> drop-down list and set a time for the transient in the <em>Stop Time (tstab)</em> field. In this mode, the stop time of the transient analysis in the <em>tstab</em> interval cannot be automatically extended.</li><li>
<a id="pgfId-1103973"></a>Select<em> 2 </em>for the <em>Number of Tones</em>.</li><li>
<a id="pgfId-1103974"></a>Type <code>1.9G </code>and <code>1.904G </code>in the <em>Fundamental Frequency</em> fields. <em>1.9 GHz</em> is the LO frequency and <em>1.904GHz</em> is the RF (frf1) frequency.<em> </em><em>Tone 1</em> should be the LO or signal which causes the most nonlinearity.<br />
<a id="pgfId-1103975"></a>The <em>Number of Harmonics</em> field for <em>Tone 1</em> is automatically set to <em>auto</em>. For <em>Tone 2</em>, type <code>5</code> harmonics. Your circuit is operating near the compression point, so a higher number of harmonics has been chosen.</li><li>
<a id="pgfId-1103976"></a>Type <code>1 </code>and <code>1 </code>in the <em>Oversample Factor</em><em> </em>fields. When all the signals in the system (including currents) are nearly sinusoidal, then an <em>Oversample</em> of <em>1</em> is appropriate.</li><li>
<a id="pgfId-1103977"></a>Leave <em>Harmonics</em> set to <em>Default</em>.</li><li>
<a id="pgfId-1103978"></a>In the <em>Accuracy Defaults</em> section, ensure that <em>moderate</em><code> is selected</code>. For most normal measurements <em>errpreset</em> should be set to <em>moderate</em>. When you need to measure really small distortions, then use <em>conservative</em>.</li><li>
<a id="pgfId-1103979"></a>To set up a sweep analysis, click <em>Sweep</em> and set <em>Sweep</em> to <em>1</em> <code>(this is the default value).</code></li><li>
<a id="pgfId-1153460"></a>For <em>Frequency Variable?</em> select <em>no</em>. You will be sweeping input power rather than frequency.</li><li>
<a id="pgfId-1153461"></a>Type <code>prf</code> in the<em> </em><em>Variable Name</em> field.</li><li>
<a id="pgfId-1153462"></a>In the<em> </em><em>Sweep Range </em>section, type <code>-30</code> in the <em>Start</em> field and <code>-10</code> in the <em>Stop</em> field.</li><li>
<a id="pgfId-1103983"></a>Se tthe <em>Sweep Typeto Linear </em>and type <code>5</code> in the <em>Step Size</em> field.</li><li>
<a id="pgfId-1103984"></a>Click <em>Add Specific Points</em>.<br />
<a id="pgfId-1103985"></a>Type <code>-8 -7.25 -6.5 -5.75 </code>in the <em>Additional Points</em> field. Note the spaces between the entries. You may need to use smaller spacings in the power sweep as the input power gets large and you approach the compression point. Using smaller spacings in the power sweep near the compression point helps with convergence.The <em>Choosing Analyses</em> form should look like the following: <br /><strong class="webflare-fig-line-height">Figure 4-55
<a id="pgfId-1103991"></a>hb Choosing Analyses Form</strong>
<a id="pgfId-1153684"></a><div class="webflare-div-image">
<img width="668" height="802" src="images/chap4-59.gif" /></div></li></ol>
<a id="pgfId-1103992"></a><a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple">For more information on setting up the Choosing Analyses form, see </a>Chapter 3: Frequency Domain Analyses: Harmonic Balance in the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide.</li><li>
<a id="pgfId-1153767"></a>Click <em>Apply</em>.</li></ol>















































<h3>
<a id="pgfId-1153768"></a>Setting up hbnoise to measure noise figure</h3>

<p>
<a id="pgfId-1153769"></a>Hb is used to capture the large signal behavior. Hbnoise analysis follows, and is used to measure the noise performance. Because prf is being swept in hb, the noise figure can be measured as a function of input power (prf). </p>
<ol><li>
<a id="pgfId-1103996"></a>In the <em>Analysis</em> section of the Choosing Analyses form, select <em>hbnoise, </em>as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-56
<a id="pgfId-1104000"></a>hbnoise Choosing Analyses Form</strong>
<a id="pgfId-1153869"></a><div class="webflare-div-image">
<img width="659" height="800" src="images/chap4-60.gif" /></div></li></ol>





<p>
<a id="pgfId-1104002"></a><strong>Discussion</strong></p>
<p class="webflare-indent1">
<a id="pgfId-1104003"></a>In hbnoise, the output frequency is <code>fout=200K</code>. The LO is at <code>1.9GHz</code>. The RF signal frequency is <code>1.9002G</code>, and calculated as follows:</p>
<p class="webflare-indent1">
<a id="pgfId-1104004"></a><code>fin=fout+1*flo +0*frf1=200K+1*1.9G+0*1.904G=1.9002G </code></p>
<p class="webflare-indent1">
<a id="pgfId-1104005"></a>The LO and one RF signal are applied in HB. The second RF signal is set to zero. The blocker frequency is set to <code>1.904G </code>at the input port. </p>
<p class="webflare-indent1">
<a id="pgfId-1104006"></a>When the RF signal gets large, it introduces nonlinearity to the system, and that causes mixing of additional noise frequencies with the RF input, thus adding more noise at the output of the system.  In this case, noise <code>200KHz</code> above and below the LO harmonics of <code>1</code>.<code>9GHz</code> will mix to <code>200KHz</code> at the output, and noise <code>200KHz</code> above and below the RF harmonics of 1.<code>904HGz</code> will also mix to <code>200KHz</code> at the output.</p>
<p class="webflare-indent1">
<a id="pgfId-1104007"></a>The noise figure can be measured as a function of the blocker power <code>prf</code>.</p>
<div class="webflare-indent1 webflare-information-macro webflare-macro-note">
<a id="pgfId-1211227"></a>The number of significant digits is set to <code>4</code>. This is the default netlisting resolution for all numerical values from the choosing analyses form. This is sufficient for this design.</div>
<p class="webflare-indent1">
<a id="pgfId-1104009"></a>However, in your particular design, you may need to increase it to a higher number (6 for example) to see all of the significant digits in the <em>Reference Sideband</em> field. If you do not set this, the frequency value will be truncated.</p>
<p class="webflare-indent1">
<a id="pgfId-1104010"></a>Type the following in CIW:</p>

<pre class="webflare-courier-new webflare-indent1">
<a id="pgfId-1154025"></a><code>aelPushSignifDigits(6)</code></pre>

<p class="webflare-indent1">
<a id="pgfId-1211224"></a>If you consistently need more than <code>4</code> significant digits in your forms, this can also be added to your <code>.cdsinitfile</code> so that it is set automatically every time you start ADE Explorer. In the workshop database, you can see in the <code>.cdsinit</code> file that this value has been set to <code>10</code>.</p>
<p>
<a id="pgfId-1104013"></a>Fill the hbnoise form as follows:</p>
<ol><li>
<a id="pgfId-1104014"></a>Leave the Sweeptype set to <em>default</em> (<em>absolute</em>).</li><li>
<a id="pgfId-1104015"></a>Select <em>Single-Point</em> from the <em>Output Frequency Sweep Range (Hz)</em> drop-down list.</li><li>
<a id="pgfId-1104016"></a>Type <code>200K</code> in the <em>Freq</em> field. This the output frequency (<em>fout</em>) from the mixer.</li><li>
<a id="pgfId-1104017"></a>In the <em>Sidebands</em> section, leave the <em>Maximum sideband</em> field blank. When the <em>Maximum sideband</em> field is left blank, (strongly recommended for noise analysis) all the noise folding from all the harmonics in the hb analysis are included in the noise result.</li><li>
<a id="pgfId-1244550"></a>Select the <em>Noise Figure</em> option.</li><li>
<a id="pgfId-1104018"></a>In the <em>Output</em> section, leave the <em>Output</em> set to the default value of <em>probe</em>. Type <code>/rif</code> in the field to the right<em> </em><em>Output Probe Instance</em>. Alternately, you can click  the <em>Select</em> button and select the output port in the schematic.<br />
<a id="pgfId-1154232"></a>Since <em>probe</em> was selected as the output measurement technique for the pnoise analysis, Spectre will subtract any noise contribution by the load resistance from the noise figure calculation. The load resistor noise is still present in the output noise.</li><li>
<a id="pgfId-1154233"></a>Ensure that the <em>Input Source</em><em> </em>is set to type <em>port</em><code> </code>(this is the default). Type <code>/rf</code> for the<em> </em><em>Input Port Source</em><em>.</em> Alternately, click <em>Select</em>  to the right of <em>I</em><em>nput Port Source</em> and select the input port in the schematic. If you want a noise figure calculation, you must select a port as the input source.<br />
<a id="pgfId-1104021"></a>In the<code> </code><em>Reference Sideband</em><em> </em>section, choose <em>Select From List</em>. The form will expand to show the available frequencies. The reference sideband specifies the RF passband frequency for the noise figure calculation.</li><li>
<a id="pgfId-1104022"></a>Under <em>Select from list</em>, in the <em>From (Hz)</em> and <em>To (Hz)</em> fields, you should see <em>0</em> to <em>1e12</em> by default.</li><li>
<a id="pgfId-1104025"></a>Select the<code> </code><em>u 1.9002G 1 0</em><code> </code>line. This corresponds to the input rf frequency.</li><li>
<a id="pgfId-1104026"></a>Ensure that <em>Do Noise</em> is selected and that <em>Noise Type</em><em> </em>is set to <em>timeaverage</em>. When <em>Noise Type</em> is set to <em>timeaverage</em>, the output noise calculated by hbnoise is the average noise power that is present with both the LO and RF signals applied in the circuit. Average noise power is also called RMS noise power. It is the true heating power that would be present in the load resistor.</li><li>
<a id="pgfId-1244633"></a>Select the <em>USB</em> option.</li><li>
<a id="pgfId-1104027"></a>Leave the rest of the form set to the default values.<br />
<a id="pgfId-1104028"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-57
<a id="pgfId-1104032"></a>hbnoise Choosing Analyses form</strong>
<a id="pgfId-1154492"></a><div class="webflare-div-image">
<img width="668" height="792" src="images/chap4-61.gif" /></div></li><li>
<a id="pgfId-1104033"></a>Click <em>Apply</em>.</li></ol>





















<h4>
<a id="pgfId-1154569"></a>Set up HBAC to measure conversion gain.</h4>

<ol><li>
<a id="pgfId-1154570"></a>In the <em>Choose Analyses</em> form, select <em>hbac</em>. The hbac <em>Choosing Analyses</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-58
<a id="pgfId-1154574"></a>hbac Choosing Analyses Form</strong>
<a id="pgfId-1154599"></a><div class="webflare-div-image">
<img width="474" height="653" src="images/chap4-62.gif" /></div>
<a id="pgfId-1104041"></a>Fill in the hbac Choosing Analyses form as follows:</li><li>
<a id="pgfId-1104042"></a>Set the <em>Input Frequency Sweep Range (Hz) </em>selection to <em>Single-Point</em>.</li><li>
<a id="pgfId-1104043"></a>Type <code>1.9002G</code><em> </em>in the <em>Freq</em> field. This is the input frequency. </li><li>
<a id="pgfId-1104044"></a>In the <em>Sidebands</em> section, choose <em>Select from range</em>.</li><li>
<a id="pgfId-1104045"></a>Under <em>Select from range</em>, in the <em>From (Hz)</em> and <em>To (Hz)</em> fields, you should see <em>0</em> to <em>1e12,</em> by default.</li><li>
<a id="pgfId-1104049"></a>Select the <em>l 200K -1 0</em> line. <em>200K</em> is the output frequency from the mixer. This will measure the conversion gain.</li><li>
<a id="pgfId-1104050"></a>The <em>Choosing Analyses</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-59
<a id="pgfId-1104054"></a>The hbac Choosing Analyses form</strong>
<a id="pgfId-1299857"></a><div class="webflare-div-image">
<img width="668" height="617" src="images/chap4-63.gif" /></div></li><li>
<a id="pgfId-1104055"></a>Click <em>OK</em><em>.</em></li></ol>


















<p>
<a id="pgfId-1104056"></a><strong>Run the simulation</strong></p>
<ol><li>
<a id="pgfId-1104057"></a>Click the green arrow icon on the right side of ADE Explorer or in the Schematic window. <img width="35" height="30" src="images/chap4-64.gif" /><span>. The simulation runs.</span><br />
<a id="pgfId-1104061"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</li></ol>


<p>
<a id="pgfId-1104062"></a><strong>Plot the 1dB Gain Compression point</strong></p>
<ol><li>
<a id="pgfId-1104063"></a>In ADE Explorer, choose <em>Results - Direct Plot - Main Form</em>. <br />
<a id="pgfId-1154880"></a>The <em>Direct Plot Form</em> is displayed. Alternately, you can press the<em> Direct Plot</em> icon in the schematic window, as shown below.</li><li>
<a id="pgfId-1104072"></a>In the <em>Direct Plot Form</em>, select <em>hb_mt</em><code>.</code><br />
<a id="pgfId-1281429"></a><em>hb_mt</em> refers to multitone harmonic balance.<br /><strong class="webflare-fig-line-height">Figure 4-60
<a id="pgfId-1104076"></a>Direct Plot Form</strong>
<a id="pgfId-1155128"></a><div class="webflare-div-image">
<img width="668" height="736" src="images/chap4-65.gif" /></div></li><li>
<a id="pgfId-1155129"></a>Select <em>Compression Point</em><em> </em>in the <em>Function</em> section.</li><li>
<a id="pgfId-1155130"></a><em>Ensure that </em><em>Port (fixed R(port) )</em> is selected from the <em>Select</em> drop-down list.</li><li>
<a id="pgfId-1281575"></a>Select <em>Output Power</em> is selected from the <em>Format</em> drop-down list.</li><li>
<a id="pgfId-1104080"></a>Select the <em>4M -1 1 </em>term in the 1st Order Harmonic section. <br />
<a id="pgfId-1104081"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-61
<a id="pgfId-1104085"></a>Direct Plot Form hb_mt</strong>
<a id="pgfId-1155360"></a><div class="webflare-div-image">
<img width="475" height="690" src="images/chap4-66.gif" /></div></li><li>
<a id="pgfId-1104086"></a>In the schematic, select the signal source just to the left of the <em>Output</em> label. <br />
<a id="pgfId-1104087"></a>The plot of Output Power vs. prf is displayed. <br />
<a id="pgfId-1104088"></a>To move the label, click to select the 1dB Compression point label, , and hold and drag the Compression Point label to the desired location. (First, select a random point in the graphics area to deselect the marker intercept point. Otherwise, the label will not move.)<br />
<a id="pgfId-1104089"></a>Note the compression point. The input-referred compression point is about <em>-6.1dB.</em><br /><strong class="webflare-fig-line-height">Figure 4-62
<a id="pgfId-1104093"></a>Input Referred 1dB Compression Point</strong>
<a id="pgfId-1155477"></a><div class="webflare-div-image">
<img width="646" height="581" src="images/chap4-67.gif" /></div>
<a id="pgfId-1104094"></a>The expression used to plot the Compression curves is shown above  in the waveform window.<br />
<a id="pgfId-1104095"></a><strong>Plot the RF-IF conversion gain as a function of RF (Blocker) power</strong></li><li>
<a id="pgfId-1104096"></a>In the <em>Direct Plot Form</em>, set <em>Plotting Mode</em> to <em>New SubWin</em>.</li><li>
<a id="pgfId-1211219"></a>In the <em>Analysis </em>section, select <em>hbac_mt</em>.</li><li>
<a id="pgfId-1211220"></a>In the <em>Function</em> section, select <em>Voltage</em><em>.</em></li><li>
<a id="pgfId-1211221"></a><em>Select</em> <em>Net</em> (this is the default).</li><li>
<a id="pgfId-1104100"></a>In the <em>Sweep</em> section, select <em>variable</em>.</li><li>
<a id="pgfId-1104101"></a>In the <em>Modifier</em> section select <em>dB20</em>.</li><li>
<a id="pgfId-1104102"></a>In the <em>Output Harmonic</em> section, select the<code> </code><em>199.9999999998K -1 0</em> line.<br />
<a id="pgfId-1104103"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-63
<a id="pgfId-1104104"></a>Direct Plot Form hbac_mt</strong>
<a id="pgfId-1104108"></a><div class="webflare-div-image">
<img width="579" height="577" src="images/chap4-68.gif" /></div></li><li>
<a id="pgfId-1211214"></a>In the schematic, select the <em>out1</em> net near the <em>Output</em> label.<br />
<a id="pgfId-1211215"></a>The conversion gain is plotted. As the blocker power goes up, the conversion gain drops.<br /><strong class="webflare-fig-line-height">Figure 4-64
<a id="pgfId-1211216"></a>1dB Compression Point and Conversion Gain</strong>
<a id="pgfId-1155709"></a><div class="webflare-div-image">
<img width="667" height="543" src="images/chap4-69.gif" /></div>
<a id="pgfId-1104115"></a><strong>Plot the noise figure</strong></li><li>
<a id="pgfId-1104116"></a>In the <em>Direct Plot Form</em>, select <em>hbnoise_mt</em> in the <em>Analysis</em> section. </li><li>
<a id="pgfId-1104117"></a>In the <em>Function</em> section, select <em>NFdsb</em>.<br />
<a id="pgfId-1104118"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-65
<a id="pgfId-1104122"></a>Direct Plot Form Plotting NFdsb</strong>
<a id="pgfId-1155829"></a><div class="webflare-div-image">
<img width="668" height="532" src="images/chap4-70.gif" /></div></li><li>
<a id="pgfId-1104123"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1104124"></a>The noise figure plot is added to the previous plot in a new sub window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-66
<a id="pgfId-1104125"></a>1dB Compression Point, Conversion Gain, and Double Sided Noise Figure</strong>
<a id="pgfId-1155901"></a><div class="webflare-div-image">
<img width="660" height="590" src="images/chap4-71.gif" /></div>
<a id="pgfId-1104130"></a>Make the noise figure result more readable.</li><li>
<a id="pgfId-1104131"></a>In the most recent sub window, move your mouse cursor over one of the numbers on the X Axis, click the right mouse button, and select <em>Swap Sweep Var</em> from the context menu, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-67
<a id="pgfId-1104135"></a>X-Axis Properties Form</strong>
<a id="pgfId-1155967"></a><div class="webflare-div-image">
<img width="189" height="186" src="images/chap4-72.gif" /></div>
<a id="pgfId-1104136"></a>The Swap Sweep Var form is displayed.</li><li>
<a id="pgfId-1104137"></a>In the <em>Swap Sweep Var</em> form, select <em>prf</em> from the <em>Sweep Variable</em> drop-down list. Leave Plot Destination set to New Subwindow. Enter <code>200k</code> in the X Value field. Note that for this menu, you must enter <code>k</code>, not <code>K</code>.<br /><strong class="webflare-fig-line-height">Figure 4-68
<a id="pgfId-1104141"></a>Swap Sweep Variable Form</strong>
<a id="pgfId-1156131"></a><div class="webflare-div-image">
<img width="668" height="190" src="images/chap4-73.gif" /></div></li><li>
<a id="pgfId-1282023"></a>Click <em>OK</em>. </li><li>
<a id="pgfId-1282024"></a>The waveform window is now fairly difficult to read. In the waveform window, select <em>Card</em> icon from the <em>Graph</em> toolbar. The <em>Card</em> mode displays one subwindow at a time so that the display area becomes larger. You can switch which subwindow is displayed at any time.<br /><strong class="webflare-fig-line-height">Figure 4-69
<a id="pgfId-1104147"></a>Selecting Card Mode Layout</strong>
<a id="pgfId-1156198"></a><div class="webflare-div-image">
<img width="668" height="170" src="images/chap4-74.gif" /></div>
<a id="pgfId-1104148"></a>The waveform window changes to the Card mode and the Noise Figure plot is much easier to read, as shown below.<br /><strong>Figure 4-70
<a id="pgfId-1104152"></a>Noise Figure</strong>
<a id="pgfId-1156257"></a><div class="webflare-div-image">
<img width="668" height="551" src="images/chap4-75.gif" /></div>
<a id="pgfId-1104153"></a>Note the trend in conversion gain and noise figure. As expected, the noise figure goes up and the conversion gain goes down with increasing RF blocker power (prf).</li><li>
<a id="pgfId-1104154"></a>To view other subwindows, select another plot to view from the <em>Subwindows</em> drop-down list.<br /><strong class="webflare-fig-line-height">Figure 4-71
<a id="pgfId-1104158"></a>Selecting Subwindow to View a Different Plot in Card Mode</strong>
<a id="pgfId-1156376"></a><div class="webflare-div-image">
<img width="668" height="206" src="images/chap4-76.gif" /></div>
<a id="pgfId-1104160"></a>Clean up the screen for the next set of measurements.</li><li>
<a id="pgfId-1104161"></a>Close ADE Explorer by choosing <em>Session</em><em> - </em><em>Quit</em><em>.</em></li><li>
<a id="pgfId-1104163"></a>In the Schematic window, choose <em>File - Close All</em><em>.</em></li></ol>







































































































<h4>
<a id="pgfId-1104165"></a>Summary: </h4>

<p>
<a id="pgfId-1104166"></a>In this section, you measured 1dB compression point, conversion gain, and desensitization with an RF blocking signal present using hb, hbnoise, and hbac analyses. </p>
<p>
<a id="pgfId-1104167"></a>In the next section, you will measure the Third-Order Intercept using Harmonic balance. </p>

<h3>
<a id="pgfId-1211210"></a>Third-Order Intercept measurement with HB</h3>

<p>
<a id="pgfId-1211211"></a>In the frequency domain, third-order products are the intermodulation distortion products between one of the fundamental signals and the second harmonic of the other signal.</p>

<p><strong>Figure 4-72
<a id="pgfId-1194489"></a>Intermodulation Distortion Products</strong></p>
<p>
<a id="pgfId-1194525"></a></p>
<div class="webflare-div-image">
<img width="668" height="348" src="images/chap4-77.gif" /></div>

<p>
<a id="pgfId-1104207"></a>The presence of two or more tones in a nonlinear circuit generates intermodulation products. Many of the spurious tones are out-of-band and cause no problems. However, the third-order tones are nearest to the fundamental and are likely to fall in-band. They add distortion to the output signal. IP3 is a metric or figure of merit for linearity that is used to describe the intermodulation performance of a mixer.</p>
<p>
<a id="pgfId-1104208"></a>To do the Third-Order Intercept measurement, in this section, both the RF and the LO signals are applied to the circuit. Using the transient analysis is impractical due to lengthy runtimes and spectral calculation times. The harmonic balance engine is used to overcome these disadvantages. <em>This setup has the advantage of being able to see all of the harmonics on the IF, but it takes longer to run than rapid IP3 for a small-signal measurement. If you want a small-signal IP3, a faster way to approach the problem is shown in the next section. </em>Using HB by itself for an IP3 measurement is typically only required for transmit mixers and power amplifiers. It is shown here so you can compare two different methods of obtaining IP3: Using three tone hb vs. rapid IP3.</p>
<p>
<a id="pgfId-1104211"></a><strong>Opening the db_mixer Mixer Circuit in the Schematic Window</strong><a id="Opening ne600p Schematic"></a></p>
<ol><li>
<a id="pgfId-1104212"></a>In the CIW, choose <em>File &#8211; Open</em>.<br />
<a id="pgfId-1104213"></a>The <em>Open File</em> form is displayed.</li><li>
<a id="pgfId-1104214"></a>In the <em>Open File </em>form, choose<em> ExampleLibRF </em>from the <em>Library </em>drop-down list. Choose the editable copy of the <em>ExampleLibRF</em> that you created as described earlier in this manual.</li><li>
<a id="pgfId-1104215"></a>Choose <em>db_mixer</em> in the <em>Cells</em> list box.<br />
<a id="pgfId-1211198"></a>The completed Open File form appears like the one below.<br /><strong class="webflare-fig-line-height">Figure 4-73
<a id="pgfId-1211199"></a>Open File Form</strong>
<a id="pgfId-1211203"></a><div class="webflare-div-image">
<img width="561" height="347" src="images/chap4-78.gif" /></div></li><li>
<a id="pgfId-1282249"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1282250"></a>Click <em>OK</em> in the Create new ADE Explorer view form.<br />
<a id="pgfId-1282251"></a>The Schematic window for the <em>db_mixer </em>mixer is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-74
<a id="pgfId-1156878"></a>db_mixer Schematic</strong>
<a id="pgfId-1156888"></a><div class="webflare-div-image">
<img width="668" height="477" src="images/chap4-79.gif" /></div></li><li>
<a id="pgfId-1156954"></a>In the Schematic window, choose <em>Launch &#8211; ADE Explorer</em>.<br />
<a id="pgfId-1156955"></a>ADE Explorer is displayed, as shown below. <br /><strong class="webflare-fig-line-height">Figure 4-75
<a id="pgfId-1156959"></a>Virtuoso Analog Design Environment Window</strong>
<a id="pgfId-1156978"></a><div class="webflare-div-image">
<img width="671" height="411" src="images/chap4-80.gif" /></div>
<a id="pgfId-1104235"></a><strong>Choosing Simulator Options</strong><a id="Choosing Simulator Options"></a></li><li>
<a id="pgfId-1104236"></a>In ADE Explorer, select <em>Setup &#8211; Simulator</em>.<br />
<a id="pgfId-1104237"></a>The Choosing Simulator is displayed.</li><li>
<a id="pgfId-1104238"></a>Select <em>spectre</em> from the <em>Simulator</em> drop-down list.<br /><strong class="webflare-fig-line-height">Figure 4-76
<a id="pgfId-1104246"></a>Choosing Simulator/Directory/Host Form</strong>
<a id="pgfId-1157102"></a><div class="webflare-div-image">
<img width="595" height="91" src="images/chap4-81.gif" /></div></li><li>
<a id="pgfId-1104247"></a>Click <em>OK </em>to close the <em>Choosing Simulator</em> form.</li><li>
<a id="pgfId-1104249"></a>Set up the High Performance Simulation Options<br />
<a id="pgfId-1104250"></a>In ADE Explorer, select <em>Setup</em> - <em>High Performance Simulation</em>. The <em>High Performance Simulation Options</em> window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-77
<a id="pgfId-1104256"></a>High Performance Simulation Options Window</strong>
<a id="pgfId-1157262"></a><div class="webflare-div-image">
<img width="663" height="579" src="images/chap4-82.gif" /></div>
<a id="pgfId-1104257"></a>In the <em>High Performance Simulation Options</em> window, select <em>APS</em>. Note that <em>auto</em> is selected for <em>multithreading</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. The bigger the circuit, the more threads you should use. For a small circuit such as this, you may want to set the number of threads to 2. Using 16 threads on a small circuit might actually slow things down because of the overhead associated with multithreading. For more information, see the <em><a actuate="user" class="URL" href="../spectreuser/titlecopy.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator and Accelerated Parallel Simulator User Guide</a></em>.<br />
<a id="pgfId-1104259"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1104260"></a>Select <em>Outputs &#8211; Save All</em>.<br />
<a id="pgfId-1104261"></a>The <em>Save Options</em> form is displayed.</li><li>
<a id="pgfId-1104262"></a>In the <em>Select signals to output</em> section, make sure that <em>allpub</em><em>
 
is selected.<br /></em><p class="webflare-indent1"><em><strong>Figure 4-78
<a id="pgfId-1104268"></a>Save Options Form</strong></em></p><em>
<a id="pgfId-1157445"></a></em><div class="webflare-div-image"><em>
<img width="658" height="667" src="images/chap4-83.gif" /></em></div><em>
<a id="pgfId-1104269"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1104270"></a>In the <em>Select signals to output</em> section, make sure that <em>allpub</em><em>
 
is highlighted. This is the default which saves all node voltages at all levels of hierarchy, but it does not include the node voltages inside the device models.</em></em></li><li>
<a id="pgfId-1104275"></a>Click <em>OK </em>to close the <em>Save Options</em> form.</li></ol>






















































<p>
<a id="pgfId-1104278"></a><strong>Setting Up Model Libraries</strong><a id="Setting Up Model Libs"></a></p>
<ol><li>
<a id="pgfId-1104279"></a>In ADE Explorer, select<em> </em><em>Setup</em><em> - </em><em>Simulation Files</em><em>. </em>The Simulation Files Setup form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-79
<a id="pgfId-1104283"></a>Simulation Files Setup Form</strong>
<a id="pgfId-1157663"></a><div class="webflare-div-image">
<img width="659" height="417" src="images/chap4-84.gif" /></div></li><li>
<a id="pgfId-1157664"></a>Ensure that the Include Path is set as shown above and click <em>OK</em> to close the form.</li><li>
<a id="pgfId-1157665"></a>Select <em>Setup &#8211; Model Libraries</em>.<br />
<a id="pgfId-1211193"></a>The <em>Model Library Setup</em> form is displayed.</li><li>
<a id="pgfId-1211194"></a>In the<em> Model Library File</em> field, type the following in the name of the model file:<br /><pre class="webflare-pre-block webflare-courier-new" id="#id1211195">
<a id="pgfId-1211195"></a><code>models/modelsRF.scs </code></pre>
<a id="pgfId-1211185"></a>Alternately, you can click the <em>Browse</em> button and browse to the <code>modelsRF.scs</code> model file.</li><li>
<a id="pgfId-1104290"></a>Ensure that the Model File name is selected. </li><li>
<a id="pgfId-1211178"></a>Click <em>Apply</em>.<br />
<a id="pgfId-1211179"></a>The <em>Model Library Setup</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-80
<a id="pgfId-1211180"></a>Model Library Setup Form</strong>
<a id="pgfId-1157799"></a><div class="webflare-div-image">
<img width="654" height="255" src="images/chap4-85.gif" /></div></li><li>
<a id="pgfId-1104296"></a>Click <em>OK</em> to close the <em>Model Library Setup</em> form.</li></ol>






















<p>
<a id="pgfId-1194977"></a><strong>Setting Up the Simulation</strong></p>
<p>
<a id="pgfId-1223110"></a>First view the input port settings.</p>
<ol><li>
<a id="pgfId-1194978"></a>In the schematic, select the RF source (port) just to the right of the <em>Input</em> label.</li><li>
<a id="pgfId-1194979"></a>Note that the <em>Property Editor</em> (left side of schematic) displays the properties of the selected port. For instructions on how to re-size the <em>Property Editor</em> window, see the <em>Virtuoso Schematic Editor L User Guide</em>.<br /><strong class="webflare-fig-line-height">Figure 4-81
<a id="pgfId-1104306"></a>Property Editor Showing Properties of Selected Port</strong>
<a id="pgfId-1158072"></a><div class="webflare-div-image">
<img width="516" height="649" src="images/chap4-86.gif" /></div></li><li>
<a id="pgfId-1158073"></a>Use the scrollbar on the right of the form, if necessary, so that you can view all of the properties.<br />
<a id="pgfId-1158064"></a>Note that the <em>Source type</em><em> </em>is set to <em>sine</em>. This enables the RF tones.<br />
<a id="pgfId-1104309"></a>Note that the first sinusoid&#8217;s frequency is set to the variable <em>frf1</em> and the second sinusoid&#8217;s frequency is set to the variable <em>frf2</em>. <br />
<a id="pgfId-1104310"></a>Both sinusoids have the amplitude set to the variable <em>prf</em>.</li><li>
<a id="pgfId-1104311"></a>In the <em>Design Variables</em> section of ADE Explorer, verify that variables are set as follows:<ul><li>
<a id="pgfId-1104312"></a><em>frf1</em> to <em>1</em><code>.</code><em>904G</em>. This is the first RF frequency.</li><li>
<a id="pgfId-1104313"></a><em>frf2</em> to <em>1</em><code>.</code><em>905G</em>. This is the second RF frequency.</li><li>
<a id="pgfId-1104314"></a><em>prf</em> to <em>-30</em>. This is the input power level for both RF tones.<br /><strong class="webflare-fig-line-height">Figure 4-82
<a id="pgfId-1104318"></a>Design Variables section</strong>
<a id="pgfId-1246094"></a><div class="webflare-div-image">
<img width="300" height="166" src="images/chap4-87.gif" /></div></li></ul></li><li>
<a id="pgfId-1246100"></a>Click the <em>Choosing Analyses</em> (<img width="35" height="29" src="images/chap4-88.gif" />
)icon on the right side of the ADE Explorer window to open the <em>Choosing Analyses</em><span> form.</span><br />
<a id="pgfId-1246104"></a>The <em>Choosing Analyses</em> form is displayed, as shown below. <br /><p class="webflare-indent1"><strong>Figure 4-83
<a id="pgfId-1158496"></a>hb Choosing Analyses Form</strong></p>
<a id="pgfId-1158339"></a><div class="webflare-div-image">
<img width="654" height="492" src="images/chap4-89.gif" /></div></li><li>
<a id="pgfId-1158313"></a>In the Analysis section, choose <em>hb</em>.<br />
<a id="pgfId-1104328"></a>Harmonic balance can set harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically</em><code> </code>or <em>Yes</em> for the <em>Run Transient</em> selection in the <em>Transient-Aided Options</em> section. This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has <em>tstab</em> enabled (when <em>Names</em> is selected).</li><li>
<a id="pgfId-1211169"></a>In the <em>Transient-Aided Options</em> section of the form, leave the settings at their default values, unless otherwise noted.<ol><li>
<a id="pgfId-1211170"></a>For <em>Run transient?</em> select <em>Decide automatically.</em><br />
<a id="pgfId-1104331"></a><em>Run transient?</em> will run the LO signal using the transient (In SpectreRF, this is called the <em>tstab</em> interval) for a short period of time. At the end of <em>tstab</em>, an FFT is performed, and this is used as the starting point in the harmonic balance analysis. Doing this improves the convergence of hb by giving it a better starting point at the cost of a short transient analysis.</li><li>
<a id="pgfId-1104332"></a>For <em>Stop time (tstab),</em> <em>auto</em> is automatically populated in the field.<br />
<a id="pgfId-1211165"></a>When <em>auto</em> is selected for <em>Stop</em><em> time</em>, a small number of periods of the LO is run using the transient analysis. During this time, the signal is checked for steady-state conditions. If steady-state is not reached in the initial number of periods, more periods can be added automatically by the simulator. Using this feature allows an accurate FFT for the starting point in the hb iterations.<br />
<a id="pgfId-1211166"></a>When <em>Run transient?</em><em> </em>is set to <em>Decide automatically</em>, the <em>Detect Steady State</em> option is checked automatically. When this is set, when steady-state is detected in the <em>tstab</em> interval, the simulator stops the transient analysis, runs the FFT, and starts iterating in the frequency domain. Using <em>Decide automatically</em> simplifies the setup for harmonic balance, and produces correct answers from hb without needing to know how to set hb up manually.</li><li>
<a id="pgfId-1104335"></a>For <em>Save Initial Transient Results (saveinit)</em>, select <em>yes</em>.</li></ol><br />
<a id="pgfId-1104336"></a>During the transient-assisted HB simulation, a transient simulation runs before the frequency domain iteration of harmonic balance. Only the signal in <em>Tone1</em> is enabled for this. Make sure you set the signal that causes the largest amount of distortion in the circuit as <em>Tone1</em>. This is usually the LO signal. At the end of the <em>tstab</em>, an FFT is run and its result is used as the starting point for the frequency domain iterations.<br />
<a id="pgfId-1104337"></a>All the signals are applied and the simulation is done in the frequency domain. Only the signals, harmonics, and the mixing products are calculated by hb.<br /><strong class="webflare-fig-line-height">Figure 4-84
<a id="pgfId-1104341"></a>Transient Assisted Harmonic Balance</strong>
<a id="pgfId-1158647"></a><div class="webflare-div-image">
<img width="668" height="147" src="images/chap4-90.gif" /></div></li><li>
<a id="pgfId-1158689"></a>In the Tones section, select <em>Names</em>. When <em>Names</em> is selected, the <em>Tones</em> portion of the form expands. All the sources in the top-level schematic are read into the form automatically. Only one signal can have transient assist. When <em>Tones</em> is set to <em>Names</em>, the signal with <em>tstab</em> set to <em>yes</em> can have transient assist. Choose the signal that produces the largest amount of distortion for transient assist, in this case, it is LO. </li><li>
<a id="pgfId-1158690"></a>Select <em>LO</em> in the <em>Tones</em> section. <br />
<a id="pgfId-1104344"></a>You can use hb with up to four signals present in the circuit. In this circuit, there are three tones, the LO and two RF tones. The two LO signals have the same name, the same frequency, and are considered a single tone. Whenever you have two signals at the <em>same</em> frequency, make sure you set the <em>Frequency Name 1</em> or <em>Frequency Name 2</em> property on the source to the <em>same</em> name as it was done in this example. When <em>Tones</em> is set to <em>Names</em>, the simulator considers both of the sources as a single input signal.<br />
<a id="pgfId-1104345"></a>You viewed the names (<em>frf1</em> and <em>frf2</em>) in the input port sources in an earlier step.<br /><strong class="webflare-fig-line-height">Figure 4-85
<a id="pgfId-1104349"></a>Tones Section of the Choosing Analyses Form with Tones Set to Names</strong>
<a id="pgfId-1282681"></a>.<div class="webflare-div-image">
<img width="668" height="299" src="images/chap4-91.gif" /></div></li><li>
<a id="pgfId-1282682"></a>Ensure that <em>Tstab</em> is set to <em>yes</em> in the <em>Tones</em> section for the LO tone. Set <em>tstab</em> to <em>yes</em> on the signal that causes the largest amount of distortion in the system. (In this example, that is the <em>LO</em> tone).</li><li>
<a id="pgfId-1104351"></a>On the LO tone, ensure that <em>Mxham</em> is set to <em>auto</em> (type <em>auto</em> in the field, if necessary). Since the circuit is mildly nonlinear (that is, the signals have no sharp edges), leave <em>Ovsap</em> (oversample) set to the default value of <em>1</em>. </li><li>
<a id="pgfId-1104352"></a>Click <em>Change</em>. The form updates. Both LO tones now have <em>Mxham</em>=<em>auto</em> and <em>Tstab</em>=<em>yes</em>. <br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1211159"></a>If not using <em>Mxham</em> as <em>auto</em> on the LO tone, change the <em>Maximum harmonics</em> on the LO tone from <em>3</em><code> </code>to <em>10</em>. Place the cursor in the field under <em>Mxham</em> and type <em>10</em>. Since the LO signal is well above compression, a higher number of harmonics is advised. When you set harmonics manually, if a signal is below compression, start with 3 harmonics. If a signal is at compression, start with 5 harmonics. If a signal is above compression, start with 7 harmonics.  Run the simulation. Now increase the number of harmonics on each tone separately by about a factor of 1.5, and run again. If the result changes, increase the harmonics again.  If the result does not change, the original number of harmonics was enough, and you might be able to decrease the number of harmonics. For fastest runtime with full accuracy, use the smallest number of harmonics for each tone that is applied to the circuit.</div></li><li>
<a id="pgfId-1104354"></a>Select the RF tone in the <em>Tones</em> box. Ensure that <em>Mxham</em> is set to <code>3</code>. Do the same for <em>RF2</em>. </li><li>
<a id="pgfId-1104355"></a>Click <em>Change</em> to update the form.</li><li>
<a id="pgfId-1159333"></a>For the Harmonics selection (just below the list of inputs), leave it at the default value of <em>Default</em>. If you click <em>Select</em>, you would have the option of setting the method to <em>diamond</em><code>, </code><em>funnel</em><code>,</code> or <em>axis</em><a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple"> cut. (For more information on diamond, funnel, and axis cut, see </a>Chapter 3: Frequency Domain Analyses: Harmonic Balance in the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide)</li><li>
<a id="pgfId-1159334"></a>Set <em>Accuracy (errpreset)</em> to <em>conservative</em>. The third and fifth order intermodulation distortion is calculated with this setup.These amplitudes are small, and thus high accuracy is needed.</li><li>
<a id="pgfId-1104358"></a>In the <em>Sweep</em> section, click <em>Sweep</em>. Leave it set it to the default value of <em>1.</em></li><li>
<a id="pgfId-1104359"></a>For <em>Frequency Variable?</em><em> </em>select <em>no</em>. You will be sweeping input power rather than frequency.<br /><strong class="webflare-fig-line-height">Figure 4-86
<a id="pgfId-1104363"></a>Sweep Section in hb Choosing Analyses Form</strong>
<a id="pgfId-1159441"></a><div class="webflare-div-image">
<img width="587" height="333" src="images/chap4-92.gif" /></div></li><li>
<a id="pgfId-1159442"></a>Click <em>Select Design Variable</em> and select the <em>prf</em> variable for the power sweep in the <em>Select Design Variable</em> form.</li><li>
<a id="pgfId-1104365"></a><em>Click </em><em>OK</em> in the <em>Select Design Variable</em> form.</li><li>
<a id="pgfId-1104366"></a>In the <em>Sweep Range</em> section, type <code>-40</code> in the <em>Start</em> field and <code>-20</code> in the <em>Stop</em> field.</li><li>
<a id="pgfId-1195318"></a>Select <em>Sweep Type</em> as <em>Linear</em><em> </em>and type <code>5</code> in the <em>Step Size</em> field.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1195319"></a>Because this is a small-signal measurement, you want to make sure your power sweep range does not go too high (stay operating at least 10dB below the 1dB compression point). </div>
<a id="pgfId-1104369"></a>The completed <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-87
<a id="pgfId-1104370"></a>Choosing Analyses Form Setup for IP3</strong>
<a id="pgfId-1104374"></a><div class="webflare-div-image">
<img width="667" height="765" src="images/chap4-93.gif" /></div></li><li>
<a id="pgfId-1104375"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1159724"></a>Start the simulation. From the ADE Explorer or the Schematic, click the green arrow icon (<img width="28" height="30" src="images/chap4-94.gif" /><span>)on the right side of the window.</span><br />
<a id="pgfId-1159728"></a>The Spectre output window is displayed with the simulator status information. Note the time it takes to run the simulation.<br /><p class="webflare-indent1"><strong>Figure 4-88
<a id="pgfId-1104384"></a>Spectre.out File Showing Elapsed Time</strong></p>
<a id="pgfId-1159791"></a><div class="webflare-div-image">
<img width="668" height="470" src="images/chap4-95.gif" /></div></li><li>
<a id="pgfId-1159895"></a>After the simulation finishes, plot the output spectrum. <br />
<a id="pgfId-1282808"></a>In ADE Explorer, choose <em>Results - Direct Plot - Main Form</em><em>.</em> Alternately, you can click the <em>Direct Plot</em> icon (<img width="33" height="28" src="images/chap4-96.gif" /><span>)in the Schematic window.</span></li><li>
<a id="pgfId-1104394"></a>In the <em>Analysis</em> Section, select <em>hb_mt</em>.</li><li>
<a id="pgfId-1104395"></a>In the <em>Function</em> Section, select <em>IPN Curves</em><em>.</em></li><li>
<a id="pgfId-1104396"></a>From the <em>Select</em> drop-sown, choose <em>Net (Specify R)</em>. </li><li>
<a id="pgfId-1282832"></a>Leave the <em>Resistance</em> set to the default value of <em>50</em>.</li><li>
<a id="pgfId-1104397"></a>Select <em>Variable Sweep (&#8220;prf&#8221;)</em><em> </em>for <em>Circuit Input Power</em>.</li><li>
<a id="pgfId-1104398"></a>Leave <em>Input Power Extrapolation Point (dBm)</em><em> </em>set to the default (first point in the sweep).</li><li>
<a id="pgfId-1104399"></a>Choose <em>Input Referred IP3, 3rd Order</em><em>.</em></li><li>
<a id="pgfId-1104400"></a>For the <em>3rd Order Harmonic</em>, choose the <em>3M -1 2 -1</em> entry.<br />
<a id="pgfId-1104401"></a>Depending on the input frequencies chosen, hb may calculate multiple outputs at the same frequency. To determine which entry to select, add up the absolute value of all of the terms (for example, <code>|-1| + 2 + |-1| = 4</code> and <code>0 + |-3| + 3 = 6</code>) and choose the one with the lowest value. This is the lowest order term, which is usually the term that is desired.</li><li>
<a id="pgfId-1104402"></a>For the<em> 1st Order Harmonic,</em> choose the <em>5M -1 0 1</em> entry.<br />
<a id="pgfId-1282889"></a>The completed <em>Direct Plot Form</em> should look like this:<br /><strong class="webflare-fig-line-height">Figure 4-89
<a id="pgfId-1104406"></a>Direct Plot Form - IP3 from HB simulation</strong>
<a id="pgfId-1160027"></a><div class="webflare-div-image">
<img width="420" height="778" src="images/chap4-97.gif" /></div></li><li>
<a id="pgfId-1104407"></a>Click the <em>out1</em> net on the schematic just below the <em>Output</em> label, as shown below. Then press the <em>Esc</em>  key, with the mouse cursor in the schematic window. This closes the<em> Direct Plot Form</em>.<br /><strong class="webflare-fig-line-height">Figure 4-90
<a id="pgfId-1104411"></a>Select Output Net on Schematic</strong>
<a id="pgfId-1160165"></a><div class="webflare-div-image">
<img width="435" height="177" src="images/chap4-98.gif" /></div>
<a id="pgfId-1104413"></a>The IP3 Plot is displayed in the waveform window.<br /><strong>Figure 4-91
<a id="pgfId-1104414"></a>IP3 Plot from 3-tone Harmonic Balance simulation</strong>
<a id="pgfId-1104418"></a>.<div class="webflare-div-image">
<img width="619" height="587" src="images/chap4-99.gif" /></div>
<a id="pgfId-1104419"></a>Intermodulation products increase at rates that are multiples of the fundamentals. In the small-signal region, third-order terms increase 3dB per dB and the second-order terms increase 2dB per dB.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1104420"></a>If you do not see the IP3 readout, you may need to click in the graphics area to deselect the marker, then select and move the Input Referred IP3 readout so that it is positioned in the visible area of the graph. </div>
<a id="pgfId-1160354"></a>In the previous plot, you can see that the circuit is operating within the small signal region. The third-order curve is following a 3dB/dB slope. Note the IP3 measurement. You will compare this to the IP3 measurement using the Rapid IP3 methodology.<br />
<a id="pgfId-1211151"></a>In the next section, you will plot the IP2 curves. </li></ol>






























































































































<h4>
<a id="pgfId-1211152"></a>Plotting the IP2 Curves</h4>

<ol><li>
<a id="pgfId-1211153"></a>In the <em>Direct Plot Form</em>, change the <em>Plotting Mode</em> to <em>Replace</em>.</li><li>
<a id="pgfId-1211146"></a>Change the <em>Order</em> to <em>2nd</em>.</li><li>
<a id="pgfId-1211147"></a>Choose <em>Input Referred IP2</em><em>. </em></li><li>
<a id="pgfId-1211148"></a>For the <em>2nd Order Harmonic</em>, choose the <em>1M 0 -1 1</em> entry.</li><li>
<a id="pgfId-1104428"></a>For the <em>1st Order Harmonic</em>, choose the <em>5M -1 0 1</em> entry.<br />
<a id="pgfId-1104429"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-92
<a id="pgfId-1104433"></a>Direct Plot Form for Input Referred IP2 Plot</strong>
<a id="pgfId-1160508"></a><div class="webflare-div-image">
<img width="377" height="648" src="images/chap4-100.gif" /></div></li><li>
<a id="pgfId-1160509"></a>Click <em>Replot</em>.<br />
<a id="pgfId-1211143"></a>The IP2 Plot is shown in the following figure. Although it appears that the IP2 point is not at the intercept point of the first and second order curves, it does actually calculate that point. It is attached to the last result of the second order curve so the X axis can display just the simulation result. Also, note that above -30 dBm, the input power is high enough to cause deviations from the small-signal 2dB/dB curve. Since the extrapolation point at the first value of the sweep is used to do the IP2 calculation, the IP2 result is correct because the data follows the 2dB/dB curve below -30 dBm input power.<br /><strong class="webflare-fig-line-height">Figure 4-93
<a id="pgfId-1104436"></a>IP2 Plot from 3-tone HB Analysis</strong>
<a id="pgfId-1104440"></a> <div class="webflare-div-image">
<img width="626" height="522" src="images/chap4-101.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1104441"></a>If you do not see the IP2 readout, you may need to click in the graphics area to deselect the marker, then select and move the Input Referred IP2 readout so that it is positioned in the visible area of the graph. </div>
<a id="pgfId-1104442"></a>Note the IP2 measurement for comparison later when measuring IP2 using the Rapid IP2 methodology.<br />
<a id="pgfId-1104446"></a>Leave the db_ mixer schematic and ADE Explorer opened. You will use them in the next section.</li></ol>





















<h4>
<a id="pgfId-1104447"></a>Rapid IP2 and IP3 Measurement</h4>

<p>
<a id="pgfId-1211139"></a>Another way to calculate IP3 and IP2 is to apply the LO only in the hb analysis and select Rapid IP2/IP3 from the hbac analysis. This is the fastest approach but it is limited to a small-signal IP3 measurement. It is also important to note that Rapid IP3 is not recommended for passive FET mixers where bsim3 or bsim4 models are used. In a small-signal application, this technique and the 3 tone hb method produce answers typically within 0.1dB of each other for IP3.&#160;&#160;For IP2, if extreme accuracy measures like very small reltol and vabstol, and a large number of harmonics are set in the 3-tone HB analysis, then closer agreement can be expected. These measures cause the 3-Tone HB analysis runtime to increase dramatically.</p>
<p>
<a id="pgfId-1211140"></a>IP2/3 is calculated from a first and second/third order term. Because of the small-signal projection, hbac is used to measure IP2 and IP3. hb analysis applied to the LO tone captures the nonlinearity of the circuit created by the LO and the resultant frequency translation. The hbac analysis is used to calculate the amplitude of the first, second, and third order terms that are downshifted by the LO. The <em>Analog Design Environment</em> has a <em>Direct Plot</em> function to automate the IP2 and IP3 calculations.</p>
<ol><li>
<a id="pgfId-1104450"></a>In ADE Explorer, set the <em>frf1</em> and <em>frf2</em> design variables to <code>0</code>. <br /><strong class="webflare-fig-line-height">Figure 4-94
<a id="pgfId-1104454"></a>Design Variables Section of ADE Simulation Window</strong>
<a id="pgfId-1160684"></a><div class="webflare-div-image">
<img width="615" height="165" src="images/chap4-102.gif" /></div></li><li>
<a id="pgfId-1283050"></a>In the <em>Design Variables</em> section, click<em> 1.904G</em><code> </code>to the right of the variable <em>frf1</em> and type <code>0</code> and press <em>Enter</em>.</li><li>
<a id="pgfId-1283051"></a>Select <em>1.095G</em> to the right of the variable <em>frf2</em> and type <code>0</code> and press <em>Enter</em>. <br />
<a id="pgfId-1104457"></a>Setting the input frequencies to <code>0</code> disables the production of waveforms for the large-signal analyses like tran, pss, and hb (harmonic balance). The updated <em>Design Variables</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-95
<a id="pgfId-1104458"></a>Design Variables Section of ADE Simulation Window with frf1 and frf2 set to zero</strong>
<a id="pgfId-1104462"></a>.<div class="webflare-div-image">
<img width="302" height="149" src="images/chap4-103.gif" /></div></li><li>
<a id="pgfId-1104463"></a>In ADE Explorer, select <em>Analyses</em><em> - </em><em>Choose</em><em>.</em><br />
<a id="pgfId-1104464"></a>The <em>Choosing Analyses</em> form is displayed. Select <em>hb</em> for the <em>Analysis</em> type. The form expands, as shown in the following figure:<br /><strong class="webflare-fig-line-height">Figure 4-96
<a id="pgfId-1104468"></a>Choosing Analyses Form for hb Analysis</strong>
<a id="pgfId-1160967"></a><div class="webflare-div-image">
<img width="506" height="764" src="images/chap4-104.gif" /></div></li><li>
<a id="pgfId-1104469"></a>. Harmonic balance can set harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically</em> for the <em>Run Transient</em><em> s</em>election in the<em> Transient-Aided Options</em> section. <br />
<a id="pgfId-1283217"></a>This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has <em>tstab</em> enabled (when <em>Names</em> is selected).<br />
<a id="pgfId-1104470"></a>In the <em>Transient-Aided Options</em> section of the form, leave the settings at their default values unless otherwise noted.<ol><li>
<a id="pgfId-1104471"></a>For <em>Run transient?</em> select <em>Decide automatically</em>. (this is the default)<br />
<a id="pgfId-1211134"></a><em>Run transient?</em> will run the LO signal using the transient (In SpectreRF, this is called the <em>tstab</em> interval) for a short period of time. At the end of <em>tstab</em>, an FFT is performed, and this is used as the starting point in the harmonic balance analysis. Doing this improves the convergence of hb by giving it a better starting point at the cost of a short transient analysis.</li><li>
<a id="pgfId-1211135"></a>For <em>Stop time (tstab)</em><em>,</em> <em>auto</em> is automatically populated in the field.<br />
<a id="pgfId-1211136"></a>When <em>auto</em> is selected for <em>Stop time</em>, a small number of periods of the LO is run using the transient analysis. During this time, the signal is checked for steady-state conditions. If steady-state is not reached in the initial number of periods, more periods can be added automatically by the simulator. Using this feature allows an accurate FFT for the starting point in the hb iterations.<br />
<a id="pgfId-1104475"></a>When <em>Run transient?</em><em> </em>is set to <em>Decide automatically</em>, the <em>Detect Steady State</em> option is checked automatically. When this is set, when steady-state is detected in the <em>tstab</em> interval, the simulator stops the transient analysis, runs the FFT, and starts iterating in the frequency domain. Using <em>Decide automatically</em> simplifies the setup for harmonic balance, and produces correct answers from hb without needing to know how to set hb up manually.</li><li>
<a id="pgfId-1104476"></a>For <em>Save Initial Transient Results (saveinit),</em> select <em>yes</em>.<br />
<a id="pgfId-1211131"></a>During the transient-assisted HB simulation, a transient simulation runs before the frequency domain iteration of harmonic balance. Only the LO signal in <em>Tone1</em> is enabled for this measurement. At the end of the <em>tstab</em>, an FFT is run and its result is used as the starting point for the frequency domain iterations<br />
<a id="pgfId-1211128"></a>All the signals are applied and the simulation is done in the frequency domain. Only the harmonics of the LO are calculated by hb.<br /><strong class="webflare-fig-line-height">Figure 4-97
<a id="pgfId-1104482"></a>Transient Assisted Harmonic Balance</strong>
<a id="pgfId-1283249"></a><div class="webflare-div-image">
<img width="668" height="153" src="images/chap4-105.gif" /></div></li></ol></li><li>
<a id="pgfId-1283250"></a>Set <em>Tones</em> to <em>Frequencies</em>. </li><li>
<a id="pgfId-1283251"></a>The <em>Number of Tones</em> defaults to <em>1</em>.</li><li>
<a id="pgfId-1104485"></a>Enter<em> </em><code>1.9G</code><em> </em>for the <em>Fundamental Frequency</em><em>.</em></li><li>
<a id="pgfId-1104486"></a>Note that <em>Number of Harmonics </em>is set to <em>auto</em> by default.</li><li>
<a id="pgfId-1104487"></a>Leave <em>Oversample factor</em> set to the default value of <code>1</code>. With auto harmonics, you do not need to set <em>oversample</em>. This circuit has sinusoidal-like waveforms (voltage and current), and an <em>oversample</em> of <em>1</em> is appropriate.</li><li>
<a id="pgfId-1104488"></a>Because the first and third order mixing terms are calculated by hbac, high accuracy is not necessary in the hb analysis, so <em>moderate</em> is selected for <em>errpreset</em> and provides reasonable accuracy. The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-98
<a id="pgfId-1104492"></a>Choosing Analyses Form - hb Setup for Rapid IP3</strong>
<a id="pgfId-1161270"></a><div class="webflare-div-image">
<img width="532" height="780" src="images/chap4-106.gif" /></div></li><li>
<a id="pgfId-1104493"></a>Click <em>Apply</em>.</li></ol>





















































<h4>
<a id="pgfId-1104494"></a><strong>Set-up HBAC Choosing Analyses Form</strong></h4>

<ol><li>
<a id="pgfId-1104495"></a>In the <em>Choosing Analyses</em> form, select <em>hbac</em> in the <em>Analysis</em> section. The <em>Choosing Analyses</em> form changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-99
<a id="pgfId-1104499"></a>Choosing Analyses Form for hbac</strong>
<a id="pgfId-1161335"></a><div class="webflare-div-image">
<img width="532" height="628" src="images/chap4-107.gif" /></div></li><li>
<a id="pgfId-1211123"></a>At the bottom of the form, in the <em>Specialized Analyses</em> section, select <em>RapidIP3</em>. The form expands. Just below the <em>Rapid IP3</em> selection, for <em>Source Type</em>, leave it at the default setting of <em>port</em>.</li><li>
<a id="pgfId-1211124"></a>Type<em> </em><code>/rf</code> for <em>Input Sources 1</em><em> </em>and<em> </em><em>2</em><em>.</em> Alternately, you can click <em>Select</em>  in the form and choose the <em>Input </em>rf port in the schematic.</li><li>
<a id="pgfId-1104503"></a>Type <em>1.904G </em>in the <em>Frequency</em> Field to the right of <em>Input Sources 1</em>.</li><li>
<a id="pgfId-1104504"></a>Type <em>1.905G</em> in the <em>Frequency</em> Field to the right of <em>Input Sources 2</em>.<br />
<a id="pgfId-1211110"></a><em>1.904G </em>and <em>1.905G</em> are the RF input frequencies.</li><li>
<a id="pgfId-1211111"></a>Type <code>-40</code> for <em>Input Power (dBm).</em></li><li>
<a id="pgfId-1211112"></a>In the <em>Frequency of IM Output Signal </em>field, type <code>3M</code>.</li><li>
<a id="pgfId-1211105"></a>In the <em>Frequency of Linear Output Signal </em>field, type <code>5M</code>.<br />
<a id="pgfId-1211106"></a>These are the linear and third-order output frequencies</li><li>
<a id="pgfId-1211107"></a>Leave the <em>Maximum Non-linear harmonics </em>field blank. The default is fine for IP2 and IP3 measurments.</li><li>
<a id="pgfId-1211095"></a>Select <em>Output Voltage </em>and in the <em>Out+</em> field, type <code>/out1</code>.<br />
<a id="pgfId-1211096"></a>The<em>Choosing Analyses</em> form should look like the following<br /><strong class="webflare-fig-line-height">Figure 4-100
<a id="pgfId-1211097"></a>HBAC Rapid IP3 Choosing Analyses Form</strong>
<a id="pgfId-1104517"></a>:<div class="webflare-div-image">
<img width="531" height="685" src="images/chap4-108.gif" /></div>
<a id="pgfId-1104518"></a>The selection of input power is very important for Rapid IP3. It should be set so that the system is in the small-signal range or linear region (more than 10dB below the 1dB compression point). If it is set too large, the system is in the large-signal range.<br />
<a id="pgfId-1211077"></a>Three input power levels can be set in the Rapid IP3 <em>Choosing Analyses</em> form. To confirm if the IP3 result is accurate or not, you can set two different power levels around the chosen input power. If you get the same IP3 result, then the IP3 result is accurate, and the chosen input power level is in the suitable region.<br />
<a id="pgfId-1211071"></a>The frequencies to be calculated depend on the choice of frequencies at the input and the LO frequency. Individual choices are provided for the frequencies which allows the selection of the smallest first order and largest second/third order product for your application.</li><li>
<a id="pgfId-1211053"></a>Click <em>OK</em> at the bottom of the <em>Choosing Analyse</em>s form.</li><li>
<a id="pgfId-1211041"></a>Start the simulation. <br />
<a id="pgfId-1211042"></a>From ADE Explorer or the Schematic, click the green arrow icon(<img width="23" height="18" src="images/chap4-109.gif" /><span>)on the right side of the window.</span></li><li>
<a id="pgfId-1211003"></a>The Spectre output window will appear with the simulator status information. Details of the IP3 measurement are also printed in the Spectre simulation log file. Note how much quicker the simulation finishes, compared to the three-tone hb simulation used previously to calculate IP3.<br /><strong class="webflare-fig-line-height">Figure 4-101
<a id="pgfId-1104531"></a>Rapid IP3 spectre.out logfile</strong>
<a id="pgfId-1161712"></a><div class="webflare-div-image">
<img width="638" height="386" src="images/chap4-110.gif" /></div>
<a id="pgfId-1210984"></a>After the simulation finishes, plot the Rapid IP3. </li><li>
<a id="pgfId-1210985"></a>In the <em>Analog Design Environment</em> window, select <em>Results - Direct Plot - Main Form. </em>You may also invoke the <em>Direct Plot</em> <em>Form</em> by clicking the <em>Direct Plot</em> icon (<img width="30" height="24" src="images/chap4-111.gif" />
)in the schematic. </li><li>
<a id="pgfId-1210921"></a>In the <em>Direct Plot Form</em>, select <em>hbac</em>. The form changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-102
<a id="pgfId-1210922"></a>Direct Plot Form after Rapid IP3 Simulation</strong>
<a id="pgfId-1161986"></a><div class="webflare-div-image">
<img width="380" height="572" src="images/chap4-112.gif" /></div></li><li>
<a id="pgfId-1104546"></a>In the <em>Function</em> section, select <em>Rapid IP3</em><em>.</em><br />
<a id="pgfId-1210905"></a>Leave the <em>Resistance</em> set to the default.<br />
<a id="pgfId-1210906"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-103
<a id="pgfId-1210907"></a>hbac Direct Plot Form for Rapid IP3</strong>
<a id="pgfId-1210875"></a><div class="webflare-div-image">
<img width="458" height="395" src="images/chap4-113.gif" /></div></li><li>
<a id="pgfId-1210876"></a>Click <em>Plot</em>. The Rapid IP3 response is plotted, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-104
<a id="pgfId-1210877"></a>Rapid IP3 Plot for db_mixer circuit</strong>
<a id="pgfId-1162155"></a><div class="webflare-div-image">
<img width="681" height="577" src="images/chap4-114.gif" /></div>
<a id="pgfId-1104558"></a>The input and output referred IP3 are shown in the waveform tool at the intercept point. The X axis of the plot is input power and the Y axis of the plot is output power, thus, the X-Y readout at the intercept point are the input-referred and output-referred IP3.<br />
<a id="pgfId-1210852"></a>Note that the IP3 value from the 3 tone hb simulation (4.52) and rapid IP3 (4.54) are very close. <br />
<a id="pgfId-1210853"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. In the next step, you will simulate and plot rapid IP2.</li></ol>






























































<p>
<a id="pgfId-1210843"></a><strong>Simulate and Plot Rapid IP2</strong></p>
<p>
<a id="pgfId-1223271"></a>Next, set up the HBAC <em>Choosing Analyses</em> form, as shown below.</p>
<ol><li>
<a id="pgfId-1210845"></a>In the <em>Choosing Analyses</em> form, in the <em>Analysis</em> section, select <em>hbac</em>. Alternatively, in ADE Explorer, double click the hbac in the <em>Analyses</em> section of the <em>Setup</em> pane.</li><li>
<a id="pgfId-1210828"></a>At the bottom of the form, in the <em>Specialized Analyses</em><em> </em>section, select <em>RapidIP2</em><em>.</em> The form changes, as shown in the following figure.<br /><strong class="webflare-fig-line-height">Figure 4-105
<a id="pgfId-1210820"></a>Rapid IP2 Choosing Analyses Form</strong>
<a id="pgfId-1104570"></a><div class="webflare-div-image">
<img width="532" height="547" src="images/chap4-115.gif" /></div>
<a id="pgfId-1210808"></a>The form retains all the settings that were set for the rapid IP3. The only thing that needs to be changed is the frequency of the intermodulation product. The main down conversion frequencies are at 4MHz and 5MHz. The second order intermodulation product is at 1MHz. The frequencies to be calculated depend on the choice of frequencies at the input and the LO frequency. Individual choices are provided for the frequencies which allows the selection of the smallest first order and largest second/third order product for your application.</li><li>
<a id="pgfId-1210793"></a>In the <em>Frequency of IM Output Signal</em> field, type <code>1M</code>.</li><li>
<a id="pgfId-1104573"></a>In the<em> </em><em>Frequency of Linear Output signal</em><em> </em>field, leave it set to <code>5M</code>.</li><li>
<a id="pgfId-1210774"></a>Click <em>OK</em> at the bottom of the <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1210775"></a>Start the simulation. In ADE Explorer or the schematic, click the green arrow icon (<img width="25" height="18" src="images/chap4-116.gif" /><span>)on the right side of the window.</span></li><li>
<a id="pgfId-1210715"></a>The Spectre output window isdisplayed with the simulator status information. Details of the IP2 measurement are also printed in the Spectre simulation log file. Note how much quicker the simulation finishes, compared to three-tone hb simulation used previously to calculate IP2.<br /><strong class="webflare-fig-line-height">Figure 4-106
<a id="pgfId-1104581"></a>Rapid IP2 spectre.out Logfile</strong>
<a id="pgfId-1210633"></a> <div class="webflare-div-image">
<img width="637" height="408" src="images/chap4-117.gif" /></div></li><li>
<a id="pgfId-1283648"></a> After the simulation finishes, plot the output spectrum. <br />
<a id="pgfId-1283649"></a>In ADE Explorer, choose <em>Results - Direct Plot - Main Form</em>.<br />
<a id="pgfId-1283653"></a>You may also invoke the Direct Plot Form by clicking the <em>Direct Plot</em> icon (<img width="27" height="21" src="images/chap4-118.gif" />
) in the schematic.</li><li>
<a id="pgfId-1210599"></a>In the <em>Direct Plot Form</em>, select <em>hbac</em> in the <em>Analysis</em> section and <em>Rapid IP2</em> in the <em>Function</em> section. Leave the <em>Resistance</em> set to the default value <em>(50)</em>. <br />
<a id="pgfId-1210566"></a>The <em>Direct Plot Form</em> is shown below.<br /><strong class="webflare-fig-line-height">Figure 4-107
<a id="pgfId-1210562"></a><strong>Rapid IP2 Direct Plot Form</strong></strong>
<a id="pgfId-1210550"></a><strong></strong><div class="webflare-div-image">
<img width="436" height="437" src="images/chap4-119.gif" /></div></li><li>
<a id="pgfId-1210551"></a>Click <em>Plot</em>. The Rapid IP2 is plotted in the waveform window.<br /><strong class="webflare-fig-line-height">Figure 4-108
<a id="pgfId-1210552"></a>Rapid IP2 Plot Results</strong>
<a id="pgfId-1162766"></a><div class="webflare-div-image">
<img width="666" height="555" src="images/chap4-120.gif" /></div>
<a id="pgfId-1210518"></a>The input and output referred IP2 are shown in the waveform tool at the intercept point. The X axis of the plot is input power and the Y axis of the plot is output power, thus the Xoutput-Y readout at the intercept point are the input referred IP2.<br />
<a id="pgfId-1210519"></a>Note that the IP2 value from the three-tone hb simulation and rapid IP2 are within 1dB.  </li><li>
<a id="pgfId-1210520"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>.</li><li>
<a id="pgfId-1210500"></a>Close all waveform windows by choosing <em>File</em><em> - </em><em>Close all windows</em>.</li><li>
<a id="pgfId-1210470"></a>In ADE Explorer, choose <em>Session</em><em> - </em><em>Quit</em><em>.</em></li><li>
<a id="pgfId-1210399"></a>In the Schematic Window, choose <em>File</em><em> - </em><em>Close All</em>.</li></ol>











































<h4>
<a id="pgfId-1210400"></a>Summary</h4>

<p>
<a id="pgfId-1210375"></a>In this section, you have measured the third-order intercept (IP3) using three-tone hb analysis and Rapid IP3 (hb and hbac specialized analysis). Rapid IP3 is a much faster way to measure IP3 and is just as accurate. In addition, you measured IP2 using the Rapid IP2 methodology. </p>
<p>
<a id="pgfId-1104608"></a>In the next section, you will make distortion measurements for the receive mixer.</p>

<h3>
<a id="pgfId-1104609"></a>Mixer Distortion Measurement</h3>

<p>
<a id="pgfId-1283728"></a>In the previous section, you measured IP3 and IP2. If you need to improve IP3 or IP2, it is helpful to know where the distortion is coming from, so you can fix the problem. Compression and IP3 are numerically related, so identifying components that cause compression also identify components that cause IP3 problems. In this next section, you will identify which components are causing compression in the circuit. For circuits that convert frequencies, hb and hbac compression distortion analyses are used. Similar capability for IP2 is provided in the IP2 distortion summary.</p>
<ol><li>
<a id="pgfId-1210339"></a>. In the CIW, choose <em>File - Open - CellView</em><em>.</em> The <em>Open File</em> form is displayed. Choose the <em>db_mixer</em> schematic from <em>ExampleLibRF</em>.<br /><strong class="webflare-fig-line-height">Figure 4-109
<a id="pgfId-1104612"></a>Open File Form.</strong>
<a id="pgfId-1210321"></a><div class="webflare-div-image">
<img width="628" height="400" src="images/chap4-121.gif" /></div></li><li>
<a id="pgfId-1210322"></a>Click <em>OK</em>. The <em>db_mixer</em> schematic is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-110
<a id="pgfId-1210323"></a>db_mixer Schematic.</strong>
<a id="pgfId-1210306"></a><div class="webflare-div-image">
<img width="667" height="515" src="images/chap4-122.gif" /></div></li><li>
<a id="pgfId-1210307"></a>Open the Analog Design Environment from the schematic by selecting <em>Launch</em><em> - </em><em>ADE Explorer</em>. The simulation window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-111
<a id="pgfId-1210251"></a>Analog Design Environment Simulation Window</strong>
<a id="pgfId-1104628"></a><div class="webflare-div-image">
<img width="668" height="337" src="images/chap4-123.gif" /></div></li><li>
<a id="pgfId-1210241"></a>In ADE Explorer, select <em>Setup</em><em> &#8211; </em><em>Simulator</em><em>.</em><br />
<a id="pgfId-1210242"></a>The <em>Choosing Simulator</em> form is displayed.</li><li>
<a id="pgfId-1210243"></a>Select <em>spectre</em> from the <em>Simulator </em>drop-down list.<br /><strong class="webflare-fig-line-height">Figure 4-112
<a id="pgfId-1210168"></a>Choosing Simulator/Director/Host Form</strong>
<a id="pgfId-1210146"></a><div class="webflare-div-image">
<img width="557" height="91" src="images/chap4-124.gif" /></div></li><li>
<a id="pgfId-1210147"></a>Click <em>OK</em> to close the <em>Choosing Simulator</em> form.</li><li>
<a id="pgfId-1210140"></a>Set up the High Performance Simulation Options, as follows:<ol><li>
<a id="pgfId-1210135"></a>In ADE Explorer, choose <em>Setup</em><em> - </em><em>High Performance Simulation</em><em>.</em> The <em>High Performance Simulation Options</em> window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-113
<a id="pgfId-1210110"></a>High Performance Simulation Options Form</strong>
<a id="pgfId-1104652"></a><div class="webflare-div-image">
<img width="668" height="621" src="images/chap4-125.gif" /></div></li><li>
<a id="pgfId-1210102"></a>In the High Performance Simulation window, select <em>APS</em>. Note that <em>auto</em> is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. The bigger the circuit, the more threads you should use. For a small circuit such as this, you may want to set the number of threads to 2. Using 16 threads on a small circuit might actually slow things down because of the overhead associated with multithreading. For more information, refer to the <em><a actuate="user" class="URL" href="../spectreuser/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator and Accelerated Parallel Simulator User Guide</a></em>.</li><li>
<a id="pgfId-1210078"></a>Click <em>OK</em>.</li></ol></li><li>
<a id="pgfId-1210074"></a>Select<em> </em><em>Outputs</em><em> &#8211; </em><em>Save All</em><em>.</em><br />
<a id="pgfId-1210063"></a>The <em>Save Options</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-114
<a id="pgfId-1210064"></a>Save Options Form</strong>
<a id="pgfId-1210053"></a><div class="webflare-div-image">
<img width="654" height="627" src="images/chap4-126.gif" /></div></li><li>
<a id="pgfId-1210054"></a>In the <em>Select signals to output</em><em> </em>section, make sure that <em>allpub</em> is selected. This is the default which saves all node voltages at all levels of hierarchy, but it does not include the node voltages inside the device models.</li><li>
<a id="pgfId-1210000"></a>Click <em>OK</em> to close the <em>Save Options</em> form.</li></ol>












































<p>
<a id="pgfId-1209990"></a><strong>Setting Up Model Libraries</strong><a id="Setting Up Model Libs"></a></p>
<ol><li>
<a id="pgfId-1209983"></a>In ADE Explorer, select <em>Setup</em><em> - </em><em>Simulation Files</em>. The <em>Simulation Files Setup</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-115
<a id="pgfId-1209984"></a>Simulation Files Setup Form</strong>
<a id="pgfId-1285803"></a><div class="webflare-div-image">
<img width="666" height="386" src="images/chap4-127.gif" /></div></li><li>
<a id="pgfId-1285810"></a>Ensure that the Include Path is set as shown above and click <em>OK</em> to close the form.</li><li>
<a id="pgfId-1285811"></a>Select <em>Setup</em><em> &#8211; </em><em>Model Libraries</em><em>.</em><br />
<a id="pgfId-1209959"></a>The <em>Model Library Setup</em> form is displayed.<br />
<a id="pgfId-1209960"></a>In the <em>Model Library File</em> field, type the following path to the model file including the file name:<pre class="webflare-pre-block webflare-courier-new" id="#id1209945">
<a id="pgfId-1209945"></a> <code>models/modelsRF.scs</code></pre>
<a id="pgfId-1209946"></a>Alternately, you can click <em>Browse</em> button and browse to the <code>modelsRF.scs </code>model file.</li><li>
<a id="pgfId-1209926"></a>Ensure that the Model File name is selected.</li><li>
<a id="pgfId-1209927"></a>Click <em>Apply</em>.<br />
<a id="pgfId-1209892"></a>The <em>Model Library Setup</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-116
<a id="pgfId-1209886"></a>Model Library Setup Form</strong>
<a id="pgfId-1213865"></a><div class="webflare-div-image">
<img width="657" height="229" src="images/chap4-128.gif" /></div></li><li>
<a id="pgfId-1213866"></a>Click <em>OK</em> to close the Model Library Setup form.</li></ol>






















<p>
<a id="pgfId-1213869"></a><strong>Setting the Design Variables</strong><a id="Setting Design Variables"></a></p>

<p><strong>Figure 4-117
<a id="pgfId-1213871"></a>Design Variables Section</strong></p>
<p>
<a id="pgfId-1209858"></a></p>
<div class="webflare-div-image">
<img width="321" height="155" src="images/chap4-129.gif" /></div>

<ol><li>
<a id="pgfId-1209848"></a>In the <em>Design Variables</em> section in ADE Explorer, click <em>frf1</em>.</li><li>
<a id="pgfId-1209830"></a>Select the value in the box to the right of the variable <em>frf1</em>. Type <em>0 </em>(zero) and press <em>Enter</em>. Do the same for the variable <em>frf2</em>. Setting the input frequencies to 0 disables the production of waveforms for the large-signal analyses like tran, pss, and hb (harmonic balance).<br />
<a id="pgfId-1209801"></a>The <em>Design Variables</em> section looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-118
<a id="pgfId-1209802"></a>Design Variables Section of ADE</strong>
<a id="pgfId-1164297"></a><div class="webflare-div-image">
<img width="307" height="161" src="images/chap4-130.gif" /></div></li></ol>







<p>
<a id="pgfId-1104707"></a><strong>Setting up the HB analysis</strong></p>
<ol><li>
<a id="pgfId-1209775"></a>Click the <em>Choosing Analyses</em> icon (<img width="22" height="22" src="images/chap4-131.gif" />
)on the right side of ADE Explorer.<br />
<a id="pgfId-1209776"></a>The Choosing Analyses form is displayed. </li><li>
<a id="pgfId-1209777"></a>Select <em>hb</em> in the <em>Analysis </em>section. The form expands, as shown in the following figure:<br /><strong class="webflare-fig-line-height">Figure 4-119
<a id="pgfId-1209729"></a>hb Choosing Analyses Form</strong>
<a id="pgfId-1104718"></a><div class="webflare-div-image">
<img width="652" height="715" src="images/chap4-132.gif" /></div></li><li>
<a id="pgfId-1104719"></a>Fill in the form as follows:<br />
<a id="pgfId-1209712"></a>Harmonic balance can set harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically</em> for the <em>Run Transient </em>selection in the <em>Transient-Aided Options</em> section. This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has <em>tstab</em> enabled (when <em>Names</em> is selected).<br />
<a id="pgfId-1209713"></a>In the Transient-Aided Options section of the form, select the following:<ol><li>
<a id="pgfId-1209714"></a>For <em>Run transient?</em> select<em> Decide automatically</em>. (this is the default)<br />
<a id="pgfId-1209707"></a><em>Run transient?</em> will run the LO signal using the transient (In SpectreRF, this is called the <em>tstab</em> interval) for a short period of time. At the end of <em>tstab</em>, an FFT is performed, and this is used as the starting point in the harmonic balance analysis. Doing this improves the convergence of hb by giving it a better starting point at the cost of a short transient analysis.</li><li>
<a id="pgfId-1209708"></a>For <em>Stop time (tstab)</em><em>,</em> <em>auto</em> is automatically populated in the field.<br />
<a id="pgfId-1209709"></a>When <em>auto</em> is selected for<em> Stop time</em>, a small number of periods of the LO is run using the transient analysis. During this time, the signal is checked for steady-state conditions. If steady-state is not reached in the initial number of periods, more periods can be added automatically by the simulator. Using this feature allows an accurate FFT for the starting point in the hb iterations.<br />
<a id="pgfId-1209704"></a>When <em>Run transient?</em><em> </em>is set to <em>Decide automatically</em>, the <em>Detect Steady State</em> option is checked automatically. When this is set, when steady-state is detected in the <em>tstab</em> interval, the simulator stops the transient analysis, runs the FFT, and starts iterating in the frequency domain. Using <em>Decide automatically</em> simplifies the setup for harmonic balance, and produces correct answers from hb without needing to know how to set hb up manually.</li><li>
<a id="pgfId-1104727"></a>For <em>Save Initial Transient Results (saveinit),</em> select <em>yes</em>.<br />
<a id="pgfId-1104728"></a>During the transient-assisted HB simulation, a transient simulation runs before the frequency domain iteration of harmonic balance. The LO signal in <em>Tone1</em> is enabled for this measurement. At the end of the <em>tstab</em>, an FFT is run and its result is used as the starting point for the frequency domain iterations<br />
<a id="pgfId-1104729"></a>All the signals are applied and the simulation is done in the frequency domain.Only the signal and its harmonics are calculated.<br /><strong class="webflare-fig-line-height">Figure 4-120
<a id="pgfId-1104740"></a>Transient Assisted Harmonic Balance</strong>
<a id="pgfId-1164615"></a><div class="webflare-div-image">
<img width="469" height="153" src="images/chap4-133.gif" /></div></li></ol></li><li>
<a id="pgfId-1104741"></a>In the <em>Tones </em>section, choose<em> Frequencies</em> (this is the default).</li><li>
<a id="pgfId-1104742"></a><em>Number of Tones</em><em> </em>is set to <em>1</em> by default. The only large signal tone in this simulation is the LO tone at 1.9GHz.</li><li>
<a id="pgfId-1104743"></a>Set the <em>Fundamental Frequency </em>to <code>1.9G</code>. </li><li>
<a id="pgfId-1104744"></a>Leave the <em>Number of Harmonics</em> set to the default value of <code>auto</code>.</li><li>
<a id="pgfId-1104745"></a>Leave <em>Oversample Factor </em>set to the default value of <code>1</code>. When using the autoharmonics feature, you do not have to set <em>Oversample Factor.</em></li><li>
<a id="pgfId-1209691"></a>In the <em>Accuracy Defaults (errpreset) </em>section, select <em>moderate</em>. For most typical measurements <em>errpreset</em> should be set to <em>moderate</em>. When you need to measure really small distortions, then <em>conservative</em> would be used.<br />
<a id="pgfId-1209692"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-121
<a id="pgfId-1209693"></a>hb Choosing Analyses Form Set-up for Distortion Measurement</strong>
<a id="pgfId-1164750"></a><div class="webflare-div-image">
<img width="474" height="770" src="images/chap4-134.gif" /></div></li><li>
<a id="pgfId-1209672"></a>Click <em>Apply</em>.</li><li>
<a id="pgfId-1209673"></a>In the Schematic window, set up the input port to perform a compression measurement.<br />
<a id="pgfId-1209669"></a>In the schematic, select the <em>Input</em> port. Once the input port is selected, the <em>Property Editor</em> on the left side of the schematic is populated with the properties of the selected instance, as shown below. <br /><strong class="webflare-fig-line-height">Figure 4-122
<a id="pgfId-1209644"></a>Setting Up Input Port for Compression Distortion Measurement</strong>
<a id="pgfId-1209638"></a><div class="webflare-div-image">
<img width="664" height="253" src="images/chap4-135.gif" /></div></li><li>
<a id="pgfId-1209639"></a>Search the <em>Property Editor</em> (scroll down) for the <em>PAC Magnitude </em>entry.<br /><strong class="webflare-fig-line-height">Figure 4-123
<a id="pgfId-1209640"></a>Editing Properties on Input Port for Compression Distortion Measurement</strong>
<a id="pgfId-1104765"></a><div class="webflare-div-image">
<img width="358" height="293" src="images/chap4-136.gif" /></div></li><li>
<a id="pgfId-1209632"></a>View the entry for <em>PAC Magnitude</em>. If set to <em>prf</em><code>,</code>do not change anything. If set to<code> </code><em>1</em> volt, select the entry, press the <em>Tab</em> key, and then set<em> PAC Magnitude (dBm) </em>to <em>prf</em><code>.</code>The port needs to be set up to supply a signal in the small-signal region because the HBAC analysis which is a small-signal analysis will be used to calculate the distortion.<br />
<a id="pgfId-1209619"></a>The amplitude of the input signal is specified on the input port. For the distortion summary, the <em>PAC Magnitude (dBm) </em>property is typically used on the input port. This is the amplitude that is used as the input for the distortion measurement. The <em>prf</em> value is set in the variables section of the Analog Design Environment and is <em>-30 </em>in this example.</li><li>
<a id="pgfId-1209620"></a>Check the schematic without saving it. In the schematic window, choose <em>Check - Current Cellview.</em><br /><strong class="webflare-fig-line-height">Figure 4-124
<a id="pgfId-1209608"></a>Check Current Cellview Menu</strong>
<a id="pgfId-1164986"></a><div class="webflare-div-image">
<img width="581" height="279" src="images/chap4-137.gif" /></div>
<a id="pgfId-1209603"></a>This allows ADE Explorer to netlist from the schematic without saving a copy of the newly modified circuit to the disk. This allows &#8220;what-if analysis&#8221; without changing the original schematic. When the design gets to the desired performance, then a <em>Check and Save</em> can be done. If you want to revert back to the original schematic, quit the schematic without saving it, and then recall it.</li></ol>
































































<p>
<a id="pgfId-1209599"></a><strong>Setting up the HBAC form</strong></p>
<ol><li>
<a id="pgfId-1209600"></a>In the <em>Choosing Analyses</em> form, select <em>hbac</em>. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-125
<a id="pgfId-1247542"></a>hbac Choosing Analyses Form</strong>
<a id="pgfId-1247546"></a><div class="webflare-div-image">
<img width="466" height="578" src="images/chap4-138.gif" /></div></li><li>
<a id="pgfId-1247547"></a>At the bottom of the form in the <em>Specialized Analysis</em> section, select <em>Compression Distortion Summary</em>.<br />
<a id="pgfId-1209565"></a>A dialog box is displayed that reminds you to set the <em>pacmag</em> parameter on the RF source.<br /><strong class="webflare-fig-line-height">Figure 4-126
<a id="pgfId-1165375"></a>Compression Distortion Summary Dialog Box</strong>
<a id="pgfId-1209548"></a><div class="webflare-div-image">
<img width="519" height="110" src="images/chap4-139.gif" /></div>
<a id="pgfId-1209549"></a>Since you have already set this parameter in the preceding step, click <em>Close</em> to close the dialog box. </li><li>
<a id="pgfId-1209507"></a>Set up the <em>hbac</em> <em>Choosing Analyses</em> form.<br /><strong class="webflare-fig-line-height">Figure 4-127
<a id="pgfId-1104794"></a>Compression Distortion Summary Choosing Analyses Form</strong>
<a id="pgfId-1104798"></a><div class="webflare-div-image">
<img width="466" height="539" src="images/chap4-140.gif" /></div></li><li>
<a id="pgfId-1209490"></a>You provide a list of the devices you want the distortion calculation for. If you leave this field blank, all of the nonlinear elements will be run. Since hbac will be run for each device specified, the computation can be time-consuming if the device list is large. You should select only those devices that are important to output. It is not recommended to run distortion summary for all nonlinear devices in the circuit if your circuit is large.<br />
<a id="pgfId-1209491"></a>In the<em> </em><em>Contributor Instances </em>field, type<code> </code>/Q1 /Q2 /Q3 /Q4 /Q5 /Q6 /Q7 /Q8. Note the spaces between the entries. Alternately, you may click <em>Select</em>  in the  and select the components in the schematic. </li><li>
<a id="pgfId-1209481"></a>Type <code>1.905G</code> in the <em>Frequency of Input Source</em><em> </em>field. This is the RF input frequency.</li><li>
<a id="pgfId-1209465"></a>Type <code>5M</code> in the<em> Frequency of Linear Output Signal </em>field. This is the mixer IF output frequency.<br />
<a id="pgfId-1209466"></a>Input and output frequencies are specified as usual. Only a single input frequency is allowed at a time.</li><li>
<a id="pgfId-1209461"></a>Leave the <em>Maximum Non-linear harmonics </em>field blank. The default value is optimum for the compression distortion measurement.</li><li>
<a id="pgfId-1209462"></a>In the<em> </em><em>Out+ </em>field, type <code>/out1</code>. You can also click <em>Select</em>  to the right of the <em>Out+</em> field and choose a net in the schematic. When the <em>Out-</em> field is left blank, ADE Explorer automatically assigns this to the global ground node.<br />
<a id="pgfId-1209447"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-128
<a id="pgfId-1209448"></a>Choosing Analyses Compression Distortion Summary</strong>
<a id="pgfId-1209436"></a><div class="webflare-div-image">
<img width="532" height="675" src="images/chap4-141.gif" /></div></li><li>
<a id="pgfId-1209437"></a>Click <em>OK</em> at the bottom of the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1209438"></a>The distortion measurement is performed along the entire signal path, which includes frequency translation and requires a declaration of the output node in the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1209427"></a>The compression distortion summary provides a relative measure of which components in a gain path contribute more or less compression. Because compression and IP3 are related mathematically, the compression distortion provides information about which components contribute to IP3.Start the simulation. In the ADE Explorer main window or the Schematic, click the green arrow icon (<img width="18" height="16" src="images/chap4-142.gif" /><span>) on the right side of the window.</span></li><li>
<a id="pgfId-1209392"></a>The Spectre output window will appear with the simulator status information. </li><li>
<a id="pgfId-1209343"></a>After the simulation finishes, choose <em>Results - Print-HBAC Distortion Summary.</em><em></em><br />
<a id="pgfId-1209329"></a>The <em>Results Display Window</em> appears with the distortion contributions from the selected devices in the circuit. This summary gives the list of the various distortion contributors and how much distortion they contribute to the output. (If no devices are selected, all the nonlinear devices will be calculated). It helps identify the distortion sources. You can quickly see what your top distortion contributors are, and you can look up the distortion contribution for a particular device. The measurement in the output is the output level with the distortion included divided by the output level of the ideal system.<br /><strong class="webflare-fig-line-height">Figure 4-129
<a id="pgfId-1104826"></a>Compression Distortion Summary Results Display Window</strong>
<a id="pgfId-1104830"></a><div class="webflare-div-image">
<img width="667" height="314" src="images/chap4-143.gif" /></div></li><li>
<a id="pgfId-1209303"></a>Note that <em>Q3</em>, <em>Q7</em>, Q2, and Q6 have the largest distortion contributors.</li><li>
<a id="pgfId-1209304"></a>Find Q3 in the schematic. <br />
<a id="pgfId-1209305"></a>In the schematic window, choose <em>Edit - Find.</em><br /><strong class="webflare-fig-line-height">Figure 4-130
<a id="pgfId-1209306"></a><em></em>Edit-Find to bring up Schematic Find Form</strong>
<a id="pgfId-1166050"></a><div class="webflare-div-image">
<img width="579" height="740" src="images/chap4-144.gif" /></div>
<a id="pgfId-1104838"></a>The <em>Schematic Find</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-131
<a id="pgfId-1104839"></a>Schematic Find Form</strong>
<a id="pgfId-1209273"></a><div class="webflare-div-image">
<img width="617" height="192" src="images/chap4-145.gif" /></div></li><li>
<a id="pgfId-1209274"></a>Delete the asterisk, type<em> </em><code>Q3</code>, and click <em>Apply</em>.<br />
<a id="pgfId-1209275"></a>Q3 is highlighted in the Schematic window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-132
<a id="pgfId-1209235"></a>Finding Sources of Distortion, in the Schematic Design.</strong>
<a id="pgfId-1166137"></a><div class="webflare-div-image">
<img width="609" height="487" src="images/chap4-146.gif" /></div></li><li>
<a id="pgfId-1209228"></a>In a similar manner, find <em>Q2</em>, <em>Q6</em>, and <em>Q7</em>.<br />
<a id="pgfId-1209229"></a>In the <em>Schematic Find</em> window, click <em>Cancel</em>.</li><li>
<a id="pgfId-1209230"></a>Click in the graphics area away from any component so the input port is deselected.</li><li>
<a id="pgfId-1209220"></a>If you deleted the Navigator in an earlier step, recall the Window Navigator by choosing <em>Window</em> - <em>Assistants</em> - <em>Navigator</em>.<br />
<a id="pgfId-1209216"></a><div class="webflare-div-image">
<img width="410" height="485" src="images/chap4-147.gif" /></div></li><li>
<a id="pgfId-1209168"></a>While holding the <em>Shift</em> key, select the four instances you found in the search. You should see <em>Q3</em>, <em>Q2</em>, <em>Q6</em>, and <em>Q7</em> highlighted in the <em>Navigator Assistant</em> and in the schematic.</li><li>
<a id="pgfId-1209152"></a>In the <em>Property Editor</em> assistant, type <code>2</code> in the<em> </em><em>Device area</em> field.</li><li>
<a id="pgfId-1209153"></a>Press <em>Enter</em><em>.</em><br />
<a id="pgfId-1209154"></a>The <em>Navigator Assistant</em> and the <em>Property Editor</em> on the right side of the schematic should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-133
<a id="pgfId-1104865"></a>Navigator Assistant Showing Four Selected Transistors</strong>
<a id="pgfId-1209136"></a><div class="webflare-div-image">
<img width="666" height="254" src="images/chap4-148.gif" /></div></li><li>
<a id="pgfId-1209137"></a>In the schematic window, choose <em>Check - Current Cellview.</em> (This is to do a &#8220;what-if analysis&#8221; and not overwrite the Schematic)</li><li>
<a id="pgfId-1209043"></a>Start the simulation. From the ADE Explorer main window or the Schematic, click the green arrow icon (<img width="29" height="20" src="images/chap4-149.gif" /><span>) on the right side of the window.</span></li><li>
<a id="pgfId-1209004"></a>The Spectre output window will appear with the simulator status information. </li><li>
<a id="pgfId-1208983"></a>After the simulation finishes, choose <em>Results- Print- HBAC Distortion Summary.</em><em></em></li><li>
<a id="pgfId-1208979"></a>The Results are appended in the <em>Results Display Window</em> at the bottom of the list.<br /><strong class="webflare-fig-line-height">Figure 4-134
<a id="pgfId-1104874"></a>Results Display Window -Two HBAC Compression Distortion Summary Simulations</strong>
<a id="pgfId-1104878"></a><div class="webflare-div-image">
<img width="668" height="396" src="images/chap4-150.gif" /></div>
<a id="pgfId-1208957"></a>Note that <em>Q3</em>, <em>Q7</em>, <em>Q6</em>, and <em>Q2</em> are still the largest distortion contributors. The distortion is lower with the Device area = <code>2,</code> as is the Total Distortion. This demonstrates the ability to do a &#8220;what-if&#8221; analysis changing the size of the NPN differential pairs.</li></ol>






























































































<p>
<a id="pgfId-1208958"></a><strong>Close the Analog Design Environment and the Schematic Window</strong></p>
<ol><li>
<a id="pgfId-1208959"></a>In ADE Explorer, choose <em>Session - Quit.</em><em></em></li><li>
<a id="pgfId-1208944"></a>In the schematic window, choose <em>File - Close All.</em></li></ol>


<h4>
<a id="pgfId-1208914"></a>Summary</h4>

<p>
<a id="pgfId-1208904"></a>You have used hb and hbac analyses to perform Mixer Distortion Measurements. You used Compression Distortion Summary to locate the distortion contributions from various devices in the design.</p>
<p>
<a id="pgfId-1228200"></a>This concludes the section on Receive Mixers. For more information on simulating receive mixers, please refer to the chapters in this user guide. In addition, see <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory Guide</a></em>. </p>
<p>
<a id="pgfId-1104889"></a>The remaining sections focus on simulating Transmit Mixers.</p>

<h2>
<a id="pgfId-1104890"></a>Setting Up to Simulate the db_mixer_xmit Mixer</h2>

<p>
<a id="pgfId-1104891"></a>In this workshop, you will make common measurements for an up-converting mixer. </p>
<p>
<a id="pgfId-1208860"></a>The <code>db_mixer_xmit</code> circuit is found in the <em>ExampleLibRF </em>library. The <code>db_mixer_xmit</code> integrated circuit consists of two Gilbert cell (up-converting double-balanced) mixers. Looking at the very left side of the schematic are two ports labeled <em>Input_top</em> and <em>Input_bottom</em> which generate the input signals. Both inputs feed the input to two double-balanced mixers through two voltage controlled voltage sources. There are four LO sources in the circuit between the bottom devices of the respective mixers. The LO operates at 1.9GHz. Next to the label <em>Output</em>, is the output port of the mixer. </p>
<p>
<a id="pgfId-1208830"></a>Image reject mixers use phase canceling techniques and remove one of the two major mixer products from the output of the mixing or multiplication process.</p>
<p>
<a id="pgfId-1208826"></a>When two RF signals are mixed (<em>f1</em> and <em>f2</em>), the sum and difference signals are produced, as shown below. </p>
<p>
<a id="pgfId-1208814"></a></p>

<div class="webflare-div-image">
<img width="668" height="221" src="images/chap4-151.gif" /></div>

<p>
<a id="pgfId-1208757"></a>The output signals are (<code>f1 + f2</code>) and (<code>f1-f2</code>).</p>
<p>
<a id="pgfId-1208758"></a>Of the two products from a mixer, normally only one is required. Often, the unwanted one will fall outside the required bandwidths and can be removed very easily. If the unwanted or image product is close to the desired signal, it can require complicated filtering to remove it sufficiently. </p>
<p>
<a id="pgfId-1208721"></a>Image rejection mixers utilize phasing techniques to cancel out the unwanted mix products. </p>
<p>
<a id="pgfId-1208722"></a>In the figure below, is the schematic of the upconverting mixer <code>db_mixer_xmit</code>. Following that is the list of measurements you will make in this module.</p>

<p><strong>Figure 4-135
<a id="pgfId-1104925"></a>db_mixer_xmit Schematic</strong></p>
<p>
<a id="pgfId-1167043"></a></p>
<div class="webflare-div-image">
<img width="666" height="528" src="images/chap4-152.gif" /></div>

<p>
<a id="pgfId-1167127"></a></p>
<table class="webflareTable" id="#id1167044">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">

<p>
<a id="pgfId-1167046"></a><strong>Transmit Mixer Measurements (db_mixer_xmit)</strong></p>

</td>
<td class="webflareTd" colspan="1" rowspan="1">

<p>
<a id="pgfId-1167048"></a><strong>Analyses</strong></p>

</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167050"></a>Three Tone Spectral Content and Image Rejection</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1167052">
<a id="pgfId-1167052"></a>HB </blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167054"></a>Three tone Swept IP3 (large signal)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1167056">
<a id="pgfId-1167056"></a>HB</blockquote>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167058"></a>Noise Figure/Signal to Noise Ratio</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<blockquote id="#id1167060">
<a id="pgfId-1167060"></a>HB and HBnoise</blockquote>
</td>
</tr>
</tbody></table>
<table class="webflareTable" id="#id1167061">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1167063">
<a id="pgfId-1167063"></a>Measurement</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1167065">
<a id="pgfId-1167065"></a>Measured</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167067"></a>LO frequency (Hz)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167069"></a>1.9 GHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167071"></a>Desired RF frequencies(Hz)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167073"></a>1.904 GHz, 1.905 GHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167075"></a>Image frequencies</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167077"></a>1.895 GHz, 1.896 GHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167079"></a>IF frequencies (Hz)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167081"></a>4 MHz, 5 MHz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167083"></a>LO voltage</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167085"></a>200mV peak</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167087"></a>IF power</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167089"></a>-9 dBm</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167095"></a>Image rejection</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167097"></a><em>measurement needed</em></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167099"></a>Input IP3 (from swept power)</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167101"></a><em>measurement needed</em></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167103"></a>Noise figure/SNR</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1167105"></a><em>measurement needed</em></p>
</td>
</tr>
</tbody></table>

<h3>
<a id="pgfId-1167128"></a>Three Tone Spectral Content and Image Rejection</h3>

<p>
<a id="pgfId-1208718"></a>Transmit mixers usually operate at power levels high enough that small-signal analyses should not be used. Therefore, HB is used to capture the actual, large-signal behavior. When measuring three-tone spectral content, all signals (LO, IF1, and IF2) are applied to the circuit. Harmonic balance is used, rather than transient analysis, because it is quicker.</p>
<p>
<a id="pgfId-1208694"></a>A conventional transmit mixer has two output responses at points above and below the LO frequency at <code>f1+f2</code> and <code>|f1-f2|</code>. The unused response, known as the image frequency, can be suppressed by an image-reject mixer. For the first measurement, you will check the output spectrum and view the frequency response to determine the image rejection. You will also look at IP3 measurements, which is a common figure of merit for mixers. For this circuit, the desired response is at 1.904G and 1.905G. </p>
<p>
<a id="pgfId-1208688"></a><strong>Setting Up the Simulation</strong></p>
<p>
<a id="pgfId-1208690"></a>Open the <em>db_mixer_xmit</em> Mixer Circuit in the Schematic Window, as follows:<a id="Opening ne600p Schematic"></a></p>
<ol><li>
<a id="pgfId-1208684"></a>In the CIW, choose <em>File</em><em> &#8211; </em><em>Open</em><em>.</em><br />
<a id="pgfId-1208671"></a>The Open File form is displayed.</li><li>
<a id="pgfId-1208672"></a>In the <em>Open File</em> form, select <em>ExampleLibRF</em><em> </em>from the <em>Library</em> drop-down list. </li><li>
<a id="pgfId-1208662"></a>Select <em>db_mixer_xmit</em><em> </em>from the <em>Cells</em> list box.<br />
<a id="pgfId-1208642"></a>The completed <em>Open File</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-136
<a id="pgfId-1208627"></a>Open File Form</strong>
<a id="pgfId-1105029"></a><div class="webflare-div-image">
<img width="561" height="398" src="images/chap4-153.gif" /></div></li><li>
<a id="pgfId-1208606"></a>Click <em>OK</em>.<br />
<a id="pgfId-1208607"></a>The Schematic window for the <code>db_mixer_xmit</code><em> </em>mixer is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-137
<a id="pgfId-1208603"></a>db_mixer_xmit Schematic</strong>
<a id="pgfId-1208596"></a><div class="webflare-div-image">
<img width="660" height="509" src="images/chap4-154.gif" /></div></li><li>
<a id="pgfId-1208597"></a>In the Schematic window, choose <em>Launch</em><em> &#8211; </em><em>ADE Explorer</em><em>.</em><br />
<a id="pgfId-1208581"></a>The Virtuoso Analog Design Environment Explorer window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-138
<a id="pgfId-1208582"></a>ADE Explorer</strong>
<a id="pgfId-1208563"></a><div class="webflare-div-image">
<img width="671" height="400" src="images/chap4-155.gif" /></div>
<a id="pgfId-1208565"></a>Choose the simulator o<a id="Choosing Simulator Options"></a>ptions, as follows:</li><li>
<a id="pgfId-1287107"></a>In ADE Explorer, select <em>Setup</em><em> &#8211; </em><em>Simulator</em>.<br />
<a id="pgfId-1287138"></a>The <em>Choosing Simulator/Directory/Host</em> form is displayed.</li><li>
<a id="pgfId-1287150"></a>Select <em>spectre</em> from the <em>Simulator</em> drop-down list.<br /><strong class="webflare-fig-line-height">Figure 4-139
<a id="pgfId-1208447"></a>Choosing Simulator/Directory/Host Form</strong>
<a id="pgfId-1208425"></a><div class="webflare-div-image">
<img width="593" height="86" src="images/chap4-156.gif" /></div></li><li>
<a id="pgfId-1208426"></a>Click <em>OK</em> to close the <em>Choosing Simulator</em>.</li><li>
<a id="pgfId-1208419"></a>Set up the High Performance Simulation Options, as follows:<ol><li>
<a id="pgfId-1208414"></a>In the ADE window, select <em>Setup</em><em> &#8211; </em><em>High Performance Simulation</em>. The <em>High Performance Simulation Options</em> window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-140
<a id="pgfId-1208393"></a>High Performance Simulation Options</strong>
<a id="pgfId-1105073"></a><div class="webflare-div-image">
<img width="668" height="618" src="images/chap4-157.gif" /></div></li><li>
<a id="pgfId-1208383"></a>In the <em>High Performance Simulation </em>window, select <em>APS</em> as the <em>Simulation Performance Mode.</em> Note that <em>Auto</em> is selected for <em>M</em><em>ultithreading options</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. </li><li>
<a id="pgfId-1208384"></a>Click <em>OK</em>.</li></ol></li><li>
<a id="pgfId-1208385"></a>Select <em>Outputs</em><em> &#8211; </em><em>Save All</em>.<br />
<a id="pgfId-1208374"></a>The Save Options form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-141
<a id="pgfId-1208375"></a>Save Options Form </strong>
<a id="pgfId-1208364"></a><div class="webflare-div-image">
<img width="660" height="710" src="images/chap4-158.gif" /></div><ol><li>
<a id="pgfId-1208365"></a>In the <em>Select signals to output(save)</em><em> </em>section, make sure that <em>allpub</em> is selected. This is the default which saves all node voltages at all levels of hierarchy, but it does not include the node voltages inside the device models.</li></ol><br />
<a id="pgfId-1208295"></a>Setup the model l<a id="Setting Up Model Libs"></a>ibraries, as follows:</li><li>
<a id="pgfId-1208289"></a>In the Virtuoso Analog Design Environment window, choose <em>Setup</em><em> - </em><em>Simulation Files</em>. The <em>Simulation Files Setup</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-142
<a id="pgfId-1208241"></a>Simulation Files Setup Form</strong>
<a id="pgfId-1208231"></a><div class="webflare-div-image">
<img width="670" height="362" src="images/chap4-159.gif" /></div></li><li>
<a id="pgfId-1208232"></a>Ensure that the <em>Include Path </em>is set, as shown above.</li><li>
<a id="pgfId-1208233"></a>Select <em>Setup</em><em> &#8211; </em><em>Model Libraries</em><em>.</em><br />
<a id="pgfId-1208208"></a>The <em>Model Library Setup</em> form is displayed. </li><li>
<a id="pgfId-1208209"></a>In the <em>Model Library File</em><em> </em>field, type the following as the name of the model file:<br /><pre class="webflare-pre-block webflare-courier-new" id="#id1208199">
<a id="pgfId-1208199"></a><code>models/modelsRF.scs</code></pre>
<a id="pgfId-1208169"></a>Alternately, you can click <em>Browse</em> and browse to the <code>modelsRF.scs</code> model file.</li><li>
<a id="pgfId-1208156"></a>Make sure that the Model File name is selected.</li><li>
<a id="pgfId-1208151"></a>Click <em>Apply</em>.<br /><pre class="webflare-pre-block webflare-courier-new" id="#id1208131">
<a id="pgfId-1208131"></a>The <em>Model Library Setup</em> form looks like the following.</pre><br /><strong class="webflare-fig-line-height">Figure 4-143
<a id="pgfId-1105106"></a>Model Library Setup</strong>
<a id="pgfId-1208123"></a><div class="webflare-div-image">
<img width="668" height="231" src="images/chap4-160.gif" /></div></li><li>
<a id="pgfId-1208124"></a>Click <em>OK</em> to close the <em>Model Library Setup</em><em> </em>form.</li></ol>











































































<p>
<a id="pgfId-1208117"></a><strong>Set the design variables, as follows:</strong><a id="Setting Design Variables"></a></p>

<p><strong>Figure 4-144
<a id="pgfId-1208069"></a>Design Variables Section of ADE Explorer</strong></p>
<p class="webflare-indent1">
<a id="pgfId-1208062"></a></p>
<div class="webflare-div-image">
<img width="307" height="166" src="images/chap4-161.gif" /></div>

<ol><li>
<a id="pgfId-1208063"></a>In the Design Variables section in the ADE Explorer, verify that the design variables<code> </code><em>fif1</em> and <em>fif2</em> are <em>4M</em><code> </code>and <em>5M</em>, and <em>flo</em> is <em>1.9G</em>. If you view the <em>Edit Object Properties </em>form for the Input ports (select either the  or  port on the left side of the schematic and select the bindkey ), you will see how the  tones are specified on the two  ports, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-145
<a id="pgfId-1105123"></a>Edit Properties Forms for IF ports</strong>
<a id="pgfId-1208033"></a><div class="webflare-div-image">
<img width="668" height="536" src="images/chap4-162.gif" /></div></li></ol>





<p>
<a id="pgfId-1208035"></a>Set up the HB a<a id="PSS Analysis Only"></a>nalysis, as follows:</p>
<ol><li>
<a id="pgfId-1208036"></a>In ADE Explorer, select <em>Analyses &#8211; Choose</em>.<br />
<a id="pgfId-1207961"></a>The <em>Choosing Analyses</em> form is displayed.</li><li>
<a id="pgfId-1207955"></a>In the <em>Choosing Analyses</em> form, select <em>hb.</em> The form expands. Since the circuit is mostly sinusoidal (not strongly nonlinear) Harmonic Balance is the appropriate analysis to choose.<br /><strong class="webflare-fig-line-height">Figure 4-146
<a id="pgfId-1105134"></a>The HB Choosing Analyses Form</strong>
<a id="pgfId-1105138"></a>.<div class="webflare-div-image">
<img width="668" height="710" src="images/chap4-163.gif" /></div>
<a id="pgfId-1207937"></a>Harmonic balance can set harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically</em> in the <em>Transient-Aided Options</em> section. This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em> (when <em>Frequencies</em> is selected) or for the tone that has <em>tstab</em> enabled (when <em>Names</em> is selected).</li><li>
<a id="pgfId-1207932"></a>In the Transient-Aided Options section of the form, select the following<ol><li>
<a id="pgfId-1207933"></a>For <em>Run transient?</em> select <em>Decide automatically</em> (this is the default).<br />
<a id="pgfId-1207934"></a><em>Run transient?</em> will run the LO signal using the transient (In SpectreRF, this is called the <em>tstab</em> interval) for a short period of time. At the end of <em>tstab</em>, an FFT is performed, and this is used as the starting point in the harmonic balance analysis. Doing this improves the convergence of hb by giving it a better starting point at the cost of a short transient analysis.</li><li>
<a id="pgfId-1207923"></a>For <em>Stop time (tstab)</em><em>,</em> <em>auto</em> is automatically populated in the field.<br />
<a id="pgfId-1207924"></a>When <em>auto</em> is selected for <em>Stop time</em>, a small number of periods of the LO is run using the transient analysis. During this time, the signal is checked for steady-state conditions. If steady-state is not reached in the initial number of periods, more periods can be added automatically by the simulator.  Using this feature allows an accurate FFT for the starting point in the hb iterations.<br />
<a id="pgfId-1207919"></a>When <em>Run transient?</em><em> </em>is set to <em>Decide automatically</em>, the <em>Detect Steady State</em> option is checked automatically. When this is set, when steady-state is detected in the <em>tstab</em> interval, the simulator stops the transient analysis, runs the FFT, and starts iterating in the frequency domain. Using <em>Decide automatically</em> simplifies the setup for harmonic balance, and produces correct answers from hb without needing to know how to set hb up manually.</li><li>
<a id="pgfId-1105146"></a>For <em>Save Initial Transient Results (saveinit)</em><em>,</em> select <em>yes</em>.<br />
<a id="pgfId-1207911"></a>During the transient-assisted HB simulation, a transient simulation runs before the frequency domain iteration of harmonic balance. The LO signal in <em>Tone1</em> is enabled for this measurement. At the end of the <em>tstab</em>, an FFT is run and its result is used as the starting point for the frequency domain iterations<br />
<a id="pgfId-1207912"></a>All the signals are applied and the simulation is done in the frequency domain. Only the signal and its harmonics are calculated.Transient Assisted Harmonic Balance.<br /><strong class="webflare-fig-line-height">Figure 4-147
<a id="pgfId-1223619"></a>Transient-Assisted Harmonic Balance</strong>
<a id="pgfId-1169044"></a><div class="webflare-div-image">
<img width="668" height="147" src="images/chap4-164.gif" /></div></li></ol></li><li>
<a id="pgfId-1287614"></a>In the <em>Tones</em> section, select <em>Names</em>. When <em>Names</em> is selected, the <em>Tones</em> portion of the form expands. All the sources in the top-level schematic are read into the form automatically. </li><li>
<a id="pgfId-1287615"></a>Select one of the LO sources in the <em>Tones</em> section. In the <em>Mxham</em> field, type <code>auto</code>.<br />
<a id="pgfId-1287616"></a>Spectre will automatically detect the number of harmonics required. Note that all four LO sources are now updated with a <em>Mxham</em> of <em>auto</em>.<br />
<a id="pgfId-1207908"></a>You can use hb with up to four signals present in the circuit. In this circuit, there are three tones, the LO and two RF tones. The LO signals have the same name, the same frequency, and are considered a single tone. Whenever you have two signals at the same frequency, make sure you set the <em>Frequency Name 1</em><em> </em>or <em>Frequency Name 2</em><em> </em>property on the source to the same name as it was done in this example. When <em>Tones</em> is set to <em>Names</em>, the simulator considers both of the sources as a single frequency.<br />
<a id="pgfId-1105161"></a>You viewed the names (<em>frf1</em> and <em>frf2</em>) in the input port sources in an earlier step.<br /><strong class="webflare-fig-line-height">Figure 4-148
<a id="pgfId-1105162"></a>Tones Section of hb Choosing Analyses Form</strong>
<a id="pgfId-1105166"></a><div class="webflare-div-image">
<img width="668" height="198" src="images/chap4-165.gif" /></div>
<a id="pgfId-1207893"></a>When you set the number of harmonics to <em>auto</em>, this identifies the signal on which to run <em>tstab</em>. This tone should be the LO tone. Only one signal can have transient assist, that being the signal with <em>tstab</em> set to <em>yes</em>; the signal with auto harmonics set.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1207894"></a>If you set the harmonics manually for all of the tones, set <em>tstab</em> to <em>yes</em> for the LO tone. Because you are using the auto-harmonics feature, you do not need to set the number of harmonics on the LO tone, nor do you need to set <em>Ovsap</em><em> (</em>oversample<em>). </em>By default,<em> </em><em>Ovsap</em> is set to <em>1</em><em>.</em>If for some reason, you are not using the auto-harmonics feature, follow these guidelines: </div><br /><span class="indent-as-level2">
<a id="pgfId-1207875"></a>If not using <em>Mxham</em> set to <em>auto</em> on the LO tone, change the <em>Maximum harmonics</em><em> </em>on the LO tone from <em>3</em><code> </code>to <em>10</em>. Place the cursor in the field under <em>Mxham</em> and type <em>10</em>. </span><br /><span class="indent-as-level2">
<a id="pgfId-1207876"></a>Since the circuit is operating well above the compression point, a higher number of harmonics is advised. </span><br /><span class="indent-as-level2">
<a id="pgfId-1207871"></a>If the circuit is mostly sinusoidal (voltages <em>and</em> <em>currents</em>), leave <em>oversample</em> set to<code> </code><em>1</em>. For strongly nonlinear circuits, you may need to increase oversample. </span><br />
<a id="pgfId-1207872"></a>In general, when you set harmonics manually, if a signal is below compression, start with three harmonics. If a signal is at compression, start with five harmonics. If a signal is above compression, start with seven harmonics. Run the simulation. Now increase the number of harmonics on each tone separately by about a factor of 1.5, and run the simulation again. If the result changes, increase harmonics again. If the result did not change, the original number of harmonics was enough, and you might be able to decrease the number of harmonics. For fastest runtime with full accuracy, use the smallest number of harmonics for each tone that is applied to the circuit</li><li>
<a id="pgfId-1207823"></a>Once finished, click <em>Change</em>. The form updates. Make sure that all of the LO tones have <em>Mxham=auto</em> and <em>Tstab=yes</em>. </li><li>
<a id="pgfId-1207791"></a>Select the IF tone in the <em>Tones</em> box. For this measurement, three harmonics on the IF tones are not enough. You need to increase the number of IF tones for greater accuracy. Set <em>Mxham</em> to <em>5</em><code>.</code> Do the same for IF2. Five (5) was found to be the optimum number of harmonics for the two RF tones, which are deliberately matched in amplitude.</li><li>
<a id="pgfId-1207779"></a>Set <em>Accuracy Defaults (errpreset)</em><em> </em>to <em>conservative</em>. <em>conservative</em> is used because the third and fifth order intermodulation distortion will be calculated with this setup. Since these amplitudes are small, high accuracy is needed.</li><li>
<a id="pgfId-1207758"></a>Leave the rest of the form set to the default values. <br />
<a id="pgfId-1207759"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-149
<a id="pgfId-1207760"></a>HB Choosing Analyses Form</strong>
<a id="pgfId-1169901"></a><div class="webflare-div-image">
<img width="668" height="580" src="images/chap4-166.gif" /></div></li><li>
<a id="pgfId-1207738"></a>Click <em>OK</em> at the bottom of the <em>Choosing Analyses</em> form. <br />
<a id="pgfId-1207739"></a>ADE Explorer will look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-150
<a id="pgfId-1207740"></a>ADE Simulation Window</strong>
<a id="pgfId-1207705"></a><div class="webflare-div-image">
<img width="668" height="403" src="images/chap4-167.gif" /></div></li></ol>





























































<p>
<a id="pgfId-1207706"></a>Run the simulation and plot the results, as follows:</p>
<ol><li>
<a id="pgfId-1207710"></a>Start the simulation by clicking the green arrow icon.<img width="23" height="19" src="images/chap4-168.gif" /><span> in ADE or in the Schematic Editor.</span><br />
<a id="pgfId-1105199"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</li><li>
<a id="pgfId-1207590"></a>Next, you will plot the Voltage Spectrum.<br />
<a id="pgfId-1207591"></a>In ADE Explorer, select <em>Results - </em><em>Direct Plot</em><em> - Main Form</em>. Alternately, you can click the <em>Direct Plot</em> icon (<img width="30" height="20" src="images/chap4-169.gif" /><span>)in the schematic window. </span><br />
<a id="pgfId-1215715"></a>The Direct Plot Form is displayed. <br /><p class="webflare-indent1"><strong>Figure 4-151
<a id="pgfId-1215743"></a>Direct Plot Form</strong></p>
<a id="pgfId-1215704"></a><div class="webflare-div-image">
<img width="612" height="347" src="images/chap4-170.gif" /></div></li><li>
<a id="pgfId-1207481"></a>In the <em>Direct Plot Form</em>, you will notice that there are two available analyses, <em>tstab</em> and <em>hb_mt</em>. The tstab results appear because you chose <em>Save Initial Transient Results&#8221; (saveinit)</em><em> </em>in the <em>Choosing Analyses</em> form. When there is more than one tone in the circuit, you will see <em>hb_mt</em>. A single tone simulation will show <em>hb</em>.<ol><li>
<a id="pgfId-1207443"></a>Select <em>hb_mt</em> in the Analysis section.</li><li>
<a id="pgfId-1248433"></a>Select <em>Voltage</em> in the <em>Function</em> section.</li><li>
<a id="pgfId-1207444"></a>Select <em>Net </em>in the <em>Select</em> drop-down list.</li><li>
<a id="pgfId-1207434"></a>Select <em>spectrum</em> in the <em>Sweep</em> section.</li><li>
<a id="pgfId-1207429"></a>Select <em>rms</em> in the <em>Signal level </em>section.</li><li>
<a id="pgfId-1207419"></a>Select <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1207389"></a>If you want to plot this setup in subsequent simulation, Select the <em>Add to Outputs</em> option.</li></ol><br />
<a id="pgfId-1207359"></a>The <em>Direct Plot Form</em> is shown below.<br /><strong class="webflare-fig-line-height">Figure 4-152
<a id="pgfId-1207354"></a>Harmonic Balance Direct Plot Form</strong>
<a id="pgfId-1207342"></a><div class="webflare-div-image">
<img width="668" height="748" src="images/chap4-171.gif" /></div></li><li>
<a id="pgfId-1207343"></a>Click on the net labeled <em>Output</em> in the schematic.<br /><strong class="webflare-fig-line-height">Figure 4-153
<a id="pgfId-1207344"></a>Output Net in Schematic</strong>
<a id="pgfId-1207326"></a><div class="webflare-div-image">
<img width="668" height="198" src="images/chap4-172.gif" /></div>
<a id="pgfId-1207327"></a>The plot is displayed.<br /><strong>Figure 4-154
<a id="pgfId-1207328"></a>Voltage Spectrum of Transmit Mixer</strong>
<a id="pgfId-1207295"></a><div class="webflare-div-image">
<img width="672" height="526" src="images/chap4-173.gif" /></div></li><li>
<a id="pgfId-1207296"></a>Zoom in on the area around 1.9GHz. Place the cursor in the waveform window, click the right mouse button and draw a box around the signals surrounding 1.9GHz. You may need to do this several times to zoom in specifically to the area around 1.9GHz.</li><li>
<a id="pgfId-1207255"></a>The waveform window should look similar to the following:<br /><strong class="webflare-fig-line-height">Figure 4-155
<a id="pgfId-1207256"></a>Zoomed in Voltage Spectrum</strong>
<a id="pgfId-1207231"></a><div class="webflare-div-image">
<img width="671" height="580" src="images/chap4-174.gif" /></div></li><li>
<a id="pgfId-1207232"></a>Move the mouse cursor to the tip of the harmonic at frequencies <em>1</em>.<em>895G</em>, <em>1</em>.<em>896G</em>, <em>1</em>.<em>9G</em>, <em>1.904G</em>, and <em>1.905G</em>. The tracking cursor values read the following:<br />
<a id="pgfId-1207225"></a><table class="webflareTable" id="#id1207188">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207190"></a></p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1207192">
<a id="pgfId-1207192"></a>Frequency (GHz)</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1207194">
<a id="pgfId-1207194"></a>Amplitude (peak, dB)</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207196"></a>Low side RF freq 2</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207198"></a>1.8995 </p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207200"></a>-90.99</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207202"></a>Low side RF freq 1</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207204"></a>1.896</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207206"></a>-91.90</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207208"></a>LO Frequency</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207210"></a>1.9</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207212"></a>-92.43</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207214"></a>Hi side RF Freq 1</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207216"></a>1.904</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207218"></a>-39.49</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207220"></a>Hi side RF Freq 2</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207222"></a>1.905</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1207224"></a>-39.49</p>
</td>
</tr>
</tbody></table><br />
<a id="pgfId-1207099"></a>Image rejection is the ratio of the power in the passband divided by the power in the image. If you have dB, this is dB at the passband frequency minus dB at the image frequency. Place a marker on the RF1 frequency (1.904G) by placing the cursor on the trace and pressing the <em>m</em> bindkey Place a delta marker on the Image frequency (1.895GHz) by placing the cursor on the trace and pressing <em>d</em>. <br /><strong class="webflare-fig-line-height">Figure 4-156
<a id="pgfId-1207075"></a>Image Rejection</strong>
<a id="pgfId-1105300"></a><div class="webflare-div-image">
<img width="671" height="553" src="images/chap4-175.gif" /></div>
<a id="pgfId-1207066"></a>The image rejection is 51.5dB.</li><li>
<a id="pgfId-1207067"></a>You can create tabular data from the results. In the waveform window, select the trace by clicking the legend on the left side of the graph area, clicking the right mouse button, and selecting <em>Send to</em><em> - </em><em>Table</em><em> - </em><em>New Window</em><em>.</em> <br /><strong class="webflare-fig-line-height">Figure 4-157
<a id="pgfId-1207053"></a>Sending Waveform Data to Table</strong>
<a id="pgfId-1105307"></a><div class="webflare-div-image">
<img width="660" height="443" src="images/chap4-176.gif" /></div>
<a id="pgfId-1105308"></a>A tabular table of data is displayed in a Virtuoso Visualization and Analysis XL Table window. You can scroll down to the frequencies of interest using the scroll bar on the right side of the table.<br /><strong>Figure 4-158
<a id="pgfId-1105309"></a>Tabular Data</strong>
<a id="pgfId-1249233"></a><div class="webflare-div-image">
<img width="658" height="759" src="images/chap4-177.gif" /></div></li></ol>




































































<p>
<a id="pgfId-1249234"></a>Close the <em>Direct Plot Form</em> and the waveform window.</p>

<h4>
<a id="pgfId-1249235"></a>Summary</h4>

<p>
<a id="pgfId-1207013"></a>In this section, you measured the voltage spectrum and image rejection on an up-converting double-balanced (transmit) mixer using hb analysis. In the next section, you will measure the third-order intercept.</p>

<h3>
<a id="pgfId-1207003"></a>Three Tone IP3</h3>

<p>
<a id="pgfId-1105323"></a>For transmitters, there might be an IP3 spec at a signal in the large-signal range. This will not be a small-signal projection, so the traditional HB/HBAC IP3 or rapid IP3 cannot be used for this measurement. Instead, multi tone HB or QPSS-HB would be appropriate. </p>
<p>
<a id="pgfId-1105324"></a>The simulation setup is nearly the same as the previous example. You only need to make a couple of modifications.</p>
<ol><li>
<a id="pgfId-1206994"></a>Open the hb <em>Choosing Analyses</em> form by double-clicking the <em>hb</em> line in ADE Explorer. The Choosing Analyses form is displayed, as shown below. <br /><strong class="webflare-fig-line-height">Figure 4-159
<a id="pgfId-1206995"></a>hb Choosing Analyses Form</strong>
<a id="pgfId-1206986"></a><div class="webflare-div-image">
<img width="668" height="797" src="images/chap4-178.gif" /></div></li><li>
<a id="pgfId-1206987"></a>Ensure that <em>Accuracy Defaults (errpreset)</em> is set to <em>conservative</em>. <em>conservative</em> is set because third and fifth-order intermodulation distortion will be calculated with this setup. Because these amplitudes are small, high accuracy is needed.</li><li>
<a id="pgfId-1206945"></a>In the <em>Tones</em> section, select the line containing one of the IF tones. For this measurement, you will again use <em>5</em> harmonics for the IF and IF2 tones.<br /><strong class="webflare-fig-line-height">Figure 4-160
<a id="pgfId-1206946"></a>Choosing Analyses Tones Section - Setting Mxham for IF Tones</strong>
<a id="pgfId-1206938"></a><div class="webflare-div-image">
<img width="668" height="216" src="images/chap4-179.gif" /></div></li><li>
<a id="pgfId-1206930"></a>When making an IP3 measurement using three large tones, you will need to do a power sweep. Click the <em>Sweep</em> button in the <em>Choosing Analyses</em> form. The form expands.</li><li>
<a id="pgfId-1206916"></a>In the <em>Sweep</em> section: <ol><li>
<a id="pgfId-1206912"></a>Set <em>Sweep</em> to <em>Variable</em>. </li><li>
<a id="pgfId-1206901"></a>For <em>Frequency Variable? </em>select <em>no</em>. You will be sweeping input power rather than frequency.</li><li>
<a id="pgfId-1206902"></a>Click the <em>Select Design Variable</em> button and choose <em>pif</em>. You will be sweeping the input power on the IF ports.<br /><strong class="webflare-fig-line-height">Figure 4-161
<a id="pgfId-1105346"></a>Select Design Variable Form</strong>
<a id="pgfId-1206896"></a><div class="webflare-div-image">
<img width="520" height="150" src="images/chap4-180.gif" /></div></li><li>
<a id="pgfId-1206897"></a><em>Click OK</em>.</li><li>
<a id="pgfId-1206898"></a>In the <em>Sweep Range </em>section, choose <em>Start-Stop</em> and sweep from <code>-14</code> to <code>-4</code>.</li><li>
<a id="pgfId-1206888"></a>Set the <em>Sweep Type</em> to <em>Linear</em> and <em>Step Size</em> to <code>1</code>. </li></ol><br />
<a id="pgfId-1206889"></a>The Sweep section of the form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-162
<a id="pgfId-1206890"></a>hb Choosing Analyses Form Sweep Section for 3 Tone IP3 Measurement.</strong>
<a id="pgfId-1206873"></a><div class="webflare-div-image">
<img width="668" height="343" src="images/chap4-181.gif" /></div></li><li>
<a id="pgfId-1206874"></a>The complete hb <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-163
<a id="pgfId-1206875"></a>hb Choosing Analyses Form for 3 Tone IP3</strong>
<a id="pgfId-1206833"></a><div class="webflare-div-image">
<img width="668" height="806" src="images/chap4-182.gif" /></div></li><li>
<a id="pgfId-1206834"></a>Click <em>OK</em> at the bottom of the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1206835"></a>The <em>Analyses</em> section of ADE Explorer must be as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-164
<a id="pgfId-1206817"></a>ADE Simulation Window</strong>
<a id="pgfId-1206796"></a><div class="webflare-div-image">
<img width="663" height="398" src="images/chap4-183.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1206797"></a>If you selected the <em>Add to Outputs</em> button in the <em>Direct Plot Form</em> in one of the earlier simulations, you will see the <em>Outputs</em> in the <em>Outputs</em> pane of the simulation window. <em>Deselect </em>the plot expressions in the <em>Outputs</em><em> </em>pane<em>.</em> If you do not, a family of spectral plots will be displayed when you plot the results. </div></li></ol>













































<p>
<a id="pgfId-1206743"></a>Run the simulation and plot the results, as follows:</p>
<ol><li>
<a id="pgfId-1206719"></a>Start the analyses by clicking the green arrow icon.<img width="21" height="21" src="images/chap4-184.gif" /><span> in ADE Explorer or in the Schematic Editor.</span><br />
<a id="pgfId-1206648"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.<br />
<a id="pgfId-1206639"></a>Next, you will plot the IP3 results.</li><li>
<a id="pgfId-1206640"></a>When the simulation has finished, in the ADE Explorer, select <em>Results - Direct Plot - Main Form.</em><br />
<a id="pgfId-1206529"></a>The<em> Direct Plot Form</em> is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-165
<a id="pgfId-1206530"></a>Harmonic Balance Direct Plot Form</strong>
<a id="pgfId-1206513"></a>. <div class="webflare-div-image">
<img width="668" height="760" src="images/chap4-185.gif" /></div></li><li>
<a id="pgfId-1206514"></a>In the <em>Direct Plot Form</em>, you will notice that there are two available analyses, <em>tstab</em> and <em>hb_mt</em>. The transient-assisted results are accessible by selecting the <em>tstab</em> analysis. The hb results are accessible by selecting the <em>hb_mt</em> analysis. Note that when there is more than one tone, you will see <em>hb_mt</em> (signifying harmonic balance multi-tone). A single tone simulation will show <em>hb</em>. In the <em>Analysis</em> Section, make sure that <code>hb_mt</code> is selected.<ol><li>
<a id="pgfId-1206486"></a>In the Function section select IPN Curves. <br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1206478"></a>You will be plotting Input IP3. Note that the N in IPN Curves is selectable an can be 2,3, 4, 5, 6, or 7.</div></li><li>
<a id="pgfId-1105396"></a>Select <em>Port(Fixed R(port))</em>.</li><li>
<a id="pgfId-1206437"></a>Set <em>Circuit Input Power</em> to <em>Variable Sweep (&#8220;pif&#8221;)</em>. You will be plotting output power vs. swept input power. <em>pif</em> is the swept power specified on the port</li><li>
<a id="pgfId-1206438"></a>Set the <em>Input Power Extrapolation Point</em> to <em>-9</em>. This is the power at which the circuit operates.</li><li>
<a id="pgfId-1105399"></a>Select <em>Output Referred IP3</em> and <em>Order 3rd</em> to plot input referred IP3.</li><li>
<a id="pgfId-1206430"></a>The main upconversion frequencies are at 1.904G and 1.905G. The third order intermodulation products are at 1.903G and 1.906G. Select the lowest amplitude first order term and the largest amplitude of the third order term.In this case, since both first order terms and both third order terms are almost identical in amplitude, it does not matter which first and third order terms are selected. Select <em>1.906G</em> for the third order term and <em>1.904G</em> for the first order term. Alternately, you can select <em>1.905G</em><code> </code>for the first order term and <em>1.903G</em><code> </code>for the third order term. </li><li>
<a id="pgfId-1206382"></a>Note that if you have more than one selection for any of the frequency terms (for example, the third-order term), you will want to select the correct one. To select the correct frequency, add the absolute value of the indices displayed for the desired frequency and choose the frequency with the lowest value. For example, for the two 1.903G, frequencies, you have <code>|1|+|2|+|-1|=4</code> and <code>|1|+|-3|+|3|=7</code>. You want to choose the first <em>1.903G</em> entry because adding the absolute value of the indices produces the lowest number.<br /><strong class="webflare-fig-line-height">Figure 4-166
<a id="pgfId-1105402"></a>Selecting the Correct 3rd Order Term When Plotting IP3</strong>
<a id="pgfId-1206367"></a><div class="webflare-div-image">
<img width="668" height="123" src="images/chap4-186.gif" /></div></li><li>
<a id="pgfId-1206368"></a>Similarly, you will need to choose the appropriate first order term. Note the selected <em>1.905G</em> entry. When adding the absolute value of the indices, it produces the lowest number.<br /><strong class="webflare-fig-line-height">Figure 4-167
<a id="pgfId-1216613"></a>Setting the Correct 1st Order Term when Plotting IP3</strong>
<a id="pgfId-1216617"></a><div class="webflare-div-image">
<img width="668" height="117" src="images/chap4-187.gif" /></div></li></ol>
<a id="pgfId-1216618"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-168
<a id="pgfId-1206344"></a>Direct Plot Form for Measuring IP3</strong>
<a id="pgfId-1172898"></a><div class="webflare-div-image">
<img width="668" height="805" src="images/chap4-188.gif" /></div></li><li>
<a id="pgfId-1105419"></a>Select the <em>Output</em> port on the schematic. <br /><strong class="webflare-fig-line-height">Figure 4-169
<a id="pgfId-1105423"></a>output port</strong>
<a id="pgfId-1172986"></a><div class="webflare-div-image">
<img width="668" height="258" src="images/chap4-189.gif" /></div>
<a id="pgfId-1206335"></a>The IP3 plot appears. Note that you can move the Input Referred IP3 label by clicking and holding the right mouse button and dragging the label to another part of the screen. You may need to first click in the graphics to deselect the IP3 marker.<br /><strong>Figure 4-170
<a id="pgfId-1206329"></a>Output Referred IP3</strong>
<a id="pgfId-1173051"></a><div class="webflare-div-image">
<img width="669" height="552" src="images/chap4-190.gif" /></div></li></ol>
















































<p>
<a id="pgfId-1288516"></a>The output referred IP3 is shown on the plot as <em>4.36dBm</em>. You can also plot input referred IP3 from the <em>Direct Plot Form</em> or read it directly off the x-axis. </p>
<p>
<a id="pgfId-1288517"></a>Close ADE Explorer and exit the Schematic Window, as follows<strong>:</strong></p>
<ol><li>
<a id="pgfId-1288518"></a>In ADE Explorer, choose <em>Session</em><em> - </em><em>Quit</em><em>.</em></li><li>
<a id="pgfId-1206300"></a>In the schematic window, choose <em>File</em><em> - </em><em>Close All</em><em>.</em></li></ol>


<h4>
<a id="pgfId-1206269"></a>Summary </h4>

<p>
<a id="pgfId-1206270"></a>In this section, you measured the three tone spectral content, image rejection, and output IP3 of a Transmit Mixer. In the next section, you will measure the Signal-to-Noise ratio of a Transmit Mixer.</p>

<h3>
<a id="pgfId-1206230"></a>Signal-to-Noise Ratio</h3>

<p>
<a id="pgfId-1206211"></a>The image reject mixer makes it possible to transmit one of the two sidebands (for example, <code>f2+f1</code> or <code>f2-f1</code>). The only way to achieve image rejection in both legs is to have a +/- 45 degree phase difference on the inputs. Typically, the DSP (digital signal processor) produces the 45 degree phase difference. Since we are not able to measure the noise figure directly on this circuit, we calculate the signal to noise ratio (SNR) instead. The inputs are set in order to mimic a balun. We cannot use a shifter combiner on the input (it is an RC circuit) because it would be too narrowband.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1206173"></a>That there will be no image rejection for noise because noise is random and has uncorrelated phase. The only image rejection is on the signals 4MHz and 5MHz. The bandwidth of the signal that will be transmitted is approx 10MHz. </div>
<p>
<a id="pgfId-1206160"></a>Open the <code>db_mixer_xmit</code> mixer circuit in the Schematic Window, as follows:<a id="Opening ne600p Schematic"></a></p>
<ol><li>
<a id="pgfId-1206161"></a>In the CIW, choose <em>File</em><em> &#8211; </em><em>Open</em>.<br />
<a id="pgfId-1206124"></a>The <em>Open File</em> form is displayed.</li><li>
<a id="pgfId-1206125"></a>In the Open File form, choose <em>ExampleLibRF</em> from the <em>Library</em> drop-down list. </li><li>
<a id="pgfId-1206115"></a>Choose <em>db_mixer_xmit</em> from the <em>Cells</em> list box.<br />
<a id="pgfId-1206095"></a>The completed <em>Open File</em> form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 4-171
<a id="pgfId-1206080"></a>Open File Form</strong>
<a id="pgfId-1105458"></a><div class="webflare-div-image">
<img width="613" height="340" src="images/chap4-191.gif" /></div></li><li>
<a id="pgfId-1206048"></a>Click <em>OK</em>.<br />
<a id="pgfId-1206049"></a>The Schematic window for the <em>db_mixer_xmit </em>mixer is displayed.<br /><strong class="webflare-fig-line-height">Figure 4-172
<a id="pgfId-1206050"></a>db_mixer_xmit Schematic</strong>
<a id="pgfId-1206038"></a><div class="webflare-div-image">
<img width="700" height="488" src="images/chap4-192.gif" /></div></li><li>
<a id="pgfId-1206039"></a>In the Schematic window, choose <em>Launch </em><em>&#8211; </em><em>ADE Explorer</em><em>.</em><br />
<a id="pgfId-1206031"></a>The Virtuoso Analog Design Environment Explorer window is displayed, as shown below. <br /><strong class="webflare-fig-line-height">Figure 4-173
<a id="pgfId-1206032"></a>Analog Design Environment Window</strong>
<a id="pgfId-1206013"></a><div class="webflare-div-image">
<img width="666" height="368" src="images/chap4-193.gif" /></div></li></ol>























<p>
<a id="pgfId-1206015"></a>Choosing the simulator o<a id="Choosing Simulator Options"></a>ptions, as follows:</p>
<ol><li>
<a id="pgfId-1206016"></a>In ADE Explorer, select <em>Setup &#8211; Simulator</em>.<br />
<a id="pgfId-1206006"></a>The <em>Choosing Simulator</em> is displayed.</li><li>
<a id="pgfId-1206007"></a>Select <em>spectre</em> as the <em>Simulator</em>.<br /><strong class="webflare-fig-line-height">Figure 4-174
<a id="pgfId-1205935"></a>Choosing Simulator/Director/Host Form</strong>
<a id="pgfId-1105491"></a><div class="webflare-div-image">
<img width="548" height="97" src="images/chap4-194.gif" /></div><ol><li>
<a id="pgfId-1205923"></a>Click <em>OK</em>.</li></ol></li><li>
<a id="pgfId-1205925"></a>Set up the <em>High Performance Simulation Options</em>, as follows:<br />
<a id="pgfId-1205920"></a>In ADE Explorer, select<em> </em><em>Setup - High Performance Simulation</em><em>.</em> The <em>High Performance Simulation Options</em> window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-175
<a id="pgfId-1205895"></a>High Performance Simulation Options</strong>
<a id="pgfId-1105501"></a><div class="webflare-div-image">
<img width="668" height="617" src="images/chap4-195.gif" /></div>
<a id="pgfId-1205887"></a>In the <em>High Performance Simulation</em> window, select <em>APS</em>. Note that <em>auto</em> is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. The bigger the circuit, the more threads you should use. For a small circuit such as this, you may want to set the number of threads to 2. Using 16 threads on a small circuit might actually slow things down because of the overhead associated with multithreading.<br />
<a id="pgfId-1205878"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1217139"></a>Select <em>Outputs</em><em> &#8211; </em><em>Save All</em><em>.</em><br />
<a id="pgfId-1217140"></a>The <em>Save Options</em> form is displayed.</li><li>
<a id="pgfId-1217141"></a>In the <em>Select signals to output</em><em> </em>section, make surethat <em>allpub</em> is selected.<br /><strong class="webflare-fig-line-height">Figure 4-176
<a id="pgfId-1205854"></a>Save Options Form</strong>
<a id="pgfId-1174078"></a><div class="webflare-div-image">
<img width="652" height="696" src="images/chap4-196.gif" /></div>
<a id="pgfId-1174067"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.</li><li>
<a id="pgfId-1205821"></a>Click <em>OK</em>.</li></ol>



























<p>
<a id="pgfId-1205823"></a>Set up the model l<a id="Setting Up Model Libs"></a>ibraries, as follows:</p>
<ol><li>
<a id="pgfId-1205824"></a>Select <em>Setup</em><em> - </em><em>Simulation Files</em><em>. </em>The Simulation Files Setup form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-177
<a id="pgfId-1205776"></a>Simulation Files Setup Form</strong>
<a id="pgfId-1205766"></a><div class="webflare-div-image">
<img width="628" height="386" src="images/chap4-197.gif" /></div></li><li>
<a id="pgfId-1205767"></a>Ensure that the <em>Include Path</em> is set as shown above.</li><li>
<a id="pgfId-1205768"></a>Select <em>Setup</em><em> &#8211; </em><em>Model Libraries</em><em>.</em><br />
<a id="pgfId-1205751"></a>The Model Library Setup form is displayed. </li><li>
<a id="pgfId-1205752"></a>In the <em>Model Library File</em> field, type the following for the name of the model file:<br /><pre class="webflare-pre-block webflare-courier-new" id="#id1205742">
<a id="pgfId-1205742"></a><code>models/modelsRF.scs</code></pre></li><li>
<a id="pgfId-1205717"></a> Click <em>OK</em>.<br />
<a id="pgfId-1205712"></a>The <em>Model Library Setup</em> form looks like the following.<br /><strong class="webflare-fig-line-height">Figure 4-178
<a id="pgfId-1105538"></a>Model Library Setup</strong>
<a id="pgfId-1174382"></a><div class="webflare-div-image">
<img width="656" height="248" src="images/chap4-198.gif" /></div>
<a id="pgfId-1105539"></a>Alternately, you can click on the <em>Browse</em> button and browse to the<code> modelsRF.scs </code>model file.</li><li>
<a id="pgfId-1105540"></a>Make sure that the <em>Model File</em> name is selected. </li><li>
<a id="pgfId-1205695"></a>Click <em>OK</em>.</li></ol>






















<p>
<a id="pgfId-1205697"></a><strong>Setting Up For Calculating Signal to Noise Ratio</strong></p>
<p>
<a id="pgfId-1205692"></a>To calculate signal to noise ratio, you first need to calculate the signal using a three-tone hb analysis. You will take the signal value at 1.904G (alternately, you could look at 1.905G) and note that value for later. Then, you will set up a pnoise analysis.</p>

<h3>
<a id="pgfId-1205676"></a>Three Tone HB Analysis Setup</h3>

<p>
<a id="pgfId-1205663"></a><strong>Setting the Design Variables</strong><a id="Setting Design Variables"></a></p>
<ol><li>
<a id="pgfId-1205664"></a>Ensure that your settings look like the following, in the Design Variables section of ADE Explorer:<br /><strong class="webflare-fig-line-height">Figure 4-179
<a id="pgfId-1205598"></a>Design Variables Section of ADE Explorer Window</strong>
<a id="pgfId-1174562"></a><div class="webflare-div-image">
<img width="327" height="164" src="images/chap4-199.gif" /></div></li></ol>





<p>
<a id="pgfId-1105556"></a>Setting Up the HB A<a id="PSS Analysis Only"></a>nalysis</p>
<ol><li>
<a id="pgfId-1288907"></a>In ADE Explorer, select <em>Analyses &#8211; Choose</em>. You can also select the <em>Choosing Analyses</em> icon (<img width="22" height="25" src="images/chap4-200.gif" /><span>) at the right of the ADE Explorer window. </span><br />
<a id="pgfId-1288911"></a>The <em>Choosing Analyses</em> form is displayed, as shown blow.<br /><p class="webflare-indent1"><strong>Figure 4-180
<a id="pgfId-1105562"></a>The Choosing Analyses Form</strong></p>
<a id="pgfId-1205577"></a>.<div class="webflare-div-image">
<img width="465" height="434" src="images/chap4-201.gif" /></div></li><li>
<a id="pgfId-1205578"></a>In the <em>Choosing Analyses form</em>, select <em>hb</em>. The form expands. Since the circuit is mostly sinusoidal (not strongly nonlinear) Harmonic Balance is the appropriate analysis to choose.<br /><strong class="webflare-fig-line-height">Figure 4-181
<a id="pgfId-1105568"></a>The HB Choosing Analyses Form </strong>
<a id="pgfId-1205556"></a>.<div class="webflare-div-image">
<img width="668" height="796" src="images/chap4-202.gif" /></div>
<a id="pgfId-1205557"></a>Harmonic balance can set the harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically </em>or <em>Yes</em> for the <em>Run Transient</em><em> </em>selection in the <em>Transient-Aided Options</em> section. This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for <em>Tone1</em><em> (</em>when <em>Frequencies</em> is selected) or for the tone that has <em>tstab</em> enabled (when <em>Names</em> is selected).</li><li>
<a id="pgfId-1205546"></a>In the Transient-Aided Options section of the form, select the following:<ol><li>
<a id="pgfId-1205547"></a>For <em>Run transient?</em> select <em>Decide automatically</em>.</li><li>
<a id="pgfId-1105576"></a>For <em>Stop time (tstab)</em>, <em>auto</em> is automatically populated in the field.</li><li>
<a id="pgfId-1105577"></a>For <em>Save Initial Transient Results (saveinit)</em>, select <em>yes</em>.</li></ol><br />
<a id="pgfId-1205541"></a>During the transient-assisted HB simulation, a transient simulation runs before the frequency domain iteration of harmonic balance. Only the LO signal is &#8220;on&#8221; during the <em>tstab</em> transient. At the end of the <em>tstab</em>, an FFT is run and its result is used as the starting point for the frequency domain iterations<br />
<a id="pgfId-1205542"></a>All the signals are applied and the simulation is done in the frequency domain. Only the signals and the mixing products are calculated by hb.<br /><strong class="webflare-fig-line-height">Figure 4-182
<a id="pgfId-1105583"></a>Transient Assisted Harmonic Balance</strong>
<a id="pgfId-1174855"></a><div class="webflare-div-image">
<img width="668" height="146" src="images/chap4-203.gif" /></div></li><li>
<a id="pgfId-1105584"></a>In the <em>Tones</em> section, select <em>Names</em>. When <em>Names</em> is selected, the <em>Tones</em> portion of the form expands. All the sources in the top-level schematic are read into the form automatically. </li><li>
<a id="pgfId-1205538"></a>Select one of the LO sources in the Tones section. You can use hb with up to four signals present in the circuit. In this circuit, there are three tones, the LO and two RF tones. The four LO signals have the same name, the same frequency, and are considered a single tone. Whenever you have two signals at the <em>same</em> frequency, make sure you set the <em>Frequency Name 1</em> or <em>Frequency Name 2</em> property on the source to the <em>same</em> name as it was done in this example. When <em>Tones</em> is set to <em>Names</em>, the simulator considers both of the sources as a single frequency.<br />
<a id="pgfId-1105591"></a>Because you are using auto-tstab, <em>Tstab</em> is set to <em>yes</em> by default in the <em>Tones</em> section for the LO tone. The signal with <code>tstab=yes</code> is the signal that is used for transient-assisted harmonic balance. Only one signal can have transient assist, that being the signal with <em>tstab</em> set to <em>yes</em>.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1105592"></a><em>tstab</em> is set to <em>yes</em> on the signal that causes the largest amount of distortion in the system. (In this example, that is the LO tone). </div>
<a id="pgfId-1105593"></a>During the tstab interval, a transient analysis is run before the frequency domain iteration of harmonic balance. At the end of the tstab, an FFT is run and its result is used as the starting point for the frequency domain iterations.<br />
<a id="pgfId-1205531"></a>Then all the signals are applied and the simulation is done in the frequency domain. Just the signals and the mixing products are calculated by hb.</li><li>
<a id="pgfId-1205535"></a>Because you are not using the auto-harmonics feature, you need to change the <em>Number of harmonics</em><em> </em>on the LO tone to <em>7</em>. Place the cursor in the field under <em>Mxham</em> and type <em>7</em><code>.</code> Verify that <em>tstab=yes</em> on the LO tone. Click the <em>Change</em> button. Note that all four LO sources are now updated with a <span class="webflare-courier-new" style="white-space:pre"><em>Mxham</em></span> of <em>7</em>. <br />
<a id="pgfId-1205522"></a>Typically, you want to use the auto-harmonic feature (type <em>auto</em> into this field).You will be using the manual method in this example to show how this is done. Leave <em>Ovsap</em> (oversample) set to the default value of <em>1</em>. </li><li>
<a id="pgfId-1205511"></a>Click the <em>Change</em> button when finished. The form updates. Note that the LO tones now have <em>Mxham=7</em> and <em>Tstab=yes</em>. <br /><strong class="webflare-fig-line-height">Figure 4-183
<a id="pgfId-1289023"></a>Tones Section of hb Choosing Analyses Form</strong>
<a id="pgfId-1289027"></a><div class="webflare-div-image">
<img width="668" height="265" src="images/chap4-204.gif" /></div></li><li>
<a id="pgfId-1205507"></a>Select the IF tone in the <em>Tones</em> list box. Change the <em>Mxham</em> setting on both <em>IF1</em> and <em>IF2</em> tones from the default value of <em>3</em> to <em>5</em>. In the <em>Tones</em> section, select the line containing one of the IF tones. For this measurement three IF harmonics is not enough. You will need to increase the number of IF tones for greater accuracy.</li><li>
<a id="pgfId-1105600"></a>Set <em>Accuracy Defaults (errpreset)</em><em> </em>to <em>conservative</em>. </li><li>
<a id="pgfId-1205495"></a>Leave the rest of the form set to the default values. <br />
<a id="pgfId-1205496"></a>The <em>Choosing Analyses</em> form should look like the following: <br /><strong class="webflare-fig-line-height">Figure 4-184
<a id="pgfId-1205497"></a>HB Choosing Analyses Form</strong>
<a id="pgfId-1175160"></a><div class="webflare-div-image">
<img width="492" height="759" src="images/chap4-205.gif" /></div></li><li>
<a id="pgfId-1105608"></a>Click <em>Apply</em> at the bottom of the <em>Choosing Analyses</em> form. <br />
<a id="pgfId-1105610"></a><strong>Setting Up the HBnoise Analysis</strong><br />
<a id="pgfId-1205476"></a>Set up the HB Noise simulation. You will be running an hbnoise simulation with the rf tones turned on.</li><li>
<a id="pgfId-1205477"></a>In the <em>Analysis</em> section select <em>hbnoise</em>. The form changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-185
<a id="pgfId-1205473"></a>hbnoise Choosing Analyses Form</strong>
<a id="pgfId-1105617"></a><div class="webflare-div-image">
<img width="659" height="674" src="images/chap4-206.gif" /></div></li><li>
<a id="pgfId-1105618"></a>The default <em>Sweeptype</em> should be left at <em>default</em>.</li><li>
<a id="pgfId-1205442"></a>In the <em>Output Frequency Sweep Range (Hz)</em> section, type <code>1.9G+1K </code>in the <em>Start</em> field and type <code>1.9G+1K+10M</code> in the <em>Stop</em> field. </li><li>
<a id="pgfId-1205443"></a>In the <em>Sweep Type</em><em> </em>section, select <em>Linear</em>. Type <code>9</code> in the <em>Number of Steps</em><em> </em>field. Choose a number which does not allow the simulator to take a step at any of hb harmonics to avoid getting <em>infinite flicker noise</em> warnings.</li><li>
<a id="pgfId-1205435"></a>Leave the <em>Maximum sideband</em><em> </em>field blank. In HBnoise, this value should either match the number of <em>harmonics</em> in HB analysis, or be left blank, in which case it uses the number of <em>harmonics</em> in HB.</li><li>
<a id="pgfId-1249926"></a>Select the <em>Noise Figure</em> option.</li><li>
<a id="pgfId-1217625"></a>In the <em>Output</em> section, select <em>probe</em>. Click <em>Select</em> to the right of the <em>Output Probe Instance</em> field In the schematic, click the source to the left of the <em>Output</em> label. Alternately, you can type <code>/PORT_out</code><em> </em>in the <em>Output Probe Instance</em> field.</li><li>
<a id="pgfId-1217626"></a>For<em> </em><em>Input Source</em>, select <em>none</em>. You only need to measure output noise and in this setup, you cannot measure noise figure.<br />
<a id="pgfId-1205388"></a>Hbnoise analysis fundamentally calculates the output-referred noise, and it is the output frequency range that is specified in the hbnoise <em>Choosing Analyses</em> form. Mixing can occur with harmonics of all the input frequencies, and to get this, leave the <em>Maximum sideband</em> field blank. The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-186
<a id="pgfId-1205379"></a>hbnoise Choosing Analyses form for Output Noise Measurement</strong>
<a id="pgfId-1175566"></a><div class="webflare-div-image">
<img width="668" height="760" src="images/chap4-207.gif" /></div></li></ol>





































































<h4>
<a id="pgfId-1205363"></a>Running the Simulation and Plotting the Results</h4>

<ol><li>
<a id="pgfId-1205367"></a>Start the analyses by clicking the green arrow icon.<img width="24" height="20" src="images/chap4-208.gif" /><span> in ADE Explorer or in the Schematic Editor.</span><br />
<a id="pgfId-1205360"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> log file). When the analysis has completed, you may iconify the status window.</li><li>
<a id="pgfId-1205344"></a>When the simulation has finished, select <em>Results</em><em> - </em><em>Direct Plot</em><em> - </em><em>Main Form</em><em> </em>in ADE Explorer. The <em>Direct Plot Form</em> is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-187
<a id="pgfId-1205256"></a>Harmonic Balance Direct Plot Form</strong>
<a id="pgfId-1205239"></a>.<div class="webflare-div-image">
<img width="668" height="348" src="images/chap4-209.gif" /></div>
<a id="pgfId-1205240"></a>In the <em>Direct Plot Form</em>, you will notice that there are three available analyses: <em>tstab</em>, <em>hb_mt</em>, and <em>hbnoise</em>. The transient-assisted results are accessible by selecting the <em>tstab</em> analysis. The hb results are accessible by selecting the <em>hb_mt</em> analysis. Note that when there is more than one tone, you will see <em>hb_mt</em> (signifying harmonic balance multi-tone). A single tone simulation will show <em>hb</em>. The hb results are accessed by selecting the <em>hbnoise</em> analysis.</li><li>
<a id="pgfId-1205218"></a>In the <em>Analysis</em> section, select <em>hb_mt</em>. The <em>Direct Plot Form</em> expands. </li><li>
<a id="pgfId-1205219"></a>In the <em>Function</em> section, verify that <em>Voltage</em> is selected.</li><li>
<a id="pgfId-1205198"></a>Select <em>Net.</em></li><li>
<a id="pgfId-1205199"></a>In the <em>Sweep</em> Section, select <em>spectrum</em>.</li><li>
<a id="pgfId-1205193"></a>In the <em>Signal Level </em>section, select <em>rms</em><code>.</code></li><li>
<a id="pgfId-1205194"></a>In the <em>Modifier</em> section, select <em>Magnitude</em>.<br />
<a id="pgfId-1205189"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 4-188
<a id="pgfId-1205159"></a>Direct Plot Form</strong>
<a id="pgfId-1105664"></a><div class="webflare-div-image">
<img width="668" height="655" src="images/chap4-210.gif" /></div></li><li>
<a id="pgfId-1205148"></a>Click on the net labeled <em>Output</em> on the right side of the schematic.</li><li>
<a id="pgfId-1205149"></a>The plot of Voltage Spectrum vs Frequency is displayed in the waveform window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-189
<a id="pgfId-1205145"></a>RMS Voltage vs Frequency</strong>
<a id="pgfId-1105671"></a><div class="webflare-div-image">
<img width="668" height="534" src="images/chap4-211.gif" /></div></li><li>
<a id="pgfId-1205140"></a>Zoom into the region of the graph near 1.9GHz. Press and hold the right mouse button while moving the cursor to draw a box around the signals near 1.9GHz. When you release the mouse, you are zoomed in. You may need to do this several times to get zoomed in to just the area around 1.9GHz.</li><li>
<a id="pgfId-1205137"></a>Place a marker at 1.904GHz (or 1.905GHz). Place the mouse over the 1.904G trace at the top and select the bindKey <t-times>
m</t-times>
 to place the marker. The rms voltage at 9.104G is 10.571431mV, as shown below.<strong><em> </em></strong>This is the <em>signal</em> part of the Signal-to-Noise ratio you will be calculating in the next step.<br /><strong class="webflare-fig-line-height">Figure 4-190
<a id="pgfId-1205122"></a>Zoomed in RMS Voltage vs Frequency </strong>
<a id="pgfId-1205126"></a><div class="webflare-div-image">
<img width="668" height="579" src="images/chap4-212.gif" /></div></li></ol>



































<p>
<a id="pgfId-1205128"></a><strong>Plotting the Noise Results</strong></p>
<ol><li>
<a id="pgfId-1205118"></a>When the simulation has finished, plot the<em> Voltage Spectrum </em>in <em>V/sqrt(Hz) </em>from the Results Browser. <br />
<a id="pgfId-1205119"></a>ADE Explorer, select <em>Tools</em><em> - </em><em>Results Browser</em><em>.</em> <br /><strong class="webflare-fig-line-height">Figure 4-191
<a id="pgfId-1205115"></a>Invoking the Results Browser After Simulation</strong>
<a id="pgfId-1205094"></a><div class="webflare-div-image">
<img width="668" height="306" src="images/chap4-213.gif" /></div>
<a id="pgfId-1205095"></a>Alternately, you can click the Results Browser icon in the Schematic, as shown below.<br />
<a id="pgfId-1205088"></a><div class="webflare-div-image">
<img width="224" height="71" src="images/chap4-214.gif" /></div></li><li>
<a id="pgfId-1105692"></a>In the Results Browser, select <em>hbnoise_mt</em>.<br /><strong class="webflare-fig-line-height">Figure 4-192
<a id="pgfId-1105693"></a>Selecting hbnoise results using the Results Browser</strong>
<a id="pgfId-1105697"></a><div class="webflare-div-image">
<img width="332" height="701" src="images/chap4-215.gif" /></div></li><li>
<a id="pgfId-1205077"></a>Double-click on the <em>hbnoise_mt</em> folder shown highlighted in the above figure. The folder expands. Click the right mouse button on the <em>out</em> signal, and select <em>Plot Signal</em> from the context menu, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-193
<a id="pgfId-1205065"></a>Selecting out Net in the Results Browser</strong>
<a id="pgfId-1105703"></a><div class="webflare-div-image">
<img width="594" height="643" src="images/chap4-216.gif" /></div></li><li>
<a id="pgfId-1205052"></a>Select and release the mouse over the <em>New Subwindow</em>. The Noise is plotted in<code> </code><em>V/sqrt(Hz),</em> as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-194
<a id="pgfId-1205053"></a>Noise Results</strong>
<a id="pgfId-1105709"></a><div class="webflare-div-image">
<img width="654" height="534" src="images/chap4-217.gif" /></div></li><li>
<a id="pgfId-1205049"></a>Note that the units are in <em>V/sqrt(Hz)</em>. You want to calculate the noise voltage in a 1Hz chunk of the spectrum. To do this, open the Calculator by clicking the right mouse button on the <em>out</em> signal in the Results Browser and selecting <em>Calculator</em>.<br /><strong class="webflare-fig-line-height">Figure 4-195
<a id="pgfId-1205031"></a>Sending Output Waveform to Calculator</strong>
<a id="pgfId-1205021"></a><div class="webflare-div-image">
<img width="668" height="640" src="images/chap4-218.gif" /></div>
<a id="pgfId-1205022"></a>The information is added in the Calculator Buffer, as shown below:<br /><strong>Figure 4-196
<a id="pgfId-1205023"></a>Output Noise Data Entered into Calculator Buffer</strong>
<a id="pgfId-1105721"></a><div class="webflare-div-image">
<img width="688" height="801" src="images/chap4-219.gif" /></div></li><li>
<a id="pgfId-1105722"></a>You want to look at the Noise Voltage over a 1 Hz bandwidth. <br />
<a id="pgfId-1204983"></a>In the Calculator you need to square the voltage to get it in units of power. <code>P=V2/R</code>, where R is some arbitrary value. <br />
<a id="pgfId-1290203"></a>In the lower part of the Calculator, in the <em>Function Panel</em> section, ensure that <em>All</em> is selected from the drop-down and select<em> </em><em>x**2</em>. The Calculator Buffer updates, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-197
<a id="pgfId-1204980"></a>Squaring the Noise Voltage</strong>
<a id="pgfId-1105728"></a><div class="webflare-div-image">
<img width="668" height="640" src="images/chap4-220.gif" /></div></li><li>
<a id="pgfId-1204975"></a>Next, you need to integrate the power over bandwidth. Select the <em>integ</em> function from the <em>Function Panel</em>. The form changes. You are integrating the power from <code>1K</code> to <code>10M</code> (these are the same values that were in the hbnoise <em>Choosing Analyses</em> form).</li><li>
<a id="pgfId-1204976"></a>Verify that the signal is automatically populated in the <em>Signal </em>field<em>. </em>If it is not auto-populated, enter <code>1.9G+1K </code>as the<em> </em><em>Initial Value </em>and<code> </code>1.9G+1K+10M as the <em>Final Value</em>. <br />
<a id="pgfId-1290270"></a>Note that this is the same range used in the hbnoise <em>Choosing Analyses</em> form.<br /><strong class="webflare-fig-line-height">Figure 4-198
<a id="pgfId-1204968"></a>Integrating the Squared Noise Voltage over a 1Hz Bandwidth.</strong>
<a id="pgfId-1204962"></a><div class="webflare-div-image">
<img width="648" height="448" src="images/chap4-221.gif" /></div></li><li>
<a id="pgfId-1204963"></a>Click <em>OK</em>. The Calculator buffer is updated, as shown in the figure below.<br /><strong class="webflare-fig-line-height">Figure 4-199
<a id="pgfId-1204964"></a>Integrating the Noise Power over a 1Hz Bandwidth </strong>
<a id="pgfId-1105741"></a><div class="webflare-div-image">
<img width="668" height="337" src="images/chap4-222.gif" /></div></li><li>
<a id="pgfId-1204956"></a>Finally, you need to take the square root of the expression in the buffer to put it back into terms of voltage. Click on the <em>sqrt</em> function in the <em>Function Panel. </em>The calculator buffer looks like the figure below:<br /><strong class="webflare-fig-line-height">Figure 4-200
<a id="pgfId-1105743"></a>Integrated Noise Voltage</strong>
<a id="pgfId-1105747"></a><div class="webflare-div-image">
<img width="668" height="321" src="images/chap4-223.gif" /></div></li><li>
<a id="pgfId-1204949"></a>Click the Table icon (<img width="30" height="28" src="images/chap4-224.gif" /><span>)to evaluate the Calculator buffer contents and display the results in a table, as shown below:</span><br /><p class="webflare-indent1"><strong>Figure 4-201
<a id="pgfId-1204950"></a>Evaluating the Calculator Buffer</strong></p>
<a id="pgfId-1204943"></a><div class="webflare-div-image">
<img width="666" height="316" src="images/chap4-225.gif" /></div></li><li>
<a id="pgfId-1105756"></a>The result is sent to the Table, as shown below.<br /><strong class="webflare-fig-line-height">Figure 4-202
<a id="pgfId-1105757"></a>Calculating Integrated Noise Voltage Using the Table Icon.</strong>
<a id="pgfId-1105761"></a><div class="webflare-div-image">
<img width="666" height="182" src="images/chap4-226.gif" /></div></li></ol>
















































































<p>
<a id="pgfId-1105762"></a>Alternately, if you click the <em>Plot</em> icon, the value for noise voltage appears in the Calculator buffer, as shown below.</p>

<p class="webflare-indent1"><strong>Figure 4-203
<a id="pgfId-1105763"></a>Calculating Integrated Noise Voltage Using the Plot icon</strong></p>
<p class="webflare-indent1">
<a id="pgfId-1105767"></a></p>
<div class="webflare-div-image">
<img width="658" height="297" src="images/chap4-227.gif" /></div>

<p>
<a id="pgfId-1105768"></a>The Noise voltage is 3.122E-6 Volts.</p>
<p>
<a id="pgfId-1204932"></a>Now you are ready to calculate the Signal to Noise ratio (SNR). You first plotted the rms Voltage (from a three-tone harmonic balance simulation) at 1.904G to be&#160;&#160;10.57134mV. Next, you divide the Signal by the Noise to get the SNR.</p>
<p>
<a id="pgfId-1105774"></a></p>

<div class="webflare-div-image">
<img width="652" height="64" src="images/chap4-228.gif" /></div>

<p>
<a id="pgfId-1105775"></a>To get the SNR in dB at 1.904GHz, take the log of the SNR value and multiple by 20. </p>
<p>
<a id="pgfId-1105780"></a></p>

<div class="webflare-div-image">
<img width="652" height="27" src="images/chap4-229.gif" /></div>

<p>
<a id="pgfId-1105781"></a>You can easily do this in the Calculator using the <em>dB20</em> Math function, as shown below.</p>

<p class="webflare-indent1"><strong>Figure 4-204
<a id="pgfId-1105785"></a>Using the dB20 Math Function</strong></p>
<p class="webflare-indent1">
<a id="pgfId-1204921"></a></p>
<div class="webflare-div-image">
<img width="668" height="522" src="images/chap4-230.gif" /></div>

<p>
<a id="pgfId-1204925"></a>Click the <em>Plot</em> button (<img width="25" height="24" src="images/chap4-231.gif" />
). This gives 70.59dB.</p>


<p>
<a id="pgfId-1204926"></a>Note that the SNR is fairly high. </p>

<h3>
<a id="pgfId-1204903"></a>Summary</h3>

<p>
<a id="pgfId-1204904"></a>The Mixer section showed how to simulate and make typical measurements on a receiver mixer and a transmit mixer. </p>
<p>
<a id="pgfId-1105794"></a>In the Receive Mixer Measurement section, the following measurements were shown:</p>
<ul><li>
<a id="pgfId-1105795"></a>Mixer Conversion Gain using hb and hbac analyses</li><li>
<a id="pgfId-1105796"></a>LO to IF leakage using hb analysis</li><li>
<a id="pgfId-1204898"></a>Noise Figure measurements using hb and hbnoise analyses</li><li>
<a id="pgfId-1204899"></a>1dB compression point, desensitization, and blocking using hb, hbac, and hbnoise</li><li>
<a id="pgfId-1204900"></a>Third-Order Intercept measurement using three-tone harmonic balance</li><li>
<a id="pgfId-1204895"></a>Rapid IP2 and Rapid IP3 using specialized hbac analysis</li><li>
<a id="pgfId-1105801"></a>Compression Distortion Summary using hb and specialized hbac analysis.</li></ul>






<p>
<a id="pgfId-1105802"></a>In the Transmit Mixer Measurement section, the following measurements were shown:</p>
<ul><li>
<a id="pgfId-1204863"></a>Image rejection using hb analysis.</li><li>
<a id="pgfId-1204864"></a>Three-tone swept IP3 (large signal) using multi-tone hb analysis.</li><li>
<a id="pgfId-1204865"></a>Signal-to-Noise Ratio using the hb and hbnoise analyses.</li></ul>


<p>
<a id="pgfId-1204854"></a>For more information on simulating Mixers, please refer to the chapters in this user guide and the <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory Guide</a></em>.</p>

<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="chap3.html" id="prev" title="Simulating Oscillators">Simulating Oscillators</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2020, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>