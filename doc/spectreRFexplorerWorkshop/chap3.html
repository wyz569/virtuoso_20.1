
<html><head><title>Simulating Oscillators</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2020-01-08" />
<meta name="CreateTime" content="1578555375" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Provides user information for Virtuoso Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis" />
<meta name="DocTitle" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer Workshop" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Simulating Oscillators" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.1" />
<meta name="Keyword" content="spectreRFexplorerWorkshop" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2020-01-08" />
<meta name="ModifiedTime" content="1578555375" />
<meta name="NextFile" content="chap4.html" />
<meta name="Group" content="SpectreRF" />
<meta name="Platform" content="Custom IC Design" />
<meta name="PrevFile" content="chap2.html" />
<meta name="Product" content="Spectre" />
<meta name="ProductFamily" content="Spectre" />
<meta name="ProductVersion" content="19.1" />
<meta name="RightsManagement" content="Copyright 2012-2020 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer Workshop -- Simulating Oscillators" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="product_feature" content="" />
<meta name="product_subfeature" content="" />
<meta name="Version" content="19.1" />
<meta name="SpaceKey" content="spectreRFexplorerWorkshop191" />
<meta name="webflare-version" content="1.4" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="spectreRFexplorerWorkshopTOC.html">Contents</a></li><li><a class="prev" href="chap2.html" title="Simulating Low Noise Amplifiers">Simulating Low Noise Amplifier ...</a></li><li style="float: right;"><a class="viewPrint" href="spectreRFexplorerWorkshop.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="chap4.html" title="Simulating Mixers">Simulating Mixers</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer Workshop<br />Product Version 19.1, January 2020</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>3
<a id="pgfId-1065082"></a></h1>
<h1>
<a id="pgfId-1065083"></a><hr />
Simulating Oscillators<hr />
</h1>

<p>
<a id="pgfId-1092661"></a>Oscillators, which are autonomous circuits, are time-invariant circuits with time-varying responses. Thus, autonomous circuits generate non-constant waveforms even though they are not driven by a time-varying stimulus. </p>
<p>
<a id="pgfId-1092662"></a>You cannot specify the analysis period for autonomous circuits because you do not know the precise oscillation period in advance of the simulation. Instead, you specify an estimate of the oscillation period for the simulation. The PSS analysis uses your estimate to compute the precise period and the periodic solution waveforms.</p>
<p>
<a id="pgfId-1092663"></a>In the first section of this topic we will concentrate on simulating oscillators as autonomous circuits using mainly Harmonic Balance (HB) method. In the second section we will simulate and do measurements on Ring Oscillator using Shooting method.</p>
<p>
<a id="pgfId-1092664"></a>Note that there are oscillators like injection locked ring oscillators which are simulated as driven circuits instead of autonomous circuits. However, this class of oscillators will not be discussed.</p>
<p>
<a id="pgfId-1092724"></a>You will do the following measurements while doing the Oscillator simulation -</p>
<table class="webflareTable" id="#id1092665">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1092667">
<a id="pgfId-1092667"></a>Measurements</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1092669">
<a id="pgfId-1092669"></a>Analysis</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092675"></a><a href="chap3.html#"></a><a href="chap3.html#96080"></a><a href="chap3.html#"><h-hot>Starting and Stabilizing Feedback Oscillators</h-hot></a></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092677"></a>PSS - HB</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092682"></a><a href="chap3.html#48693">Oscillator Loop Gain Measurement</a> </p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092684"></a>PSS - Shooting, Pstb and stb</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092688"></a><a href="chap3.html#26632">Phase Noise Measurement and Noise Summary Table</a></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092691"></a>HB/HBnoise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092695"></a><a href="chap3.html#92864">Oscillator Swept Tuning Range and Phase Noise Measurement</a>  </p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092698"></a>HB/HBnoise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092700"></a>Ring Oscillator Measurements</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092702"></a></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092707"></a><a href="chap3.html#56103">Starting and Stabilization of Ring Oscillators</a></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092709"></a>PSS - Shooting/tstab</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092713"></a><a href="chap3.html#92289">FM Jitter Measurement using PSS Shooting and Pnoise Jitter Analyses</a></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092716"></a>PSS - Shooting/Pnoise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092720"></a><a href="chap3.html#13224">Calculating the Swept Tuning Range and Phase Noise for the Ring Oscillator</a></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1092723"></a>PSS - Shooting/Pnoise</p>
</td>
</tr>
</tbody></table>

<h2>
<a id="pgfId-1212046"></a>Simulation Methods</h2>

<p>
<a id="pgfId-1212047"></a>There are two methods you can use to simulate oscillators using SpectreRF:</p>
<ul><li>
<a id="pgfId-1212048"></a>Harmonic Balance (HB)</li><li>
<a id="pgfId-1092728"></a>Shooting Newton</li></ul>

<p>
<a id="pgfId-1092729"></a>The Harmonic Balance method is recommended for simulating mildly-nonlinear oscillators with resonators, such as LC oscillators and crystal oscillators. Shooting PSS method is recommended for simulating strongly nonlinear resonatorless oscillators, such as ring oscillators or relaxation oscillators.</p>

<h2>
<a id="pgfId-1092730"></a>Phases of Autonomous PSS/HB Analysis</h2>

<p>
<a id="pgfId-1212037"></a>A PSS/HB analysis has two or three phases.</p>
<ol><li>
<a id="pgfId-1212038"></a>If the Calculate initial conditions (ic) automatically check box is selected, then after the DC analysis for the time-zero timepoint has been calculated, the oscillator frequency and amplitude are estimated. The beginning of the transient analysis in the tstab interval includes this estimate.</li><li>
<a id="pgfId-1092733"></a>A transient analysis phase to initialize the circuit.<br />
<a id="pgfId-1092734"></a>The transient analysis phase is divided into three intervals:<ol><li>
<a id="pgfId-1092735"></a>A beginning interval that starts at <em>tstart</em>, which is normally 0, and continues through the onset of periodicity for the independent sources and continues through the longest delay time of the periodic sources, or the last point in a PWL waveform, whichever is the longest.</li><li>
<a id="pgfId-1092736"></a>A stabilization interval of length <em>tstab</em><br />
<a id="pgfId-1092737"></a>In the hb <em>Choosing Analyses</em> form, you have the option to have Spectre automatically calculate the length needed for tstab.<br />
<a id="pgfId-1092738"></a>For driven circuits, the stabilization interval is optional. For autonomous circuits, <em>tstab</em> needs to be set to an interval that provides the circuit a good initial condition.</li><li>
<a id="pgfId-1092739"></a>A final interval that is four times the estimated oscillation period specified in the PSS/HB <em>Choosing Analyses</em> form. During the final interval, the PSS/HB analysis monitors the waveforms in the circuit and improves the estimate of the oscillation period. During this final interval, Spectre looks for frequency divider outputs in the circuit.</li></ol></li><li>
<a id="pgfId-1092740"></a>A Shooting or Harmonic Balance phase to compute the periodic steady state solution<br />
<a id="pgfId-1092741"></a>During this phase, the circuit is iterated repeatedly over one period. The length of the period and the initial conditions are modified to find the steady state solution.</li></ol>











<p>
<a id="pgfId-1092743"></a>See <em>Oscillators and Autonomous PSS Analysis</em> in <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a></em> for more information on the autonomous PSS analysis algorithm.</p>

<h2>
<a id="pgfId-1092746"></a>Phase Noise and <a id="marker-1092745"></a>Oscillators</h2>

<p>
<a id="pgfId-1092747"></a>Oscillators tend to amplify any noise present near the oscillation frequency. The closer the noise frequency is to the oscillation frequency, the greater the noise amplification. Noise amplified by the oscillator in this manner is called <em>phase noise</em>. Phase noise is the most significant source of noise in oscillators, and because phase noise is centered about the oscillation frequency, filtering can never completely remove it.</p>
<p>
<a id="pgfId-1092748"></a>You can understand phase noise if you recognize that the phase of an oscillator is arbitrary because there is no drive signal to lock to. Any waveform that is a solution to an oscillator can be shifted in time and still be a solution. If a perturbation disturbs the phase, nothing restores the phase, so it drifts without bound. If the perturbation is random noise, the drift is a random walk. In addition, the closer the perturbation frequency is to the oscillation frequency, the better it couples to the phase and the greater the drift. The perturbation need not come from random noise. Noise might also couple into the oscillator from other sources, such as the power supplies.</p>

<h2>
<a id="pgfId-1092751"></a><a id="96080"></a>Starting and Stabilizing Feedback O<a id="marker-1092750"></a>scillators</h2>

<p>
<a id="pgfId-1212033"></a>To simulate an oscillator using either HB or Shooting PSS analysis, you must first start the oscillator by supplying either of the following:</p>
<ol><li>
<a id="pgfId-1212034"></a>A brief impulse stimulus<br />
<a id="pgfId-1092754"></a>The stimulus should couple strongly into the oscillatory mode of the circuit and poorly into other long-lasting modes such as bias circuitry. This is usually done by adding a single pulse of current that is connected somewhere in the circuit to start the oscillations.</li><li>
<a id="pgfId-1092755"></a>A set of initial conditions (ICs) for the components of the oscillator&#8217;s resonator.</li><li>
<a id="pgfId-1092756"></a>For LC and High Q oscillators, you can select the Calculate initial conditions (ic) automatically checkbox in the <em>Choosing Analyses</em> form instead of providing any stimulus or initial condition (ic).<br />
<a id="pgfId-1092757"></a>This setting tells Spectre to do a variation of the linear stability analysis just before the beginning of the tstab interval. It provides a good estimate of the oscillation frequency amplitude and phase at the beginning of the tstab interval. With a start that is very close, convergence is much easier. <br />
<a id="pgfId-1092758"></a>Note that when you set this option then ICs (initial conditions) are automatically ignored.</li></ol>





<p>
<a id="pgfId-1092759"></a>Regardless of which technique you use to start the oscillator, allow the oscillator to run long enough to stabilize before you start the HB or Shooting phase and compute the steady state solution. Adjust the <em>tstab</em> parameter to supply the additional stabilization period. High Q oscillators often need a longer tstab. For extremely high Q circuits, you may need to set tstab to about 50K to 200K periods of oscillation with the default method. However, when setting Calculate initial conditions (ic) automatically option you may reduce it to just 10 periods.</p>
<p>
<a id="pgfId-1092760"></a>In HB, if you set Run transient to Decide automatically then you do not need to provide any tstab value and the simulator automatically decides how long to run the transient analysis to compute the steady state solution. Also, in HB, while setting the tstab value, you can select the Detect Steady State checkbox if you want the transient analysis to stop automatically as soon as the steady state is reached rather than runningthe transient analysis for the whole tstab value.</p>
<p>
<a id="pgfId-1092761"></a>It is recommended to save the initial transient simulation results. This can be done by setting the <em>Save Initial Transient Results (saveinit)</em> option to <em>yes</em>. You can use this to verify that the oscillator has started up and is stable.</p>
<p>
<a id="pgfId-1092763"></a>See <em>Oscillators and Autonomous PSS Analysis</em> in the <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a></em> for more information on oscillator simulation. In addition to this you may also refer to <em>Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide</em>.</p>

<h2>
<a id="pgfId-1092765"></a>The Oscillator Circuit</h2>

<p>
<a id="pgfId-1092766"></a>This example computes the periodic steady state solution and the phase noise for the <em>RF oscillator </em>circuit, as shown in Figure <a href="chap3.html#29937">3-1</a>.</p>

<p><strong>Figure 3-1
<a id="pgfId-1096908"></a><a id="29937"></a>Schematic for the Oscillator Circuit oscillator_ckt</strong></p>
<div class="webflare-div-image">
<img width="668" height="286" src="images/chap3-2.gif" /></div>
<h2>
<a id="pgfId-1092778"></a>Setting Up to Simulate the Oscillator Circuit</h2>
<h4>
<a id="pgfId-1092781"></a><a id="21477"></a>Opening the Oscillator Circuit in the Schematic Window<a id="OpeningTline3oscRF"></a></h4>

<ol><li>
<a id="pgfId-1092783"></a>In the Command Interpreter Window (CIW), choose <em>File</em><em> &#8211; </em><em>Open</em>.<br /><strong class="webflare-fig-line-height">Figure 3-2
<a id="pgfId-1092787"></a>Virtuoso CIW Window - Opening Cellview</strong><div class="webflare-div-image">
<img width="574" height="222" src="images/chap3-3.gif" /></div>
<a id="pgfId-1092788"></a>The <em>Open File</em> form is displayed. </li><li>
<a id="pgfId-1092789"></a>Select <em>ExampleLibRF </em>from the <em>Library</em> drop-down list.</li><li>
<a id="pgfId-1092790"></a>In the <em>Cells </em>list box, choose <em>oscillator_ckt</em>.</li><li>
<a id="pgfId-1092791"></a>Select <em>schematic</em> from the <em>View drop-down list</em>.</li><li>
<a id="pgfId-1092792"></a>In the Application section, select Schematic-L from the <em>Open with</em> drop-down list.</li><li>
<a id="pgfId-1092793"></a>Leave Open For to edit (which is set by default).<br /><strong class="webflare-fig-line-height">Figure 3-3
<a id="pgfId-1092794"></a>Open File Form to open the oscillator_ckt cell&#8217;s Schematic View</strong><div class="webflare-div-image">
<img width="668" height="403" src="images/chap3-4.gif" /></div></li><li>
<a id="pgfId-1212029"></a>Click <em>OK</em> to close the Open File form.</li><li>
<a id="pgfId-1212030"></a>This will open <em>oscillator_ckt</em> schematic in Virtuoso Schematic Editor L window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-4
<a id="pgfId-1092805"></a>oscillator_ckt schematic in VSE-L Window</strong><div class="webflare-div-image">
<img width="660" height="377" src="images/chap3-5.gif" /></div></li></ol>




















<p>
<a id="pgfId-1092806"></a>This example computes the periodic steady state solution for the <em>oscillator_ckt RF</em> oscillator circuit. You perform a <code>PSS-HB</code> or HB analysis first because the periodic steady state solution must be determined before you can perform any other periodic small-signal analysis like pstb or hbnoise etc. to determine the stability or phase noise.</p>

<h3>
<a id="pgfId-1092807"></a>Setting up ADE Explorer for Oscillator Simulation</h3>

<ol><li>
<a id="pgfId-1092808"></a>In the Schematic Window, choose <em>Launch</em> - ADE Explorer.<br /><strong class="webflare-fig-line-height">Figure 3-5
<a id="pgfId-1265578"></a>Opening ADE Explorer from VSE L window</strong><div class="webflare-div-image">
<img width="663" height="402" src="images/chap3-6.gif" /></div></li><li>
<a id="pgfId-1265640"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1265641"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-6
<a id="pgfId-1265684"></a>Create new ADE Explorer view</strong><div class="webflare-div-image">
<img width="613" height="345" src="images/chap3-7.gif" /></div></li><li>
<a id="pgfId-1265689"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1265702"></a>The Virtuoso ADE Explorer window is displayed, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-7
<a id="pgfId-1265594"></a>Virtuoso ADE Explorer Window</strong><div class="webflare-div-image">
<img width="662" height="374" src="images/chap3-8.gif" /></div></li><li>
<a id="pgfId-1097316"></a>Choose <em>Setup</em> &#8211; <em>Simulator</em> in ADE Explorer.<br />
<a id="pgfId-1097318"></a>The Choosing Simulator form appears.</li><li>
<a id="pgfId-1092823"></a>Choose <em>spectre</em> for the Simulator.<br /><strong class="webflare-fig-line-height">Figure 3-8
<a id="pgfId-1092831"></a>Choosing Simulator Form</strong><div class="webflare-div-image">
<img width="610" height="96" src="images/chap3-9.gif" /></div></li><li>
<a id="pgfId-1092833"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1092835"></a>Set up the High Performance Simulation Options.<br />
<a id="pgfId-1092836"></a>In the ADE window, choose <em>Setup</em> - <em>High Performance Simulation</em>. The High Performance Simulation Options window is displayed.<br />
<a id="pgfId-1092837"></a>In the High Performance Simulation Options window, select <em>APS</em>. Note that <em>Auto</em> is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. Usually, it is better to specify the number of threads yourself.  Small circuits should use a small number of threads, and larger circuits can use more threads. The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.<br /><strong class="webflare-fig-line-height">Figure 3-9
<a id="pgfId-1092841"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="665" height="572" src="images/chap3-10.gif" /></div></li><li>
<a id="pgfId-1092842"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1092843"></a>Select <em>Outputs</em> &#8211; <em>Save All</em>.<br />
<a id="pgfId-1092844"></a>The <em>Save Options</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-10
<a id="pgfId-1092849"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="655" height="665" src="images/chap3-11.gif" /></div></li><li>
<a id="pgfId-1212021"></a>In the Select signals to output section, ensure allpub is highlighted.<br />
<a id="pgfId-1212022"></a>This is the default which saves all node voltages at all levels of hierarchy, but it does not include the node voltages inside the device models.</li><li>
<a id="pgfId-1097759"></a>To save the currents, choose <em>nonlinear</em> for the <em>Select device currents (currents) </em>option, if you just want to save the device currents, or choose <em>all</em> if you want to save all the currents in the circuit. When you save the currents, more disk space is required for the results file.</li><li>
<a id="pgfId-1212011"></a>Click OK.</li><li>
<a id="pgfId-1212012"></a>Select <em>Setup</em> - <em>Simulation</em> <em>Files.</em><br />
<a id="pgfId-1212013"></a>The <em>Simulation Files Setup</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-11
<a id="pgfId-1212014"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="665" height="347" src="images/chap3-12.gif" /></div></li><li>
<a id="pgfId-1097868"></a>Select <em>./</em> by clicking in the <em>Include Paths</em> section.</li><li>
<a id="pgfId-1092861"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1092862"></a>In ADE Explorer, select <em>Setup</em> &#8211; <em>Model Libraries</em><br />
<a id="pgfId-1092863"></a>The <em>Model Library Setup</em> form is displayed.</li><li>
<a id="pgfId-1092864"></a>In the Model File field, type the path to the model file including the file name, such as <em>models/modelsRF.scs</em>.<br /><strong class="webflare-fig-line-height">Figure 3-12
<a id="pgfId-1092869"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="680" height="259" src="images/chap3-13.gif" /></div>
<a id="pgfId-1092870"></a>You can also browse to <em>modelsRF.scs</em> file. </li><li>
<a id="pgfId-1092871"></a>Click OK.</li></ol>




























































<h2>
<a id="pgfId-1092873"></a>Calculating the Steady-State Solution using PSS Harmonic Balance</h2>

<p>
<a id="pgfId-1092874"></a>In this very first measurement, you will set up the PSS analysis and then determine the oscillation frequency of the oscillator. You will use the Harmonic Balance Engine in the PSS Analysis. You can also use hb analysis directly. Here, we have chosen PSS analysis with Harmonic Balance Engine because you will perform pstb analysis in the next measurement. Since there is no corresponding hbstb analysis available for hb analysis, this setup is done.</p>

<h3>
<a id="pgfId-1092875"></a>Setting up the PSS Analysis</h3>

<ol><li>
<a id="pgfId-1092876"></a>Select <em>Analyses</em> &#8211;&gt; <em>Choose</em> in the Virtuoso Analog Design Environment window.<br />
<a id="pgfId-1092877"></a>The Choosing Analyses form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-13
<a id="pgfId-1092881"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="481" height="485" src="images/chap3-14.gif" /></div><ol><li>
<a id="pgfId-1092882"></a>Select pss as Analysis. The form expands.<br /><strong class="webflare-fig-line-height">Figure 3-14
<a id="pgfId-1092883"></a>The Choosing Analyses Form- Setting PSS Analysis</strong><div class="webflare-div-image">
<img width="377" height="729" src="images/chap3-15.gif" /></div></li><li>
<a id="pgfId-1092889"></a>Select Harmonic Balance as Engine.</li><li>
<a id="pgfId-1092890"></a>In the Beat Frequency field, type 1.9G. The frequency entered here is an approximate frequency of oscillation. </li><li>
<a id="pgfId-1119179"></a>Leave Oversample Factor (oversamplefactor) blank, which means that the Oversample Factor is equal to 1. Since the oscillator has sinusoidal waveforms, an oversample of 1 is appropriate. </li><li>
<a id="pgfId-1119180"></a>In the Number of harmonics field, type 15.<br />
<a id="pgfId-1092893"></a>In general, you want to choose a number that is high enough to capture the nonlinearity of the circuit. Start with 10, and run the simulation. Increase by about 50% to 15 and re-run the simulation. If the harmonics do not change appreciably, then 10 is enough. If they change, increase the number again by about 50%. Use the smallest number of harmonics for the answer to be stable.</li><li>
<a id="pgfId-1266354"></a>In the Accuracy Defaults (errpreset) section, select conservative. conservative is typically used because very small amplitude phase noise measurements are normally desired. Conservative is recommended for all the oscillators.</li><li>
<a id="pgfId-1266355"></a>Type 5n in the Additional Time for Transient-Aided HB (tstab) field. tstab is typically set to about 10 to 20 periods of the oscillation frequency when the Calculate initial conditions (ic) automatically checkbox is selected. </li><li>
<a id="pgfId-1092896"></a>Select yes for <em>Save Initial Transient Results</em>. This will help in visualizing the buildup of the oscillation waveform.</li><li>
<a id="pgfId-1119297"></a>Leave the Harmonic Balance Homotopy Method as default which is tone. HbHomotopy (hbhomotopy) is one of the HB Convergence Options which helps in the convergence of the simulation of circuit.<br />
<a id="pgfId-1119298"></a>You can refer to the earlier chapters for more details.</li><li>
<a id="pgfId-1119299"></a>Select Oscillator. This is required for simulating an autonomous circuit.<br /><strong class="webflare-fig-line-height">Figure 3-15
<a id="pgfId-1092903"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="467" height="172" src="images/chap3-16.gif" /></div></li><li>
<a id="pgfId-1092905"></a>In the Oscillator node field, click Select just to the right. In the schematic, select the collector node. This oscillator node will be used by the simulator for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it.<br /><strong class="webflare-fig-line-height">Figure 3-16
<a id="pgfId-1092909"></a>Selecting collector net on oscillator_ckt schematic</strong><div class="webflare-div-image">
<img width="388" height="270" src="images/chap3-17.gif" /></div></li><li>
<a id="pgfId-1092910"></a>If you have an LC oscillator, leave the Calculate initial conditions (ic) automatically checkbox selected (this is the default).<br />
<a id="pgfId-1092911"></a>Note that Calculate initial conditions (ic) automatically is used to start the oscillator. Other methods to start the oscillator include putting a single current pulse into the resonator, setting initial conditions(ic), or ramping up the power at time = zero plus.<br /><strong class="webflare-fig-line-height">Figure 3-17
<a id="pgfId-1092915"></a>Choosing Analyses Form - PSS-Harmonic Balance Setup</strong><div class="webflare-div-image">
<img width="481" height="761" src="images/chap3-18.gif" /></div></li></ol>
<a id="pgfId-1092917"></a>Now click OK to close the Choosing Analyses Form and add the pss analysis in the Analyses section of ADE Explorer as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-18
<a id="pgfId-1092923"></a>ADE Explorer Simulation Window - PSS Analysis</strong><div class="webflare-div-image">
<img width="651" height="368" src="images/chap3-19.gif" /></div></li></ol>












































<h3>
<a id="pgfId-1092924"></a>Running the PSS analysis</h3>

<p>
<a id="pgfId-1266476"></a>Once finished setting up the PSS analysis click the green icon <img width="35" height="37" src="images/chap3-20.gif" /><span> on the right hand side of the ADE Explorer window or on the Schematic window to run the simulation.</span></p>

<p>
<a id="pgfId-1266477"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</p>
<p>
<a id="pgfId-1092930"></a>Next, you will plot the results.</p>

<h4>
<a id="pgfId-1092931"></a>Plotting the PSS Analysis Results</h4>

<p>
<a id="pgfId-1092932"></a>In ADE Explorer, select Results - Direct Plot - Main Form. The <em>Direct Plot Form</em> window is displayed.</p>

<p class="webflare-indent1"><strong>Figure 3-19
<a id="pgfId-1092936"></a>The Direct Plot Form Window</strong></p>
<div class="webflare-div-image">
<img width="311" height="647" src="images/chap3-21.gif" /></div>

<p>
<a id="pgfId-1092938"></a>Plot the oscillator startup waveform from tstab run.</p>
<ol><li>
<a id="pgfId-1092939"></a>In the <em>Direct Plot Form</em> window, select tstab in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1092940"></a>Leave Function as PSS Transient V which is set by default.</li><li>
<a id="pgfId-1092941"></a>Select Net in the center of the form. (This is the default. You can also select differential nets).</li><li>
<a id="pgfId-1092942"></a>The Direct Plot Form window should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-20
<a id="pgfId-1092943"></a>PSS Analysis Direct Plot Setup - Initial Transient </strong><div class="webflare-div-image">
<img width="668" height="355" src="images/chap3-22.gif" /></div></li><li>
<a id="pgfId-1092948"></a>Select the collector net in the schematic. It is located just below the collector label.<br /><strong class="webflare-fig-line-height">Figure 3-21
<a id="pgfId-1092952"></a>Selecting collector net on oscillator_ckt schematic</strong><div class="webflare-div-image">
<img width="499" height="281" src="images/chap3-23.gif" /></div></li></ol>












<p>
<a id="pgfId-1092954"></a>The waveform window is displayed.</p>

<p class="webflare-indent1"><strong>Figure 3-22
<a id="pgfId-1092956"></a>PSS Analysis - Initial Startup Waveform during tstab interval</strong></p>
<div class="webflare-div-image">
<img width="668" height="629" src="images/chap3-24.gif" /></div>

<p>
<a id="pgfId-1092961"></a>This plot shows how the initial startup waveform for oscillator gets build up during the tstab interval. Note that the oscillator starts up immediately after time zero. This is because the calculate initial conditions was automatically set in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1182648"></a>Next you will plot the oscillator output spectrum</p>
<p>
<a id="pgfId-1182649"></a>Plot the oscillator spectral content, as follows:</p>
<ol><li>
<a id="pgfId-1182650"></a>In the <em>Direct Plot Form</em> window, set the Plotting Mode to New Win.</li><li>
<a id="pgfId-1092965"></a>Select pss as Analysis.</li><li>
<a id="pgfId-1092966"></a>Leave Function as Voltage, which is set by default.</li><li>
<a id="pgfId-1092967"></a>Leave the Select section of the form set to the default value, Net (You can also select differential nets).</li><li>
<a id="pgfId-1092968"></a>Select Sweep as spectrum. (This is the default)</li><li>
<a id="pgfId-1092969"></a>Select rms as Signal Level (the default is peak).</li><li>
<a id="pgfId-1092970"></a>Select dB20 as Modifier.</li><li>
<a id="pgfId-1092971"></a>Your Direct Plot Form window should like the following:<br /><strong class="webflare-fig-line-height">Figure 3-23
<a id="pgfId-1092972"></a>PSS Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="371" height="647" src="images/chap3-25.gif" /></div></li><li>
<a id="pgfId-1092977"></a>Select the collector net in the schematic. It is located just below the collector label.<br /><strong class="webflare-fig-line-height">Figure 3-24
<a id="pgfId-1092981"></a>Selecting collector net on oscillator_ckt schematic</strong><div class="webflare-div-image">
<img width="384" height="267" src="images/chap3-26.gif" /></div>
<a id="pgfId-1092983"></a>The waveform window is displayed, as shown below.<br /><strong>Figure 3-25
<a id="pgfId-1092987"></a>PSS Analysis output Graph Window - Voltage Spectrum Plot</strong><div class="webflare-div-image">
<img width="614" height="479" src="images/chap3-27.gif" /></div></li><li>
<a id="pgfId-1092989"></a>In the waveform window, position your cursor near the first harmonic, and press the &#8216;m&#8217; key. Here &#8216;m&#8217; is the bindkey to place a trace marker on the graph. The first harmonic is chosen as this is the frequency oscillator is designed for.<br />
<a id="pgfId-1092990"></a>Note that this frequency is 1.833GHz. This is the frequency of oscillation.</li><li>
<a id="pgfId-1092991"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. </li><li>
<a id="pgfId-1092992"></a>In the ViVA window, choose <em>File</em> - <em>Close All Windows</em>.</li><li>
<a id="pgfId-1092993"></a>Clean up the screen for the next set of measurements.</li><li>
<a id="pgfId-1092994"></a>Close the Analog Design Environment window by selecting <em>Session</em> - <em>Quit</em>.</li><li>
<a id="pgfId-1092996"></a>In the Schematic window, choose <em>File</em> - <em>Close</em>.</li></ol>




























<p>
<a id="pgfId-1092997"></a>To summarize, a PSS analysis using Harmonic Balance was setup and simulation was run to determine the oscillation frequency of the oscillator. Next an Oscillator Loop Gain measurement will be performed.</p>

<h2>
<a id="pgfId-1212007"></a><a id="48693"></a>Oscillator Loop Gain Measurement</h2>

<p>
<a id="pgfId-1212008"></a>Oscillator loop gain measurements are typically made with a combination of linear stability (stb), Harmonic Balance (hb), and HBSTB (hbstb) analyses. The hb analysis solves for one period of the settled time-domain waveform. Stability Analysis (stb) allows the measurement of the loop gain and phase. This is quite useful for the design of the feedback network. Note that, stb analysis is a linear analysis and therefore does not take non-linearities of the circuit into account. However, it gives an approximate value of loop gain magnitude and phase and is faster to run. In order to get more accurate values of loop gain and phase of periodically time-varying non-linear circuits, you&#160;&#160;need to run hbstb analysis. The harmonic balance stability analysis (hbstb) evaluates the local stability of a periodically time-varying feedback circuit. It is a small-signal analysis, like stb analysis, except that the circuit is first linearized about a periodically varying operating point (determined using hb analysis) as opposed to a simple DC operating point (which is used in stb analysis). Linearizing about a periodically time-varying operating point allows the stability evaluation to include the effect of the time-varying operating point. </p>

<h4>
<a id="pgfId-1093003"></a>O<a id="OpeningTline3oscRF"></a>pening the Oscillator Circuit in the Schematic Window</h4>

<ol><li>
<a id="pgfId-1093005"></a>In the Command Interpreter Window (CIW), choose <em>File &#8211; Open</em>.<br /><strong class="webflare-fig-line-height">Figure 3-26
<a id="pgfId-1093009"></a>Virtuoso CIW Window - Opening Cellview</strong><div class="webflare-div-image">
<img width="582" height="159" src="images/chap3-28.gif" /></div>
<a id="pgfId-1093011"></a>The <em>Open File</em> form is displayed. </li><li>
<a id="pgfId-1093012"></a>Select <em>ExampleLibRF </em>from the <em>Library </em>drop-down list.</li><li>
<a id="pgfId-1093013"></a>In the <em>Cells </em>field, type <em>oscillator_ckt</em>.</li><li>
<a id="pgfId-1120392"></a>Choose <em>schematic</em> from the <em>View</em> drop-down list.</li><li>
<a id="pgfId-1120393"></a>In the Application section, select <em>Schematics L</em> from the Open With drop-down list.</li><li>
<a id="pgfId-1093019"></a>Leave Open for to Edit (which is set by default).<br /><strong class="webflare-fig-line-height">Figure 3-27
<a id="pgfId-1093020"></a>Open File Form to open the oscillator_ckt cell&#8217;s Schematic View</strong>
<a id="pgfId-1120407"></a><div class="webflare-div-image">
<img width="653" height="412" src="images/chap3-29.gif" /></div></li><li>
<a id="pgfId-1211986"></a>Once all the setup is done, click <em>OK</em>.<br />
<a id="pgfId-1211987"></a>This will open the oscillator_ckt schematic in Virtuoso Schematic Editor L window, as shown below:<a id="OpeningTline3oscRF"></a><br /><strong class="webflare-fig-line-height">Figure 3-28
<a id="pgfId-1093027"></a>oscillator_ckt schematic in VSE L Window</strong>
<a id="pgfId-1120470"></a><div class="webflare-div-image">
<img width="651" height="403" src="images/chap3-30.gif" /></div></li></ol>





















<h3>
<a id="pgfId-1266839"></a>Setting up the stb Analysis</h3>

<ol><li>
<a id="pgfId-1266840"></a>In the Schematic Window, choose <em>Launch - ADE Explorer.</em> <br /><strong class="webflare-fig-line-height">Figure 3-29
<a id="pgfId-1266841"></a>Opening ADE Explorer window from VSE window</strong><div class="webflare-div-image">
<img width="656" height="372" src="images/chap3-31.gif" /></div></li><li>
<a id="pgfId-1294278"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1294279"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-30
<a id="pgfId-1294280"></a>Create new ADE Explorer view</strong><div class="webflare-div-image">
<img width="613" height="352" src="images/chap3-32.gif" /></div></li><li>
<a id="pgfId-1266854"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1294305"></a>Virtuoso ADE Explorer is opened, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-31
<a id="pgfId-1266855"></a>ADE Explorer</strong><div class="webflare-div-image">
<img width="630" height="367" src="images/chap3-33.gif" /></div></li><li>
<a id="pgfId-1093041"></a>Select <em>Setup &#8211; Simulator</em>.<br />
<a id="pgfId-1266936"></a>The Choosing Simulator form is displayed.</li><li>
<a id="pgfId-1266937"></a>Select <em>spectre</em> for the Simulator.<br /><strong class="webflare-fig-line-height">Figure 3-32
<a id="pgfId-1266938"></a>Choosing Simulator Form</strong><div class="webflare-div-image">
<img width="658" height="89" src="images/chap3-34.gif" /></div></li><li>
<a id="pgfId-1093055"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1093057"></a>Select Setup - High Performance Simulation. The <em>High Performance Simulation Options</em> window is displayed.<br />
<a id="pgfId-1093059"></a>In the High Performance Simulation Options window, select APS. Note that Auto is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. Usually it is better to specify the number of threads yourself.  Small circuits should use a small number of threads, and larger circuits can use more threads.  The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.<br /><strong class="webflare-fig-line-height">Figure 3-33
<a id="pgfId-1093064"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="661" height="566" src="images/chap3-35.gif" /></div></li><li>
<a id="pgfId-1211981"></a>Click OK.</li><li>
<a id="pgfId-1211982"></a>Select Outputs &#8211; Save All.<br />
<a id="pgfId-1211983"></a>The Save Options form is displayed.</li><li>
<a id="pgfId-1093068"></a>In the Select signals to output (save) section, make sure that allpub is selected.<br /><strong class="webflare-fig-line-height">Figure 3-34
<a id="pgfId-1093072"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="656" height="770" src="images/chap3-36.gif" /></div>
<a id="pgfId-1093073"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1093074"></a>To save the currents, use the Select device currents (currents) option, and select nonlinear if you just want to save the device currents, or all if you want to save all the currents in the circuit. When you save currents, more disk space is required for the results file. </li><li>
<a id="pgfId-1120940"></a>Click OK.</li><li>
<a id="pgfId-1120942"></a>Select <em>Setup - Simulation Files.</em><br />
<a id="pgfId-1121007"></a>The <em>Simulation Files Setup</em> form is displayed.</li><li>
<a id="pgfId-1093078"></a>In the Simulation Files Setup form, enter ./ by clicking in the Include Paths section. It should look like the following: <br /><strong class="webflare-fig-line-height">Figure 3-35
<a id="pgfId-1093082"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="664" height="402" src="images/chap3-37.gif" /></div></li><li>
<a id="pgfId-1093083"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1093084"></a>Select <em>Setup &#8211; Model Libraries</em>.<br />
<a id="pgfId-1093085"></a>The <em>Model Library Setup</em> form is displayed.</li><li>
<a id="pgfId-1093086"></a>In the Model File field, type the path to the model file including the file name, as shown below.<br />
<a id="pgfId-1093087"></a>models/modelsRF.scs<br /><strong class="webflare-fig-line-height">Figure 3-36
<a id="pgfId-1093091"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="670" height="255" src="images/chap3-38.gif" /></div>
<a id="pgfId-1093092"></a>You can also browse to modelsRF.scs file. </li><li>
<a id="pgfId-1121227"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1121228"></a>Select <em>Analyses - Choose</em>. <br />
<a id="pgfId-1121229"></a>The Choosing Analyses form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-37
<a id="pgfId-1093099"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="499" height="501" src="images/chap3-39.gif" /></div></li><li>
<a id="pgfId-1093101"></a>In the <em>Analysis</em> section, select stb.<br /><strong class="webflare-fig-line-height">Figure 3-38
<a id="pgfId-1093105"></a>The Choosing Analyses Form - stb Analysis Setup</strong><div class="webflare-div-image">
<img width="401" height="700" src="images/chap3-40.gif" /></div></li><li>
<a id="pgfId-1093107"></a>Type 1m in the <em>Start</em> Field. Note the lower case m. This means the start frequency is 0.001 Hz.</li><li>
<a id="pgfId-1093108"></a>Type 1T in the <em>Stop</em> field. This will set the stop frequency to 1 THz.<br />
<a id="pgfId-1093109"></a>The frequency range is deliberately set very wide in order to detect potential parasitic oscillation modes.</li><li>
<a id="pgfId-1233486"></a>Select Logarithmic sweep. </li><li>
<a id="pgfId-1233487"></a>Type 100 for <em>Points per Decade</em>. The frequency coverage is set to be very dense as this analysis runs quickly.</li><li>
<a id="pgfId-1093112"></a>Click <em>Select</em> to the right of the <em>Probe Instance/Terminal</em> field.</li><li>
<a id="pgfId-1093113"></a>In the schematic, click the instance that looks like an analog meter in the center of the circuit. This is an iprobe from analogLib.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1093114"></a>To use stability analysis, either an iprobe or a vdc set to 0 Volts needs to be added in series with the feedback path. In this case, an iprobe is used. The current probe and the vdc source both have zero resistance. Because of this the loading in the loop is maintained. In the past, the AC part of the loading had to be broken in order to get a loop gain measurement. For a differential circuit, use diffstbprobe from analogLib.</div>
<a id="pgfId-1093115"></a>Your Choosing Analyses form should look like this:<br /><strong>Figure 3-39
<a id="pgfId-1093119"></a>Choosing Analyses Form - stb Analysis Setup</strong><div class="webflare-div-image">
<img width="546" height="692" src="images/chap3-41.gif" /></div>
<a id="pgfId-1093120"></a>Click Apply at the bottom of the Choosing Analyses form. This will add the stb analysis in the Analyses section of ADE Explorer, as shown below:<br /><strong>Figure 3-40
<a id="pgfId-1093125"></a>ADE Explorer Simulation Window - stb analysis setup</strong><div class="webflare-div-image">
<img width="607" height="336" src="images/chap3-42.gif" /></div></li></ol>























































































<h3>
<a id="pgfId-1093127"></a>Setting up the HB Analysis</h3>

<ol><li>
<a id="pgfId-1093128"></a>Select hb as <em>Analysis</em>. The form expands.<br /><strong class="webflare-fig-line-height">Figure 3-41
<a id="pgfId-1093132"></a>The Choosing Analyses Form - Setting HB Analysis </strong><div class="webflare-div-image">
<img width="459" height="793" src="images/chap3-43.gif" /></div></li><li>
<a id="pgfId-1297432"></a>Leave the <em>Run transient</em> option to the default value of <em>Decide Automatically</em>. </li><li>
<a id="pgfId-1297485"></a>Select <em>yes</em> for <em>Save Initial Transient Results (savinit)</em>. This will help in visualizing the buildup of the oscillator waveform.</li><li>
<a id="pgfId-1297486"></a>In the Fundamental Frequency field, type <code>1.9G</code>. The frequency entered here is an approximate frequency of oscillation. </li><li>
<a id="pgfId-1093137"></a>In the Number of harmonics field, type <code>15</code>.<br />
<a id="pgfId-1093138"></a>In general, you want to choose a number that is high enough to capture the nonlinearity of the circuit. Start with 10, and run the simulation. Increase by about 50% to 15 and re-run the simulation. If the harmonics donot change appreciably, then 10 is enough. If they change, increase the number by about 50%. Use the smallest number of harmonics for the answer to be stable.</li><li>
<a id="pgfId-1297503"></a>Leave Oversample Factor as default (that is, <code>1</code>). Since the oscillator has sinusoidal waveforms, an oversample of 1 is appropriate. </li><li>
<a id="pgfId-1297532"></a>Leave the <em>Freqdivide Ratio for Tone 1</em> option to the default value of <code>1</code>.</li><li>
<a id="pgfId-1093139"></a>In the Accuracy Defaults (errpreset) section, select conservative. conservative is typically used because very small amplitude phase noise measurements are normally desired. Conservative is recommended for all the oscillators.</li><li>
<a id="pgfId-1093144"></a>Select Oscillator. This is required for simulating an autonomous circuit.<br /><strong class="webflare-fig-line-height">Figure 3-42
<a id="pgfId-1093148"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="461" height="164" src="images/chap3-44.gif" /></div></li><li>
<a id="pgfId-1093150"></a>In the <em>Oscillator node+ </em>field, click <em>Select</em> just to the right of the field. In the schematic, select the <em>collector</em> node. This is the net just below the collector label. This oscillator node will be used by the simulator for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it.</li><li>
<a id="pgfId-1267412"></a>Leave the <em>Oscillator node- </em>field blank.<br />
<a id="pgfId-1211942"></a>Note that if you have a single-ended oscillator, only specify one node. If the second node, (the reference node) is left blank, it will be connected to the global ground node automatically. However, if you have a differential oscillator, you need to specify both the nodes.<br /><strong class="webflare-fig-line-height">Figure 3-43
<a id="pgfId-1093155"></a>Selecting collector net on oscillator_ckt schematic</strong>
<a id="pgfId-1121814"></a><div class="webflare-div-image">
<img width="396" height="271" src="images/chap3-45.gif" /></div></li><li>
<a id="pgfId-1093156"></a>If you have an LC oscillator, leave the Calculate initial conditions (ic) automatically checkbox selected (this is the default).<br />
<a id="pgfId-1093157"></a>Note that Calculate initial conditions (ic) automatically is used to start the oscillator. Other methods to start the oscillator include putting a single current pulse into the resonator, setting initial conditions(ic), or ramping up the power at time = zero plus.</li><li>
<a id="pgfId-1211938"></a>Note that by default Use the probe-based solution method (oscmethod) option is deselected. Spectre will use the <em>onetier</em> method.<br />
<a id="pgfId-1211939"></a>When Setting Use the probe-based solution method (oscmethod) option is selected, it iterates for the frequency solution in the outer loop and the amplitude and phase solution in the inner loop. The probe-based method has better convergence but is computationally intensive. <br />
<a id="pgfId-1093160"></a>Please refer to <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a></em> for more details.<br />
<a id="pgfId-1093162"></a>The Choosing Analyses form will look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-44
<a id="pgfId-1093166"></a>Choosing Analyses Form - Harmonic Balance Setup</strong><div class="webflare-div-image">
<img width="479" height="632" src="images/chap3-46.gif" /></div></li><li>
<a id="pgfId-1211934"></a>Click Apply located at the bottom of the form. This will add the hb analysis in the Analyses section of ADE Explorer along with stb analysis, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-45
<a id="pgfId-1211935"></a>ADE Explorer Simulation Window - stb and hb Analysis setup</strong><div class="webflare-div-image">
<img width="622" height="365" src="images/chap3-47.gif" /></div></li></ol>







































<h3>
<a id="pgfId-1093174"></a>Setting up the HBSTB Analysis</h3>

<ol><li>
<a id="pgfId-1093175"></a>In the <em>Choosing Analyses</em> form, select hbstb.<br /><strong class="webflare-fig-line-height">Figure 3-46
<a id="pgfId-1093179"></a>The Choosing Analysis Form - hbstb Analysis Setup</strong><div class="webflare-div-image">
<img width="590" height="610" src="images/chap3-48.gif" /></div>
<a id="pgfId-1093181"></a>Set your sweep frequency such that the expected oscillation falls within the sweep range.</li><li>
<a id="pgfId-1093182"></a>Type 1.7G in the <em>Start</em> field.</li><li>
<a id="pgfId-1093183"></a>Type 2G in the <em>Stop</em> field.</li><li>
<a id="pgfId-1093184"></a>Set the <em>Sweep Type</em> to Linear.</li><li>
<a id="pgfId-1093185"></a>Select <em>Number of Steps</em>.</li><li>
<a id="pgfId-1093186"></a>Type 100 in the <em>Number of Steps</em> field. <br />
<a id="pgfId-1211930"></a>You need to provide number of steps such that you have enough resolution in frequency. In this case, you have 300MHz/100 = 3MHz step resolution.</li><li>
<a id="pgfId-1211931"></a>Click your mouse cursor in the Probe Instance field and click Select  which is just to the right of this field. The pstb requires that you place the probe on the feedback loop to identify and characterize the particular loop of interest. </li><li>
<a id="pgfId-1093189"></a>In the schematic window, select the iprobe in the center of the circuit. It looks like an analog meter. &#8216;iprobe&#8217; is required to determine the feedback without breaking the feedback loop.<br /><strong class="webflare-fig-line-height">Figure 3-47
<a id="pgfId-1093193"></a>Selecting iprobe instance IPRB0 on the schematic</strong><div class="webflare-div-image">
<img width="437" height="205" src="images/chap3-49.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1093194"></a>To use pstb analysis, either an iprobe or a vdc set to 0 Volts needs to be added in series with the feedback path. In this case, an iprobe is used. The current probe and the vdc source both have zero resistance. Because of this the loading in the loop is maintained. In the past, the AC part of the loading had to be broken in order to get a loop gain measurement.</div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1093195"></a>For a differential circuit, use the diffstbprobe component from analogLib.</div>
<a id="pgfId-1093196"></a>The Choosing Analyses form should look like the following.<br /><strong>Figure 3-48
<a id="pgfId-1093200"></a>Choosing Analyses Form - hbstb Analysis Setup</strong><div class="webflare-div-image">
<img width="466" height="614" src="images/chap3-50.gif" /></div></li><li>
<a id="pgfId-1122442"></a>Click OK button at the bottom of the form to close the Choosing Analyses form.<br />
<a id="pgfId-1211926"></a>The hbstb analysis gets added along with stb and hb analysis in the Analyses section of ADE Explorer, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-49
<a id="pgfId-1211927"></a>ADE Explorer Simulation Window - stb, hb and hbstb setup</strong><div class="webflare-div-image">
<img width="620" height="354" src="images/chap3-51.gif" /></div></li></ol>





























<h3>
<a id="pgfId-1297701"></a>Running the HB, stb and HBSTB analysis</h3>

<p>
<a id="pgfId-1297705"></a>Once finished setting up the HB, HBSTB and stb analysis click the green icon <img width="32" height="31" src="images/chap3-52.gif" /><span> in ADE Explorer or on the Schematic window to run the simulation.</span></p>
<h3>
<a id="pgfId-1093213"></a>Plotting the results</h3>
<h4>
<a id="pgfId-1093214"></a>Plotting the stb analysis results</h4>

<p>
<a id="pgfId-1093215"></a>First plot the Loop Gain magnitude and phase from the stb analysis.</p>
<ol><li>
<a id="pgfId-1093216"></a>In ADE Explorer, select Results - Direct Plot - Main Form.<br /><strong class="webflare-fig-line-height">Figure 3-50
<a id="pgfId-1093220"></a>The Direct Plot Form - stb, hb and hbstb Analysis</strong><div class="webflare-div-image">
<img width="381" height="496" src="images/chap3-53.gif" /></div></li><li>
<a id="pgfId-1093222"></a>Select stb as Analysis.</li><li>
<a id="pgfId-1093223"></a>Keep the rest of the settings at their default values, that is <em>Loop Gain</em> as <em>Function</em>, <em>Magnitude</em> and <em>Phase</em> as <em>Modifier</em> and <em>dB20</em> as <em>Magnitude Modifier</em>. Remember that we are trying to plot the Loop Gain magnitude and phase plot.<br />
<a id="pgfId-1093224"></a>The Direct Plot Form looks like the following:<br /><strong class="webflare-fig-line-height">Figure 3-51
<a id="pgfId-1093228"></a>stb Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="372" height="494" src="images/chap3-54.gif" /></div></li><li>
<a id="pgfId-1093229"></a>Click Plot.</li><li>
<a id="pgfId-1093233"></a>In the waveform window, click the <em>Split Current Strip</em> icon <img width="51" height="34" src="images/chap3-55.gif" />
. This will add the Loop Gain and Phase plots in two different strips in the same graph window, as shown below. <br /><p class="webflare-indent1"><strong>Figure 3-52
<a id="pgfId-1122898"></a>stb Analysis Ouput Graph Window - Loop Gain Magnitude and Phase Plot</strong></p><div class="webflare-div-image">
<img width="594" height="411" src="images/chap3-56.gif" /></div>
<a id="pgfId-1122988"></a>On the top of the graph is a plot of loop gain phase in degrees. On the bottom of the graph is a plot of loop gain magnitude in dB. The area in the red box is the unity gain area.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1122990"></a>There is only one place just above 1 GHz where the loop gain approaches unity.</div></li><li>
<a id="pgfId-1093245"></a>Now Zoom in to the unity gain area of the Loop Gain Plot. To do this: <ol><li>
<a id="pgfId-1093246"></a>Move your mouse cursor over one of the numbers on the X axis.</li><li>
<a id="pgfId-1093247"></a>Click the right mouse button and select <em>Axis Properties</em>. </li><li>
<a id="pgfId-1093248"></a>Click the <em>Scale</em> tab and set <em>Mode</em> to <em>Manual</em>.</li><li>
<a id="pgfId-1093249"></a>Type 1G in the <em>Min</em>imum cyclic field. This is near to the frequency before the unity gain area starts.</li><li>
<a id="pgfId-1093250"></a>Type 2.4G in the <em>Maximum cyclic </em>field. This is frequency near to which the unity gain area ends.<br /><strong class="webflare-fig-line-height">Figure 3-53
<a id="pgfId-1123100"></a>Graph Window X-Axis Setup</strong><div class="webflare-div-image">
<img width="518" height="339" src="images/chap3-57.gif" /></div></li><li>
<a id="pgfId-1093257"></a>Click OK.</li></ol><br />
<a id="pgfId-1093258"></a>This will provide the zoomed in plot of Loop Gain&#8217;s Magnitude and Phase from 1GHz to 2.4GHz frequency range.<br /><strong class="webflare-fig-line-height">Figure 3-54
<a id="pgfId-1093262"></a>stb Analysis Loop Gain Magnitude and Phase Zoomed-in Plot</strong><div class="webflare-div-image">
<img width="589" height="425" src="images/chap3-58.gif" /></div></li></ol>



































<p>
<a id="pgfId-1267936"></a>In traditional control system analysis, an oscillator will oscillate when the loop gain is greater than unity and the phase is 180 degrees. This assumes that there is an inverting summing junction in the feedback loop. In the circuit, we cannot separate out the summing junction, and so the loop gain measurement contains it. In the phase plot, what one looks for is zero or multiples of 360 degrees, not 180 degrees.</p>
<ol><li>
<a id="pgfId-1093264"></a>Place a vertical marker at 360 degrees phase, as follows:<ol><li>
<a id="pgfId-1093265"></a>Move the mouse cursor near the 360 degree phase point and type v. This will place a vertical marker. </li><li>
<a id="pgfId-1093266"></a>Move your mouse cursor over the vertical marker. The cursor will change shape.</li><li>
<a id="pgfId-1093267"></a>Right-click and select <em>Intercepts - On</em>.</li><li>
<a id="pgfId-1093268"></a>Select the vertical marker, click and hold the mouse button, and place it at 360 degrees.</li></ol><br />
<a id="pgfId-1093269"></a>The graph window will look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-55
<a id="pgfId-1093271"></a>stb Analysis - 360 degree Marker Placement</strong><div class="webflare-div-image">
<img width="668" height="471" src="images/chap3-59.gif" /></div></li><li>
<a id="pgfId-1093278"></a>Select <em>Window - Assistants - Vert Marker Table.</em><br /><strong class="webflare-fig-line-height">Figure 3-56
<a id="pgfId-1093283"></a>ViVA XL - Selecting Marker Toolbox</strong><div class="webflare-div-image">
<img width="641" height="427" src="images/chap3-60.gif" /></div>
<a id="pgfId-1093284"></a>The Marker Table window appears with the data for the phase and gain curve intercepts along with the frequency.<br />
<a id="pgfId-1093285"></a>The Graph Window will look like the following:<br /><strong>Figure 3-57
<a id="pgfId-1093289"></a>Oscillation frequency determination from stb Loop Gain Plot</strong><div class="webflare-div-image">
<img width="627" height="670" src="images/chap3-61.gif" /></div>
<a id="pgfId-1093290"></a>Note that the loop gain is just over 4.5 dB on the Loop Gain dB20 curve. (Greater than unity gain.) The oscillator should oscillate.<br />
<a id="pgfId-1211922"></a>Note that the frequency of oscillation based on linear stb analysis is 1.89GHz. You&#8217;ll refer to this later.</li><li>
<a id="pgfId-1211923"></a>In the Direct Plot Form, click Cancel. In the ViVA window, select File - Close All Windows.</li></ol>























<p>
<a id="pgfId-1211919"></a>Plotting up the hbstb Analysis Results</p>
<p>
<a id="pgfId-1093295"></a>Next plot the hbstb Loop Gain magnitude and phase. This time you will plot the results from the Schematic Window. Once you open an ADE Explorer session/window from Virtuoso Schematic Editor L Window, the Setup and Run and Results toolbar gets added to this Schematic Editor Window, as shown in the figure below:</p>

<p class="webflare-indent1"><strong>Figure 3-58
<a id="pgfId-1093297"></a>ADE Explorer menu in VSE L Window</strong></p>
<div class="webflare-div-image">
<img width="668" height="304" src="images/chap3-62.gif" /></div>

<p>
<a id="pgfId-1093302"></a>You may refer to <em>Virtuoso ADE Explorer User Guide</em> for more information regarding these simulation menu icons.</p>
<p>
<a id="pgfId-1093309"></a>Click the red arrow&#160;&#160;<img width="27" height="43" src="images/chap3-63.gif" /><span> in the icon </span><img width="54" height="44" src="images/chap3-64.gif" /><span> located at the right. This will open the Direct Plot menu options. Select </span><em>Main form</em><span>, as shown below:</span></p>
<p class="webflare-indent1"><strong>Figure 3-59
<a id="pgfId-1093311"></a>Running Simulation from VSE L Window</strong></p>
<div class="webflare-div-image">
<img width="668" height="295" src="images/chap3-65.gif" /></div>

<p>
<a id="pgfId-1093316"></a>The <em>Direct Plot Form</em> is displayed.</p>
<ol><li>
<a id="pgfId-1093317"></a>In the <em>Direct Plot Form</em>, select hbstb in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1093318"></a>Select Loop Gain in the <em>Function</em> section.</li><li>
<a id="pgfId-1093319"></a>Select Magnitude in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1093320"></a>Select dB20 in the <em>Magnitude Modifier</em> section.<br />
<a id="pgfId-1093321"></a>The <em>Direct Plot Form</em> looks like the following:<br /><strong class="webflare-fig-line-height">Figure 3-60
<a id="pgfId-1093325"></a>HBSTB Direct Plot Loop Gain Magnitude Setup</strong><div class="webflare-div-image">
<img width="457" height="516" src="images/chap3-66.gif" /></div></li><li>
<a id="pgfId-1093326"></a>Click Plot. The Plot Window will be displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-61
<a id="pgfId-1093327"></a>HBSTB Loop Gain Magnitude Plot</strong><div class="webflare-div-image">
<img width="625" height="469" src="images/chap3-67.gif" /></div></li><li>
<a id="pgfId-1093332"></a>Next, plot the hbstb Loop Gain phase. Select Phase in the <em>Modifier </em>section with Loop Gain selected in the <em>Function</em> section.<br />
<a id="pgfId-1093333"></a>The <em>Direct Plot Form</em> looks like the following:<br /><strong class="webflare-fig-line-height">Figure 3-62
<a id="pgfId-1268351"></a>HBSTB Direct Plot Loop Gain Phase Setup</strong><div class="webflare-div-image">
<img width="408" height="455" src="images/chap3-68.gif" /></div></li><li>
<a id="pgfId-1268356"></a>Click Plot. The Graph Window will look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-63
<a id="pgfId-1268357"></a>hbstb Analysis Loop Gain Magnitude and Phase Plot</strong><div class="webflare-div-image">
<img width="646" height="467" src="images/chap3-69.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1268385"></a>Loop Gain&#8217;s Magnitude and Phase are plotted separately as when Magnitude and Phase is selected, there is no dB20 modifier for the loop gain.</div></li><li>
<a id="pgfId-1093347"></a>Next, you need to place a vertical marker at zero degrees on the plot and get the marker table. To do this:<ol><li>
<a id="pgfId-1093348"></a>Type v to place a vertical marker.</li><li>
<a id="pgfId-1093349"></a>Select the vertical marker, click and hold the left mouse button, and place it at near zero degrees.</li></ol><br />
<a id="pgfId-1093350"></a>The Plot will look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-64
<a id="pgfId-1093355"></a>hbstb Loop Gain magnitude and phase plot with vertical marker</strong><div class="webflare-div-image">
<img width="644" height="462" src="images/chap3-70.gif" /></div></li><li>
<a id="pgfId-1268445"></a>Select <em>Window</em> - <em>Assistants</em> - <em>Vert Marker Table</em>.<br />
<a id="pgfId-1268446"></a>The Marker Table window is displayed with the data for the phase and gain curve intercepts along with the frequency. <br /><strong class="webflare-fig-line-height">Figure 3-65
<a id="pgfId-1093360"></a>hbstb Analysis Loop Gain Plot with unexapnded Verticle Marker Table</strong><div class="webflare-div-image">
<img width="668" height="474" src="images/chap3-71.gif" /></div></li><li>
<a id="pgfId-1211914"></a>Note that in the plot window, initially only frequency value is visible and the Loop Gain and Phase values are blank. Click the <em>+</em> sign, located to the left of the Loop Gain dB20 &amp; Loop Gain Phase entry to expand them and see their respective values, as shown in the figure below.<br /><strong class="webflare-fig-line-height">Figure 3-66
<a id="pgfId-1093367"></a>pstb Analysis Loop Gain Plot with Vertical Marker Table</strong><div class="webflare-div-image">
<img width="657" height="466" src="images/chap3-72.gif" /></div>
<a id="pgfId-1093372"></a>Note that the Loop Gain magnitude is very near unity gain.<br />
<a id="pgfId-1211910"></a>Also note that the oscillation frequency determined from hbstb analysis is 1.83GHz, slightly different than the oscillation frequency 1.89GHz determined from linear stability analysis, that is, stb. Linearizing about a periodically time-varying operating point in hbstb analysis allowed the stability evaluation to include the effect of the time-varying operating point as mentioned earlier.This has changed the oscillating frequency a little in comparison to the one determined using stb. <br />
<a id="pgfId-1211911"></a>Next, hb Analysis Results will be plotted. You would note that how well pss results agree with the hbstb results.</li></ol>















































<p>
<a id="pgfId-1093375"></a>Plotting up the PSS Analysis Results</p>
<p>
<a id="pgfId-1093376"></a>Next plot the oscillator spectral content -</p>
<ol><li>
<a id="pgfId-1093377"></a>In the Direct Plot Form window, set the Plotting Mode to New Win.</li><li>
<a id="pgfId-1093378"></a>Select hb as <em>Analysis</em>.</li><li>
<a id="pgfId-1093379"></a>Leave Function as Voltage which is set by default.</li><li>
<a id="pgfId-1093380"></a>Select Net in the center of the form. (This is the default. You can also select differential nets).</li><li>
<a id="pgfId-1093381"></a>Select Sweep as spectrum. (This is the default)</li><li>
<a id="pgfId-1093382"></a>Select rms as Signal Level (default is peak).</li><li>
<a id="pgfId-1093383"></a>Select dB20 as Modifier.</li><li>
<a id="pgfId-1093384"></a>Your Direct Plot Form  should like the following:<br /><strong class="webflare-fig-line-height">Figure 3-67
<a id="pgfId-1093385"></a>HB Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="330" height="600" src="images/chap3-73.gif" /></div></li><li>
<a id="pgfId-1093390"></a>Select the collector net in the Schematic. It is located just below the collector label.<br /><strong class="webflare-fig-line-height">Figure 3-68
<a id="pgfId-1093394"></a>Selecting collector net on oscillator_ckt schematic</strong><div class="webflare-div-image">
<img width="388" height="269" src="images/chap3-74.gif" /></div>
<a id="pgfId-1093396"></a>The waveform window is displayed, as shown below.<br /><strong>Figure 3-69
<a id="pgfId-1093397"></a>HB Analysis output Graph Window - Voltage Spectrum Plot</strong><div class="webflare-div-image">
<img width="657" height="423" src="images/chap3-75.gif" /></div></li><li>
<a id="pgfId-1211907"></a>In the waveform window, position your cursor near the first harmonic, and press the <em>m</em> key. Here <em>m</em> is the bindkey to place a trace marker on the graph. The first harmonic is chosen as this is the frequency oscillator is designed for.<br />
<a id="pgfId-1093403"></a>Note that this frequency is 1.83075G. This is the frequency of oscillation.<br />
<a id="pgfId-1093404"></a>Note that the oscillation frequency determined from pstb analysis agrees very well with the pss-hb analysis.</li><li>
<a id="pgfId-1093405"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. In the ViVA window, choose File - Close All Windows.</li><li>
<a id="pgfId-1093406"></a>Close the Analog Design Environment window by selecting Session - Quit.</li><li>
<a id="pgfId-1093408"></a>In the Schematic window, choose File - Close.</li></ol>



























<p>
<a id="pgfId-1211884"></a>In this section, the B magnitude and phase measurements were done using stb, <em>hb</em>, and hbstb analysis. In addition, the oscillation frequency was determined using these measurements.</p>
<p>
<a id="pgfId-1211879"></a>Next, the phase noise measurement which is one of the key measurement in oscillator design will be done. Also, the Noise Summary Table will be obtained.</p>

<h2>
<a id="pgfId-1211881"></a><a id="26632"></a>Phase Noise Measurement and Noise Summary Table</h2>
<h4>
<a id="pgfId-1093418"></a>O<a id="OpeningTline3oscRF"></a>pening the Oscillator Circuit in the Schematic Window</h4>

<ol><li>
<a id="pgfId-1093419"></a>In the Command Interpreter Window (CIW), choose <em>File - Open</em>.<br /><strong class="webflare-fig-line-height">Figure 3-70
<a id="pgfId-1093423"></a>Virtuoso CIW Window - Opening Cellview</strong><div class="webflare-div-image">
<img width="514" height="205" src="images/chap3-76.gif" /></div>
<a id="pgfId-1093425"></a>The <em>Open File</em> form is displayed. </li><li>
<a id="pgfId-1093426"></a>Select <em>ExampleLibRF </em>from the <em>Library </em>drop-down list.</li><li>
<a id="pgfId-1093427"></a>In the <em>Cells </em>field, type <em>oscillator_ckt</em>.</li><li>
<a id="pgfId-1093428"></a>Select <em>schematic</em> fromthe <em>View</em> drop-down list.</li><li>
<a id="pgfId-1093429"></a>In the Application section, select <em>Schematic-L</em> from the Open With drop-down list.</li><li>
<a id="pgfId-1093430"></a>Leave Open For to Edit (which is set by default).<br /><strong class="webflare-fig-line-height">Figure 3-71
<a id="pgfId-1093432"></a>Open File Form to open the oscillator_ckt cell&#8217;s Schematic View</strong><div class="webflare-div-image">
<img width="560" height="390" src="images/chap3-77.gif" /></div></li><li>
<a id="pgfId-1093438"></a>Once all the setup is done, click OK to close the Open File form.<br />
<a id="pgfId-1093439"></a>This will open the oscillator_ckt schematic in Virtuoso Schematic Editor L window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-72
<a id="pgfId-1093442"></a>Oscillator Schematic<a id="OpeningTline3oscRF"></a> opened in Virtuoso Schematic Editor L Window<a id="OpeningTline3oscRF"></a></strong><div class="webflare-div-image">
<img width="668" height="399" src="images/chap3-78.gif" /></div></li></ol>



















<h3>
<a id="pgfId-1211875"></a>Setting up the HB and HBnoise Analysis</h3>

<p>
<a id="pgfId-1211876"></a>In this section, for performing phase noise measurement, you would be using the hb and hbnoise analyses.</p>
<p>
<a id="pgfId-1093451"></a>Setting up the HB Analysis</p>
<ol><li>
<a id="pgfId-1093452"></a>In the Schematic Window, choose Launch - ADE Explorer.<br /><strong class="webflare-fig-line-height">Figure 3-73
<a id="pgfId-1093457"></a>Opening ADE Explorer window from VSE window</strong><div class="webflare-div-image">
<img width="656" height="362" src="images/chap3-79.gif" /></div></li><li>
<a id="pgfId-1294580"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1294581"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-74
<a id="pgfId-1294582"></a>Create new ADE Explorer view</strong><div class="webflare-div-image">
<img width="613" height="327" src="images/chap3-80.gif" /></div></li><li>
<a id="pgfId-1093458"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1294570"></a>The ADE Explorer window is displayed, as shown below. <br /><strong class="webflare-fig-line-height">Figure 3-75
<a id="pgfId-1093462"></a>Virtuoso ADE Explorer Window</strong><div class="webflare-div-image">
<img width="623" height="363" src="images/chap3-81.gif" /></div></li><li>
<a id="pgfId-1093464"></a>In ADE Explorer, select <em>Setup</em> &#8211; <em>Simulator</em>.<br />
<a id="pgfId-1093466"></a>The Choosing Simulator form is displayed.</li><li>
<a id="pgfId-1093468"></a>Select spectre as the Simulator.<br /><strong class="webflare-fig-line-height">Figure 3-76
<a id="pgfId-1093476"></a>Choosing Simulator/Director/Host Form</strong><div class="webflare-div-image">
<img width="647" height="123" src="images/chap3-82.gif" /></div></li><li>
<a id="pgfId-1093478"></a>Click OK.</li><li>
<a id="pgfId-1093480"></a>Select Setup - High Performance Simulation. The <em>High Performance Simulation Options</em> window is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-77
<a id="pgfId-1125463"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="666" height="622" src="images/chap3-83.gif" /></div></li><li>
<a id="pgfId-1093482"></a>In the High Performance Simulation Options window, select APS. Note that Auto is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 16) and then multi-thread on all the available cores. Usually, it is better to specify the number of threads yourself. Small circuits should use a small number of threads, and larger circuits can use more threads. The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.</li><li>
<a id="pgfId-1093488"></a>Click OK to close the High Performance Simulation Options form.</li><li>
<a id="pgfId-1093489"></a>In ADE Explorer, select <em>Outputs - Save All</em>.<br />
<a id="pgfId-1093490"></a>The Save Options form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-78
<a id="pgfId-1125637"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="650" height="547" src="images/chap3-84.gif" /></div></li><li>
<a id="pgfId-1093491"></a>In the Select signals to output section (save), ensure that <em>allpub</em> is selected.<br />
<a id="pgfId-1093496"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1093497"></a>To save the currents, use the <em>Select device currents (currents) </em>option, and select <em>nonlinear</em> if you just want to save the device currents, or all if you want to save all the currents in the circuit. When you save currents, more disk space is required for the results file. </li><li>
<a id="pgfId-1093498"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1125829"></a>Select <em>Setup - Simulation Files</em>.<br />
<a id="pgfId-1125830"></a>The <em>Simulation Files Setup</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-79
<a id="pgfId-1125875"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="651" height="358" src="images/chap3-85.gif" /></div></li><li>
<a id="pgfId-1125831"></a>In the Simulation Files Setup form, type<code> ./ </code>by clicking in the Include Paths section. </li><li>
<a id="pgfId-1093506"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1093507"></a>Select <em>Setup &#8211; Model Libraries</em>.<br />
<a id="pgfId-1093508"></a>The Model Library Setup form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-80
<a id="pgfId-1125984"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="665" height="257" src="images/chap3-86.gif" /></div></li><li>
<a id="pgfId-1093509"></a>In the <em>Model File </em>field, type the path to the model file including the file name, as shown below:<br />
<a id="pgfId-1093510"></a><code>models/modelsRF.scs</code><br />
<a id="pgfId-1093515"></a>You can also browse to the modelsRF.scs file. </li><li>
<a id="pgfId-1093516"></a>Click <em>OK</em> to close the Model Library Setup form.</li><li>
<a id="pgfId-1093517"></a>Select <em>Analyses - Choose</em>.<br />
<a id="pgfId-1093518"></a>The Choosing Analyses form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-81
<a id="pgfId-1093519"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="513" height="477" src="images/chap3-87.gif" /></div></li><li>
<a id="pgfId-1093524"></a>Select hb in the <em>Analysis</em> section. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-82
<a id="pgfId-1093528"></a>The Choosing Analyses Form - Setting hb analysis</strong><div class="webflare-div-image">
<img width="394" height="797" src="images/chap3-88.gif" /></div></li><li>
<a id="pgfId-1093529"></a>In the Transient-Aided Options section, leave<em> Run Transient? </em>as <em>Decide automatically</em>, which is set by default.<br />
<a id="pgfId-1269037"></a>The other choices for this option are <em>Yes</em> and <em>No</em>. If <em>Yes</em> is used then the <em>Detect Steady State </em>option becomes active and the <em>Stop Time(tstab)</em> field is also activated. This means that you can decide whether you would like the Steady State to be detected automatically during the transient run or not and also specify a Stop time(tstab) for that transient run. When you select the checkbox for <em>Detect Steady State </em>option, this will run the transient analysis until steady-state is detected and then switches to hb.</li><li>
<a id="pgfId-1269073"></a>Select <em>yes</em> for Save Initial Transient Results (saveinit). This will help in visualizing the buildup of the oscillation waveform.</li><li>
<a id="pgfId-1093531"></a>Select <em>Names</em> in the Tones section. The other option is <em>Frequencies</em>, which is selected by default. <br />
<a id="pgfId-1269094"></a><em>Names</em> is chosen here as it is similar to pss Harmonic Balance analysis setup. The form changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-83
<a id="pgfId-1093532"></a>The Choosing Analyses Form - Setting hb analysis using Names</strong><div class="webflare-div-image">
<img width="668" height="812" src="images/chap3-89.gif" /></div></li><li>
<a id="pgfId-1093538"></a>Select the Oscillator option. This is required for simulating an autonomous circuit.<br /><strong class="webflare-fig-line-height">Figure 3-84
<a id="pgfId-1093542"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="390" height="151" src="images/chap3-90.gif" /></div></li><li>
<a id="pgfId-1093543"></a>A popup window, as shown below appears. This informs about creation of an osc! frequency line entry in the <em>Tones</em> field. Click <em>Close</em> to close the window.<br /><strong class="webflare-fig-line-height">Figure 3-85
<a id="pgfId-1093547"></a>Popup Window - osc! entry creation message</strong><div class="webflare-div-image">
<img width="467" height="95" src="images/chap3-91.gif" /></div>
<a id="pgfId-1093548"></a>Closing the above popup window will result in creation of the osc! frequency line in the <em>Tones</em> section, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-86
<a id="pgfId-1093552"></a>Choosing Analyses Form - hb autonomous setup</strong><div class="webflare-div-image">
<img width="473" height="812" src="images/chap3-92.gif" /></div></li><li>
<a id="pgfId-1093553"></a>Select the <em>osc!</em> row in the <em>Tones</em> section. <ol><li>
<a id="pgfId-1269216"></a>Enter <code>1.9G </code>in the Expr field.</li><li>
<a id="pgfId-1269223"></a>Leave the Number of Harmonics option set to <em>auto</em>. When Number of Harmonics is set to auto, the simulator calculates harmonics automatically. The calculation is based on Fourier analysis of transient steady-state waveforms. </li><li>
<a id="pgfId-1093554"></a>Leave the <em>Ovsap</em> option as set to 1. Since the oscillator has sinusoidal waveforms, an oversample of 1 is appropriate. </li></ol></li><li>
<a id="pgfId-1269310"></a>Enter<code> 1 </code>for the <em>Freqdivide Ratio for Tone with Tstab </em>option (which is set by default) as there is no frequency divider in the circuit. If there is a frequency divider in the circuit, then you need to set the Freqdivide Ratio for Tone with tstab to the divide ratio of the divider. For example, if the divider is divide-by-two, then the divide ratio is 2. Therefore, you will set Freqdivide Ratio for Tone with tstab to 2.</li><li>
<a id="pgfId-1269311"></a>Leave the Harmonics option set to <em>Default</em>.</li><li>
<a id="pgfId-1269312"></a>In the Accuracy Defaults (errpreset) section, select <em>conservative</em>. <br />
<a id="pgfId-1269328"></a><em>conservative</em> is typically used because very small amplitude phase noise measurements are normally desired. Conservative is recommended for all the oscillators.</li><li>
<a id="pgfId-1093558"></a>In the Oscillator section, in Oscillator node+ field, click <em>Select</em> just to the right of this field. In the schematic, select the collector node. Instead of selecting the node from the schematic you can also type <code>/collector </code>in the Oscillator node+ field. <br />
<a id="pgfId-1269345"></a>This oscillator node will be used by the simulator for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it. <br />
<a id="pgfId-1269355"></a>Leave Oscillator node- blank.<br />
<a id="pgfId-1093559"></a>Note that if you have a single-ended oscillator, only specify one node. If the second node that is, the reference node is left blank, it will be connected to the global ground node automatically. However, if you have differential oscillator, you need to specify both the nodes.<br /><strong>Figure 3-87
<a id="pgfId-1093563"></a>Selecting collector net on oscillator_ckt schematic</strong><div class="webflare-div-image">
<img width="458" height="269" src="images/chap3-93.gif" /></div></li><li>
<a id="pgfId-1093564"></a>If you are simulating an LC oscillator, leave the <em>Calculate initial conditions (ic) automatically </em>checkbox selected (this is the default).<br />
<a id="pgfId-1093565"></a>Note that <em>Calculate initial conditions (ic) automatically</em> is used to start the oscillator. Other methods to start the oscillator include putting a single current pulse into the resonator, setting initial conditions(ic), or ramping up the power at time = zero plus.</li><li>
<a id="pgfId-1093566"></a>Note that, by default, the <em>Use the probe-based solution method (oscmethod) </em>option is deselected. Spectre will use the <em>onetier</em> method.<br />
<a id="pgfId-1093567"></a>When the<em> Use the probe-based solution method (oscmethod) </em>option is selected, it iterates for the frequency solution in the outer loop and the amplitude and phase solution in the inner loop. The probe-based method has better convergence but is computationally intensive. <br />
<a id="pgfId-1093568"></a>Refer to <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a> </em>for more details.</li><li>
<a id="pgfId-1126885"></a>The <em>Choosing Analyses</em> form will look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-88
<a id="pgfId-1126886"></a>Choosing Analyses Form - HB Analysis Setup</strong><div class="webflare-div-image">
<img width="371" height="780" src="images/chap3-94.gif" /></div></li><li>
<a id="pgfId-1211861"></a>Click <em>Apply</em>. <br />
<a id="pgfId-1269486"></a>This will add hb analysis to the Analyses section of ADE Explorer, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-89
<a id="pgfId-1211862"></a>ADE Explorer Simulation Window - hb analysis setup</strong><div class="webflare-div-image">
<img width="668" height="362" src="images/chap3-95.gif" /></div></li></ol>





























































































































<h4>
<a id="pgfId-1093581"></a>Setting up the hbnoise Analysis</h4>

<p>
<a id="pgfId-1253400"></a>Starting with IC617, the noise UI is re-designed. <em>modulated</em> has been removed and its functionalities are merged with <em>timeaverage</em>, leaving three noise types now. In addition, the FM jitter option is removed. It is calculated through timeaverage PM noise, which should be used when you want to get phase noise.</p>
<p>
<a id="pgfId-1253385"></a>When <em>Noise Type</em> is set to <em>timeaverage</em>, USB, LSB, AM and PM noises are directly available.You can choose, for example, PM noise alone, or you can select the ALL(AM,PM,USB,LSB) option, if you need all four types of noise. The available options are <em>USB</em>, <em>AM</em>, <em>PM</em>, <em>AM&amp;PM</em>, and <em>ALL(AM,PM,USB,LSB)</em>.</p>
<ol><li>
<a id="pgfId-1093582"></a>In the Choosing Analyses form select <em>hbnoise </em>analysis. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-90
<a id="pgfId-1093586"></a>hbnoise Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="385" height="709" src="images/chap3-96.gif" /></div></li><li>
<a id="pgfId-1093587"></a>Set the Sweeptype to <em>relative</em>. <br />
<a id="pgfId-1093588"></a>For oscillators, the hbnoise/pnoise frequency range is <em>relative</em>. Specify the harmonic number as appropriate for the system you are simulating. If you are simulating an oscillator by itself, then the harmonic number is likely to be 1. If you have an oscillator and a diode frequency doubler, then the harmonic number is likely to be 2. If you have an oscillator with a frequency divider, in the hb/pss form, you should specify the approximate frequency of oscillation for the frequency-divided signal. In the hbnoise/pnoise form, if the noise is desired on the frequency divided output, then the relative harmonic is 1. If the noise is desired at the output of the oscillator, the relative harmonic number is the divide ratio. The meaning of relative is to take the frequency of the harmonic number specified and add to it the frequencies specified in the Choosing Analyses form. If the oscillator has a 1GHz output, and the pnoise had 1M relative to the first harmonic specified, the actual output frequency is 1G + 1M, or 1001M.<ol><li>
<a id="pgfId-1093589"></a>Type <code>1</code> in the <em>Relative Harmonic</em> field. You are trying to determine the noise associated with the fundamental frequency of the oscillator.<br />
<a id="pgfId-1093590"></a>Next, you will set the output frequency sweep range. Frequency sweep is set for a noise simulation as the noise is spread over the frequency range and it can affect the adjacent frequency channels. Therefore, it is critical to determine its behavior over a frequency range.</li><li>
<a id="pgfId-1093591"></a>Type <code>10</code> in the <em>Start</em> Field in the Output Frequency Sweep Range (Hz) section.</li><li>
<a id="pgfId-1093592"></a>Type <code>100M </code>in the <em>Stop</em> Field in the Output Frequency Sweep Range (Hz) section.<br />
<a id="pgfId-1093593"></a>Set the frequency sweep range as appropriate for your circuit (or application).</li><li>
<a id="pgfId-1093594"></a>Set the <em>Sweep Type</em> to <em>Logarithmic</em>.</li><li>
<a id="pgfId-1093595"></a>Type <code>3</code> in the <em>Points Per Decade</em> field. Typically, 3 to 5 points per decade are a reasonable number to capture the noise behavior of the circuit.</li></ol></li><li>
<a id="pgfId-1093596"></a>Leave the <em>Maximum Sideband</em> field blank. In general, <em>Maximum sideband</em> needs to be set high enough to include all the frequencies that could mix down to the oscillator output frequency. By default, when this field is left blank, all the mixing with all the hb harmonics are present in the hbnoise result. </li><li>
<a id="pgfId-1093597"></a>Set the Output to <em>voltage</em>. <ol><li>
<a id="pgfId-1093598"></a>Type <code>/out </code>in the <em>Positive Output Node</em> field. You can also select the out net from the schematic by clicking the <em>Select</em> button on the right of the <em>Positive Output Node</em> field and then selecting the net just below the out label in schematic.</li><li>
<a id="pgfId-1093599"></a>Leave the <em>Negative Output Node</em> field blank. If the second node that is the <em>Negative Output Node</em> is left blank, it will be connected to the global ground node automatically. However, if you have a differential oscillator, you need to specify both the nodes.<br /><strong class="webflare-fig-line-height">Figure 3-91
<a id="pgfId-1093605"></a>Selecting out net from the schematic</strong><div class="webflare-div-image">
<img width="435" height="195" src="images/chap3-97.gif" /></div></li></ol></li><li>
<a id="pgfId-1093606"></a>The <em>Do Noise</em> option is selected by default. Next, you will set the <em>Noise Type</em>.</li><li>
<a id="pgfId-1211857"></a>Set the <em>Noise Type</em> to <em>timeaverage</em>. Here, the other available options are <em>jitter</em> and <em>timedomain</em>. </li><li>
<a id="pgfId-1236451"></a>Select the<em> ALL(AM,PM,USB,LSB)</em> option.<br />
<a id="pgfId-1253696"></a>Selecting the <em>ALL(AM,PM,USB,LSB)</em> will enable you to view all noise components on the <em>Direct Plot</em> form.</li><li>
<a id="pgfId-1093610"></a>Set Noise Separation to yes. <br />
<a id="pgfId-1093611"></a>The <em>Noise Separation</em> option enables you to plot the individual noise contributors.</li><li>
<a id="pgfId-1093612"></a>The Choosing Analyses form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-92
<a id="pgfId-1093616"></a>Choosing Analyses Form - hbnoise Analysis Setup</strong><div class="webflare-div-image">
<img width="478" height="740" src="images/chap3-98.gif" /></div></li><li>
<a id="pgfId-1093617"></a>You now need to set up the lorentzian option for the hbnoise analysis. <br />
<a id="pgfId-1093618"></a>HBnoise/Pnoise is a small-signal analysis and is not limited by large-signal effects, such as clipping or slew-rate limits. As a result, at low offset frequency, the phase noise might be significantly greater than 0dBc/Hz. This indicates that the noise is larger than the oscillations, which is not physically possible. If you want to see the phase noise curve level off at low frequency, set the lorentzian option to yes.<ol><li>
<a id="pgfId-1093621"></a>At the bottom of the Choosing Analyses form, select <em>Options</em>. This will open Harmonic Balance Noise Options form.</li><li>
<a id="pgfId-1093623"></a>Select yes for lorentzian option in the OUTPUT PARAMETERS section of this form. <br />
<a id="pgfId-1093624"></a>The Harmonic Balance Noise Options Form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-93
<a id="pgfId-1093628"></a>hbnoise Options Setup Form</strong><div class="webflare-div-image">
<img width="454" height="628" src="images/chap3-99.gif" /></div></li></ol></li><li>
<a id="pgfId-1093629"></a>Click <em>OK</em> to close the <em>Harmonic Balance Noise Options</em> form.</li><li>
<a id="pgfId-1093630"></a>Next click <em>OK</em> to close the <em>Choosing Analyses</em> form. This will also add the hbnoise analysis in addition to the hb analysis in the ADE Explorer Analyses section, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-94
<a id="pgfId-1093631"></a>ADE Explorer Simulation Window - hb and hbnoise analysis setup</strong><div class="webflare-div-image">
<img width="668" height="369" src="images/chap3-100.gif" /></div></li></ol>



















































<p>
<a id="pgfId-1269770"></a>Running the simulation</p>
<p class="webflare-indent1">
<a id="pgfId-1269774"></a>Once finished setting up the hb and hbnoise analyses. Click the green icon <img width="35" height="32" src="images/chap3-101.gif" /><span> located on the right side ADE Explorer or on the Schematic window to run the simulation.</span></p>

<p class="webflare-indent1">
<a id="pgfId-1093642"></a>Next, plot the phase noise results and obtain the <em>Noise Summary</em> Table once the simulation is finished.</p>
<p>
<a id="pgfId-1093643"></a>Plotting the results from hb and hbnoise analysis</p>
<p>
<a id="pgfId-1093644"></a>First plot the SSB (single sideband) phase noise, as follows:</p>
<ol><li>
<a id="pgfId-1093645"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>.<br /><strong class="webflare-fig-line-height">Figure 3-95
<a id="pgfId-1093647"></a>hb and hbnoise Direct Plot Form</strong><div class="webflare-div-image">
<img width="668" height="601" src="images/chap3-102.gif" /></div>
<a id="pgfId-1270400"></a>Note that in the Direct Plot form, hbnoise separation analysis is added as you have set Noise Separation to <em>yes</em> in the hbnoise analysis setup form and tstab is added as you have set Save Initial Transient Results (saveinit) to <em>yes</em> in the hb analysis setup form.</li><li>
<a id="pgfId-1270401"></a>Select <em>hbnoise</em> as the Analysis.</li><li>
<a id="pgfId-1237177"></a>Select <em>PM</em> as the Noise Type.</li><li>
<a id="pgfId-1270380"></a>Select Phase Noise as the Function.<br />
<a id="pgfId-1270381"></a>The Direct Plot Form Setup should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-96
<a id="pgfId-1270382"></a>hbnoise Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="668" height="453" src="images/chap3-103.gif" /></div></li><li>
<a id="pgfId-1211848"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1211849"></a>The phase noise is plotted, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-97
<a id="pgfId-1211850"></a>Phase Noise Plot with CorFreq Label</strong><div class="webflare-div-image">
<img width="668" height="462" src="images/chap3-104.gif" /></div>
<a id="pgfId-1093670"></a>The label CorFreq shows an estimate of the point on the phase noise where the phase noise curve in the physical world levels off instead of continuing its rise.</li><li>
<a id="pgfId-1093671"></a>Select <em>File - Close All Windows</em> to close the Graph Window in ViVA.<br />
<a id="pgfId-1093672"></a>Next, you will plot the hbnoise Separation. <br />
<a id="pgfId-1270356"></a>The key aspect in noise analysis is finding out what is causing the noise problem. Hbnoise provides the total noise from all noise frequencies, and in the noise summary, it provides the noise contributors with all the noise frequencies taken into account. The idea of noise separation is several-fold. First, you can identify the noise frequencies that cause the most noise at the output. Once you know the troublesome frequencies, you can identify the troublesome components. Once you know the troublesome components, you can identify the specific mechanisms within the component that are causing the problem. You can then work upon to find the solution to this problem which may include using different device dimensions or alternate circuit architectures and so on.<br />
<a id="pgfId-1270357"></a>To summarize, noise separation is a way of extending standard hbnoise to find out more information about what is causing the problem related to noise. Once the problem is identified, then a solution can be worked upon to fix it.<br />
<a id="pgfId-1270562"></a>When Noise type is set to <em>timeaverage</em> and Noise Separation is set to <em>yes</em> in the <em>Choosing Analyses</em> form while setting hbnoise, the hbnoise separation feature is included during the simulation and the corresponding results are saved.</li><li>
<a id="pgfId-1270563"></a>In the <em>Direct Plot Form</em>, select hbnoise separation in the <em>Analysis</em> section. The <em>Direct Plot Form</em> changes, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-98
<a id="pgfId-1093678"></a>Direct Plot Form for hbnoise Separation</strong><div class="webflare-div-image">
<img width="668" height="600" src="images/chap3-105.gif" /></div></li><li>
<a id="pgfId-1093683"></a>Leave Noise Type selected as <em>PM</em>.</li><li>
<a id="pgfId-1270585"></a>In the <em>Function</em> section, select <em>Sideband Output</em>. Sideband Output plots the noise contribution of selected sidebands to the output.</li><li>
<a id="pgfId-1093684"></a>In the Signal Level section, select <em>V / sqrt(Hz)</em>.</li><li>
<a id="pgfId-1093685"></a>Choose <em>dB20</em> as the Modifier.</li><li>
<a id="pgfId-1093686"></a>Select the <em>-1</em>, <em>0</em>, and <em>1</em> <em>Output Sidebands</em>. <br />
<a id="pgfId-1270627"></a>This will plot the noise contribution of the -1, 0, and 1 sidebands to the output. This allows the identification of which noise frequencies are causing the largest noise contribution at he output of the circuit. <br /><div class="webflare-information-macro webflare-macro-tip">
<a id="pgfId-1093687"></a>
You can click and hold the mouse over the -1 output sideband and slide the cursor to include the 1 output sideband.</div>
<a id="pgfId-1093688"></a>The <em>Direct Plot Form</em> should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-99
<a id="pgfId-1093689"></a>Direct Plot Form setup for hbnoise Separation - Sideband Output</strong><div class="webflare-div-image">
<img width="668" height="754" src="images/chap3-107.gif" /></div></li><li>
<a id="pgfId-1093695"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1093696"></a>The hbnoise separation plot is shown below. Note that the harmonic numbers plotted are in the legend on the left side of the screen. <br /><strong class="webflare-fig-line-height">Figure 3-100
<a id="pgfId-1127865"></a>HBnoise Separation, plot of -1, 0, 1 Sideband</strong><div class="webflare-div-image">
<img width="668" height="560" src="images/chap3-108.gif" /></div></li><li>
<a id="pgfId-1093704"></a>Next, plot the Instance output for the largest noise contributor above (It is the -1 sideband in this case). This will show which components contribute the most noise at the output. In the <em>Direct Plot Form</em>, first set the Plotting Mode to New Win then select Instance Output. Verify that the Signal Level is set to<em> V/sqrt(Hz)</em>. Set the Modifier to dB20. Select the -1 Output sideband. In the <em>Filter</em> section, select Include All Types. In the <em>Truncate</em> section, enter<code> 3<em> </em></code>in by top number of instance output. The <em>Direct Plot Form</em> should look like the one below:<br /><strong class="webflare-fig-line-height">Figure 3-101
<a id="pgfId-1093706"></a>Direct Plot Form for Plotting Instance Output for Noise Contribution of instances</strong><div class="webflare-div-image">
<img width="668" height="780" src="images/chap3-109.gif" /></div></li><li>
<a id="pgfId-1093711"></a>Click <em>Plot</em>. The plot is displayed. There are three plots for the top three noise contributors.<br /><strong class="webflare-fig-line-height">Figure 3-102
<a id="pgfId-1093715"></a>Plotting Output Noise Top Instance Contributors</strong><div class="webflare-div-image">
<img width="668" height="489" src="images/chap3-110.gif" /></div></li><li>
<a id="pgfId-1270889"></a>If you hover your mouse over a particular trace, it will show which instance contributes the most amount of noise. Above, the red line represents the noise contribution from the instance Q0 (legend shown), the yellow line below represents the noise contribution from instance R2, and the bottom green line represents the noise contribution from instance D0.</li><li>
<a id="pgfId-1093718"></a>Next, plot the Source Output so you can see which individual noise sources within the circuit are contributing the most noise. In the <em>Direct Plot Form</em>, change the Function to Source Output. Select Signal Level to be V/sqrt(Hz). Set the Modifier to dB20. Leave the Output Sideband at -1. In the Filter section, select the Include All Types option. In the Truncate section, type <code>3</code> in the <em>by top </em>field. The <em>Direct Plot Form</em> should look like the one below.<br /><strong class="webflare-fig-line-height">Figure 3-103
<a id="pgfId-1093719"></a>Direct Plot Form for Plotting by Top 3 Source Noise Contributors</strong><div class="webflare-div-image">
<img width="668" height="755" src="images/chap3-111.gif" /></div></li><li>
<a id="pgfId-1093725"></a>Plot the source output so you can see which individual noise sources within the circuit that are making the most noise.<br /><strong class="webflare-fig-line-height">Figure 3-104
<a id="pgfId-1093726"></a>Top 3 Source Noise Contributors</strong><div class="webflare-div-image">
<img width="668" height="464" src="images/chap3-112.gif" /></div></li><li>
<a id="pgfId-1093731"></a>Note that the top three Source Output contributors are displayed in the legend on the left side of the graph: Q0:fn, R3:rn and Q0:ib. Here &#8220;fn&#8221; is the flicker noise, &#8220;ib&#8221; is the base current shot noise of BJT and &#8220;rn&#8221; is the resistor thermal noise. See Chapter 3 in this guide for more information on the various noise parameters.</li><li>
<a id="pgfId-1093732"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. </li><li>
<a id="pgfId-1128434"></a>In the ViVA window, choose <em>File - Close All Windows</em>.</li></ol>










































































<p>
<a id="pgfId-1093733"></a><strong>Noise Summary Table</strong></p>
<p>
<a id="pgfId-1093734"></a>This table provides the list of noise contributors based on the selections made on the Noise Summary Table form.</p>
<ol><li>
<a id="pgfId-1093735"></a>In ADE Explorer, select <em>Results -Print - Noise Summary</em>.<br /><strong class="webflare-fig-line-height">Figure 3-105
<a id="pgfId-1093739"></a>Print Noise Summary in ADE Explorer</strong><div class="webflare-div-image">
<img width="629" height="358" src="images/chap3-113.gif" /></div>
<a id="pgfId-1128711"></a>The Results Display Window and Noise Summary form are displayed. The Results Display Window will currently be blank, as shown below:<br /><strong>Figure 3-106
<a id="pgfId-1128773"></a>Results Display Window</strong><div class="webflare-div-image">
<img width="351" height="245" src="images/chap3-114.gif" /></div>
<a id="pgfId-1093745"></a>The Noise Summary form is shown below.<br /><strong>Figure 3-107
<a id="pgfId-1093749"></a>Noise Summary Setup Form</strong><div class="webflare-div-image">
<img width="596" height="412" src="images/chap3-115.gif" /></div></li><li>
<a id="pgfId-1211844"></a>In the Noise Summary window, set Data from as <em>hbnoise_pm</em>.</li><li>
<a id="pgfId-1211845"></a>Set <em>Type</em> as <em>spot noise</em>.</li><li>
<a id="pgfId-1237847"></a>Set <em>Frequency Spot (Hz)</em> to <code>10K</code>. In spot noise, you will be looking at the noise at one frequency.</li><li>
<a id="pgfId-1093752"></a>Click Include All types in the <em>Filter</em> section. This will include the noise contributions from all devices including resistor, inductor and so on.</li><li>
<a id="pgfId-1093753"></a>In the Truncate and Sort section, enter <code>10</code> in the top field. The top 10 noise contributors in the <em>Results Display</em> window are displayed.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1093754"></a>You can shorten your noise summary either:</div><ul><li>
<a id="pgfId-1093755"></a><em>by number </em>- that is, by specifying the highest contributors to include in the summary, <br />
<a id="pgfId-1093756"></a>or </li><li>
<a id="pgfId-1093757"></a><em>by relative threshold </em>- that is, by specifying the percentage of noise a device must contribute to be included in the summary, <br />
<a id="pgfId-1093758"></a>or </li><li>
<a id="pgfId-1093759"></a><em>by absolute threshold </em>- that is by specifying the level of noise a device must contribute to be included in the summary.</li></ul></li><li>
<a id="pgfId-1093760"></a>Click <em>OK</em>. <br />
<a id="pgfId-1093761"></a>The noise summary results are displayed in the Results Display Window, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-108
<a id="pgfId-1093765"></a>Noise Summary Results Display Window</strong><div class="webflare-div-image">
<img width="498" height="485" src="images/chap3-116.gif" /></div>
<a id="pgfId-1211837"></a>The Results Display Window lists the individual contributors, the specific noise mechanism within the semiconductors causing the noise, and the noise contribution. The Total Summarized Noise is shown at the bottom of the Results Display window. Since there is no Input Source present, so there is no input referred noise available. This is usually the case for oscillators.<br />
<a id="pgfId-1093767"></a>Note that the output noise include the noise from all the noise contributors, and not just the contributors in the form.</li><li>
<a id="pgfId-1093768"></a>In the Results Display Window, select <em>Window - Close </em>to close the window.</li><li>
<a id="pgfId-1211832"></a>Close the Analog Design Environment window by selecting <em>Session</em> - <em>Quit</em>.</li><li>
<a id="pgfId-1211834"></a>In the Schematic window, choose <em>File</em> - <em>Close</em>.</li></ol>








































<p>
<a id="pgfId-1093772"></a>In this section, one of the key measurements of Oscillator design, that is, phase noise measurement was explained along with obtaining the noise summary.</p>
<p>
<a id="pgfId-1093773"></a>Next, you will perform Swept HB measurements, that is Tuning Voltage vs. Oscillation Frequency and Phase Noise vs. Tuning Voltage Measurements.</p>

<h2>
<a id="pgfId-1129447"></a><a id="92864"></a>Oscillator Swept Tuning Range and Phase Noise Measurement</h2>

<p>
<a id="pgfId-1129448"></a>In this section, you will sweep the oscillator tuning range while running multiple HB/HBnoise analyses. This will give the information about phase noise vs. tuning range. </p>

<h4>
<a id="pgfId-1093779"></a>O<a id="OpeningTline3oscRF"></a>pening the Oscillator Circuit in the Schematic Window</h4>

<ol><li>
<a id="pgfId-1093780"></a>In CIW, select <em>File - Open</em>.<br /><strong class="webflare-fig-line-height">Figure 3-109
<a id="pgfId-1093784"></a>Virtuoso CIW Window - Opening Cellview</strong><div class="webflare-div-image">
<img width="515" height="183" src="images/chap3-117.gif" /></div>
<a id="pgfId-1093786"></a>The Open File form is displayed. <br /><strong>Figure 3-110
<a id="pgfId-1129584"></a>Open File Form to open the oscillator_ckt cell&#8217;s Schematic View.</strong><div class="webflare-div-image">
<img width="626" height="358" src="images/chap3-118.gif" /></div></li><li>
<a id="pgfId-1093787"></a>Select <em>ExampleLibRF </em>from the <em>Library</em> drop-down list.</li><li>
<a id="pgfId-1093788"></a>In the <em>Cells </em>field, type <code>oscillator_ckt</code>.</li><li>
<a id="pgfId-1093789"></a>Choose <em>schematic</em> from the <em>View </em>drop-down list.</li><li>
<a id="pgfId-1129538"></a>In the Application section, select <em>Schematic L </em>from the <em>Open With </em>drop-down list.</li><li>
<a id="pgfId-1129542"></a>Leave Open For to <em>Edit</em> (which is set by default)</li><li>
<a id="pgfId-1093796"></a>Click <em>OK</em>.<br />
<a id="pgfId-1271293"></a>This will open the oscillator_ckt schematic in Virtuoso Schematic Editor L window.<br /><strong class="webflare-fig-line-height">Figure 3-111
<a id="pgfId-1129693"></a>Oscillator Schematic in VSE-L Window<a id="OpeningTline3oscRF"></a></strong><div class="webflare-div-image">
<img width="642" height="457" src="images/chap3-119.gif" /></div></li></ol>



















<h3>
<a id="pgfId-1093804"></a>Setting up the HB and HBnoise Analysis</h3>

<ol><li>
<a id="pgfId-1093805"></a>In the Schematic Window, select <em>Launch - ADE Explorer</em>.<br /><strong class="webflare-fig-line-height">Figure 3-112
<a id="pgfId-1093809"></a>Opening ADEL window from VSE window</strong><div class="webflare-div-image">
<img width="656" height="353" src="images/chap3-120.gif" /></div></li><li>
<a id="pgfId-1294686"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1294687"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-113
<a id="pgfId-1294688"></a>Create new ADE Explorer view</strong><div class="webflare-div-image">
<img width="631" height="339" src="images/chap3-121.gif" /></div></li><li>
<a id="pgfId-1093810"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1294672"></a>ADE Explorer is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-114
<a id="pgfId-1093814"></a>Virtuoso ADE Explorer</strong><div class="webflare-div-image">
<img width="623" height="380" src="images/chap3-122.gif" /></div></li><li>
<a id="pgfId-1093816"></a>Select <em>Setup</em> - <em>Simulator </em>in the ADE Explorer<br />
<a id="pgfId-1093818"></a>The Choosing Simulator form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-115
<a id="pgfId-1130122"></a>Choosing Simulator/Director/Host Form</strong><div class="webflare-div-image">
<img width="652" height="92" src="images/chap3-123.gif" /></div></li><li>
<a id="pgfId-1093820"></a>Select <em>spectre</em> as the Simulator.</li><li>
<a id="pgfId-1185973"></a>Click <em>OK </em>to close the <em>Choosing Simulator</em> form.</li><li>
<a id="pgfId-1271444"></a>In ADE Explorer, select <em>Setup - High Performance Simulation</em>. <br />
<a id="pgfId-1271456"></a>The <em>High Performance Simulation Options</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-116
<a id="pgfId-1185933"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="614" height="575" src="images/chap3-124.gif" /></div></li><li>
<a id="pgfId-1211829"></a>In the High Performance Simulation Options window, select APS. <br />
<a id="pgfId-1271490"></a>Note that Auto is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 64) and then multi-thread on all the available cores. Usually, it is better to specify the number of threads yourself. Small circuits should use a small number of threads, and larger circuits can use more threads. The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.</li><li>
<a id="pgfId-1130328"></a>Click <em>OK</em> to close the High Performance Simulation Options form.</li><li>
<a id="pgfId-1093841"></a>In ADE Explorer, select <em>Outputs - Save All</em>.<br />
<a id="pgfId-1093842"></a>The Save Options form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-117
<a id="pgfId-1130517"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="650" height="658" src="images/chap3-125.gif" /></div></li><li>
<a id="pgfId-1093843"></a>In the Select signals to output (save) section, make sure that <em>allpub</em> is selected.<br />
<a id="pgfId-1093848"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1093849"></a>To save the currents, use the <em>Select device currents (currents)</em> option, and select nonlinear if you just want to save the device currents, or all if you want to save all the currents in the circuit. When you save currents, more disk space is required for the results file. </li><li>
<a id="pgfId-1093850"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1093852"></a>In ADE Explorer, select <em>Setup - Simulation Files.</em><br />
<a id="pgfId-1130634"></a>The <em>Simulation Files Setup</em> form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-118
<a id="pgfId-1130697"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="619" height="333" src="images/chap3-126.gif" /></div></li><li>
<a id="pgfId-1093853"></a>In the Simulation Files Setup form, enter<code> ./ </code>by clicking in the Include Paths section.</li><li>
<a id="pgfId-1093858"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1093859"></a>Select <em>Setup &#8211; Model Libraries</em>.The Model Library Setup form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-119
<a id="pgfId-1130807"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="636" height="232" src="images/chap3-127.gif" /></div></li><li>
<a id="pgfId-1211825"></a>In the Model File field, type the path to the model file including the file name, as follows:<br />
<a id="pgfId-1219146"></a><code>models/modelsRF.scs</code><br />
<a id="pgfId-1211818"></a>You can also browse to the modelsRF.scs file. </li><li>
<a id="pgfId-1093868"></a>Click <em>OK</em> to close the Model Library Setup form.</li><li>
<a id="pgfId-1093869"></a>Select <em>Analyses - Choose</em>.<br />
<a id="pgfId-1093870"></a>The Choosing Analyses form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-120
<a id="pgfId-1093871"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="465" height="471" src="images/chap3-128.gif" /></div></li><li>
<a id="pgfId-1093876"></a>Select hb in the Analysis section. The form expands.<br /><strong class="webflare-fig-line-height">Figure 3-121
<a id="pgfId-1093880"></a>The Choosing Analyses Form - Setting hb analysis</strong><div class="webflare-div-image">
<img width="392" height="803" src="images/chap3-129.gif" /></div></li><li>
<a id="pgfId-1131129"></a>In the Transient-Aided Options, leave Run Transient? as <em>Decide automatically </em>which is set by default. <br />
<a id="pgfId-1271789"></a>The other choices for this option are Yes and No. If Yes is selected, then the Detect Steady State option becomes active and the Stop Time(tstab) field is also activated. This means that you can decide whether you would like the Steady State to be detected automatically during the transient run or not and also specify a Stop time(tstab) for that transient run. When you select the checkbox for Detect Steady State option, this will run tran until steady-state is detected and then switches to hb.</li><li>
<a id="pgfId-1093883"></a>Select <em>yes</em> for the Save Initial Transient Results (saveinit) option. This will help in visualizing the buildup of the oscillation waveform.</li><li>
<a id="pgfId-1211809"></a>Select <em>Frequencies</em> in Tones section (This is selected by default). The other option is Names. The <em>Names</em> option when selected, is similar to the pss Harmonic Balance analysis setup.</li><li>
<a id="pgfId-1093885"></a>Enter <code>1.7G </code>in Fundamental Frequency field. </li><li>
<a id="pgfId-1271815"></a>Set the Number of Harmonics option to <code>20</code>. <br />
<a id="pgfId-1271828"></a>When Number of Harmonics is set to <code>auto</code>, the simulator calculates tone-1 harmonics automatically. The calculation is based on Fourier analysis of transient steady-state waveforms. </li><li>
<a id="pgfId-1093886"></a>Leave the Oversample Factor option to <code>1</code> by default. Since the oscillator has sinusoidal waveforms, an oversample of 1 is appropriate.</li><li>
<a id="pgfId-1093887"></a>Set the Freqdivide Ratio for the Tone 1 option to <code>1 </code>as there is no frequency divider in the circuit. If there is a frequency divider in the circuit then you need to set the Freqdivide Ratio for Tone 1 to the divide ratio of the divider. For example, if the divider is divide-by-two then the divide ratio is 2. Therefore, you will set Freqdivide Ratio for Tone 1 to 2.</li><li>
<a id="pgfId-1093888"></a>Leave the Harmonics option as is which is set to <em>Default</em>.</li><li>
<a id="pgfId-1093889"></a>In the Accuracy Defaults (errpreset) section, select <em>conservative</em>. conservative is typically used because very small amplitude phase noise measurements are normally desired. Conservative is recommended for all the oscillators.</li><li>
<a id="pgfId-1093890"></a>Select Oscillator. This is required for simulating an autonomous circuit.<br /><strong class="webflare-fig-line-height">Figure 3-122
<a id="pgfId-1093894"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="388" height="151" src="images/chap3-130.gif" /></div>
<a id="pgfId-1093895"></a>Selecting the Oscillator button changes the Tone1 name in the Tones section to osc!.</li><li>
<a id="pgfId-1093896"></a>In the Oscillator section, in <em>Oscillator node+ </em>field, click <em>Select</em> just to the right of this field. In the schematic, select the out node. Instead of selecting the node from the schematic you can also type <code>/out </code>in the Oscillator node field. This oscillator node will be used by Spectre for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it. </li><li>
<a id="pgfId-1271902"></a>Leave the <em>Oscillator node- </em>blank.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1093897"></a>If you have a single-ended oscillator, only specify one node. If the second node, that is, <em>Oscillator node- </em>is left blank, it will be connected to the global ground node automatically. However, if you have differential oscillator, you need to specify both the nodes.</div><strong>Figure 3-123
<a id="pgfId-1093901"></a>Selecting out net from the schematic</strong><div class="webflare-div-image">
<img width="333" height="191" src="images/chap3-131.gif" /></div></li><li>
<a id="pgfId-1271913"></a>If you have an LC oscillator, leave the <em>Calculate initial conditions (ic) automatically </em>checkbox selected (this is the default).<br />
<a id="pgfId-1271914"></a>Note that Calculate initial conditions (ic) automatically is used to start the oscillator. Other methods to start the oscillator include putting a single current pulse into the resonator, setting initial conditions(ic), or ramping up the power at time = zero plus.</li><li>
<a id="pgfId-1211806"></a>Note that by default <em>Use the probe-based solution method</em> (oscmethod) option is deselected. Spectre will use the <em>onetier</em> method. In <em>onetier</em> method, the frequency and voltage spectrum are solved simultaneously in one single set of nonlinear equations. <br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1211803"></a>When <em>Use the probe-based solution method </em>option is selected/enabled, it iterates for the frequency solution in the outer loop and the amplitude and phase solution in the inner loop. The probe-based method has better convergence but is computation intensive. </div>
<a id="pgfId-1093906"></a>Refer to <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a></em> for more details.</li><li>
<a id="pgfId-1093907"></a>Click Sweep. This will enable the sweeping of tuning voltage (in this case it is named as vtune) which is explained below.</li><li>
<a id="pgfId-1093908"></a>Click Select Design Variable. The <em>Select Design Variable</em> window is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-124
<a id="pgfId-1131554"></a>Choosing vtune in Select Design Variable Form during HB Analysis setup</strong><div class="webflare-div-image">
<img width="668" height="287" src="images/chap3-132.gif" /></div></li><li>
<a id="pgfId-1093909"></a>In the Select Design Variable window, select vtune.</li><li>
<a id="pgfId-1093916"></a>Click <em>OK</em> to close the Select Design Variable form.</li><li>
<a id="pgfId-1093917"></a>In the Sweep Range section, type <code>0.2</code> in the <em>Start</em> field.</li><li>
<a id="pgfId-1211794"></a>Type <code>3.4</code> in the <em>Stop</em> field.</li><li>
<a id="pgfId-1211795"></a>By default, the Sweep Type is set to Linear. </li><li>
<a id="pgfId-1271991"></a>Type <code>0.4 </code>in the <em>Step Size</em> field.<br />
<a id="pgfId-1211796"></a>The Choosing Analyses form should like the figure below:<br /><strong class="webflare-fig-line-height">Figure 3-125
<a id="pgfId-1093925"></a>Choosing Analysis Form - swept hb Analysis Setup</strong><div class="webflare-div-image">
<img width="463" height="774" src="images/chap3-133.gif" /></div>
<a id="pgfId-1093926"></a>Click Apply at the bottom of the Choosing Analyses form. This will add hb analysis with sweep setup in the <em>Analyses</em> section of ADE window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-126
<a id="pgfId-1093927"></a>ADE Explorer Simulation Window - hb analysis setup</strong><div class="webflare-div-image">
<img width="668" height="365" src="images/chap3-134.gif" /></div></li></ol>

























































































































<h4>
<a id="pgfId-1093932"></a>Setting up the HBnoise analysis</h4>

<p>
<a id="pgfId-1093933"></a>This analysis is set to do the phase noise measurement. hbnoise analysis is a small signal analyses run after hb analysis.</p>
<ol><li>
<a id="pgfId-1186530"></a>In the Choosing Analyses form, select hbnoise. The form expands.<br /><strong class="webflare-fig-line-height">Figure 3-127
<a id="pgfId-1093938"></a>The Choosing Analyses Form - hbnoise Analysis Setup</strong><div class="webflare-div-image">
<img width="422" height="772" src="images/chap3-135.gif" /></div></li><li>
<a id="pgfId-1093939"></a>Set the Sweep Type to <em>relative</em>.<br />
<a id="pgfId-1093940"></a>For oscillators, the hbnoise/pnoise frequency range is relative. Specify the harmonic number as appropriate for the system you are simulating. If you are simulating an oscillator by itself, then the harmonic number is likely to be 1. If you have an oscillator and a diode frequency doubler, then the harmonic number is likely to be 2. If you have an oscillator with a frequency divider, in the hb/pss form, you should specify the approximate frequency of oscillation for the frequency-divided signal. In the hbnoise/pnoise form, if the noise is desired on the frequency divided output, then the relative harmonic is 1. If the noise is desired at the output of the oscillator, the relative harmonic number is the divide ratio. The meaning of relative is to take the frequency of the harmonic number specified and add to it the frequencies specified in the Choosing Analyses form. If the oscillator had a 1GHz output, and the pnoise had 1M relative to the first harmonic specified, the actual output frequency is 1G + 1M, or 1001M.<ol><li>
<a id="pgfId-1093941"></a>Type <code>1</code> in the Relative Harmonic field as you are simulating an oscillator by itself.</li><li>
<a id="pgfId-1093942"></a>Select<em> Single Point</em> for Output Frequency Sweep Range. </li><li>
<a id="pgfId-1272226"></a>Type <code>1M</code> in the Freq Field. In general, the hbnoise frequency would be set as appropriate for your application.</li></ol></li><li>
<a id="pgfId-1093943"></a>Leave the Maximum Sideband field blank. <br />
<a id="pgfId-1272241"></a>In general, <em>Maximum sideband</em> needs to be set high enough to include all the frequencies that could mix down to the oscillator output frequency. By default, it should match the number of harmonics set in HB analysis.</li><li>
<a id="pgfId-1093944"></a>Set the Output to <em>voltage</em>. <ol><li>
<a id="pgfId-1093945"></a>Type /out in the Positive Output Node field. You can also select out net from schematic by clicking the Select button on the right of the Positive Output Node field and then selecting the net just below the out label in schematic. </li><li>
<a id="pgfId-1275645"></a>Leave the Negative Output Node field blank. If the second node, that is, the Negative Output Node is left blank, it will be connected to the global ground node automatically. However, if you have differential oscillator, you need to specify both the nodes.<br /><strong class="webflare-fig-line-height">Figure 3-128
<a id="pgfId-1275646"></a>Selecting out net from the schematic</strong><div class="webflare-div-image">
<img width="435" height="184" src="images/chap3-136.gif" /></div></li></ol></li><li>
<a id="pgfId-1275658"></a>Select the <em>ALL(AM,PM,USB,LSB)</em> option.<br />
<a id="pgfId-1093954"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-129
<a id="pgfId-1093958"></a>Choosing Analysis Form - hbnoise Analysis Setup</strong><div class="webflare-div-image">
<img width="395" height="758" src="images/chap3-137.gif" /></div></li><li>
<a id="pgfId-1211790"></a>Click <em>OK</em> to close the Choosing Analyses form. <br />
<a id="pgfId-1273014"></a>This will add hbnoise analysis along with hb analysis in the <em>Analyses</em> section of ADE Explorer, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-130
<a id="pgfId-1211791"></a>ADE Explorer Simulation Window - hb and hbnoise analysis setup</strong><div class="webflare-div-image">
<img width="668" height="365" src="images/chap3-138.gif" /></div></li></ol>






























<p>
<a id="pgfId-1211787"></a>Running the simulation</p>
<p>
<a id="pgfId-1093970"></a>Once finished setting up the hb and hbnoise analyses click the green icon <img width="33" height="26" src="images/chap3-139.gif" /><span> on the right of the ADE Explorer window or on the Schematic window to run the simulation.</span></p>

<p>
<a id="pgfId-1093971"></a>Next, plot the results when the simulation is finished.</p>
<p>
<a id="pgfId-1093972"></a>Plotting the results</p>
<p>
<a id="pgfId-1093973"></a>First plot the oscillator output frequency.</p>
<ol><li>
<a id="pgfId-1093974"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>.<br /><strong class="webflare-fig-line-height">Figure 3-131
<a id="pgfId-1093978"></a>Swept hb and hbnoise Analysis Direct Plot Form</strong><div class="webflare-div-image">
<img width="325" height="682" src="images/chap3-140.gif" /></div></li><li>
<a id="pgfId-1093979"></a>In the <em>Direct Plot Form</em>, select <em>New Win</em>.</li><li>
<a id="pgfId-1238709"></a>Select <em>hb</em> in the <em>Analysis</em> section. This is selected by default.</li><li>
<a id="pgfId-1093980"></a>Select <em>Harmonic Frequency </em>in the <em>Function</em> section.</li><li>
<a id="pgfId-1093981"></a>In the <em>Harmonic Frequency</em> section, select the first harmonic. This will plot only the change in first harmonic of the oscillation frequency vs. change in oscillator&#8217;s tune voltage.<br />
<a id="pgfId-1093982"></a>The Direct Plot Form setup should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-132
<a id="pgfId-1093986"></a>Swept hb Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="327" height="539" src="images/chap3-141.gif" /></div></li><li>
<a id="pgfId-1093987"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1093988"></a>The oscillator tuning range is plotted. You can see from the plot that as you increase the tuning voltage, the oscillator frequency increases.<br /><strong class="webflare-fig-line-height">Figure 3-133
<a id="pgfId-1093990"></a>Swept HB Measurement Plot - vtune vs. osc frequency variation plot</strong><div class="webflare-div-image">
<img width="668" height="436" src="images/chap3-142.gif" /></div></li><li>
<a id="pgfId-1093995"></a>Select <em>File - Close All Windows</em> to close ViVA.</li></ol>




















<p>
<a id="pgfId-1093996"></a>Next plot the phase noise.</p>
<ol><li>
<a id="pgfId-1093997"></a>In the <em>Direct Plot Form</em>, select <em>New Win</em>.</li><li>
<a id="pgfId-1093998"></a>Select <em>hbnoise</em> in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1238761"></a>Select <em>PM</em> in the <em>Type</em> section.</li><li>
<a id="pgfId-1093999"></a>Select <em>Phase Noise</em> in the <em>Function</em> section.<br />
<a id="pgfId-1094000"></a>The Direct Plot Form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-134
<a id="pgfId-1094002"></a>hbnoise Direct Plot Setup</strong><div class="webflare-div-image">
<img width="668" height="459" src="images/chap3-143.gif" /></div></li><li>
<a id="pgfId-1094008"></a>Click <em>Plot</em>. This will plot the Single Sideband Phase Noise vs. Relative Frequency graph, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-135
<a id="pgfId-1094012"></a>Phase Noise vs. Relative Frequency Plot</strong><div class="webflare-div-image">
<img width="619" height="597" src="images/chap3-144.gif" /></div>
<a id="pgfId-1273418"></a>In the above plot, you have a graph of phase noise vs. relative frequency. Next, you will modify the phase noise plot to provide more useful information. In the next few steps you will plot phase noise vs. tuning voltage.</li><li>
<a id="pgfId-1273419"></a>In the plot window, right-click one of the numbers on the X Axis, and select <em>Swap Sweep Var </em>from the context menu.<br /><strong class="webflare-fig-line-height">Figure 3-136
<a id="pgfId-1094018"></a>X-Axis - Right Mouse Button (RMB) - Object Menu</strong><div class="webflare-div-image">
<img width="193" height="160" src="images/chap3-145.gif" /></div></li><li>
<a id="pgfId-1094020"></a>In Select Sweep Var form which opens, select <em>vtune</em> from the <em>Sweep Variables</em> drop-down list. Keep Plot Destination as <em>New SubWindow</em>.<br /><strong class="webflare-fig-line-height">Figure 3-137
<a id="pgfId-1094024"></a>Swap Sweep Var Dialog Box Window</strong><div class="webflare-div-image">
<img width="338" height="197" src="images/chap3-146.gif" /></div></li><li>
<a id="pgfId-1094026"></a>Click <em>OK</em> to close the Swap Sweep Var form.<br />
<a id="pgfId-1094027"></a>The waveform tool draws a new subwindow.<br /><strong class="webflare-fig-line-height">Figure 3-138
<a id="pgfId-1094028"></a>vtune vs. Phase Noise Plot</strong><div class="webflare-div-image">
<img width="668" height="534" src="images/chap3-147.gif" /></div>
<a id="pgfId-1094033"></a>If you look at the graph on the right, you will see that the phase noise is worse at the lower end of the tuning range.</li><li>
<a id="pgfId-1094034"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. </li><li>
<a id="pgfId-1132853"></a>In the waveform window, choose <em>File - Close All Windows</em>.</li><li>
<a id="pgfId-1094035"></a>Clean up the screen for the next set of measurements.<ol><li>
<a id="pgfId-1273497"></a>Close ADE Explorer by selecting <em>Session - Quit</em>.</li><li>
<a id="pgfId-1273499"></a>In the Schematic window, select <em>File - Close</em>.</li></ol></li></ol>





































<h4>
<a id="pgfId-1094039"></a>Summary</h4>

<p>
<a id="pgfId-1187035"></a>In this section, Tuning Voltage vs. Oscillation Frequency and Phase Noise vs. Tuning Voltage Measurements were done.</p>

<h2>
<a id="pgfId-1094041"></a>Ring Oscillator Measurements</h2>

<p>
<a id="pgfId-1094042"></a>In this section, you will perform measurements on Ring Oscillator. </p>

<h3>
<a id="pgfId-1211777"></a><a id="56103"></a><a id="88603"></a>Starting and Stabilization of Ring O<a id="marker-1211776"></a>scillators</h3>

<p>
<a id="pgfId-1211778"></a>To simulate a Ring Oscillator, it is recommended to use Shooting PSS analysis as they are highly non-linear in nature. Recent improvements in harmonic balance allows ring oscillators to be simulated in hb as well. In this case, set the oversample factor to 4. In the tstab interval, or in the transient analysis, measure the fastest slew rate for the rising and falling edges, and calculate the zero to 100% transition time based on this slew rate measurement. Set the number of harmonics to at least the period of the oscillations divided by the transition time. You can first start the oscillator by supplying initial conditions(ICs). You should choose initial conditions such that a transient analysis displays the correct oscillation frequency (and amplitude) at the output of the ring oscillator. This is the actual check that your initial conditions are working to start the oscillator. As a suggestion, in a ring oscillator, you set the output of one stage high or low. If the oscillator configuration is differential, then set the output of 1 stage high on one differential net, and low on the other differential net for the same stage.</p>
<p>
<a id="pgfId-1094048"></a>Regardless of which technique you use to start the oscillator, allow the oscillator to run long enough to stabilize before you start the Shooting phase and compute the steady state solution. Adjust the <em>tstab</em> parameter to supply the additional stabilization time, a value of 2-3 periods is recommended.</p>
<p>
<a id="pgfId-1094049"></a>It is recommended to save the initial transient simulation results. This can be done by setting saveinit=yes. You can use this to verify that the oscillator has started up and is stable.</p>
<p>
<a id="pgfId-1094050"></a>In the case of Injection Locked Ring Oscillator where you apply a signal (vsource) to your ring oscillator which causes the oscillator to oscillate at the injection frequency makes it a driven circuit - as it is driven by the injection source. Thus, in this case, you do not use an autonomous PSS analysis. In order to do that, you do not click the <em>Oscillator</em> option on the PSS <em>Choosing Analyses</em> form for such oscillators. SpectreRF considers this type of circuit a driven circuit and will error out if you click the <em>Oscillator</em> option on the PSS <em>Choosing Analyses</em> form. </p>
<p>
<a id="pgfId-1094052"></a>See <em>Oscillators and Autonomous PSS Analysis</em> in the <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a></em> for more information on oscillator simulation.</p>

<h3>
<a id="pgfId-1094053"></a>The Oscillator Circuit</h3>

<p>
<a id="pgfId-1094054"></a>This example computes the periodic steady state solution and the phase noise for the <em>Ring oscillator </em>circuit shown in Figure <a href="chap3.html#91436">3-139</a>.</p>
<p>
<a id="pgfId-1094058"></a>This is a four stage fully differential ring oscillator designed at 1.9GHz.</p>

<p><strong>Figure 3-139
<a id="pgfId-1133244"></a><a id="91436"></a>Schematic for the Ring Oscillator Circuit ringOsc_1900M</strong></p>
<div class="webflare-div-image">
<img width="636" height="344" src="images/chap3-148.gif" /></div>
<h2>
<a id="pgfId-1094066"></a>Simulating the Oscillator Circuit</h2>
<h4>
<a id="pgfId-1094068"></a>O<a id="OpeningTline3oscRF"></a>pening the Oscillator Circuit in the Schematic Window</h4>

<ol><li>
<a id="pgfId-1094070"></a>In the Command Interpreter Window (CIW), choose <em>File</em><em> &#8211;&gt; </em><em>Open</em>.<br /><strong class="webflare-fig-line-height">Figure 3-140
<a id="pgfId-1094074"></a>Virtuoso CIW Window - Opening Cellview</strong><div class="webflare-div-image">
<img width="634" height="172" src="images/chap3-149.gif" /></div>
<a id="pgfId-1094076"></a>The <em>Open File</em> form is displayed. <br /><strong class="webflare-fig-line-height">Figure 3-141
<a id="pgfId-1133401"></a>Open File Form to open the testbench_1900M cell&#8217;s Schematic View</strong><div class="webflare-div-image">
<img width="617" height="331" src="images/chap3-150.gif" /></div></li><li>
<a id="pgfId-1133421"></a>Select <em>ExampleLibRF </em>from the <em>Library </em>drop-down list.</li><li>
<a id="pgfId-1187257"></a>In the <em>Cells </em>field, type <em>VC_Ring_Osc_Diff</em>.</li><li>
<a id="pgfId-1187258"></a>Choose <em>schematic</em> from the <em>View drop-down list</em>.</li><li>
<a id="pgfId-1187259"></a>In the Application field, select <em>Schematic L</em> from the Open With drop-down list.</li><li>
<a id="pgfId-1133358"></a>Leave Open For to <em>Edit</em> (which is set by default).</li><li>
<a id="pgfId-1211755"></a>Once all the setup is done, click <em>OK</em>.</li><li>
<a id="pgfId-1211756"></a>This will open the VC_Ring_Osc_Diff schematic in Virtuoso Schematic Editor L window, as shown below:<a id="OpeningTline3oscRF"></a><br /><strong class="webflare-fig-line-height">Figure 3-142
<a id="pgfId-1094092"></a>VC_Ring_Osc_Diff schematic in VSE-L Window</strong><div class="webflare-div-image">
<img width="645" height="486" src="images/chap3-151.gif" /></div></li></ol>



















<h2>
<a id="pgfId-1094094"></a>Calculating the Steady-State Solution using PSS Shooting Analysis</h2>

<p>
<a id="pgfId-1094095"></a>This example computes the periodic steady state solution for the <em>VC_Ring_Osc_Diff </em>oscillator circuit. You perform a <code>PSS-</code>Shooting analysis first because the periodic steady state solution must be determined before you can perform any other periodic small-signal analysis, such as pnoise to determine phase noise.</p>

<h3>
<a id="pgfId-1094096"></a>Setting up the PSS Analysis</h3>

<ol><li>
<a id="pgfId-1094097"></a>In the Schematic Window, select <em>Launch - ADE Explorer</em>.<br /><strong class="webflare-fig-line-height">Figure 3-143
<a id="pgfId-1094102"></a>Opening ADE Explorer window from VSE window</strong><div class="webflare-div-image">
<img width="656" height="376" src="images/chap3-152.gif" /></div></li><li>
<a id="pgfId-1273694"></a>Click OK in the Create new ADE Explorer view form.<br /><strong class="webflare-fig-line-height">Figure 3-144
<a id="pgfId-1273708"></a>Create new ADE Explorer view Form</strong><div class="webflare-div-image">
<img width="656" height="285" src="images/chap3-153.gif" /></div>
<a id="pgfId-1273695"></a>ADE Explorer Window opens, as shown below.<br /><strong>Figure 3-145
<a id="pgfId-1211752"></a>Virtuoso ADE Explorer Window</strong><div class="webflare-div-image">
<img width="624" height="362" src="images/chap3-154.gif" /></div></li><li>
<a id="pgfId-1094108"></a>Select <em>Setup &#8211; Simulator</em>.<br />
<a id="pgfId-1094110"></a>The Choosing Simulator form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-146
<a id="pgfId-1133858"></a>Choosing Simulator/Director/Host Form</strong><div class="webflare-div-image">
<img width="610" height="96" src="images/chap3-155.gif" /></div></li><li>
<a id="pgfId-1094112"></a>Select <em>spectre</em> from the Simulator drop-down list.</li><li>
<a id="pgfId-1094122"></a>Click <em>OK</em> to close the Choosing Simulator form.</li><li>
<a id="pgfId-1094124"></a>Set up the High Performance Simulation options.<br />
<a id="pgfId-1094125"></a>In ADE Explorer, select <em>Setup - High Performance Simulation</em>. The High Performance Simulation Options form is displayed.<br />
<a id="pgfId-1094126"></a>In the High Performance Simulation Options form, select <em>APS</em>. Note that <em>Auto</em> is selected for Multithreading options. The effect of this is to detect the number of cores on the system (up to 64) and then multi-thread on all the available cores. Usually it is better to specify the number of threads yourself. Small circuits should use a small number of threads, and larger circuits can use more threads. The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.<br /><strong class="webflare-fig-line-height">Figure 3-147
<a id="pgfId-1094131"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="662" height="564" src="images/chap3-156.gif" /></div></li><li>
<a id="pgfId-1094132"></a>Click <em>OK</em> to close the High Performance Simulation Options form.</li><li>
<a id="pgfId-1094133"></a>Select <em>Outputs - Save All.</em><br />
<a id="pgfId-1094134"></a>The Save Options form is displayed.</li><li>
<a id="pgfId-1094135"></a>In the Select signals to output(save) section, make sure that <em>allpub</em> is selected.<br /><strong class="webflare-fig-line-height">Figure 3-148
<a id="pgfId-1094139"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="655" height="665" src="images/chap3-157.gif" /></div>
<a id="pgfId-1134197"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1134198"></a>To save the currents, select the <em>Select device currents (currents) </em>option, and select nonlinear if you just want to save the device currents, or all if you want to save all the currents in the circuit. When you save currents, more disk space is required for the results file. </li><li>
<a id="pgfId-1094142"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1094144"></a>Select <em>Setup - Simulation Files</em>.</li><li>
<a id="pgfId-1094145"></a>In the Simulation Files Setup form which gets opened, enter<code> ./ </code>by clicking in the Include Paths section. The form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-149
<a id="pgfId-1094149"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="668" height="359" src="images/chap3-158.gif" /></div></li><li>
<a id="pgfId-1094151"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1094152"></a>Select <em>Setup - Model Libraries</em>.<br />
<a id="pgfId-1094153"></a>The Model Library Setup form is displayed.</li><li>
<a id="pgfId-1094154"></a>In the Model File field, type the path to the model file including the file name, as shown below.<br />
<a id="pgfId-1211730"></a><code>share/gpdk180_v3.3/models/spectre/gpdk.scs.</code><br /><strong class="webflare-fig-line-height">Figure 3-150
<a id="pgfId-1211731"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="664" height="245" src="images/chap3-159.gif" /></div>
<a id="pgfId-1211736"></a>You can also browse to gpdk.scs file and then set the <em>Section</em> to stat. </li><li>
<a id="pgfId-1094161"></a>Click <em>OK</em> to close the Model Library Setup form.</li><li>
<a id="pgfId-1094162"></a>Click <em>Analyses - Choose... </em>in ADE Explorer.<br />
<a id="pgfId-1094163"></a>The Choosing Analyses form is displayed. <br /><strong class="webflare-fig-line-height">Figure 3-151
<a id="pgfId-1094167"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="467" height="425" src="images/chap3-160.gif" /></div></li><li>
<a id="pgfId-1094169"></a>In the Analysis section, select <em>pss</em>. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-152
<a id="pgfId-1094170"></a>The Choosing Analyses Form- Setting PSS Analysis</strong><div class="webflare-div-image">
<img width="381" height="716" src="images/chap3-161.gif" /></div></li><li>
<a id="pgfId-1094176"></a>In the Engine section, verify that <em>Shooting</em> is selected (this is the default).</li><li>
<a id="pgfId-1094177"></a>In the Beat Frequency field, type <code>1.9G</code>. The frequency entered here is an approximate frequency of oscillation.</li><li>
<a id="pgfId-1094178"></a>In the Number of harmonics field, type <code>20</code>.<br />
<a id="pgfId-1094179"></a>In general, you want to choose a number that is high enough to capture the nonlinearity of the circuit.</li><li>
<a id="pgfId-1094180"></a>In the Accuracy Defaults (errpreset) section, select <em>conservative</em>. <br />
<a id="pgfId-1274114"></a>conservative is typically used because very small amplitude phase noise measurements are normally desired. <em>conservative</em> is recommended for all oscillators.</li><li>
<a id="pgfId-1239343"></a>Select <em>yes</em> for <em>Run Transient</em>.</li><li>
<a id="pgfId-1094181"></a>Type <code>2n</code> in the Stop Time (tstab) field. tstab is typically set to about 2-3 periods of the oscillation frequency for ring oscillator circuits. The tstab should be long enough so that the oscillator must reach near the steady-state behavior during this phase of simulation. This would result in better convergence.</li><li>
<a id="pgfId-1094182"></a>Select <em>yes</em> for Save Initial Transient Results. This will help in visualizing the buildup of the oscillation waveform.</li><li>
<a id="pgfId-1094183"></a>Select the <em>Oscillator</em> option. This is required for simulating an autonomous circuit. The oscillator section expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-153
<a id="pgfId-1094187"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="454" height="132" src="images/chap3-162.gif" /></div></li><li>
<a id="pgfId-1094189"></a>In the Oscillator node+ field, click <em>Select</em> to the right. In the schematic, select the Int4 node. This oscillator node will be used by the simulator for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it.<br /><strong class="webflare-fig-line-height">Figure 3-154
<a id="pgfId-1094194"></a>Selecting Int4 net on schematic</strong><div class="webflare-div-image">
<img width="616" height="308" src="images/chap3-163.gif" /></div></li><li>
<a id="pgfId-1094196"></a>Deselect the Calculate initial conditions (ic) automatically checkbox. This is because selecting this checkbox only works for feedback oscillators while ring oscillator is not a feedback oscillator. Therefore, selecting this checkbox will not be able to find an oscillatory state for ring oscillator.<br />
<a id="pgfId-1274358"></a>The <em>Choosing Analysis</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-155
<a id="pgfId-1094200"></a>Choosing Analyses Form - PSS-Shooting Setup</strong><div class="webflare-div-image">
<img width="363" height="748" src="images/chap3-164.gif" /></div></li><li>
<a id="pgfId-1094202"></a>Click <em>OK</em>.<br />
<a id="pgfId-1274384"></a>This will close the <em>Choosing Analyses</em> form. In addition, this will add the pss analysis in the Analyses section of ADE Explorer, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-156
<a id="pgfId-1094207"></a>ADE Explorer Simulation Window - PSS Analysis</strong><div class="webflare-div-image">
<img width="616" height="365" src="images/chap3-165.gif" /></div>
<a id="pgfId-1094209"></a>Setting initial conditions forces the circuit to a specific state at the time zero timepoint, and then removes that force after the time zero point is calculated.<br />
<a id="pgfId-1094210"></a>In this case, we will set one stage of the oscillator so that one differential output is high, and one differential output (in the same stage) is low.<br />
<a id="pgfId-1134930"></a>This defines all the nodes in the circuit, and the nodes that are connected to the nodes that are forced are pulling as hard as they can to get the forced nodes to change to the other state. When the forcing condition is removed, this action starts the oscillations.<br />
<a id="pgfId-1134931"></a>Set the initial conditions by choosing <em>Simulation</em> - <em>Convergence Aids</em> - <em>Initial Condition</em> in ADE Explorer, as shown below -<br /><strong class="webflare-fig-line-height">Figure 3-157
<a id="pgfId-1094213"></a>PSS Analysis - Setting  Initial Condition in ADE</strong><div class="webflare-div-image">
<img width="668" height="414" src="images/chap3-166.gif" /></div>
<a id="pgfId-1094218"></a>The Select Initial Condition Set form is displayed.</li><li>
<a id="pgfId-1094219"></a>Type <code>0</code> (zero) in the <em>Node Voltage</em> field.</li><li>
<a id="pgfId-1094220"></a>Select <em>Int4_Bar</em> node in the schematic. Note that the node highlights in the schematic. </li><li>
<a id="pgfId-1094221"></a>Click <em>Apply</em>.</li><li>
<a id="pgfId-1094222"></a>Type <code>3.3 </code>in the <em>Node Voltage</em> field.</li><li>
<a id="pgfId-1094223"></a>Select the <em>Int4</em> node in the schematic. Note that the node highlights in the schematic.<br />
<a id="pgfId-1094226"></a>The populated Select Initial Condition Set dialog box would look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-158
<a id="pgfId-1094227"></a>Setting Initial Condition Form</strong><div class="webflare-div-image">
<img width="668" height="224" src="images/chap3-167.gif" /></div></li><li>
<a id="pgfId-1094232"></a>Click <em>OK</em>.<br />
<a id="pgfId-1274418"></a>This finishes the setting of PSS Analysis with setting up of Initial Conditions.</li></ol>

























































































































<h3>
<a id="pgfId-1094233"></a>Running the PSS analysis</h3>

<p>
<a id="pgfId-1094237"></a>Once finished setting up the PSS analysis, click the green icon <img width="36" height="31" src="images/chap3-168.gif" /><span> on the right side of ADE Explorer or on the Schematic window to run the simulation.</span></p>

<p>
<a id="pgfId-1094238"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</p>
<p>
<a id="pgfId-1094239"></a>Next, you will plot the results.</p>

<h4>
<a id="pgfId-1094240"></a>Plotting the PSS Analysis Results</h4>

<ol><li>
<a id="pgfId-1094241"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>. <br /><strong class="webflare-fig-line-height">Figure 3-159
<a id="pgfId-1094242"></a>Invoking Direct Plot Form</strong><div class="webflare-div-image">
<img width="668" height="405" src="images/chap3-169.gif" /></div>
<a id="pgfId-1094248"></a>The <em>Direct Plot Form</em> is displayed. <br />
<a id="pgfId-1135286"></a>You will see that there is pss analysis and tstab analysis in the <em>Analysis</em> section although you have only run pss analysis. The tstab analysis gets added as part of pss analysis run and is used to plot the initial transient waveforms.<br /><strong class="webflare-fig-line-height">Figure 3-160
<a id="pgfId-1135290"></a>The Direct Plot Form </strong><div class="webflare-div-image">
<img width="477" height="643" src="images/chap3-170.gif" /></div>
<a id="pgfId-1094255"></a>Plot the oscillator startup waveform from the tstab run.</li><li>
<a id="pgfId-1094256"></a>In the <em>Direct Plot Form</em>, select <em>tstab</em> in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1094257"></a>Leave Function as <em>PSS Transient V</em> which is set by default.</li><li>
<a id="pgfId-1094258"></a>Select <em>Net</em> in the center of the form. (This is the default. You can also select differential nets).<br />
<a id="pgfId-1094259"></a>The Direct Plot Form window should like the following:<br /><strong class="webflare-fig-line-height">Figure 3-161
<a id="pgfId-1094260"></a>PSS Analysis Direct Plot Setup - Initial Transient</strong><div class="webflare-div-image">
<img width="668" height="277" src="images/chap3-171.gif" /></div></li><li>
<a id="pgfId-1094265"></a>Select the Int4 net in the schematic. It is located just below the Int4 label.<br /><strong class="webflare-fig-line-height">Figure 3-162
<a id="pgfId-1094269"></a>Selecting Int4 net on schematic</strong><div class="webflare-div-image">
<img width="585" height="308" src="images/chap3-172.gif" /></div>
<a id="pgfId-1094270"></a>The waveform window is displayed, as shown below.<br /><strong>Figure 3-163
<a id="pgfId-1094271"></a>PSS Analysis Initial Transient Voltage Waveform</strong><div class="webflare-div-image">
<img width="668" height="559" src="images/chap3-173.gif" /></div></li></ol>





























<p>
<a id="pgfId-1094276"></a>You can see from the plot that the initial transient waveform is for 4.63158ns as mentioned in the Output log window. The oscillator is in steady state.</p>
<p>
<a id="pgfId-1094277"></a>Next, you will plot the oscillator output spectrum.</p>
<ol><li>
<a id="pgfId-1094280"></a>In the <em>Direct Plot Form</em>, set the Plotting Mode to <em>New Win</em>.</li><li>
<a id="pgfId-1094281"></a>Select <em>pss</em> in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1094282"></a>Leave <em>Function</em> as <em>Voltage</em>, which is set by default.</li><li>
<a id="pgfId-1094283"></a>Select <em>Net</em> in the center of the form. (This is the default. You can also select differential nets).</li><li>
<a id="pgfId-1094284"></a>Select <em>spectrum</em> in the Sweep section. (This is the default)</li><li>
<a id="pgfId-1094285"></a>Select <em>rms</em> in the <em>Signal Level </em>section (the default is peak).</li><li>
<a id="pgfId-1094286"></a>Select <em>dB20</em> in the <em>Modifier</em> section.<br />
<a id="pgfId-1094287"></a>The Direct Plot Form window should like the following:<br /><strong class="webflare-fig-line-height">Figure 3-164
<a id="pgfId-1094288"></a>PSS Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="321" height="645" src="images/chap3-174.gif" /></div></li><li>
<a id="pgfId-1094293"></a>Select Int4 net in the schematic. It is located just below the Int4 label.<br /><strong class="webflare-fig-line-height">Figure 3-165
<a id="pgfId-1094297"></a>Selecting Int4 net on schematic</strong><div class="webflare-div-image">
<img width="600" height="308" src="images/chap3-175.gif" /></div>
<a id="pgfId-1094298"></a>The waveform window is displayed, as shown below.<br /><strong>Figure 3-166
<a id="pgfId-1094302"></a>PSS Analysis output Graph Window - Voltage Spectrum Plot</strong><div class="webflare-div-image">
<img width="614" height="479" src="images/chap3-176.gif" /></div></li><li>
<a id="pgfId-1094304"></a>In the waveform window, position your cursor near the first harmonic, and press the <em>m</em> key. Here <em>m</em> is the bindkey to place a trace marker on the graph. The first harmonic is chosen as this is the frequency oscillator is designed for.<br /><strong class="webflare-fig-line-height">Figure 3-167
<a id="pgfId-1094306"></a>PSS Analysis output Graph Window - Voltage Spectrum Plot (with marker placed)</strong><div class="webflare-div-image">
<img width="668" height="463" src="images/chap3-177.gif" /></div></li><li>
<a id="pgfId-1094312"></a>Note that this frequency is 1.9649GHz. This is the frequency of oscillation.</li><li>
<a id="pgfId-1094313"></a>In the <em>Direct Plot Form</em>, click <em>Cancel</em>. In the waveform window, choose File - Close All Windows.</li><li>
<a id="pgfId-1188202"></a>Clean up the screen for the next set of measurements.<ol><li>
<a id="pgfId-1188203"></a>Close the ADE Explorer by selecting <em>Session - Quit</em>.</li></ol></li></ol>






























<p>
<a id="pgfId-1211727"></a>To summarize, a PSS analysis was set up using the Shooting Method and a simulation was run to determine the oscillation frequency of the oscillator. </p>
<p>
<a id="pgfId-1211721"></a>Next, you will perform the FM jitter value measurements.</p>

<h2>
<a id="pgfId-1211723"></a><a id="92289"></a>FM Jitter Measurement using PSS Shooting and Pnoise Jitter Analyses</h2>

<p>
<a id="pgfId-1094321"></a>This example computes the periodic steady state solution using the shooting method for the <em>VC_Ring_Osc_Diff </em>oscillator circuit. It then runs a periodic small-signal analysis pnoise to determine the FM jitter values of the oscillator. You perform a <code>pss-</code>shooting analysis first because the periodic steady state solution must be determined before you can perform any other periodic small-signal analysis like pnoise, pxf etc. to determine phase noise or transfer function and so on.</p>

<h3>
<a id="pgfId-1094323"></a><a id="53473"></a>Determining FM Jitter</h3>

<p>
<a id="pgfId-1094324"></a>FM jitter calculates a standard averaged phase noise measurement, and also the AM and PM components from the modulated analysis, and adds the ability to integrate the phase noise curve to calculate the cycle jitter or the cycle-to-cycle jitter. The jitter calculations are integrated into the <em>Direct Plot Form</em> in ADE Explorer. All the measurements are averaged over the oscillator cycle.</p>
<p>
<a id="pgfId-1136079"></a>PM Jitter is like the timedomain jitter measurement. You specify a threshold voltage and the timing jitter is calculated. In PM Jitter, a quantitative jitter measurement can be made from the direct plot form.</p>
<p>
<a id="pgfId-1211715"></a>You may also refer to <a actuate="user" class="URL" href="../spectreRFinExplorer/Chap3.html" show="replace" xml:link="simple"></a><h-hot>Chapter 3: Frequency Domain Analyses: Harmonic Balance</h-hot> in the Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide for more details on AM and PM Jitter.</p>
<p>
<a id="pgfId-1211716"></a>In this measurement, you will perform the FM jitter measurement and plot the cycle jitter Jc.</p>

<h3>
<a id="pgfId-1211717"></a>Setting up the PSS Analysis</h3>

<ol><li>
<a id="pgfId-1094330"></a>In the Schematic Window, choose Launch - ADE Explorer.<br /><strong class="webflare-fig-line-height">Figure 3-168
<a id="pgfId-1094334"></a>Opening ADEL window from VSE window</strong><div class="webflare-div-image">
<img width="656" height="349" src="images/chap3-178.gif" /></div></li><li>
<a id="pgfId-1294827"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1294828"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-169
<a id="pgfId-1294829"></a>Create new ADE Explorer view</strong><div class="webflare-div-image">
<img width="624" height="304" src="images/chap3-179.gif" /></div></li><li>
<a id="pgfId-1094335"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1294817"></a>ADE Explorer is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-170
<a id="pgfId-1094339"></a>Virtuoso ADE Explorer Window</strong><div class="webflare-div-image">
<img width="627" height="364" src="images/chap3-180.gif" /></div></li><li>
<a id="pgfId-1136301"></a>Select <em>Setup &#8211; Simulator </em>in ADE Explorer.<br />
<a id="pgfId-1136302"></a>The Choosing Simulator form is displayed.</li><li>
<a id="pgfId-1136329"></a>Select spectre for the Simulator.<br /><strong class="webflare-fig-line-height">Figure 3-171
<a id="pgfId-1094352"></a>Choosing Simulator Form</strong><div class="webflare-div-image">
<img width="663" height="99" src="images/chap3-181.gif" /></div></li><li>
<a id="pgfId-1094354"></a>Click <em>OK</em> to close the <em>Choosing Simulator</em> form.</li><li>
<a id="pgfId-1094356"></a>Set up the High Performance Simulation Options.<br />
<a id="pgfId-1094357"></a>In the ADE Explorer, select <em>Setup - High Performance Simulation.</em> The High Performance Simulation Options window is displayed.<br />
<a id="pgfId-1094358"></a>In the High Performance Simulation Options window, select APS. Note that Auto is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 64) and then multi-thread on all the available cores. Usually it is better to specify the number of threads yourself. Small circuits should use a small number of threads, and larger circuits can use more threads. The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.<br /><strong class="webflare-fig-line-height">Figure 3-172
<a id="pgfId-1094363"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="662" height="543" src="images/chap3-182.gif" /></div></li><li>
<a id="pgfId-1094364"></a>Click <em>OK</em> to close the High Performance Simulation Options form.</li><li>
<a id="pgfId-1094365"></a>Select <em>Outputs - Save All</em>.<br />
<a id="pgfId-1094366"></a>The Save Options form is displayed.</li><li>
<a id="pgfId-1094367"></a>In the Select signals to output(save) section, make sure that <em>allpub</em> is selected.<br /><strong class="webflare-fig-line-height">Figure 3-173
<a id="pgfId-1094371"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="655" height="650" src="images/chap3-183.gif" /></div>
<a id="pgfId-1094372"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1094373"></a>To save the currents, use the <em>Select device currents (currents) </em>option, and select <em>nonlinear</em> if you just want to save the device currents, or all if you want to save all the currents in the circuit. When you save currents, more disk space is required for the results file. </li><li>
<a id="pgfId-1094374"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1094376"></a>Select <em>Setup - Simulation Files</em>.</li><li>
<a id="pgfId-1094377"></a>In the Simulation Files Setup form which gets opened, enter <code>./</code> by clicking in the Include Paths section. It should look like as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-174
<a id="pgfId-1094381"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="653" height="349" src="images/chap3-184.gif" /></div></li><li>
<a id="pgfId-1094383"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1094384"></a>Select <em>Setup &#8211; Model Libraries</em>.<br />
<a id="pgfId-1094385"></a>The Model Library Setup form is displayed.</li><li>
<a id="pgfId-1094386"></a>In the Model File field, type the path to the model file including the file name, as follows:<br />
<a id="pgfId-1094387"></a><code>share/gpdk180_v3.3/models/spectre/gpdk.scs</code>.<br /><strong class="webflare-fig-line-height">Figure 3-175
<a id="pgfId-1094391"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="643" height="234" src="images/chap3-185.gif" /></div>
<a id="pgfId-1094392"></a>You can also browse to gpdk.scs file. </li><li>
<a id="pgfId-1094393"></a>Set the Section to <code>stat</code>. </li><li>
<a id="pgfId-1094394"></a>Click <em>OK</em> to close the form.</li><li>
<a id="pgfId-1094395"></a>In ADE Explorer, select <em>Analyses - Choose</em>.<br />
<a id="pgfId-1094396"></a>The Choosing Analyses form is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-176
<a id="pgfId-1094400"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="508" height="482" src="images/chap3-186.gif" /></div></li><li>
<a id="pgfId-1094401"></a>Select <em>pss</em> as <em>Analysis</em>. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-177
<a id="pgfId-1094402"></a>The Choosing Analyses Form- Setting PSS Analysis</strong><div class="webflare-div-image">
<img width="382" height="734" src="images/chap3-187.gif" /></div></li><li>
<a id="pgfId-1094407"></a>In the Engine section, verify that Shooting is selected (this is the default).</li><li>
<a id="pgfId-1094408"></a>In the Beat Frequency field, type <code>1.9G</code>. The frequency entered here is an approximate frequency of oscillation.</li><li>
<a id="pgfId-1094409"></a>In the Number of harmonics field, type <code>20</code>.<br />
<a id="pgfId-1275332"></a>In general, you want to choose a number that is high enough to capture the nonlinearity of the circuit. Start with 10, and run the simulation. Increase by about 50% to 15 and re-run the simulation. If the harmonics do not change appreciably, then 10 is enough. If they change, raise the number again by about 50%. Use the smallest number of harmonics for the answer to be stable.</li><li>
<a id="pgfId-1094411"></a>In the Accuracy Defaults (errpreset) section, select <em>conservative</em>. <br />
<a id="pgfId-1275320"></a>conservative is typically used because very small amplitude phase noise measurements are normally desired. <em>conservative</em> is recommended for all the oscillators.</li><li>
<a id="pgfId-1239734"></a>Select <em>yes</em> for<em> Run Transient</em>.</li><li>
<a id="pgfId-1094412"></a>Type <code>2n</code> in the Stop time (tstab) field. tstab is typically set to about 2-3 periods of the oscillation frequency for ring oscillator circuits.</li><li>
<a id="pgfId-1094413"></a>Select yes for <em>Save Initial Transient Results</em>. This will help in visualizing the buildup of the oscillation waveform.</li><li>
<a id="pgfId-1094414"></a>Select the Oscillator option. This is required for simulating an autonomous circuit. The oscillator section expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-178
<a id="pgfId-1094418"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="393" height="126" src="images/chap3-188.gif" /></div></li><li>
<a id="pgfId-1137019"></a>In the Oscillator node+ field, click Select just to the right. In the schematic, select the Int4 node. This oscillator node will be used by the simulator for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it.</li><li>
<a id="pgfId-1137020"></a>Deselect the <em>Calculate initial conditions (ic) automatically </em>checkbox. This is because selecting this checkbox only works for feedback oscillators while ring oscillator is not a feedback oscillator. Therefore, selecting this checkbox will not be able to find an oscillatory state for ring oscillator.<br /><strong class="webflare-fig-line-height">Figure 3-179
<a id="pgfId-1094424"></a>Selecting Int4 net on schematic</strong><div class="webflare-div-image">
<img width="525" height="308" src="images/chap3-189.gif" /></div>
<a id="pgfId-1094426"></a>The Choosing Analyses form should looks like the following:<br /><strong>Figure 3-180
<a id="pgfId-1094430"></a>Choosing Analyses Form - PSS-Shooting Method Setup</strong><div class="webflare-div-image">
<img width="423" height="785" src="images/chap3-190.gif" /></div></li><li>
<a id="pgfId-1094431"></a>Click <em>Ok</em>. <br />
<a id="pgfId-1275424"></a>This will close the <em>Choosing Analyses</em> form. In addition, this will add the pss analysis in the <em>Analyses</em> section of ADE Explorer, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-181
<a id="pgfId-1094435"></a>ADE Explorer Simulation Window - PSS Analysis</strong><div class="webflare-div-image">
<img width="620" height="364" src="images/chap3-191.gif" /></div>
<a id="pgfId-1094436"></a>Next, set the initial conditions, which forces the circuit to a specific state at the time zero timepoint, and then removes that force after the time zero point is calculated.<br />
<a id="pgfId-1094437"></a>In this case, we will set one stage of the oscillator so that one differential output is high, and one differential output (in the same stage) is low.<br />
<a id="pgfId-1094438"></a>This defines all the nodes in the circuit, and the nodes that are connected to the nodes that are forced are pulling as hard as they can to get the forced nodes to change to the other state. When the forcing condition is removed, this action starts the oscillations.<br />
<a id="pgfId-1211684"></a>Set the initial conditions by choosing <em>Simulation - Convergence Aids - Initial Condition</em> in ADE Explorer, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-182
<a id="pgfId-1211685"></a>PSS Analysis - Setting  Initial Condition in ADE Explorer</strong><div class="webflare-div-image">
<img width="668" height="416" src="images/chap3-192.gif" /></div>
<a id="pgfId-1094445"></a>This will open the Select Initial Condition Set dialog box.</li><li>
<a id="pgfId-1094446"></a>Type <code>0</code> (zero) in the <em>Node Voltage</em> field.</li><li>
<a id="pgfId-1094447"></a>Select the <em>Int4_Bar</em> node in the schematic. Note that the node highlights in the schematic. </li><li>
<a id="pgfId-1094448"></a>Click <em>Apply</em>.</li><li>
<a id="pgfId-1094449"></a>Type <code>3.3</code> in the <em>Node Voltage</em> field.</li><li>
<a id="pgfId-1094450"></a>Select the <em>Int4</em> node in the schematic. Note that the node highlights in the schematic.</li><li>
<a id="pgfId-1094451"></a>Click <em>OK</em>.<br />
<a id="pgfId-1094453"></a>The populated Select Initial Condition Set dialog box would look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-183
<a id="pgfId-1094454"></a>Setting Initial Condition Form</strong><div class="webflare-div-image">
<img width="668" height="212" src="images/chap3-193.gif" /></div>
<a id="pgfId-1094459"></a>This finishes the setting of PSS Analysis with setting up of Initial Conditions.</li></ol>




























































































































<h4>
<a id="pgfId-1094460"></a>Setting up the Pnoise analysis</h4>

<p>
<a id="pgfId-1094461"></a>This analysis is set to do the phase noise measurement. It is run after pss analysis.</p>
<ol><li>
<a id="pgfId-1094462"></a>In the Choosing Analyses form, select pnoise. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-184
<a id="pgfId-1094466"></a>The Choosing Analyses Form - pnoise Analysis Setup</strong><div class="webflare-div-image">
<img width="371" height="709" src="images/chap3-194.gif" /></div></li><li>
<a id="pgfId-1094467"></a>Set the Sweep Type to relative. <br />
<a id="pgfId-1094468"></a>For oscillators, the hbnoise/pnoise frequency range is relative. Specify the harmonic number as appropriate for the system you are simulating. If you are simulating an oscillator by itself, then the harmonic number is likely to be 1. If you have an oscillator and a diode frequency doubler, then the harmonic number is likely to be 2. If you have an oscillator with a frequency divider, in the hb/pss <em>Choosing Analyses</em> form, you should specify the approximate frequency of oscillation for the frequency-divided signal. In the hbnoise/pnoise <em>Choosing Analyses </em>form, if the noise is desired on the frequency divided output, then the relative harmonic is 1. If the noise is desired at the output of the oscillator, the relative harmonic number is the divide ratio. The meaning of relative is to take the frequency of the harmonic number specified and add to it the frequencies specified in the Choosing Analyses form. If the oscillator had a 1GHz output, and the pnoise had 1M relative to the first harmonic specified, the actual output frequency is 1G + 1M, or 1001M.<ol><li>
<a id="pgfId-1211680"></a>Type <code>1</code> in the Relative Harmonic field as you are simulating an oscillator by itself.<br />
<a id="pgfId-1211681"></a>Next, you will set the output frequency sweep range. Frequency sweep is set for a noise simulation as the noise is spread over the frequency range. Oscillator phase noise adds phase uncertainty for phase modulated signals. Note that BPSK, QPSK, and all QAM signals have phase information in the constellation. If the LO signal has phase noise on it, it makes it harder to demodulate the signals because there is more spread in the phase of the received signal.Therefore, it is critical to determine its behavior over a frequency range.</li><li>
<a id="pgfId-1211673"></a>In the Output Frequency Sweep Range (Hz) section, type <code>10K </code>in the Start Field.</li><li>
<a id="pgfId-1211674"></a>Type <code>1G</code> in the Stop Field.<br />
<a id="pgfId-1094473"></a>Set the frequency sweep range as appropriate for your circuit (or application).</li><li>
<a id="pgfId-1211668"></a>Set the <em>Sweep Type</em> to <em>Logarithmic</em>.</li><li>
<a id="pgfId-1211669"></a>Type <code>4</code> in the <em>Points Per Decade</em> field. Typically, 3 to 5 points per decade are a reasonable number to capture the noise behavior of the circuit.</li></ol></li><li>
<a id="pgfId-1094476"></a>In the Sidebands section, choose <em>fullspectrum</em> as the <em>Method</em>.</li><li>
<a id="pgfId-1094477"></a>Leave the Maximum Sideband field blank. Since <em>fullspectrum</em> is set, and the oscillator frequency is well above 100KHz, the <em>Maximum sideband</em> field should be left blank. </li><li>
<a id="pgfId-1094478"></a>Set the Output to <em>voltage</em>. <ol><li>
<a id="pgfId-1094479"></a>Type <code>/V4P</code> in the Positive Output Node field. You can also select V4P net from schematic by clicking <em>Select</em> on the right of the Positive Output Node field and then selecting the net just below the out label in schematic. </li><li>
<a id="pgfId-1094480"></a>Type <code>/V4M</code> in the Negative Output Node field. If the second node, that is, the Negative Output Node is left blank, it will be connected to the global ground node automatically. However, if you have differential oscillator, you need to specify both the nodes.</li></ol></li><li>
<a id="pgfId-1094483"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop down list.</li><li>
<a id="pgfId-1239924"></a>Select the <em>ALL(AM,PM,USB,LSB)</em> option.<br /><strong class="webflare-fig-line-height">Figure 3-185
<a id="pgfId-1094487"></a>Selecting V4P and V4M net from the schematic</strong><div class="webflare-div-image">
<img width="565" height="300" src="images/chap3-195.gif" /></div>
<a id="pgfId-1094489"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-186
<a id="pgfId-1094493"></a>Choosing Analysis Form - pnoise Analysis Setup</strong><div class="webflare-div-image">
<img width="395" height="784" src="images/chap3-196.gif" /></div></li><li>
<a id="pgfId-1211664"></a>Click <em>OK</em> to close the Choosing Analyses form. <br />
<a id="pgfId-1275779"></a>This will add the pnoise analysis along with pss analysis in the <em>Analyses</em> section of ADE Explorer, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-187
<a id="pgfId-1211665"></a>ADE Explorer Simulation Window - pss and pnoise-jitter analysis setup</strong><div class="webflare-div-image">
<img width="668" height="382" src="images/chap3-197.gif" /></div></li></ol>






































<h3>
<a id="pgfId-1094501"></a>Running the PSS and Pnoise analysis</h3>

<p>
<a id="pgfId-1094505"></a>Once finished setting up the PSS and Pnoise Analyses click the green icon <img width="34" height="30" src="images/chap3-198.gif" /><span> on the right of ADE Explorer or on the Schematic window to run the simulation.</span></p>

<p>
<a id="pgfId-1094506"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</p>
<p>
<a id="pgfId-1094507"></a>Next, you will plot the results.</p>
<p>
<a id="pgfId-1094508"></a>Plotting the results</p>
<p>
<a id="pgfId-1094509"></a>First Plot the oscillator phase noise based on pnoise analysis -</p>
<ol><li>
<a id="pgfId-1094510"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>.<br />
<a id="pgfId-1094516"></a>The <em>Direct Plot Form</em> is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-188
<a id="pgfId-1094520"></a>pss and pnoise Analysis Direct Plot Form</strong><div class="webflare-div-image">
<img width="351" height="686" src="images/chap3-199.gif" /></div></li><li>
<a id="pgfId-1094521"></a>In the <em>Direct Plot Form</em>, select <em>pnoise</em> in the <em>Analysis</em> section. The form changes.</li><li>
<a id="pgfId-1240400"></a>Select <em>PM</em> in the <em>Type</em> section.</li><li>
<a id="pgfId-1094522"></a>Select <em>Phase Noise</em> in the <em>Function</em> section.<br />
<a id="pgfId-1094523"></a>The Direct Plot Form Setup should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-189
<a id="pgfId-1094527"></a>pss and pnoise FM jitter Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="408" height="387" src="images/chap3-200.gif" /></div></li><li>
<a id="pgfId-1138728"></a>Click Plot.<br />
<a id="pgfId-1138729"></a>The oscillator phase noise curve is plotted. This is a Single Sideband (SSB) Plot.<br /><strong class="webflare-fig-line-height">Figure 3-190
<a id="pgfId-1094530"></a>Phase Noise (SSB) plot from pnoise Analysis</strong><div class="webflare-div-image">
<img width="668" height="483" src="images/chap3-201.gif" /></div></li></ol>



















<p>
<a id="pgfId-1211645"></a>Next, plot the Jc (cycle or period) jitter value.</p>
<ol><li>
<a id="pgfId-1211646"></a>In the <em>Direct Plot Form</em>, select <em>Jc</em> in the <em>Function</em> section. <br />
<a id="pgfId-1291385"></a>The form expands. Jc is cycle or period jitter while Jcc is cycle-to-cycle or period-to-period jitter. </li><li>
<a id="pgfId-1094572"></a>Leave Number of Cycles (k) as <code>1</code> (which is set by default). <br />
<a id="pgfId-1291418"></a>Number of cycles determines whether one period or k-periods jitter will be computed. In this example, you are going to determine only one cycle Jc (cycle) jitter.</li><li>
<a id="pgfId-1094573"></a>Leave Signal Level as <em>rms</em> (this is selected by default). rms jitter is typically used.</li><li>
<a id="pgfId-1094574"></a>In the Modifier section, leave the default selection as <em>Second</em>. <br />
<a id="pgfId-1291435"></a>Here, the other options are UI which is Unit interval, and ppm which is parts per million. Select the <em>Modifier</em> value based on the units you are using in your design specifications.</li><li>
<a id="pgfId-1094576"></a>Leave the Freq. Multiplier  set to <code>1</code> (which is the default value). <br />
<a id="pgfId-1291458"></a>Use the Freq. Multiplier parameter when the selected output is not at the PSS fundamental/beat frequency.</li><li>
<a id="pgfId-1211640"></a>Fill in the <em>Start Frequency (Hz) </em>and <em>Stop Frequency (Hz)</em> fields. These are the limits of integration to determine jitter. The appropriate values are included either in the jitter specifications or in the verification methodology. The best values to use also depend on the circuit properties. For a small <em>Number of Cycles [k]</em>, such as a short observation time of one or a few periods, the lower frequency noise does not contribute much to either Jc or Jcc jitter. For a larger <em>Number of Cycles [k]</em>, the lower frequency noise is important. <br />
<a id="pgfId-1211641"></a>Refer to the <em>Jitter Measurements Using SpectreRF</em> Application Note for more information on how to set up the lower limit of the integration.<br /><strong class="webflare-fig-line-height">Figure 3-191
<a id="pgfId-1094578"></a>Direct Plot pnoise jitter Jc Setup</strong><div class="webflare-div-image">
<img width="668" height="634" src="images/chap3-202.gif" /></div><ol><li>
<a id="pgfId-1211636"></a>Click <em>Plot</em>. This will calculate the Jc (cycle jitter) value and the value of Jc will appear on the plot as a label, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-192
<a id="pgfId-1211637"></a>Jc value as label on Phase Noise Plot</strong><div class="webflare-div-image">
<img width="668" height="653" src="images/chap3-203.gif" /></div></li></ol></li></ol>



















<p>
<a id="pgfId-1094589"></a>Since the Jc value appears as a label on the plot, it is important that there is a plot window already open when the Jc value is plotted/calculated. </p>
<p>
<a id="pgfId-1094591"></a><a id="25662"></a>To summarize, PSS analysis using Shooting Engine and Pnoise was setup and simulation was run to determine the FM jitter of the oscillator.</p>
<p>
<a id="pgfId-1094592"></a>Next you will determine the tuning range and phase noise of the Ring Oscillator.</p>

<h2>
<a id="pgfId-1094599"></a><a id="13224"></a>Calculating the Swept Tuning Range and Phase Noise for the Ring Oscillator</h2>

<p>
<a id="pgfId-1189449"></a>This example computes the swept periodic steady state solution using the shooting method for the <em>VC_Ring_Osc_Diff </em>oscillator circuit. You will sweep the tuning voltage to determine its effect on oscillation frequency. It then runs a periodic small-signal analysis pnoise to determine the phase noise of the oscillator. You perform a <code>PSS-</code>Shooting analysis first because the periodic steady state solution must be determined before you can perform any other periodic small-signal analysis, such as pnoise pxf to determine phase noise or transfer function and so on.</p>

<h3>
<a id="pgfId-1094601"></a>Setting up the PSS Analysis</h3>

<ol><li>
<a id="pgfId-1094602"></a>In the Schematic Window, choose Launch - ADE Explorer.<br /><strong class="webflare-fig-line-height">Figure 3-193
<a id="pgfId-1094606"></a>Opening ADE Explorer window from VSE window</strong><div class="webflare-div-image">
<img width="656" height="372" src="images/chap3-204.gif" /></div></li><li>
<a id="pgfId-1294909"></a>In the <em>Launch ADE Explorer</em> dialog, select <em>Create New View</em>.<br />
<a id="pgfId-1294910"></a>The <em>Create new ADE Explorer view</em> form is displayed.<br /><strong class="webflare-fig-line-height">Figure 3-194
<a id="pgfId-1294911"></a>Create new ADE Explorer view</strong><div class="webflare-div-image">
<img width="622" height="304" src="images/chap3-205.gif" /></div></li><li>
<a id="pgfId-1094607"></a>Leave each option to the default selections and click <em>OK</em>.<br />
<a id="pgfId-1294898"></a>ADE Explorer is displayed, as shown below. <br /><strong class="webflare-fig-line-height">Figure 3-195
<a id="pgfId-1094611"></a>ADE Explorer Window </strong><div class="webflare-div-image">
<img width="638" height="352" src="images/chap3-206.gif" /></div></li><li>
<a id="pgfId-1139692"></a>Select <em>Setup &#8211; Simulator</em> in ADE Explorer.<br />
<a id="pgfId-1139694"></a>The Choosing Simulator form is displayed.</li><li>
<a id="pgfId-1094616"></a>Select <em>spectre</em> as the Simulator.<br /><strong class="webflare-fig-line-height">Figure 3-196
<a id="pgfId-1094624"></a>Choosing Simulator Form</strong><div class="webflare-div-image">
<img width="623" height="82" src="images/chap3-207.gif" /></div></li><li>
<a id="pgfId-1140100"></a>Click <em>OK</em> to close the Choosing Simulator form.</li><li>
<a id="pgfId-1140101"></a>Set up the High Performance Simulation Options, as follows:<br />
<a id="pgfId-1140102"></a>In ADE Explorer, select <em>Setup - High Performance Simulation</em>. The <em>High Performance Simulation Options</em> window is displayed.<br />
<a id="pgfId-1094630"></a>In the High Performance Simulation Options window, select <em>APS</em>. Note that Auto is selected for <em>Multithreading options</em>. The effect of this is to detect the number of cores on the system (up to 64) and then multi-thread on all the available cores. Usually it is better to specify the number of threads yourself. Small circuits should use a small number of threads, and larger circuits can use more threads. The overhead of managing 16 threads on a smaller circuit may actually slow the simulation down, compared to two or four threads. Use the number of threads that maximizes the performance.<br /><strong class="webflare-fig-line-height">Figure 3-197
<a id="pgfId-1094635"></a>High Performance Simulation Options Form</strong><div class="webflare-div-image">
<img width="618" height="543" src="images/chap3-208.gif" /></div></li><li>
<a id="pgfId-1094636"></a>Click <em>OK</em> to close the High Performance Simulation Options form.</li><li>
<a id="pgfId-1094637"></a>Select <em>Outputs - Save All</em>.<br />
<a id="pgfId-1094638"></a>The Save Options form is displayed.</li><li>
<a id="pgfId-1094639"></a>In the Select signals to output(save) section, make sure that <em>allpub</em> is selected.<br /><strong class="webflare-fig-line-height">Figure 3-198
<a id="pgfId-1094643"></a>Save Options Form</strong><div class="webflare-div-image">
<img width="655" height="665" src="images/chap3-209.gif" /></div>
<a id="pgfId-1094644"></a>This is the default selection. This saves all of the node voltages at all levels of the hierarchy, but it does not include the node voltages inside the device models.<br />
<a id="pgfId-1094645"></a>To save the currents, use the Select device currents (currents) option, and select <em>nonlinear</em> if you just want to save the device currents, or select <em>all</em> if you want to save all the currents in the circuit. When you save currents, you require more disk space for the results file. </li><li>
<a id="pgfId-1094646"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1094648"></a>Select <em>Setup - Simulation Files</em>.</li><li>
<a id="pgfId-1094649"></a>In the Simulation Files Setup form which opens, enter <code>./ </code>by clicking in the Include Paths section. The Simulation Files Setup form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-199
<a id="pgfId-1094653"></a>Simulation Files Setup Form</strong><div class="webflare-div-image">
<img width="666" height="367" src="images/chap3-210.gif" /></div></li><li>
<a id="pgfId-1094655"></a>Click <em>OK</em> to close the Simulation Files Setup form.</li><li>
<a id="pgfId-1094656"></a>Select <em>Setup &#8211; Model Libraries</em>.<br />
<a id="pgfId-1211628"></a>The Model Library Setup form is displayed.</li><li>
<a id="pgfId-1211629"></a>In the Model File field, type the following path to the model file including the file name: <br />
<a id="pgfId-1211630"></a>s<code>hare/gpdk180_v3.3/models/spectre/gpdk.scs</code>.<br /><strong class="webflare-fig-line-height">Figure 3-200
<a id="pgfId-1094663"></a>Model Library Setup Form</strong><div class="webflare-div-image">
<img width="643" height="236" src="images/chap3-211.gif" /></div>
<a id="pgfId-1094664"></a>You can also browse to gpdk.scs file. Set the Section to stat. </li><li>
<a id="pgfId-1094665"></a>Click <em>OK</em> to close the Model Library Setup form.</li><li>
<a id="pgfId-1094666"></a>Select <em>Analyses - Choose</em>.<br />
<a id="pgfId-1094667"></a>The Choosing Analyses form is displayed. <br /><strong class="webflare-fig-line-height">Figure 3-201
<a id="pgfId-1094671"></a>The Choosing Analyses Form</strong><div class="webflare-div-image">
<img width="598" height="437" src="images/chap3-212.gif" /></div></li><li>
<a id="pgfId-1094672"></a>In the Analysis section, select <em>pss</em>. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-202
<a id="pgfId-1094673"></a>The Choosing Analyses Form- Setting PSS Analysis</strong><div class="webflare-div-image">
<img width="382" height="754" src="images/chap3-213.gif" /></div></li><li>
<a id="pgfId-1094678"></a>In the Engine section, ensure that <em>Shooting</em> is selected (this is the default).</li><li>
<a id="pgfId-1094679"></a>In the Beat Frequency field, type <code>1G</code>. <br />
<a id="pgfId-1276539"></a>The frequency entered here is an approximate frequency of oscillation. Normally, the oscillation frequency is set near the actual oscillation frequency. In this case, we have a very wide tuning range for this oscillator. A value near the middle frequency is chosen so that pss can converge on all the frequencies that are produced in the sweep.</li><li>
<a id="pgfId-1094680"></a>In the Number of harmonics field, type <code>20</code>.<br />
<a id="pgfId-1094681"></a>In general, you want to choose a number that is high enough to capture the nonlinearity of the circuit.<br />
<a id="pgfId-1094682"></a>For example, in this measurement you would be running fullspectrum pnoise. For fullspectrum pnoise, start with 10 pss harmonics, select <em>fullspectrum,</em> and select <em>APS</em>. Run the simulation, and plot the noise result. Now increase the number of harmonics which forces more pss timepoints, and run the simulation again. If the pnoise result did not change, then you had enough harmonics to begin with. If the noise result did change, then increase the number of harmonics and run the simulation again till your pnoise result do not change. <br />
<a id="pgfId-1094683"></a>In this measurement 20 number of harmonics gives stable pnoise results.</li><li>
<a id="pgfId-1240729"></a>In the Accuracy Defaults (errpreset) section, select <em>conservative</em>. <br />
<a id="pgfId-1276559"></a>conservative is typically used because very small amplitude phase noise measurements are normally desired. <em>conservative</em> is recommended for all the oscillators.</li><li>
<a id="pgfId-1240753"></a>Select <em>yes</em> for the <em>Run Transient</em> option.</li><li>
<a id="pgfId-1240730"></a>Type <code>10n</code> in the Stop Time(tstab) field. <br />
<a id="pgfId-1276579"></a>tstab is typically set to about 2-3 periods of the oscillation frequency for ring oscillator circuits. Note that this needs to apply for the lowest frequency that is produced. For that reason, 10n is set.</li><li>
<a id="pgfId-1094686"></a>Select <em>yes</em> for <em>Save Initial Transient Results</em>. This will help in visualizing the buildup of the oscillation waveform.</li><li>
<a id="pgfId-1094687"></a>Select the <em>Oscillator</em> option. <br />
<a id="pgfId-1094688"></a>This is required for simulating an autonomous circuit. The oscillator section expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-203
<a id="pgfId-1094692"></a>The Choosing Analyses Form - Oscillator Section</strong><div class="webflare-div-image">
<img width="390" height="132" src="images/chap3-214.gif" /></div></li><li>
<a id="pgfId-1094693"></a>In the Oscillator node+ field, click <em>Select</em> on the right. In the schematic, select the Int4 node. This oscillator node will be used by the simulator for the period calculation of the oscillations. It just needs to be a node that has the oscillator signal on it.</li><li>
<a id="pgfId-1094694"></a>Deselect the Calculate initial conditions (ic) automatically checkbox. This is because selecting this checkbox only works for feedback oscillators while the ring oscillator is not a feedback oscillator. Therefore, selecting this checkbox will not be able to find an oscillatory state for ring oscillator.<br /><strong class="webflare-fig-line-height">Figure 3-204
<a id="pgfId-1094698"></a>Selecting Int4 net on schematic</strong><div class="webflare-div-image">
<img width="565" height="308" src="images/chap3-215.gif" /></div></li><li>
<a id="pgfId-1094700"></a>Select the <em>Sweep</em> option. This allows you to sweep the tuning voltage (vtune), as explained below.<ol><li>
<a id="pgfId-1094701"></a>Click the <em>Select Design Variable</em> button. The <em>Select Design Variable</em> window is displayed.</li><li>
<a id="pgfId-1094702"></a>In the <em>Select Design Variable</em> window, select <em>vtune</em>.<br /><strong class="webflare-fig-line-height">Figure 3-205
<a id="pgfId-1094703"></a>Choosing vtune in Select Design Variable Form during PSS Analysis setup</strong><div class="webflare-div-image">
<img width="668" height="246" src="images/chap3-216.gif" /></div></li><li>
<a id="pgfId-1094708"></a>Click <em>OK</em> to close the Select Design Variable Form.</li><li>
<a id="pgfId-1094709"></a>In the Sweep Range section of the form, type <code>0.0</code> in the <em>Start</em> field.</li><li>
<a id="pgfId-1211618"></a>Type <code>3.2</code> in the <em>Stop</em> field.</li><li>
<a id="pgfId-1211619"></a>By default, the Sweep Type is set to <em>Linear</em>. </li><li>
<a id="pgfId-1211620"></a>Type <code>0.2</code> in the <em>Step Size</em> field.<br />
<a id="pgfId-1211615"></a>The sweep range for <em>vtune</em> is set based on for what tuning range your oscillator is designed for. This would be based on your oscillator design specifications.</li></ol></li><li>
<a id="pgfId-1094713"></a>Click <em>Apply</em> in <em>Choosing Analyses</em> Form. It checks the entries in the form for legality. </li></ol>















































































































<p>
<a id="pgfId-1094714"></a>The completed <em>Choosing Analyses</em> form should like the figure below.</p>

<p class="webflare-indent1"><strong>Figure 3-206
<a id="pgfId-1094718"></a>Choosing Analyses Form - PSS-Shooting Method Setup - Part1</strong></p>
<div class="webflare-div-image">
<img width="423" height="769" src="images/chap3-217.gif" /></div>
<h4>
<a id="pgfId-1094719"></a>Setting up the Pnoise analysis</h4>

<p>
<a id="pgfId-1094720"></a>This analysis is set to do the phase noise measurement. It is run after pss analysis.</p>
<ol><li>
<a id="pgfId-1094721"></a>In the Choosing Analyses form, select <em>pnoise</em>. The form expands, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-207
<a id="pgfId-1094725"></a>The Choosing Analyses Form - pnoise Analysis Setup</strong>
<a id="pgfId-1141127"></a><div class="webflare-div-image">
<img width="371" height="669" src="images/chap3-218.gif" /></div></li><li>
<a id="pgfId-1094726"></a>Leave the Sweep Type to <em>relative</em>. <br />
<a id="pgfId-1094727"></a>For oscillators, the hbnoise/pnoise frequency range defaults to <em>relative</em>. Specify the harmonic number as appropriate for the system you are simulating. If you are simulating an oscillator by itself, then the harmonic number is likely to be 1. If you have an oscillator and a diode frequency doubler, then the harmonic number is likely to be 2. If you have an oscillator with a frequency divider, in the hb/pss form, you should specify the approximate frequency of oscillation for the frequency-divided signal. In the hbnoise/pnoise form, if the noise is desired on the frequency divided output, then the relative harmonic is 1. If the noise is desired at the output of the oscillator, the relative harmonic number is the divide ratio. The meaning of relative is to take the frequency of the harmonic number specified and add to it the frequencies specified in the Choosing Analyses form. If the oscillator had a 1GHz output, and the pnoise had 1M relative to the first harmonic specified, the actual output frequency is 1G + 1M, or 1001M.<ol><li>
<a id="pgfId-1094728"></a>Type <code>1</code> in the Relative Harmonic field as you are simulating an oscillator by itself.</li><li>
<a id="pgfId-1094729"></a>Select <em>Single Point</em> for Output Frequency Sweep Range. </li><li>
<a id="pgfId-1277080"></a>Type <code>1M </code>in the Freq Field. In general, the pnoise frequency would be set as appropriate for your application.</li></ol></li><li>
<a id="pgfId-1094730"></a>Select the <em>Method</em> as <em>fullspectrum</em> in the <em>Sidebands</em> section.<br />
<a id="pgfId-1094731"></a>Full-Spectrum pnoise is useful for circuits like switched-capacitor filters or sampling circuits where aliasing occurs through very high harmonics of the clock. The runtime advantages are large with no loss in accuracy of the result. Full-Spectrum pnoise is available when Shooting is selected for the pss Engine and APS is selected in the Setup - High Performance Simulation menu in ADE Explorer. Selecting fullspectrum in the pnoise form forces APS to be selected in ADE Explorer. If you are running from the command line without using +aps, fullspectrum will not be used. In normal pnoise when Shooting is selected as Engine, you need to set the maximum sideband term. In full-spectrum pnoise you do not do this except in cases where the pss beat frequency is 100KHz or less. In this case, set maximum sidebands to the 1/f noise corner frequency divided by the pss beat frequency. Pnoise calculates all the noise translations it can, based on the maximum timestep in the pss analysis. The easiest way to change the maximum timestep in pss is to increase the number of harmonics above 10 in the pss Choosing Analyses form. Full-spectrum pnoise runs faster than normal pnoise when the maximum number of sidebands in pnoise is about 50 or greater. The larger the number of sidebands, the larger the speedup for fullspectrum pnoise analysis. <br />
<a id="pgfId-1094732"></a>Fullspectrum pnoise is available for all available noisetypes. Noise separation is not supported when fullspectrum is selected.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1094733"></a>When the default method is selected, specify the number of desired frequency translations in the <em>Maximum sideband</em> field. This will always be specific to the design. For a rough estimate, plot the frequency domain content, and find the harmonic number where the amplitude has dropped about 40dB. Try this number in maximum sidebands. To verify that you have enough sidebands, raise the number by about 50% and run again. If the noise result did not change, then you had enough sidebands to begin with. Up to 40 sidebands can be specified by default. If you need more than 40 sidebands, set the number of pss harmonics to the number of sidebands divided by two to four or set the pss option maxacfreq to the beat frequency times the number of pnoise sidebands.</div></li><li>
<a id="pgfId-1094734"></a>Leave <em>Maximum sideband</em> field blank as explained above since the <em>Method</em> selected is <em>fullspectrum</em>.</li><li>
<a id="pgfId-1094735"></a>Set the Output to <em>voltage</em>. <ol><li>
<a id="pgfId-1094736"></a>Type <code>/V4P</code> in the Positive Output Node field. You can also select V4P net from schematic by clicking Select button on the right of the Positive Output Node field and then selecting the net just below the out label in schematic. </li><li>
<a id="pgfId-1094737"></a>Type <code>/V4M</code> in the Negative Output Node field. If the second node, that is, the Negative Output Node is left blank, it will be connected to the global ground node automatically. However, if you have differential oscillator, you need to specify both the nodes.</li></ol></li><li>
<a id="pgfId-1094740"></a>Choose noise type as <em>timeaverage</em> from the drop-down list.</li><li>
<a id="pgfId-1240876"></a>Select the <em>ALL(AM,PM,USB,LSB)</em> option.<br /><strong class="webflare-fig-line-height">Figure 3-208
<a id="pgfId-1094744"></a>Selecting V4P and V4M net from the schematic</strong><div class="webflare-div-image">
<img width="567" height="308" src="images/chap3-219.gif" /></div>
<a id="pgfId-1094745"></a>The <em>Choosing Analyses</em> form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-209
<a id="pgfId-1094749"></a>Choosing Analysis Form - pnoise Analysis Setup</strong><div class="webflare-div-image">
<img width="448" height="749" src="images/chap3-220.gif" /></div></li><li>
<a id="pgfId-1211608"></a>Click OK to close the Choosing Analyses form. This will add the pnoise analysis along with pss analysis in the <em>Analyses</em> section of ADE window, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-210
<a id="pgfId-1211609"></a>ADE Explorer Simulation Window - pss and pnoise-jitter analysis setup</strong><div class="webflare-div-image">
<img width="668" height="352" src="images/chap3-221.gif" /></div></li></ol>

































<h3>
<a id="pgfId-1094757"></a>Running the PSS and Pnoise analysis</h3>

<p>
<a id="pgfId-1094761"></a>Once finished setting up the PSS and Pnoise Analyses click the green icon <img width="32" height="31" src="images/chap3-222.gif" /><span> on the right of ADE Explorer or on the Schematic window to run the simulation.</span></p>

<p>
<a id="pgfId-1141567"></a>This netlists the design and runs the simulation. A SpectreRF status window appears (<code>spectre.out</code> logfile). When the analysis has completed, you may iconify the status window.</p>
<p>
<a id="pgfId-1141568"></a>Next, you will plot the results.</p>
<p>
<a id="pgfId-1094764"></a>Plotting the results</p>
<p>
<a id="pgfId-1094765"></a>First Plot the oscillator output frequency, as follows:</p>
<ol><li>
<a id="pgfId-1094766"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>.<br />
<a id="pgfId-1094772"></a>The <em>Direct Plot Form</em> is displayed, as shown below.<br /><strong class="webflare-fig-line-height">Figure 3-211
<a id="pgfId-1094776"></a>Swept pss and pnoise Analysis Direct Plot Form</strong><div class="webflare-div-image">
<img width="353" height="693" src="images/chap3-223.gif" /></div></li><li>
<a id="pgfId-1094777"></a>In the <em>Direct Plot Form</em>, select pss in the <em>Analysis</em> section. This is selected by default.</li><li>
<a id="pgfId-1094778"></a>Select Harmonic Frequency in the <em>Function</em> section.</li><li>
<a id="pgfId-1094779"></a>In the <em>Harmonic Frequency</em> section, select the first harmonic. This will plot only the change in first harmonic of the oscillation frequency vs. change in oscillator&#8217;s tuning voltage.<br />
<a id="pgfId-1094780"></a>The Direct Plot Form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-212
<a id="pgfId-1094784"></a>Swept pss Analysis Direct Plot Form Setup</strong><div class="webflare-div-image">
<img width="395" height="624" src="images/chap3-224.gif" /></div></li><li>
<a id="pgfId-1094785"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1094786"></a>The oscillator tuning range is plotted. From the plot you can observe that as you increase the tuning voltage, the oscillator frequency increases.<br /><strong class="webflare-fig-line-height">Figure 3-213
<a id="pgfId-1094787"></a>Swept PSS Measurement Plot - Harmonic frequency variation plot</strong><div class="webflare-div-image">
<img width="668" height="423" src="images/chap3-225.gif" /></div></li><li>
<a id="pgfId-1094792"></a>Select <em>File - Close All Windows</em> to close the waveform window.</li></ol>




















<p>
<a id="pgfId-1094793"></a>You will now plot the phase noise.</p>
<ol><li>
<a id="pgfId-1094794"></a> In the <em>Direct Plot Form</em>, select <em>pnoise</em> in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1241115"></a>Select <em>PM</em> for <em>Noise Type</em>.</li><li>
<a id="pgfId-1094795"></a>Select <em>Phase Noise</em> in the <em>Function</em> section.<br />
<a id="pgfId-1094796"></a>The Direct Plot Form should look like the following:<br /><strong class="webflare-fig-line-height">Figure 3-214
<a id="pgfId-1094798"></a>Direct Plot Phase Noise Setup</strong><div class="webflare-div-image">
<img width="378" height="397" src="images/chap3-226.gif" /></div></li><li>
<a id="pgfId-1094803"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1277477"></a>This will plot the Single Sideband Phase Noise vs. Relative Frequency graph, as shown below:<br /><strong class="webflare-fig-line-height">Figure 3-215
<a id="pgfId-1094804"></a>Phase Noise vs. Relative Frequency Plot</strong><div class="webflare-div-image">
<img width="668" height="419" src="images/chap3-227.gif" /></div></li></ol>













<p>
<a id="pgfId-1094809"></a>In the above plot, you have a graph of phase noise vs. relative frequency for each vtune sweep value. Next, you will modify the phase noise plot to provide more useful information. </p>
<ol><li>
<a id="pgfId-1094810"></a>In the plot window, right-click on one of the numbers on the X Axis and select <em>Swap Sweep Var </em>from the context menu.<br /><strong class="webflare-fig-line-height">Figure 3-216
<a id="pgfId-1094814"></a>X-Axis - Right Mouse Button (RMB) - Object Menu</strong><div class="webflare-div-image">
<img width="181" height="157" src="images/chap3-228.gif" /></div></li><li>
<a id="pgfId-1094816"></a>In Select Sweep Var dialog box which opens, select <em>vtune</em> from the <em>Sweep Variables</em> drop down list. Keep Plot Destination as <em>New SubWindow</em>.<br /><strong class="webflare-fig-line-height">Figure 3-217
<a id="pgfId-1094820"></a>Swap Sweep Var Dialog Box Window</strong><div class="webflare-div-image">
<img width="365" height="184" src="images/chap3-229.gif" /></div></li><li>
<a id="pgfId-1094822"></a>Click <em>OK</em>.<br />
<a id="pgfId-1094823"></a>The waveform tool draws a new subwindow.<br /><strong class="webflare-fig-line-height">Figure 3-218
<a id="pgfId-1094824"></a>Tuning voltage vs phase noise plot</strong><div class="webflare-div-image">
<img width="668" height="422" src="images/chap3-230.gif" /></div>
<a id="pgfId-1142380"></a>If you look at the graph on the right, you will see that the phase noise is worse at the lower end of the tuning range.</li><li>
<a id="pgfId-1142381"></a>Select <em>File - Close All Windows</em> to close the waveform window.</li><li>
<a id="pgfId-1142382"></a>Clean up the screen for the next set of measurements.<ol><li>
<a id="pgfId-1211602"></a>Close ADE Explorer by selecting <em>Session</em> - <em>Quit</em>.</li><li>
<a id="pgfId-1220755"></a>Exit the Virtuoso session by selecting <em>File - Exit in CIW</em>.</li></ol></li></ol>





















<h3>
<a id="pgfId-1220778"></a>Summary</h3>

<p>
<a id="pgfId-1220800"></a>The Simulating Oscillator section shows how to simulate and make typical measurements on an oscillator.</p>
<p>
<a id="pgfId-1220801"></a>In this Oscillator section, the following simulation setups/measurements were shown:</p>
<ul><li>
<a id="pgfId-1220802"></a>Starting and Stabilizing of Feedback Oscillators</li><li>
<a id="pgfId-1220834"></a>Loop Gain Measurement of Feedback Oscillator</li><li>
<a id="pgfId-1220804"></a>Swept Tuning Range and Phase Noise Measurement</li><li>
<a id="pgfId-1220805"></a>Starting and Stabilization of Ring Oscillators</li><li>
<a id="pgfId-1220806"></a>FM Jitter Measurement of Ring Oscillator</li><li>
<a id="pgfId-1220807"></a>Swept Tuning Range and Phase Noise for the Ring Oscillator</li></ul>





<p>
<a id="pgfId-1220808"></a>For more information on simulating oscillators, please refer to the chapters in the <em>Virtuoso Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis User Guide</em> and the <em><a actuate="user" class="URL" href="../spectreRFTheory/chap1.html#firstpage" show="replace" xml:link="simple">Spectre Circuit Simulator RF Analysis Theory</a></em> guide.</p>

<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="chap2.html" id="prev" title="Simulating Low Noise Amplifiers">Simulating Low Noise Amplifier ...</a></em></b><b><em><a href="chap4.html" id="nex" title="Simulating Mixers">Simulating Mixers</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2020, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>