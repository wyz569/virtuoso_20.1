
<html><head><title>Instantiating Modules and Primitives</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2019-09-18" />
<meta name="CreateTime" content="1568827686" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes the analog and mixed-signal aspects of the Cadence Verilog-AMS language. With Verilog-AMS, you can create and use modules that describe the high-level behavior and structure of analog, digital, and mixed-signal components and systems." />
<meta name="DocTitle" content="Cadence Verilog-AMS Language Reference" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Instantiating Modules and Primitives" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.1" />
<meta name="Keyword" content="verilogamsref" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2019-09-18" />
<meta name="ModifiedTime" content="1568827686" />
<meta name="NextFile" content="chap11.html" />
<meta name="Group" content="Analog Mixed-Signal Simulation" />
<meta name="Platform" content="Functional Verification" />
<meta name="PrevFile" content="chap9.html" />
<meta name="Product" content="Xcelium" />
<meta name="ProductFamily" content="Xcelium" />
<meta name="ProductVersion" content="19.09" />
<meta name="RightsManagement" content="Copyright 2012-2019 Cadence Design Systems Inc." />
<meta name="Title" content="Cadence Verilog-AMS Language Reference -- Instantiating Modules and Primitives" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="product_feature" content="" />
<meta name="product_subfeature" content="" />
<meta name="Version" content="19.09" />
<meta name="SpaceKey" content="verilogamsref1909" />
<meta name="webflare-version" content="1.4" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="verilogamsrefTOC.html">Contents</a></li><li><a class="prev" href="chap9.html" title="Simulator Functions">Simulator Functions</a></li><li style="float: right;"><a class="viewPrint" href="verilogamsref.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="chap11.html" title="Mixed-Signal Aspects of Verilog-AMS">Mixed-Signal Aspects of Verilo ...</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Cadence Verilog-AMS Language Reference<br />Product Version 19.09, September 2019</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;">

<h1>10
<a id="pgfId-1031799"></a></h1>
<h1>
<a id="pgfId-1031801"></a><hr />
<a id="20654"></a>Instantiating Modules and Primitives<hr />
</h1>

<p>
<a id="pgfId-1031805"></a><a href="chap2.html#16009">Chapter 2, &#8220;Creating Modules,&#8221;</a> discusses the basic structure of Cadence<sup>&#174;</sup> Verilog<sup>&#174;</sup>-AMS language modules. This chapter discusses how to instantiate Verilog-AMS modules within other modules. Module declarations cannot nest in one another; instead, you embed instances of modules in other modules. By embedding instances, you build a hierarchy extending from the instances of primitive modules up through the top-level modules. <a id="marker-1031806"></a><a id="marker-1031807"></a></p>
<p>
<a id="pgfId-1034818"></a>The following sections discuss</p>
<ul><li>
<a id="pgfId-1031818"></a><a href="chap10.html#26570">Instantiating Verilog-AMS Modules</a></li><li>
<a id="pgfId-1031822"></a><a href="chap10.html#24050">Connecting the Ports of Module Instances</a></li><li>
<a id="pgfId-1031826"></a><a href="chap10.html#40611">Overriding Parameter Values in Instances</a></li><li>
<a id="pgfId-1043503"></a><a href="chap10.html#31140">Instantiating Analog Primitives</a></li><li>
<a id="pgfId-1043511"></a><a href="chap10.html#90322">Using an M Factor (Multiplicity Factor)</a></li><li>
<a id="pgfId-1097791"></a><a href="chap10.html#80353">Including Verilog-A Modules in Spectre Subcircuits</a></li></ul>






<h2>
<a id="pgfId-1031835"></a><a id="marker-1031832"></a><a id="26570"></a>Instantiating Verilog-AMS <a id="marker-1031834"></a>Modules</h2>

<p>
<a id="pgfId-1031839"></a>Use the following syntax to <a id="marker-1031836"></a>instantiate<a id="marker-1031837"></a> module<a id="marker-1031838"></a>s in other modules.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1035194"></a>module_instantiation ::=<br /><code><em>    module_id</em></code> [ parameter_value_assignment ] instance_list</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037589"></a>instance_list ::= <br />    module_instance { <strong>,</strong> module_instance} <strong>;</strong></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037591"></a>module_instance ::= <br />    name_of_instance <strong>(</strong> [ list_of_module_connections ] <strong>)</strong></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1045877"></a>name_of_instance ::= <br />    <code><em>module_instance_identifier</em></code> [ constant_range ]</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037595"></a>list_of_module_connections ::=<br />    ordered_port_connection { <strong>,</strong> ordered_port_connection }<br />   |named_port_connection { <strong>,</strong> named_port_connection }</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1097819"></a>ordered_port_connection ::=<br />    [ net_expression ]</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037599"></a>named_port_connection ::=<br />    <strong>.</strong> port_identifier <strong>(</strong> [ net_expression ] <strong>)</strong></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098368"></a>net_expression ::=<br />    <code><em>net_identifier<br /></em></code>   |<code><em>net_identifier</em></code> <strong>[</strong> <code><em>constant_expression</em></code> <strong>]<br /></strong>   |<code><em>net_identifier</em></code> <strong>[</strong> constant_range <strong>]</strong></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037603"></a>constant_range ::=<br />        <code><em>constant_expression</em></code> <strong>:</strong> <code><em>constant_expression</em></code></pre>

<p>
<a id="pgfId-1031841"></a>The <code>instance_list</code> expression is discussed in the following sections. The <code>parameter_value_assignment</code> expression is discussed in <a href="chap10.html#40611">&#8220;Overriding Parameter Values in Instances&#8221;</a>. </p>

<h3>
<a id="pgfId-1031848"></a><a id="marker-1076524"></a>Creating and Naming <a id="marker-1031847"></a>Instances</h3>

<p>
<a id="pgfId-1031849"></a>This section illustrates how to instantiate modules. Consider the following module, which describes a <a id="marker-1031850"></a>gain block that doubles the input voltage.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1031852"></a><a id="marker-1031851"></a>module vdoubler (in, out) ;<br />input in ;<br />output out ;<br />electrical in, out ;<br />analog<br />    V(out) &lt;+ 2.0 * V(in) ;<br />endmodule</pre>

<p>
<a id="pgfId-1031853"></a>Two of these gain blocks are connected, with the output of the first becoming the input of the second. The schematic looks like this.</p>

<p>
<a id="pgfId-1034186"></a></p>
<div class="webflare-div-image">
<img width="419" height="58" src="images/chap10-2.gif" /></div>

<p>
<a id="pgfId-1031871"></a>This higher-level component is described by module <code>vquad</code>, which creates two instances, named <code>vd1</code> and <code>vd2</code>, of module <code>vdoubler</code>. Module <code>vquad</code> also defines external ports corresponding to those shown in the schematic.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1031872"></a>module vquad (qin, qout) ;<br />input qin ;<br />output qout ;<br />electrical qin, qout ;<br />wire aa1 ;<br /><a id="marker-1031873"></a>vdoubler vd1 (qin, aa1) ;<br />vdoubler vd2 (aa1, qout) ;<br />endmodule</pre>
<h3>
<a id="pgfId-1097825"></a>Creating Arrays of Instances</h3>

<p>
<a id="pgfId-1097826"></a>The range specification on the <span class="webflare-courier-new" style="white-space:pre"><em>module_instance_identifier</em></span> allows you to create arrays of instances.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1097827"></a>name_of_instance ::= <br />        <code><em>module_instance_identifier</em></code> [ constant_range ]</pre>

<p>
<a id="pgfId-1097828"></a>However, a <span class="webflare-courier-new" style="white-space:pre"><em>module_instance_identifier</em></span> used to create an array of instances (an <span class="webflare-courier-new" style="white-space:pre"><em>AOI_identifier</em></span>) is restricted to being purely digital and cannot instantiate an analog object at any level. That means that you cannot use:</p>
<ul><li>
<a id="pgfId-1097829"></a>An analog primitive or a connection module as the <span class="webflare-courier-new" style="white-space:pre"><em>AOI_identifier</em></span>.</li><li>
<a id="pgfId-1097830"></a>Inherited connection attributes, m-factor attributes, or dynamic parameters in the <span class="webflare-courier-new" style="white-space:pre"><em>AOI_identifier</em></span>.</li></ul>

<p>
<a id="pgfId-1097831"></a>In addition, you cannot use a VHDL design unit as the <span class="webflare-courier-new" style="white-space:pre"><em>AOI_identifier</em></span>.</p>
<p>
<a id="pgfId-1097832"></a>You cannot connect to the <span class="webflare-courier-new" style="white-space:pre"><em>AOI_identifier</em></span> a net or bus that is declared to be analog. Nets or buses of undetermined discipline are forced to the default discipline when they connect to an <span class="webflare-courier-new" style="white-space:pre"><em>AOI_identifier</em></span>.</p>
<p>
<a id="pgfId-1097833"></a>When you use both the <code>xmelab -dresolution</code> and <code>-messages</code> options, the elaborator notifies you when it encounters an array of instances. Regardless of the number of arrays of instances in the design, the elaborator produces only a single message. For example, you define the following modules.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1097834"></a>/* Digital module instance array */<br />module pmem();<br />   wire [15:0]   xxpab,pab; <br />   nmos #0.06 npab[15:0] (xxpab,pab,1&#8217;b1);<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1097835"></a>/* Instantiate both digital and analog modules */<br />module tmp ();<br />   pmem pmem();<br />   ana ana();<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1097836"></a>/* Analog module */<br />module ana();<br />   electrical v;<br />   real vValue;<br />   initial begin<br />           vValue = 0.1;<br />           #100;<br />           vValue = 1.5;<br />   end<br />   analog begin<br />           V(v) &lt;+ vValue;<br />   end<br />endmodule</pre>

<p>
<a id="pgfId-1097837"></a>When you run <code>xmelab</code> with both the <code>-dresolution</code> and <code>-messages</code> options, the following message is produced.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1055484"></a>nmos #0.06 npab[15:0] (xxpab,pab,1&#8217;b1);<br />              |<br />xmelab: *W,AMSAOIW (./test.v,10|14): An array of instances was encountered in the AMS design. Only pure digital array of instance hierarchies are allowed in AMS designs.</pre>
<h3>
<a id="pgfId-1046140"></a><a id="marker-1076526"></a>Mapping Instance <a id="marker-1046139"></a>Ports to Module Ports</h3>

<p>
<a id="pgfId-1035108"></a>When you instantiate a module, you must specify how the actual ports listed in the instance correspond to the formal ports listed in the defining module. Module <code>vquad</code>, in the previous example, demonstrates one of the two methods provided in Verilog-AMS. Module <code>vquad</code> uses an ordered list, where instance <code>vd1</code>&#8217;s first actual port name <code>qin</code> maps to <code>vdoubler</code>&#8217;s first formal port name <code>in</code>. Instance <code>vd1</code>&#8217;s second actual port name <code>aa1</code> maps to <code>vdoubler</code>&#8217;s second formal port name, and so on. </p>
<p>
<a id="pgfId-1097851"></a><a id="marker-1076528"></a>You can also map actual ports to the formal ports in the defining module explicitly, using name pairs. If you choose this approach, the order of the ports does not matter.</p>
<p>
<a id="pgfId-1097852"></a>You cannot mix the two kinds of mapping within a single instance. </p>

<h4>
<a id="pgfId-1035111"></a>Mapping Ports with Ordered Lists</h4>

<p>
<a id="pgfId-1031882"></a><a id="marker-1031881"></a>To use ordered lists to map actual ports listed in the instance to the formal ports listed in the defining module, ensure that the instance ports are in the same order as the defining module ports. For example, consider the following module <code>child</code> and the module <code>instantiator</code> that instantiates it.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1031883"></a>module child (ina, inb, out) ; <br />input [0:3] ina ; <br />input inb ;<br />output out ;<br />electrical [0:3] ina ;<br />electrical inb ;<br />electrical out ;<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037605"></a>module instantiator (conin, conout) ;<br />input [0:6] conin ;<br />output conout ;<br />electrical [0:6] conin ;<br />electrical conout ;<br />child child1 (conin [1:4], conin [6], conout) ;<br />end module</pre>

<p>
<a id="pgfId-1031884"></a>You can tell from the order of port names in these modules that port <code>ina[0]</code> in module <code>child</code> maps to port <code>conin[1]</code> in instance <code>child1</code>. Similarly, port <code>inb</code> in <code>child</code> maps to port <code>conin[6]</code> in instance <code>child1</code>. Port <code>out</code> in <code>child</code> maps to port <code>conout</code> in instance <code>child1</code>.</p>

<h4>
<a id="pgfId-1097857"></a><a id="marker-1076530"></a>Mapping Ports with Name Pairs</h4>

<p>
<a id="pgfId-1097859"></a>You can also link the formal ports in a defining module and the actual ports in an instance explicitly by pairing the port names. A period and the formal port name come first in each pair, followed, in parentheses, by the actual port name used in the instance. For example, in this module instantiation statement, <a id="marker-1097858"></a><a id="marker-1097860"></a></p>

<pre class="webflare-courier-new">
<a id="pgfId-1097861"></a>adc2 low (.in(rem_chain), .out(bout[1]), .outb()) ;</pre>

<p>
<a id="pgfId-1097862"></a>the formal names <code>in</code>, <code>out</code>, and <code>outb</code>, are from the defining module, and the actual names <code>rem_chain</code> and <code>bout[1]</code> are used in the instantiating module. The empty set of parentheses adjacent to <code>outb</code> show that the <code>outb</code> port is not used in this instance.</p>
<p>
<a id="pgfId-1097864"></a>Ensure that the first name in each pair is a name specified on the <code>module</code><a id="marker-1097863"></a> statement of the defining module. Then ensure that the second name, the actual one used in the instance and in the instantiating module, is one of the following:</p>
<ul><li>
<a id="pgfId-1097866"></a>A simple net identifier<a id="marker-1097865"></a></li><li>
<a id="pgfId-1097867"></a>A scalar member of a vector net or port declared within the instantiating module</li><li>
<a id="pgfId-1097868"></a>A sub-range of a vector net declared within the instantiating module</li></ul>



<h2>
<a id="pgfId-1031900"></a><a id="24050"></a>Connecting the Ports of Module Instances</h2>

<p>
<a id="pgfId-1031901"></a>Developing modules that describe components is an important step on the way to the overall goal of simulating a system. But an equally important step is combining those components together so that they represent the system as a whole. This section discusses how to <a id="marker-1031902"></a>connect module <a id="marker-1031903"></a>instances, using their ports, to describe the structure and behavior of the system you are modeling.</p>
<p>
<a id="pgfId-1031904"></a>Consider again the modules <code>vdoubler</code> and <code>vquad</code>, which describe this schematic.</p>

<p>
<a id="pgfId-1034209"></a></p>
<div class="webflare-div-image">
<img width="427" height="58" src="images/chap10-3.gif" /></div>
<pre class="webflare-courier-new">
<a id="pgfId-1031922"></a>module vdoubler (in, out) ;<br />input in ;<br />output out ;<br />electrical in, out ;<br />analog<br />    V(out) &lt;+ 2.0 * V(in) ;<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037607"></a>module vquad (qin, qout) ;<br />input qin ;<br />output qout ;<br />electrical qin, qout ;<br />wire aa1 ;<br /><a id="marker-1031923"></a>vdoubler vd1 (qin, aa1) ;<br />vdoubler vd2 (aa1, qout) ;<br />endmodule</pre>

<p>
<a id="pgfId-1031925"></a>This time, note how the module instantiation statements in <code>vquad</code> use port names to establish a connection between output port <code>aa1</code><a id="marker-1031924"></a><a id="marker-1031926"></a><a id="marker-1031927"></a> of instance <code>vd1</code> and input port <code>aa1</code> of instance <code>vd2</code>.</p>
<p>
<a id="pgfId-1097873"></a>You can establish the same connections by using name pairs, as illustrated in the following two instantiation statements</p>

<pre class="webflare-courier-new">
<a id="pgfId-1097874"></a>vdoubler vd1 (.out (aa1), .in (qin)) ;<br />vdoubler vd2 (.in (aa1), .out (qout)) ;</pre>

<p>
<a id="pgfId-1031928"></a>Module instantiation statements like</p>

<pre class="webflare-courier-new">
<a id="pgfId-1031929"></a>vdoubler vd1 (qin, qout) ;<br />vdoubler vd2 (qin, qout) ;</pre>

<p>
<a id="pgfId-1031930"></a>establish different connections. These statements describe a system where the gain blocks are connected in parallel, with this schematic. </p>

<p>
<a id="pgfId-1037629"></a></p>
<div class="webflare-div-image">
<img width="671" height="135" src="images/chap10-4.gif" /></div>
<h3>
<a id="pgfId-1031955"></a><a id="marker-1076532"></a>Port Connection <a id="marker-1031953"></a>Rules<a id="marker-1031954"></a></h3>

<p>
<a id="pgfId-1097879"></a>You can connect the ports described in the <code>vdoubler</code> instances because the ports are all analog, are defined with compatible disciplines, and are the same size. To generalize,</p>
<ul><li>
<a id="pgfId-1097884"></a>All analog ports connected to a net are compatible with each other. You can connect both analog and digital ports to the same net if you provide appropriate <code>connect</code> statements.</li><li>
<a id="pgfId-1035355"></a>You must ensure that the <a id="marker-1031965"></a>sizes of connected ports and<a id="marker-1031966"></a> nets match. In other words, you can connect a scalar port to a scalar net, and a vector port to a vector net or concatenated net expression of the same width.</li></ul>


<h2>
<a id="pgfId-1031977"></a><a id="marker-1076534"></a><a id="marker-1031974"></a><a id="40611"></a>Overriding Parameter Values in <a id="marker-1031976"></a>Instances</h2>

<p>
<a id="pgfId-1031978"></a>The syntax for the module instance statement is </p>

<pre class="webflare-courier-new">
<a id="pgfId-1031979"></a><code><em>module_id</em></code> [ parameter_value_assignment ] instance_list</pre>

<p>
<a id="pgfId-1031980"></a>The following sections discuss the <code>parameter_value_assignment</code> expression, which is further defined as</p>

<pre class="webflare-courier-new">
<a id="pgfId-1097928"></a>parameter_value_assignment ::=<br /><strong>                #(</strong> ordered_param_override_list <strong>)<br /></strong>    |   <strong>#(</strong> named_param_override_list <strong>)</strong></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037609"></a>ordered_param_override_list ::=<br />        <code><em>expression</em></code> { <strong>,</strong> <code><em>expression</em></code> }</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037611"></a>named_param_override_list ::=<br />        named_param_override { <strong>,</strong> named_param_override }</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037613"></a>named_param_override ::=<br />        <strong>.</strong> <code><em>parameter_identifier</em></code> <strong>(</strong> <code><em>expression</em></code> <strong>)</strong></pre>

<p>
<a id="pgfId-1034216"></a>By default, instances of modules inherit any parameters specified in their defining module. If you want to change any of the default parameter values, you can do so on the module instantiation statement itself, or from other modules and instances by using the <code>defparam</code> statement. The <code>defparam</code> statement is particularly useful if you want to change parameters throughout your modules from a single location.</p>

<h3>
<a id="pgfId-1031984"></a>Overriding Parameter Values from the Instantiation Statemen<a id="marker-1098524"></a>t<a id="marker-1098517"></a></h3>

<p>
<a id="pgfId-1035144"></a>Using the module instantiation statement, you can assign values to parameters in two ways. You can assign values in the order the parameters are declared, or you can assign values by explicitly referring to parameter names. The new values must be constant expressions.</p>

<h4>
<a id="pgfId-1097970"></a><a id="marker-1076538"></a>Overriding Parameter Values with Ordered Lists</h4>

<p>
<a id="pgfId-1097971"></a>To override parameters using an ordered list of replacement values you must ensure that the list specifies replacement values in the same order that the parameters are defined in the defining module. You are not required to specify replacement values for every defined parameter, but if you omit any value you must omit every value from then on. In other words, you cannot skip over selected parameters. If a parameter does not need a new value, however, you can specify a replacement value equal to the default value. </p>
<p>
<a id="pgfId-1097972"></a>Consider the two instances, <code>weakp</code> and <code>plainp</code>, instantiated within module <code>m</code>.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1097973"></a>module m ;<br />voltage clk ;<br />electrical out_a, in_a ;<br />mosp # (2e-6, 1e-6) weakp (out_a, in_a, clk);//Overriding param values by order<br />mosp plainp (out_b, in_b, clk) ;<br />endmodule ;</pre>

<p>
<a id="pgfId-1097974"></a>The <code>weakp</code> module instantiation statement overrides the first two parameters given in the defining module, <code>mosp</code>, giving the first parameter the new value 2e-6 and the second parameter the value 1e-6. The <code>plainp</code> module instantiation statement has no parameter override expression, so the parameters assume their default values.</p>

<h4>
<a id="pgfId-1035150"></a>Overriding Parameter Values By Name</h4>

<p>
<a id="pgfId-1031992"></a>You can also override parameter values in an instantiated module by pairing the parameter names to be changed with the values they are to receive. A period and the parameter name come first in each pair, followed by the new value in parentheses. The parameter name must be the name of a parameter in the defining module of the module being instantiated. When you override parameter values by name, you are not required to specify values for every parameter.</p>
<p>
<a id="pgfId-1031993"></a>Consider this modified definition of module <code>vdoubler</code>. This version has three parameters, <code>parm1</code>, <code>parm2</code>, and <code>parm3</code>.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1031994"></a>module vdoubler (in, out) ;<br />input in ;<br />output out ;<br />electrical in, out ;<br />parameter parm1 = 0.2,<br />          parm2 = 0.1,<br />          parm3 = 5.0 ;<br />analog<br />    V(out) &lt;+ (parm1 + parm2 + parm3) * V(in) ;<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1031995"></a>module vquad (qin, qout) ;<br />input qin ;<br />output qout ;<br />vdoubler # (.parm3(4.0)) vd1 (qin, aa1) ;                // Overriding by name<br />vdoubler # (.parm1(0.3), .parm2(0.2)) vd2 (aa1, qout) ;  // Overriding by name<br />vdoubler # (0.3, 0.2) vd3 (aa1, qout) ;                  // By order<br />endmodule</pre>

<p>
<a id="pgfId-1031996"></a>The module instantiation statement for instance <code>vd1</code> overrides parameter <code>parm3</code> by name to specify that the value for <code>parm3</code> should be changed to 4.0. The other two parameters retain the default values 0.2 and 0.1. The module instantiation statement for <code>vd3</code> uses an ordered list to override the first two parameters, <code>parm1</code>, and <code>parm2</code>. Parameter <code>parm3</code> retains the default value 5.0.</p>

<h3>
<a id="pgfId-1098008"></a><a id="marker-1076540"></a>Overriding Parameter Values Using defparam<a id="marker-1098007"></a></h3>

<p>
<a id="pgfId-1098010"></a>Use the <code>defparam</code><a id="marker-1098009"></a> statement to set parameter values in any module instance throughout the module hierarchy. With this capability, for example, you can <a id="marker-1098011"></a>group<a id="marker-1098012"></a> all your parameter override assignments together in a single module. The syntax is</p>

<pre class="webflare-courier-new">
<a id="pgfId-1098013"></a><strong>defparam</strong> <code><em>param</em></code> <strong>=</strong> <code><em>constant_exp</em></code> { <strong>,</strong> <code><em>param</em></code> <strong>=</strong> <code><em>constant_exp</em></code> } <strong>;</strong></pre>

<p>
<a id="pgfId-1098014"></a><span class="webflare-courier-new" style="white-space:pre"><em>param</em></span> must be a complete hierarchical path for the parameter whose value you want to change in a module instance. <span class="webflare-courier-new" style="white-space:pre"><em>constant_exp</em></span> must be an expression involving only constant numbers and parameters that are defined in the same module containing the <code>defparam</code> statement. </p>
<p>
<a id="pgfId-1098015"></a>For example, as the following code demonstrates, you could remove the parameter overrides from module <code>vquad</code> and put them in a new module, <code>annotate</code>. </p>

<pre class="webflare-courier-new">
<a id="pgfId-1098016"></a>module vdoubler (in, out) ;<br />input in ;<br />output out ;<br />electrical in, out ;<br />parameter parm1 = 0.2,<br />          parm2 = 0.1,<br />          parm3 = 5.0 ;<br />analog<br />    V (out) &lt;+ (parm1 + parm2 + parm3) * V (in) ;<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098017"></a>module vquad (qin, qout) ;<br />input qin ;<br />output qout ;<br />vdoubler vd1 (qin, aa1) ;<br />vdoubler vd2 (aa1, qout) ;<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098018"></a>module annotate ;<br />defparam <br />        vquad.vd1.parm3 = 4.0,<br />        vquad.vd2.parm1 = 0.3,<br />        vquad.vd2.parm2 = 0.2;<br />endmodule</pre>
<h3>
<a id="pgfId-1098021"></a><a id="marker-1098019"></a>Precedence<a id="marker-1098020"></a> Rules for Overriding Parameter Values</h3>

<p>
<a id="pgfId-1098022"></a>Use the following rules to determine which parameter override takes precedence when a parameter value is overridden by more than one assignment.</p>
<ul><li>
<a id="pgfId-1098024"></a>If overrides take place at different levels of the module hierarchy, the highest level override takes precedence. <a id="marker-1098023"></a></li><li>
<a id="pgfId-1098025"></a>If overrides take place at the same level of the module hierarchy, an override done by the <code>defparam</code><a id="marker-1098026"></a> statement takes precedence over overrides done by <a id="marker-1098027"></a>module instantiation <a id="marker-1098028"></a>statements.</li></ul>


<pre class="webflare-courier-new">
<a id="pgfId-1096730"></a>ps #(.b(1.5) inst1 (in, out);</pre>

<p>
<a id="pgfId-1097421"></a>Instances of paramsets are allowed to override only parameters that are declared in the paramset. Using a paramset instance to attempt to override a parameter of the base module that is not declared in the paramset results in a warning and the offending parameter override is ignored.</p>

<h2>
<a id="pgfId-1032020"></a><a id="31140"></a>Instantiating Analog Primitives</h2>

<p>
<a id="pgfId-1074598"></a>The remaining sections of the chapter describe how to instantiate some analog primitives in your code. For more information, see the &#8220;Preparing the Design: Using Analog Primitives and Subcircuits&#8221; chapter of the <em>Virtuoso AMS Designer simulator User Guide</em>.</p>
<p>
<a id="pgfId-1035286"></a>As you can instantiate Verilog-AMS modules in other Verilog-AMS modules, you can instantiate <a id="marker-1035287"></a><a id="marker-1035288"></a>Spectre and SPICE masters in Verilog-AMS modules. You can also instantiate models and subcircuits in Verilog-AMS modules. For example, the following Verilog-AMS module instantiates two Spectre primitives: a resistor and an isource.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1035298"></a>module ri_test (pwr, gnd) ;<br />electrical pwr, gnd ;<br />parameter real ibias = 10u, ampl = 1.0 ;<br />electrical in, out ;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037615"></a>    resistor #(.r(100K)) RL (out, pwr) ;        //Instantiate resistor<br />    isource #(.dc(ibias)) Iin (gnd, in) ;    //Instantiate isource</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037617"></a>endmodule</pre>

<p>
<a id="pgfId-1032025"></a>When you connect a net of a discrete discipline to an analog primitive, the simulator automatically inserts a connect module between the two.</p>
<p>
<a id="pgfId-1040856"></a>However, some instances require parameter values that are not directly supported by the Verilog-AMS language. The following sections illustrate how to set such values in the instantiation statement.</p>

<h3>
<a id="pgfId-1032026"></a><a id="marker-1076542"></a>Instantiating Analog Primitives that Use Array Valued Parameters</h3>

<p>
<a id="pgfId-1032029"></a>Some analog primitives take <a id="marker-1032031"></a><a id="marker-1032032"></a>array valued parameters. For example, you might instantiate the <code>svcvs</code><a id="marker-1032034"></a> primitive like this:</p>

<pre class="webflare-courier-new">
<a id="pgfId-1032035"></a>module fm_demodulator(vin, vout, vgnd) ;<br />input vin, vgnd ;<br />output vout ;<br />electrical vin, vout, vgnd ;<br />parameter real gain = 1 ;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037623"></a>    svcvs #(.gain(gain),.poles({-1M, 0, -1M, 0}))<br />         af_filter (vout, vgnd, vin, vgnd) ;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037625"></a>    analog begin<br />        ...<br />    end</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1037627"></a>endmodule </pre>

<p>
<a id="pgfId-1032036"></a>This <code>fm_demodulator</code> module sets the array parameter <code>poles</code> to a comma-separated list enclosed by a set of square brackets.</p>

<h3>
<a id="pgfId-1032039"></a><a id="marker-1076544"></a><a id="marker-1032037"></a><a id="marker-1032038"></a>Instantiating Modules that Use Unsupported Parameter Types</h3>

<p>
<a id="pgfId-1032040"></a>Spectre built-in primitives take parameter values that are not supported directly by the Verilog-AMS language. The following cases illustrate how to instantiate such modules. </p>
<p>
<a id="pgfId-1032043"></a>To set a <a id="marker-1032041"></a><a id="marker-1032042"></a>parameter that takes a string type value, set the value to a string <a id="marker-1032044"></a>constant. For example, the next fragment shows how you might set the <code>file</code> parameter of the vsource device.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1035211"></a>vsource #(.type(&quot;pwl&quot;), .file(&quot;mydata.dat&quot;) V1(src,gnd);</pre>

<p>
<a id="pgfId-1032048"></a>To set an<a id="marker-1032046"></a><a id="marker-1032047"></a> enumerated parameter in an instance of a Spectre built-in primitive, enclose the enumerated value in quotation marks. For example, the next fragment sets the parameter <code>type</code> to the value <code>pulse</code>.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1032049"></a>vsource #(.type(&quot;pulse&quot;),.val1(5),.period(50u)) Vclk(clk,gnd);</pre>
<h2>
<a id="pgfId-1043081"></a><a id="90322"></a>Using an M Factor (Multiplicity <a id="mfactor"></a>Factor)<a id="marker-1098336"></a></h2>

<p>
<a id="pgfId-1098392"></a>Circuit designers use m factors to mimic parallel copies of identical devices without having to instantiate large sets of devices in parallel. A design instance can inherit an m factor from one of its ancestors in a hierarchy of instances. The value of the inherited m factor in a particular module instance is the product of the m factor values in the ancestors of the instance and of the m factor value in the instance itself. If there are no passed m factors in the instance or in the ancestors of the instance, the value of the m factor is one (1.0). </p>
<p>
<a id="pgfId-1098412"></a>In the Cadence implementation of Verilog-AMS, you use the <code>inherited_mfactor</code><a id="marker-1098447"></a> attribute to access the value of the m factor and set its value as follows: </p>

<pre class="webflare-courier-new">
<a id="pgfId-1098394"></a>(* inherited_mfactor *) parameter real m=1;</pre>

<p>
<a id="pgfId-1098349"></a>and you use the <code></code>passed_mfactor<a id="marker-1098440"></a> attribute<a id="marker-1098463"></a> to pass an m factor down the hierarchy; for example: </p>

<pre class="webflare-courier-new">
<a id="pgfId-1098434"></a>one #(.m(3)) (* integer passed_mfactor = &quot;m&quot;; *) One();</pre>

<p>
<a id="pgfId-1098475"></a>This example specifies an m-factor parameter called <code>m</code>, gives it the value 3, and passes that value down to instance <code>One</code> of the module called <code>one</code>. Module <code>one</code> does not have to have the <code>m</code> parameter declared in its interface.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1098426"></a>If you are using the AMS Designer simulator in the AMS Designer environment, the AMS netlister inserts the <code>passed_mfactor</code> attribute so that you only need to insert the <code>inherited_mfactor</code> parameter. </div>

<h3>
<a id="pgfId-1098138"></a>Example: Using an M Factor<a id="marker-1098320"></a></h3>

<p>
<a id="pgfId-1098139"></a>The following example illustrates how the m-factor value is passed down the hierarchy and how the effective value is the product of the m factors in the current instance and in the ancestors of the current instance.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1098140"></a>//Verilog-AMS HDL for &quot;amslib&quot;, &quot;top&quot; &quot;verilogams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098141"></a>&#8216;include &quot;constants.vams&quot;<br />&#8216;include &quot;disciplines.vams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098142"></a>module top;<br />    resistor R1(a,b);<br />    one #(.m(3)) (* integer passed_mfactor = &quot;m&quot;; *) One();<br />// The above sets the m factor for instance One to 3.<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098143"></a></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098144"></a>//Verilog-AMS HDL for &quot;amslib&quot;, &quot;one&quot; &quot;verilogams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098145"></a>&#8216;include &quot;constants.vams&quot;<br />&#8216;include &quot;disciplines.vams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098146"></a>module one ( );<br />    parameter real (* integer inherited_mfactor; *) m=1;<br />    resistor R1(a,b);<br />    two Two();<br />    analog $strobe (&quot;Inherited mfactor in module one is %f&quot;,m);<br />// Value of m factor is 3, as set in module top.<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098147"></a></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098148"></a>//Verilog-AMS HDL for &quot;amslib&quot;, &quot;two&quot; &quot;verilogams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098149"></a>
&#8216;include &quot;constants.vams&quot;
&#8216;include &quot;disciplines.vams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098150"></a>module two ( );<br />    three #(.m(2)) (* integer passed_mfactor=&quot;m&quot;;*) Three();<br />// m factor is not accessed in this module, but a factor of 2 <br />// is added.<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098151"></a></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098152"></a>//Verilog-AMS HDL for &quot;amslib&quot;, &quot;three&quot; &quot;verilogams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098153"></a>&#8216;include &quot;constants.vams&quot;<br />&#8216;include &quot;disciplines.vams&quot;<br />module three ( );<br />    parameter real (* integer inherited_mfactor; *) m=1;<br />// The effective value of m factor is now 3 * 2 = 6.<br />    resistor R1(a,b);<br />    four Four(); // No m factor is specified.<br />    analog $strobe (&quot;Inherited mfactor in module three is %f&quot;,m);<br />endmodule</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098154"></a></pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098155"></a>//Verilog-AMS HDL for &quot;amslib&quot;, &quot;four&quot; &quot;verilogams&quot;</pre>
<pre class="webflare-courier-new">
<a id="pgfId-1098156"></a>&#8216;include &quot;constants.vams&quot;<br />&#8216;include &quot;disciplines.vams&quot;<br />module four ( );<br />    resistor R1(a,b);<br />endmodule</pre>

<p>
<a id="pgfId-1098157"></a>When you simulate, these modules produce output like the following.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1098158"></a>xcelium&gt; run<br />inherited mfactor in module one is 3.000000<br />inherited mfactor in module three is 6.000000</pre>
<h2>
<a id="pgfId-1098160"></a>Including Verilog-A Modules in Spectre Subcircuits<a id="80353"></a></h2>

<p>
<a id="pgfId-1098161"></a>Users of AMS Designer can instantiate Spectre cells in their Verilog-AMS code. By using the <code>ahdl_include</code> statement, those Spectre cells can, in turn, instantiate Verilog-A modules. This situation, which users of Spectre libraries often encounter, is summarized by the following diagram.</p>

<p>
<a id="pgfId-1098184"></a></p>
<div class="webflare-div-image">
<img width="668" height="128" src="images/chap10-5.gif" /></div>

<p>
<a id="pgfId-1098185"></a>To set up a hierarchy like this one, you use an <code>ahdl_include</code> statement in the Spectre subcircuit to include the Verilog-A module.</p>
<p>
<a id="pgfId-1098186"></a>The <code>ahdl_include</code> statement used in the Spectre subcircuit has the following format.</p>

<pre class="webflare-courier-new">
<a id="pgfId-1098187"></a>ahdl_include &quot;<code><em>filename</em></code>&quot;</pre>

<p>
<a id="pgfId-1098188"></a>For <span class="webflare-courier-new" style="white-space:pre"><em>filename</em></span>, use either a full or a relative path that resolves across your network. For a Verilog-A file, <span class="webflare-courier-new" style="white-space:pre"><em>filename</em></span> must have a <code>.va</code> file extension.</p>
<p>
<a id="pgfId-1098189"></a>For example, to include in your Spectre subcircuit a Verilog-A npn instance with the name <code>ahdlNpn</code>, you use a statement like the following,</p>

<pre class="webflare-courier-new">
<a id="pgfId-1098190"></a><code>ahdl_include &quot;/usr/ahdlNpn.va&quot;</code></pre>

<p>
<a id="pgfId-1042131"></a>Be sure that you make the Spectre subcircuit available by defining the MODELPATH variable. For more information about this procedure, see the &#8220;Using Subcircuits and Models Written in SPICE or Spectre&#8221; section, in Chapter 3, of the <em>Virtuoso AMS Designer simulator User Guide</em>.</p>

<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="chap9.html" id="prev" title="Simulator Functions">Simulator Functions</a></em></b><b><em><a href="chap11.html" id="nex" title="Mixed-Signal Aspects of Verilog-AMS">Mixed-Signal Aspects of Verilo ...</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2019, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>