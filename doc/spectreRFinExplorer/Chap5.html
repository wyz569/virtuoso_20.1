
<html><head><title>Multiple Input Large and Small-signal Analyses</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2020-06-25" />
<meta name="CreateTime" content="1593085680" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Provides user information for Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis" />
<meta name="DocTitle" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Multiple Input Large and Small-signal Analyses" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.2.1" />
<meta name="Keyword" content="spectreRFinExplorer" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2020-06-25" />
<meta name="ModifiedTime" content="1593085680" />
<meta name="NextFile" content="Chap6.html" />
<meta name="Group" content="SpectreRF" />
<meta name="Platform" content="Custom IC Design" />
<meta name="PrevFile" content="Chap4.html" />
<meta name="c_product" content="Spectre" />
<meta name="Product" content="Spectre" />
<meta name="ProductFamily" content="Spectre" />
<meta name="ProductVersion" content="19.1" />
<meta name="RightsManagement" content="Copyright 2012-2020 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide -- Multiple Input Large and Small-signal Analyses" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="Version" content="19.1" />
<meta name="SpaceKey" content="spectreRFinExplorer191" />
<meta name="webflare-version" content="2.0" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="spectreRFinExplorerTOC.html">Contents</a></li><li><a class="prev" href="Chap4.html" title="Single Input Large and Small-signal Analyses">Single Input Large and Small-s ...</a></li><li style="float: right;"><a class="viewPrint" href="spectreRFinExplorer.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="Chap6.html" title="Envelope (ENVLP) Analysis">Envelope (ENVLP) Analysis</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide<br />Product Version 19.1, June 2020</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>5
<a id="pgfId-1149649"></a></h1>
<h1>
<a id="pgfId-1149650"></a><hr />
Multiple Input Large and Small-signal Analyses<hr />
</h1>
<h2>
<a id="pgfId-1201034"></a><a id="65248"></a>Quasi-Periodic St<a id="qpss"></a>eady-State Analysis (QPSS)</h2>

<p>
<a id="pgfId-1152232"></a>QPSS is a large-signal analysis that is intended for two or more input frequencies. Both shooting and harmonic balance engines are available in qpss. In general, harmonic balance is faster and uses less memory than shooting for most applications. Shooting qpss should be used for the cases where harmonic balance just does not work because the system is too nonlinear. Examples include sampling circuits with a sample clock and a second periodic input, and switched-capacitor circuits with a sample clock and a periodic input.</p>
<p>
<a id="pgfId-1168642"></a>In general, when harmonic balance qpss is needed, it is better to use the hb analysis as described in Chapter 3 of this user guide. The reason for this suggestion is that all the harmonic balance improvements are being implemented in the hb analysis <em>Choosing Analyses</em> form, and generally are not added to the qpss <em>Choosing Analyses</em> form. An example is the ability to run an oscillator and a periodic input, which can be done in hb, but not in qpss. Another example is auto harmonic selection.</p>
<p>
<a id="pgfId-1168649"></a>As a strong recommendation, when you need harmonic balance qpss, switch to the hb <em>Choosing Analyses</em> form instead.</p>

<h3>
<a id="pgfId-1189377"></a>Example</h3>

<p>
<a id="pgfId-1189387"></a>Consider a sampling circuit shown below.</p>

<p>
<a id="pgfId-1251042"></a></p>
<div class="webflare-div-image">
<img width="668" height="589" src="images/Chap5-2.gif" /></div>

<p>
<a id="pgfId-1189404"></a>The input source is sinusoidal, and the frequency and amplitude have been set to variable names.</p>

<p>
<a id="pgfId-1251083"></a></p>
<div class="webflare-div-image">
<img width="428" height="710" src="images/Chap5-3.gif" /></div>

<p>
<a id="pgfId-1189411"></a>This allows the setting of the frequency and amplitude by changing those variables in the ADE Explorer environment without needing to change the circuit. Note also that there is a DC level for the sinusoid. This is because the circuit only includes an N FET switch. This places the signal in the middle of the range of the circuit.</p>
<p>
<a id="pgfId-1189451"></a>Variables are also used to set the sample clock.</p>

<p>
<a id="pgfId-1251118"></a></p>
<div class="webflare-div-image">
<img width="428" height="710" src="images/Chap5-4.gif" /></div>

<p>
<a id="pgfId-1189511"></a>Those variables are set in ADE Explorer.</p>

<p>
<a id="pgfId-1251158"></a></p>
<div class="webflare-div-image">
<img width="609" height="394" src="images/Chap5-5.gif" /></div>

<p>
<a id="pgfId-1189536"></a>For this example, the input frequency is 1MHz with a 50mV peak amplitude. The sample clock is 100MHz.</p>
<p>
<a id="pgfId-1189551"></a>Now the qpss analysis needs to be set up.</p>

<p>
<a id="pgfId-1251199"></a></p>
<div class="webflare-div-image">
<img width="363" height="712" src="images/Chap5-6.gif" /></div>

<p>
<a id="pgfId-1189585"></a>The <em>Engine</em> is <em>shooting</em>. One signal must be set to <em>Large</em>, and the rest must be set to <em>Moderate</em>. The large signal should be the one that causes the most distortion in the circuit. In this case, that signal is the sample clock. <em>Large</em> and <em>Moderate</em> are just terminologies used by qpss. The qpss solution is a large-signal solution with all the signals applied to the circuit. More information will be provided later on in this chapter.</p>
<p>
<a id="pgfId-1189594"></a>The number of harmonics to be calculated must also be set. For reasons described later, the number of harmonics on the Large signal are not critical. For the moderate signals, if the signal amplitude is well below the compression point, two or three harmonics are suggested. If a signal is at the compression point, five harmonics are suggested. If the signal is above the compression point, start with seven harmonics. You may need more harmonics to get an accurate solution.</p>
<p>
<a id="pgfId-1189602"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer. The <em>Direct Plot Form</em> is displayed.</p>

<p>
<a id="pgfId-1251309"></a></p>
<div class="webflare-div-image">
<img width="284" height="580" src="images/Chap5-7.gif" /></div>

<p>
<a id="pgfId-1189624"></a>Select qpss results. In this case, the output spectrum will be displayed. Peak is selected because the input is 50mV peak. This allows a direct comparison to be made. Magnitude and not dB is set to get a direct comparison.</p>
<p>
<a id="pgfId-1189641"></a>Now select the net in the circuit. The output net is selected for this example.</p>
<p>
<a id="pgfId-1189648"></a>The waveform is displayed.</p>

<p>
<a id="pgfId-1251344"></a></p>
<div class="webflare-div-image">
<img width="590" height="382" src="images/Chap5-8.gif" /></div>

<p>
<a id="pgfId-1189669"></a>The waveform is zoomed in near DC. A marker has been placed to measure the output amplitude at 1MHz. As expected, the output amplitude is slightly less than 50mV peak.</p>
<p>
<a id="pgfId-1189676"></a>The sample clock feedthrough is also measured. In the zoomed in view near 100MHz (the sample frequency), the amplitude is about 62 mV peak</p>

<p>
<a id="pgfId-1251386"></a>.</p>
<div class="webflare-div-image">
<img width="619" height="399" src="images/Chap5-9.gif" /></div>
<h3>
<a id="pgfId-1168663"></a>QPSS Shooting Concepts</h3>

<p>
<a id="pgfId-1168673"></a>Think of an example where 1GHz and 1GHz plus 1MHz frequencies are applied to a circuit. If we try to use PSS Shooting on this case, then 1000 cycles of 1GHz and 1001 cycles of 1.001GHz need to be simulated by solving for the continuous waveform that is produced.</p>
<p>
<a id="pgfId-1247921"></a>This is impractical for several reasons. First, shooting pss is known to have convergence problems when the total number of cycles of the highest frequency to be simulated exceeds somewhere between 50 and 250 cycles, depending on the nonlinearity of the circuit. Second, when 1000 cycles need to be simulated, at least 20K timepoints are required to get a reasonably accurate waveform. Because PSS Shooting saves not only the solution voltages and currents (if selected) but also the solution matrix at each timepoint, the amount of memory required for a simulation like this is very high.</p>
<p>
<a id="pgfId-1247935"></a>If the pss simulation could be completed, all the harmonics of 1MHz would need to be calculated through at least the third harmonic of 1001 MHz, or 3003 harmonics. Not only does the time-domain simulation take a long time, but also the Fourier transform takes a long time.</p>
<p>
<a id="pgfId-1247945"></a>If you have this case where the pss beat frequency is a small fraction of the highest frequency, use qpss or hb instead.</p>
<p>
<a id="pgfId-1168687"></a>Qpss is similar to harmonic balance in that you need to specify the number of harmonics to calculate for each tone in the circuit. Qpss calculates the harmonics of the inputs and the mixing products that are specified by the number of harmonics that are set for each input tone. It does not calculate all the harmonics of 1 MHz. Because it does not calculate all the harmonics, it does not need all the data that the pss analysis needs, thus it runs faster than PSS Shooting for an equivalent set of input frequencies.</p>
<p>
<a id="pgfId-1168680"></a>Qpss does not simulate the continuous waveform. Instead, it solves for the waveform in small slices of time during the overall period. The more harmonics you want to solve for requires that more slices of time need to be simulated. Just like in harmonic balance, calculating more harmonics takes more time and memory. All the input signals are applied in the circuit, and qpss solves for the steady-state waveforms in each slice of time. This time-domain output is never available for plotting. Instead, an ifft is offered to calculate the time-domain waveform.</p>
<p>
<a id="pgfId-1168694"></a>Qpss shooting requires that you select one signal as large, and the rest of the signals are set to moderate. Large and moderate are just terminology used by the qpss analysis. Qpss shooting is a large-signal analysis with all the signals applied.</p>
<p>
<a id="pgfId-1169146"></a>The large signal should be the signal that causes the largest amount of distortion in the circuit, or the non-sinusoidal input if there is one present. All the moderate tones must be sinusoidal.</p>
<p>
<a id="pgfId-1168701"></a>The large signal specifies the period of each slice in time. In order for qpss shooting to be efficient, the large signal must be a high frequency so that the period of each slice is kept short. If you take an example of 1MHz and 1GHz being applied to the circuit, you must select the 1GHz signal as large, or the runtime of qpss will be really long. If you take this example, if you simulate slices of 1GHz, everything works. If you simulate slices of 1MHz, you have very long runtimes.</p>
<p>
<a id="pgfId-1168710"></a>Here is an example for a system with 1GHz and 1.001GHz applied. The overall waveform contains 1000 cycles of the 1GHz signal and 1001 cycles of the 1.001GHz signal. This waveform comes from the transient analysis.</p>

<p>
<a id="pgfId-1251425"></a></p>
<div class="webflare-div-image">
<img width="619" height="398" src="images/Chap5-10.gif" /></div>

<p>
<a id="pgfId-1168731"></a>Below are several shots of a 1 nsec period at different times during the simulation. This is at the very beginning of the simulation.</p>

<p>
<a id="pgfId-1251458"></a></p>
<div class="webflare-div-image">
<img width="619" height="398" src="images/Chap5-11.gif" /></div>

<p>
<a id="pgfId-1168752"></a>This is 1/4th of the way through. The waveform in this slice is very different.</p>
<p>
<a id="pgfId-1251495"></a></p>

<div class="webflare-div-image">
<img width="619" height="400" src="images/Chap5-12.gif" /></div>

<p>
<a id="pgfId-1168830"></a>This is half way through. </p>

<p>
<a id="pgfId-1251546"></a></p>
<div class="webflare-div-image">
<img width="619" height="401" src="images/Chap5-13.gif" /></div>

<p>
<a id="pgfId-1168851"></a>This is 3/4ths of the way through.</p>

<p>
<a id="pgfId-1251601"></a></p>
<div class="webflare-div-image">
<img width="619" height="400" src="images/Chap5-14.gif" /></div>

<p>
<a id="pgfId-1168980"></a>What qpss shooting does is solve for the steady-state waveform with all the signals applied in the slices that are needed in order to calculate the number of harmonics that are specified for each signal.</p>
<p>
<a id="pgfId-1169000"></a>Calculating harmonics for the large signal in each slice and averaging the power at each harmonic gives the power in the large signal.</p>
<p>
<a id="pgfId-1169008"></a>For one moderate signal, (2 * Number of harmonics) + 1 slices need to be simulated. For three harmonics on the moderate signal, then 7 slices need to be simulated. This gives enough information to solve for the positive frequencies, negative frequencies, and the DC term to be calculated.</p>
<p>
<a id="pgfId-1168773"></a>If there are two moderate signals, then the number of slices is [(2 * Number of harmonics on moderate 1) + 1] * [(2 * Number of harmonics on moderate 2) + 1]. If there are three harmonics on each moderate tone, 7 * 7 or 49 slices need to be simulated. The waveform becomes more complex and the number of harmonics that are created by the system are larger when three tones are applied to the system. below is the transient waveform for 1GHz, 1.004GHz and a 1.005GHz signals applied to the system. This waveform is from the transient analysis.</p>

<p>
<a id="pgfId-1251652"></a></p>
<div class="webflare-div-image">
<img width="619" height="400" src="images/Chap5-15.gif" /></div>

<p>
<a id="pgfId-1169076"></a>Each slice is a pss analysis where the solution voltages and currents (if specified) and the solution matrix need to be saved at every timepoint of every pss analysis. For more information about the pss analysis, see the beginning of Chapter 4.</p>
<p>
<a id="pgfId-1169331"></a>At the end of the simulation, the harmonic content is calculated based on the waveforms in the slices. Since all the input signals are applied in every slice, the harmonics of all the mixing products can be calculated.</p>

<h3>
<a id="pgfId-1169339"></a>What Happens When you Start a QPSS Analysis?</h3>

<p>
<a id="pgfId-1169352"></a>First, two pss iterations are performed with only the large signal applied. This gives an approximate harmonic content with just the large signal applied. This is shown in the Spectre output window, as shown below.</p>

<p>
<a id="pgfId-1251687"></a></p>
<div class="webflare-div-image">
<img width="454" height="692" src="images/Chap5-16.gif" /></div>

<p>
<a id="pgfId-1169360"></a>Next, two (by default) stabilization cycles are performed. All the signals are applied to the circuit, and a very simple-minded optimization to attempt to have all the currents sum to zero at all the harmonics at all the nodes is performed. In this phase you will see that all the slices are being simulated. There is only a very small time delay between the first set of slices and the second set of slices. These slices are reported as transient integrations in the qpss output window. In this case, there was a large signal and a single moderate signal with three harmonics specified. This results in seven slices that need to be simulated. Each slice is called a transient integration in the Spectre output window.</p>
<p>
<a id="pgfId-1169621"></a>The number of stabilization cycles can be controlled by an option called stabcycles. This is shown in the Spectre output window, as shown below.</p>

<p>
<a id="pgfId-1251723"></a></p>
<div class="webflare-div-image">
<img width="450" height="686" src="images/Chap5-17.gif" /></div>

<p>
<a id="pgfId-1169374"></a>Finally, a a series of full Newton iterations to the solution of the system is performed. Again, all the slices are solved, and iterating continues until convergence is reached. After each set of slices is simulated, there is a delay while the next iteration is calculated in the Newton iteration. A maximum of 20 Newton iterations are allowed by default, and can be changed by setting the maxperiods option. This circuit converged in three Newton iterations.</p>

<p>
<a id="pgfId-1251775"></a></p>
<div class="webflare-div-image">
<img width="477" height="689" src="images/Chap5-18.gif" /></div>
<h3>
<a id="pgfId-1169814"></a>ADE Implementation</h3>

<p>
<a id="pgfId-1169824"></a>In this section, just the qpss analysis <em>Choosing Analyses</em> form and the options for qpss are shown. An examples section follows with all the steps needed for a simulation.</p>
<p>
<a id="pgfId-1169831"></a>To open the <em>Choosing Analyses</em> form select <em>Analysis</em> - <em>Choose</em> in ADE Explorer, or select the <em>Choosing Analyses</em> icon <img width="37" height="24" src="images/Chap5-19.gif" /><span> located on the upper right of the ADE Explorer window. You can also click the </span><em>Click to add analysis</em><span> text under the </span><em>Analysis</em><span> section in the </span><em>Setup</em><span> pane of ADE Explorer.</span></p>

<p>
<a id="pgfId-1169851"></a>The <em>Choosing Analyses</em> form is displayed as shown below.</p>

<p>
<a id="pgfId-1251869"></a></p>
<div class="webflare-div-image">
<img width="363" height="712" src="images/Chap5-20.gif" /></div>

<p>
<a id="pgfId-1251897"></a>In the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1251908"></a>Select <em>qpss</em>.</li><li>
<a id="pgfId-1169898"></a>The default engine is <em>Shooting</em>. If you prefer Harmonic Balance, use the hb form, as this form is most up to date.</li><li>
<a id="pgfId-1169935"></a>All the sources are listed at the top of the form. To change the settings, select one of the lines, and change the values in the editing line just below the list.</li><li>
<a id="pgfId-1169948"></a>One signal must be <em>Large</em>. This should be the signal that causes the most distortion in the circuit. The frequency of this signal must be relatively high compared to the highest input frequency, or the simulation will be quite slow and require a lot of memory. If there is a non-sinusoidal source in the circuit, that signal must be set as large. All the moderate tones must be sinusoids.</li><li>
<a id="pgfId-1169984"></a>Select an accuracy level. Liberal is not suggested.</li></ol>




<p>
<a id="pgfId-1170201"></a>Setting errpreset changes the defaults of a number of qpss options. The options that are affected are shown in the table below.</p>
<table class="webflareTable" id="#id1170205">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1170299">
<a id="pgfId-1170299"></a>Errpreset</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1170301">
<a id="pgfId-1170301"></a>Reltol</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1170303">
<a id="pgfId-1170303"></a>Lteratio</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1170305">
<a id="pgfId-1170305"></a>Maxstep</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170307"></a><code>liberal</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170309"></a><code>1e-3</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170311"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170313"></a>Period/80</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170315"></a><code>moderate</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170317"></a><code>1e-4</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170319"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170321"></a>Period/100</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170323"></a><code>conservative</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170325"></a><code>1e-5</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170327"></a>10; 3.5 if reltol is smaller than <br /><code>1e-4*10.0/3.5</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1170329"></a>Period/200</p>
</td>
</tr>
</tbody></table>

<h3>
<a id="pgfId-1170202"></a>QPSS Options</h3>
<h4>
<a id="pgfId-1170001"></a>Commonly Us<a id="qpss_options"></a>ed Options</h4>

<p>
<a id="pgfId-1170011"></a>There are only a small number of options that are commonly used.</p>

<h4><em>
<a id="pgfId-1170018"></a>stabcycles</em></h4>
<p>
<a id="pgfId-1251948"></a></p>
<div class="webflare-div-image">
<img width="447" height="476" src="images/Chap5-21.gif" /></div>

<p>
<a id="pgfId-1170052"></a>If you are having convergence problems, increasing stabcycles usually helps. Increase to about 10. If this does not work, look at the <code>conv_norm</code> number at the end of each stabilization cycle, and increase stabcycles until the <code>conv_norm</code> does not decrease much with more cycles.</p>

<h4><em>
<a id="pgfId-1170028"></a>maxperiods</em></h4>
<p>
<a id="pgfId-1251998"></a></p>
<div class="webflare-div-image">
<img width="386" height="424" src="images/Chap5-22.gif" /></div>

<p>
<a id="pgfId-1170065"></a>Watch the <em>conv_norm</em> number that is reported at the end of each Newton iteration. If this number is generally trending down, then more newton iterations may allow convergence. Start with about 50.</p>

<h4>
<a id="pgfId-1170333"></a>Uncommonly Used QPSS Options</h4>

<p>
<a id="pgfId-1170343"></a>The following options are in the <em>Convergence</em> tab.</p>

<h4><em>
<a id="pgfId-1170739"></a>ic</em></h4>

<p>
<a id="pgfId-1170770"></a>Initial conditions can be specified graphically by selecting <em>Simulation</em> - <em>Convergence Aids</em> - <em>Initial Condition</em> in ADE Explorer. Initial conditions can also be specified from a file using the <em>readic</em> property. Capacitors and inductors have the initial condition properties in the property list for the component. For capacitors, this is an initial voltage across the capacitor, and for inductors, it is an initial current in the inductor. The default is to observe all the initial conditions in the DC analysis that is used as the time-zero timepoint. The initial conditions force a voltage or current to be present in the time-zero solution. The initial conditions are released for the rest of the transient simulation in the tstab interval. The <em>ic</em> option controls the initial conditions that should be observed in the time-zero timepoint. <em>all</em> is the default. <em>dev</em> means that only the initial conditions on capacitors and inductors are observed. <em>node</em> means that only the initial conditions on a node are observed. <em>dc</em> means that no initial conditions are observed.</p>

<h4><em>
<a id="pgfId-1170763"></a>skipdc</em></h4>

<p>
<a id="pgfId-1170789"></a>In some cases, the time-zero timepoint DC analysis does not converge. Instead of stopping the simulation, <em>skipdc</em> allows the tstab simulation to continue using an assumed solution for the time-zero timepoint in the tstab interval. The default is <em>no</em> and a DC analysis is run to get the initial timepoint. <em>yes</em> means skip the DC solution, and proceed directly to the tstab simulation. All the nodes with initial conditions specified start at the initial condition value. Nodes with batteries start at the battery voltage. Nodes with no initial conditions start at zero volts. For <code>skipdc=yes</code>, the signal sources start as specified immediately in the tstab simulation. <em>sigrampup</em> uses the same assumptions for the starting voltages as <em>yes</em> does, but the start time is set to negative one tenth of the stop time for the tstab interval. At this time, the signal source time-varying part starts at zero and linearly ramps up to the full value at time = zero. After time = zero, the sources have the full amplitude time-varying part.</p>

<h4><em>
<a id="pgfId-1170756"></a>readic</em></h4>

<p>
<a id="pgfId-1170815"></a>This specifies an ascii file that contains two columns to be read as initial conditions. The first column is the node name. The second column is the voltage value. If the entry does not start with / (slash), the file is located in the netlist directory. To find the netlist directory, select <em>Setup</em>- <em>Simulator/Directory/Host</em> in ADE Explorer. Look in the <em>Project Directory</em> field for the location of the simulation directory. Navigate to that directory and then to the <span class="webflare-courier-new" style="white-space:pre"><em>&lt;Circuit Name&gt;</em></span><code>/spectre/</code><span class="webflare-courier-new" style="white-space:pre"><em>&lt;schematic or config&gt;</em></span><code>/netlist</code> directory. You can also click (<img width="30" height="24" src="images/Chap5-23.gif" /><span>) and browse to the directory.</span></p>
<h4><em>
<a id="pgfId-1170749"></a>maxiters</em></h4>

<p>
<a id="pgfId-1170838"></a>The transient analysis for tstab and shooting interval iterate to a solution at each timepoint. <em>maxiters</em> specifies the maximum number of iterations before the timestep is cut for another try at convergence. In some cases, model parameters can cause discontinuities in the device current or capacitance. If this occurs, the change in the circuit condition when the discontinuity is crossed can be large enough to require more than the five iterations that are allowed by default. Specifying <em>maxiters</em> to the 40 to 100 range usually allows the simulator to converge in spite of the discontinuity. </p>
<p>
<a id="pgfId-1170405"></a>The following options are in the Accuracy tab.</p>

<h4><em>
<a id="pgfId-1170673"></a>method</em></h4>

<p>
<a id="pgfId-1170887"></a>This option controls the integration method for tstab and the shooting windows.The default value is <em>gear2only</em>, which is recommended for all qpss simulations.</p>

<h4><em>
<a id="pgfId-1170732"></a><a id="23119"></a>relref</em></h4>

<p>
<a id="pgfId-1170905"></a>In the order of most to least accurate, the <em>relref</em> settings are <em>pointlocal</em>, <em>alllocal</em>, <em>sigglobal</em>, and <em>allglobal</em>. The default for the <em>moderate</em> and <em>conservative</em> accuracy selections is <em>alllocal</em> which is preferred. Liberal is not suggested.</p>
<p>
<a id="pgfId-1248346"></a><em>relref</em> is used in the transient analysis in the tstab interval for both shooting and harmonic balance and in the shooting window for shooting. In some cases, the timestep can collapse to near zero when the default is used for relref. The symptom is that in the Spectre output window, no progress is made for many reporting intervals. By default, every 10 seconds, Spectre will show progress in the tstab and shooting intervals. For example, for every update in the Spectre output window, the percent complete might stay at 15%. The solution to this is to set <em>relref</em> to <em>sigglobal</em>, which is slightly less accurate. In the Fourier transform, the noise floor usually degrades by 3 to 6 dB. Another possibility is to try the <em>lteminstep</em> option as described in the <em>AdditionalParams</em> option of the <em>Misc</em> tab.</p>
<p>
<a id="pgfId-1170936"></a>Refer to <a href="Chap4.html#91916">Relref</a> for a detailed discussion on <em>relref</em>.</p>

<h4><em>
<a id="pgfId-1170725"></a>lteratio</em></h4>

<p>
<a id="pgfId-1170953"></a><em>lteratio</em> is a multiplier for the allowable numerical integration error in the tstab interval and the shooting windows. The default is 3.5. <em>lteratio</em> cannot be set smaller than 1.0 and is normally between 3.5 and 100. In some cases, the timestep collapses to near zero In this case, there might be a model discontinuity. To test this, disable numerical integration timestep control by setting <em>lteratio</em> to 1e9. Note that this is an extreme measure not to be used under normal simulations. If the timestep still collapses, there is a discontinuity in one of the models in the circuit. This could be a device model or a Verilog-A model. If it is necessary to set <em>lteratio</em> very large to get the simulation to complete, you must also set <em>maxstep</em> small enough to preserve the accuracy of the simulation.</p>

<h4><em>
<a id="pgfId-1170704"></a>itres</em></h4>

<p>
<a id="pgfId-1170985"></a>Use the default for this option.</p>
<p>
<a id="pgfId-1217668"></a><em>Itres</em> controls the precision (number of digits solved for) in the first Newton iteration. The default is 1e-4 which causes four digits of resolution in the first Newton iteration. Subsequent iterations are solved with more precision.</p>

<h4><em>
<a id="pgfId-1170690"></a>resgmrescycle</em></h4>

<p>
<a id="pgfId-1171028"></a>Leave this option at the default.</p>

<h4><em>
<a id="pgfId-1170683"></a>inexactnewton</em></h4>

<p>
<a id="pgfId-1171048"></a>In the simulation time between iterations, an estimate is made for the starting point for the next iteration. <em>inexactNewton</em> causes an inexact solution for the matrix that calculates the next starting point to be calculated. In some cases, solving the matrix exactly on the first iteration can cause the iterative solver to need many iterations to achieve convergence. Setting i<em>nexactNewton</em> causes a different series of iterations, which may speed up the simulation, or alternatively, allow the simulation to converge. The inexactness is reduced as the iterations progress. Try this option when you have convergence difficulties.</p>
<p>
<a id="pgfId-1190108"></a>The following options are in the <em>Output</em> tab.</p>

<h4><em>
<a id="pgfId-1170579"></a>annotate</em></h4>

<p>
<a id="pgfId-1171088"></a>This option controls the level of detail in the output log. The default is <em>status</em>. No detail is provided when you select <em>no</em>, while more details are provided as you move towards right with steps option providing maximum detail.</p>

<h4><em>
<a id="pgfId-1170652"></a>save</em></h4>

<p>
<a id="pgfId-1171110"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved.</p>

<h4><em>
<a id="pgfId-1170645"></a>nestlvl</em></h4>

<p>
<a id="pgfId-1171139"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> must be an integer.</p>

<h4><em>
<a id="pgfId-1170638"></a>compression</em></h4>

<p>
<a id="pgfId-1171172"></a>Normally, this should not be used for RF simulation. It is not digital compression. This option applies only in the tstab interval of the simulation. For RF simulation, where the input is sinusoidal, the size of the results file will normally double. It is useful only for circuits that are predominantly square wave.</p>

<h4><em>
<a id="pgfId-1170631"></a>oppoint</em></h4>

<p>
<a id="pgfId-1171191"></a>Normally, this should be left at the default of <em>rawfile</em>. It controls where the time-zero operating point solution should be saved to.</p>

<h4><em>
<a id="pgfId-1170617"></a>skipstart</em></h4>

<p>
<a id="pgfId-1171210"></a>Normally, this is not used for RF simulation unless there is a very long tstab. It is a way of reducing the amount of data in the output file from the tstab interval by not writing many of the timepoints to the output file. <em>skipstart</em> controls the simulation time where the skipping is to start. The default is 0 (zero).</p>
<p>
<a id="pgfId-1231986"></a>If you want to save all the data for the first 5% of tstab, set skipstart to 0.05 * Tstab time. This will save all the data in the first part of the startup interval in tstab, and then begin reducing the amount of data sent to the output file.</p>

<h4><em>
<a id="pgfId-1170610"></a>skipstop</em></h4>

<p>
<a id="pgfId-1171229"></a>Normally, this is not used for RF simulation unless there is a very long tstab. This specifies the simulation time in the tstab interval where the skipping is to stop. The default is the stop time in the tstab interval.</p>
<p>
<a id="pgfId-1231993"></a>If you want to save all the data for the last 5% of tstab, set <em>skipstart</em> to 0.95 * Tstab time. This will save all the data in the last part of the startup interval in tstab. This allows full resolution at the end of the startup interval.</p>

<h4><em>
<a id="pgfId-1170603"></a>skipcount</em></h4>

<p>
<a id="pgfId-1171248"></a>If <em>skipstart</em> and <em>skipstop</em> are set, either <em>skipcount</em> or <em>strobeperiod</em> should be set, but not both. <em>skipcount</em> saves one out of every skipcount points to the output data file. A <em>skipcount</em> of 3 saves one, then skips two points. Skipcount of 10 saves one in 10 timepoints to the output file. The default is 1, which saves every point.</p>

<h4><em>
<a id="pgfId-1170596"></a>strobeperiod</em></h4>

<p>
<a id="pgfId-1171267"></a>If <em>skipstart</em> and <em>skipstop</em> are set, either <em>skipcount</em> or <em>strobeperiod</em> should be set, but not both. <em>strobeperiod</em> forces the simulation datapoints between <em>skipstart</em> and <em>skipstop</em> at the interval of <em>strobeperiod</em>.</p>

<h4><em>
<a id="pgfId-1170589"></a>strobedelay</em></h4>

<p>
<a id="pgfId-1170659"></a><em>strobedelay</em> specifies a time after the skipstart point for the beginning of the strobing. <em>strobedelay</em> must be between 0 (zero) and the time set in <em>strobeperiod</em>.</p>
<p>
<a id="pgfId-1190124"></a>The following options are in the <em>Reuse</em> tab.</p>

<h4><em>
<a id="pgfId-1170485"></a>write</em></h4>

<p>
<a id="pgfId-1171333"></a><em>write</em> specifies a filename in which to write the DC solution used as the first timepoint. If the name does not start with slash (/), the file will be written in the <em>netlist</em> directory. To determine the netlist directory location, select <em>Setup</em> - <em>Simulator/Directory/Host</em> in ADE Explorer. The <em>Project Directory</em> field lists the location of the simulation directory. From this directory, the netlist directory is in <em>&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>Circuit Name</em></span><em>&gt;/&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>simulator name</em></span><em>&gt;/&lt;schematic or config&gt;/netlist</em>.</p>

<h4><em>
<a id="pgfId-1170572"></a>writefinal</em></h4>

<p>
<a id="pgfId-1171352"></a><em>writefinal</em> writes the final qpss timepoint from the shooting window (not the final timepoint of the tstab interval) to the filename specified. See the description for <em>write</em> for the location.</p>

<h4><em>
<a id="pgfId-1170558"></a>swapfile</em></h4>

<p>
<a id="pgfId-1171379"></a>During the shooting intervals, the solution matrices need to be saved in order to calculate the settled voltages of every node for the next iteration. The solution matrices are the internal solution for all the simultaneous equations for the circuit. The solution vector is also saved, and these are the solution voltages and currents. Normally, this data is kept in memory which makes the Spectre process get larger, starting with the first Newton iteration. On 32-bit systems, a maximum process-size of slightly less than 4GB limits the size of the circuit that can be simulated. Even on 64-bit systems, there is a limit set by the amount of memory that is installed on the system that is running Spectre. If the process gets larger than the installed memory, then the process starts swapping to the disk.</p>
<p>
<a id="pgfId-1171371"></a>Swapping that is done by the operating system is inefficient because there is no logical relationship for the swapped memory pages. Setting swapfile to a name causes Spectre to write all the solution matrices to the disk in sequential cylinders so that the read time from the disk is faster than using swapping by the operating system. Disk accesses are inherently much slower than memory accesses, however, using swapfile is considerably faster than swapping in the OS. Using swapfile reduces the size of the Spectre process so that it fits in the memory installed in the machine, or allows larger circuits to be simulated. There is a large amount of data that typically is written to the disk. Because of this, the best choice is to write the data in a disk that is local to the machine. If the data is written over a high-latency network, it might actually be better to use the local swap space. Only a trial can determine which is better.</p>

<h4><em>
<a id="pgfId-1170551"></a>writeqpss</em></h4>

<p>
<a id="pgfId-1171391"></a>This option specifies that the full internal state of the qpss analysis be written out to the file specified in the option.</p>

<h4><em>
<a id="pgfId-1170544"></a>readqpss</em></h4>

<p>
<a id="pgfId-1171410"></a>This option specifies the file to be read in as a starting point for the next qpss analysis. If nothing is changed in the circuit, then only one Newton iteration is performed and small-signal analyses can be run with a much faster time for the qpss analysis. Small changes can be made to the circuit or to the analysis options as long as the topology of the circuit stays the same. Changes introduce a discontinuity at the beginning of the qpss analysis, which might be large enough to cause the qpss analysis to not converge.</p>

<h4><em>
<a id="pgfId-1170537"></a>saveclock</em></h4>

<p>
<a id="pgfId-1171429"></a><em>saveclock</em> saves the state of the simulation in the tstab interval at the time interval in seconds specified by <em>saveclock</em>. When the clock time has passed in the tstab interval, the file specified by the option <em>savefile</em> is created. When subsequent clock time intervals have passed, the file is overwritten. Use only one of the save options at a time.</p>

<h4><em>
<a id="pgfId-1170530"></a>saveperiod</em></h4>

<p>
<a id="pgfId-1171448"></a><em>saveperiod</em> saves the state of the simulation in the tstab interval at the simulation time interval in seconds specified by <em>saveperiod</em>. When the simulation time has passed in the tstab interval, the file specified by the option savefile is created. When subsequent simulation time intervals have passed, the file is overwritten. Use only one of the save options at a time.</p>

<h4><em>
<a id="pgfId-1170523"></a>savetime</em></h4>

<p>
<a id="pgfId-1171467"></a><em>savetime</em> is a list of times in the tstab interval where the state of the simulation is written out. The list should be specified with spaces between the entries. The information is written out with the filename specified in the <em>savefile</em> option with extensions for the time after that. Use only one of the save options at a time.</p>

<h4><em>
<a id="pgfId-1170516"></a>savefile</em></h4>

<p>
<a id="pgfId-1171494"></a>This is the file name to write out the tstab state information to. If you do not specify a filename that starts with the slash (/) character, the file is stored in the <em>netlist</em> directory. To locate the <em>netlist</em> directory, first select <em>Setup</em> - <em>Simulator/Directory/Host</em> menu in ADE Explorer, and read the path to the project directory. This is the path to the <em>simulation</em> directory. In the simulation directory, navigate to the <em>&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>circuit_name</em></span><em>&gt;/spectre/&lt;schematic or config&gt;/netlist</em> directory.</p>
<p>
<a id="pgfId-1171486"></a>Do not specify a relative path name like<em> ./save_file/run1</em>.</p>

<h4><em>
<a id="pgfId-1170495"></a>recover</em></h4>

<p>
<a id="pgfId-1171514"></a><em>recover</em> specifies the file name to recover the tstab simulation from. If <em>saveperiod</em> or <em>saveclock</em> are used to make the savefile, then just the same name as specified in <em>savefile</em> is used. If <em>savetimes</em> has a list of times specified, then several files are created at the times specified in the list. Click (<img width="31" height="26" src="images/Chap5-24.gif" />
) and browse to the netlist directory where the savefiles are shown.</p>

<p>
<a id="pgfId-1171521"></a></p>
<div class="webflare-div-image">
<img width="668" height="454" src="images/Chap5-25.gif" /></div>

<p>
<a id="pgfId-1171522"></a>Select one from the list, and click <em>Open</em>. This adds the full path to the <em>recover</em> option, as shown below. Also note that in the example below, the <em>savefile</em> option is still set, and times after the restart times are specified. This is specifically allowed. As long as tstab is 200n or larger, the files at 175n and 200n will be added and can be reused later.</p>

<p>
<a id="pgfId-1171526"></a></p>
<div class="webflare-div-image">
<img width="668" height="212" src="images/Chap5-26.gif" /></div>

<p>
<a id="pgfId-1170462"></a>The following options are in the <em>Misc</em> tab.</p>

<h4><em>
<a id="pgfId-1170395"></a>step</em></h4>

<p>
<a id="pgfId-1171585"></a>Leave this option at the default. All the nodes are checked for curvature in the local truncation error (Numerical integration error) check. If that node has a capacitor or inductor connected to it, the timestep should be controlled to reduce the numerical integration error. If the node does not have a capacitor or inductor connected to it and it has a lot of curvature, the timestep can only be reduced to the value specified in the <em>step</em> option. The default is the simulation interval divided by 1000.</p>

<h4><em>
<a id="pgfId-1170388"></a>maxstep</em></h4>

<p>
<a id="pgfId-1171618"></a>In qpss shooting, <em>maxstep</em> is observed in the tstab interval and in each of the shooting windows. Normally, <em>maxstep</em> should be left at the default and either setting <em>errpreset</em> or changing <em>reltol</em> is used to control the accuracy. In some cases, extreme accuracy is needed, and this is accomplished by setting a small maxstep value. A small constant timestep produces maximum accuracy at the cost of runtime and memory consumption. </p>

<h4><em>
<a id="pgfId-1190170"></a>readns</em></h4>

<p>
<a id="pgfId-1171643"></a>This specifies an ascii file with the same format as an ic file that is used as nodesets for the time-zero DC solution. Nodesets do not force a voltage to be held for the time-zero solution. Instead, they are a way of speeding up the time-zero calculation. As a suggestion, set the <em>write</em> option and the <em>readns</em> option to the same filename. The <em>write</em> option writes the time-zero solution to a file. When this is used as a starting point, many fewer iterations are needed for the time-zero point to converge.</p>

<h4><em>
<a id="pgfId-1170367"></a>cmin</em></h4>

<p>
<a id="pgfId-1171704"></a><em>cmin</em> can be used to improve convergence in the tstab and shooting intervals. If a value is set for <em>cmin</em>, a capacitor with this value is added to every node with the other terminal of the capacitor connected to the global ground node. If a 10f to 50f capacitor is added, this prevents instantaneous changes from occurring from timepoint to timepoint, thus improving the convergence at the cost of adding non-physical capacitors to the circuit. An example with 10 femtoFarads is shown below. Note that if 10 is entered, a 10 Farad capacitor is added from every node to ground. Remember the multiplier in the entry. An example is shown below.</p>

<p>
<a id="pgfId-1171708"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap5-27.gif" /></div>
<h4><em>
<a id="pgfId-1170360"></a>tstart</em></h4>

<p>
<a id="pgfId-1171724"></a>Normally, this is not used. <em>tstart</em> specifies the starting time for the tstab interval and defaults to 0 (zero). A negative, 0, or positive <em>tstart</em> is allowed.</p>

<h4><em>
<a id="pgfId-1170353"></a>additionalParams</em></h4>

<p>
<a id="pgfId-1171658"></a>This is a field for <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements. Multiple <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements are allowed with a space between them. Generally, this is used to unlock the beta features, however, there is one case where this field might be useful for an option that is not in the GUI.</p>
<p>
<a id="pgfId-1171659"></a>In some cases, either in the tstab interval or in one or more of the shooting windows, the timestep collapses to near zero. The symptom is that the percent complete stays at the same value for many reporting intervals. In this case, there might be a discontinuity in one of the models. </p>
<p>
<a id="pgfId-1171660"></a>In transient simulation, two things can reduce the timestep; having too much numerical integration error or taking too many iterations at a single timestep can cause the timestep to be cut. Spectre does not report what is causing the timestep to become small. One way to eliminate the possibility of numerical integration error (which is called local truncation error in the simulator) as the cause of reducing the timestep is to set <em>lteratio</em> to 1e9. The disadvantage of this is that it disables the normal method of timestep control, therefore, <em>maxstep</em> must be set to maintain accuracy. </p>
<p>
<a id="pgfId-1171661"></a>Another way to accomplish this is to set <em>lteminstep</em> to a value of about the stop time divided by 1e5. This allows the normal method of timestep control, but if for some reason the numerical integration error wants to cut the timestep too small, the error is ignored. <em>lteminstep</em> is the way to specify this. To do this in ADE Explorer, type <code>lteminstep=&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>Stop_Time</em></span><code>&gt;/1e5</code>. If you use <code>lteratio=1e9</code>, or if you set <em>lteminstep</em> and you still have very small timesteps, try increasing <em>maxiters</em> in the <em>Convergence</em> tab to between 40 and 100. When <em>lteratio</em> or <em>lteminstep</em> is set and you still have timestep problems, there is likely a discontinuity in either a device model or in a Verilog-A model. An example is shown below.</p>

<p>
<a id="pgfId-1171665"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap5-28.gif" /></div>
<h3>
<a id="pgfId-1171650"></a>Example</h3>

<p>
<a id="pgfId-1171977"></a>Consider a sample and hold circuit below.</p>

<p>
<a id="pgfId-1252172"></a></p>
<div class="webflare-div-image">
<img width="662" height="512" src="images/Chap5-29.gif" /></div>

<ol><li>
<a id="pgfId-1172003"></a>The input signal properties are shown below.<br />
<a id="pgfId-1252216"></a><div class="webflare-div-image">
<img width="451" height="711" src="images/Chap5-30.gif" /></div></li><li>
<a id="pgfId-1172037"></a>The input frequency and amplitude terms are set to variable names so that the amplitude and frequency can be easily set in ADE Explorer. Also, note that the sinusoid is centered at 1.55 volts. This is because the simple circuit above runs between 0 volts and 3.3 volts.</li><li>
<a id="pgfId-1172053"></a>Next, the variable values are set in ADE Explorer. The sample clock is 100MHz, and the signal is at 1MHz.<br />
<a id="pgfId-1252335"></a><div class="webflare-div-image">
<img width="615" height="396" src="images/Chap5-31.gif" /></div></li><li>
<a id="pgfId-1172305"></a>Now, the qpss analysis is set up, as shown below.<br />
<a id="pgfId-1252375"></a><div class="webflare-div-image">
<img width="390" height="718" src="images/Chap5-32.gif" /></div></li><li>
<a id="pgfId-1172382"></a>All the sources in the circuit are listed in the table at the top. The sample clock is set to large for two reasons. First, it causes the most distortion in the circuit. Second, it is the nonsinusoidal source. The input signal is set to moderate. 15 sample clock harmonics are set, and 5 harmonics for the input signal are set. Conservative is used because the distortion is likely to be small at low input amplitude.</li><li>
<a id="pgfId-1172537"></a>Now, run the simulation. When the run is complete, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1252458"></a><div class="webflare-div-image">
<img width="369" height="717" src="images/Chap5-33.gif" /></div>
<a id="pgfId-1252475"></a>In the <em>Direct Plot Form</em>:</li><li>
<a id="pgfId-1172557"></a>Select <em>qpss</em>. In this case, the voltage spectrum is plotted. Peak is used because it allows a direct comparison of input amplitude in volts peak to the output amplitude in volts peak. <em>Add To Outputs</em> is selected so that an expression gets added under the Maestro tab of the ADE Explorer window.</li><li>
<a id="pgfId-1172564"></a>The result is displayed in the waveform window.<br />
<a id="pgfId-1252542"></a><div class="webflare-div-image">
<img width="619" height="398" src="images/Chap5-34.gif" /></div></li><li>
<a id="pgfId-1172614"></a>Since the output at low frequency is desired, the X Axis is scaled to show just the output terms and the harmonics. To place a marker, move your mouse cursor near the frequency point you want, and type m.<br />
<a id="pgfId-1252584"></a><div class="webflare-div-image">
<img width="654" height="408" src="images/Chap5-35.gif" /></div></li><li>
<a id="pgfId-1172618"></a>The output is near 50mv, as set in the input source.</li></ol>



































<h4><em>
<a id="pgfId-1172907"></a>Add an ADE expression to calculate the amplitude of the output at the input frequency.</em></h4>

<p>
<a id="pgfId-1275034"></a>When you select the <em>Add to Outputs</em> check box in the Direct Plot Form and plot the results, the expression is added in the <em>Details</em> column, under the <em>Maestro</em> tab of ADE Explorer, as shown below.</p>
<p>
<a id="pgfId-1275047"></a></p>

<div class="webflare-div-image">
<img width="648" height="405" src="images/Chap5-36.gif" /></div>

<ol><li>
<a id="pgfId-1172671"></a>Click twice on the expression and then click the <em>Open calculator</em> button, as shown below.<br />
<a id="pgfId-1252621"></a><div class="webflare-div-image">
<img width="639" height="384" src="images/Chap5-37.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1212031"></a>Starting with the IC615 ISR12 release and later, the RF expressions are much simpler than they were in the past. </div>
<a id="pgfId-1172678"></a>The calculator starts with the expression in the buffer.<br />
<a id="pgfId-1275307"></a><div class="webflare-div-image">
<img width="664" height="640" src="images/Chap5-38.gif" /></div></li><li>
<a id="pgfId-1275309"></a>In the calculator, select the <em>mag</em> function to convert the complex voltage to a scalar voltage. The assumption here is that the load is resistive, and any voltage regardless of phase will create power.<br />
<a id="pgfId-1252848"></a>&#8216;<div class="webflare-div-image">
<img width="616" height="641" src="images/Chap5-39.gif" /></div></li><li>
<a id="pgfId-1275546"></a>In the calculator, select the <em>value</em> function to get the value at 1MHz and click <em>OK</em>.<br />
<a id="pgfId-1275551"></a><div class="webflare-div-image">
<img width="662" height="762" src="images/Chap5-40.gif" /></div></li><li>
<a id="pgfId-1275552"></a>Select the <em>Send buffer expression to ADE Outputs</em> button, as shown below.<br />
<a id="pgfId-1275709"></a><br /><div class="webflare-div-image">
<img width="634" height="760" src="images/Chap5-41.gif" /></div>
<a id="pgfId-1275710"></a>Alternatively, you can click <em>Tools</em> - <em>Send Buffer to ADE Outputs</em>.<br />
<a id="pgfId-1275817"></a>This adds the expression under the Maestro tab of ADE Explorer, as shown below.<br />
<a id="pgfId-1275829"></a><div class="webflare-div-image">
<img width="668" height="401" src="images/Chap5-42.gif" /></div></li><li>
<a id="pgfId-1275854"></a>Specify a name for the expression. Here, it shows HARM1.<br />
<a id="pgfId-1275875"></a><div class="webflare-div-image">
<img width="668" height="401" src="images/Chap5-43.gif" /></div>
<a id="pgfId-1173034"></a>In a similar manner, add expressions for all 5 harmonics of the output</li><li>
<a id="pgfId-1173226"></a>To verify that the expressions work, click the <em>plot Outputs</em> icon located at the right of the ADE explorer window.<br />
<a id="pgfId-1253363"></a><div class="webflare-div-image">
<img width="662" height="402" src="images/Chap5-44.gif" /></div></li></ol>









































<h4><em>
<a id="pgfId-1173271"></a>Now build a calculator expression to calculate THD.</em></h4>

<p>
<a id="pgfId-1173281"></a>THD in percent is defined as: 100* square root (total power in the harmonics divided by the power in the fundamental).</p>
<p>
<a id="pgfId-1248800"></a>First, build an expression to calculate the power in the harmonics.</p>
<ol><li>
<a id="pgfId-1173291"></a>Open the HARM2 expression in the Calculator window by clicking the <em>Open calculator</em> button.</li><li>
<a id="pgfId-1276102"></a>This adds the expression into the calculator. <br />
<a id="pgfId-1276153"></a><div class="webflare-div-image">
<img width="668" height="759" src="images/Chap5-45.gif" /></div></li><li>
<a id="pgfId-1276145"></a>In the calculator, select the <em>x**2</em> function. (Square the expression) This converts voltage to power.<br />
<a id="pgfId-1253456"></a><div class="webflare-div-image">
<img width="637" height="760" src="images/Chap5-46.gif" /></div></li><li>
<a id="pgfId-1190972"></a>Press the &lt;<em>Enter&gt;</em> key three times. You may need to click <em>View</em> - <em>Show Stack</em> to view the stack. This is the beginning of adding the power in the higher harmonics.</li></ol>











<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1248882"></a>The number of times you press the &lt;<em>Enter</em>&gt; key will depend on the number of harmonics that are specified in the qpss analysis. Here, there are five total harmonics, the fundamental and four higher harmonics. The total number of higher harmonics is four. To get four total expressions, you press the <em>&lt;Enter&gt;</em> key three times.</div>

<p>
<a id="pgfId-1253596"></a></p>
<div class="webflare-div-image">
<img width="608" height="661" src="images/Chap5-47.gif" /></div>

<ol><li>
<a id="pgfId-1174974"></a>Click <em>+</em> (the plus sign) three times. Now change the frequencies in the buffer so you have 2M + 3M +4M +5M. This adds the power in the higher harmonics.<br />
<a id="pgfId-1253807"></a><div class="webflare-div-image">
<img width="539" height="741" src="images/Chap5-48.gif" /></div></li><li>
<a id="pgfId-1210177"></a>Verify that the expression is legal by clicking <em>Evaluate the buffer</em> <em>and display the results in a table</em>. This is an insurance step that is always recommended when you build calculator expressions. The icon for the table output is shown in the red box below.<br />
<a id="pgfId-1253979"></a><div class="webflare-div-image">
<img width="177" height="42" src="images/Chap5-49.gif" /></div></li><li>
<a id="pgfId-1230460"></a>The value is shown below.<br />
<a id="pgfId-1254006"></a><div class="webflare-div-image">
<img width="577" height="265" src="images/Chap5-50.gif" /></div></li><li>
<a id="pgfId-1175433"></a>Add parentheses around the entire expression using the mouse and keyboard.<br />
<a id="pgfId-1254046"></a><div class="webflare-div-image">
<img width="597" height="659" src="images/Chap5-51.gif" /></div></li><li>
<a id="pgfId-1176450"></a>Press the &lt;<em>Enter</em>&gt; key on your keyboard. The expression is entered into the stack.<br />
<a id="pgfId-1254097"></a><div class="webflare-div-image">
<img width="576" height="794" src="images/Chap5-52.gif" /></div></li><li>
<a id="pgfId-1211644"></a>Open the HARM1 expression in the calculator.<br />
<a id="pgfId-1254203"></a><div class="webflare-div-image">
<img width="632" height="769" src="images/Chap5-53.gif" /></div></li><li>
<a id="pgfId-1216436"></a>Click the X**2 special function. This calculates the power in the first harmonic.<br />
<a id="pgfId-1254252"></a><div class="webflare-div-image">
<img width="656" height="766" src="images/Chap5-54.gif" /></div></li><li>
<a id="pgfId-1216437"></a>Select the / (divide by) key. This divides the power in the harmonics by the power in the fundamental.<br />
<a id="pgfId-1254320"></a><div class="webflare-div-image">
<img width="624" height="767" src="images/Chap5-55.gif" /></div></li><li>
<a id="pgfId-1176769"></a>Verify that the expression is legal by clicking the <em>Evaluate the buffer and display the results in a table</em> button in the calculator.<br />
<a id="pgfId-1254450"></a><div class="webflare-div-image">
<img width="202" height="37" src="images/Chap5-56.gif" /></div></li><li>
<a id="pgfId-1230900"></a>The result is shown below.<br />
<a id="pgfId-1254461"></a><div class="webflare-div-image">
<img width="576" height="273" src="images/Chap5-57.gif" /></div></li><li>
<a id="pgfId-1175481"></a>Select the sqrt (square root) special function.<br />
<a id="pgfId-1254501"></a><div class="webflare-div-image">
<img width="627" height="766" src="images/Chap5-58.gif" /></div></li><li>
<a id="pgfId-1176879"></a>Verify that the expression is legal by clicking the <em>Evaluate the buffer and display the results in a table</em> button in the calculator.<br />
<a id="pgfId-1254577"></a><div class="webflare-div-image">
<img width="174" height="36" src="images/Chap5-59.gif" /></div></li><li>
<a id="pgfId-1230961"></a>The value is shown below.<br />
<a id="pgfId-1254588"></a><div class="webflare-div-image">
<img width="598" height="267" src="images/Chap5-60.gif" /></div></li><li>
<a id="pgfId-1175488"></a>Click at the beginning of the expression, and type 100*.<br />
<a id="pgfId-1254624"></a><div class="webflare-div-image">
<img width="625" height="769" src="images/Chap5-61.gif" /></div></li><li>
<a id="pgfId-1176992"></a>Verify that the expression is legal by clicking the <em>Evaluate the buffer and display the results in a table</em> button in the calculator.<br />
<a id="pgfId-1254691"></a><div class="webflare-div-image">
<img width="208" height="35" src="images/Chap5-62.gif" /></div></li><li>
<a id="pgfId-1231051"></a>The value is shown below.<br />
<a id="pgfId-1254709"></a><div class="webflare-div-image">
<img width="518" height="279" src="images/Chap5-63.gif" /></div></li><li>
<a id="pgfId-1174028"></a>In the Calculator window, choose <em>Tools</em> - <em>Send Buffer to ADE Outputs</em>.<br />
<a id="pgfId-1277186"></a>The expression is added under the <em>Maestro</em> tab of the ADE Explorer window.</li><li>
<a id="pgfId-1277175"></a>Type <em>THD</em> in the <em>Name</em> field.<br />
<a id="pgfId-1174175"></a>.<div class="webflare-div-image">
<img width="643" height="405" src="images/Chap5-64.gif" /></div></li></ol>





















































































<h4><em>
<a id="pgfId-1174182"></a>Now sweep the input level, and run the simulation.</em></h4>

<ol><li>
<a id="pgfId-1174192"></a>In the ADE window, double-click the qpss line under the Analysis section in the Setup pane. The qpss <em>Choosing Analyses</em> Form is displayed.<br />
<a id="pgfId-1254865"></a><div class="webflare-div-image">
<img width="554" height="715" src="images/Chap5-65.gif" /></div></li><li>
<a id="pgfId-1174202"></a>Select the check box to the right of the Sweep drop-down list.</li><li>
<a id="pgfId-1174209"></a>Select the appropriate design variable that sets the input amplitude.</li><li>
<a id="pgfId-1174285"></a>Specify an appropriate range and step size for your application. In this example, 50mv to 1.1v is the sweep range, with linear spacing. Click OK, and run the analysis. When the simulation completes, the amplitude of the first five harmonics, and the THD plot, as shown below.<br />
<a id="pgfId-1254946"></a><div class="webflare-div-image">
<img width="636" height="399" src="images/Chap5-66.gif" /></div></li><li>
<a id="pgfId-1174305"></a>Markers are placed at the input amplitude of 1 volt peak. At that level, the output is 970mV peak, and the THD is 2.99%.</li></ol>













<h4><em>
<a id="pgfId-1174312"></a>Add an expression to measure the clock feedthrough</em></h4>

<ol><li>
<a id="pgfId-1174322"></a>Open the HARM4 expression in the calculator by click the Open calculator button.</li><li>
<a id="pgfId-1174332"></a>This adds the expression for the 5MHz term into the calculator. In the calculator, change 5M to 100M.<br />
<a id="pgfId-1254995"></a><div class="webflare-div-image">
<img width="641" height="766" src="images/Chap5-67.gif" /></div></li><li>
<a id="pgfId-1278387"></a>In the Calculator window, choose <em>Tools</em> - <em>Send Buffer to ADE Outputs</em>. The expression is added under the <em>Maestro</em> tab of the ADE Explorer window.</li><li>
<a id="pgfId-1174368"></a>Name the expression <em>Sample_Feedthrough</em>.<br />
<a id="pgfId-1278418"></a><div class="webflare-div-image">
<img width="668" height="403" src="images/Chap5-68.gif" /></div></li><li>
<a id="pgfId-1174391"></a>Deselect all the check boxes under in the <em>Plot</em> column for all the expressions except for <em>Sample_Feedthrough</em>.<br />
<a id="pgfId-1278488"></a><div class="webflare-div-image">
<img width="668" height="402" src="images/Chap5-69.gif" /></div></li><li>
<a id="pgfId-1278475"></a>Click the <em>Plot Outputs</em> icon in ADE Explorer.<br />
<a id="pgfId-1255206"></a>This plots the clock feedthrough.<br />
<a id="pgfId-1255163"></a>Remember that this is a peak measurement.<br />
<a id="pgfId-1255277"></a><br /><div class="webflare-div-image">
<img width="600" height="405" src="images/Chap5-70.gif" /></div></li></ol>






















<h4><em>
<a id="pgfId-1174679"></a>Now plot the time-domain waveforms</em></h4>

<ol><li>
<a id="pgfId-1255330"></a>In the waveform tool, click <em>File</em> - <em>Close All Windows</em>.</li><li>
<a id="pgfId-1255331"></a>In ADE Explorer, click <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1255346"></a><div class="webflare-div-image">
<img width="310" height="619" src="images/Chap5-71.gif" /></div></li><li>
<a id="pgfId-1278595"></a>In the <em>Direct Plot Form, </em>select <em>ifft</em> from the <em>Sweep</em> section</li><li>
<a id="pgfId-1278596"></a>Select <em>Complete ifft</em>.</li><li>
<a id="pgfId-1278597"></a>Select <em>100m</em>.</li><li>
<a id="pgfId-1174725"></a>Click <em>Replot</em>.</li><li>
<a id="pgfId-1174752"></a>Select <em>300m</em>.</li><li>
<a id="pgfId-1174753"></a>Click <em>Replot</em>.</li><li>
<a id="pgfId-1174772"></a>Select <em>500m</em>.</li><li>
<a id="pgfId-1174773"></a>Click<em> Replot.</em></li><li>
<a id="pgfId-1174774"></a>Select <em>700m</em>.</li><li>
<a id="pgfId-1174775"></a>Click <em>Replot</em>.</li><li>
<a id="pgfId-1174787"></a>Select <em>900m</em>.</li><li>
<a id="pgfId-1174788"></a>Click <em>Replot</em>.</li><li>
<a id="pgfId-1174789"></a>Select <em>1.1</em>.</li><li>
<a id="pgfId-1174790"></a>Click <em>Replot</em>.<br />
<a id="pgfId-1255534"></a><div class="webflare-div-image">
<img width="665" height="363" src="images/Chap5-72.gif" /></div>
<a id="pgfId-1174743"></a>Although the distortion is not visible until the input amplitude becomes 1.1 volts, there is distortion in the output waveform at the lower levels.</li></ol>

























<h2>
<a id="pgfId-1177480"></a>Quasi-Periodic AC Anal<a id="qpac"></a>ysis (QPAC)</h2>

<p>
<a id="pgfId-1177505"></a>Refer to the pac analysis section in Chapter 4 for details about the pac analysis.</p>
<p>
<a id="pgfId-1177535"></a>Qpac is just like pac, except it runs after a qpss analysis instead of after a pss analysis. Qpss captures the harmonics of the system, and qpac applies a single input frequency at a time, and calculates the output mixing products when the qpac input mixes with the harmonics of qpss. Conceptually, the only difference from pss-pac is that qpss has more signals and more harmonics in it to mix with, so there are more output mixing terms.</p>

<h3>
<a id="pgfId-1183117"></a>Example</h3>

<p>
<a id="pgfId-1183138"></a>Consider a diode mixer below.</p>

<p>
<a id="pgfId-1255612"></a></p>
<div class="webflare-div-image">
<img width="577" height="494" src="images/Chap5-73.gif" /></div>

<p>
<a id="pgfId-1183139"></a>The input port has the frequency and amplitude set using variable names. This is done in order to allow the frequency and amplitude changes in ADE Explorer without the need for changing the schematic.</p>

<p>
<a id="pgfId-1255662"></a></p>
<div class="webflare-div-image">
<img width="451" height="759" src="images/Chap5-74.gif" /></div>

<p>
<a id="pgfId-1183330"></a><em>PAC Magnitude</em> is set to <em>1 V</em> in the port. <em>PAC Magnitude</em> is used by pac and qpac to define the amplitude of the input signal for both analyses. This allows convenient measurement of conversion gain. Since the input is set to 0 dB, the conversion gain can be read directly just by probing the desired net.</p>
<p>
<a id="pgfId-1183145"></a>In a similar manner, the LO signal uses variable names. These variables are set in the ADE Explorer window.</p>

<p>
<a id="pgfId-1255782"></a></p>
<div class="webflare-div-image">
<img width="660" height="439" src="images/Chap5-75.gif" /></div>

<p>
<a id="pgfId-1183375"></a>Next, the qpss analysis needs to be set up. For more information, see the qpss section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1255917"></a></p>
<div class="webflare-div-image">
<img width="358" height="734" src="images/Chap5-76.gif" /></div>

<p>
<a id="pgfId-1183379"></a>Next, the qpac analysis needs to be set up.</p>

<p>
<a id="pgfId-1255981"></a></p>
<div class="webflare-div-image">
<img width="449" height="688" src="images/Chap5-77.gif" /></div>

<ol><li>
<a id="pgfId-1183158"></a>The input is from 850MHz to 950MHz, with a linear sweep.</li><li>
<a id="pgfId-1191873"></a>Because 10 harmonics were set in the qpss analysis for the LO tone, 10 is set for <em>Maximum clock order</em>. These numbers should agree.</li><li>
<a id="pgfId-1183455"></a>Now run the analysis.</li><li>
<a id="pgfId-1191963"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1256049"></a><div class="webflare-div-image">
<img width="294" height="449" src="images/Chap5-78.gif" /></div></li><li>
<a id="pgfId-1191986"></a>Select <em>qpac</em> from the Analysis section.</li><li>
<a id="pgfId-1191993"></a>In many cases, <em>dB20</em> is useful.</li><li>
<a id="pgfId-1183166"></a>The output net in the schematic is selected, The conversion gain terms are plotted, as shown below.<br />
<a id="pgfId-1256095"></a><div class="webflare-div-image">
<img width="591" height="361" src="images/Chap5-79.gif" /></div></li></ol>














<p>
<a id="pgfId-1183167"></a>Because there are a large number of harmonics in the circuit, there are a large number of mixing products that are produced. In the view below, zooming is applied to show just the main mixing products. Markers have been placed for the center frequency of the sum and difference frequency mixing terms.</p>

<p>
<a id="pgfId-1256142"></a></p>
<div class="webflare-div-image">
<img width="619" height="400" src="images/Chap5-80.gif" /></div>

<p>
<a id="pgfId-1183547"></a>As is common for diode mixers, the insertion loss is about 6 dB.</p>

<h3>
<a id="pgfId-1183127"></a>Qpac Concepts</h3>

<p>
<a id="pgfId-1177526"></a>Generally, when qpac is needed, harmonic balance is appropriate for the simulation engine. In this case, the hb and hbac analyses are recommended because the hb and hb analysis forms always have the latest features.</p>
<p>
<a id="pgfId-1192076"></a>Qpac applies a small-signal input to the system that is simulated with the qpss analysis. Qpss solves for the harmonics of the system with two or more inputs to the circuit. Qpac calculates the small-signal outputs that are created by mixing with all the harmonics that are in the qpss solution.</p>
<p>
<a id="pgfId-1177512"></a>One application of qpss-qpac is measuring conversion gain of an LNA-Mixer circuit when a large amplitude blocking signal is present. In this case, the LO and the blocker are applied in qpss, and the small-signal conversion gain is measured using qpac. Note that for this application, harmonic balance is likely to run faster than shooting, and as a strong recommendation, use the hb and hbac analysis for this application.</p>
<p>
<a id="pgfId-1177556"></a>Unlike hbac, qpac has only one mode, which measures the small-signal mixing products. Modulated, sampled, rapid IP3 and IP2, and the distortion summaries from hbac are not available in qpac.</p>

<h4><em>
<a id="pgfId-1177572"></a>Down Conversion: Input Near the First harmonic of the LO</em></h4>

<p>
<a id="pgfId-1177573"></a>Qpac is for measuring the conversion gain that is the average conversion gain with all the signals applied to the circuit (usually the LO or the sample clock and a blocking signal) applied to the circuit. The mixing products that are produced are called sidebands. The sideband number has a value for each signal that is applied to the circuit, and is the harmonic number that is being mixed with to provide the output. A positive number means that the output mixing product is higher in frequency than the input frequency specified in the <em>Choosing Analyses</em> form. A negative number means that the output is lower in frequency than the input frequency. If there are two inputs to the circuit in the qpss analysis, there will be two numbers for each qpac sideband. In the example below, there is an LO at 1.8GHz and a blocker at 2GHz. The RF small-signal input is at 1.85GHz. A waveform plot is shown below. The red spectrum is the spectrum calculated by the qpss analysis, and the small dots are the qpac result. The amplitude of the qpac output is larger than the qpss output because the qpac outputs assume a 1 volt input, and the qpss has much smaller input levels. It will explain further.</p>

<p>
<a id="pgfId-1177577"></a></p>
<div class="webflare-div-image">
<img width="619" height="398" src="images/Chap5-81.gif" /></div>

<p>
<a id="pgfId-1177578"></a>All the sideband numbers are plotted on the left of the waveform tool. When 0 0 is selected, the output frequency is the input frequency that does not mix with either input frequency. Thus, the 0 0 sideband is at 1.85GHz (the input frequency) as shown below.</p>

<p>
<a id="pgfId-1256260"></a></p>
<div class="webflare-div-image">
<img width="619" height="404" src="images/Chap5-82.gif" /></div>

<p>
<a id="pgfId-1256237"></a>The primary output mixing product is the signal that mixes down with the LO, and does not mix with the blocker. It mixes down with the first harmonic of the LO, and does not mix with the RF blocker, thus the sideband number is -1 0.</p>

<p>
<a id="pgfId-1256309"></a></p>
<div class="webflare-div-image">
<img width="619" height="400" src="images/Chap5-83.gif" /></div>

<p>
<a id="pgfId-1177738"></a>1.85GHz (the input frequency) minus 1*LO frequency (1.8GHz) is 50MHz.</p>
<p>
<a id="pgfId-1177745"></a>1.85GHz can also mix down with the blocker frequency. In this case, the signal mixes down with the first harmonic of the blocker (2GHz) and not with the LO.</p>

<p>
<a id="pgfId-1256366"></a></p>
<div class="webflare-div-image">
<img width="619" height="401" src="images/Chap5-84.gif" /></div>

<p>
<a id="pgfId-1177768"></a>The sideband number here is 0 -1. 1.85GHz -1*2GHz = -150MHz. By default, this is mirrored up to the positive frequency domain in the qpac analysis.</p>
<p>
<a id="pgfId-1177897"></a>Next, the frequency can mix up with the LO. This is the 1 0 sideband.</p>

<p>
<a id="pgfId-1256418"></a></p>
<div class="webflare-div-image">
<img width="619" height="401" src="images/Chap5-85.gif" /></div>

<p>
<a id="pgfId-1177937"></a>To calculate the frequency, the input is 1.85GHz + 1* 1.8GHz = 3.65GHz.</p>

<h4>
<a id="pgfId-1177944"></a>The Easy Way to Calculate Sideband Numbers and Frequencies</h4>

<p>
<a id="pgfId-1177954"></a>The easy way to calculate sideband numbers and frequencies is to use the <em>Direct Plot Form</em>. The <em>Direct Plot Form</em> displays the sideband numbers and the frequency ranges when you select <em>sideband</em>, as shown below.</p>

<p>
<a id="pgfId-1256486"></a></p>
<div class="webflare-div-image">
<img width="289" height="564" src="images/Chap5-86.gif" /></div>

<p>
<a id="pgfId-1177975"></a>In this example, the LO is at 1.8GHz, the RF Blocker is at 2GHz, and the input sweep range is 1850MHz to 1851MHz.</p>

<h4>
<a id="pgfId-1177989"></a>Avoid Wide Sweep Ranges</h4>

<p>
<a id="pgfId-1177999"></a>Wide sweep ranges cause very confusing results. This should be avoided. An example is shown below.</p>

<p>
<a id="pgfId-1256526"></a></p>
<div class="webflare-div-image">
<img width="619" height="400" src="images/Chap5-87.gif" /></div>

<p>
<a id="pgfId-1178023"></a>The marker is placed at 1.7GHz. The value from qpac at the marker value is shown in the legend area on the left side of the waveform display. The different traces result from mixing with different harmonics in the qpss analysis.</p>

<h4>
<a id="pgfId-1177586"></a>Relative Frequency Sweep</h4>

<p>
<a id="pgfId-1177587"></a>The qpac analysis is like AC, where the input frequency is swept. The input frequency range is specified in the qpac <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1177588"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonic numbers in the qpss analysis. </p>
<p>
<a id="pgfId-1178384"></a>For example, assume that the qpss has a 1GHz large-signal input, and a 900MHz <em>Moderate</em> input. You want a log sweep above the first harmonic of the 1GHz signal in the qpss analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 0 in the <em>Relative Harmonic</em> field. The first number is the frequency shift in multiples of the LO frequency, and the second number is the frequency shift in multiples of the RF input frequency. Next, type in 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade.</p>
<p>
<a id="pgfId-1177589"></a>The sweep will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1177593"></a></p>
<div class="webflare-div-image">
<img width="480" height="239" src="images/Chap5-88.gif" /></div>

<p>
<a id="pgfId-1177594"></a>To use a log sweep below the first harmonic of the 1GHz input, use the same frequency range, and type in -1 0 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1256615"></a></p>
<div class="webflare-div-image">
<img width="503" height="284" src="images/Chap5-89.gif" /></div>
<h4>
<a id="pgfId-1177599"></a>Maximum Clock Order</h4>

<p>
<a id="pgfId-1177600"></a>In this case, clock is the terminology for the large signal in the qpss analysis. Sidebands (the output mixing products calculated by qpac) are calculated through the highest harmonic of the large signal in the qpss analysis. This is usually the LO signal.</p>
<p>
<a id="pgfId-1178632"></a>Conceptually, an infinite number of mixing products are produced when a single input is applied to a nonlinear system. From the practical point of view, usually only a small number of mixing products need to be measured.</p>
<p>
<a id="pgfId-1178612"></a>Consider an example. Assume that a 1GHz large signal and a 900MHz moderate signal is applied in qpss. 10 harmonics are set for the large signal at 1GHz, and three harmonics are specified for the moderate signal. Assume there is no need to measure the mixing products above the third harmonic of the LO because there is no spec at frequencies above that. In that case, you could set <em>Maximum clock order</em> to three, and only the mixing products that are produced by mixing with the first three harmonics of the LO are calculated in the qpac analysis.</p>
<p>
<a id="pgfId-1178605"></a>Sideband is the name of the qpac output mixing product. The sideband number is the qpss harmonic numbers that is being mixed with. If the sideband number is negative, the output frequency is mixed down in frequency from that input. If the sideband is positive, the output is mixed up in frequency. A sideband contains the same number of numbers as there are tones in the circuit. If there are 2 tones in the circuit, each sideband has two numbers, like -1 0. If there are three inputs, each sideband has three numbers, like -1 0 0.</p>

<h4>
<a id="pgfId-1177604"></a>Setting Harmonics in QPSS to get Accurate QPAC Results</h4>

<p>
<a id="pgfId-1177606"></a>The qpss analysis, when shooting is selected, has a minimum of 200 timepoints in each slice, so the large signal in qpss inherently has frequency domain content through the 100th harmonic of the large signal input. Only the harmonics that are specified in the moderate tone are included in the solution. The impact of this is that the qpac mixing products that are produced from mixing with the large signal are almost always correct, but the mixing with the moderate signal might or might not be accurate, depending on the number of harmonics that are specified for the moderate signal, and the number of harmonics actually produced by the system. Like harmonic balance, you need to run the qpss and qpac with a number of harmonics specified for the moderate tone(s), and make the measurement in qpac. Then increase the number of moderate harmonics by about 50%, and run again. Then note the measurement. If the result changed significantly, then you need more moderate harmonics. If the result did not change, you might be able to reduce the number of moderate harmonics. Use the smallest number of moderate harmonics that produce a stable qpac result.</p>

<h3>
<a id="pgfId-1178650"></a>ADE Implementation</h3>

<p>
<a id="pgfId-1178700"></a>In this section, just the qpac analysis <em>Choosing Analyses</em> form and the options for qpac are shown. An examples section follows with all the steps needed for a simulation.</p>
<p>
<a id="pgfId-1178701"></a>To open the <em>Choosing Analyses</em> form, select <em>Analysis</em> - <em>Choose</em> in ADE Explorer, or click he <em>Choosing Analyses</em> icon (<img width="30" height="27" src="images/Chap5-90.gif" /><span>)on the right of the ADE Explorer window.</span></p>

<p>
<a id="pgfId-1178716"></a>The qpac <em>Choosing Analyses</em> form appears.</p>

<p>
<a id="pgfId-1257131"></a></p>
<div class="webflare-div-image">
<img width="380" height="529" src="images/Chap5-91.gif" /></div>

<p>
<a id="pgfId-1178733"></a>The frequency range is the input frequency range. It is usually better to select Linear or Log spacing, and define your own sweep because auto is likely to take more points (and time) than you need. <em>Maximum clock order</em> specifies the highest qpss large signal harmonic to calculate mixing products for.</p>
<p>
<a id="pgfId-1178740"></a>If you need a log sweep around a harmonic, set the Sweeptype to <em>Relative</em>.</p>

<p>
<a id="pgfId-1257187"></a></p>
<div class="webflare-div-image">
<img width="363" height="518" src="images/Chap5-92.gif" /></div>

<p>
<a id="pgfId-1178761"></a>The number of numbers in the relative harmonic must be equal to the number of qpss tones. If there are 2 qpss tones, there should be two numbers in the relative harmonic. The first number is the harmonic number and direction that the qpac tone mixes with for the large tone in qpss. The second number specifies the harmonic number of the moderate tone that the input frequency mixes with. Generally, the first tone is the LO tone, and the second tone is the RF blocker. Generally, we design to mix with he LO, and not mix with the blocker, thus the first number is usually 1 or -1 because generally we mix with the first harmonic of the LO, and generally the second number is zero because we don&#8217;t deliberately mix with the RF blocker.</p>

<h4>
<a id="pgfId-1178768"></a>QPAC Opt<a id="qpac_options"></a>ions</h4>

<p>
<a id="pgfId-1178778"></a>None of the qpac options are commonly used.</p>

<h4><em>
<a id="pgfId-1192395"></a>tolerance</em></h4>

<p>
<a id="pgfId-1178901"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1178893"></a>Qpac uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough, and the tolerance option specifies that accuracy for the qpac analysis. For shooting, the default tolerance is 1e-9. When harmonic balance is the qpss engine, the default is 1e-6.</p>

<h4><em>
<a id="pgfId-1178865"></a>gear_order</em></h4>

<p>
<a id="pgfId-1178986"></a>Do not change this option.</p>

<h4><em>
<a id="pgfId-1178858"></a>solver</em></h4>

<p>
<a id="pgfId-1178936"></a>The default solver is the turbo solver.</p>
<p>
<a id="pgfId-1178937"></a>When hb is used as the engine in qpss, leave this option at the default.</p>
<p>
<a id="pgfId-1178938"></a>When shooting is used, sometimes when the qpac input frequency is very close to the frequency of one of the harmonics in the qpss, warning messages will appear in the qpac output warning that the accuracy might not be good enough. If you see these messages, select the std solver, which has better ability to handle frequencies that are very close to a harmonic in the qpss solution, but which takes longer to run than the turbo solver.</p>

<h4><em>
<a id="pgfId-1178844"></a>resgmrescycle</em></h4>

<p>
<a id="pgfId-1179033"></a>Leave this option at the default. For the resgmres linear solver, there are several different options.</p>

<h4><em>
<a id="pgfId-1178837"></a>hbprecond_solver</em></h4>
<h4>
<a id="pgfId-1178964"></a>This option is only available only when harmonic balance is selected in qpss.</h4>

<p>
<a id="pgfId-1178965"></a>The basic solver is the only solver available in standard Spectre. <em>autoset</em> is the default solver when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the <em>basic</em> solver, and prints a message in the Spectre output window.</p>

<h4><em>
<a id="pgfId-1178830"></a>annotate</em></h4>

<p>
<a id="pgfId-1179100"></a>Selections to the left produce less qpac output in the Spectre output window. No detail is provided when you select no, while more details are provided as you move towards right with steps option providing maximum detail.</p>

<h4><em>
<a id="pgfId-1178823"></a>freqaxis</em></h4>

<p>
<a id="pgfId-1178880"></a><em>freqaxis</em> specifies whether you want to see the negative frequency axis or not.</p>
<p>
<a id="pgfId-1178881"></a>The analysis calculates the output frequencies and amplitudes, so <em>out</em> and <em>absout</em> are reasonable choices. <em>out</em> displays the negative frequency axis. <em>absout</em> (absolute value of the output) displays positive output frequencies. This is the default.</p>
<p>
<a id="pgfId-1178872"></a>If you select <em>in</em>, all the outputs at the different frequencies are plotted on the same input frequency range scale. This is not recommended.</p>

<h4><em>
<a id="pgfId-1178816"></a>save</em></h4>

<p>
<a id="pgfId-1179115"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved. In ADE Explorer, this is accomplished using the <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Schematic</em> and then selecting the nodes and terminals specifically in the schematic. At the netlist level, this is accomplished by using a save statement with a list of names to be saved. </p>

<h4><em>
<a id="pgfId-1178809"></a>nestlvl</em></h4>

<p>
<a id="pgfId-1179128"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> can be any integer. </p>

<h4><em>
<a id="pgfId-1178802"></a>additionalParams</em></h4>

<p>
<a id="pgfId-1179058"></a><em>additionalParams</em> is typically used for new features that are being beta tested. It is a field where <code>keyword=value</code> pairs are entered.</p>
<p>
<a id="pgfId-1179059"></a>For more information about the other options, type <code>spectre -h qpac</code> at the command prompt in a Unix shell window</p>

<h3>
<a id="pgfId-1179147"></a>Example</h3>

<p>
<a id="pgfId-1179157"></a>Consider a mixer circuit below.</p>

<p>
<a id="pgfId-1257398"></a></p>
<div class="webflare-div-image">
<img width="641" height="537" src="images/Chap5-93.gif" /></div>

<p>
<a id="pgfId-1179178"></a>The RF source properties list is shown below.</p>

<p>
<a id="pgfId-1257446"></a></p>
<div class="webflare-div-image">
<img width="455" height="793" src="images/Chap5-94.gif" /></div>

<p>
<a id="pgfId-1179250"></a>PAC magnitude controls the amplitude of the qpac input signal. Setting the amplitude to 1 volt allows the conversion gain to be read directly from the output waveform.</p>
<p>
<a id="pgfId-1179258"></a>The large-signal properties are set to variable names so the frequencies and amplitude can be controlled using variables in ADE Explorer.</p>

<p>
<a id="pgfId-1257490"></a></p>
<div class="webflare-div-image">
<img width="660" height="481" src="images/Chap5-95.gif" /></div>

<p>
<a id="pgfId-1179275"></a>In this example, the LO is at 1.9GHz, and the RF input is at 2GHz. The second RF input is disabled for the qpss analysis by setting its frequency to zero.</p>
<ol><li>
<a id="pgfId-1179284"></a>Now select <em>Analysis</em> - <em>Choose</em>, or click the <em>Choosing Analyses</em> icon (<img width="38" height="30" src="images/Chap5-96.gif" />
)in the ADE Explorer window.</li><li>
<a id="pgfId-1179301"></a>Select qpss. The qpss analysis must be run before a qpac can run. For more information on setting the qpss form, see the qpss section at the beginning of this chapter.<br />
<a id="pgfId-1257557"></a><div class="webflare-div-image">
<img width="386" height="712" src="images/Chap5-97.gif" /></div></li><li>
<a id="pgfId-1179324"></a>If there is a non-sinusoidal source, it must be set to large. This is a requirement even if the non-sinusoidal signal produces only a small amount of distortion. Otherwise, the large signal should be the signal that causes the most distortion in the system. </li><li>
<a id="pgfId-1192596"></a>Set harmonics large enough to capture the actual harmonics that are produced by your circuit.</li><li>
<a id="pgfId-1179341"></a>Now select <em>qpac</em>.<br />
<a id="pgfId-1257632"></a><div class="webflare-div-image">
<img width="411" height="531" src="images/Chap5-98.gif" /></div></li><li>
<a id="pgfId-1179580"></a>This setup causes a log sweep just above the first harmonic of the LO signal. The qpss analysis has 2 tones in it, so the <em>Relative Harmonic</em> field has two numbers in it. The first number is the harmonic number of the large signal that is being mixed with, and the second number is the harmonic number of the moderate tone that is being mixed with. 1 0 causes the input frequency to be shifted up by mixing with the first harmonic of the LO signal. This puts the input frequency just above the LO frequency.</li><li>
<a id="pgfId-1179587"></a>It is usually better to select a Linear or Log sweep and specify your own frequency points because automatic will likely take more points (and runtime) than is needed.</li><li>
<a id="pgfId-1179594"></a><em>Maximum clock order</em> specifies the highest harmonic of the LO tone to calculate outputs for. If you do not need to measure high order mixing products, this can be set fairly small. If you use the harmonic balance engine in qpss, it is suggested that you set <em>Maximum sideband</em> to the same value used for the number of LO harmonics in the qpss, or leave the field blank, which does the same thing.</li><li>
<a id="pgfId-1179601"></a>Run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1257682"></a><div class="webflare-div-image">
<img width="648" height="573" src="images/Chap5-99.gif" /></div></li><li>
<a id="pgfId-1257725"></a>Select <em>qpss</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1179632"></a>Select the output net in the circuit.</li><li>
<a id="pgfId-1257883"></a>Click OK.<br />
<a id="pgfId-1257900"></a>The spectral plot is shown below.<br />
<a id="pgfId-1179651"></a>.<div class="webflare-div-image">
<img width="639" height="404" src="images/Chap5-100.gif" /></div></li><li>
<a id="pgfId-1192725"></a>In this example, the display has been zoomed in for more detail, as shown below.<br />
<a id="pgfId-1257965"></a><div class="webflare-div-image">
<img width="664" height="403" src="images/Chap5-101.gif" /></div></li><li>
<a id="pgfId-1179677"></a>In the <em>Direct Plot Form</em>, select <em>qpac</em> from the <em>Analysis</em> section.<br />
<a id="pgfId-1258018"></a><div class="webflare-div-image">
<img width="392" height="577" src="images/Chap5-102.gif" /></div></li><li>
<a id="pgfId-1179701"></a>Select <em>sideband</em> from the <em>Sweep</em> section. This allows the plotting of the individual output mixing products. Select the term you want from the list, and select the desired net in your circuit. The output of all the sidebands in range of the X axis is shown below.<br />
<a id="pgfId-1258107"></a><div class="webflare-div-image">
<img width="638" height="401" src="images/Chap5-103.gif" /></div></li><li>
<a id="pgfId-1192829"></a>The qpac output has a larger amplitude than the qpss output because the qpac input amplitude is set to 1 volt, and the qpss amplitudes are much smaller.</li><li>
<a id="pgfId-1179740"></a>To measure conversion gain, go to the desired output frequency, and position a marker as shown below, or use the tracking cursor in the waveform tool.<br />
<a id="pgfId-1258157"></a><div class="webflare-div-image">
<img width="635" height="405" src="images/Chap5-104.gif" /></div></li><li>
<a id="pgfId-1179770"></a>The conversion gain is about 13.5dB.</li><li>
<a id="pgfId-1218920"></a>Now sweep the input power of the RF blocker in the qpss analysis. Select the check box next to <em>Sweep</em>, and specify a sweep range that is appropriate for your system.<br />
<a id="pgfId-1258210"></a><div class="webflare-div-image">
<img width="433" height="782" src="images/Chap5-105.gif" /></div></li><li>
<a id="pgfId-1219123"></a>Set the qpac analysis to a single frequency, and set the input frequency in the passband.<br />
<a id="pgfId-1258360"></a><div class="webflare-div-image">
<img width="396" height="541" src="images/Chap5-106.gif" /></div></li><li>
<a id="pgfId-1219177"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1258420"></a><div class="webflare-div-image">
<img width="346" height="580" src="images/Chap5-107.gif" /></div></li><li>
<a id="pgfId-1219184"></a>Select <em>variable</em> from the <em>Sweep</em> section, and select the output frequency. Usually, dB20 is appropriate. Now select the output net in the schematic.</li><li>
<a id="pgfId-1219191"></a>The Waveform displays. As expected, the conversion gain goes down when the blocker amplitude gets large.<br />
<a id="pgfId-1258467"></a><div class="webflare-div-image">
<img width="634" height="395" src="images/Chap5-108.gif" /></div></li></ol>








































































<h2>
<a id="pgfId-1180831"></a>Quasi Periodic N<a id="qpnoise"></a>oise Analysis</h2>
<h3>
<a id="pgfId-1180838"></a>Overview</h3>

<p>
<a id="pgfId-1180868"></a>The concepts of qpnoise analysis are exactly the same as pnoise analysis, except that instead of running a pss analysis to capture the nonlinearity of the circuit, qpss captures the nonlinearity of the circuit. In qpss, there are multiple inputs which cause many harmonics to be produced by the circuit. All of these frequencies in the circuit can mix with noise frequencies to be converted to the output frequency of the qpnoise analysis. Qpnoise calculates all the frequency translations from all the harmonics in the qpss analysis, and sums the noise power at the output of the circuit.</p>
<p>
<a id="pgfId-1180922"></a>The normal application of qpnoise is to measure the noise figure degradation of lna-mixer chains with a large amplitude RF blocking signal applied to the circuit.</p>
<p>
<a id="pgfId-1192871"></a>Note that for this application, harmonic balance is likely to run faster than shooting. If you need harmonic balance, the hb and hbnoise analyses are strongly recommended because these analyses always reflect the latest features that are available in the harmonic balance simulation.</p>

<h3>
<a id="pgfId-1182421"></a>Example</h3>

<p>
<a id="pgfId-1182431"></a>Consider a diode mixer below.</p>

<p>
<a id="pgfId-1258509"></a></p>
<div class="webflare-div-image">
<img width="640" height="552" src="images/Chap5-109.gif" /></div>

<p>
<a id="pgfId-1182452"></a>The input port has the frequency and amplitude set using variable names. This is done in order to allow frequency and amplitude changes in ADE Explorer without the need for changing the schematic.</p>

<p>
<a id="pgfId-1258555"></a></p>
<div class="webflare-div-image">
<img width="399" height="734" src="images/Chap5-110.gif" /></div>

<p>
<a id="pgfId-1182536"></a>In a similar manner, the LO port uses variable names. These variables are set in the ADE Explorer window.</p>

<p>
<a id="pgfId-1258599"></a></p>
<div class="webflare-div-image">
<img width="665" height="449" src="images/Chap5-111.gif" /></div>

<ol><li>
<a id="pgfId-1182578"></a>Next, the qpss analysis needs to be set up. For more information, see the qpss section at the beginning of this chapter. In this example, a 1GHz LO signal and a 900MHz blocker are applied.<br />
<a id="pgfId-1258637"></a><div class="webflare-div-image">
<img width="397" height="745" src="images/Chap5-112.gif" /></div></li><li>
<a id="pgfId-1182686"></a>Next, the qpnoise analysis needs to be set up.<br />
<a id="pgfId-1258701"></a><div class="webflare-div-image">
<img width="403" height="780" src="images/Chap5-113.gif" /></div></li><li>
<a id="pgfId-1182797"></a>The output is from 50MHz to 150MHz with a linear sweep. Because 10 harmonics were set in the qpss analysis for the LO tone, 10 is set for <em>Maximum clock order</em>. These numbers should agree. If harmonic balance is the engine in qpss, this field can be left blank, which will cause all the harmonics in the qpss analysis to be considered in qpnoise.</li><li>
<a id="pgfId-1193292"></a>The output port is set. This subtracts the noise from the output port from the noise figure calculation. The input port is also set. This is required if you want a noise figure calculation.</li><li>
<a id="pgfId-1193301"></a>The reference sideband defines the passband frequency for the noise figure calculations. The passband for this case is just under the LO input at 1GHz.</li><li>
<a id="pgfId-1182888"></a>Now run the analysis. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1258882"></a><div class="webflare-div-image">
<img width="329" height="456" src="images/Chap5-114.gif" /></div></li><li>
<a id="pgfId-1258898"></a>The single-sideband noise figure is selected. Click <em>Plot</em>.<br />
<a id="pgfId-1258918"></a><div class="webflare-div-image">
<img width="643" height="409" src="images/Chap5-115.gif" /></div></li></ol>






















<p>
<a id="pgfId-1258899"></a>As expected, the noise figure is very near 6dB, which is the conversion loss for the mixer.</p>

<h3>
<a id="pgfId-1180848"></a>Qpnoise Concepts</h3>

<p>
<a id="pgfId-1180882"></a>Unlike pnoise and hbnoise, qpnoise has only one mode. Qpnoise can only sum the noise power at the output, and refer that noise back to the input. Modulated and sampled functions are not available. If you need those functions, use either pss-pnoise or hb-hbnoise.</p>
<p>
<a id="pgfId-1180889"></a>Because there are many harmonics created in the qpss analysis, many transfer functions need to be calculated from the different noise frequencies to the output.</p>
<p>
<a id="pgfId-1180896"></a>Consider an LNA-Mixer with a 2.4GHz LO and an RF signal at 2.45GHz. The spectrum at the output of the circuit is shown below.</p>

<p>
<a id="pgfId-1259003"></a></p>
<div class="webflare-div-image">
<img width="665" height="440" src="images/Chap5-116.gif" /></div>

<p>
<a id="pgfId-1180914"></a>If the noise output frequency was 1MHz, then noise at 1MHz on either side of each harmonic in the qpss analysis mixes down to 1MHz. The frequency response of each noise source is determined by the qpss solution. This solution also supplies the nonlinearity to qpnoise so qpnoise can calculate the transfer function from each noise source to the output. The noise power at each noise frequency times the conversion gain gives the noise power at the output. All the different noise outputs caused by each noise frequency mixing down is summed, and then this same process is repeated for each noise source in the circuit.</p>
<p>
<a id="pgfId-1249895"></a>A zoomed in view near the LO frequency is shown below.</p>

<p>
<a id="pgfId-1249913"></a></p>
<div class="webflare-div-image">
<img width="619" height="406" src="images/Chap5-117.gif" /></div>

<p>
<a id="pgfId-1220928"></a>The noise 1MHz on either side of these harmonics mixes with each of these harmonics to the output at 1MHz. These frequencies are shown with the blue arrows above. Note that this shows the spectral content at the output of the circuit only. The amplitudes of these signals are much larger in other parts of the circuit. Noise that is 1MHz above and below all the harmonics mix down to the output at 1MHz. Because the noise frequencies are slightly different for all the mixing products, the actual nose power and the conversion gain is slightly different for each mixing product.</p>

<h3>
<a id="pgfId-1180963"></a>Measuring Noise Figure</h3>

<p>
<a id="pgfId-1180973"></a>The formulas for measuring noise figure are the same as those presented in pnoise. </p>
<p>
<a id="pgfId-1182070"></a>For:</p>
<p>
<a id="pgfId-1182046"></a><code>No</code> = total output noise<br /><code>Ns</code> = noise at the output due to the input probe at the passband frequency (the source)<br /><code>Nsi</code> = noise at the output due to the image harmonic at the source<br /><code>Nso</code> = noise at the output due to harmonics other than input at the source<br /><code>Nl</code> = noise at the output due to the output probe (the load)<br /><code>IRN</code> = input referred noise<br /><code>G</code> = gain of the circuit<br /><code>F</code> = noise factor<br /><code>NF</code> = noise figure<br /><code>Fdsb</code> = double sideband noise factor<br /><code>NFdsb</code> = double sideband noise figure<br /><code>Fieee</code> = IEEE single sideband noise factor<br /><code>NFieee</code> = IEEE single sideband noise figure</p>
<p>
<a id="pgfId-1182047"></a>then,</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1182048"></a>IRN = sqrt(No^2/G^2)<br />F = (No^2 - Nl^2)/Ns^2<br />NF = 10*log10(F)<br />Fdsb = (No^2 - Nl^2)/(Ns^2+Nsi^2)<br />NFdsb = 10*log10(Fdsb)<br />Fieee = (No^2 - Nl^2 - Nso^2)/Ns^2<br />NFieee = 10*log10(Fieee)</pre>

<p>
<a id="pgfId-1182030"></a>Note that in order to measure noise figure, the passband frequency needs to be identified. Qpnoise calculates many transfer functions from the input to the output. The passband frequency is set in the Reference sideband parameter. The reference sideband is the sideband number that defines the passband frequency. If there are two inputs in qpss, there will be two numbers in the reference sideband. If there are three inputs, there will be three numbers. The easiest way to define the reference sideband is to use the <em>Select from List</em> capability, and then select the design input frequency from the list.</p>

<h3>
<a id="pgfId-1181154"></a>Frequency Sweep</h3>

<p>
<a id="pgfId-1181072"></a>In qpnoise, the fundamental quantity that is calculated is the noise power at the output of the circuit. The Frequency Sweep Range is always the output frequency range for qpnoise. The output frequency range is specified in the qpnoise <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1181073"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonic numbers in the qpss analysis. </p>
<p>
<a id="pgfId-1181074"></a>For example, assume that the qpss has a 1GHz LO input, and a 900MHz RF input. You want a log sweep above the first harmonic of the 1GHz signal in the qpss analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 0 in the <em>Relative Harmonic</em> field. The first number is the frequency shift in multiples of the LO frequency, and the second number is the frequency shift in multiples of the RF input frequency. Next, type in 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade.</p>
<p>
<a id="pgfId-1181075"></a>The noise analysis output frequency will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1181079"></a></p>
<div class="webflare-div-image">
<img width="626" height="313" src="images/Chap5-118.gif" /></div>

<p>
<a id="pgfId-1181080"></a>To use a log sweep below the first harmonic of the 1GHz input, use the same frequency range, and type in -1 0 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1259086"></a></p>
<div class="webflare-div-image">
<img width="626" height="340" src="images/Chap5-119.gif" /></div>

<p>
<a id="pgfId-1184176"></a>Most of the time, the LO signal is the large signal in qpss. This is the first number in the shift. Generally, we do not design to deliberately mix with the RF blocking signal, so generally, the second number is zero. The first number is usually 1 or -1, because generally the RF signal mixes with the first harmonic of the LO. If the first number is -1, this is the signal just below the first harmonic of the mixer. If the first number is positive, it means the design input frequency is above the LO frequency.</p>

<h4>
<a id="pgfId-1181085"></a>Maximum Clock Order</h4>

<p>
<a id="pgfId-1197679"></a>In qpnoise terminology, the large signal from qpss is called the clock. Thus, <em>Maximum clock order</em> specifies the highest large signal harmonic number (The large signal is usually the LO signal) to calculate the conversion gain terms for. Usually, the conversion gain is needed for all the harmonics that are present in the qpss analysis, so usually <em>Maximum clock order</em> should be set to the number of LO harmonics in the QPSS analysis. Each conversion gain term that is calculated is called a sideband in a qpnoise analysis.</p>

<h4>
<a id="pgfId-1243650"></a>Sideband Numbers</h4>

<p>
<a id="pgfId-1197680"></a>The sideband number is the qpss harmonic number that is mixed with. Because qpss always has multiple input frequencies, qpss has multiple harmonic numbers that are being mixed with. If there are 2 tones in the qpss simulation, there are two numbers in qpnoise that describe which harmonics of which tone are mixing to produce that output frequency. If there are three tones in the qpss analysis, then there are three numbers for each qpnoise sideband.</p>
<p>
<a id="pgfId-1197681"></a>If the sideband number is negative, the noise frequency is more negative than the output frequency specified in the qpnoise <em>Choosing Analyses</em> form. If the sideband is positive, the noise frequency is more positive than the output frequency.</p>
<p>
<a id="pgfId-1197682"></a>Although this seems complicated, there are features in the <em>Direct Plot Form</em> to make this easier to understand.</p>
<p>
<a id="pgfId-1197683"></a>Conceptually, an infinite number of conversion gain terms exist when a single output frequency is analyzed in a nonlinear system. From the practical point of view, usually only the noise frequencies near all the qpss harmonics need to be measured.</p>

<h4>
<a id="pgfId-1181090"></a>Setting Moderate Harmonics in QPSS to get Accurate QPnoise Results</h4>

<p>
<a id="pgfId-1181091"></a>The qpss analysis, when shooting is selected, has a minimum of 200 timepoints in each slice, so the large signal in qpss inherently has frequency domain content through the 100th harmonic of the large signal input frequency. Only the harmonics that are specified in the moderate tone affect the accuracy of the solution. The result of this is that the qpnoise mixing products that are produced from mixing with the large signal are almost always correct, (Usually the LO tone) but the mixing with the moderate signal might or might not be accurate, depending on the number of harmonics that are specified for the moderate signal, and the number of harmonics actually produced by the system. Like harmonic balance, you need to run the qpss and qpnoise analyses with a number of harmonics specified for the moderate tone(s), and make the measurement in qpnoise. Then increase the number of moderate harmonics, run again, and make the same measurement. If the result changed significantly, then you need more moderate harmonics. If the result did not change, you might be able to reduce the number of moderate harmonics. Use the smallest number of moderate harmonics that produce a stable qpnoise results.</p>
<p>
<a id="pgfId-1243660"></a>When harmonic balance is selected for the qpss engine, the adjustment of harmonic numbers above also needs to include the LO harmonics. Unlike shooting, where inherently the 100th harmonic is present in the qpss data for the large signal tone, only the number of harmonics actually specified for the LO are present in the solution.</p>

<h3>
<a id="pgfId-1243681"></a>Noise Separation</h3>

<p>
<a id="pgfId-1181279"></a>In addition to the total output noise, the individual noise contributions can be plotted if noise separation is selected in the <em>Choosing Analyses</em> form. More information about the noise separation will be provided in the examples section. The things that can be plotted are:</p>
<ol><li>
<a id="pgfId-1181280"></a>Total noise at the output from each individual noise input frequency (sideband). This allows the identification of which noise frequencies are causing the noise problem.</li><li>
<a id="pgfId-1181281"></a>The noise at the output from each instance name with all noise mechanisms included for mixing from an individual noise input frequency. Once the noise frequency is identified in point 1 above, this capability plots the total noise from each component at the troublesome noise frequency. This allows the identification of which component in the circuit is causing the problem.</li><li>
<a id="pgfId-1181282"></a>The noise at the output from each instance name with all noise mechanisms broken out separately for mixing from an individual noise input frequency. This capability identifies the specific noise sources at the troublesome noise frequency. For example, if a parasitic resistor was found to be the problem, the component might be resized to reduce the noise.</li><li>
<a id="pgfId-1181283"></a>The current noise at the noise instance for each instance name with all noise mechanisms included for mixing from an individual noise input frequency. This capability has limited value. For this plot, all the noise source currents for all the noise mechanisms within the component are added together.</li><li>
<a id="pgfId-1181284"></a>The noise current in the instance from each instance name with all noise mechanisms broken out separately for mixing from an individual noise input frequency. This capability allows the identification of which noise sources are the largest in the circuit. The measurement is at the source, not at the output.</li><li>
<a id="pgfId-1181285"></a>The gain to the output from each individual instance with all the individual noise sources broken out separately for mixing from an individual input frequency. This capability plots the gain from the noise sources in point 5 above to the output of the circuit.</li></ol>






<h3>
<a id="pgfId-1182109"></a>Input-Referred Noise</h3>
<div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1182101"></a>
When the qpnoise analysis is set up with the input source being a port, input-referred noise may not be exact. In this case, the input-referred noise is referred to the voltage source that is inside the port component. The amplitude of the noise is divided by two, which assumes a perfect match. If an accurate input-referred noise is desired, set the <em>Input Source</em> to <em>voltage</em>, and select the input source. This will disable the noise figure calculation.</div>
<h3>
<a id="pgfId-1180858"></a>ADE Implementation</h3>

<p>
<a id="pgfId-1201148"></a>The shift now is from theoretical to practical with the description of where you can find the settings talked about in the concepts section. This section describes the qpnoise <em>Choosing Analyses</em> form and the options form. For examples with all the steps shown, see the examples section that follows this section.</p>
<p>
<a id="pgfId-1181340"></a>Below is the <em>Choosing Analyses</em> form.</p>

<p>
<a id="pgfId-1259178"></a></p>
<div class="webflare-div-image">
<img width="422" height="800" src="images/Chap5-121.gif" /></div>

<ol><li>
<a id="pgfId-1181515"></a>The default <em>Sweeptype</em> is <em>absolute</em>, which means that the noise frequencies defined in the Fr<em>equency Sweep Range</em> fields will not be moved in frequency. The frequency sweep range is always an output frequency range.</li><li>
<a id="pgfId-1181605"></a>Generally, it is better to select Linear or Log spacing and define your own sweep. Auto usually takes more points that are necessary, and that produces longer runtimes than needed.</li><li>
<a id="pgfId-1181651"></a><em>Maximum Clock Order</em> should be set to the same number that you have set the Large signal harmonics to in the qpss form. If you use harmonic balance as the engine in qpss, you can leave this field blank, which accomplishes the same thing.</li><li>
<a id="pgfId-1181690"></a>When <em>Output</em> is set to <em>probe</em>, select a resistor or a port that serves as the load. The noise of this component will be subtracted for the noise figure calculation. That port or resistor also defines the output nets in the circuit. The nets that the port or resistor are connected to will be the output nets for the noise calculation.</li><li>
<a id="pgfId-1181698"></a>When output is set to voltage, select a net or nets in the circuit as the output. No noise will be excluded from the noise figure calculation.</li><li>
<a id="pgfId-1181752"></a>In order to make a noise figure calculation, the input must be a port.</li><li>
<a id="pgfId-1184242"></a>When input-referred noise is needed, do not use a port as the input source. Instead, use a separate voltage source with a resistor in series. Although using a port does work, note that the input-referred noise is really referred to the voltage source that is in the port, and then that noise is divided by two in amplitude. This assumes a perfect match, which rarely occurs in practice.</li><li>
<a id="pgfId-1181780"></a>The reference sideband defines the passband frequency for the noise figure calculations. The easiest way to define the passband frequency is to choose <em>Select from list</em>, and then select the input frequency range that defines the passband from the list. This also defines the input frequency for the input-referred noise calculation.</li><li>
<a id="pgfId-1181805"></a>Noise separation is provided so that troublesome noise frequencies and components can be identified in the circuit. There is an example in the Example section below.</li></ol>









<h4>
<a id="pgfId-1181896"></a><a id="25874"></a>Qpnoise Opt<a id="qpnoise_options"></a>ions</h4>

<p>
<a id="pgfId-1181906"></a>None of the qpnoise options are commonly used.</p>

<p>
<a id="pgfId-1259381"></a></p>
<div class="webflare-div-image">
<img width="570" height="506" src="images/Chap5-122.gif" /></div>
<h4><em>
<a id="pgfId-1181923"></a>tolerance</em></h4>

<p>
<a id="pgfId-1182203"></a>Leave this option at the default.</p>
<p>
<a id="pgfId-1182193"></a>Qpnoise uses an iterative solver to calculate the noise, and any iterative solver needs a tolerance term to specify when the system has been solved accurately enough. The default for shooting qpnoise is 1e-9. The harmonic balance qpnoise tolerance is 1e-6.</p>

<h4><em>
<a id="pgfId-1182003"></a>gear_order</em></h4>

<p>
<a id="pgfId-1182243"></a>Do not set this option.</p>

<h4><em>
<a id="pgfId-1181996"></a>solver</em></h4>

<p>
<a id="pgfId-1182139"></a>The default is <em>turbo</em>.</p>
<p>
<a id="pgfId-1182130"></a>When shooting is used as the engine in qpss, sometimes you will see warning messages in qpnoise that the residual is larger than the tolerance specified. This usually occurs at low offset frequencies from one of the harmonics in the qpss analysis. If you see this message, then select the <em>std</em> solver, which is more able to handle low offset frequencies. The runtime will increase when the <em>std</em> solver is selected.</p>
<p>
<a id="pgfId-1243768"></a>When harmonic balance is the qpss engine, do not change this option.</p>

<h4><em>
<a id="pgfId-1181982"></a>resgmrescycle</em></h4>

<p>
<a id="pgfId-1182286"></a>Leave this option at the default, which is <em>short</em>.</p>

<h4><em>
<a id="pgfId-1181975"></a>hbprecond_solver</em></h4>

<p>
<a id="pgfId-1182179"></a>Note that if you plan to use harmonic balance qpss, the hb form is suggested instead.</p>
<p>
<a id="pgfId-1182166"></a>This option is only available when harmonic balance is set for the qpss engine. When APS is not used, only the basic solver is available. When APS is used, first a faster preconditioner is used. Occasionally, this preconditioner will stagnate, and when it does, it issues a warning that it is switching to the basic solver, and it reverts back to the basic solver. A preconditioner is a mathematical algorithm that makes the iterative matrix solving process faster.</p>

<h4><em>
<a id="pgfId-1181968"></a>annotate</em></h4>

<p>
<a id="pgfId-1182344"></a>This option controls the level of detail in the output log. The default is <em>status</em>. The leftmost selection provides the least output. As you move right, more detail is provided in the output log.</p>

<h4><em>
<a id="pgfId-1181961"></a>save</em></h4>

<p>
<a id="pgfId-1182363"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved. </p>

<h4><em>
<a id="pgfId-1181954"></a>nestlvl</em></h4>

<p>
<a id="pgfId-1182384"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> can be any integer.</p>

<h4><em>
<a id="pgfId-1181947"></a>saveallsidebands</em></h4>

<p>
<a id="pgfId-1182305"></a>Leave this option at the default value of <em>no</em>. If you want to see the noise contributors from the different noise input frequencies, select <em>yes</em> for noise separation in the qpnoise <em>Choosing Analyses</em> form.</p>

<h4><em>
<a id="pgfId-1181933"></a>additionalParams</em></h4>

<p>
<a id="pgfId-1259400"></a>This is typically used for customers who are evaluating new features. If you know the option name and the value, you can type it here. For example, you can type <em>solver=std</em> in this field instead of using the check box in the options form. multiple <em>keyword=value</em> pairs can be entered in this field. Separate the entries with a space.</p>

<h3>
<a id="pgfId-1181263"></a>Example</h3>
<h4>
<a id="pgfId-1221696"></a>Noise Figure and Noise Summary</h4>

<p>
<a id="pgfId-1184278"></a>Consider a 2.4GHz LNA-Mixer.</p>

<p>
<a id="pgfId-1259436"></a></p>
<div class="webflare-div-image">
<img width="665" height="573" src="images/Chap5-123.gif" /></div>

<p>
<a id="pgfId-1184295"></a>The input source has variables set to a variable name. This is done in order to allow easy frequency and amplitude changes from the ADE environment without needing to change the schematic. Here is the properties list for the input port.</p>

<p>
<a id="pgfId-1259483"></a></p>
<div class="webflare-div-image">
<img width="407" height="752" src="images/Chap5-124.gif" /></div>

<p>
<a id="pgfId-1184448"></a>The variables are set in the ADE Explorer environment.</p>

<p>
<a id="pgfId-1259573"></a></p>
<div class="webflare-div-image">
<img width="603" height="513" src="images/Chap5-125.gif" /></div>

<ol><li>
<a id="pgfId-1184468"></a>First, the qpss analysis needs to be set up. For more information, see the qpss section at the beginning of this chapter. Here, a 2.4GHz LO and a 2.45GHz blocker are set up.<br />
<a id="pgfId-1259619"></a><div class="webflare-div-image">
<img width="407" height="731" src="images/Chap5-126.gif" /></div></li><li>
<a id="pgfId-1185547"></a>Now set up the qpnoise analysis.<br />
<a id="pgfId-1259670"></a><div class="webflare-div-image">
<img width="381" height="716" src="images/Chap5-127.gif" /></div></li><li>
<a id="pgfId-1184487"></a>The output frequency range is set, and log sweep is used. It is usually better to set log or linear and define your own sweep because in general automatic takes more points than are usually needed.</li><li>
<a id="pgfId-1185705"></a><em>Maximum clock order</em> should be set to the number of harmonics that are used for the LO in the qpss <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1185735"></a>The output port and the input port are defined. Specifying <em>probe</em> for the <em>Output</em> and selecting either a port or a resistor automatically excludes the noise of the port from the noise figure calculation.</li><li>
<a id="pgfId-1185758"></a>Using <em>Select from list</em> in the <em>Reference Side-Band</em> section is highly recommended. Select the passband frequency (the design input frequency) from the list.</li><li>
<a id="pgfId-1185814"></a>If you want to see the different frequency and device contributions in the <em>Direct Plot Form</em>, select <em>yes</em> for <em>Noise Separation</em>.</li><li>
<a id="pgfId-1260038"></a>Now run the analysis. When the analysis finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> from ADE Explorer. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1260042"></a> <div class="webflare-div-image">
<img width="302" height="491" src="images/Chap5-128.gif" /></div></li><li>
<a id="pgfId-1260043"></a>In the <em>Direct Plot Form</em>, select qpnoise from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1260051"></a>Select the desired measurement, and click <em>Plot</em>.</li><li>
<a id="pgfId-1185885"></a>If you have a noise figure spec over a defined bandwidth, select <em>Integrated Over Bandwidth</em>, type in the frequency range for the measurement, and click <em>Plot</em>. The noise figure curve, and the noise figure over the bandwidth are plotted.<br />
<a id="pgfId-1260113"></a><div class="webflare-div-image">
<img width="634" height="376" src="images/Chap5-129.gif" /></div></li></ol>

























<h4>
<a id="pgfId-1184533"></a><a id="10582"></a>Noise Summary</h4>

<p>
<a id="pgfId-1184534"></a>The noise summary provides information about the devices that contribute noise to the output. This information is available any time a qpnoise simulation completes.</p>
<p>
<a id="pgfId-1184535"></a>In ADE Explorer, select <em>Results</em> - <em>Print</em> - <em>Noise Summary</em>. If noise separation is enabled, there will be two choices at the very top. <code>Qpnoise_src</code> has information about the noise currents at the individual noise sources in the circuit. <code>Qpnoise</code> has information about noise voltage at the output of the circuit.</p>
<p>
<a id="pgfId-1184536"></a>If you want the noise contributors at a single frequency, select <em>spot noise</em>. If you want to have the noise integrated over a frequency range, select <em>integrated noise</em>.</p>
<p>
<a id="pgfId-1184537"></a>If you want noise in volts, set the <em>noise unit</em> to <em>V.</em></p>
<p>
<a id="pgfId-1184538"></a>Generally, <em>Include All Types</em> should be selected. If you just want the noise from specific types of noise generators, you can select them from the list.</p>
<p>
<a id="pgfId-1184539"></a>If you want to specifically include or exclude instances in the list, click the <em>Select</em> button to the right side of the <em>include instances</em> and <em>exclude instances</em> fields and then select the components in the schematic.</p>
<p>
<a id="pgfId-1184540"></a><em>truncate</em> just applies to the list. The total input and output-referred noise at the bottom of the noise summary output always includes all the noise from everything.</p>
<p>
<a id="pgfId-1184541"></a>The figure below is the noise summary window with the sort function being set to noise contributors.</p>

<p>
<a id="pgfId-1260160"></a></p>
<div class="webflare-div-image">
<img width="529" height="429" src="images/Chap5-130.gif" /></div>

<p>
<a id="pgfId-1184546"></a>An example of the noise summary output sorted by noise contributors.</p>

<p>
<a id="pgfId-1260249"></a></p>
<div class="webflare-div-image">
<img width="462" height="505" src="images/Chap5-131.gif" /></div>

<p>
<a id="pgfId-1184557"></a>For all of the noise summaries, here is a table of the abbreviations used in the <em>Param</em> column:</p>

<h4><em>
<a id="pgfId-1250900"></a><a id="19868"></a>Abbreviations Used<a id="param"></a> In the Param Column</em></h4>

<p>
<a id="pgfId-1184558"></a>Resistor and Inductor:</p>

<p>
<a id="pgfId-1184572"></a></p>
<table class="webflareTable" id="#id1184559">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184561">
<a id="pgfId-1184561"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184563">
<a id="pgfId-1184563"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184565"></a><code>rn</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184567"></a>resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184569"></a><code>fn</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184571"></a>Flicker noise</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1184573"></a>Diode:</p>

<p>
<a id="pgfId-1184587"></a></p>
<table class="webflareTable" id="#id1184574">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184576">
<a id="pgfId-1184576"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184578">
<a id="pgfId-1184578"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184580"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184582"></a>Diode current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184584"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184586"></a>Series parasitic resistor noise</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1184588"></a>Gummel-Poon BJT:</p>

<p>
<a id="pgfId-1184618"></a></p>
<table class="webflareTable" id="#id1184589">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184591">
<a id="pgfId-1184591"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184593">
<a id="pgfId-1184593"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184595"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184597"></a>Flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184599"></a>ic</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184601"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184603"></a>ib</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184605"></a>Base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184607"></a>rc</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184609"></a>Thermal noise from the collector parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184611"></a>rb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184613"></a>Thermal noise from the base parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184615"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184617"></a>Thermal noise from the emitter parasitic resistor</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1184619"></a>HiCUM:</p>

<p>
<a id="pgfId-1184653"></a></p>
<table class="webflareTable" id="#id1184620">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184622">
<a id="pgfId-1184622"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184624">
<a id="pgfId-1184624"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184626"></a>ib</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184628"></a>Base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184630"></a>ic</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184632"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184634"></a>rbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184636"></a>Thermal noise from the internal base parasitic resistor (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184638"></a>rbx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184640"></a>Thermal noise from the external base parasitic resistor (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184642"></a>rcx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184644"></a>Collector parasitic resistor thermal noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184646"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184648"></a>Emitter parasitic resistor thermal noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184650"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184652"></a>Flicker noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 5-1
<a id="pgfId-1184654"></a>HiCUM Schematic Diagram</strong></p>
<p>
<a id="pgfId-1184658"></a></p>
<div class="webflare-div-image">
<img width="674" height="470" src="images/Chap5-132.gif" /></div>

<p>
<a id="pgfId-1184659"></a>VBIC:</p>

<p>
<a id="pgfId-1184717"></a></p>
<table class="webflareTable" id="#id1184660">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184662">
<a id="pgfId-1184662"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1184664">
<a id="pgfId-1184664"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184666"></a>rbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184668"></a>Thermal noise in resistor Rbi (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184670"></a>rbx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184672"></a>Thermal noise in resistor Rbx (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184674"></a>rci</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184676"></a>Thermal noise in resistor Rci (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184678"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184680"></a>Thermal noise in resistor Re (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184682"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184684"></a>Thermal noise in resistor Rs (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184686"></a>itzf</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184688"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184690"></a>ibe</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184692"></a>Total base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184694"></a>ibex</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184696"></a>Node Bx to E base current shot noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184698"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184700"></a>Ibe flicker noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184702"></a>fnx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184704"></a>Ibex flicker noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184706"></a>iccp</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184708"></a>Parasitic transport collector to emitter current noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184710"></a>ibep</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184712"></a>Parasitic transport base to emitter current noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184714"></a>fnp</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1184716"></a>Ibep flicker Noise (See diagram below)</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 5-2
<a id="pgfId-1184718"></a>VBIC Schematic Diagram</strong></p>
<p>
<a id="pgfId-1185036"></a></p>
<div class="webflare-div-image">
<img width="665" height="630" src="images/Chap5-133.gif" /></div>

<p>
<a id="pgfId-1185037"></a>BSIM3:</p>

<p>
<a id="pgfId-1185059"></a></p>
<table class="webflareTable" id="#id1185038">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185040">
<a id="pgfId-1185040"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185042">
<a id="pgfId-1185042"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185044"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185046"></a>Flicker Noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185048"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185050"></a>Thermal noise from the resistive drain current</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185052"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185054"></a>Thermal noise from the source parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185056"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185058"></a>Thermal noise from the drain parasitic resistor</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1185060"></a>BSIM4:</p>

<p>
<a id="pgfId-1185118"></a></p>
<table class="webflareTable" id="#id1185061">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185063">
<a id="pgfId-1185063"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185065">
<a id="pgfId-1185065"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185067"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185069"></a>Flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185071"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185073"></a>Thermal noise from the resistive drain current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185075"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185077"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185079"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185081"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185083"></a>igd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185085"></a>Gate-to-drain tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185087"></a>igs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185089"></a>Gate-to-source tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185091"></a>igb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185093"></a>Gate-to-bulk tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185095"></a>rbdb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185097"></a>Resistor thermal noise between dbNode and bNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185099"></a>rbpb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185101"></a>Resistor thermal noise between bNode and bNodePrime (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185103"></a>rbpd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185105"></a>Resistor thermal noise between Bulk and dbNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185107"></a>rbps</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185109"></a>Resistor thermal noise between bulk and bNode prime</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185111"></a>rbsb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185113"></a>Resistor thermal noise between sbNode and bNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185115"></a>rgbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185117"></a>Gate Bias-Independent Resistor thermal noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 5-3
<a id="pgfId-1185119"></a>BSIM4 Schematic Diagrams</strong></p>
<p>
<a id="pgfId-1185123"></a></p>
<div class="webflare-div-image">
<img src="images/Chap5e/intrinsic.GIF" /></div>
<p>
<a id="pgfId-1185127"></a></p>
<div class="webflare-div-image">
<img width="597" height="316" src="images/Chap5-135.gif" /></div>

<p>
<a id="pgfId-1185128"></a><strong>PSP-103</strong></p>

<p>
<a id="pgfId-1246481"></a>!</p>
<table class="webflareTable" id="#id1185129">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185131">
<a id="pgfId-1185131"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185133">
<a id="pgfId-1185133"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185135"></a>sfl</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185137"></a>Channel current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185139"></a>sth</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185141"></a>Channel current thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185143"></a>sig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185145"></a>induced gate noise at 1 Hz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185147"></a>sigth</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185149"></a>Induced gate noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185151"></a>shotgd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185153"></a>Gate current shot noise from gate to drain</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185155"></a>shotgs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185157"></a>Gate current shot noise from gate to source</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185159"></a>sjnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185161"></a>Source to Bulk leakage current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185163"></a>djnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185165"></a>Drain to Bulk leakage and avalanche current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185167"></a>rgatenoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185169"></a>Gate resistance thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185171"></a>rbulknoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185173"></a>Bulk resistor thermal noise between node BP and BI (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185175"></a>rjnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185177"></a>Source side bulk resistor thermal noise between node BI and BS (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185179"></a>rjundnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185181"></a>Drain side bulk resistor thermal noise between node BI and BD (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185183"></a>rwellnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185185"></a>Well resistor thermal noise between node BI and B (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185187"></a>rsourcenoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185189"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185191"></a>rdrainnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185193"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 5-4
<a id="pgfId-1185195"></a>PSP-103 Schematic Diagram</strong></p>
<p>
<a id="pgfId-1185199"></a></p>
<div class="webflare-div-image">
<img src="images/Chap5e/psp103_43.gif" /></div>

<p>
<a id="pgfId-1185200"></a>EKV<strong> 3.0</strong></p>

<p>
<a id="pgfId-1185254"></a></p>
<table class="webflareTable" id="#id1185201">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185203">
<a id="pgfId-1185203"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1185205">
<a id="pgfId-1185205"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185207"></a>fn_id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185209"></a>Channel current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185211"></a>fn_ig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185213"></a>Gate current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185215"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185217"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185219"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185221"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185223"></a>rg</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185225"></a>Gate parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185227"></a>rsb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185229"></a>Thermal noise for the substrate resistor connected between BSi and B. (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185231"></a>rdb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185233"></a>Thermal noise for the substrate resistor connected between BDi and B. (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185235"></a>rbbs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185237"></a>Thermal noise for the substrate resistor connected between BSi and Bi. (See diagram below where it is labeled RDSB/2)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185239"></a>rbbd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185241"></a>Thermal noise for the substrate resistor connected between BDi and Bi. (See diagram below where it is labeled RDSB/2)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185243"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185245"></a>Thermal noise of the channel resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185247"></a>cor</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185249"></a>Induced gate noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185251"></a>shot_ig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1185253"></a>Gate current shot noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 5-5
<a id="pgfId-1185255"></a>EKV3.0 Schematic Diagrams</strong></p>
<p>
<a id="pgfId-1185259"></a></p>
<div class="webflare-div-image">
<img src="images/Chap5e/27_1.GIF" /></div>

<p>
<a id="pgfId-1185260"></a>For other model types:</p>
<ol><li>
<a id="pgfId-1185261"></a>In a unix/linux shell window type <code>which spectre</code>.<br />
<a id="pgfId-1185262"></a>This should return a path that ends in <code>tools/bin/spectre</code>.</li><li>
<a id="pgfId-1185263"></a>Triple-click the line with the path, and then click the center mouse button to enter it as a command.</li><li>
<a id="pgfId-1185264"></a>Use the backspace key, and delete the word <code>spectre</code>.</li><li>
<a id="pgfId-1185265"></a>Type <code>cdnshelp</code> at the end of the expression, and press <code>Enter</code>.<br />
<a id="pgfId-1185266"></a>A browser window will be displayed.</li><li>
<a id="pgfId-1185267"></a>Close the <em>Tip of the day</em> window.</li><li>
<a id="pgfId-1185268"></a>At the top, you should see the release number of the simulator you are using.</li><li>
<a id="pgfId-1185269"></a>Click the plus sign (+) to the left of the MMSim folder.</li><li>
<a id="pgfId-1185270"></a>Click the plus sign (+) to the left of the <em>Spectre Circuit Simulator Components and Device Models Reference</em> folder.</li><li>
<a id="pgfId-1185271"></a>Select the device type you are using.</li><li>
<a id="pgfId-1185272"></a>At the bottom of that device listing, you will see <em>Component Statements</em>. Double-click on this.</li><li>
<a id="pgfId-1185273"></a>Enter the name of the parameter in the search box in the right pane of the cdnshelp window.</li><li>
<a id="pgfId-1185274"></a>Click the down arrow to the right of the <em>Find</em> field until you see the parameter name in the pane on the right side, and then see the definition of that parameter.</li></ol>














<h3>
<a id="pgfId-1186095"></a>Viewing Noise Separation Results</h3>

<p>
<a id="pgfId-1221803"></a>Consider a 2.4GHz LNA-Mixer.</p>

<p>
<a id="pgfId-1260386"></a></p>
<div class="webflare-div-image">
<img width="668" height="578" src="images/Chap5-138.gif" /></div>

<p>
<a id="pgfId-1221804"></a>The input source has variables set to a variable name. This is done in order to allow easy frequency and amplitude changes from the ADE Explorer environment without needing to change the schematic. Here is the properties list for the input port.</p>

<p>
<a id="pgfId-1260427"></a></p>
<div class="webflare-div-image">
<img width="427" height="764" src="images/Chap5-139.gif" /></div>

<p>
<a id="pgfId-1221818"></a>The variables are set in the ADE Explorer environment.</p>

<p>
<a id="pgfId-1260518"></a></p>
<div class="webflare-div-image">
<img width="601" height="509" src="images/Chap5-140.gif" /></div>

<ol><li>
<a id="pgfId-1221819"></a>First, the qpss analysis needs to be set up. For more information, see the qpss section at the beginning of this chapter. Here, a 2.4GHz LO and a 2.45GHz blocker are set up.<br />
<a id="pgfId-1260562"></a><div class="webflare-div-image">
<img width="382" height="712" src="images/Chap5-141.gif" /></div></li><li>
<a id="pgfId-1221826"></a>Now set up the qpnoise analysis.<br />
<a id="pgfId-1260626"></a><div class="webflare-div-image">
<img width="430" height="797" src="images/Chap5-142.gif" /></div></li><li>
<a id="pgfId-1221827"></a>The output frequency range is set, and log sweep is used. It is usually better to set log or linear and define your own sweep because in general automatic takes more points than are usually needed.</li><li>
<a id="pgfId-1221828"></a><em>Maximum clock order</em> should be set to the number of harmonics that are used for the LO in the qpss <em>Choosing Analyses</em> form. If you use the harmonic balance engine in qpss, this field can be left blank, which does the same thing.</li><li>
<a id="pgfId-1221829"></a>The output port and the input port are defined. Specifying probe for the output and selecting either a port or a resistor automatically excludes the noise of the selected component from the noise figure calculation.</li><li>
<a id="pgfId-1221830"></a>Using <em>Select from list</em> in the <em>Reference Side-Band</em> section is highly recommended. Select the passband frequency (the design input frequency) from the list.</li><li>
<a id="pgfId-1221831"></a>If you want to see the different frequency and device contributions in the <em>Direct Plot Form</em>, select the <em>Noise Separation</em> check box.</li><li>
<a id="pgfId-1221832"></a>Now run the analysis. When the analysis finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> from ADE Explorer. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1260737"></a><div class="webflare-div-image">
<img width="304" height="585" src="images/Chap5-143.gif" /></div></li></ol>


















<h4>
<a id="pgfId-1186096"></a>Viewing the Total Noise at the Output from a Single Noise Input Frequency</h4>

<p>
<a id="pgfId-1186097"></a>This capability allows the noise from all sources in the circuit at different noise input frequencies to be measured. For example, all the noise that does not change frequency (the zero, zero sideband) can be plotted, along with the other noise input frequencies (sidebands) This plotting capability allows problem frequencies to be identified.</p>
<p>
<a id="pgfId-1186098"></a>On the Direct Plot Form:</p>

<p>
<a id="pgfId-1260787"></a></p>
<div class="webflare-div-image">
<img width="282" height="571" src="images/Chap5-144.gif" /></div>

<ol><li>
<a id="pgfId-1186103"></a>Select q<em>pnoise separation</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1186104"></a>To view the total noise at the output select <em>Sideband Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1186105"></a>Select <em>V/sqrt(Hz)</em> or <em>V**2/Hz</em> from the <em>Signal</em> <em>Level</em> radio buttons.</li><li>
<a id="pgfId-1186106"></a>Select the appropriate modifier from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1186107"></a>Select the sideband number form the <em>Output Sideband </em>list. Start with about the -3 X sideband that borders the -4 X sideband. </li><li>
<a id="pgfId-1186554"></a>Use the slider to get to the boundary between the 0 X sideband and the -1 X sideband. Hold the Press and hold the &lt;<code>Shift</code>&gt; key, and click the last 0 X sideband. A lot of sidebands will highlight.<br />
<a id="pgfId-1260840"></a><div class="webflare-div-image">
<img width="305" height="570" src="images/Chap5-145.gif" /></div></li><li>
<a id="pgfId-1186896"></a>In some cases, you want to start with the 0 X sideband and go through the 3 X sideband.</li><li>
<a id="pgfId-1186108"></a>Usually, above the third harmonic, little noise is mixed to the output frequency.</li><li>
<a id="pgfId-1186884"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1260893"></a><div class="webflare-div-image">
<img width="619" height="428" src="images/Chap5-146.gif" /></div></li><li>
<a id="pgfId-1186609"></a>Select the trace with the highest amplitude at high frequency. Note that this is the -1 0 sideband in this case. -1 0 means the noise input frequency is mixing with the first harmonic of the LO and not with the RF input, and the noise input frequency is more negative than the output frequency. The noise frequency is 1KHz to 100MHz minus 1 * (LO Frequency of 2.4GHz) or -2.5GHz to nearly -2.4 GHz.</li><li>
<a id="pgfId-1186618"></a>Select the trace with the largest 1/F noise.<br />
<a id="pgfId-1260934"></a><div class="webflare-div-image">
<img width="632" height="431" src="images/Chap5-147.gif" /></div></li><li>
<a id="pgfId-1186642"></a>This is the 0 0 sideband. There is no mixing at all with either the LO or the RF, so the noise frequency range is from 1KHz to 100MHz.</li><li>
<a id="pgfId-1186665"></a>For the rest of this example, the -1 0 sideband is used. For isolating 1/F noise contributors, the 0 0 sideband would be used. The steps are exactly the same for both cases.</li></ol>

























<h4>
<a id="pgfId-1186139"></a>Viewing Total Noise at the Output from each Instance</h4>

<p>
<a id="pgfId-1186140"></a>Once the problem frequencies are identified in the plot of <em>Sideband Output</em>, the problem components need to be identified. From the previous plot, the -1 0 sideband contributes the largest amount of noise to the overall output noise. Using <em>Instance Output</em> allows the identification of which components with noise in the -1 0 sideband contribute the most noise. The total noise for all the noise mechanisms within the component is plotted.</p>
<p>
<a id="pgfId-1186141"></a>On the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1261056"></a></p>
<div class="webflare-div-image">
<img width="358" height="795" src="images/Chap5-148.gif" /></div>

<ol><li>
<a id="pgfId-1186146"></a>Select <em>Instance Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1186147"></a>Select <em>V/sqrt(Hz)</em> or <em>V**2/Hz</em>.</li><li>
<a id="pgfId-1186148"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1186149"></a>Select the sideband number. In this example, the -1 0 sideband was determined to contribute the most noise at the output of the circuit.</li><li>
<a id="pgfId-1186150"></a>Select the type of component to display. If you want all of the types, choose <em>Include All Types</em>.</li><li>
<a id="pgfId-1186156"></a>Specify the number of results you want to plot. 5 is specified in the above figure.</li><li>
<a id="pgfId-1186161"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1186162"></a>The total noise at the output for the top five components is plotted.<br />
<a id="pgfId-1261120"></a><div class="webflare-div-image">
<img width="637" height="408" src="images/Chap5-149.gif" /></div>
<a id="pgfId-1186168"></a>To see which component goes with which trace, select the plus sign (highlighted in the red box on the previous graphic) to the left or the text at the upper left of the display area. The legends expand, and you can see which trace is which in the <em>Name</em> column on the left side of the display tool.<br />
<a id="pgfId-1187392"></a>The red trace above comes from the input port. The next largest contributor from the circuit is the green curve, which is selected. The instance name is shown in the legend. I33.I0.NM12 is the highest contributor. I33 is the top-level instance. I0 is the next level down instance. NM12 is the next level down instance.</li></ol>














<h4>
<a id="pgfId-1235740"></a>Viewing the Exact Noise Mechanism Within the devices</h4>

<p>
<a id="pgfId-1186174"></a>The sideband with the largest contribution was determined by selecting <em>Sideband Output</em> and plotting. The specific component was identified by selecting <em>Instance Output</em>. The specific noise mechanisms can be identified using <em>Source output</em>. This plots the largest individual noise mechanisms for the sideband you select.</p>
<p>
<a id="pgfId-1186175"></a>On the<em> Direct Plot Form:</em></p>

<p>
<a id="pgfId-1261177"></a></p>
<div class="webflare-div-image">
<img width="323" height="800" src="images/Chap5-150.gif" /></div>

<ol><li>
<a id="pgfId-1186180"></a><em>Select qpnoise separation from the Analysis section.</em></li><li>
<a id="pgfId-1261283"></a>Select <em>Source Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1186181"></a>Select <em>V/sqrt(Hz)</em> or <em>V**2/Hz</em>.</li><li>
<a id="pgfId-1186182"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1186183"></a>Select the sideband number.</li><li>
<a id="pgfId-1186184"></a>Select the type of component to display. If you want all of the types, choose <em>Include All Types</em>.</li><li>
<a id="pgfId-1186189"></a>If you want to restrict to one device, put its instance name in the <em>include inst</em> field. A list of devices separated by a space is also acceptable. In this case, we already know the instance name is I33.I0.NM12. This is entered into the Include Inst field above.</li><li>
<a id="pgfId-1186190"></a>If you want to exclude a device (or devices) enter the instance name(s) in the <em>exclude inst</em> field.</li><li>
<a id="pgfId-1186191"></a>Specify the number of results you want to plot in the <em>by top </em>field.</li><li>
<a id="pgfId-1186192"></a>Click <em>Plot.</em><br />
<a id="pgfId-1186193"></a>The exact noise mechanism within the devices is plotted.<br />
<a id="pgfId-1261363"></a><div class="webflare-div-image">
<img width="639" height="416" src="images/Chap5-151.gif" /></div>
<a id="pgfId-1186199"></a>To see which noise source goes with which trace, select the plus sign to the left or the text at the upper left of the display area. The legends will be shown individually in the <em>Name</em> field of the waveform tool. The device name and the individual noise contributor will be shown. You can select either the individual legend or the trace and both the legend and the trace will be highlighted. The first part is the instance name, and the second part is the specific noise mechanism within that instance. For a list of the abbreviations used for the noise parameter, refer to <a href="Chap5.html#19868">Abbreviations Used In the Param Column</a>. </li></ol>
















<h4>
<a id="pgfId-1220491"></a>Viewing the total noise currents within the devices</h4>

<p>
<a id="pgfId-1186211"></a>This capability has limited value. All the noise currents from all the noise mechanisms within the instance are added up without regard to the transfer functions to the output. No gain function is applied or are available for this measurement. It just adds up everything within that instance. No correlations are observed. It just adds up the total current. </p>
<p>
<a id="pgfId-1261442"></a>In the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1261451"></a></p>
<div class="webflare-div-image">
<img width="358" height="798" src="images/Chap5-152.gif" /></div>
<ol><li>
<a id="pgfId-1186212"></a>Select <em>Instance source</em>.</li><li>
<a id="pgfId-1186213"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the Signal Level selection.</li><li>
<a id="pgfId-1186214"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1186215"></a>Select the sideband number.</li><li>
<a id="pgfId-1186216"></a>If you want every noise source to be considered, select I<em>nclude All Types</em>.</li><li>
<a id="pgfId-1186217"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1186218"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst </em>field, and select the instances on the schematic.</li><li>
<a id="pgfId-1186219"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1186220"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1186224"></a>The frequency response curves are displayed.<br />
<a id="pgfId-1261529"></a><div class="webflare-div-image">
<img width="587" height="413" src="images/Chap5-153.gif" /></div></li><li>
<a id="pgfId-1194639"></a>The instance names are shown in the legend.</li></ol>
















<h4><em>
<a id="pgfId-1186225"></a>Plotting the individual noise source currents</em></h4>

<p>
<a id="pgfId-1186230"></a>This capability plots the individual noise currents within the device. This capability gives you the noise current at the source instead of at the noise at the output of the circuit. This capability allows you to identify the largest noise sources in the circuit.</p>

<p>
<a id="pgfId-1261582"></a></p>
<div class="webflare-div-image">
<img width="290" height="731" src="images/Chap5-154.gif" /></div>
<ol><li>
<a id="pgfId-1186231"></a>Select <em>Primary Source</em>.</li><li>
<a id="pgfId-1186232"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the <em>Signal Level</em> selection.</li><li>
<a id="pgfId-1186233"></a>Select <em>Magnitude</em> or <em>dB20</em> in the Modifier section.</li><li>
<a id="pgfId-1186234"></a>Select the sideband number.</li><li>
<a id="pgfId-1186235"></a>If you want every noise source to be considered, select I<em>nclude All Types</em>.</li><li>
<a id="pgfId-1186236"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1186237"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst.</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1186238"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1186239"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1186240"></a>The frequency response curves are displayed</li><li>
<a id="pgfId-1194877"></a>The specific noise sources are displayed in the legend.<br />
<a id="pgfId-1261675"></a><div class="webflare-div-image">
<img width="636" height="410" src="images/Chap5-155.gif" /></div>
<a id="pgfId-1250583"></a>For a list of the noise parameter names, <a href="Chap5.html#19868">Abbreviations Used In the Param Column</a>. In this list, <em>rn</em> is a parasitic resistance, and <em>id</em> is the thermal noise from the channel.</li></ol>

















<h4><em>
<a id="pgfId-1250585"></a>Plotting the gain from the individual noise sources to the output</em></h4>

<p>
<a id="pgfId-1186251"></a>This capability gives the gain from the individual noise currents to the output of the circuit.</p>

<p>
<a id="pgfId-1261723"></a></p>
<div class="webflare-div-image">
<img width="290" height="764" src="images/Chap5-156.gif" /></div>
<ol><li>
<a id="pgfId-1186252"></a>Select <em>Source Noise Gain</em>.</li><li>
<a id="pgfId-1186253"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the <em>Signal Level</em> selection.</li><li>
<a id="pgfId-1186254"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1186255"></a>Select the sideband number.</li><li>
<a id="pgfId-1186256"></a>If you want every noise source to be considered, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1186257"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot. Everything will be plotted except for those instances.</li><li>
<a id="pgfId-1246673"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst.</em> field, and select the instances on the schematic. All other instances will not be in the results when you use this capability. this example, the instance name of the largest noise source from the previous section was entered in the include inst field.</li><li>
<a id="pgfId-1195142"></a>Set the number of curves to plot by setting the <em>Truncate</em> function.</li><li>
<a id="pgfId-1195143"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1261834"></a><div class="webflare-div-image">
<img width="557" height="358" src="images/Chap5-157.gif" /></div></li></ol>













<p>
<a id="pgfId-1195144"></a>The frequency response curves are displayed. For a list of the abbreviations used for the noise parameters, <a href="Chap5.html#19868">Abbreviations Used In the Param Column</a>. In this list, <em>fn</em> is flicker noise, and <em>rn</em> is resistor thermal noise.</p>

<h4>
<a id="pgfId-1236093"></a>Noise as a Function of Blocker Power</h4>

<p>
<a id="pgfId-1222441"></a>This measurement is almost always faster when harmonic balance is used. Consider using hb and hbnoise analysis as described in <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance,&#8221;</a> because the hb and hbnoise forms always include the latest improvements, and qpss and qpnoise generally are not improved. Consider a 2.4GHz LNA-Mixer.</p>

<p>
<a id="pgfId-1261891"></a></p>
<div class="webflare-div-image">
<img width="587" height="577" src="images/Chap5-158.gif" /></div>

<p>
<a id="pgfId-1222442"></a>The input source has variables set to a variable name. This is done in order to allow easy frequency and amplitude changes from the ADE Explorer environment without needing to change the schematic. Here is the properties list for the input port.</p>

<p>
<a id="pgfId-1262019"></a></p>
<div class="webflare-div-image">
<img width="380" height="736" src="images/Chap5-159.gif" /></div>

<p>
<a id="pgfId-1222456"></a>The variables are set in the ADE Explorer environment.</p>

<p>
<a id="pgfId-1262106"></a></p>
<div class="webflare-div-image">
<img width="668" height="507" src="images/Chap5-160.gif" /></div>

<ol><li>
<a id="pgfId-1222457"></a>First, the qpss analysis needs to be set up. For more information, see the qpss section at the beginning of this chapter. Here, a 2.4GHz LO and a 2.45GHz blocker are set up. Set up a sweep of the blocker power that is appropriate for your circuit. In this example, the blocker power is swept from -50 to -30dBm. Because the power will be swept to a large amplitude, 5 harmonics are set on the moderate tone.<br />
<a id="pgfId-1262151"></a><div class="webflare-div-image">
<img width="423" height="785" src="images/Chap5-161.gif" /></div></li><li>
<a id="pgfId-1222464"></a>Now set up the qpnoise analysis.<br />
<a id="pgfId-1262247"></a><div class="webflare-div-image">
<img width="427" height="797" src="images/Chap5-162.gif" /></div></li><li>
<a id="pgfId-1222465"></a>When the power is swept in qpss, the <em>Output Frequency Sweep Range</em> is set to <em>Single Point</em> automatically. Set the frequency to an appropriate output frequency for your design. In this example, 1MHz is set.</li><li>
<a id="pgfId-1222466"></a><em>Maximum clock Order</em> should be set to the number of harmonics that are used for the LO in the qpss <em>Choosing Analyses</em> form. If harmonic balance is used as the qpss engine, this field can be left blank, which has the same effect.</li><li>
<a id="pgfId-1222467"></a>The output port and the input port are defined. Specifying Probe for the output and selecting either a port or a resistor automatically excludes the noise of the selected component from the noise figure calculation.</li><li>
<a id="pgfId-1222468"></a>Using <em>Select from list</em> from the <em>Reference Side-Band</em> drop-down list is highly recommended. Select the passband frequency (the design input frequency) from the list. In this example, the input frequency just above the 2.4GHz LO is selected. </li><li>
<a id="pgfId-1222470"></a>Click <em>OK</em> and run the analysis. When the analysis finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> from ADE Explorer. The <em>Direct Plot Form</em> is displayed. <br />
<a id="pgfId-1262457"></a>.<div class="webflare-div-image">
<img width="352" height="448" src="images/Chap5-163.gif" /></div></li><li>
<a id="pgfId-1262437"></a>Select <em>qpnoise</em> in the <em>Analysis</em> section. </li><li>
<a id="pgfId-1262475"></a>Select the desired measurement and click <em>Plot</em>. <br />
<a id="pgfId-1262490"></a>In this example, the double-sideband noise figure is plotted<br />
<a id="pgfId-1223350"></a>The output appears in the waveform tool.<br />
<a id="pgfId-1262529"></a><div class="webflare-div-image">
<img width="512" height="361" src="images/Chap5-164.gif" /></div></li><li>
<a id="pgfId-1223367"></a>Next, the display will be made easier to read. Move your mouse cursor over one of the numbers on the X Axis, click the right mouse button and select <em>Swap Sweep Var</em> from the context menu.<br />
<a id="pgfId-1262571"></a><div class="webflare-div-image">
<img width="504" height="363" src="images/Chap5-165.gif" /></div></li><li>
<a id="pgfId-1223389"></a>In the <em>Swap Sweep Var</em> window, the sweep variable is selected automatically. Type in the X-Axis value for the measurement. In this example, this is 1M.<br />
<a id="pgfId-1262608"></a> <div class="webflare-div-image">
<img width="320" height="206" src="images/Chap5-166.gif" /></div></li><li>
<a id="pgfId-1262634"></a>Click <em>OK</em>.<br />
<a id="pgfId-1223413"></a>The waveform window adds a subwindow with a more traditional presentation.<br />
<a id="pgfId-1262684"></a><div class="webflare-div-image">
<img width="486" height="364" src="images/Chap5-167.gif" /></div></li><li>
<a id="pgfId-1223430"></a>As expected, the noise figure increases with increasing blocker power.</li></ol>












































<h2>
<a id="pgfId-1196423"></a>QPXF An<a id="qpxf"></a>alysis</h2>

<p>
<a id="pgfId-1196424"></a>Usually, qpxf is used to measure forward conversion gain when an LO and a high amplitude blocking signal are applied to the circuit. In this application, hb with hbxf is likely to run faster than shooting qpss with qpxf. Although harmonic balance is available in qpss, it is strongly recommended that you use hb and hbxf because the latest capabilities in the simulator are always available there.</p>
<p>
<a id="pgfId-1196429"></a>For more information, see <a href="Chap4.html#65248">Periodic Transfer Function Analysis (PXF)</a>.</p>
<p>
<a id="pgfId-1196387"></a>Qpxf is just like pxf in that qpxf calculates forward conversion gain. The difference is that qpxf runs after a qpss analysis where there are more input frequencies than in pss, and as a result, the circuit produces many more harmonics. Because there are many more harmonics in the large-signal analysis, there are many more transfer functions to calculate. Unlike pxf, qpxf has only one mode which measures the conversion gain of the system. If you need to measure AM to PM conversion (using modulated) or an instantaneous transfer function (using sampled) you need to use pss-pxf which has these capabilities. Qpxf does not have these capabilities.</p>
<p>
<a id="pgfId-1195493"></a>As engineers, we are accustomed to driving the input and measuring the output of the circuit. This is the idea of qpac. In qpac, we apply the LO signal (or the sample clock) and a blocking signal in the qpss analysis, and then we drive the input with the small-signal qpac analysis and measure the mixing products that come out of the circuit. While this is very intuitive, the output display can be very confusing to read when the conversion gain near several qpss harmonics is desired. Qpxf changes the focus to the output. One output frequency at a time is considered, and in qpxf, the input frequencies that cause the output frequency are calculated, and the forward conversion gain from all those input frequencies is also calculated. Using qpxf, you can measure the conversion gain near a number of LO harmonics (or clock harmonics) and blocker harmonics in the same simulation run.</p>

<h3>
<a id="pgfId-1195494"></a>Example: Conversion Gain</h3>

<p>
<a id="pgfId-1195495"></a>Consider the double-balanced diode mixer shown below.</p>

<p>
<a id="pgfId-1195499"></a></p>
<div class="webflare-div-image">
<img width="638" height="552" src="images/Chap5-168.gif" /></div>

<p>
<a id="pgfId-1195500"></a>The RF input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. This allows changes in frequency or amplitude from the ADE Explorer environment without needing to change the schematic itself.</p>
<p>
<a id="pgfId-1195501"></a>The property list is shown below.</p>

<p>
<a id="pgfId-1262718"></a></p>
<div class="webflare-div-image">
<img width="668" height="793" src="images/Chap5-169.gif" /></div>

<p>
<a id="pgfId-1196483"></a>The LO signal also uses variable names.</p>
<p>
<a id="pgfId-1195510"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> - <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type in the desired value, and press <em>Enter. </em>When you have set the variables, if you want to add the values back into the cellview, in the ADE Explorer window, select <em>Variables</em> - <em>Copy To Cellview</em>, and then perform a <em>Check and Save</em> in the schematic.</p>
<p>
<a id="pgfId-1198293"></a>In this example, the LO frequency is 1GHz and its amplitude is 1.4 volts peak. This is +13 dBm, which is a common drive level for diode mixers. The RF frequency is 900MHz, and the amplitude is set to -10dBm.</p>

<p>
<a id="pgfId-1262765"></a></p>
<div class="webflare-div-image">
<img width="665" height="447" src="images/Chap5-170.gif" /></div>

<p>
<a id="pgfId-1195512"></a>The basic strategy is to apply the signals that cause the nonlinearity to occur in the qpss analysis, and then measure the forward conversion gain using qpxf analysis.</p>
<p>
<a id="pgfId-1195518"></a>The qpss analysis needs to be set up first. The example below shows an LO signal at 1GHz with 10 harmonics, and the RF input at 900MHz with five harmonics. For more information, see the qpss section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1262806"></a></p>
<div class="webflare-div-image">
<img width="367" height="719" src="images/Chap5-171.gif" /></div>

<p>
<a id="pgfId-1195524"></a>Next, the qpxf analysis needs to be set up. Like xf, pxf, and hbxf, the frequency range specified in the <em>Choosing Analyses</em> form is the output frequency range. Usually, it is better to select Linear or Log spacing and define the resolution of the sweep yourself. Most of the time, Automatic will take more frequency points than you need, and that extends the runtime.</p>
<p>
<a id="pgfId-1196655"></a><em>When shooting is used as the qpss engine, Maximum clock order </em>should be set to three or four. Usually, the higher order conversion gain products are not needed. If harmonic balance is used for the qpss engine, either leave this field blank, or set <em>Maximum clock order</em> to the same number you used for the LO harmonics. In either case, the <em>Direct Plot Form</em> can be used to select the result that you want.</p>
<p>
<a id="pgfId-1262904"></a>Select the output net in the circuit. The conversion gain terms will be measured to this net. If you have an output current, add an iprobe from analogLib in series with the output, and select <em>probe</em> in the <em>Output</em> section. Then specify the instance name of the iprobe in the <em>Output Probe Instance</em> field.</p>

<p>
<a id="pgfId-1262912"></a></p>
<div class="webflare-div-image">
<img width="402" height="598" src="images/Chap5-172.gif" /></div>

<p>
<a id="pgfId-1198393"></a>Once the analyses are set up, the simulation can be run. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.</p>

<p>
<a id="pgfId-1262993"></a></p>
<div class="webflare-div-image">
<img width="341" height="412" src="images/Chap5-173.gif" /></div>

<p>
<a id="pgfId-1195531"></a>The example below shows a typical plot</p>

<p>
<a id="pgfId-1263017"></a>.</p>
<div class="webflare-div-image">
<img width="648" height="431" src="images/Chap5-174.gif" /></div>

<p>
<a id="pgfId-1196720"></a>To measure the conversion gain, place a marker at the desired input frequency, and read the forward conversion gain. The conversion gain is about -6dB as expected.</p>
<p>
<a id="pgfId-1196727"></a>In a zoomed-in view, the conversion gain near the first harmonic of the LO (1GHz) is about 6 dB. The conversion gain near the third harmonic of the LO is also quite high at about -18.5 dB.</p>

<p>
<a id="pgfId-1263053"></a></p>
<div class="webflare-div-image">
<img width="560" height="356" src="images/Chap5-175.gif" /></div>

<p>
<a id="pgfId-1195537"></a>The qpxf direct plot is a bit non-intuitive. The <em>Choosing Analyses</em> form specifies the output frequency range and the output node. Qpxf calculates the transfer functions from all the sources in the circuit to that output node. Therefore, to plot, you select a source that you want the forward conversion transfer functions to be displayed. When the source in the schematic is selected, the waveform is displayed.</p>
<p>
<a id="pgfId-1195538"></a>Note that all the short line segments are the forward conversion gain from the selected source (the LO source in the case below) to the output. None of the conversion gain terms are very high from the LO port to the output.</p>

<p>
<a id="pgfId-1263093"></a></p>
<div class="webflare-div-image">
<img width="648" height="431" src="images/Chap5-176.gif" /></div>
<h3>
<a id="pgfId-1195572"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1195573"></a>The primary application of qpxf is to measure conversion gain. Qpxf is a small-signal analysis. It calculates the small-signal conversion gain. If you need a large-signal measurement of conversion gain, then use a large-signal analysis like harmonic balance (hb) or quasi-periodic steady-state (qpss) analysis. Qpxf measures gain in a way that requires some thought for most engineers because we are so accustomed to connecting an input, driving the system, and measuring what comes out. This is the idea of qpac, where we capture the large-signal operating point in qpss, and then drive a small-signal input, and measure the mixing products that come out. If you think of this methodology, to measure the conversion gain around several harmonics usually requires a separate simulation near each harmonic.</p>
<p>
<a id="pgfId-1195574"></a>Qpxf was created to allow the measurement of the conversion gain transfer functions near all the qpss harmonics at the same time. In qpac, we had one input frequency at a time, and output mixing products at multiple output frequencies are calculated. In qpxf, we focus on one output mixing product at a time, and measure the input frequencies that will cause that output frequency, and then calculate the forward conversion gain from all those input frequencies to the single output frequency. Multiple output frequencies are usually analyzed in a single qpxf analysis. Unlike qpac where the output can be seen at every node in the circuit, qpxf calculates the gain only from all the independent sources in the circuit to the output. Thus, to measure a conversion gain, you select the source instance in the schematic from the Direct plot form instead of selecting a net.</p>
<p>
<a id="pgfId-1195575"></a>For example, imagine a mixer with an LO frequency of 1GHz and an RF signal at 900MHz. (Think easy math.) Now, imagine the down conversion case where the output is 1MHz. Given the LO frequency, inputs at 1MHz, 999MHz, 1.001GHz, 1.999GHz, 2.001GHz, 2.999GHz, 3.01GHz, and so on all cause an output at 1MHz. Signals 1MHz on either side of the RF harmonics will also convert to 1MHz, so 899MHz, 901MHz, 1799MHz, 1801MHz and so on will have conversion gain terms. There are also intermodulation products that are created by the circuit, and because there are so many conversion gain terms, it can be a bit confusing. Depending on the circuit, all those different input to output paths will have different gains from each input frequency to the output at 1MHz. In qpxf, you specify the highest qpss large signal harmonic to calculate the transfer functions from in the Maximum clock order field in the Choosing Analyses form. All these different input frequencies are called sidebands in qpxf. There is the ability to plot just the desired conversion gain terms in the Direct Plot form.</p>

<h4>
<a id="pgfId-1197085"></a>Frequency Sweep</h4>

<p>
<a id="pgfId-1197086"></a>This analysis is like xf and pxf, where the output frequency is varied. The output frequency range to be analyzed is specified in the qpxf <em>Choosing Analyses</em> form. Qpxf then calculates the conversion gain terms.</p>
<p>
<a id="pgfId-1195636"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonics in the qpss analysis. For example, assume that the qpss has signals at 1GHz and at 1.1GHz, and a log sweep is desired above the first harmonic of the 1GHz signal in the qpss analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 0 in the <em>Relative Harmonic</em> field. Next, type in 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade. The first number is the frequency shift in integer multiples of the Large signal in qpss, which is usually the LO frequency. The second number is the frequency shift in integer multiples of the RF blocker frequency. Since usually we design to mix with the first harmonic of the LO and not with the RF signal, the first number is usually either 1 or -1, and the second number is usually zero. </p>
<p>
<a id="pgfId-1195637"></a>Assuming the qpss analysis has inputs at 1GHz and 1.1GHz, and the qpxf frequency range is 1K to 100M, and the relative harmonic number is 1 0, the sweep will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1263153"></a></p>
<div class="webflare-div-image">
<img width="613" height="303" src="images/Chap5-177.gif" /></div>

<p>
<a id="pgfId-1195642"></a>To use a log sweep below the first harmonic, use the same frequency range, and type in -1 0 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1263176"></a></p>
<div class="webflare-div-image">
<img width="641" height="350" src="images/Chap5-178.gif" /></div>
<h4>
<a id="pgfId-1195647"></a>Maximum Clock Order</h4>

<p>
<a id="pgfId-1195648"></a>In qpxf terminology, the large signal from qpss is called the clock. Thus, <em>Maximum clock order</em> specifies the highest large signal harmonic number (The large signal is usually the LO signal) to calculate the conversion gain terms for. Usually, the conversion gain is only needed for a small number of LO harmonics, so when shooting is used as the qpss engine, usually <em>Maximum clock order</em> is fairly small, on the order of 3 to 5. Each conversion gain term that is calculated is called a sideband in a qpxf analysis. When harmonic balance is used for the qpss engine, the <em>Maximum clock order</em> field should be left blank, or the same as the number of LO harmonics, which does the same thing. The <em>Direct Plot Form</em> has the ability to select the individual terms that are needed.</p>
<p>
<a id="pgfId-1197292"></a>The sideband number is the qpss harmonic number that is mixed with. Because qpss always has multiple input frequencies, qpss has multiple harmonic numbers that are being mixed with. If there are two input tones in the qpss simulation, there are two numbers in qpxf that describe which harmonics of which tone are mixing to produce that output frequency. If there are three tones in the qpss analysis, then there are three numbers for each qpxf sideband.</p>
<p>
<a id="pgfId-1197301"></a>If the sideband number is negative, the input frequency is more negative than the output frequency specified in the qpxf <em>Choosing Analyses</em> form. If the sideband is positive, the input frequency is more positive than the output frequency.</p>
<p>
<a id="pgfId-1197308"></a>Although this seems complicated, there are features in the Direct Plot form to make this easier to understand.</p>

<h4>
<a id="pgfId-1195652"></a>Setting Moderate Harmonics for Accurate QPXF Results</h4>

<p>
<a id="pgfId-1197432"></a>The qpss analysis, when shooting is selected, has a minimum of 200 timepoints in each slice, so the large signal in qpss inherently has frequency domain content through the 100th harmonic of the large signal input frequency. (Usually the LO signal) Only the harmonics that are specified in the moderate tone affect the accuracy of the solution. The result of this is that the qpnoise mixing products that are produced from mixing with the large signal are almost always correct, but the mixing with the moderate signal might or might not be accurate, depending on the number of harmonics that are specified for the moderate signal, and the number of harmonics actually produced by the system. Like harmonic balance, you need to run the qpss and qpxf analyses with a number of harmonics specified for the moderate tone(s), and make the measurement in qpxf. Then increase the number of moderate harmonics, run again, and make the same measurement. If the result changed significantly, then you need more moderate harmonics. If the result did not change, you might be able to reduce the number of moderate harmonics. Use the smallest number of moderate harmonics that produce a stable qpnoise results. If the moderate signal is below compression, start with two or three harmonics on the moderate tone. If the signal is at compression, start with five harmonics. If the signal is above compression, start with seven harmonics.</p>
<p>
<a id="pgfId-1195661"></a>Qpxf is usually preferred to qpac when you need to measure the conversion gain near all the qpss harmonics.</p>
<p>
<a id="pgfId-1197819"></a>Two methods are generally used to plot the conversion gain terms. One method is to plot the terms individually from the <em>Direct Plot Form</em>. Because there are so many harmonics to mix with and so many transfer functions, this method is preferred by many. A detailed example is in the examples section.</p>
<p>
<a id="pgfId-1197826"></a>In the example below, the LO is at 1.9GHz, and the RF blocker is at 1.95GHz. The circuit is an image reject mixer with a 100MHz IF. Given this, the passband and image are at 1.8GHz and 2GHz. After the simulation has been run, in the <em>Direct Plot Form</em>, select <em>sideband</em> in the <em>Sweep</em> section. This allows individual conversion gain terms to be plotted. For the qpxf analysis, the output frequency range is 200KHz to 200MHz. Below is the <em>Direct Plot Form</em> for the low side injection transfer function. When the input frequency range is chosen, select the source in the circuit that you want the conversion gain terms for.</p>

<p>
<a id="pgfId-1263314"></a></p>
<div class="webflare-div-image">
<img width="289" height="517" src="images/Chap5-179.gif" /></div>

<p>
<a id="pgfId-1197851"></a>Below is the direct plot form for the high side injection transfer function. After the first selection, you can select <em>Replot</em>, which will take the same source as the choice for plotting.</p>

<p>
<a id="pgfId-1263358"></a></p>
<div class="webflare-div-image">
<img width="289" height="517" src="images/Chap5-180.gif" /></div>

<p>
<a id="pgfId-1197881"></a>Below are the transfer functions. Markers A and B have been placed at the passband and image frequencies.</p>

<p>
<a id="pgfId-1263377"></a></p>
<div class="webflare-div-image">
<img width="619" height="398" src="images/Chap5-181.gif" /></div>

<p>
<a id="pgfId-1197914"></a>The passband gain is 5.53dB, and the image rejection is about 63.4dB.</p>
<p>
<a id="pgfId-1198026"></a>The other method (plotting all the transfer functions at the same time) is given in the examples section.</p>
<p>
<a id="pgfId-1198617"></a>Qpxf can also be used to measure the conversion gain from the battery that supplies power to the output. All the gain and conversion gain terms should be below unity, or a potential oscillator is created. In the plot below, the gain from the bias source to the output at the IF frequency of 100MHz is about 10dB. This circuit is a potential oscillator.</p>

<p>
<a id="pgfId-1263429"></a></p>
<div class="webflare-div-image">
<img width="619" height="401" src="images/Chap5-182.gif" /></div>
<h2>
<a id="pgfId-1195714"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1195715"></a>This section jumps from the theoretical to the practical with examples of how to use the qpxf analysis we just covered. The focus is only on the qpxf Choosing Analysis form so you can see where the individual settings are made, and the qpxf options form. For examples with all the steps shown, see the examples section that follows this section.</p>

<h3>
<a id="pgfId-1195716"></a>QPXF for a Normal Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1195717"></a>Here is an example of the <em>Choosing Analyses</em> form for a normal conversion gain measurement.</p>

<p>
<a id="pgfId-1263505"></a></p>
<div class="webflare-div-image">
<img width="396" height="584" src="images/Chap5-183.gif" /></div>

<p>
<a id="pgfId-1195722"></a>Sweeptype can be relative or absolute. The default is absolute. The selection that is being used is shown to the right of the <em>Sweeptype</em> selection.</p>
<ol><li>
<a id="pgfId-1195723"></a>The frequency sweep range is always an output frequency range. It is not a sweep in the traditional sense of connecting an input, sweeping over a frequency range, and measuring the output. Instead, it is an output frequency range to be analyzed. At each output frequency in the sweep, the input frequencies that will mix with the qpss harmonics to cause that output frequency are calculated, and the forward conversion gain is also calculated.</li><li>
<a id="pgfId-1224406"></a>Linear and log spacings are provided. Generally, Auto should be avoided because it will always calculate 50 frequency points. Usually, a much smaller number is needed, so it is recommended that you set Linear or Log, and control the resolution yourself to save time.</li><li>
<a id="pgfId-1224407"></a>Although there are choices for the Sidebands selection, it is usually better to leave the setting at <em>Maximum clock order</em>. When you choose shooting as the qpss engine, and if you need a small subset of the output results, you can set a small number (like 3 or 5) in the <em>Maximum clock order</em> field. If you use harmonic balance, set <em>Maximum clock order</em> to the same number you used to set the LO harmonics in qpss, or leave the field blank, which accomplishes the same thing. In either case, you can use the <em>Direct Plot Form</em> to select just the results you want. </li><li>
<a id="pgfId-1198818"></a>Run the simulation, and make the measurement in qpxf. Now increase the number of moderate harmonics by about 50% and run again. If the qpxf result changed significantly, then you need more harmonics on the moderate tone (or tones) in qpss. If it did not change, use the smallest number of harmonics that results in an stable measurement.</li><li>
<a id="pgfId-1195726"></a>The output can measure either a voltage or a current. The voltage measurement is the default. Specify the output node or nodes in the circuit. If the output is a current select probe for the output, add an iprobe from analogLib (a current probe) in series with the output in the schematic, and specify the instance name in the <em>Output Probe Instance</em> field in the <em>Choosing Analyses</em> form.</li></ol>





<h3>
<a id="pgfId-1195765"></a>QPXF Op<a id="qpxf_options"></a>tions</h3>

<p>
<a id="pgfId-1195769"></a>Below is the options form.</p>

<p>
<a id="pgfId-1263571"></a></p>
<div class="webflare-div-image">
<img width="355" height="538" src="images/Chap5-184.gif" /></div>

<p>
<a id="pgfId-1198897"></a>None of the qpxf options are commonly used.</p>

<h4>
<a id="pgfId-1199116"></a>tolerance</h4>

<p>
<a id="pgfId-1199117"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1199118"></a>Qpxf uses an iterative solver to calculate the conversion gain terms. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough. and The tolerance option specifies that accuracy for qpxf. For shooting, the default tolerance is 1e-9. When HB is the qpss engine, the default is 1e-6.</p>

<h4>
<a id="pgfId-1199205"></a>gear_order</h4>

<p>
<a id="pgfId-1199206"></a>Do not change this option.</p>

<h4>
<a id="pgfId-1199228"></a>solver</h4>

<p>
<a id="pgfId-1199229"></a>The default solver is the turbo solver.</p>
<p>
<a id="pgfId-1199230"></a>When hb is used as the engine in qpss, leave this option at the default.</p>
<p>
<a id="pgfId-1199231"></a>When shooting is used, sometimes when the qpxf input frequency is very close to the frequency of one of the harmonics in the qpss, warning messages will appear in the qpxf output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the qpss, but which takes longer to run than the <em>turbo</em> solver.</p>

<h4>
<a id="pgfId-1199274"></a>resgmrescycle</h4>

<p>
<a id="pgfId-1199275"></a>Leave this option at the default. </p>

<h4>
<a id="pgfId-1195779"></a>hbprecond_solver </h4>
<h4>
<a id="pgfId-1195780"></a>This option is only available only when harmonic balance is selected in qpss and APS is used.</h4>

<p>
<a id="pgfId-1195781"></a>The basic solver is the only solver available in standard Spectre. Autoset is the default solver when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window. If you have stagnation, it will save a small amount of time to set this option to <em>basicsolver</em>.</p>

<h4>
<a id="pgfId-1199412"></a>annotate</h4>

<p>
<a id="pgfId-1199413"></a>This option controls the level of detail in the Spectre output log. No detail is provided when you select <em>no</em>, while more details are provided as you move towards right with steps option providing maximum detail.</p>

<h4>
<a id="pgfId-1199414"></a>stimuli</h4>

<p>
<a id="pgfId-1199415"></a>This option is not implemented at the current time.</p>

<h4>
<a id="pgfId-1195782"></a>freqaxis</h4>

<p>
<a id="pgfId-1195783"></a><em>freqaxis</em> specifies whether you want to see the negative frequency axis or not.</p>
<p>
<a id="pgfId-1195784"></a>The qpxf analysis calculates the input frequencies and forward conversion gain, so <em>in </em>and <em>absin</em> are reasonable choices. <em>in </em>displays the negative frequency axis. <em>absin</em> (absolute value of the input) displays positive input frequencies. This is the default.</p>

<h4>
<a id="pgfId-1195831"></a>save</h4>

<p>
<a id="pgfId-1195832"></a>This option is not implemented at the current time.</p>

<h4>
<a id="pgfId-1195833"></a>nestlvl</h4>

<p>
<a id="pgfId-1195834"></a>This option is not implemented at the current time.</p>

<h4>
<a id="pgfId-1195836"></a>additionalParams</h4>

<p>
<a id="pgfId-1195837"></a><em>additionalParams</em> is typically used for new features that are being beta tested. Keyword=value pairs are expected in this field. An example is <code>solver=std</code>.</p>
<p>
<a id="pgfId-1195838"></a>For more information about the other options, type <code>spectre -h qpxf</code> at the command prompt in a Unix shell window.</p>

<h3>
<a id="pgfId-1199759"></a>Example</h3>

<p>
<a id="pgfId-1199769"></a>Note that for this application, harmonic balance is likely faster than shooting. If you plan on using harmonic balance, please use the hb and hbnoise analyses to measure the transfer functions. Hbnoise has hbxf integrated into the noise measurement. The hb and hbnoise Choosing Analyses forms always have the latest harmonic balance features.</p>
<p>
<a id="pgfId-1200126"></a>Consider the LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1263648"></a></p>
<div class="webflare-div-image">
<img width="587" height="575" src="images/Chap5-185.gif" /></div>

<ol><li>
<a id="pgfId-1199786"></a>The input port has variable names to set the values of the frequency and amplitude. This is suggested so these terms can be easily changed in the ADE Explorer environment without needing to change the schematic.<br />
<a id="pgfId-1263676"></a><div class="webflare-div-image">
<img width="451" height="758" src="images/Chap5-186.gif" /></div></li><li>
<a id="pgfId-1199797"></a>The variables are set in ADE Explorer.</li><li>
<a id="pgfId-1199874"></a>The LO is at 2.4GHz and the RF blocker is at 2.5GHz.<br />
<a id="pgfId-1263742"></a><div class="webflare-div-image">
<img width="664" height="531" src="images/Chap5-187.gif" /></div></li><li>
<a id="pgfId-1199854"></a>First, a qpss analysis needs to be set up. For more information, see the qpss section at the beginning of this chapter.<br />
<a id="pgfId-1263766"></a><div class="webflare-div-image">
<img width="384" height="755" src="images/Chap5-188.gif" /></div></li><li>
<a id="pgfId-1199895"></a>Now set up the qpxf form. <br />
<a id="pgfId-1263810"></a><div class="webflare-div-image">
<img width="386" height="592" src="images/Chap5-189.gif" /></div></li><li>
<a id="pgfId-1199902"></a>Choose an appropriate output frequency range to analyze for your circuit. This frequency range is wider than usual so the conversion gain curves can be easily seen in the waveform tool.</li><li>
<a id="pgfId-1199916"></a>Usually, it is better to select Linear or Log spacing, and define your own sweep. Automatic usually takes more points than needed, and this extends the runtime.</li><li>
<a id="pgfId-1199923"></a>Set <em>Maximum clock order</em> as appropriate for your needs. In this case, mixing product that mix with the third harmonic and lower of the LO are calculated. If you use the harmonic balance engine in qpss, the <em>Maximum clock order</em> field should either be left blank, or should be set to the same number of LO harmonics in the qpss analysis. Both methods accomplish the same thing.</li><li>
<a id="pgfId-1199930"></a>Choose an output node in the circuit. If your circuit has an output current, add an iprobe (current probe) from analogLib in series with the output current, and specify it in the <em>Output</em> section.</li><li>
<a id="pgfId-1199937"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> appears.<br />
<a id="pgfId-1263866"></a><div class="webflare-div-image">
<img width="333" height="532" src="images/Chap5-190.gif" /></div></li><li>
<a id="pgfId-1200007"></a>To plot individual conversion gain terms, select <em>sideband</em> in the <em>Sweep</em> section.</li><li>
<a id="pgfId-1200425"></a>Select the input frequency range you want to plot in the <em>Input Sideband</em> section.</li><li>
<a id="pgfId-1200493"></a>If you want this measurement to plot automatically after subsequent simulations, select <em>Add To Outputs</em> at the bottom of the <em>Direct Plot Form</em>. In this example, it was not selected.</li><li>
<a id="pgfId-1199951"></a>Click the desired source in the schematic for the gain measurement. For the plot below, the input port was selected. To measure the conversion gain, move your mouse cursor to the input frequency, and type m to place a marker. The conversion gain at 2.45GHz input frequency is about 18dB.<br />
<a id="pgfId-1263937"></a><div class="webflare-div-image">
<img width="667" height="490" src="images/Chap5-191.gif" /></div></li><li>
<a id="pgfId-1199965"></a>There are also mixing terms from mixing with the RF blocker signal as well. When the output frequency is near zero to 400MHz, the input frequency is from 2.1GHz to nearly 2.5GHz. Select that term from the <em>Direct Pot Form</em>, and if you still want the gain from the input source, select <em>Replot</em>.<br />
<a id="pgfId-1263996"></a><div class="webflare-div-image">
<img width="314" height="538" src="images/Chap5-192.gif" /></div></li><li>
<a id="pgfId-1200513"></a>If you want this measurement to plot automatically after subsequent simulations, select <em>Add To Outputs</em> at the bottom of the <em>Direct Plot Form</em>. In this example, it was not selected.</li><li>
<a id="pgfId-1199979"></a>The conversion gain from mixing with the RF input is quite small.<br />
<a id="pgfId-1264046"></a>.<div class="webflare-div-image">
<img width="664" height="462" src="images/Chap5-193.gif" /></div></li><li>
<a id="pgfId-1199993"></a>All of the conversion gain terms can also be plotted. To do this, select <em>spectrum</em> in the <em>Sweep</em> section.<br />
<a id="pgfId-1264084"></a><div class="webflare-div-image">
<img width="318" height="408" src="images/Chap5-194.gif" /></div></li><li>
<a id="pgfId-1200561"></a>If you want this measurement to plot automatically after subsequent simulations, select <em>Add To Outputs</em> at the bottom of the <em>Direct Plot Form</em>. In this example, it was not selected.</li><li>
<a id="pgfId-1200028"></a>All of the conversion gain terms are plotted.<br />
<a id="pgfId-1264129"></a><div class="webflare-div-image">
<img width="666" height="456" src="images/Chap5-195.gif" /></div></li><li>
<a id="pgfId-1241288"></a>There are a lot of conversion gain terms because there are a lot of harmonics to mix with.</li><li>
<a id="pgfId-1200596"></a>Now the waveform window is zoomed in to the part of the output where the gain is larger than -100dB. Select one of the curves. It highlights.<br />
<a id="pgfId-1264178"></a><div class="webflare-div-image">
<img width="665" height="473" src="images/Chap5-196.gif" /></div></li><li>
<a id="pgfId-1200056"></a>The sideband number is 1 0. The output frequency from the <em>Choosing Analyses</em> form is 1KHz to 400MHz. The first number is the frequency shift from output to input in multiples of the LO frequency. The second number is the frequency shift in multiples of the RF blocker frequency. The input signal can mix with any of the harmonics the system produces. 1 0 means that the input is mixing with the first harmonic of the LO and not with the RF input. Positive numbers mean that the input frequency is more positive than the output frequency. so, in this case, the input frequency is 1KHz to 400MHz + (1 * LO frequency of 2.4GHz) = 2.4+ GHz to 2.8GHz.</li><li>
<a id="pgfId-1200063"></a>Below, the 1 -2 sideband is selected. The input mixes with the first harmonic of the LO and the second harmonic of the RF. 1KHz to 400MHz + (1 * 2.4GHz) + (-2 * 2.5GHz) = -2.59999GHz to -2.2GHz. By default, this is reflected up into the positive frequency domain.<br />
<a id="pgfId-1264213"></a><div class="webflare-div-image">
<img width="642" height="455" src="images/Chap5-197.gif" /></div></li><li>
<a id="pgfId-1200078"></a>It is always suggested that you check the conversion gain from the power supply to the output to see if there are any mixing paths that have greater than unity gain. To measure these conversion gain terms, select the DC source in the schematic that supplies power to the circuit. In this case, all the conversion gain terms are less than unity.<br />
<a id="pgfId-1264258"></a><div class="webflare-div-image">
<img width="637" height="368" src="images/Chap5-198.gif" /></div></li><li>
<a id="pgfId-1200092"></a>Note that finding a gain path like this in the lab is extremely difficult. This is one of the benefits of simulation.</li></ol>














































































<h3>
<a id="pgfId-1224989"></a>Conversion Gain as a Function of Blocker Power</h3>

<p>
<a id="pgfId-1225147"></a>Consider the LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1264288"></a></p>
<div class="webflare-div-image">
<img width="665" height="577" src="images/Chap5-199.gif" /></div>

<ol><li>
<a id="pgfId-1225148"></a>The input port has variable names to set the values of the frequency and amplitude. This is suggested so these terms can be easily changed in the ADE Explorer environment without needing to change the schematic.<br />
<a id="pgfId-1264313"></a><div class="webflare-div-image">
<img width="500" height="821" src="images/Chap5-200.gif" /></div></li><li>
<a id="pgfId-1225156"></a>The variables are set in ADE Explorer.</li><li>
<a id="pgfId-1225162"></a>The LO is at 2.4GHz and the RF blocker is at 2.45GHz.<br />
<a id="pgfId-1264396"></a><div class="webflare-div-image">
<img width="664" height="511" src="images/Chap5-201.gif" /></div></li><li>
<a id="pgfId-1225163"></a>First, a qpss analysis needs to be set up. Specify a sweep of blocker power that is suitable for your system. For more information, see the qpss section at the beginning of this chapter.<br />
<a id="pgfId-1264468"></a><div class="webflare-div-image">
<img width="399" height="764" src="images/Chap5-202.gif" /></div></li><li>
<a id="pgfId-1225170"></a>Now set up the qpxf form, as show below.<br />
<a id="pgfId-1264582"></a><div class="webflare-div-image">
<img width="391" height="600" src="images/Chap5-203.gif" /></div></li><li>
<a id="pgfId-1225171"></a>The <em>Output Frequency Sweep Range</em> is set to <em>Single-Point</em> when a sweep is performed in qpss. Set the desired output frequency in the <em>Freq</em> field.</li><li>
<a id="pgfId-1225173"></a>Set <em>Maximum clock order</em> as appropriate for your needs. In this case, mixing product that mix with the third harmonic and lower of the LO are calculated. If you are using the harmonic balance engine in qpss, this should be set to the number of LO harmonics in the qpss analysis, or left blank, which does the same thing.</li><li>
<a id="pgfId-1225174"></a>Choose an output node in the circuit. If your circuit has an output current, add an iprobe (current probe) from analogLib in series with the output current, and specify it in the <em>Output</em> section.</li><li>
<a id="pgfId-1225175"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1264636"></a><div class="webflare-div-image">
<img width="313" height="528" src="images/Chap5-204.gif" /></div></li><li>
<a id="pgfId-1225182"></a>Select <em>variable</em> from the <em>Sweep</em> section.</li><li>
<a id="pgfId-1264689"></a>Select the input frequency range you want to plot in the <em>Input Sideband</em> section. Note that the <em>Input sideband</em> field is labeled incorrectly as <em>Output Harmonic</em>.</li><li>
<a id="pgfId-1264690"></a>If you want this measurement to plot automatically after subsequent simulations, click <em>Add To Outputs</em> at the bottom of the <em>Direct Plot Form</em>. In this example, it was not selected.</li><li>
<a id="pgfId-1225185"></a>Click the desired source in the schematic for the gain measurement. For the plot below, the input port was selected.<br />
<a id="pgfId-1264751"></a><div class="webflare-div-image">
<img width="582" height="376" src="images/Chap5-205.gif" /></div></li><li>
<a id="pgfId-1226278"></a>As expected, the conversion gain drops with blocker power.</li></ol>






































<h2>
<a id="pgfId-1202524"></a>QPSP Ana<a id="qpsp"></a>lysis</h2>

<p>
<a id="pgfId-1201594"></a>In order to run qpsp, a qpss analysis needs to be run first. For many applications, qpss will run much faster using the harmonic balance engine. If you want to use harmonic balance, instead of using the qpss and qpsp <em>Choosing Analyses</em> forms, use the hb and hbsp forms instead. The hb form always has the latest harmonic balance features in it, and the qpss form usually does not.</p>
<p>
<a id="pgfId-1203054"></a>Please see the section in Chapter 4 on psp analysis. Qpsp is just like psp. The only difference is that instead of running after a pss analysis, it runs after a qpss analysis. Conceptually, the only difference is that in qpss, there are many more harmonics, and because of that there may be mixing paths from the input frequency to the output frequency by mixing with different harmonics. This will be shown in the example below.</p>
<p>
<a id="pgfId-1202531"></a>Qpsp is provided to measure S-Parameters for circuits that translate frequencies. All the basic assumptions of S-Parameters apply to qpsp, with the addition of having different input and output frequencies. Qpsp can be used for up or down-conversion applications.</p>

<h3>
<a id="pgfId-1201595"></a>Example: Down-Conversion Diode Mixer</h3>

<p>
<a id="pgfId-1201599"></a>Consider the double-balanced diode mixer circuit below:</p>

<p>
<a id="pgfId-1264804"></a></p>
<div class="webflare-div-image">
<img width="661" height="569" src="images/Chap5-206.gif" /></div>

<p>
<a id="pgfId-1201601"></a>The input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. This allows changes in frequency or amplitude from the ADE Explorer environment without needing to change the schematic itself.</p>
<p>
<a id="pgfId-1201605"></a>The property list is shown below.</p>

<p>
<a id="pgfId-1264843"></a></p>
<div class="webflare-div-image">
<img width="478" height="800" src="images/Chap5-207.gif" /></div>

<p>
<a id="pgfId-1202768"></a>The same strategy is used for the LO port.</p>

<p>
<a id="pgfId-1264888"></a></p>
<div class="webflare-div-image">
<img width="426" height="748" src="images/Chap5-208.gif" /></div>

<p>
<a id="pgfId-1201608"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> -&gt; <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type in the desired value, and press <em>Enter. </em>When you have set the variables, if you want to add the values back into the cellview, in the ADE Explorer window, select <em>Variables</em> - <em>Copy To Cellview</em>, and then perform a <em>Check and Save</em> in the schematic</p>

<p>
<a id="pgfId-1285253"></a>.</p>
<div class="webflare-div-image">
<img width="660" height="424" src="images/Chap5-209.gif" /></div>

<p>
<a id="pgfId-1201613"></a>The first RF input is at 900MHz, the second RF input frequency is disabled (by setting the frequency to zero), and the LO is at 1GHz with a 1.4 volt peak signal. This is +13 dBm, which is a common drive level for a diode mixer.</p>
<p>
<a id="pgfId-1201614"></a>The basic strategy is to apply the signals that cause the nonlinearity in the qpss analysis, and then measure the frequency-shifted S-Parameters using qpsp. Doing this allows measuring the input match at the input frequency, and the output match at the output frequency in the same analysis. For the forward and reverse gain terms, the specified frequency translation is taken into account.</p>
<p>
<a id="pgfId-1201616"></a>The qpss analysis needs to be set up first. The example below shows the LO input at 1GHz with 10 harmonics and the RF blocker input with 5 harmonics. For more information, see the qpss section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1264990"></a></p>
<div class="webflare-div-image">
<img width="363" height="712" src="images/Chap5-210.gif" /></div>

<p>
<a id="pgfId-1201622"></a>Next, the qpsp analysis needs to be set up. The frequency range depends on your application, and can be either an input frequency range, or an output frequency range. This is the input frequency range just above the LO frequency. The actual frequency for each port-frequency definition will be set up later.</p>

<p>
<a id="pgfId-1265059"></a></p>
<div class="webflare-div-image">
<img width="365" height="693" src="images/Chap5-211.gif" /></div>

<p>
<a id="pgfId-1201626"></a>Start with Port 1. In the <em>Port #</em> column field, type 1. In the <em>Name </em>column field, either type the instance name, or use the <em>Select Port</em> button just below the edit line to select the port in the circuit. In this case, Port 1 is the RF port.</p>

<p>
<a id="pgfId-1265143"></a></p>
<div class="webflare-div-image">
<img width="363" height="686" src="images/Chap5-212.gif" /></div>

<p>
<a id="pgfId-1201627"></a>Now click <em>Choose Harmonic</em>. In the <em>Choose Harmonic</em> window, select the frequency range you want associated with that port number. For the down-conversion application, The input is just above the LO frequency of 1GHz.</p>

<p>
<a id="pgfId-1265182"></a></p>
<div class="webflare-div-image">
<img width="365" height="251" src="images/Chap5-213.gif" /></div>

<p>
<a id="pgfId-1202951"></a>Note that there are multiple instances at the same input frequency range. This is because there are mixing paths using different harmonics that produce the same frequency range. Choose the entry where the sum of the absolute value of the indices is smallest. In this case, 0 + 0 = 0, and 4 + 2 = 6. Zero is less than six, so that is the entry that is chosen.</p>
<p>
<a id="pgfId-1202969"></a>Like the other qpxx analyses, the sideband number displays the frequency shift for each input in multiples of the input frequency. In other words, a signal can mix with different harmonics of the input to provide an output. </p>
<p>
<a id="pgfId-1202976"></a>In this case, 0 0, means do not mix with anything. The center frequency is 1.1GHz. For the other term, 1.1GHz -4*(1GHz) +2*900MHz = -1.1GHz. The default is to reflect this term to the positive frequency domain. The -4 2 term mixes down with the fourth harmonic of the LO and up with the second harmonic of the RF blocker.</p>
<p>
<a id="pgfId-1202932"></a>Click <em>OK</em>.</p>
<p>
<a id="pgfId-1201631"></a>Click <em>Add</em> to the right of the <em>Choose Harmonic</em> button. This adds that port and frequency definition to the list for the analysis. By convention, port 1 defines the input frequency.</p>

<p>
<a id="pgfId-1265238"></a></p>
<div class="webflare-div-image">
<img width="405" height="686" src="images/Chap5-214.gif" /></div>

<p>
<a id="pgfId-1201637"></a>Note that port 1 is now the input port at the input frequency range of 1.05GHz to 1.15GHz. A single port definition in qpsp has both a port name and a frequency definition.</p>
<p>
<a id="pgfId-1203178"></a>In qpsp, multiple port and frequency definitions can be run at one time.</p>
<p>
<a id="pgfId-1201638"></a>The next step is to measure RF to IF conversion gain. Type <em>2</em> in the <em>Port #</em> column field. Click the <em>Select Port</em> button, and select the IF port.</p>

<p>
<a id="pgfId-1265303"></a></p>
<div class="webflare-div-image">
<img width="363" height="686" src="images/Chap5-215.gif" /></div>

<p>
<a id="pgfId-1201643"></a>Now define the frequency range for that port. Click <em>Choose Harmonic</em>, and select the IF frequency from the list. Next, click <em>OK</em>.</p>

<p>
<a id="pgfId-1265341"></a></p>
<div class="webflare-div-image">
<img width="365" height="253" src="images/Chap5-216.gif" /></div>

<p>
<a id="pgfId-1203263"></a>Again, there are multiple entries at the same frequency from multiple mixing paths. Taking the center frequency of 1.1GHz, then one term is 1.1G - 1 * 1G = 100M. The other term is 1.1G -3 * 1G + 2 * 900M = -100MHz</p>
<p>
<a id="pgfId-1203270"></a>Take the entry where the sum of the absolute values of the indices is smaller.</p>
<p>
<a id="pgfId-1201647"></a>Click the <em>Add</em> button to the right of the <em>Choose Harmonic</em> button. The second port-frequency definition is added to the list. By convention, port 2 defines the output frequency range.</p>

<p>
<a id="pgfId-1265399"></a></p>
<div class="webflare-div-image">
<img width="363" height="686" src="images/Chap5-217.gif" /></div>

<p>
<a id="pgfId-1201652"></a>Now measure the RF to IF isolation. Type 3 in the <em>Port #</em> column field. Click <em>Select Port</em>, and again select the IF output port. Click <em>Choose Harmonic</em>, and select the input frequency range. Click <em>OK</em>. Once again, there are multiple entries at the same frequency from multiple mixing paths. Take the entry where the sum of the absolute values of the indices is smaller.</p>

<p>
<a id="pgfId-1265447"></a></p>
<div class="webflare-div-image">
<img width="357" height="269" src="images/Chap5-218.gif" /></div>

<p>
<a id="pgfId-1201656"></a>Click <em>Add</em> to the right of the <em>Choose Harmonic</em> button. The third port-frequency definition is added.</p>

<p>
<a id="pgfId-1265535"></a></p>
<div class="webflare-div-image">
<img width="363" height="686" src="images/Chap5-219.gif" /></div>

<p>
<a id="pgfId-1201660"></a>Make sure all the port definitions are in the list. It is easy to forget to add the last port.</p>
<p>
<a id="pgfId-1203421"></a>With the above port-frequency definitions, S11 measures the input match at the RF frequency. S22 measures the output match at the IF frequency. S31 measures the RF to IF isolation, and S21 measures the RF to IF conversion gain.</p>
<p>
<a id="pgfId-1203503"></a>Once the analyses are set up, the simulation can be run. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1203508"></a>The example below shows a typical <em>Direct Plot Form</em>.</p>

<p>
<a id="pgfId-1265584"></a></p>
<div class="webflare-div-image">
<img width="304" height="635" src="images/Chap5-220.gif" /></div>

<p>
<a id="pgfId-1203509"></a>If you click <em>Add To Outputs</em>, an expression is entered under the Maestro tab of the ADE Explorer window so that the next time you simulate your circuit, this measurement plots automatically.</p>
<p>
<a id="pgfId-1201671"></a>Here are the S11, S21, S31, and S33 plots.</p>

<p>
<a id="pgfId-1265637"></a>.</p>
<div class="webflare-div-image">
<img width="664" height="482" src="images/Chap5-221.gif" /></div>

<p>
<a id="pgfId-1203943"></a>The conversion power loss is about 6.5dB. The input match is about -8dB. The output match is about -9.9dB. The RF to IF isolation is about -6.5dB.</p>
<p>
<a id="pgfId-1201672"></a>Because <em>Add to outputs</em> was selected in the <em>Direct Plot Form</em> as shown previously, ADE Explorer now has expressions that will plot automatically on subsequent simulations.</p>

<p>
<a id="pgfId-1265690"></a></p>
<div class="webflare-div-image">
<img width="661" height="432" src="images/Chap5-222.gif" /></div>

<p>
<a id="pgfId-1203640"></a>Note that these can be plotted on a Smith Chart as well. The Smith Chart capability is only available from the <em>Direct Plot Form</em>. Expressions under the Maestro tab of ADE Explorer will always plot on a rectangular plot. The Smith chart has not been shown because this circuit is inherently very wide band. The curve on the Smith Chart would be tiny. An example using a Smith Chart is shown later on in the Examples section.</p>
<p>
<a id="pgfId-1201673"></a>Qpsp can be used for up conversion as well. To do that, just change the frequency definitions for the ports. Since IF to RF gain is usually not needed, only a 2 port measurement has been set up. Note the frequency difference for Ports 1 and 2.</p>

<p>
<a id="pgfId-1265733"></a></p>
<div class="webflare-div-image">
<img width="364" height="689" src="images/Chap5-223.gif" /></div>

<p>
<a id="pgfId-1247590"></a>Note that the <em>Frequency Sweep Range</em> did not change. Only the frequency definitions for the two ports changed. With the above port-frequency definitions, S11 measures the input match at the low frequency.</p>
<p>
<a id="pgfId-1204044"></a>S22 measures the output match at the upconverted frequency. S21 measures the small-signal conversion gain from low to high frequency.</p>
<p>
<a id="pgfId-1247649"></a>Now run the analysis. S11, S21, and S22 are plotted below. The conversion power loss is about 6.5dB. The input match is about -8dB. The output match is about -9.9dB.</p>

<p>
<a id="pgfId-1265806"></a></p>
<div class="webflare-div-image">
<img width="528" height="422" src="images/Chap5-224.gif" /></div>

<p>
<a id="pgfId-1203706"></a>Note that the frequency range on the X Axis of the plot changed. This is because the input frequency changed, and by default, the input frequency is shown on the waveform plot X Axis.</p>

<h3>
<a id="pgfId-1201689"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1201690"></a>Qpsp is similar to sp in that power gain measurements are made. Sp is based on the DC operating point, so it can only produce results that are linear. All the frequencies are the same for all the S-Parameter measurements.</p>
<p>
<a id="pgfId-1201691"></a>Qpsp uses the qpss analysis results as the basis for making the S-Parameter measurement. Because the qpss result is the operating point solution for qpsp, the input can mix with any of the harmonics that are present in the qpss analysis for the frequency-translated terms. The term SXX is not enough to describe the measurement. We need not only port numbers and names, but also the frequency needs to be defined for each port definition.</p>
<p>
<a id="pgfId-1201692"></a>In the example in the preceding section, the LO was at 1GHz and the RF input was at 900MHz. The specified frequency for qpsp was just above the first harmonic of the LO. In the qpsp definition for each port, both the port name and the frequency that is associated with that measurement need to be defined.</p>
<p>
<a id="pgfId-1201693"></a>Only the S-Parameters and the noise calculations are available for plotting in qpsp. Stability factors like Kf and the other calculations associated with sp like Gamma-Min are not available in qpsp.</p>
<p>
<a id="pgfId-1201694"></a>Noise analysis is available in qpsp, and is the same as pnoise. Since very few people use qpsp for noise measurements, it is not covered in this section. Please see the pnoise or hbnoise chapter for noise information.</p>

<h4>
<a id="pgfId-1201695"></a>Setting Harmonics and moderate Sidebands</h4>

<p>
<a id="pgfId-1201697"></a>In the qpss analysis, when shooting is selected, each slice of the Large signal (usually the LO signal) has a minimum of 200 timepoints, so it inherently has frequency domain content through the 100th harmonic of the signal in each slice. Only the harmonics specified for the moderate tones affect the accuracy of the qpss solution. If you specify enough harmonics in the moderate tones in the qpss analysis to accurately capture the circuit performance, then the qpsp solution will be accurate.</p>
<p>
<a id="pgfId-1204096"></a>To see if you have enough moderate tones, set a number of moderate harmonics, and run the simulation. Make the measurement. Now increase the number of moderate harmonics by about 50%. Run again, and make the same measurement. If the measurement did not change significantly, you had enough moderate harmonics to begin with, and you might be able to reduce the number of moderate harmonics. If it did change, then you need more moderate harmonics. If your moderate signal is below compression, start with two or three harmonics. If the moderate signal is at compression, start with five harmonics. If the moderate signal is above compression, start with about seven harmonics.</p>

<h2>
<a id="pgfId-1201702"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1201703"></a>This section jumps from theoretical to the practical with examples of how to use qpsp. The focus is only on the qpsp <em>Choosing Analyses</em> form so you can see where the individual settings are made. To see examples with all the steps shown, see the examples section that follows this section.</p>

<h3>
<a id="pgfId-1201704"></a>QPSP Setup</h3>

<p>
<a id="pgfId-1201708"></a>For this example, consider an LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1265869"></a></p>
<div class="webflare-div-image">
<img width="664" height="577" src="images/Chap5-225.gif" /></div>

<ol><li>
<a id="pgfId-1201709"></a>First, define either an input or output frequency range in the <em>Frequency Sweep Range</em> fields. It is usually easier to define an input frequency range, as shown below for a 2.4GHz application.<br />
<a id="pgfId-1265919"></a><div class="webflare-div-image">
<img width="385" height="686" src="images/Chap5-226.gif" /></div></li><li>
<a id="pgfId-1201716"></a>Linear and log sweeps are provided. It is usually better to select Linear or Log, and specify the number of steps instead of using automatic. Automatic will run 50 frequency points, which usually is not needed for most applications.</li><li>
<a id="pgfId-1201720"></a>Now port and frequency definitions need to be made.</li><li>
<a id="pgfId-1227285"></a>Type 1 in the Port # column field. Click <em>Select Port</em>, and select the input port.<br />
<a id="pgfId-1265978"></a><div class="webflare-div-image">
<img width="411" height="687" src="images/Chap5-227.gif" /></div></li><li>
<a id="pgfId-1227291"></a>Click <em>Choose Harmonic</em>. In the window that appears, select the input frequency range. Now select <em>OK</em>.<br />
<a id="pgfId-1266031"></a><div class="webflare-div-image">
<img width="402" height="250" src="images/Chap5-228.gif" /></div></li><li>
<a id="pgfId-1201726"></a>Click Add. The port-frequency combination is added to the list. By convention, port 1 sets the input frequency for qpsp.<br />
<a id="pgfId-1266072"></a><div class="webflare-div-image">
<img width="417" height="689" src="images/Chap5-229.gif" /></div></li><li>
<a id="pgfId-1201735"></a>Now define the output port as port 2.<br />
<a id="pgfId-1266127"></a><div class="webflare-div-image">
<img width="427" height="687" src="images/Chap5-230.gif" /></div></li><li>
<a id="pgfId-1201736"></a>Select the output frequency range by clicking <em>Choose Harmonic</em>, and selecting the output frequency range as shown below.<br />
<a id="pgfId-1266200"></a><div class="webflare-div-image">
<img width="391" height="250" src="images/Chap5-231.gif" /></div></li><li>
<a id="pgfId-1201740"></a>Next, click <em>Add</em>. This adds the port/frequency combination as port 2 in the list. By convention, port 2 sets the output frequency.<br />
<a id="pgfId-1266244"></a><div class="webflare-div-image">
<img width="451" height="689" src="images/Chap5-232.gif" /></div></li><li>
<a id="pgfId-1201744"></a>If necessary, repeat the process to define port 3 as the gain from RF to IF with no frequency translation. (The RF to IF isolation.)<br />
<a id="pgfId-1266314"></a><div class="webflare-div-image">
<img width="440" height="686" src="images/Chap5-233.gif" /></div></li><li>
<a id="pgfId-1201748"></a>If you want a noise simulation, define the <em>Maximum Sideband</em> term above. For more information, see the pnoise section in this chapter.<br />
<a id="pgfId-1266390"></a><div class="webflare-div-image">
<img width="444" height="692" src="images/Chap5-234.gif" /></div></li></ol>













































<h3>
<a id="pgfId-1205186"></a>QPSP Op<a id="qpsp_options"></a>tions</h3>

<p>
<a id="pgfId-1205187"></a>Below is the qpsp options form.</p>

<p>
<a id="pgfId-1266434"></a></p>
<div class="webflare-div-image">
<img width="349" height="539" src="images/Chap5-235.gif" /></div>

<p>
<a id="pgfId-1205211"></a>None of the options are commonly used.</p>

<h4>
<a id="pgfId-1205270"></a>tolerance</h4>

<p>
<a id="pgfId-1205271"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1205272"></a>Qpsp uses an iterative solver to calculate the S-Parameter measurements. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough. The tolerance option specifies that accuracy for qpsp. For shooting, the default tolerance is 1e-9. For circuits where HB is the qpss engine, the default is 1e-6.</p>

<h4>
<a id="pgfId-1205293"></a>gear_order</h4>

<p>
<a id="pgfId-1205294"></a>Do not change this option.</p>

<h4>
<a id="pgfId-1205188"></a>solver</h4>

<p>
<a id="pgfId-1201758"></a>The default solver is the turbo solver.</p>
<p>
<a id="pgfId-1201759"></a>When hb is used as the engine in qpss, leave this option at the default.</p>
<p>
<a id="pgfId-1201760"></a>When shooting is used, sometimes when the qpsp analysis frequency is very close to the frequency of one of the harmonics in the qpss analysis, warning messages will appear in the qpsp output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the qpss, but which takes longer to run than the turbo solver.</p>

<h4>
<a id="pgfId-1205386"></a>resgmrescycle</h4>

<p>
<a id="pgfId-1205387"></a>Leave this option at the default. For the resgmres linear solver, there are several different options.</p>

<h4>
<a id="pgfId-1201766"></a>hbprecond_solver </h4>
<h4>
<a id="pgfId-1201767"></a>This option is available only when harmonic balance selected in qpss and APS is used.</h4>

<p>
<a id="pgfId-1201768"></a>The basic solver is the only solver available in standard Spectre when harmonic balance is selected. Autoset is the default solver in harmonic balance when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window. If you have stagnation, it will save a small amount of time to set this option to basicsolver.</p>

<h4>
<a id="pgfId-1201785"></a>annotate</h4>

<p>
<a id="pgfId-1201786"></a>This option controls the level of detail in the Spectre output log. No detail is provided when you select no, while more details are provided as you move towards right with steps option providing maximum detail.</p>

<h4>
<a id="pgfId-1201787"></a>freqaxis</h4>

<p>
<a id="pgfId-1201788"></a>Qpsp displays all the results on the same frequency scale. The default is absin (absolute value of the input frequency). If there is a negative input frequency, in will show that frequency on the positive frequency axis. The selection In also shows the input frequency, but if the input frequency is negative, it will be shown on a negative frequency axis. The selection Out shows the output frequency range. If the output frequency is negative, it will show on a negative frequency axis.</p>

<h4>
<a id="pgfId-1288541"></a>file</h4>

<p>
<a id="pgfId-1288542"></a>Outputs S-parameter data into the specified file.</p>

<h4>
<a id="pgfId-1288543"></a>datafmt</h4>

<p>
<a id="pgfId-1288544"></a>Specifies the data format of the S-parameter output file. Possible values are <em>spectre</em>, <em>touchstone</em>, and <em>touchstone2</em>. The default value is <em>spectre</em>.</p>

<h4>
<a id="pgfId-1288545"></a>datatype</h4>

<p>
<a id="pgfId-1288546"></a>Specifies the data type of the S-parameter output file. Possible values are <em>realimag</em>, <em>magphase</em>, and <em>dbphase</em>. The default value is <em>realimag</em>.</p>

<h4>
<a id="pgfId-1201789"></a>additionalParams</h4>

<p>
<a id="pgfId-1201790"></a><em>additionalParams</em> is typically used for new features that are being beta tested. Keyword=value pairs are expected in this field.</p>
<p>
<a id="pgfId-1201791"></a>For more information about the other options, type <code>spectre -h qpsp</code> at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1201793"></a>Examples</h2>

<p>
<a id="pgfId-1201797"></a>For this example, consider an LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1266490"></a></p>
<div class="webflare-div-image">
<img width="588" height="577" src="images/Chap5-236.gif" /></div>

<ol><li>
<a id="pgfId-1205881"></a>First, define either an input or output frequency range in the frequency sweep range fields. It is usually easier to define an input frequency range, as shown below for a 2.4GHz application.<br />
<a id="pgfId-1266526"></a><div class="webflare-div-image">
<img width="384" height="686" src="images/Chap5-237.gif" /></div></li><li>
<a id="pgfId-1205885"></a>Linear and log sweeps are provided. It is usually better to select Linear or Log, and specify the number of steps instead of using automatic. Automatic will run 50 frequency points, which usually is not needed for most applications.</li><li>
<a id="pgfId-1205886"></a>Now port and frequency definitions need to be made.</li><li>
<a id="pgfId-1205887"></a>Type 1 in the <em>Port #</em> column field. Click <em>Select Port</em>, and select the input port.<br />
<a id="pgfId-1266597"></a><div class="webflare-div-image">
<img width="382" height="686" src="images/Chap5-238.gif" /></div></li><li>
<a id="pgfId-1205893"></a>Click <em>Choose Harmonic</em>. In the window that appears, select the input frequency range. Next, click <em>OK</em>.<br />
<a id="pgfId-1266666"></a><div class="webflare-div-image">
<img width="392" height="250" src="images/Chap5-239.gif" /></div></li><li>
<a id="pgfId-1205897"></a>Click <em>Add</em>. The port-frequency combination is added to the list. By convention, port 1 sets the input frequency for qpsp.<br />
<a id="pgfId-1266709"></a><div class="webflare-div-image">
<img width="382" height="686" src="images/Chap5-240.gif" /></div></li><li>
<a id="pgfId-1205906"></a>Now define the output port as port 2.<br />
<a id="pgfId-1266773"></a><div class="webflare-div-image">
<img width="415" height="692" src="images/Chap5-241.gif" /></div></li><li>
<a id="pgfId-1205907"></a>Select the output frequency range by clicking <em>Choose Harmonic</em>, and selecting the output frequency range as shown below.<br />
<a id="pgfId-1266838"></a><div class="webflare-div-image">
<img width="383" height="250" src="images/Chap5-242.gif" /></div></li><li>
<a id="pgfId-1205911"></a>Next, click <em>Add</em>. This adds the port/frequency combination as port 2 in the list. By convention, port 2 sets the output frequency.<br />
<a id="pgfId-1266881"></a><div class="webflare-div-image">
<img width="434" height="690" src="images/Chap5-243.gif" /></div></li><li>
<a id="pgfId-1205917"></a>Repeat the process to define port 3 as the gain from RF to IF with no frequency translation. (The RF to IF isolation.)<br />
<a id="pgfId-1266945"></a><div class="webflare-div-image">
<img width="515" height="690" src="images/Chap5-244.gif" /></div></li><li>
<a id="pgfId-1205923"></a>If you want a noise simulation, define the maximum sideband term above. For more information, see the pnoise section in this chapter.<br />
<a id="pgfId-1266997"></a><div class="webflare-div-image">
<img width="430" height="691" src="images/Chap5-245.gif" /></div></li><li>
<a id="pgfId-1206243"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main form</em> in the ADE Explorer window. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1267080"></a><div class="webflare-div-image">
<img width="396" height="551" src="images/Chap5-246.gif" /></div></li><li>
<a id="pgfId-1207314"></a>Note that only the S-Parameters and the noise calculations are available for plotting in the <em>Direct Plot Form</em>.</li><li>
<a id="pgfId-1247749"></a>Select <em>Z-Smith</em> in the <em>Plot Type</em> section in the <em>Direct Plot Form</em>. Now plot S11 on the Smith Chart.</li><li>
<a id="pgfId-1207321"></a>Z-Smith is shown for the S11 plot below. The marker is placed at 2.4GHz.<br />
<a id="pgfId-1267134"></a><div class="webflare-div-image">
<img width="638" height="454" src="images/Chap5-247.gif" /></div></li><li>
<a id="pgfId-1207342"></a>In the waveform tool, there are two zoom features that are helpful. Typing the f key fits the data to the screen. It will not necessarily display the unit circle, depending on the actual S-Parameters to be plotted. &lt;Shift&gt;-f fits the Smith Chart to the unit circle as shown above. This is useful for getting the big picture of the plot.</li><li>
<a id="pgfId-1238890"></a>When S21 is plotted, the curve goes outside the unit circle. The small green trace in the center is the S11 plot from the previous graphic.<br />
<a id="pgfId-1267178"></a><div class="webflare-div-image">
<img width="637" height="430" src="images/Chap5-248.gif" /></div></li><li>
<a id="pgfId-1238917"></a>Rectangular plots are also available. Select <em>Rectangular</em> in the <em>Plot Type</em> section in the <em>Direct Plot Form</em>, as shown below.<br />
<a id="pgfId-1267281"></a><div class="webflare-div-image">
<img width="637" height="426" src="images/Chap5-249.gif" /></div></li></ol>




































































<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="Chap4.html" id="prev" title="Single Input Large and Small-signal Analyses">Single Input Large and Small-s ...</a></em></b><b><em><a href="Chap6.html" id="nex" title="Envelope (ENVLP) Analysis">Envelope (ENVLP) Analysis</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2020, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>