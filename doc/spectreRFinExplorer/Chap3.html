
<html><head><title>Frequency Domain Analyses: Harmonic Balance</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2020-06-25" />
<meta name="CreateTime" content="1593085429" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Provides user information for Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis" />
<meta name="DocTitle" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Frequency Domain Analyses: Harmonic Balance" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.2.1" />
<meta name="Keyword" content="spectreRFinExplorer" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2020-06-25" />
<meta name="ModifiedTime" content="1593085429" />
<meta name="NextFile" content="Chap4.html" />
<meta name="Group" content="SpectreRF" />
<meta name="Platform" content="Custom IC Design" />
<meta name="PrevFile" content="Chap2.html" />
<meta name="c_product" content="Spectre" />
<meta name="Product" content="Spectre" />
<meta name="ProductFamily" content="Spectre" />
<meta name="ProductVersion" content="19.1" />
<meta name="RightsManagement" content="Copyright 2012-2020 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide -- Frequency Domain Analyses: Harmonic Balance" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="Version" content="19.1" />
<meta name="SpaceKey" content="spectreRFinExplorer191" />
<meta name="webflare-version" content="2.0" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="spectreRFinExplorerTOC.html">Contents</a></li><li><a class="prev" href="Chap2.html" title="Setting up a SpectreRF Simulation">Setting up a SpectreRF Simulat ...</a></li><li style="float: right;"><a class="viewPrint" href="spectreRFinExplorer.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="Chap4.html" title="Single Input Large and Small-signal Analyses">Single Input Large and Small-s ...</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide<br />Product Version 19.1, June 2020</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>3
<a id="pgfId-1065082"></a></h1>
<h1>
<a id="pgfId-1065083"></a><hr />
<a id="42683"></a>Frequency Domain Analyses: Harmonic Balance<hr />
</h1>
<h2>
<a id="pgfId-1240023"></a>Overview of Sim<a id="harmonic_balance"></a>ulation Capabilities</h2>

<p>
<a id="pgfId-1251047"></a>SpectreRF offers two different modes; Spectre and APS. Spectre uses traditional simulation techniques. APS makes the CMOS models more efficient and allows multi-threading for the device current evaluation. In addition, APS adds full parallel solving of all the matrices, thus speeding up the simulation even more. There is no loss in accuracy because there is no change in the actual equations that are simulated or in the options that control the accuracy of the simulation. These choices are available and are implemented for harmonic balance and periodic steady state simulations. Both large-signal harmonic balance and small-signal hbac, hbsp, and hbnoise analyses have the Spectre and APS implementations.</p>

<h2>
<a id="pgfId-1072427"></a>Large-Signal Harmonic B<a id="marker-1297625"></a>alance Overview</h2>

<p>
<a id="pgfId-1094442"></a>Harmonic balance is a large-signal analysis that solves in the frequency domain. It calculates the harmonics and mixing products of one or more inputs to the circuit. It takes into account all the large-signal effects in the circuit. Applications include measuring the harmonic content of a single input, calculating the large-signal IP3 of a power amplifier (with 2 input frequencies), and measuring the large-signal IP3 and IP2 of a transmit mixer (with 2 IF tones and an LO input). Harmonic balance can also provide a large-signal solution to the small-signal hbac, hbsp, and hbnoise analyses. More information on small-signal analyses is provided later in the chapter.</p>
<p>
<a id="pgfId-1306578"></a>Harmonic balance is chosen for circuits that have near-sinusoidal signals and do not have high speed transitions. Although harmonic balance may work with circuits that have rapid transitions by setting lots of harmonics, it is likely that shooting (available in pss) will run faster. For LC oscillators and especially crystal oscillators, harmonic balance should be used. For ring oscillators, it is likely that shooting pss will be faster and more accurate. However, harmonic balance can be used on very nonlinear circuits including circuits with multiple frequency dividers.</p>
<p>
<a id="pgfId-1333330"></a>The implementations of harmonic balance in the ADE Explorer/Assembler <em>Choosing Analyses</em> form differ somewhat. The <em>Choosing Analyses</em> form has three choices that have harmonic balance (hb) as a choice: hb, pss with the engine set to harmonic balance (hb), and qpss with the engine set to harmonic balance. </p>
<p>
<a id="pgfId-1334507"></a>In hb and qpss when harmonic balance (hb) is selected as the engine, the harmonics of only the inputs and the mixing products are calculated. In pss, when harmonic balance is selected as the engine, all the harmonics of the inputs are calculated, even if the power in those harmonics is zero. For example, if there is an input at 2GHz and another at 2.1GHz, the harmonics of 100MHz are calculated. Note that in order to calculate through the fifth harmonic of the input at 2.1GHz, 105 harmonics need to be calculated. For this reason, pss is usually used for a single input frequency, and qpss or hb is usually used for multiple input frequencies. </p>
<p>
<a id="pgfId-1334514"></a>The hb analysis does not require any distinction. It always calculates the harmonics of the inputs, and if multiple inputs are present, it also calculates the mixing frequencies. Also, the hb analysis has an auto mode where all you do is provide the input frequency. Everything else is automatic. Oscillator tuning mode is available where you specify a target frequency and a parameter to be varied, and then hb will tune the oscillator to that frequency. Usually, this is followed by a noise analysis, and this capability allows Monte Carlo simulations where the oscillator is tuned to the frequency, and the noise is measured at that frequency. In addition, hb has a mode where the gain compression is automatically determined. Using this capability speeds up compression analysis in Monte Carlo analyses. Multiple frequency dividers are supported with settable divide ratios for each signal path. This chapter focuses on the hb selection in the ADE Explorer <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1243390"></a>Harmonic Balance provides a solution in the frequency domain. Things that have direct frequency domain representations like capacitors, transmission lines, or S-parameter descriptions go directly into the frequency domain solution. Devices and other nonlinearities need to be evaluated in the time domain, with the ifft, and fft used to translate between the domains. This is an iterative process. Each successive iteration produces a more accurate solution. In other words, an exact solution is never attained. The iterations continue until the answer is &#8220;close enough&#8221;. Close enough is set by choosing an accuracy default in the <em>Choosing Analyses</em> form. Liberal, moderate, and conservative accuracy levels are provided. Choose the appropriate accuracy level based on your requirement. If you are calculating very small amplitude harmonics, you might need to choose conservative.</p>

<h2>
<a id="pgfId-1072432"></a>Example</h2>

<p>
<a id="pgfId-1072433"></a>Consider a behavioral low noise amplifier shown below:</p>

<p>
<a id="pgfId-1072418"></a></p>
<div class="webflare-div-image">
<img width="630" height="548" src="images/Chap3-2.gif" /></div>

<p>
<a id="pgfId-1072480"></a>The LNA is a behavioral LNA from rfLib. The properties list is shown below. Note that the gain is 20 dB, and the amplifier is only slightly nonlinear.</p>

<p>
<a id="pgfId-1072499"></a></p>
<div class="webflare-div-image">
<img width="668" height="784" src="images/Chap3-3.gif" /></div>

<p>
<a id="pgfId-1072528"></a>The input port (the source on the left side in the above schematic) has the properties shown below.</p>

<p>
<a id="pgfId-1072558"></a></p>
<div class="webflare-div-image">
<img width="668" height="777" src="images/Chap3-4.gif" /></div>

<p>
<a id="pgfId-1072587"></a>In general, give the signals names in the <em>Frequency name</em> property. In the example above, it is RF for the first frequency, and RF2 for the second. Giving names is required if you use the list of signals in the circuit in the harmonic balance <em>Choosing Analyses</em> form instead of specifying the frequencies. The frequency is set to a variable name called <em>frf</em> and the amplitude in dBm is set to the variable name <em>prf</em>. Setting variables in these properties makes it easy to change the frequency or amplitude without needing to change the schematic. The variable <em>frf</em> is set to 2.4G and the variable <em>prf</em> is set to -30 under <em>Design Variables</em> in the <em>Setup</em> pane of ADE Explorer, as shown below.</p>

<p>
<a id="pgfId-1072610"></a></p>
<div class="webflare-div-image">
<img width="668" height="435" src="images/Chap3-5.gif" /></div>

<p>
<a id="pgfId-1072640"></a>ADE Explorer is used to set up the different analyses by clicking on the <em>Analysis</em> - <em>Choose</em> menu, clicking on <em>Click to add analysis</em> text located under <em>Analyses</em> in the <em>Setup</em> pane, or by clicking the ChooseAnalysis icon ( <img width="30" height="28" src="images/Chap3-6.gif" />
) located at the upper-right corner of the ADE Explorer window. </p>


<p>
<a id="pgfId-1279506"></a>When you select <em>Analysis</em>-<em>Choose</em>, the <em>Choosing Analyses</em> form appears. At the top of the form, select the <em>hb</em> (harmonic balance) radio button.</p>

<p>
<a id="pgfId-1279510"></a></p>
<div class="webflare-div-image">
<img width="668" height="776" src="images/Chap3-7.gif" /></div>

<p>
<a id="pgfId-1279511"></a>In the <em>Choosing Analyses</em> form, the frequencies, the number of harmonics, oversample factor and accuracy are set. Oversample factor will be discussed later in the chapter. The <em>Fundamental Frequency</em> field can either have a number like 2.4G, or it can have the variable name that is used to set the frequency in the input port as shown above.</p>
<p>
<a id="pgfId-1242563"></a>Run transient has three settings: <em>Decide automatically</em>, <em>Yes</em>, and <em>No</em>. <em>Decide automatically</em> means that the transient will be run before the harmonic balance algorithm. In this mode, the transient starts with a small number of periods of the fundamental frequency for Tone1 as the transient stop time. As the transient analysis runs, the waveform is analyzed to see if steady-state has been reached. When steady-state is reached, a Fourier transform is performed on the last cycle of the transient waveform, and this is used as the starting point of the harmonic balance iterations. If steady-state has not been reached in this small number of periods, the transient is extended in time up to a maximum of 250 periods for a driven circuit, and 500 periods for an oscillator. If steady-state has not been detected in the last period of the transient, other continuation methods will be tried in an attempt to achieve convergence.</p>
<p>
<a id="pgfId-1242613"></a><em>Decide automatically</em> also sets the number of harmonics in the <em>Choosing Analyses</em> form for <em>Tone1</em> to <em>auto</em> by default. The transient analysis waveforms at all the nodes in the circuit are analyzed, and based on the waveforms, the number of harmonics that are needed for the simulation to be accurate is set by the simulator. This can be manually overridden by setting a number of harmonics manually.</p>
<p>
<a id="pgfId-1242564"></a>Setting <em>Run transient</em> to <em>Yes</em> requires you to enter a stop time for the initial transient analysis in the <em>Stop Time (tstab)</em> field. This mode allows the steady-state detection to be selected or not. If it is selected, whenever steady-state is detected in the transient analysis, it will terminate, run the fft, and start the harmonic balance iterations. In this mode, the stop time for the transient analysis cannot be automatically extended. If <em>Detect Steady State</em> is deselected, the transient will run to the specified stop time without checking for steady-state.</p>
<p>
<a id="pgfId-1242620"></a>When <em>Run transient</em> is set to <em>Yes</em>, and the <em>Detect Steady State</em> is deselected, the number of harmonics field remains blank by default. You can either enter the text <em>auto</em>, or you can manually set the number of harmonics by specifying a number. When <em>auto</em> is set, the transient analysis waveforms at all the nodes in the circuit are analyzed, and based on the waveforms, the number of harmonics that are needed for the simulation to be accurate is set by the simulator.</p>
<p>
<a id="pgfId-1242598"></a>Setting <em>Run transient</em> to <em>No</em> causes the harmonic balance algorithm to start from the DC solution without transient assist.</p>
<p>
<a id="pgfId-1309861"></a>Dynamic parameters are supported in tstab just like in the transient analysis. Typically, only reltol is changed over the tstab interval with loose (large) values of reltol at the beginning of tstab and then tighter values toward the end to improve convergence. A single option is supported in the GUI. Note that the default values are already fairly loose in the tstab interval by default.</p>
<p>
<a id="pgfId-1072716"></a>When you have completed the <em>Choosing Analyses</em> form, click <em>OK</em> and run the simulation. You can run the simulation by selecting <em>Simulation</em> - <em>Netlist and Run</em>, or by selecting the green arrow on the right side of the ADE Explorer window.</p>
<p>
<a id="pgfId-1072717"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.</p>

<p>
<a id="pgfId-1072699"></a></p>
<div class="webflare-div-image">
<img width="668" height="649" src="images/Chap3-8.gif" /></div>

<p>
<a id="pgfId-1072778"></a>At any time, the next thing that needs to be accomplished is shown at the bottom of the form.</p>
<p>
<a id="pgfId-1094566"></a>The <em>Analysis</em> section at the top of the form displays the list of different analyses that were run. In this example, only <em>hb</em> results are available.</p>
<p>
<a id="pgfId-1094567"></a>The <em>Function</em> selection is where the type of data that is desired to be plotted is selected. <em>Power</em> is shown above.</p>
<p>
<a id="pgfId-1072781"></a>To get the power based on the voltage in a net, <em>Net(specify R)</em> is chosen from the drop-down list.</p>
<p>
<a id="pgfId-1072782"></a>Next select <em>Magnitude</em>, which gives power in Watts, dB10, which gives dB with respect to 1 Watt, or dBm, which gives dB with respect to 1 milliwatt. from the <em>Modifier</em> section. <em>dBm</em> is shown above.</p>
<p>
<a id="pgfId-1072783"></a>The next step is to select the net in the schematic. The waveform window appears with the selected result in it. Both the input and output nets are shown. A marker has been positioned at the first harmonic in both traces. Note that the input level is almost exactly -30 as set in ADE Explorer, and the output is 20dB larger than the input as set in the behavioral LNA. The harmonics at about -350dBm represent the numerical noise floor of the simulation.</p>

<p>
<a id="pgfId-1091985"></a></p>
<div class="webflare-div-image">
<img width="668" height="430" src="images/Chap3-9.gif" /></div>
<h2>
<a id="pgfId-1091986"></a>Harmonic Balance Solves For Cosines</h2>

<p>
<a id="pgfId-1106026"></a>In order to be compatible with other harmonic balance simulators, the convention in Spectre harmonic balance is to solve for cosines rather than sines. From a practical point of view, this means that the phase that is solved in harmonic balance is 90 degrees different compared to shooting. It also means that in order to get a zero degree solution in harmonic balance, the phase of the input source needs to be 90 degrees.</p>
<p>
<a id="pgfId-1106033"></a>The circuit below is used for this example.</p>

<p>
<a id="pgfId-1251496"></a></p>
<div class="webflare-div-image">
<img width="679" height="581" src="images/Chap3-10.gif" /></div>

<p>
<a id="pgfId-1106057"></a>In the properties list for the input port, the phase has been set to 90 degrees. This is the phase of the sinusoid that is produced by the input source.</p>

<p>
<a id="pgfId-1251636"></a></p>
<div class="webflare-div-image">
<img width="443" height="821" src="images/Chap3-11.gif" /></div>

<p>
<a id="pgfId-1251755"></a>The signal in1, which is the input to the behavioral amplifier has been plotted below. The power in dBm is unaffected by the phase, but you can see that the phase that is calculated by Spectre is zero degrees. In harmonic balance, if you want a reference phase of zero, you must set the phase on the input source to 90 degrees.</p>

<p>
<a id="pgfId-1251772"></a></p>
<div class="webflare-div-image">
<img width="658" height="429" src="images/Chap3-12.gif" /></div>
<h2>
<a id="pgfId-1251759"></a>Setting Harmonics Auto<a id="marker-1297682"></a>matically</h2>

<p>
<a id="pgfId-1106630"></a>Harmonic balance can now set harmonics automatically for the signal that causes the most distortion. This is recommended in the general case. To enable this, select <em>Decide automatically</em> or <em>Yes</em> for the <em>Run Transient</em> selection in the Transient-Aided Options. This single action will cause a transient analysis to be run until steady-state is detected, and then from the transient analysis, the number of harmonics for Tone1 (when <em>Frequencies</em> is selected) or for the tone that has tstab enabled (when <em>Names</em> is selected).</p>

<h2>
<a id="pgfId-1106618"></a>Setting Harmonics M<a id="marker-1297691"></a>anually</h2>

<p>
<a id="pgfId-1091987"></a>Consider an amplifier with a single input. In this case the input and its harmonics need to be calculated. In order to get the correct solution, both positive and negative frequencies need to be calculated. With harmonic balance, input is required as to how many harmonics should be calculated. If you set 3 harmonics, then -3. -2, -1, 0, 1, 2, and 3 times the input frequency needs to be calculated, as shown below.</p>

<p>
<a id="pgfId-1092016"></a></p>
<div class="webflare-div-image">
<img width="668" height="128" src="images/Chap3-13.gif" /></div>

<p>
<a id="pgfId-1092017"></a>The number of harmonics to be calculated is (2*number of harmonics) +1. The runtime and memory consumption are proportional to the number of unknowns (all the harmonics at all the nodes) that need to be solved. In this case, seven unknowns need to be solved at each node.</p>
<p>
<a id="pgfId-1092018"></a>In order to make sure that you have enough harmonics, start with an estimate based on the power level and the harmonic content of the input to the circuit. If the input is sinusoidal at fairly low power, try about 3 harmonics. If the amplitude is large, try about 7 harmonics. Next, run the simulation and plot the results. Position a marker at the desired measurement. Now increase the number of harmonics, and re-run the simulation and re-plot the waveform. If the measurement did not change, then the original estimate was enough, and you might be able to reduce the number of harmonics. Use the smallest number of harmonics that are required in order to have a minimum runtime.</p>
<p>
<a id="pgfId-1092019"></a>If the input is a pulse wave at high amplitude, start at about 15 harmonics and an oversample factor of 4. Oversample factor will be discussed later in the chapter. The simulator takes the fft of the input signal, and uses multiple sources in series with the values and phases set to the value calculated by the fft.</p>
<p>
<a id="pgfId-1092020"></a>When square waves are present in the circuit, the minimum number of harmonics should be set to the period of the square wave divided by the risetime of the square wave. Very sharp edges require many harmonics in order to be accurate in the time domain. If the time-domain waveform is less important than the frequency domain content, then a smaller number of harmonics can be specified along with an oversample factor of 4 or 8. For more information, refer to the <a href="Chap3.html#47103">Oversample Factor</a>.</p>
<p>
<a id="pgfId-1092021"></a>When piecewise linear waveforms are used as power supplies to ramp the power up at time zero, specify only two points. The first point should have time set to zero, and the voltage should be about 80% to 90% of the actual supply voltage. The second point should have the time set equal to about half the period of the operating frequency, and the voltage set to the supply voltage. If the simulation time exceeds the second time in the PWL setup, it will retain that value for the rest of the simulation. More importantly, for any SpectreRF large-signal analysis, the system does not become periodic until after the last timepoint in the PWL file. If you put a point at 1 second and the power supply voltage, the system will need to be simulated for one full second in the tstab interval using the transient algorithm before the harmonic balance simulation can run. This can take a long time.</p>
<p>
<a id="pgfId-1092022"></a>When periodic piecewise linear inputs are used, the more non-sinusoidal the waveform is, the more harmonics you need and also the higher oversample factor needs to be in order to accurately simulate the system. Oversample factor is explained in the following section. Start with an estimate of how many harmonics would be required to represent the waveform in the frequency domain, and then re-run the simulation with more harmonics to see if things changed. Oversample factor also needs to be increased. Sine waves need oversample=1. Square waves need 4 or 8. The more nonsinusoidal the waveform is, the higher the oversample factor needs to be. Note that even with a sinusoid applied, the currents may be very nonsinusoidal. Think of the currents in a diode mixer with a sinusoidal LO input. In this case, an oversample factor of 4 or 8 is likely to be required. </p>
<p>
<a id="pgfId-1092023"></a>Up to two non-sinusoidal sources are allowed in the circuit. The first can be any periodic signal type, like pulse, exponential, and periodic piecewise linear. The second non-sinusoidal source is limited to being a pulse waveform. The rest of the inputs must be sinusoidal.</p>

<h3>
<a id="pgfId-1092024"></a><a id="47103"></a>Oversample Fa<a id="marker-1297696"></a>ctor</h3>

<p>
<a id="pgfId-1243812"></a>Note that fft and ifft are used to translate between time and frequency domains for the nonlinear evaluation. It is the nature of the ifft and fft to require more samples than the absolute minimum required in the time domain to get a correct answer for the harmonics in the frequency domain when the waveform is nonsinusoidal.</p>
<p>
<a id="pgfId-1092026"></a>The circuit below has a square wave source on the top, and a sine wave source on the bottom. The load for both is a resistor.</p>

<p>
<a id="pgfId-1073189"></a></p>
<div class="webflare-div-image">
<img width="668" height="604" src="images/Chap3-14.gif" /></div>

<p>
<a id="pgfId-1073229"></a>There is no nonlinearity at all in the circuit. Therefore, the harmonics of the sinusoid and the square wave can be analyzed using the transient analysis and the DFT function in the calculator. The DFT function uses an fft algorithm to calculate the peak value of each harmonic. The transient waveforms are shown below. Both signals have exactly 1 volt peak amplitudes.</p>

<p>
<a id="pgfId-1073248"></a></p>
<div class="webflare-div-image">
<img width="668" height="447" src="images/Chap3-15.gif" /></div>

<p>
<a id="pgfId-1073271"></a>In the following figure, you can see that the fft of the sine wave is essentially the same for 4, 16, 64, and 256 samples of the transient waveform. The waveforms are shown in the top-left sub window. The number of samples can be read in the legend at the top-left corner of each sub window.</p>

<p>
<a id="pgfId-1073290"></a></p>
<div class="webflare-div-image">
<img width="668" height="438" src="images/Chap3-16.gif" /></div>

<p>
<a id="pgfId-1073324"></a>All the readings are in pico-dB or femto-dB. Sine waves do not need extra timepoints to calculate the correct amplitude for the harmonic.</p>
<p>
<a id="pgfId-1073325"></a>Shown below are the ffts of the square wave with 4, 8, 16, 32, 64, 128, and 256 samples. The number of samples can be read at the upper-left corner of each sub window in the legend.</p>

<p>
<a id="pgfId-1073312"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_6.gif" /></div>

<p>
<a id="pgfId-1073376"></a>Note that with four samples, the value is 0dBV, which is 1 volt. With 256 samples, the result is 2.09777dB. This is almost 2.1dB larger than with four samples and is obtained just by increasing the number of samples. With 32 samples, you can get almost the right answer. This is a factor of eight times the number of samples required to calculate two harmonics. In other words, if two harmonics are set, an oversample factor of at least eight is required to get the correct answer for the square wave.</p>
<p>
<a id="pgfId-1073377"></a>When 8192 points are used, only a minor change is observed as shown below.</p>

<p>
<a id="pgfId-1073361"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_9.gif" /></div>
<h3>
<a id="pgfId-1073416"></a>Trading off Harmonics and Oversample Factor</h3>

<p>
<a id="pgfId-1073417"></a>The risetime of the above square wave is 1/500th the period of the square wave. Technically, the period divided by the risetime or 500 harmonics are required to obtain the correct answer. The hb solution for the waveform (from an ifft) and in the frequency domain are shown below.</p>

<p>
<a id="pgfId-1073408"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_7.gif" /></div>

<p>
<a id="pgfId-1073475"></a>The large number of harmonics requires a long runtime when real circuits are simulated. Because of the large number of harmonics, shooting pss is likely to run faster than hb for this level of accuracy.</p>
<p>
<a id="pgfId-1073493"></a>If accuracy in the time domain can be compromised a bit, setting a relatively small number of harmonics with an oversample factor of 8 can get reasonably close to the solution above. In the below example, 5 harmonics with an oversample factor of 8 have been used.</p>

<p>
<a id="pgfId-1073537"></a></p>
<div class="webflare-div-image">
<img width="668" height="424" src="images/Chap3-20.gif" /></div>

<p>
<a id="pgfId-1073546"></a>Note that the answer in the frequency domain is only a few thousandths of a dB different than the answer with 500 harmonics. The waveform in the time domain (from an ifft) is very different than the transient waveform. If you only need an answer in the frequency domain, setting a small number of harmonics along with a high oversample factor will result in much faster runtimes with little compromise in accuracy in the frequency domain when non-sinusoidal waveforms are present.</p>
<p>
<a id="pgfId-1073547"></a>The basic strategy with non-sinusoidal waveforms is to start with an estimate of how many harmonics might be required, and set the oversample factor to 8. Run the simulation. Reduce the number of harmonics by about 50% and run the simulation again. If the answer does not change, reduce the number of harmonics again. Do the same with oversample. You are looking for the lowest runtime that also produces the correct answer, which will usually occur with a relatively large number for oversample factor, and a relatively small number of harmonics.</p>
<p>
<a id="pgfId-1073548"></a>Every circuit is a little bit different in terms of the number of harmonics and oversample factor, but the principles are the same.</p>

<h3>
<a id="pgfId-1073562"></a>Two Input Freq<a id="marker-1297750"></a>uencies</h3>

<p>
<a id="pgfId-1073587"></a>Consider an amplifier with two input frequencies. Because the circuit is nonlinear, intermodulation distortion is created. A lot more harmonics are produced by the circuit and need to be solved in the simulation. As a result, the runtime is longer and more memory is required. The harmonics to be calculated can be seen graphically, as shown below. Three harmonics are specified for both signals. The horizontal axis represents the first frequency and has symbols at -3*input frequency, -2*input frequency, -1*input frequency, the DC level, +1*input frequency, +2*input frequency, and +3*input frequency. Similarly, the vertical axis has symbols at the frequencies of the harmonics for the second input signal. The first symbol, 45 degrees from the origin, is the mixing product <code>Frequency1</code> + <code>Frequency2</code>. The figure below shows several different mixing products.</p>
<p>
<a id="pgfId-1073588"></a>Note that the actual frequencies are not represented well by the chart. If F1 is 1GHz, and F2 is 1.1GHz, then F1+F2 is 2.1GHz and this is the first point at +45 degrees. F1-F2 is 100MHz, and is represented by the first point at -45 degrees.</p>

<p>
<a id="pgfId-1073572"></a></p>
<div class="webflare-div-image">
<img width="668" height="449" src="images/Chap3-21.gif" /></div>

<p>
<a id="pgfId-1073627"></a>This is called a rectangular or box cut, which is the default setting in harmonic balance. Note that ((2*number of harmonics on tone 1) +1) * ((2*number of harmonics on tone 2) +1) harmonics need to be calculated. In this case 49 harmonics need to be calculated at each node of the circuit.</p>
<p>
<a id="pgfId-1073628"></a>Note that the diagonal corners are sixth order terms. For example, the upper-right corner is 3*F1 + 3*F2. Since it is a sixth order term, it is likely that the amount of power that the circuit generates is small, and therefore can be removed from the solution space, thereby speeding up the simulation with minimal loss in accuracy.</p>

<h3>
<a id="pgfId-1073629"></a>Frequen<a id="marker-1388642"></a>cy Cuts</h3>

<p>
<a id="pgfId-1388658"></a>Note that widefunnel, crossbox, and crossbox_hier cuts are intended for multi-divider mode. Do not use these frequency cuts for a normal simulation. These cuts will be covered in the Multi-Divider Mode section below.</p>
<p>
<a id="pgfId-1388659"></a>To access frequency cuts, set harmonics to Select and then choose the appropriate frequency cut. This is shown below for the diamond cut. The parameters for the different cuts and the harmonics that are retained are explained below.</p>

<p>
<a id="pgfId-1388683"></a></p>
<div class="webflare-div-image">
<img width="668" height="758" src="images/Chap3-22.gif" /></div>

<p>
<a id="pgfId-1388719"></a>SpectreRF has a diamond cut available where the high order terms can be removed from the simulation. The solution space is shown below for a 4th order diamond cut. The solutions in red are in the solution space. The solutions in black are not. The figure below assumes that 7 harmonics are specified for <code>Frequency 1</code>, and 3 for <code>Frequency 2</code>.</p>

<p>
<a id="pgfId-1073647"></a></p>
<div class="webflare-div-image">
<img width="668" height="366" src="images/Chap3-23.gif" /></div>

<p>
<a id="pgfId-1388747"></a>It is called a diamond cut because graphically, it looks like a diamond. The rectangular cut would have 15*7 or 105 harmonics in it. This cut has 39 harmonics in it. Instead of calculating 105 harmonics at each node, 39 harmonics are calculated at each node, therefore, the simulation runs considerably faster and takes less memory. All the fourth order and lower order terms are in the solution. The fifth order and higher order terms are excluded. As long as there is not much power in those harmonics, the solution will remain accurate and will run much faster than the default rectangular cut.</p>
<p>
<a id="pgfId-1335880"></a>The diamond cut is useful for circuits where the distortion is similar in the circuit from all the input frequencies. An example is an IP3 simulation for a power amplifier. Because the power level of both inputs is the same, both signals cause similar distortion.</p>
<p>
<a id="pgfId-1335881"></a>The order of the cut can be set in the ADE Explorer <em>Choosing Analyses</em> form. Setting the order of the cut is similar to setting the number of harmonics. The more the distortion in the circuit, the larger the order needs to be for accuracy. Start with an estimate of what the circuit might produce, and run the simulation. Take the measurement. Raise the order, re-run, and re-plot. If the measurement changed significantly, then the order needs to be raised again. If the measurement did not change, try a smaller order. Use the smallest order that produces accurate results.</p>
<p>
<a id="pgfId-1148377"></a>Funnel cut is also available. Funnel cut is a diamond cut with the addition of the harmonics on the axis for all the tones. This cut is useful for systems where there is a difference in the distortion from the different inputs. One example would be a mixer with a large amplitude LO, and an RF tone. In this case, because the LO power is large, all the harmonics of the LO are desired, but the mixing products are limited to lower order. This reduces aliasing with the addition of only a small number of harmonics. A diagram is shown below.</p>

<p>
<a id="pgfId-1148388"></a></p>
<div class="webflare-div-image">
<img width="652" height="344" src="images/Chap3-24.gif" /></div>
<h3>
<a id="pgfId-1073677"></a>Three Input Frequ<a id="marker-1297764"></a>encies</h3>

<p>
<a id="pgfId-1073678"></a>Now imagine a mixer with an LO and two RF signals. Here, there are multiple planes of harmonics that need to be calculated, as shown in the figure below. Only 2 harmonics of the RF tones and one harmonic of the LO are shown in the figure so the planes can be visualized.</p>

<p>
<a id="pgfId-1073666"></a></p>
<div class="webflare-div-image">
<img width="668" height="543" src="images/Chap3-25.gif" /></div>

<p>
<a id="pgfId-1073723"></a>Note that ((2*number of harmonics on tone 1) +1) * ((2*number of harmonics on tone 2) +1) * ((2*number of harmonics on tone 3) +1) harmonics need to be calculated. If three harmonics were specified for all 3 tones, 7*7*7 or 343 harmonics need to be calculated at each node. Four input frequencies is a practical maximum for most circuits.</p>

<h3>
<a id="pgfId-1073724"></a>Diamond Cut With Thr<a id="marker-1297769"></a>ee Frequencies</h3>

<p>
<a id="pgfId-1073725"></a>When the diamond frequency cut is applied, the red solution shown below is calculated when the maximum order is set to two. On the zero plane for the LO, a diamond that goes to the second harmonic of both tones is included. In the -1 and +1 planes for the LO, the diamond is drawn with the order reduced by one. When the number of LO harmonics is larger, which is the general case, on the 0 (zero) LO plane, the diamond goes through the order specified in the <code>maximorder</code> parameter. For the +1 and -1 planes, the order is reduced by one. For the +2 and -2 planes, it is reduced by one more. This continues on the rest of the planes.</p>

<p>
<a id="pgfId-1073751"></a></p>
<div class="webflare-div-image">
<img width="668" height="631" src="images/Chap3-26.gif" /></div>

<p>
<a id="pgfId-1073792"></a>Now imagine that there were more LO harmonics. More planes would be created. If the maximum order was set to 4, on the center plane, the included elements would go through the fourth order. For the first plane above and below, harmonics through the third order would be calculated. For the second plane above and below, harmonics through the second order would be included. For the third plane above and below, only the first harmonic would be calculated. For any other planes, no harmonics would be calculated.</p>
<p>
<a id="pgfId-1073793"></a>You can see from the figure that fewer harmonics are calculated when the cut is applied and that the diamond is extended vertically. Fewer harmonics are calculated in the upper and lower planes than in the center plane. In this way, many harmonics are pruned from the solution space, and the simulation is sped up in the process. Two harmonics for the LO is artificially small in order to understand the concept. Usually, between 3 and 15 harmonics are chosen in most circuits.</p>

<h3>
<a id="pgfId-1073794"></a>Fun<a id="marker-1297774"></a>nel Cut</h3>

<p>
<a id="pgfId-1073780"></a>Note that in the following example, because of the high LO power, many LO harmonics would be created in the circuit, and therefore, might cause incorrect results if the higher harmonics of the LO were not included in the solution. Funnel cut takes the diamond cut, and adds harmonics along the axes for all the inputs up to the maximum specified by the number of harmonics for each tone. This is shown in the figure below. Note that the signal names on the axes are changed from the previous figure. This is done to allow the diagram to fit on the page.</p>

<p>
<a id="pgfId-1073773"></a></p>
<div class="webflare-div-image">
<img width="668" height="519" src="images/Chap3-27.gif" /></div>

<p>
<a id="pgfId-1073715"></a>Note that the harmonics along the axes only are added. In this case, the LO harmonics are added. The funnel cut is provided for circuits like mixers where the distortion is different from the different inputs. The idea is that the maximum order of the diamond might be 4 or 5 which allows accurate calculation of the mixing products and still calculating enough harmonics of the signal(s) that causes relatively more distortion. If the diamond cut were used, a higher maximum order is necessary to allow the high order harmonics of the high distortion signal to be calculated which includes many more harmonics to be solved than the funnel cut.</p>

<h3>
<a id="pgfId-1073864"></a>Axis C<a id="marker-1297779"></a>ut</h3>

<p>
<a id="pgfId-1073866"></a>A fourth cut is available called Axis cut that only calculates the harmonics of the inputs themselves. No mixing products are calculated at all. This cut is only useful for getting a quick idea of the amplitudes of the individual tones. It is shown in the figure below.</p>

<p>
<a id="pgfId-1073849"></a></p>
<div class="webflare-div-image">
<img width="668" height="519" src="images/Chap3-28.gif" /></div>
<h3>
<a id="pgfId-1073914"></a>Multiple Frequency Dividers</h3>

<p>
<a id="pgfId-1388794"></a>This mode is intended for expert users who have an estimate of layout parasitics including parasitics from the substrate available.</p>
<p>
<a id="pgfId-1388795"></a>Today&#8217;s devices contain multiple radios. The large amplitude LO signals can cause leakage problems from the LO in one radio to the front end of another radio. Multiple dividers are now supported in harmonic balance to allow simulations of leakage from one radio into another.</p>
<p>
<a id="pgfId-1388796"></a>Multiple divider mode is intended for the case where multiple frequency dividers are being driven from separate sources at different frequencies. If you have multiple frequency dividers being driven from a single source, do not use multiple divider mode.</p>
<p>
<a id="pgfId-1388797"></a>The dividers must be driven using sources. Multi-divider mode is not supported for oscillator-driven frequency dividers.</p>
<p>
<a id="pgfId-1388798"></a>To achieve acceptable accuracy, divider simulations using HB require a large number of harmonics on each input frequency. In the default mode, multi-divider simulations would require excessive computational time and require a large amount of memory to run. Therefore special frequency cuts that are specific to the case of multiple signal paths where the signal paths have weak coupling between them but each path requires a large number of harmonics are provided.</p>
<p>
<a id="pgfId-1388799"></a>The funnel cut may be accurate enough, however three new cuts are available for multi-divider mode. These cuts require less memory and faster execution compared to the other frequency cuts. The author recommends starting with crossbox_hier before using the other two cuts.</p>

<h3>
<a id="pgfId-1388842"></a>Crossbox_hier</h3>

<p>
<a id="pgfId-1388843"></a>Crossbox_hier is supported for two tones only.</p>

<p>
<a id="pgfId-1388830"></a></p>
<div class="webflare-div-image">
<img width="668" height="536" src="images/Chap3-29.gif" /></div>

<p>
<a id="pgfId-1388889"></a>The number of harmonics on Tone 1 sets the width of the spectral components on the X Axis. The number of harmonics on Tone 2 sets the height of the spectral components on the Y Axis. Axisbw sets the width of the spectral components outside the central box on both the X and Y Axes. Maximorder sets the width of the central box on both the X and Y Axes. </p>
<p>
<a id="pgfId-1388890"></a>As the axisbw setting is raised, more mixing harmonics are calculated which improves accuracy at the cost of simulation time and memory. This should be determined in the same way as setting the number of harmonics in HB. Start with one, and run. Plot the output and measure the amplitude of the desired harmonics. Raise axisbw and run again. If the measured harmonics changed, then raise axisbw again. Use the smallest axisbw that produces stable results.</p>
<p>
<a id="pgfId-1388950"></a>Maximorder sets the width of the central box. The process is similar to setting axisbw above. Start with an estimate of the highest order mixing products that exist in your design, and calibrate by varying maximorder. As with axisbw, larger values produce more accuracy at the cost of simulation time and memory.</p>

<h3>
<a id="pgfId-1388962"></a>Crossbox</h3>

<p>
<a id="pgfId-1388963"></a>The frequency cuts are the same as crossbox_hier above. The parameters behave the same way as above.</p>
<p>
<a id="pgfId-1388964"></a>The crossbox frequency cut has aliasing that is unrelated to the number of harmonics set on the individual input tones. This aliasing is controlled by the property called minialiasorder. The default value for this parameter is 600 which is likely to be very conservative. Setting smaller values will raise the numerical noise floor while reducing the runtime. Use the smallest value that produces accurate results.</p>

<h3>
<a id="pgfId-1389023"></a>Widefunnel</h3>

<p>
<a id="pgfId-1389024"></a>Widefunnel is similar to crossbox except the shape of the cut is different for the harmonics near the origin.</p>

<p>
<a id="pgfId-1389015"></a></p>
<div class="webflare-div-image">
<img width="668" height="523" src="images/Chap3-30.gif" /></div>

<p>
<a id="pgfId-1389079"></a>As in crossbox, minialiasorder needs to be set in the same way. The behavior of axisbw and maximorder is the same as in crossbox, but the shape of the internal area is diamond shaped instead of a box. The process for setting these is the same as in crossbox_hier.</p>

<h3>
<a id="pgfId-1388953"></a>Alias<a id="marker-1388952"></a>ing</h3>

<p>
<a id="pgfId-1073915"></a>The reason for setting the number of harmonics and the order of different cuts is because of aliasing. If the actual system produces power outside the solution in the higher harmonics, that power will appear in the solution you specified. In the example above with the axis cut, because no mixing products are calculated at all, all that power shows up as increased power somewhere in the harmonics that are actually calculated.</p>
<p>
<a id="pgfId-1073916"></a>Aliasing needs to be checked, as can be seen in the following figures.</p>

<p>
<a id="pgfId-1073902"></a></p>
<div class="webflare-div-image">
<img width="668" height="426" src="images/Chap3-31.gif" /></div>

<p>
<a id="pgfId-1073968"></a>The figure above displays the spectral calculation of an amplifier with 900MHz and 920MHz applied at the same level. Note the level of the harmonics at 880MHz, 900MHz, 920MHz, and 940MHz. In this solution, two harmonics were set for both tones.</p>
<p>
<a id="pgfId-1073970"></a>When the number of harmonics in the solution is raised to three for each input, the aliasing is less because there is less power in the uncalculated harmonics of the system. Note that in this case, the measurements for the harmonics at 900MHz and 920MHz changed only by 0.01dB. If you only need a measurement of the output power at the main output frequencies, 2 harmonics are enough. The measurements at 880MHz and 940MHz have changed by 0.268dB and 0.263dB respectively. This might or might not be accurate enough for an IP3 measurement depending on your accuracy requirement. The solution is shown below.</p>

<p>
<a id="pgfId-1073960"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_18.gif" /></div>

<p>
<a id="pgfId-1074000"></a>In order to check if the solution has enough harmonics, even more harmonics need to be run. Below is the solution with five harmonics on each tone. Note that the levels have changed by 0.01 dB for both tones at 880MHz and 940MHz. Three harmonics are enough in this case. Although the solution changed slightly with more harmonics, it is difficult to justify the extra runtime for a 0.01 dB change.</p>

<p>
<a id="pgfId-1074030"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_19.gif" /></div>

<p>
<a id="pgfId-1074056"></a>When the harmonics are raised to nine, the solution changes by less than 0.001dB as compared to five. To repeat, three harmonics is enough in this case. There was no significant change when the number of harmonics was raised above three. </p>
<p>
<a id="pgfId-1074075"></a>The solution with nine harmonics is shown below.</p>

<p>
<a id="pgfId-1074082"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_20.gif" /></div>

<p>
<a id="pgfId-1074123"></a>Below is a slightly different view of harmonics. Harmonic balance is supported in pss, where all of the harmonics starting from zero through the highest harmonic are calculated. </p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1092035"></a>This is not suggested for most applications. This is just to understand the concepts only.</div>
<p>
<a id="pgfId-1074115"></a>The first view shows the solution with slightly more harmonics than the number needed to calculate the upper third order product at 940MHz. The circuit is an amplifier with inputs at 900MHz and 920MHz. </p>
<p>
<a id="pgfId-1074154"></a>The third order products are at 880MHz and 940MHz.</p>

<p>
<a id="pgfId-1074147"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_21.gif" /></div>

<p>
<a id="pgfId-1074202"></a>Note that there are significant harmonics from about 380MHz through 520MHz. These harmonics are not produced by the circuit. These harmonics are produced because the power in higher harmonics is significant, and that power shows up in the solution with the number of harmonics set up for this run. The take away from this is that if you do not calculate enough harmonics in the solution space, random and unpredictable errors are introduced in the solution specified by you.</p>
<p>
<a id="pgfId-1074203"></a>When the number of harmonics are raised, the solution changes. The solution below has 205 harmonics and appears to have no aliasing. Note that the first order terms at 900MHz and 920MHz have only changed slightly, but that the third order terms have changed by a significant amount.</p>

<p>
<a id="pgfId-1074187"></a></p>
<div class="webflare-div-image">
<img width="663" height="421" src="images/Chap3-36.gif" /></div>

<p>
<a id="pgfId-1074238"></a>However, when the number of harmonics is raised to 210 (only 5 more harmonics), the figure changes. Here, it is apparent that aliasing is still going on, and it is a bit difficult to infer which harmonics are real and which are produced by aliasing. </p>
<p>
<a id="pgfId-1074286"></a>This is shown below.</p>

<p>
<a id="pgfId-1074257"></a></p>
<div class="webflare-div-image">
<img width="661" height="417" src="images/Chap3-37.gif" /></div>

<p>
<a id="pgfId-1074297"></a>It is only when 1005 harmonics are taken that the aliasing stops because the levels of the higher harmonics are on the order of the numerical noise floor.</p>

<p>
<a id="pgfId-1074316"></a></p>
<div class="webflare-div-image">
<img width="665" height="424" src="images/Chap3-38.gif" /></div>
<h3>
<a id="pgfId-1269735"></a>Gain Compr<a id="marker-1297789"></a>ession Analysis</h3>

<p>
<a id="pgfId-1269736"></a>Gain compression analysis is available in the harmonic balance <em>Choosing Analyses</em> form. Compression measurements can be made with either a port or a voltage source as the input to the circuit. Compression analysis does not require manually setting any input sweeps, and has dedicated direct plot functions to plot voltage or power at the compression point and the compression curves. </p>
<p>
<a id="pgfId-1269903"></a>Gain compression is a measure of gain reduction resulting from circuit nonlinearity. Spectre allows you to measure either transducer power gain or voltage gain compression. Multiple levels of compression can be specified, if desired. In Xdb compression analysis, Spectre sweeps the input power (or voltage) automatically to arrive at the desired compression level. Compression is defined as shown below.</p>

<p>
<a id="pgfId-1281854"></a></p>
<div class="webflare-div-image">
<img width="566" height="488" src="images/Chap3-39.gif" /></div>

<p>
<a id="pgfId-1269907"></a>The gain reference for compression measurement can be either the gain at small input amplitude as shown above, or the gain reference can be the maximum at the peak above. The diagram above shows the gain, but the actual power (or voltage) in the sweep can also be plotted. Small-signal analyses can also be specified and will be run at the compression point only.</p>
<p>
<a id="pgfId-1270010"></a>Compression can measure power or voltage compression. For a power compression measurement, the input must be a port, and the output power is measured through a resistor, port or current probe. For a voltage compression measurement, the input is a vsource and The output is taken across a pair of nodes.</p>
<p>
<a id="pgfId-1291320"></a>Multiple levels of compression can be specified in a run. In the <em>compression Levels (dB)</em> field, type a list of compression values separated by spaces.</p>
<p>
<a id="pgfId-1291334"></a>Rapid Mode is also provided. This mode supports only a single compression level. In this mode, you provide an estimate of the input power or voltage at the compression point. Then, three runs are made. One at low power, one at the level you specified, and a third that is slightly lower then the compression point. Results are then extrapolated based on these three simulations. This mode works well for Monte Carlo and Corners where a large number of simulations are required.</p>
<p>
<a id="pgfId-1271459"></a>Gain compression analysis stores the following information: </p>
<ol><li>
<a id="pgfId-1271486"></a>The compression point.</li><li>
<a id="pgfId-1271512"></a>Gain and power compression curves.</li><li>
<a id="pgfId-1271535"></a>The HB simulation results at the compression point.</li></ol>


<p>
<a id="pgfId-1271558"></a>Direct Plot functions are provided for the results.</p>
<p>
<a id="pgfId-1271572"></a>Small-signal analyses can be set up and run, and will be run only at the gain compression point.</p>

<h3>
<a id="pgfId-1389120"></a>Large-Signal S-Parameters</h3>

<p>
<a id="pgfId-1389121"></a>Large-signal S-Parameters can be set up in the harmonic balance Choosing Analyses Form and Direct Plot functions are available after the simulation runs. This can be done for amplifiers or for circuits that translate frequencies. Set the number of harmonics manually to be enough for the largest power level of the sweep of input power.</p>
<p>
<a id="pgfId-1389122"></a>To use LSSP, click the LSSP check box in the hb Choosing Analyses Form. Click the Select button to the right of the Ports field and select the input and output ports in the circuit. Click the Choose button to the right of the Load Harmonic field, and select the frequency of the output. This allows LSSP measurements for systems that convert frequencies. Now define an input sweep using the Sweep check box above the LSSP check box.</p>
<p>
<a id="pgfId-1389123"></a>On the first power level of the sweep, S11 and S21 are measured. Then the input port is disabled and the output port is set to the power measured in the forward S21 measurement. This allows S22 and S12 to be measured. This process is repeated until the large-signal S-Parameters are measured for all the sweep levels.</p>
<p>
<a id="pgfId-1389124"></a>When this completes, LSSP measurements can be done using the Direct Plot Form. The S-Parameters, impedance of the circuit, and VSWR can be plotted at the sweep values.</p>

<h3>
<a id="pgfId-1269721"></a>Sine Representation of Square Wave</h3>

<p>
<a id="pgfId-1074362"></a>In harmonic balance, a square wave is approximated by a series of sinusoids at the odd harmonics. The actual waveform that the circuit sees is shown from a transient simulation in the waveform window shown below. The top trace has the first and third harmonic. The second trace contains all the harmonics through the 11th harmonic. The third trace contains all the harmonics through the 19th harmonic. The bottom trace has 25 harmonics. Note that as more harmonics are added, a closer approximation is made to the square wave. The flat part of the waveform gets flatter and the edge gets steeper.</p>
<p>
<a id="pgfId-1074363"></a>Note that this is done for all non-sinusoidal waveforms by taking the fft of the waveform specified through the harmonic number and then stacking the voltage sources in series with the values set to the value from the fft.</p>

<p>
<a id="pgfId-1074353"></a></p>
<div class="webflare-div-image">
<img width="664" height="554" src="images/Chap3-40.gif" /></div>
<h2>
<a id="pgfId-1074396"></a>Converg<a id="marker-1297805"></a>ence</h2>

<p>
<a id="pgfId-1074424"></a>Like all harmonic balance simulators, an iterative approach is used to solve the circuit equations. In an iterative approach, there is always another iteration that causes the solution to become more accurate. You stop iterating as soon as the error in the solution becomes small. As a result, the solution is not exact.</p>
<p>
<a id="pgfId-1074425"></a>To indicate progress in the Spectre output, two metrics are provided. </p>
<ul><li>
<a id="pgfId-1094933"></a><code>Resd_norm</code> measures the absolute error in the solution.</li><li>
<a id="pgfId-1094940"></a><code>Delta_norm</code> measures the change from the last iteration. </li></ul>

<p>
<a id="pgfId-1074426"></a>Convergence is achieved when the sum of the currents at all the nodes is near zero, and there is only a small motion between the last iteration and the current iteration. When both <code>resd_norm</code> and <code>delta_norm</code> are less than one, the simulation has converged and the iterations stop.</p>
<p>
<a id="pgfId-1074427"></a>The absolute accuracy is affected by the product of <code>reltol * residualtol</code>. The change that is allowed form iteration-to-iteration is affected by the product of <code>reltol *lteratio * steadyratio</code>. </p>
<p>
<a id="pgfId-1074416"></a><em>Reltol</em> is a global option, which is an option that affects all analyses that are run. This option can be set in ADE Explorer by selecting <em>Simulation</em> - <em>Options</em> - <em>Analog</em>. The default for reltol depends on the setting of <code>liberal</code>, <code>moderate</code>, or <code>conservative</code>, whether the circuit is driven or is an oscillator, and the number of inputs to the circuit. The <em>Residualtol</em> option is located just below the <em>reltol</em> option in the form, and is a multiplier to reltol. Normally residualtol is not used in SpectreRF. Lteratio depends on the setting of <code>liberal</code>, <code>moderate</code>, or <code>conservative</code> for the errpreset option. </p>

<h3>
<a id="pgfId-1100221"></a>Errpr<a id="marker-1297810"></a>eset</h3>

<p>
<a id="pgfId-1100232"></a><em>Errpreset</em> is shown in the ADE implementation section. Normally, the option <em>lteratio</em> is not set away from the default for harmonic balance. <em>Steadyratio</em> is a harmonic balance option, and defaults to 1.0. Setting a larger <em>steadyratio</em> value allows a larger change from iteration-to-iteration and still allows convergence. Following are the default values for <em>reltol</em>, <em>lteratio</em>, and <em>steadyratio</em>.</p>
<table class="webflareTable" id="#id1074456">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074458"></a><bold>
1 input driven circuit
</bold></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074460"></a>Reltol</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074462"></a>Lteratio</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074485"></a>Steadyratio</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074464"></a>Liberal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074466"></a>1e-3</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074468"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074487"></a>1.0</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074470"></a>Moderate</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074472"></a>1e-3</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074474"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074489"></a>1.0</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074491"></a>Conservative</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074493"></a>1e-4</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074495"></a>10</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074497"></a>1.0</p>
</td>
</tr>
</tbody></table>
<p>
<a id="pgfId-1074500"></a></p>
<table class="webflareTable" id="#id1074508">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074510"></a><bold>
multiple input driven circuit or oscillator
</bold></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074512"></a>Reltol</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074514"></a>Lteratio</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074516"></a>Steadyratio</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074518"></a>Liberal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074520"></a>1e-3</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074522"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074524"></a>1.0</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074526"></a>Moderate</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074528"></a>1e-4</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074530"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074532"></a>1.0</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074534"></a>Conservative</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074536"></a>1e-5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074538"></a>10</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1074540"></a>1.0</p>
</td>
</tr>
</tbody></table>
<p>
<a id="pgfId-1074569"></a>Note that the values for the <em>reltol</em> option are the maximum values for the frequency domain iterations only. For transient assist, the value of the <em>reltol</em> option in the global options form is used. If the <em>reltol</em> option is set to a value smaller than the values in the table, that value will be used. If the <em>reltol</em> option is set to a value higher than the values in the table, the values in the table will be used.</p>
<p>
<a id="pgfId-1074570"></a>In some cases, the <code>resd_norm</code> (a measure of absolute error) in the Spectre output window will be below one, but the delta norm (a measure of the change between iterations) remains above one. In this case, the solution varies from iteration to iteration more than the amount allowed. This is usually caused by the small-amplitude harmonics changing relatively a lot, but since they are small, allowing a large delta is acceptable. Look at the delta norm to see the range it is in, and then set the <em>steadyratio</em> option slightly larger than that and re-run the simulation.</p>

<h3>
<a id="pgfId-1100251"></a>Iteration Li<a id="marker-1297815"></a>mit</h3>

<p>
<a id="pgfId-1100276"></a>All iterative approaches have the possibility of not converging. In hb, there is a default limit of 100 iterations. This can be changed by setting the <code>maxperiods</code> option.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1074592"></a>If the iteration limit is reached without convergence, the solution point for the last iteration is written to the data file and is available for plotting. Make sure that the simulation actually converged by checking the Spectre output window. If you are running a sweep, the sweep will stop when the error is incurred. </div>
<p>
<a id="pgfId-1074642"></a>The message is located at the end of the output, and is shown below.</p>

<p>
<a id="pgfId-1074623"></a></p>
<div class="webflare-div-image">
<img width="668" height="642" src="images/Chap3-41.gif" /></div>

<p>
<a id="pgfId-1074653"></a>You can see from <em>resd_norm</em> at the last iteration, that the error is significant. (it is much greater than one.) This answer cannot be trusted. To allow more iterations, set the <code>maxperiods</code> option to a number greater than 100.</p>

<h2>
<a id="pgfId-1074718"></a>Number of Non-Sinusoidal Sources</h2>

<p>
<a id="pgfId-1074719"></a>Up to two non-sinusoidal sources are allowed in the circuit. The signal that causes the largest number of harmonics or is periodic piecewise linear in the circuit should be <em>Tone1</em> when <em>Tones</em> are set to <em>Frequencies</em>. <em>Tones</em> is a choice in the <em>Choosing Analyses</em> form. If <em>Tones</em> is set to <em>Names</em>, enable tstab in the list for this signal. The second non-sinusoidal source is limited to being a pulse waveform</p>
<p>
<a id="pgfId-1074720"></a>All the rest of the sources in the circuit must be sinusoidal. When <em>Frequencies</em> is selected, there is a limit of four input frequencies in the circuit. <em>Names</em> does not have this limitation, but four input frequencies is a practical upper limit because the number of harmonics to solve explodes.</p>
<p>
<a id="pgfId-1074721"></a>When <em>Names</em> is selected, the sources in the circuit need to have entries in the <em>Frequency name 1</em> or <em>Frequency name 2</em> properties in the signal sources in the circuit. When assigning names, make sure that if you have multiple inputs at a single frequency, like there might be for a differential circuit, the names should be the same. This enables SpectreRF to consider the two signals as one. If you have frequencies that are integer multiples of each other, these should have the same name too. In this case, the actual frequency will be the lower of the two frequencies. Make sure that enough harmonics of the low frequency are specified to incorporate enough harmonics for the high frequency input to prevent aliasing.</p>

<h2>
<a id="pgfId-1074737"></a>Harmonic Balance Starting Point</h2>

<p>
<a id="pgfId-1074738"></a>Harmonic balance has traditionally started from the DC solution for the first iteration in the frequency domain. This is not the default for SpectreRF. The default is to run a short transient until steady-state is reached, and then switch to harmonic balance where the number of harmonics is selected automatically based on the transient analysis waveforms. </p>
<p>
<a id="pgfId-1252123"></a>Starting from a DC point is a reasonable starting point for driven circuits. The input signal causes harmonics to be created and solved in the frequency domain. Transient aided harmonic balance is also available. This is accomplished by selecting Decide automatically or Yes for run transient. If Yes is selected, setting a simulation time in the stop time property is needed. Transient aided runs a transient analysis on the signal that you select for the time specified, and then runs a single period of the input. A Fourier transform is performed, and the result is used as the starting point for the frequency domain iterations. Because the starting point is closer to the actual solution, it usually requires fewer frequency domain iterations at the expense of running the transient analysis at the start. It is frequently faster to run a short transient and then iterate in the frequency domain. The only way to determine which is faster is to try both ways and see which one finishes first. Only one signal can have transient assist. When <em>Tones</em> is set to <em>Names</em>, the signal with tstab set to <em>yes</em> can have transient assist. Choose the signal that produces the largest amount of distortion for transient assist. When <em>Tones</em> is set to <em>Frequencies</em>, only <em>Tone1</em> can have transient assist. <em>Tones</em> is an option in the<em> Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1074739"></a>Transient assist can also be used to improve convergence. It works because the starting point in the frequency domain is closer to the real solution than the DC solution, which is the default. Anytime an iterative approach is used, the closer the starting point is to the real solution, the higher the probability of convergence.</p>
<p>
<a id="pgfId-1095244"></a>In some cases, very lengthy transient simulations are needed to produce convergence. There are two ways you might use to shorten this time. The first way is to specify a filename in the <em>writehb</em> option on the first run, and then use the <em>readhb</em> option on subsequent analyses. The <em>writehb</em> option writes out every relevant parameter to a file so that when <em>readhb</em> is specified, the simulation can start from the file. The second way to reduce the time is to save the state near the end of the transient assist (tstab) interval, and then use that state to restart the transient assist with a much shorter simulation time before going into the frequency domain iterations. This is accomplished using the <em>savefile</em>, <em>saveperiod</em>, and <em>savetime</em> options. </p>
<p>
<a id="pgfId-1095245"></a>Both of these ways allow circuit values to be changed when restarted, but the topology of the circuit cannot be altered. When the topology is altered, the transient assist needs to start over. If a value is changed, the change causes an instantaneous discontinuity in the solution and because of this, if the change is too large, there will be convergence failures.</p>

<h2>
<a id="pgfId-1074675"></a>More Capabilities</h2>
<h3>
<a id="pgfId-1074787"></a>Save and Rec<a id="marker-1297820"></a>over</h3>

<p>
<a id="pgfId-1074788"></a>Save and recover writes and restores the full internal state of the transient analysis that is used in the tstab interval so that a circuit can be restarted from that state to save time in a simulation that has a long startup time, or in the case where a longer tstab is needed for the transient assist. For now, savefiles that are made using the transient analysis are not usable as a recover file in harmonic balance. The savefile must be created from the tstab interval in harmonic balance or pss.</p>
<p>
<a id="pgfId-1074789"></a>To save a file, set the <em>savefile</em> option to a filename. If you are working from a netlist, the file will be created in the directory you are running from. If you are in the ADE environment, the file is located in the <code>netlist</code> directory. This is located in the <em>simulation/&lt;circuit_name&gt;/&lt;simulator_name&gt;/&lt;view_name&gt;/netlist</em> directory. The simulation directory defaults to your home directory, but it can also be set by the administrators of the Cadence tools. In most cases, this directory will be shown in the project directory of the <em>Setup</em> - <em>Save</em>Options menu in ADE Explorer. If you are unable to locate this directory, contact your system administrator to find the location. Spectre is the simulator name, so if you had a circuit called <code>abc</code>, and you started ADE Explorer from the schematic view, the <code>netlist</code> directory would be located at <em>~/simulation/abc/spectre/schematic/netlist</em>.</p>
<p>
<a id="pgfId-1074790"></a>Next, set either <em>saveperiod</em> or type in a list of times in the <em>savetimes</em> field. Do not specify both at the same time. If tstab is set to 50n, <em>saveperiod</em> is set to 10n, and the <em>savefile</em> option is set to <em>save_file</em>, when the simulation reaches 10n in the tstab interval the file <em>save_file</em> is created in the <code>netlist</code> directory. When 20n is reached, <em>save_file</em> is overwritten with the data at 20n. This continues until the last 10n interval is reached in the tstab interval.</p>
<p>
<a id="pgfId-1074791"></a>Alternatively, you can type 10n 25n 40n 50n in the <em>savetimes</em> field. This would create four files beginning with <em>save_file</em> and ending with the time for that specific point. The exact format of this file changes occasionally, so look in the <code>netlist</code> directory to get the actual filename you want to start from.</p>
<p>
<a id="pgfId-1074792"></a>To recover, you specify the filename you want to recover from, and set tstab to a larger time than the time in the file. You can also change the list of times in the <em>savetimes</em> option to save more times after the time you recovered from.</p>

<h3>
<a id="pgfId-1074793"></a>Writehb and Read<a id="marker-1297825"></a>hb</h3>

<p>
<a id="pgfId-1074794"></a>Setting <em>writehb</em> causes the entire harmonic balance solution to be written to a file that can be used later. When readhb is set to a previously saved <em>writehb</em> file, the solution is read from the file, and then follow-on small-signal analyses can be performed. Note that <em>readhb</em> and <em>writehb</em> cannot be set at the same time.</p>
<p>
<a id="pgfId-1074795"></a><em>Readhb</em><a id="marker-1297830"></a> can also be used as a starting point for when more input frequencies are supplied to the circuit. If you have a 2-tone solution, and then you add a third tone, The two tones in the solution are used as a starting point for the 3-tone solution which must iterate to achieve convergence. Because the starting point contains the solution for two signals, this is a better starting point than using transient aided where the solution to only one tone is available for the first iteration.</p>

<h3>
<a id="pgfId-1074796"></a>Sweeps and Restart</h3>

<p>
<a id="pgfId-1074797"></a>Sweeps are available both in the hb <em>Choosing Analyses</em> form and from the parametric tool in ADE Explorer. Sweeps automatically use the previous solution as the starting point for the next member of the sweep. If convergence difficulties are encountered, the sweep parameter will be automatically stepped from the value that converged to the value that needs to be measured. When Monte Carlo encounters convergence difficulties, several things are tried to achieve convergence. If you want to disable these automatic features, set the restart option to <em>yes</em>.</p>

<h3>
<a id="pgfId-1074798"></a>Itre<a id="marker-1297835"></a>s</h3>

<p>
<a id="pgfId-1074799"></a>Itres controls the precision of the solution at the first iteration in the frequency domain. Harmonic balance starts with the DC solution as the starting point which causes the solution at the first iteration to be inaccurate. Because of this, the first solution is calculated without much precision (number of digits in the solution) in order to save time. Follow-on iterations have more precision. The final solution has full precision. Note that if you use transient-aided harmonic balance, the starting point in the frequency domain can be quite good, and so itres should be manually set to 1e-2. This forces enough digits in the mantissa to be solved so that the solution differs from a solution with all the digits of the mantissa by less than 1 part in 100. If the circuit is nearly linear (for example an LNA) increasing the precision by setting itres to 1e-2 can also reduce the total number of iterations. Regardless of the setting of itres, as the iterations progress, the precision is automatically increased so that the final solution is accurate. The default is 0.1, which allows a 10% error on the first iteration.</p>

<h3>
<a id="pgfId-1074800"></a>Freqd<a id="marker-1297840"></a>ivide</h3>

<p>
<a id="pgfId-1074801"></a>If the circuit has a frequency divider, specify the divide ratio in the <em>freqdivide</em> property. This needs to be an integer. Make sure that oversample factor is set in this case as discussed earlier. Also, make sure that transient-assisted is used, and set the transient part to at least the time needed for the divider to count through its sequence once. The effect of this is that the fundamental frequency is divided down by the freqdivide ratio. Make sure that enough harmonics are specified so that at least the fifth harmonic of the input signal is calculated. If <em>freqdivide</em> is set to four, make sure that at least 20 harmonics are specified for that signal.</p>

<h2>
<a id="pgfId-1095519"></a><a id="84696"></a>Oscillators</h2>

<p>
<a id="pgfId-1075039"></a>For oscillators, a DC starting point is not a good starting point. The frequency and amplitude of the harmonics needs to be solved and the DC state has no information at all about this. There is no signal source, so the oscillator usually just does not start. The default in ADE Explorer is to estimate the oscillatory frequency and amplitude, and then run a transient analysis until steady-state is reached. Upon reaching steady-state, the number of harmonics needed for the oscillator are calculated by evaluating the waveform at every node in the oscillator, and then running harmonic balance to solve for the frequency and amplitude at each node. This is a good starting point for LC, crystal, or mems oscillators.</p>
<p>
<a id="pgfId-1107507"></a>If the oscillator is a ring oscillator, apply the initial conditions to force one stage of the ring to a high or low state. Set <em>Run transient</em> to <em>Decide automatically</em>. If desired, turn off <em>Calculate initial conditions automatically</em>, which will only work for a conventional feedback oscillator.</p>
<p>
<a id="pgfId-1075008"></a>When using transient assist manually (called the tstab interval) for oscillators, set <em>Run Transient</em> to <em>Yes</em>. Specify a time for tstab, on the order of twenty periods of oscillation. Select the check box for <em>Detect Steady State</em>. This will enable the transient, and automatically switch to harmonic balance when steady-state is reached. In this mode, tstab cannot be lengthened automatically like it can be when <em>Decide Automatically</em> is selected.</p>
<p>
<a id="pgfId-1075009"></a>In many cases, it is desirable to see the startup waveform, which is not saved by default. If you want to see the startup behavior, select <em>yes</em> for the <em>Save Initial Transient Results (saveinit)</em> option.</p>
<p>
<a id="pgfId-1309904"></a>Dynamic parameters are available during the tstab interval. Dynamic parameters allow changing option settings during tstab and are typically used to reduce the accuracy (which speeds up the simulation) at the beginning and then tighten the accuracy at the end to improve convergence.</p>
<p>
<a id="pgfId-1249233"></a>When oscillators are simulated, a node or pair of nodes (if it is differential) needs to be declared to the simulator. This pair of nodes is used to get an estimate of the oscillation frequency at the end of the transient assist period. At the end of the transient assist period, 5 periods of the estimated operating frequency are simulated. In these 5 periods, the simulator looks for the frequency divided output at every node in the circuit and if it finds this behavior, it automatically adjusts the frequency. The frequency is estimated based on these last 5 cycles. A Fourier transform is performed on the last single cycle, and this is the starting point in the frequency domain. If frequency dividers are in the circuit, the estimated frequency of the oscillator is recommended to be specified in the <em>Choosing Analyses</em> form, and the frequency divide ratio should be specified in the freqdivide option.</p>
<p>
<a id="pgfId-1075013"></a>Solving the frequency in addition to the amplitudes and phases adds another unknown to the solution set, so it usually takes more iterations to reach a solution compared to a driven circuit.</p>

<h3>
<a id="pgfId-1075052"></a>Pinn<a id="marker-1297845"></a>ode</h3>

<p>
<a id="pgfId-1095662"></a>In a driven circuit, all the phases and amplitudes of the harmonics are defined by the input signal. There is no input for an oscillator, so a pinnode must be selected. The first harmonic phase of that node is pinned (held constant), and then the amplitude of all the nodes and relative phases of all the other nodes are calculated using the pinnode phase being held constant. SpectreRF has an algorithm that automatically selects the pinnode, and it is usually reliable. If convergence is an issue, try setting the pinnode manually in the options form to one of the nodes in the resonator.</p>
<p>
<a id="pgfId-1095663"></a>To set the pinnode manually, select the <em>Options</em> button at the bottom of the hb <em>Choosing Analyses</em> form and select the convergence tab (<em>IC61 only</em>). In the options field, do not enter a slash(/) at the beginning of the expression. Just enter the hierarchical node name similar to this example: <code>I12.I1.osc_resonator</code>. In the schematic, IC61 shows the instance name of the block in the tab for that block, so it is a bit easier to get the hierarchical names.</p>

<h3>
<a id="pgfId-1075070"></a>Probe-Based Me<a id="marker-1297850"></a>thod</h3>

<p>
<a id="pgfId-1075071"></a>The normal method of solving for an oscillator allows the amplitudes, phases, and frequencies to be solved simultaneously. A second method called the probe-based method iterates for the frequency solution in the outer loop and the amplitude and phase solution in the inner loop. It places a voltage source between a pair of nodes you specify, which should be in the resonator. If you have a single-ended oscillator, specify one node only. If the second node is left blank, it will be connected to the global ground node automatically. The voltage source converts the oscillator into a driven circuit, which converges easier. The source amplitude, phase, and the frequency are adjusted until the current in the source is near zero. Do not use the probe-based method and the pinnode option together, since the probe-based method also requires a pinnode to be selected. <em>Harmonic Index</em> and <em>Magnitude</em> do not need to be specified for the probe-based method. The <em>harmonic index</em> defaults to 1, which is suggested, and the <em>Magnitude</em> defaults to a small amplitude. If you specify <em>Magnitude</em>, make sure that the magnitude you specify (in volts RMS) is smaller than the amplitude of the actual oscillations, or the method itself will fail.</p>

<h3>
<a id="pgfId-1270037"></a>Oscillator Tuning M<a id="marker-1297855"></a>ode</h3>

<p>
<a id="pgfId-1270051"></a>Tuning mode adjusts a parameter in the circuit to produce the set frequency target. This is done automatically when tuning mode is enabled without setting any sweep parameters or interpolation of the resulting curves. When the tuning frequency is reached, any small-signal analyses like noise are run. This allows the simulator to tune the oscillator to a specified frequency and then make a noise measurement. This is useful in Monte Carlo analysis to see how the oscillator performs with process variations. The parameter to be tuned can be a variable, temperature, or a specified device parameter. Oscillator tuning mode is also supported in the pss analysis using the shooting or harmonic balance engines. See <a href="Chap4.html#26138">Chapter 4, &#8220;Single Input Large and Small-signal Analyses,&#8221;</a> for details.</p>
<p>
<a id="pgfId-1271596"></a>In this mode, the target frequency to tune to is the frequency that is specified in the harmonic balance form as the fundamental frequency. You specify a parameter that is to be varied to achieve the desired frequency. This can be a variable, a device parameter, or temperature. When the analysis runs, the oscillator will be tuned to the desired frequency, and then all the small-signal analyses will be run. </p>
<p>
<a id="pgfId-1271608"></a>Direct plot functions have been added to plot the tuning parameter.</p>

<h2>
<a id="pgfId-1074997"></a>Semi-Autono<a id="marker-1297860"></a>mous</h2>

<p>
<a id="pgfId-1075126"></a>Semi-autonomous is provided to allow the simulation of circuits that have periodic sources and oscillators in the same circuit. It is only supported in the hb <em>Choosing Analyses</em> form. Typical applications are for when you have a receiver with an RF tone and an oscillator for the LO so that all the oscillator noise is taken into account for the receiver noise simulation. Another application is for identifying the phase noise and spurious response of an oscillator when power supply ripple is applied.</p>
<p>
<a id="pgfId-1075127"></a>The simulator combines the driven and oscillator capability in one analysis. To set it up is similar to a multi-tone simulation, just select the <em>Oscillator</em> check box and specify the estimate of the oscillator frequency in the <em>osc!</em> section of the form. The probe-based method for oscillators is not available for semi-autonomous simulations.</p>

<h2>
<a id="pgfId-1075144"></a>Things to try to Ac<a id="fmax"></a>hieve Convergence (Driven Circuits)</h2>

<p>
<a id="pgfId-1095735"></a>Try running transient-assisted by setting the tstab option. Ensure that the signal that causes the most distortion is in <em>Tone 1</em> (when <em>Frequencies</em> is selected) or has tstab enabled (when <em>Names</em> is selected). Transient assist can help on any circuit.</p>
<p>
<a id="pgfId-1095736"></a>If there is an S-Parameter block in your circuit, make sure that causality is set to <em>fmax</em> on every instance of the nport. Starting with MMSIM 11.1 this is the default. The effect of this is to enforce causality for the DC and tstab interval. If this selection is not made, even the DC solution can be affected, sometimes producing results that can be larger than the power supply voltage. Setting causality to <em>fmax</em> makes sure that the DC and tstab intervals have a causal model. Refer to the Simulating S-Parameters chapter for a description about the nport component. Also, make sure that every port of the nport has a connection to something in the circuit. Leaving a terminal open can be very bad for convergence.</p>
<p>
<a id="pgfId-1095737"></a>Look at the startup waveform to see if it is settled. Make sure that tstab is long enough. Look at the starting waveform, and ensure that the amplitude is reasonable for your circuit. To improve convergence, the waveform must be pretty close to settled at the end of the tstab interval where the Fourier transform is made.</p>
<p>
<a id="pgfId-1095738"></a>Use enough harmonics. If your system produces square waves, make sure that at least five harmonics are calculated. In many cases, many more harmonics than that are required.</p>
<p>
<a id="pgfId-1095739"></a>Try setting the oversample factor to a higher value. This should be set to four or eight for circuits that have square waves. Setting it to two or four improves the accuracy of the Fourier transforms used in harmonic balance (hb) even for nearly sinusoidal circuits.</p>
<p>
<a id="pgfId-1095812"></a>Try setting itres to 1e-2. This forces a solution that is more precise on the first iteration, thus improving the chance of convergence. </p>
<p>
<a id="pgfId-1098090"></a>Try more maxperiods if <code>resd_norm</code> is small (near one). This indicates that the circuit is almost converged, and might converge more if more iterations are allowed. The default maxperiods is 100.</p>
<p>
<a id="pgfId-1095813"></a>If the residual norm is below one, but the delta norm is greater than one, set <em>steadyratio</em> just a little higher than the value in which the delta norm is running. The effect is to allow more delta from iteration to iteration and still allow convergence. Only do this if the <code>resd_norm</code> is less than one, which indicates that the absolute accuracy check is good.</p>
<p>
<a id="pgfId-1095743"></a>Try moderate accuracy. Sometimes, loosening the tolerances allows a circuit to converge. Note that this does reduce the accuracy of the solution the simulator solves for.</p>

<h2>
<a id="pgfId-1075170"></a>Things to try to Achieve Convergence (Oscillators)</h2>

<p>
<a id="pgfId-1075171"></a>Try everything listed above. In addition:</p>
<p>
<a id="pgfId-1075172"></a>Try setting <em>reltol</em> to 1e-5 and <em>vabstol</em> to 3e-8. These options can be found in the <em>Simulator Options</em> form in ADE Explorer. Select <em>Simulation</em> - <em>Options</em> - <em>Analog </em>to open the <em>Simulator Options</em> form. Making <em>reltol</em> and <em>vabstol</em> smaller makes the initial transient much more accurate by reducing the error caused by iterating to each solution and the numerical integration error. By providing a more accurate estimate of the frequency and amplitude of the waveform, convergence becomes easier.</p>
<p>
<a id="pgfId-1075173"></a>Try setting a pinnode manually. While the algorithm that is used in SpectreRF is usually reliable, if the oscillator does not converge, set the pinnode to one of the nodes in the resonator.</p>
<p>
<a id="pgfId-1075174"></a>Select the <em>Calculate initial conditions automatically</em> check box if you have an LC oscillator. This causes an initial estimate of the frequency and amplitude to occur at the start of the tstab interval. Add transient assist so that the harmonics can be calculated for the starting point in the frequency domain.</p>
<p>
<a id="pgfId-1075175"></a>Try the probe based method. This method adds a voltage source to the circuit so it becomes a driven circuit. Because the circuit is driven, convergence is easier. The frequency amplitude and the phase of the source are adjusted so that the current of the source becomes zero. When this happens, the source has no effect on the circuit.</p>
<p>
<a id="pgfId-1075176"></a>Try setting an initial condition (current) in the inductor of the resonator. Choose a value that approximates the steady-state peak value for the oscillatory condition.</p>

<h2>
<a id="pgfId-1075111"></a>Implementation in ADE Explorer</h2>
<h3>
<a id="pgfId-1075208"></a>Setting Frequencies, Harmonics, and Oversample</h3>
<h4>
<a id="pgfId-1108184"></a>Setting Harmonics and Trans<a id="marker-1297865"></a>ient Assist Automatically</h4>

<p>
<a id="pgfId-1108306"></a>The default in ADE Explorer is to run transient assist until steady-state is just reached, and then choose the number of harmonics for the first tone automatically, and then proceed with solving in the frequency domain.</p>

<p>
<a id="pgfId-1270675"></a></p>
<div class="webflare-div-image">
<img width="471" height="817" src="images/Chap3-42.gif" /></div>

<p>
<a id="pgfId-1270700"></a>The defaults are highlighted above. This configuration is recommended for all hb analyses.</p>

<p>
<a id="pgfId-1270681"></a></p>
<div class="webflare-div-image">
<img width="657" height="688" src="images/Chap3-43.gif" /></div>

<p>
<a id="pgfId-1109473"></a>Spectre will calculate the number of harmonics that are needed and report the number in the spectre output file, as highlighted above.</p>

<h4>
<a id="pgfId-1098116"></a>Tones = Frequencies</h4>
<p>
<a id="pgfId-1075234"></a></p>
<div class="webflare-div-image">
<img width="668" height="801" src="images/Chap3-44.gif" /></div>

<ol><li>
<a id="pgfId-1270790"></a>For sinusoidal sources, set <em>Oversample Factor</em> to 1. </li><li>
<a id="pgfId-1075298"></a>For square waves, set <em>Oversample Factor</em> to 2, 4, or 8. Use the smallest number that provides accurate results.</li><li>
<a id="pgfId-1306694"></a>If there are multiple sources with a common integer multiple frequency in your circuit, specify the highest common frequency. For example, if 1GHz and 1.5GHz are present in the circuit, set <em>Tone1</em> or <em>Tone2</em> frequency to 500MHz. In this case, make sure you take enough harmonics of 500MHz to get an accurate result at 1.5GHz.<br /><div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1306695"></a>
Specify the signal that causes the most distortion in the circuit as Tone1. This is the tone that can have transient assist, and selecting the signal with the most distortion as tone 1 improves the accuracy of the simulation.</div></li></ol>




<h4>
<a id="pgfId-1306716"></a>Tones = Na<a id="marker-1306696"></a>mes</h4>

<ol><li>
<a id="pgfId-1098136"></a>Select a line in the sources list.<br />
<a id="pgfId-1075640"></a>The fields (highlighted below) are automatically populated with the values of the selected line in the sources list.<br />
<a id="pgfId-1075650"></a><div class="webflare-div-image">
<img width="668" height="363" src="images/Chap3-46.gif" /></div></li><li>
<a id="pgfId-1075417"></a>Change the number of harmonics under the <em>Mxham</em> column (auto in the figure above).</li><li>
<a id="pgfId-1075418"></a>Change the oversample factor under the <em>Ovsap</em> column (1 in the figure above).</li><li>
<a id="pgfId-1309738"></a>Set only one of the inputs to have transient assist by setting <em>Tsta</em>b to <em>yes</em>.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1309739"></a>Make sure you enable tstab for the signal that has the largest amount of distortion in the circuit. This will make harmonic balance more accurate.</div></li><li>
<a id="pgfId-1306875"></a>If there are multiple sources in your circuit that have integer frequency relationships, set the <em>Frequency name 1</em> property in all the sources in the schematic to the same name. This will cause all the sources to be treated as solving for harmonics of the highest common frequency. For example, if 2.4GHz and 3.6GHz were present in the circuit, a single-tone simulation would be run that solves the harmonics of 1.2GHz. Make sure that you use enough harmonics so that the enough harmonics of 3.6 GHz are solved to prevent aliasing errors.</li></ol>













<h4>
<a id="pgfId-1309645"></a>Dynamic Parameters</h4>

<p>
<a id="pgfId-1309646"></a>To set the dynamic parameters:</p>
<ol><li>
<a id="pgfId-1309647"></a>Open the hb <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1309648"></a><div class="webflare-div-image">
<img width="668" height="794" src="images/Chap3-47.gif" /></div></li><li>
<a id="pgfId-1309649"></a>Choose <em>Yes</em> for <em>Run Transient?</em>.</li><li>
<a id="pgfId-1309650"></a>Specify the stop time for tstab in the <em>Stop Time (tstab)</em> field.</li><li>
<a id="pgfId-1309651"></a>Select <em>yes</em> for <em>Save Initial Transient Results (saveinit)</em>.</li><li>
<a id="pgfId-1309652"></a>Specify a value in the <em>Fundamental Frequency</em> field.</li><li>
<a id="pgfId-1309653"></a>Select <em>Oscillator</em>.</li><li>
<a id="pgfId-1309654"></a>Click <em>Select</em> to the right of the <em>Oscillator node+</em> field.</li><li>
<a id="pgfId-1309655"></a>Select a net in the schematic that has an oscillator signal.</li><li>
<a id="pgfId-1309656"></a>Select <em>conservative</em>.</li><li>
<a id="pgfId-1309657"></a>Select <em>Dynamic Parameter</em>.</li><li>
<a id="pgfId-1309658"></a>Choose <em>Parameter vector</em> from the drop-down list.</li><li>
<a id="pgfId-1309659"></a>Specify the name of the option that you want to vary in the tstab interval in the <em>Parameter name</em> field. The example shows <em>reltol</em>.</li><li>
<a id="pgfId-1309660"></a>Specify <em>0</em> (zero) in the <em>Time</em> field.</li><li>
<a id="pgfId-1309661"></a>Specify a reasonable value for the option. This example steps reltol from 1e-2 to 1e-7 every 20 nsec in the tstab interval. Note that 1e-2 is a very large value for reltol.</li><li>
<a id="pgfId-1309662"></a>Click <em>Add</em>.</li><li>
<a id="pgfId-1309663"></a>Add other time-value pairs as appropriate.</li><li>
<a id="pgfId-1309664"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1309676"></a>Run the simulation. The setting for the dynamic parameter appears in the Spectre output window.<br />
<a id="pgfId-1309694"></a><div class="webflare-div-image">
<img width="668" height="659" src="images/Chap3-48.gif" /></div></li></ol>
























<h4>
<a id="pgfId-1306879"></a>Multiple Frequency Dividers</h4>

<ol><li>
<a id="pgfId-1306880"></a>To simulate circuits with multiple frequency dividers, set <em>Tones</em> to <em>Frequencies</em>.<br />
<a id="pgfId-1306993"></a><div class="webflare-div-image">
<img width="668" height="765" src="images/Chap3-49.gif" /></div></li><li>
<a id="pgfId-1303447"></a>Select <em>Yes</em> from the <em>Run Transient? </em>drop-down list, and specify a tstab of at least two complete divider cycles for the longest divider output period.</li><li>
<a id="pgfId-1303448"></a>Select <em>Multi-divider Mode</em>.</li><li>
<a id="pgfId-1303449"></a>Specify the input frequency to the dividers in the <em>Fundamental Frequency</em> fields.</li><li>
<a id="pgfId-1303450"></a>Set the harmonics manually for both tones. Specify enough harmonics so that a minimum of five harmonics are solved at the input frequency of the divider.</li><li>
<a id="pgfId-1303451"></a>Set <em>Oversample Factor</em> to two or four. See <a href="Chap3.html#47103">Oversample Factor</a>.</li><li>
<a id="pgfId-1303452"></a>Specify the divider ratio for each tone in the <em>Freq Divide Ratio</em> fields. In order to run frequency dividers, tstab will be run on each tone in the list separately.</li><li>
<a id="pgfId-1303453"></a>Choose <em>Select</em> from the <em>Harmonics</em> drop-down list.</li><li>
<a id="pgfId-1303454"></a>Choose <em>funnel</em> cut.</li><li>
<a id="pgfId-1303455"></a>Specify <em>5</em> in the <em>MaximOrder (int)</em> field.</li></ol>














<h3>
<a id="pgfId-1303435"></a>Diamon<a id="marker-1297910"></a>d Cut</h3>

<p>
<a id="pgfId-1075894"></a>This is used when the number of significant harmonics produced by the circuit are similar for all the inputs. This is usually the case for a large-signal IP3 measurement on an amplifier.</p>
<p>
<a id="pgfId-1075925"></a>In the <em>Choosing Analyses</em> form:</p>

<p>
<a id="pgfId-1075932"></a></p>
<div class="webflare-div-image">
<img width="668" height="295" src="images/Chap3-50.gif" /></div>

<ol><li>
<a id="pgfId-1075950"></a>Choose <em>Select</em> from the Harmonics drop-down list.</li><li>
<a id="pgfId-1075970"></a>Select <em>diamond</em>.</li><li>
<a id="pgfId-1076009"></a>Type a reasonable value in the <em>MaximOrder (int)</em> field. The value is usually between 3 and 7.</li></ol>



<h3>
<a id="pgfId-1076010"></a>Funn<a id="marker-1297915"></a>el Cut</h3>

<p>
<a id="pgfId-1076021"></a>This is used when the number of significant harmonics produced by the circuit are different for one or more inputs. This is usually the case for a large-signal IP3 measurement on a mixer (The LO usually produces more harmonics than the RF input signals).</p>
<p>
<a id="pgfId-1076056"></a>In the <em>Choosing Analyses</em> form:</p>

<p>
<a id="pgfId-1076060"></a></p>
<div class="webflare-div-image">
<img width="668" height="291" src="images/Chap3-51.gif" /></div>

<ol><li>
<a id="pgfId-1076061"></a>Choose <em>Select</em> from the Harmonics drop-down list.</li><li>
<a id="pgfId-1076062"></a>Select <em>funnel</em>.</li><li>
<a id="pgfId-1076084"></a>Type a reasonable value in the <em>MaximOrder (int)</em> field. The value is usually between 3 and 9.</li></ol>



<h3>
<a id="pgfId-1076091"></a>Swe<a id="marker-1297920"></a>eps</h3>

<p>
<a id="pgfId-1076101"></a>You can sweep up to three things in the hb <em>Choosing Analyses</em> form.</p>

<p>
<a id="pgfId-1076127"></a></p>
<div class="webflare-div-image">
<img width="668" height="345" src="images/Chap3-52.gif" /></div>

<ul><li>
<a id="pgfId-1076161"></a>Each can be a variable, temperature, component parameter, or model parameter.</li><li>
<a id="pgfId-1076162"></a>Choose what you want to sweep from the drop-down list.</li><li>
<a id="pgfId-1076163"></a>Set the start and stop range for the sweep in the <em>Start</em> and <em>Stop</em> fields.</li><li>
<a id="pgfId-1076164"></a>You can add points off the grid in the <em>Add Specific Points</em> field.</li></ul>




<h3>
<a id="pgfId-1249368"></a>Freqdi<a id="marker-1297931"></a>vide</h3>
<p>
<a id="pgfId-1076300"></a></p>
<div class="webflare-div-image">
<img width="668" height="547" src="images/Chap3-53.gif" /></div>

<p>
<a id="pgfId-1076334"></a>If you set freqdivide, make sure that you have at least five harmonics at the input frequency as an absolute minimum. You must also set the <em>Oversample Factor</em> between 2 and 8.</p>
<p>
<a id="pgfId-1076336"></a>Normally, when there are square waves in the circuit, for accurate results for the transient waveform, the number of harmonics needs to be at least the period of the square wave divided by the rise or fall-time, whichever is shorter.</p>

<h3>
<a id="pgfId-1270990"></a>Compres<a id="compression_analysis"></a>sion Analy<a id="marker-1297941"></a>sis</h3>

<p>
<a id="pgfId-1272311"></a>Compression analysis automatically finds the compression point without needing to define a sweep of the input power. Multiple compression levels can be set in the <em>Compression Level (dB)</em> field. Separate the levels with a space.</p>
<p>
<a id="pgfId-1275007"></a>First, set a reasonable number of harmonics that is enough for the simulation to be accurate at the compression point.</p>
<p>
<a id="pgfId-1272315"></a>To enable compression analysis:</p>
<ol><li>
<a id="pgfId-1282055"></a>Select the check box to the right of <em>Compression</em> in the <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1291757"></a>If desired, select <em>Rapid Mode</em>. In this mode you must specify the approximate input referred compression level. This mode is most useful for Monte Carlo and Corners runs where there are many simulations.</li><li>
<a id="pgfId-1282989"></a>Select <em>Power</em> or <em>Voltage</em> from the <em>Gain Definition</em> drop-down list.<br />
<a id="pgfId-1279735"></a><div class="webflare-div-image">
<img width="419" height="802" src="images/Chap3-54.gif" /></div></li><li>
<a id="pgfId-1271179"></a>Select either the <em>Small-Signal Gain</em> or the <em>Maximum Gain</em> as the <em>Gain Reference</em>.<br />
<a id="pgfId-1279870"></a><div class="webflare-div-image">
<img width="437" height="792" src="images/Chap3-55.gif" /></div></li><li>
<a id="pgfId-1271946"></a>Set the compression level. This can be a list of values separated by a space for normal mode, and must be a single value for Rapid Mode. Also set the harmonic number of the output. To view the harmonic frequencies, click <em>Choose</em> to the right of the <em>Output/Load Harmonic</em> field.<br />
<a id="pgfId-1280041"></a><div class="webflare-div-image">
<img width="427" height="781" src="images/Chap3-56.gif" /></div></li><li>
<a id="pgfId-1280042"></a>Select the output source and output load.</li><li>
<a id="pgfId-1393137"></a>If required, enter a value in the <em>Backoff</em> field. When you specify a value (in dB) in this field, there can only be a single value of compression. The simulator runs the compression analysis and then lowers the power from the compression point by the specified value. Next, it runs HB and all hb&lt;xx&gt; analyses specified at that reduced input power level.</li><li>
<a id="pgfId-1393380"></a>Run the simulation.</li><li>
<a id="pgfId-1282632"></a>Open the <em>Direct Plot Form</em>. To plot the compression results, select <em>xdb</em>.<br />
<a id="pgfId-1280047"></a><div class="webflare-div-image">
<img width="368" height="349" src="images/Chap3-57.gif" /></div></li></ol>























<h3>
<a id="pgfId-1389163"></a>Large-Signal S-Parameters</h3>

<p>
<a id="pgfId-1389164"></a>In the harmonic balance setup, make sure you set the number of harmonics manually to a number large enough to capture an accurate solution at the highest power level of the sweep. Auto harmonics should be avoided because it will set harmonics based on the lowest power level in the sweep.</p>
<ol><li>
<a id="pgfId-1389165"></a>In the hb Choosing Analyses form, select LSSP check box.</li><li>
<a id="pgfId-1389166"></a>Click the <em>Select</em> button to the right of the Ports field and select the input and output ports in the circuit. </li><li>
<a id="pgfId-1389167"></a>Click <em>Show</em> to the right of the Load Harmonic field and select the output frequency from the list.</li><li>
<a id="pgfId-1389168"></a>Click the <em>Sweep</em> check box. In this example, the input power is set by the variable prf, which is swept from -20 to 0 dBm with 1 dB steps. Note that when LSSP is enabled, small-signal analyses like hbnoise cannot be run.<br /><ffi2-fig-frame-in-2 id="#id1389209">
<a id="pgfId-1389209"></a></ffi2-fig-frame-in-2><div class="webflare-div-image">
<img width="668" height="745" src="images/Chap3-58.gif" /></div></li><li>
<a id="pgfId-1389258"></a>Run the simulation.</li><li>
<a id="pgfId-1389278"></a>When the simulation completes, select <em>Result</em> - <em>Direct Plot</em> - <em>Main Form</em>.</li><li>
<a id="pgfId-1389302"></a>In the Direct Plot Form, select what you want to plot and the type of chart to plot on. This example shows S11 plotted on a Z-Smith chart.<br />
<a id="pgfId-1389144"></a><div class="webflare-div-image">
<img width="668" height="543" src="images/Chap3-59.gif" /></div></li></ol>














<p>
<a id="pgfId-1389342"></a>S11 results are plotted in the waveform tool, as shown below.</p>

<p>
<a id="pgfId-1389353"></a></p>
<div class="webflare-div-image">
<img width="668" height="418" src="images/Chap3-60.gif" /></div>

<p>
<a id="pgfId-1389387"></a>In the waveform tool, select <em>Marker</em> - <em>Snap Tracking Cursor</em>. The cursor will snap to the data points. The sweep power level is shown below the measurement.</p>

<h3>
<a id="pgfId-1280048"></a>Oscillator Additions</h3>

<p>
<a id="pgfId-1077012"></a>In the <em>Choosing Analyses</em> form, select <em>Names</em> or <em>Frequencies</em>.</p>

<p>
<a id="pgfId-1077016"></a></p>
<div class="webflare-div-image">
<img width="668" height="48" src="images/Chap3-61.gif" /></div>
<h4>
<a id="pgfId-1077264"></a><bold>
Tones = Frequencies
<a id="marker-1298003"></a></bold></h4>

<ol><li>
<a id="pgfId-1077017"></a>If you have an oscillator, select <em>Oscillator</em>.<br />
<a id="pgfId-1077025"></a><div class="webflare-div-image">
<img width="668" height="158" src="images/Chap3-62.gif" /></div>
<a id="pgfId-1077036"></a><em>Tone 1</em> will automatically change to <em>osc!</em>.<br />
<a id="pgfId-1077161"></a>The oscillator node location in the circuit only needs to have a signal on it.</li><li>
<a id="pgfId-1077130"></a>Select <em>Decide automatically</em> from the <em>Run transient?</em> drop-down list. This will cause an estimate of the oscillator frequency and amplitude to be run, then the transient runs in the tstab interval, but only to the point of steady-state. Once steady-state is reached, a Fourier transform is calculated, and the frequency domain iterations begin.<br />
<a id="pgfId-1077304"></a><div class="webflare-div-image">
<img width="668" height="121" src="images/Chap3-63.gif" /></div></li><li>
<a id="pgfId-1111182"></a>Set the frequencies, number of harmonics, and oversample factor.<br />
<a id="pgfId-1111186"></a><div class="webflare-div-image">
<img width="668" height="163" src="images/Chap3-64.gif" /></div>
<a id="pgfId-1111187"></a>The <em>Fundamental Frequency</em> field should have a value between 0.5 and 1.5 times the actual frequency of oscillation. If <em>Run transient?</em> is set to <em>Decide automatically</em> or <em>Yes</em>, <em>auto</em> is set for the number of harmonics. At the end of the transient in the tstab interval, the number of harmonics will be set automatically based on the waveforms in the tstab interval.</li><li>
<a id="pgfId-1111173"></a>Select <em>conservative</em> for oscillators.<br />
<a id="pgfId-1077211"></a><div class="webflare-div-image">
<img width="668" height="58" src="images/Chap3-65.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1077232"></a>You should always select <em>conservative</em> for oscillators.</div></li></ol>






















<h4>
<a id="pgfId-1077277"></a><bold>
Tones = Names
<a id="marker-1298028"></a></bold></h4>

<ol><li>
<a id="pgfId-1077338"></a>If you have an oscillator, select <em>Oscillator</em>. The system will display a popup window that reminds you to provide an estimate for the oscillation field.<br />
<a id="pgfId-1077354"></a><div class="webflare-div-image">
<img width="668" height="153" src="images/Chap3-66.gif" /></div>
<a id="pgfId-1077288"></a>The oscillator node location in the circuit only needs to have a signal on it. </li><li>
<a id="pgfId-1077392"></a>Specify a value in the <em>Expr</em> field that is between 0.5 and 1.5 times the actual frequency of oscillation.<br />
<a id="pgfId-1077449"></a><div class="webflare-div-image">
<img width="668" height="220" src="images/Chap3-67.gif" /></div></li><li>
<a id="pgfId-1111410"></a>Select <em>Decide Automatically</em> from the <em>Run transient?</em> drop-down list. This will cause tstab to be run only until steady-state is reached, where a Fourier transform is calculated, and the frequency domain iterations in harmonic balance begin.<br />
<a id="pgfId-1111413"></a><div class="webflare-div-image">
<img width="668" height="123" src="images/Chap3-68.gif" /></div></li><li>
<a id="pgfId-1111414"></a><em>Decide automatically</em> also evaluates the Fourier transform at the end of the tstab interval, and sets the harmonics based on the actual spectrum. The word <em>auto</em> appears in the <em>Mxharm</em> field.<br />
<a id="pgfId-1253350"></a><div class="webflare-div-image">
<img width="502" height="244" src="images/Chap3-69.gif" /></div></li><li>
<a id="pgfId-1111495"></a>Select <em>conservative</em> accuracy for oscillators.<br />
<a id="pgfId-1077503"></a><div class="webflare-div-image">
<img width="668" height="51" src="images/Chap3-70.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1077456"></a>You should always select <em>conservative</em> for oscillators.</div></li></ol>

























<h3>
<a id="pgfId-1273107"></a>Oscillator Tu<a id="tuningmode"></a>ning Mo<a id="marker-1298049"></a>de</h3>

<p>
<a id="pgfId-1273183"></a>Oscillator tuning mode is provided to tune the oscillator to a desired frequency and then run the selected small-signal analyses. This is useful for sweeps and for Monte Carlo simulations. To run an oscillator tuning analysis, do the following:</p>
<ol><li>
<a id="pgfId-1273203"></a>Open an oscillator circuit, and start ADE Explorer. Open the hb <em>Choosing Analyses</em> form, and select hb analysis.</li><li>
<a id="pgfId-1273222"></a>Fill out the form as usual, except for the following:<ol><li>
<a id="pgfId-1273229"></a>In the <em>Fundamental Frequency</em> field, type the desired frequency target.</li><li>
<a id="pgfId-1273236"></a>Click the check box next to <em>Enable tuning mode analysis</em>.</li></ol></li><li>
<a id="pgfId-1273251"></a>Select whether you want to tune a variable, temperature, or a component parameter. The example below shows a variable.<br />
<a id="pgfId-1280194"></a><div class="webflare-div-image">
<img width="448" height="783" src="images/Chap3-71.gif" /></div></li><li>
<a id="pgfId-1273394"></a>Enable the desired small-signal analyses.</li><li>
<a id="pgfId-1273449"></a>Run the analyses. When the simulation completes, open the <em>Direct Plot Form</em> from ADE Explorer.<br />
<a id="pgfId-1280309"></a><div class="webflare-div-image">
<img width="370" height="461" src="images/Chap3-72.gif" /></div></li></ol>













<h3>
<a id="pgfId-1077518"></a>Probe-Based Me<a id="marker-1298076"></a>thod</h3>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1111726"></a>Earlier, this used to be called the two-tier method.</div>
<p>
<a id="pgfId-1077535"></a>In the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1077576"></a>Choose <em>Frequencies</em> or <em>Names</em>.<br />
<a id="pgfId-1077546"></a><div class="webflare-div-image">
<img width="668" height="77" src="images/Chap3-73.gif" /></div></li><li>
<a id="pgfId-1077595"></a>Select <em>Use the probe-based solution method.</em><br />
<a id="pgfId-1077605"></a><div class="webflare-div-image">
<img width="668" height="794" src="images/Chap3-74.gif" /></div></li></ol>









<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1077626"></a>When the probe based method is used, the only choice is to set the <em>Run transient?</em> option to <em>No</em>.</div>
<ol><li>
<a id="pgfId-1112035"></a>Select an oscillator node that is inside the feedback system for <em>Pinnode+</em>.<br />
<a id="pgfId-1077639"></a><div class="webflare-div-image">
<img width="668" height="313" src="images/Chap3-75.gif" /></div></li><li>
<a id="pgfId-1077646"></a>If you have a differential circuit, select the differential node at the mirror location in the feedback system for <em>Pinnode</em>-.</li><li>
<a id="pgfId-1077689"></a>Leave the <em>Harmonic Index</em> and <em>Magnitude</em> fields blank.</li></ol>







<h3>
<a id="pgfId-1077702"></a>Semi-Au<a id="marker-1298093"></a>tonomous</h3>

<p>
<a id="pgfId-1112293"></a>Semi-Autonomous allows an oscillator and a periodic source to be simulated at the same time.</p>
<p>
<a id="pgfId-1077724"></a>In the <em>Choosing Analyses</em> form, select <em>Names</em> or <em>Frequencies</em>.</p>

<p>
<a id="pgfId-1077728"></a></p>
<div class="webflare-div-image">
<img width="668" height="76" src="images/Chap3-76.gif" /></div>
<h4>
<a id="pgfId-1077716"></a><strong>Frequencies</strong></h4>

<ol><li>
<a id="pgfId-1077749"></a>Select <em>Oscillator</em>.<br />
<a id="pgfId-1077762"></a><div class="webflare-div-image">
<img width="668" height="512" src="images/Chap3-77.gif" /></div></li><li>
<a id="pgfId-1077773"></a>Select the number of tones as desired.</li><li>
<a id="pgfId-1098202"></a>Type an estimate for the <em>Fundamental Frequency</em> in the <em>osc!</em> column.</li><li>
<a id="pgfId-1098203"></a>Type the frequencies for the periodic sources in the other columns.</li><li>
<a id="pgfId-1077889"></a>Set the number of harmonics and the oversample factor as required. If <em>Run transient?</em> is set to<em> Decide automatically</em> or <em>Yes</em>, then <em>auto</em> is entered for the number of harmonics in the first tone only. This can be set manually, if desired. The number of harmonics for the rest of the tones must be set manually.</li><li>
<a id="pgfId-1253779"></a>If there is a frequency divider after the oscillator in the circuit, set the divider ratio in the <em>Freqdivide Ratio for Tone 1</em> field. Remember to set oversample factor and enough harmonics when this is set.</li><li>
<a id="pgfId-1253781"></a>If you want to reduce the number of harmonics set, choose <em>Select</em> from the <em>Harmonics</em> drop-down list and set <em>MaximOrder</em>.<br />
<a id="pgfId-1077956"></a><div class="webflare-div-image">
<img width="635" height="291" src="images/Chap3-78.gif" /></div></li><li>
<a id="pgfId-1077984"></a>Select <em>conservative</em>.<br />
<a id="pgfId-1077994"></a><div class="webflare-div-image">
<img width="635" height="44" src="images/Chap3-79.gif" /></div></li><li>
<a id="pgfId-1078058"></a>If you want to view the startup waveform, select <em>yes</em> for <em>Save Initial Transient Results (saveinit)</em>.</li><li>
<a id="pgfId-1078074"></a>Specify the oscillator nodes in the circuit.<br />
<a id="pgfId-1078085"></a><div class="webflare-div-image">
<img width="668" height="109" src="images/Chap3-80.gif" /></div></li></ol>
























<h4>
<a id="pgfId-1078145"></a><strong>Names</strong></h4>

<ol><li>
<a id="pgfId-1078170"></a>Select <em>Oscillator</em>. The system will display a popup window that reminds you to supply an estimate for the <em>Expr</em> field.<br />
<a id="pgfId-1078174"></a><div class="webflare-div-image">
<img width="668" height="744" src="images/Chap3-81.gif" /></div></li><li>
<a id="pgfId-1078162"></a>Specify the frequency in the <em>Expr</em> field.<br />
<a id="pgfId-1078225"></a><div class="webflare-div-image">
<img width="668" height="248" src="images/Chap3-82.gif" /></div></li><li>
<a id="pgfId-1078239"></a>Select Decide automatically from the <em>Run Transient?</em> drop-down list. This will cause Spectre to run a transient in the tstab interval until steady-state is reached. Then, a Fourier transform is calculated, and the frequency domain iterations begin.</li><li>
<a id="pgfId-1112801"></a>Set the harmonics and the oversample factor as required. If <em>Run transient?</em> is set to <em>Decide automatically</em> or <em>Yes</em>, then <em>auto</em> is entered for the number of harmonics in the first tone only. This can be set manually, if desired. The number of harmonics for the rest of the tones must be set manually.</li><li>
<a id="pgfId-1078286"></a>Click <em>Change, or</em> select another field, or use the &lt;<em>Tab</em>&gt; key.</li><li>
<a id="pgfId-1078318"></a>If there is a frequency divider after the oscillator in the circuit, set the divider ratio in the <em>Freqdivide Ratio for Tone 1</em> field. Remember to set oversample factor and enough harmonics when this is set.</li><li>
<a id="pgfId-1078323"></a>If you want to reduce the number of harmonics set, choose <em>Select</em> from the <em>Harmonics</em> drop-down list.<br />
<a id="pgfId-1078327"></a><div class="webflare-div-image">
<img width="635" height="292" src="images/Chap3-83.gif" /></div></li><li>
<a id="pgfId-1078328"></a>Select <em>Conservative</em>.</li><li>
<a id="pgfId-1078338"></a>If you want to view the startup waveform, select <em>yes</em> for <em>Save Initial Transient Results (saveinit)</em>.</li><li>
<a id="pgfId-1078339"></a>Specify the oscillator nodes in the circuit. This node can be any node in the circuit where the oscillations are present.</li></ol>






















<h3>
<a id="pgfId-1078360"></a>Commonly Used Harmonic B<a id="hb_options"></a>alance O<a id="marker-1298115"></a>ptions (Driven Circuits and Oscillators)</h3>

<p>
<a id="pgfId-1101475"></a>The <em>Harmonic Balance</em> <em>Options</em> form deliberately omits uncommonly used options. In the unlikely case that you need options that are available in pss-harmonic balance, you will need to determine the <code>option name=value</code> pairs and enter this information in the <em>additionalParams</em> field in the <em>Misc</em> tab. The easiest way to get these<code> option name=value</code> pairs is to set the option in a dummy pss analysis, use ADE Explorer to create the netlist, and then highlight the text in the netlist reader. This text can be entered in the <em>additionalParams</em> field by clicking the center mouse button.</p>
<p>
<a id="pgfId-1104196"></a>The options are divided into five tabs: <em>Convergence</em>, <em>Accuracy</em>, <em>Output</em>, <em>Reuse</em>, and <em>Misc</em> (miscellaneous).</p>
<p>
<a id="pgfId-1101476"></a>The options are shown in the order that they appear in the <em>Harmonic Balance Options</em> form in ADE Explorer.</p>

<h3>
<a id="pgfId-1101477"></a>Convergence tab</h3>
<p>
<a id="pgfId-1101481"></a></p>
<div class="webflare-div-image">
<img width="668" height="561" src="images/Chap3-84.gif" /></div>
<h4>
<a id="pgfId-1101482"></a>Maxp<a id="marker-1298141"></a>eriods</h4>

<p>
<a id="pgfId-1102417"></a>This specifies the maximum number of iterations for the hb algorithm. The default is 100. If this option is set less than 100, it will be ignored.</p>

<p>
<a id="pgfId-1254311"></a></p>
<div class="webflare-div-image">
<img width="416" height="38" src="images/Chap3-85.gif" /></div>
<h4>
<a id="pgfId-1102467"></a>It<a id="marker-1298151"></a>res</h4>

<p>
<a id="pgfId-1102477"></a>This option specifies the precision for the solution of the first iteration in harmonic balance. For subsequent iterations, the precision is increased so that when the iterations end, full precision is used. The default is 0.1, which allows up to 10% error in the first iteration. If you have a linear or near linear circuit like an LNA, lower itres to the 1e-2 to 1e-4 range so that the solution for the first iteration is more precise. Fewer iterations will be required for the solution to converge.</p>

<p>
<a id="pgfId-1254349"></a></p>
<div class="webflare-div-image">
<img width="416" height="36" src="images/Chap3-86.gif" /></div>
<h4>
<a id="pgfId-1102406"></a><a id="marker-1298157"></a>pinnode</h4>

<p>
<a id="pgfId-1276501"></a>This option is only available for oscillators. Type the pathname to the pinnode in this field. and example is I3.resonator. Do not use a slash (/) at the beginning of the name.</p>

<h4>
<a id="pgfId-1276493"></a>save osc ppv</h4>

<p>
<a id="pgfId-1276522"></a>This option is no longer used.</p>

<h4>
<a id="pgfId-1276510"></a>I<a id="marker-1298166"></a>c</h4>

<p>
<a id="pgfId-1101483"></a>Initial conditions can be specified graphically by selecting <em>Simulation</em> - <em>Convergence Aids</em> - <em>Initial Condition</em> in ADE Explorer. Initial conditions can also be specified from a file using the <em>readic</em> property. Capacitors and inductors have the initial condition properties in the property list for the component. For capacitors, this is an initial voltage across the capacitor, and for inductors, it is an initial current in the inductor. The default is to observe all the initial conditions in the DC analysis that is used as the time-zero timepoint in the tstab interval. The initial conditions force a voltage or current to be present in the time-zero solution. The initial conditions are released for the rest of the transient simulation in the tstab interval. The <em>ic</em> option controls the initial conditions that should be observed in the time-zero timepoint. <em>all</em> is the default. <em>dev</em> means that only the initial conditions on capacitors and inductors are observed. <em>node</em> means that only the initial conditions on a node are observed. <em>dc</em> means that no initial conditions are observed. The example below shows the ic option set to <em>node</em>.</p>

<p>
<a id="pgfId-1101487"></a></p>
<div class="webflare-div-image">
<img width="668" height="33" src="images/Chap3-87.gif" /></div>
<h4>
<a id="pgfId-1101488"></a>Ski<a id="marker-1298174"></a>pdc</h4>

<p>
<a id="pgfId-1101489"></a>In some cases, the time-zero timepoint DC analysis does not converge. Instead of stopping the simulation, <em>skipdc</em> allows the tstab simulation to continue using an assumed solution for the time-zero timepoint. The default is <em>no</em> and a DC analysis is run to get the initial timepoint. <em>yes</em> means skip the DC solution, and proceed directly to the tstab simulation. All the nodes with initial conditions specified start at the initial condition value. Nodes with batteries start at the battery voltage. Nodes with no initial conditions start at zero volts. For <code>skipdc=yes</code>, the signal sources start as specified immediately in the tstab simulation. <em>sigrampup</em> uses the same assumptions for the starting voltages as <em>yes</em> does, but the start time is set to negative one tenth of the stop time for the tstab interval. At this time, the signal source time-varying part starts at zero and linearly ramps up to the full value at time = zero. After time = zero, the sources have the full amplitude time-varying part. The example below shows the <em>skipdc</em> option set to <em>sigrampup</em>.</p>

<p>
<a id="pgfId-1101493"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap3-88.gif" /></div>
<h4>
<a id="pgfId-1101494"></a>Re<a id="marker-1298187"></a>adic (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1101495"></a>This specifies an ascii file that contains two columns to be read as initial conditions. The first column is the node name. The second column is the voltage value. If the entry in the <em>readic</em> field does not start with / (slash), the entry is located in the netlist directory. To find the netlist directory, select <em>Setup</em>- <em>Simulator/Directory/Host</em> in ADE Explorer. Look in the <em>Project Directory</em> field for the location of the simulation directory. Navigate to that directory and then to the <span class="webflare-courier-new" style="white-space:pre"><em>&lt;Circuit Name&gt;</em></span><code>/spectre/</code><span class="webflare-courier-new" style="white-space:pre"><em>&lt;schematic or config&gt;</em></span><code>/netlist</code> directory. You can also click (<img width="30" height="24" src="images/Chap3-89.gif" />
) and browse to the directory. An example is shown below.</p>

<p>
<a id="pgfId-1101502"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap3-90.gif" /></div>
<h4>
<a id="pgfId-1101503"></a>Rea<a id="marker-1298196"></a>dns</h4>

<p>
<a id="pgfId-1101504"></a>This specifies an ascii file with the same format as an ic file that is used as nodesets for the time-zero DC solution. Nodesets do not force a voltage to be held for the time-zero solution. Instead, they are a way of speeding up the time-zero calculation. As a suggestion, set the <em>write</em> option and the <em>readns</em> option to the same filename. The <em>write</em> option writes the time-zero solution to a file. When this is used as a starting point, many fewer iterations are needed for the time-zero point to converge. An example is shown below.</p>

<p>
<a id="pgfId-1101508"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap3-91.gif" /></div>
<h4>
<a id="pgfId-1101509"></a>Cm<a id="marker-1298201"></a>in</h4>

<p>
<a id="pgfId-1101510"></a><em>cmin</em> can be used to improve convergence in the tstab and shooting intervals for shooting and for the tstab interval for harmonic balance. If a value is set for <em>cmin</em>, a capacitor with this value is added to every node with the other terminal of the capacitor connected to the global ground node. If a 10f to 50f capacitor is added, this prevents instantaneous changes from occurring from timepoint to timepoint, thus improving the convergence at the cost of adding non-physical capacitors to the circuit. An example with 10 femtoFarads is shown below. Note that if 10 is entered, a 10 Farad capacitor is added from every node to ground. Remember the multiplier in the entry. An example is shown below.</p>

<p>
<a id="pgfId-1101514"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap3-92.gif" /></div>
<p>
<a id="pgfId-1101520"></a></p>
<h3>
<a id="pgfId-1101521"></a>Accuracy Tab </h3>

<p>
<a id="pgfId-1101522"></a>The <em>Accuracy</em> tab is split into two categories, <em>TIME STEP PARAMETERS</em> and <em>INTEGRATION METHOD PARAMETERS</em>. </p>

<p>
<a id="pgfId-1101526"></a></p>
<div class="webflare-div-image">
<img width="668" height="368" src="images/Chap3-93.gif" /></div>
<h4>
<a id="pgfId-1101530"></a>Max<a id="marker-1298223"></a>step</h4>

<p>
<a id="pgfId-1102840"></a>This is the maximum allowable timestep for the transient analysis in the tstab interval.</p>

<h4>
<a id="pgfId-1102824"></a>Tsta<a id="marker-1298231"></a>bmethod</h4>

<p>
<a id="pgfId-1101531"></a>This option controls the integration method in the tstab interval. The default value is determined by the setting of <em>errpreset</em> and whether the circuit is driven or is an oscillator. For <em>moderate</em> and <em>conservative</em> with a driven circuit, the default is <em>gear2only</em>. For <em>liberal</em> it is <em>traponly</em>. Generally, <em>gear2only</em> is preferred because of the absence of trapezoidal ringing inherent in the <em>trap</em> (trapezoidal) method. The default for <em>tstabmethod</em> is <em>traponly</em> for oscillators. <em>traponly</em> is used for oscillators because with the defaults, the tstab interval uses relatively loose convergence options in order to speed up the simulation. This causes relatively long timesteps which for the <em>gear2</em> method cause noticeable numerical damping. <em>traponly</em> does not numerically damp, therefore, it provides a better estimate of the oscillating frequency and amplitude. An example with <em>tstabmethod</em> set to <em>gear2only</em> is shown below.</p>

<p>
<a id="pgfId-1116407"></a></p>
<div class="webflare-div-image">
<img width="668" height="56" src="images/Chap3-94.gif" /></div>
<h3>
<a id="pgfId-1101662"></a>Output Tab</h3>
<p>
<a id="pgfId-1101666"></a></p>
<div class="webflare-div-image">
<img width="668" height="377" src="images/Chap3-95.gif" /></div>
<h4>
<a id="pgfId-1101667"></a>Anno<a id="marker-1298247"></a>tate</h4>

<p>
<a id="pgfId-1101668"></a>This option is currently not implemented.</p>

<h4>
<a id="pgfId-1101693"></a>Sav<a id="marker-1298253"></a>e</h4>

<p>
<a id="pgfId-1101694"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved. In ADE Explorer, this is accomplished by selecting <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Design</em> and then selecting the nodes and terminals specifically in the schematic. At the netlist level, this is accomplished by using a save statement with a list of names to be saved. </p>

<h4>
<a id="pgfId-1101695"></a>Nest<a id="marker-1298263"></a>lvl (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1101696"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> can be any integer. The example below shows <em>lvlpub</em> selected that saves two levels of hierarchy.</p>

<p>
<a id="pgfId-1101700"></a></p>
<div class="webflare-div-image">
<img width="668" height="71" src="images/Chap3-96.gif" /></div>
<h4>
<a id="pgfId-1101701"></a>Compres<a id="marker-1298269"></a>sion (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1101702"></a>Normally, this should not be used for RF simulation. It is not digital compression. For RF simulation, where the input is sinusoidal, the size of the results file will normally double. It is useful only for circuits that are predominantly square wave.</p>

<h3>
<a id="pgfId-1101725"></a>Reuse Tab</h3>
<p>
<a id="pgfId-1101729"></a></p>
<div class="webflare-div-image">
<img width="668" height="457" src="images/Chap3-97.gif" /></div>
<h4>
<a id="pgfId-1101755"></a>Write<a id="marker-1298298"></a>hb</h4>

<p>
<a id="pgfId-1101756"></a>This option specifies that the full internal state of the harmonic balance analysis be written out to the file specified in the option. An example is shown below.</p>

<p>
<a id="pgfId-1101760"></a></p>
<div class="webflare-div-image">
<img width="668" height="42" src="images/Chap3-98.gif" /></div>
<h4>
<a id="pgfId-1101766"></a>Read<a id="marker-1298305"></a>hb</h4>

<p>
<a id="pgfId-1101767"></a>This option specifies the file to be read in as a starting point for the next harmonic balance analysis. If nothing is changed in the circuit, then only one iteration is performed and small-signal analyses can be run with a much faster time for the hb analysis. Changes can be made to the circuit or analysis options as long as the topology of the circuit stays the same. The changes introduce a discontinuity at the beginning of the hb analysis, which might be large enough to cause hb not to converge. </p>
<p>
<a id="pgfId-1101768"></a>An example of <em>readhb</em> is shown below.</p>

<p>
<a id="pgfId-1101772"></a></p>
<div class="webflare-div-image">
<img width="668" height="34" src="images/Chap3-99.gif" /></div>
<h4>
<a id="pgfId-1101780"></a>Save<a id="marker-1298321"></a>clock</h4>

<p>
<a id="pgfId-1101781"></a><em>saveclock</em> saves the state of the simulation in the tstab interval at the clock time interval in seconds specified by <em>saveclock</em>. When the clock time has passed in the tstab interval, the file specified by the option <em>savefile</em> is created. When subsequent clock time intervals have passed, the file is overwritten. Use only one of the save options at a time. The example below shows <em>saveclock</em> set to three minutes.</p>

<p>
<a id="pgfId-1101785"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap3-100.gif" /></div>
<h4>
<a id="pgfId-1101786"></a>Savep<a id="marker-1298332"></a>eriod</h4>

<p>
<a id="pgfId-1101787"></a><em>saveperiod</em> saves the state of the simulation in the tstab interval at the simulation time interval in seconds specified by <em>saveperiod</em>. When the simulation time has passed in the tstab interval, the file specified by the option savefile is created. When subsequent simulation time intervals have passed, the file is overwritten. Use only one of the save options at a time. The example below shows <em>saveperiod</em> set to 25 nanoseconds.</p>

<p>
<a id="pgfId-1101791"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap3-101.gif" /></div>
<h4>
<a id="pgfId-1101792"></a>Sav<a id="marker-1298337"></a>etime</h4>

<p>
<a id="pgfId-1101793"></a><em>savetime</em> is a list of times in the tstab interval where the state of the simulation is written out. The list should be specified with spaces between the entries. The information is written out with the filename specified in the <em>savefile</em> option with extensions for the time after that. Use only one of the save options at a time.</p>
<p>
<a id="pgfId-1101794"></a>The example below shows four times in the tstab interval to save.</p>

<p>
<a id="pgfId-1101798"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap3-102.gif" /></div>
<h4>
<a id="pgfId-1101799"></a>Save<a id="marker-1298346"></a>file</h4>

<p>
<a id="pgfId-1101800"></a>This is the file name to write out the tstab state information to. If you do not specify a filename that starts with the slash (/) character, the file is stored in the <em>netlist</em> directory. To locate the <em>netlist</em> directory, first select <em>Setup</em> - <em>Simulator/Directory/Host</em> menu in ADE Explorer, and read the path to the project directory. This is the path to the <em>simulation</em> directory. In the simulation directory, navigate to the <em>&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>circuit_name</em></span><em>&gt;/spectre/&lt;schematic or config&gt;/netlist</em> directory.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1101801"></a>Do not specify a relative path name like <em>./save_file/run1</em>.</div>

<h4>
<a id="pgfId-1101802"></a>Rec<a id="marker-1298361"></a>over (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1101803"></a><em>recover</em> specifies the file name to recover the tstab simulation from. If <em>saveperiod</em> or <em>saveclock</em> are used to make the savefile, then the same name as specified in <em>savefile</em> is used. If <em>savetimes</em> has a list of times specified, then several files are created at the times specified in the list. Click (<img width="31" height="26" src="images/Chap3-103.gif" />
) and browse to the netlist directory where the savefiles are shown.</p>

<p>
<a id="pgfId-1101810"></a></p>
<div class="webflare-div-image">
<img width="668" height="454" src="images/Chap3-104.gif" /></div>

<p>
<a id="pgfId-1101811"></a>Select one from the list, and click <em>Open</em>. This adds the full path to the <em>recover</em> option, as shown below. Also note that in the example below, the <em>savefile</em> option is still set, and times after the restart times are specified. This is specifically allowed. As long as tstab is 200n or larger, the files at 175n and 200n will be added and can be reused later.</p>

<p>
<a id="pgfId-1101815"></a></p>
<div class="webflare-div-image">
<img width="668" height="212" src="images/Chap3-105.gif" /></div>

<p>
<a id="pgfId-1101816"></a>Now change tstab to a later time. In this case, 200n is set.</p>

<p>
<a id="pgfId-1101820"></a></p>
<div class="webflare-div-image">
<img width="668" height="800" src="images/Chap3-106.gif" /></div>

<p>
<a id="pgfId-1101821"></a>When the simulation runs, the savefiles are created, as shown below.</p>

<p>
<a id="pgfId-1101825"></a></p>
<div class="webflare-div-image">
<img width="648" height="455" src="images/Chap3-107.gif" /></div>

<p>
<a id="pgfId-1101826"></a>The waveform from the original tstab and the restarted tstab overlay is shown below.</p>

<p>
<a id="pgfId-1101830"></a></p>
<div class="webflare-div-image">
<img width="668" height="425" src="images/Chap3-108.gif" /></div>

<p>
<a id="pgfId-1101831"></a>Even in the zoomed-in view, the waveforms overlay, as shown below.</p>

<p>
<a id="pgfId-1101835"></a></p>
<div class="webflare-div-image">
<img width="668" height="423" src="images/Chap3-109.gif" /></div>
<h3>
<a id="pgfId-1101836"></a>Misc Tab</h3>
<p>
<a id="pgfId-1101840"></a></p>
<div class="webflare-div-image">
<img width="668" height="710" src="images/Chap3-110.gif" /></div>
<h4>
<a id="pgfId-1158230"></a>New Initial Val<a id="marker-1298454"></a>ue For Each Point (restart)</h4>

<p>
<a id="pgfId-1254654"></a>Restart is an option that controls the behavior of the simulator in a sweep or in Monte Carlo. If restart is yes, then the simulation restarts from scratch for every sweep point. This can cause excessive runtimes and/or convergence difficulties. When restart is no, the previous member of a sweep or Monte Carlo is used as the starting point for this analysis. If this point does not converge, a variety of methods are applied automatically to try to get convergence. These methods include parameter sweeping, backing off the source power and then ramping it back up in increments, and running a tstab simulation.</p>

<h4>
<a id="pgfId-1276278"></a>xdb<a id="marker-1298460"></a>steps</h4>

<p>
<a id="pgfId-1276309"></a>Normally, this option doesn&#8217;t need to be set. <em>xdbsteps</em> is an option that enables you to specify the maximum number steps for the compression point search. The simulator terminates if the value specified in the <code>xdbsteps</code> field is exceeded before the compression point in found. The default value is 100.</p>

<h4>
<a id="pgfId-1276299"></a>xdb<a id="marker-1436054"></a>max</h4>

<p>
<a id="pgfId-1276316"></a>Normally, this option does not need to be set. The <em>xdbmax</em> option enables you to specify the maximum input power or voltage for the compression point search. The default is +30 dBm when <em>Gain Definition</em> is set to <em>Power</em> and 2.0V when <em>Gain Definition</em> is set to <em>Voltage</em>.</p>

<h4>
<a id="pgfId-1276292"></a>xdb<a id="marker-1436057"></a>start</h4>

<p>
<a id="pgfId-1276339"></a>Normally, this option does not need to be set. The <em>xdbstart</em> option enables you to set the starting power or voltage. The default is xdbmax - 70 when <em>Gain Definition</em> is set to <em>Power</em> and xdbmax/20000 when <em>Gain Definition</em> is set to <em>Voltage</em>.</p>

<h4>
<a id="pgfId-1294536"></a>xdb<a id="marker-1436060"></a>tol</h4>

<p>
<a id="pgfId-1294528"></a>Normally, this option does not need to be set. The <em>xdbtol</em> option controls the maximum delta between sweep values and sets the maximum delta between the actual harmonic balance last power or voltage level and the largest compression value specified for the compression analysis. The default value for <em>xdbtol</em> is 0.01. The actual tolerance between the power or voltage level and the maximum specified power level in the <em>Choosing Analyses</em> form for a normal mode compression analysis is +/- (2.5*xdbtol*maximum compression level+0.001). For a <em>Rapid Mode</em> compression measurement, the tolerance is doubled. The maximum change in power during a sweep is 10*xdbtol*(xdbmax-xdbstart). The default for <em>xdbtol</em> is 0.1, so there will be at least 10 points in the sweep. The starting change in power or voltage is half the maximum change.</p>

<h4>
<a id="pgfId-1310977"></a>file</h4>

<p>
<a id="pgfId-1310978"></a>Use the <em>file</em> option to specify the file in which the large-signal S parameters (LSSPs) need to be written.You can specify a file name or click the browse button to browse to the location of the file.</p>

<h4>
<a id="pgfId-1310981"></a>datafmt</h4>

<p>
<a id="pgfId-1310982"></a>The <em>datafmt</em> option specifies the format in which LSSP data is output. Possible values are <em>spectre</em> and <em>touchstone</em>. The default value is <em>touchstone</em>.</p>

<h4>
<a id="pgfId-1310984"></a>datatype</h4>

<p>
<a id="pgfId-1310985"></a>The <em>datatype</em> option sets the data format for the LSSP output. Possible values are <em>realimag</em>, <em>magphase</em>, and <em>dbphase</em>. The default value is <em>magphase</em>.</p>

<h4>
<a id="pgfId-1311042"></a>memory usage estimation</h4>

<p>
<a id="pgfId-1311069"></a>The <em>memory usage estimation</em> option provides an estimate of the memory required to perform Harmonic Balance analysis. If this option is set to <em>yes</em>, an estimate of the memory required to perform hb analysis is printed in the log file. You can use this estimate to plan the computing resources before performing hb analysis. In memory estimation mode, the simulator performs a short simulation and exits after printing the estimate in the log file without saving the harmonic balance results. You must set this option to <em>off</em> to perform actual hb analysis. Memory estimation is not recommended for simulations that require less than 500MB of disk space.</p>

<h4>
<a id="pgfId-1254657"></a><a id="26535"></a>AdditionalParams</h4>

<p>
<a id="pgfId-1101876"></a>This is a field for <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements. Multiple <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements are allowed with a space between them. Generally, this is used to unlock the beta features, however, there is one case where this field might be useful for an option that is not in the GUI.</p>
<p>
<a id="pgfId-1101877"></a>In some cases, in the tstab interval, the timestep collapses to near zero. The symptom is that the percent complete stays at the same value for many reporting intervals in the Spectre output window. In this case, there might be a discontinuity in one of the models. </p>
<p>
<a id="pgfId-1101878"></a>In transient simulation, two things can reduce the timestep; having too much numerical integration error or taking too many iterations at a single timestep can cause the timestep to be cut. Spectre does not report what is causing the timestep to become small. One way to eliminate the possibility of numerical integration error (which is called local truncation error in the simulator) as the cause of reducing the timestep is to set <em>lteratio</em> to 1e9. The disadvantage of this is that it disables the normal method of timestep control, therefore, <em>maxstep</em> must be set to maintain accuracy. </p>
<p>
<a id="pgfId-1101456"></a>Another way to accomplish this is to set <em>lteminstep</em> to a value of about the stop time divided by 1e5. This allows the normal method of timestep control, but if for some reason the numerical integration error wants to cut the timestep too small, the error is ignored. <em>lteminstep</em> is the way to specify this. To do this in the ADE Explorer, type <code>lteminstep=&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>Stop_Time</em></span><code>&gt;/1e5</code>. If you use <code>lteratio=1e9</code>, or if you set <em>lteminstep</em> and you still have very small timesteps, try increasing <em>maxiters</em> in the <em>Convergence</em> tab to between 40 and 100. When <em>lteratio</em> or <em>lteminstep</em> is set and you still have timestep problems, there is likely a discontinuity in either a device model or in a Verilog-A model. An example is shown below.</p>

<p>
<a id="pgfId-1254686"></a></p>
<div class="webflare-div-image">
<img width="460" height="71" src="images/Chap3-111.gif" /></div>
<h3>
<a id="pgfId-1078381"></a><a id="73755"></a>Oscillator O<a id="osc_options"></a>ptions</h3>

<ol><li>
<a id="pgfId-1078725"></a><em>pinnode</em> can be set manually. Do not start the name with a slash. If you have a hierarchical name, it will usually be in the form <em>I1.I10.out1</em>. If you use the probe-based method, do not specify any entry here.<br />
<a id="pgfId-1078752"></a><div class="webflare-div-image">
<img width="668" height="550" src="images/Chap3-112.gif" /></div></li><li>
<a id="pgfId-1078726"></a>The <em>save</em> <em>osc ppv</em> option is obsolete. </li></ol>






<h2>
<a id="pgfId-1078717"></a>Key Outputs in the Sp<a id="marker-1298493"></a>ectre Window</h2>

<p>
<a id="pgfId-1078821"></a>First, the circuit inventory is displayed. In addition, you also get a message that the linear oscic is being used. This is controlled by the <em>Calculate initial conditions (ic) automatically</em> check box.</p>

<p>
<a id="pgfId-1078795"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_63.gif" /></div>

<p>
<a id="pgfId-1078863"></a>Next, you get the output that either indicates that the linear oscic worked, and the estimate of the frequency, or that it failed, and is running tstab.</p>
<p>
<a id="pgfId-1078864"></a>The time of the tstab interval is reported. If <em>Run transient?</em> is set to <em>Decide automatically</em>, you might see one or more messages that indicate the tstab interval is being extended. This usually is only seen for oscillators.</p>
<p>
<a id="pgfId-1113829"></a>For oscillators, the tstab interval includes the time set in tstab plus five periods of the frequency estimate from linear oscic. If linear oscic is not used, it includes five periods of the frequency you estimated in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1078865"></a>The list of the options that are actually used for this phase is listed.</p>
<p>
<a id="pgfId-1078866"></a>The transient output from the tstab interval is next.</p>

<p>
<a id="pgfId-1078855"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_64.gif" /></div>

<p>
<a id="pgfId-1078893"></a>Next, one cycle of the oscillator is simulated.</p>

<p>
<a id="pgfId-1078920"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_65.gif" /></div>

<p>
<a id="pgfId-1078962"></a>At the end of the one cycle, a Fourier transform is done to serve as the starting point in the frequency domain, and a node is picked for the pinnode.</p>
<p>
<a id="pgfId-1078963"></a>The frequency domain iterations start.</p>

<p>
<a id="pgfId-1078950"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_66.gif" /></div>

<p>
<a id="pgfId-1078998"></a>The iterations continue until the delta norm and the residual norm are both less than one.</p>
<p>
<a id="pgfId-1078999"></a>The frequency is reported. The times and memory use are reported.</p>

<p>
<a id="pgfId-1078990"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_67.gif" /></div>

<p>
<a id="pgfId-1079048"></a>The circuit inventory, pin node, and linear oscic are reported.</p>

<p>
<a id="pgfId-1079033"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_68.gif" /></div>

<p>
<a id="pgfId-1079098"></a>The linear oscic frequency is reported.</p>
<p>
<a id="pgfId-1255056"></a>The options used for this part of the simulation are reported.</p>
<p>
<a id="pgfId-1255057"></a>The probe-based method inserts a source connected between the pinnodes. The amplitude and frequency are adjusted until the current is near zero.</p>

<p>
<a id="pgfId-1079088"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_69.gif" /></div>

<p>
<a id="pgfId-1079135"></a>If the probe-based method is used, the initial starting point is determined. The outer loop iterates on the frequency and the inner loop iterates on the amplitude.</p>

<p>
<a id="pgfId-1079127"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_70.gif" /></div>

<p>
<a id="pgfId-1079173"></a>The iterations continue until the source current is near zero, the sum of the currents at all the nodes is near zero, and the delta between iterations is near zero.</p>
<p>
<a id="pgfId-1079174"></a>The tolerances are set by using the errpreset setting (liberal, moderate, conservative).</p>
<p>
<a id="pgfId-1079175"></a>The final frequency is reported. The time and memory statistics are shown.</p>

<p>
<a id="pgfId-1079194"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_71.gif" /></div>
<h2>
<a id="pgfId-1079216"></a>Examples</h2>
<h4>
<a id="pgfId-1079165"></a>RF source setup for all examples in this chapter</h4>

<p>
<a id="pgfId-1079252"></a>The <em>Edit Object Properties</em> form for the port that is used as the RF source is shown below.</p>

<p>
<a id="pgfId-1079261"></a></p>
<div class="webflare-div-image">
<img width="668" height="813" src="images/Chap3-122.gif" /></div>

<p>
<a id="pgfId-1079291"></a>In the <em>Edit Object Properties</em> form:</p>
<ol><li>
<a id="pgfId-1079302"></a>If you select <em>Names</em> in the <em>Choosing Analyse</em>s form, specify a name in the<em> Frequency name 1</em> and <em>Frequency name 2</em> fields.</li><li>
<a id="pgfId-1079365"></a>Set the first sinusoid frequency to a variable name in the <em>Frequency 1</em> field.</li><li>
<a id="pgfId-1079395"></a>Set the <em>Amplitude 1 (dBm) </em>field to a variable name.</li><li>
<a id="pgfId-1079412"></a>Set the <em>Frequency </em>2 field to a variable name.</li><li>
<a id="pgfId-1079422"></a>Set the <em>Amplitude 2(dBm) </em>field to a variable name used to set the first frequency amplitude, if you want the amplitudes to match. If you do not want the amplitudes to match, you can use a different variable name.</li><li>
<a id="pgfId-1079454"></a>Select the <em>Display small signal params</em> check box.</li><li>
<a id="pgfId-1079464"></a>Set the <em>PAC Magnitude</em> field to 1 volt.</li></ol>






<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1079483"></a>Using variables in the entries enables you to change the properties without needing to change the schematic. Although this is useful mostly for ADE Explorer, it works in ADE Assembler also. ADE Assembler allows any property in the schematic to be varied directly without changing the schematic.</div>

<h3>
<a id="pgfId-1079509"></a>ADE Explorer Setup for 1-tone Harmonic Balance (hb) Analysis</h3>

<p>
<a id="pgfId-1079523"></a>The Analog Design Environment (ADE) Explorer window is shown below.</p>

<p>
<a id="pgfId-1079530"></a></p>
<div class="webflare-div-image">
<img width="668" height="508" src="images/Chap3-123.gif" /></div>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1079567"></a>The variable name <em>frf1</em> is set to <code>900M</code> which sets the first frequency in the input port to 900MHz. The variable <em>prf</em> sets the input power for the RF input. The second frequency is zero, which disables that input.</div>
<p>
<a id="pgfId-1079601"></a>To set the 1-tone hb analysis:</p>
<ol><li>
<a id="pgfId-1339599"></a>Open the <em>Choosing Analyses</em> form from the ADE Explorer window. To do this, select <em>Choose</em> from the <em>Analysis</em> menu. Alternatively, expand the <em>Analysis</em> option on the Setup pane and click the <em>Click to add analysis</em> text or click the <em>Choose Analysis</em> button located on the top right corner of the ADE Explorer window. The <em>Choosing Analyses</em> form is displayed, as shown below.<br />
<a id="pgfId-1079622"></a><div class="webflare-div-image">
<img width="464" height="499" src="images/Chap3-124.gif" /></div></li><li>
<a id="pgfId-1087171"></a>In the <em>Choosing Analyses</em> form, select <em>hb</em>. The <em>Choosing Analyses</em> form expands, as shown below.<br />
<a id="pgfId-1339676"></a><div class="webflare-div-image">
<img width="668" height="776" src="images/Chap3-125.gif" /></div></li><li>
<a id="pgfId-1339810"></a>You can specify either the frequencies of the inputs, or get a list of the source names and frequencies in the schematic. <em>Frequencies</em> is select by default for hb analysis.<br />
<a id="pgfId-1339843"></a><div class="webflare-div-image">
<img width="668" height="46" src="images/Chap3-126.gif" /></div></li><li>
<a id="pgfId-1339814"></a><em>Decide automatically</em> is the default for <em>Run Transient?</em>. This is the recommended setting. Except for the frequency, this will set everything to automatic. If you select <em>Yes</em>, you have the option of setting the tstab (transient-aided) time, and the option to automatically manage the tstab stop time.<br />
<a id="pgfId-1339862"></a><div class="webflare-div-image">
<img width="668" height="128" src="images/Chap3-127.gif" /></div></li><li>
<a id="pgfId-1114845"></a>Select <em>1</em> to set the number of tones to 1. This is the default.</li><li>
<a id="pgfId-1087206"></a>Set the frequencies, number of harmonics, and oversample factor.<br />
<a id="pgfId-1087236"></a><em>auto</em> calculates the number of harmonics that are needed based on the Fourier Transform at the end of the tstab interval, and is available for the <em>Decide automatically</em> and <em>Yes</em> selections for <em>Run transient?</em>. If the circuit has square wave signals and you are setting harmonics manually, set the number of harmonics to at least the period of the signal divided by the risetime and set the oversample factor to between 2 and 8.<br />
<a id="pgfId-1339881"></a><div class="webflare-div-image">
<img width="668" height="205" src="images/Chap3-128.gif" /></div></li><li>
<a id="pgfId-1087262"></a>Select the <em>moderate</em> check box. This is the default setting.<br />
<a id="pgfId-1087304"></a>If you need more accuracy, select the <em>conservative</em> check box.<br />
<a id="pgfId-1339836"></a><div class="webflare-div-image">
<img width="668" height="59" src="images/Chap3-129.gif" /></div></li><li>
<a id="pgfId-1087345"></a>When you are done with the setup, run the simulation.Spectre will calculate the number of harmonics and display the result in the Spectre output window, as shown below.<br />
<a id="pgfId-1339979"></a><div class="webflare-div-image">
<img width="668" height="340" src="images/Chap3-130.gif" /></div></li></ol>





































<p>
<a id="pgfId-1087374"></a>When <em>Names</em> is selected, all the sources in the circuit are read into the table along with their frequencies. In this case, there is one source with the frequency set to 900M using the variable <em>frf1</em>.</p>

<p>
<a id="pgfId-1087398"></a></p>
<div class="webflare-div-image">
<img width="668" height="249" src="images/Chap3-131.gif" /></div>

<p>
<a id="pgfId-1340033"></a>To make the changes:</p>
<ol><li>
<a id="pgfId-1087427"></a>Select the line and set the number of harmonics and the oversample factor in the editable fields (shown highlighted above).</li><li>
<a id="pgfId-1087465"></a>Click <em>Change, </em>select another field, or press the &lt;<em>Tab</em>&gt; key.</li><li>
<a id="pgfId-1087475"></a>When you are done, run the simulation.</li></ol>



<h3>
<a id="pgfId-1087482"></a>Plotting Sp<a id="marker-1298593"></a>ectral Content</h3>

<ol><li>
<a id="pgfId-1087496"></a>In the ADE Explorer window, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.<br />
<a id="pgfId-1340085"></a>The <em>Direct Plot Form</em> is displayed, as shown below.<br />
<a id="pgfId-1087518"></a><div class="webflare-div-image">
<img width="374" height="776" src="images/Chap3-132.gif" /></div></li><li>
<a id="pgfId-1087543"></a>Select the <em>hb</em> radio button from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1087556"></a>Select the <em>Voltage</em> radio button from the <em>Function</em> section.</li><li>
<a id="pgfId-1087583"></a>Select the spectrum radio button from the Sweep section.</li><li>
<a id="pgfId-1087596"></a>Select the <em>rms</em> radio button.</li><li>
<a id="pgfId-1115672"></a>Select the dB20 radio button from the Modifier section.</li><li>
<a id="pgfId-1387004"></a>Enter the harmonics in the <em>Value At (harms)</em><a id="valueat"></a> field to plot the value at specific harmonics. You can enter a list of harmonics separate by a space in this field.</li><li>
<a id="pgfId-1087613"></a>If you want this signal to plot automatically when a new simulation is run, select <em>Add To Outputs</em>. The expression is automatically evaluated in ADE.</li><li>
<a id="pgfId-1249661"></a>Select the node that you want to plot on the schematic.<br />
<a id="pgfId-1340138"></a>The output harmonics are shown in the waveform tool. By default, the waveform tool is docked in the ADE Explorer window, as shown below.<br />
<a id="pgfId-1340150"></a><div class="webflare-div-image">
<img width="668" height="540" src="images/Chap3-133.gif" /></div>
<a id="pgfId-1387075"></a>The expression is evaluated in the ADE Explorer window, as shown below.<br />
<a id="pgfId-1387086"></a><div class="webflare-div-image">
<img width="668" height="123" src="images/Chap3-134.gif" /></div>
<a id="pgfId-1340187"></a>You can click the Launch ViVA icon (shown highlighted above) to display the waveform separately in the Virtuoso Visualization and Analysis tool (ViVA), as shown below.<br /><ffi2-fig-frame-in-2 id="#id1087654">
<a id="pgfId-1087654"></a></ffi2-fig-frame-in-2><div class="webflare-div-image">
<img width="668" height="400" src="images/Chap3-135.gif" /></div>
<a id="pgfId-1087681"></a>The dB20 modifier is dB with respect to 1 volt, or dBV.<br />
<a id="pgfId-1087682"></a>To position the markers, move your cursor near the object you want to read, and type <em>m</em>.</li></ol>































<h3>
<a id="pgfId-1087672"></a>Plottin<a id="marker-1298609"></a>g dBm</h3>

<p>
<a id="pgfId-1087702"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1087709"></a>Select <em>hb</em> from the <em>Analysis</em> section.<br />
<a id="pgfId-1087751"></a><div class="webflare-div-image">
<img width="668" height="651" src="images/Chap3-136.gif" /></div></li><li>
<a id="pgfId-1087739"></a>Select the <em>Power</em> radio button from the <em>Function</em> section.</li><li>
<a id="pgfId-1092158"></a>Select the <em>Net (specify R)</em> option from the drop-down list.</li><li>
<a id="pgfId-1087778"></a>Select <em>dBm</em> from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1087795"></a>Select the appropriate net on the schematic.</li><li>
<a id="pgfId-1087806"></a>Click <em>OK</em>.<br />
<a id="pgfId-1087827"></a><div class="webflare-div-image">
<img width="668" height="400" src="images/Chap3-137.gif" /></div></li></ol>













<p>
<a id="pgfId-1087864"></a>The output spectrum in dBm is displayed.</p>
<p>
<a id="pgfId-1087865"></a>To position the markers, move your cursor near the thing you want to read, and type <em>m</em>.</p>

<h3>
<a id="pgfId-1087852"></a>Swee<a id="marker-1298615"></a>ps</h3>

<ol><li>
<a id="pgfId-1087890"></a>To enable sweeps, select the <em>Sweep</em> check box in the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1087910"></a><div class="webflare-div-image">
<img width="668" height="346" src="images/Chap3-138.gif" /></div></li><li>
<a id="pgfId-1087935"></a>Select what you want to sweep from the drop-down list. In the figure above, <em>variable</em> is selected.</li><li>
<a id="pgfId-1087949"></a>Click <em>Select Design Variable</em> and select the variable that you want to sweep.</li><li>
<a id="pgfId-1087959"></a>Specify the sweep range in the <em>Start</em> and <em>Stop</em> fields.</li><li>
<a id="pgfId-1087972"></a>If desired, select the <em>Add Specific Points</em> check box and specify the additional points.<br />
<a id="pgfId-1087989"></a>Separate the entries with a space.</li></ol>










<h3>
<a id="pgfId-1087982"></a>Plot<a id="marker-1298620"></a>ting Cu<a id="plotting_currents"></a>rrents</h3>

<p>
<a id="pgfId-1088002"></a>In the past, currents could be plotted from the terminals of the sources in the circuit only. That required adding an iprobe to the circuit in series with the branch. An iprobe is a zero volt voltage source that also allows the current in that branch to be solved.</p>
<p>
<a id="pgfId-1269232"></a>Starting with the MMSIM 12.1.1 release, the normal selection method in ADE for saving currents is supported. If you want to save the currents, select <em>Outputs</em> - <em>Save All</em>, and choose <em>selected</em>, <em>nonlinear</em>, or <em>all</em>. This is shown below.</p>

<p>
<a id="pgfId-1269271"></a></p>
<div class="webflare-div-image">
<img width="660" height="765" src="images/Chap3-139.gif" /></div>

<p>
<a id="pgfId-1269302"></a>If you choose <em>selected</em>, then also select <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Design</em>, and make terminal selections on the schematic. Selecting terminals will add expressions under the <em>Maestro</em> tab in ADE Explorer to save those selected currents.</p>
<p>
<a id="pgfId-1088025"></a>To plot the currents, select the <em>Current</em> radio button from the <em>Function</em> section in the <em>Direct Plot Form</em> and click <em>OK</em>.</p>

<p>
<a id="pgfId-1088038"></a></p>
<div class="webflare-div-image">
<img width="668" height="782" src="images/Chap3-140.gif" /></div>

<p>
<a id="pgfId-1088067"></a></p>

<div class="webflare-div-image">
<img width="668" height="435" src="images/Chap3-141.gif" /></div>
<h3>
<a id="pgfId-1277754"></a>Compress<a id="marker-1298636"></a>ion Point</h3>

<p>
<a id="pgfId-1277755"></a>Gain compression enables you to calculate the compression points and compression curves directly, without the need for post-processing or manual setup of power sweeps. Gain compression calculates voltage and power-based compression points and provides the flexibility to choose the gain reference for compression calculations. With gain compression analysis, the simulator outputs the following:</p>
<ul><li>
<a id="pgfId-1277756"></a>The power and gain compression curves</li><li>
<a id="pgfId-1277757"></a>The input-referred power (or voltage) at compression</li><li>
<a id="pgfId-1277758"></a>The output-referred power (or voltage) at compression</li></ul>



<h4><em>
<a id="pgfId-1277759"></a>Power Compression and Gain Curves</em></h4>

<ol><li>
<a id="pgfId-1277760"></a>First, set a reasonable number of harmonics. for the simulation to be accurate at the compression point.</li><li>
<a id="pgfId-1277970"></a>Select the <em>Compression</em> check box.<br />
<a id="pgfId-1277764"></a><div class="webflare-div-image">
<img width="668" height="361" src="images/Chap3-142.gif" /></div></li><li>
<a id="pgfId-1277765"></a>If desired, select <em>Rapid Mode</em>. This mode is faster but slightly less accurate, and is suggested for Monte Carlo, sweeps, or corners where a large number of simulations need to be performed. In this mode, you need to supply an estimate of the input-referred compression point. </li><li>
<a id="pgfId-1292176"></a>Choose <em>Power</em> from the <em>Gain Definition</em> drop-down list for compression point calculation.</li><li>
<a id="pgfId-1277766"></a>Choose the reference point for gain calculation from the <em>Gain Reference</em> drop-down list.</li><li>
<a id="pgfId-1277767"></a>Specify the gain compression level in the <em>Compression Level (dB)</em> field. This can be a list of compression values separated by spaces in normal mode only. This is shown above in step 3.</li><li>
<a id="pgfId-1277768"></a>Specify the output harmonic number in the <em>Output/Load Harmonic</em> field. For a two-tone simulation (a mixer), the output harmonic number will be a two-number sequence. Alternatively, you can click <em>Choose</em> and select the output harmonic from the table.</li><li>
<a id="pgfId-1277773"></a>Specify the instance name of the input source in the <em>Source</em> text field. Alternatively, you can click <em>Select</em> and choose the source from the schematic. For power gain, the input source must be a port instance.</li><li>
<a id="pgfId-1277774"></a>Specify the instance name of the load termination in the <em>Load </em>text field. Alternatively, you can click <em>Select</em> and choose the source from the schematic. For load termination, the instance can be a port or a resistor.</li><li>
<a id="pgfId-1393439"></a>If required, enter a value in the <em>Backoff</em> field. When you specify a value (in dB) in this field, there can only be a single value of compression. The simulator runs the compression analysis and then lowers the power from the compression point by the specified value. Next, it runs HB and all the hb&lt;xx&gt; analyses specified at that reduced input power level.</li><li>
<a id="pgfId-1277775"></a>Run the simulation.</li></ol>














<p>
<a id="pgfId-1277776"></a>After the simulation completes, choose <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed, as shown below.</p>

<p>
<a id="pgfId-1277780"></a></p>
<div class="webflare-div-image">
<img width="668" height="346" src="images/Chap3-143.gif" /></div>

<p>
<a id="pgfId-1277781"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1277782"></a>Choose <em>xdb</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1277783"></a>Choose <em>Power/Voltage/Gain</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1277784"></a>Choose <em>Power</em> from the <em>Format</em> drop-down list.</li><li>
<a id="pgfId-1277785"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1277786"></a>The power curve is plotted in the waveform tool, as shown below.<br />
<a id="pgfId-1277790"></a><div class="webflare-div-image">
<img width="668" height="461" src="images/Chap3-144.gif" /></div></li><li>
<a id="pgfId-1277791"></a>Now choose <em>Gain</em> from the <em>Format</em> drop-down list.</li><li>
<a id="pgfId-1277792"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1277793"></a>The gain curve is plotted in the waveform tool. This example shows multiple compression levels of 1, 2, and 5dB.<br />
<a id="pgfId-1277797"></a><div class="webflare-div-image">
<img width="668" height="521" src="images/Chap3-145.gif" /></div></li></ol>














<h4><em>
<a id="pgfId-1277798"></a>Input-Referred Compr<a id="marker-1298676"></a>ession </em></h4>

<p>
<a id="pgfId-1277799"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1277800"></a>Choose <em>xdb</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1277801"></a>Choose <em>Compression Point</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1277802"></a>Choose <em>Input-referred</em> from the <em>Compression Point/Curve</em> drop-down list.</li><li>
<a id="pgfId-1296019"></a>If you want to add the expression to the ADE Explorer window so that it plots automatically after a simulation, select <em>Add To Outputs</em>.<br />
<a id="pgfId-1296024"></a><div class="webflare-div-image">
<img width="668" height="429" src="images/Chap3-146.gif" /></div></li></ol>







<p>
<a id="pgfId-1296025"></a>The input-referred compression levels plot. This example shows 1, 2, and 5dB compression levels.</p>

<p>
<a id="pgfId-1296067"></a></p>
<div class="webflare-div-image">
<img width="664" height="472" src="images/Chap3-147.gif" /></div>

<p>
<a id="pgfId-1292360"></a>You can also add <em>Output-referred</em> compression in the same way.</p>

<h4><em>
<a id="pgfId-1277809"></a>Voltage Gain Comp<a id="marker-1298711"></a>ression</em></h4>

<ol><li>
<a id="pgfId-1277810"></a>Select the <em>Compression</em> check box.<br />
<a id="pgfId-1277814"></a><div class="webflare-div-image">
<img width="668" height="388" src="images/Chap3-148.gif" /></div></li><li>
<a id="pgfId-1277815"></a>If desired, select <em>Rapid Mode</em>. This mode is faster but slightly less accurate, and is suggested for Monte Carlo, sweeps, or corners where a large number of simulations need to be performed. In this mode, you need to supply a n estimate of the input-referred compression point. </li><li>
<a id="pgfId-1293251"></a>Choose <em>Voltage </em>from the <em>Gain Definition</em> drop-down box for compression point calculation. </li><li>
<a id="pgfId-1277816"></a>Choose the reference point for gain calculation from the <em>Gain Reference</em> drop-down list.</li><li>
<a id="pgfId-1277817"></a>Specify the gain compression level in the <em>Compression Level (dB)</em> field. A list of values separated by spaces is allowed in normal mode. <em>Rapid Mode </em>requires a single entry.</li><li>
<a id="pgfId-1277818"></a>Specify the output harmonic number in the <em>Output/Load Harmonic</em> field. For a two-tone simulation (a mixer), the output harmonic number will be a two-number sequence. Alternatively, you can click the Choose button at the right of the Output/Load Harmonic field and select the output harmonic from the table.</li><li>
<a id="pgfId-1277823"></a>Specify the instance name of the input source in the <em>Source</em> text field. Alternatively, you can click <em>Select</em> and choose the source from the schematic. For voltage gain, the input source can be a vsource or a port.</li><li>
<a id="pgfId-1277824"></a>Specify the positive output terminal for voltage gain calculation in the <em>Output Node +</em> field. If you do not specify a value then the node is considered as global ground.</li><li>
<a id="pgfId-1277825"></a>Specify the negative output terminal for voltage gain calculation in the <em>Output Node -</em> field. If you do not specify a value then the node is considered as global ground.</li><li>
<a id="pgfId-1393582"></a>If required, enter a value in the <em>Backoff</em> field. When you specify a value (in dB) in this field, there can only be a single value of compression. The simulator runs the compression analysis and then lowers the power from the compression point by the specified value. Next, it runs HB and all the hb&lt;xx&gt; analyses specified at that reduced input power level.</li><li>
<a id="pgfId-1293295"></a>If data for intermediate nodes in the schematic is desired, then select <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Design in ADE Explorer</em>, and click the nets you want to save. These nets can be plotted in the <em>Direct Plot Form</em> after the simulation.</li><li>
<a id="pgfId-1277826"></a>Run the simulation.</li></ol>















<p>
<a id="pgfId-1277827"></a>After the simulation completes, choose <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed, as shown below.</p>

<p>
<a id="pgfId-1277831"></a></p>
<div class="webflare-div-image">
<img width="668" height="350" src="images/Chap3-149.gif" /></div>

<p>
<a id="pgfId-1277832"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1277833"></a>Choose <em>xdb</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1277834"></a>Choose <em>Power/Voltage/Gain</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1277835"></a>Choose <em>Voltage</em> from the <em>Format</em> drop-down list.</li><li>
<a id="pgfId-1277836"></a>If you want to add the expression in the ADE Explorer window so that it plots automatically after a simulation, select <em>Add To Outputs</em>.</li><li>
<a id="pgfId-1277837"></a>Click <em>Plot</em>.</li></ol>




<p>
<a id="pgfId-1274594"></a>The Voltage curve is plotted in the waveform tool, as shown below.</p>

<p>
<a id="pgfId-1280822"></a></p>
<div class="webflare-div-image">
<img width="674" height="436" src="images/Chap3-150.gif" /></div>

<ol><li>
<a id="pgfId-1274632"></a>To plot the data from intermediate nets, select Intermediate Node from the Function Section.</li><li>
<a id="pgfId-1294233"></a>Select <em>Gain</em>, <em>Voltage</em>, or <em>Phase</em> from the <em>Format</em> drop-down list. <em>Gain</em> is shown in this example.</li><li>
<a id="pgfId-1294241"></a>Select the harmonic from the Frequency and Harmonics selection.<br />
<a id="pgfId-1296216"></a><div class="webflare-div-image">
<img width="355" height="426" src="images/Chap3-151.gif" /></div></li><li>
<a id="pgfId-1294249"></a>Click the net in the schematic.</li><li>
<a id="pgfId-1341573"></a>The data plots without the compression levels shown.<br />
<a id="pgfId-1341577"></a><div class="webflare-div-image">
<img width="661" height="437" src="images/Chap3-152.gif" /></div></li></ol>












<p>
<a id="pgfId-1341578"></a>Compression can be combined with sweeps or monte carlo. To run sweeps, enable the sweep button in the <em>Choosing Analyses</em> form, and set up a sweep. A temperature sweep is shown below.</p>

<p>
<a id="pgfId-1280919"></a></p>
<div class="webflare-div-image">
<img width="512" height="763" src="images/Chap3-153.gif" /></div>

<p>
<a id="pgfId-1274636"></a>Now run the analysis, and either plot the compression points using the Direct Plot Form, or use the ADE outputs added previously to plot the compression point versus temperature.</p>

<p>
<a id="pgfId-1281005"></a></p>
<div class="webflare-div-image">
<img width="655" height="400" src="images/Chap3-154.gif" /></div>
<h3>
<a id="pgfId-1274580"></a><a id="43267"></a>Load<a id="marker-1298789"></a>pull</h3>

<p>
<a id="pgfId-1088262"></a>For a loadpull simulation, use a port for the load. The harmonic port capability is used. The basic idea is to specify the impedance for all the harmonics you do not want in the harmonic port definition and then loadpull the harmonic you want in the loadpull analysis. An example circuit is shown below.</p>

<p>
<a id="pgfId-1088279"></a></p>
<div class="webflare-div-image">
<img width="668" height="624" src="images/Chap3-155.gif" /></div>

<p>
<a id="pgfId-1088310"></a>Normally, the harmonic port is used to define impedances for all the harmonics except for the one you want to loadpull. </p>
<ol><li>
<a id="pgfId-1304985"></a>To set impedances. select the port and type <em>q</em>. </li><li>
<a id="pgfId-1307408"></a>Select <em>Harmonic Port</em> for the <em>Port mode</em>. <br />
<a id="pgfId-1088333"></a><div class="webflare-div-image">
<img width="668" height="738" src="images/Chap3-156.gif" /></div></li><li>
<a id="pgfId-1088123"></a>If this has already been done, click the <em>Display harmonic port set form</em> check box.<br />
<a id="pgfId-1308414"></a>The Edit harmonic port window is displayed, as shown below.<br />
<a id="pgfId-1308435"></a><div class="webflare-div-image">
<img width="647" height="431" src="images/Chap3-157.gif" /></div></li><li>
<a id="pgfId-1308389"></a>Double-click the <em>&lt;Click to add&gt;</em> text in the <em>Harmonic</em> column.</li><li>
<a id="pgfId-1305403"></a>Type <em>2</em> in the Harmonic field.</li><li>
<a id="pgfId-1305412"></a>Press Enter.</li><li>
<a id="pgfId-1305420"></a>Click the <em>Resistance (Ohms)</em> column.</li><li>
<a id="pgfId-1305428"></a>Type the real part of the impedance.</li><li>
<a id="pgfId-1305436"></a>Press Tab.</li><li>
<a id="pgfId-1305444"></a>Type in the imaginary part of the impedance.</li><li>
<a id="pgfId-1305452"></a>Press Enter.</li><li>
<a id="pgfId-1305460"></a>Continue for all the harmonics in the simulation.<br />
<a id="pgfId-1307574"></a><div class="webflare-div-image">
<img width="665" height="431" src="images/Chap3-158.gif" /></div></li><li>
<a id="pgfId-1305487"></a>Click <em>OK</em> in the <em>Edit harmonic port</em> window.</li><li>
<a id="pgfId-1305495"></a>Click <em>OK</em> in the <em>Edit Object Properties</em> window.</li><li>
<a id="pgfId-1305503"></a>Check or check and save the schematic.</li><li>
<a id="pgfId-1305388"></a>Add two variables in ADE Explorer. To add a variable, click the <em>Click to add variable</em> text under the <em>Design Variables</em> section in the <em>Setup</em> pane of the ADE Explorer window. The <em>Editing Design Variables</em> form is displayed, as shown below.<br />
<a id="pgfId-1342436"></a><div class="webflare-div-image">
<img width="668" height="275" src="images/Chap3-159.gif" /></div></li><li>
<a id="pgfId-1342437"></a>Specify the name of the variable in the name field and the value of the variable in the Value (Expr) field.</li><li>
<a id="pgfId-1342445"></a>Click <em>Add</em>.<br />
<a id="pgfId-1088128"></a>The example above shows <span class="webflare-courier-new" style="white-space:pre"><em>mag</em></span> and <span class="webflare-courier-new" style="white-space:pre"><em>theta</em></span> variables added. These variables should not be used to set any component values in the circuit.<br />
<a id="pgfId-1342465"></a><div class="webflare-div-image">
<img width="668" height="483" src="images/Chap3-160.gif" /></div></li><li>
<a id="pgfId-1088424"></a>Open the pss or hb <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1305570"></a>If <em>pss</em> is selected, use the harmonic balance engine. If you want to use loadpull with PSS Shooting, see <a href="Chap4.html#79487">Loadpull</a>.</li><li>
<a id="pgfId-1088136"></a>Select the <em>Loadpull</em> checkbox.<br />
<a id="pgfId-1088140"></a><div class="webflare-div-image">
<img width="638" height="166" src="images/Chap3-161.gif" /></div></li><li>
<a id="pgfId-1088141"></a>Click the <em>Select</em> button on the right of the grayed out<em> Load Instance</em> field. </li><li>
<a id="pgfId-1088142"></a>In the schematic, select the load port. This example shows a loadpull for the first harmonic. If you want to loadpull the second harmonic, change the harmonic port definition so that the first harmonic has a defined load impedance and the second harmonic is not specified. To loadpull the third harmonic, specify impedances for all the harmonics except the third harmonic in the harmonic port definition.<br />
<a id="pgfId-1088143"></a>The instance name is entered in the <em>Load Instance</em> field. Direct entry by typing is not allowed for this field.<br />
<a id="pgfId-1088147"></a><div class="webflare-div-image">
<img width="638" height="232" src="images/Chap3-162.gif" /></div></li><li>
<a id="pgfId-1088148"></a>Click the <em>Variable</em> button on the right of the <em>rho (Z)</em> field. Select the variable you entered in ADE Explorer. <br />
<a id="pgfId-1088149"></a>This variable will be used to set the value of the reflection coefficient in the port.</li><li>
<a id="pgfId-1088150"></a>Specify a sweep range, and set the spacing.<br />
<a id="pgfId-1088154"></a><div class="webflare-div-image">
<img width="638" height="283" src="images/Chap3-163.gif" /></div></li><li>
<a id="pgfId-1088155"></a>When completed, click <em>OK</em>. </li><li>
<a id="pgfId-1088161"></a>Click the <em>Variable</em> button on the right of the <em>phi (Z)</em> field. This sets the angle of the reflection coefficient.</li><li>
<a id="pgfId-1088162"></a>In the <em>Select Design Variable </em>window, select the second variable you entered and specify the sweep limits.<br />
<a id="pgfId-1088166"></a><div class="webflare-div-image">
<img width="638" height="284" src="images/Chap3-164.gif" /></div></li><li>
<a id="pgfId-1088167"></a>When completed, click <em>OK</em>. <br />
<a id="pgfId-1088168"></a>The <em>Choosing Analyses</em> form is updated.</li><li>
<a id="pgfId-1088169"></a>Specify the system resistance in the <em>Z0</em> field.<br />
<a id="pgfId-1088170"></a>The <em>Choosing Analyses</em> form should appear similar to the one below. <br />
<a id="pgfId-1088174"></a><div class="webflare-div-image">
<img width="638" height="760" src="images/Chap3-165.gif" /></div></li><li>
<a id="pgfId-1088176"></a>When completed, click <em>OK</em> and run the simulation in ADE Explorer.</li><li>
<a id="pgfId-1088177"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>.</li></ol>













































































<p>
<a id="pgfId-1088178"></a>There are two methods of plotting loa<a id="marker-1301519"></a>dpull curves.</p>

<h4><em>
<a id="pgfId-1088179"></a>First Method</em></h4>

<ol><li>
<a id="pgfId-1088180"></a>Select <em>pss or hb results</em>.</li><li>
<a id="pgfId-1088185"></a>Select <em>Power Contours</em>.</li><li>
<a id="pgfId-1088190"></a>Select <em>Magnitude</em>, <em>dB10</em>, or <em>dBm</em>.</li><li>
<a id="pgfId-1088195"></a>Specify 2 more than the number of contour lines you want.<br />
<a id="pgfId-1088196"></a>The smallest and largest power occurs at a single point which is plotted, but are very difficult to see in the waveform tool.</li><li>
<a id="pgfId-1088197"></a>Select the <em>Close Contours</em> check box. This causes the contours from the loadpull to be displayed as circles or ellipses, depending on the distortion of the circuit.</li><li>
<a id="pgfId-1100364"></a>Select the first harmonic. <br />
<a id="pgfId-1342909"></a><div class="webflare-div-image">
<img width="668" height="781" src="images/Chap3-166.gif" /></div></li><li>
<a id="pgfId-1088198"></a>Select the top terminal of the top port in the triplexer.<br />
<a id="pgfId-1088199"></a>The power contours appear. <br />
<a id="pgfId-1088203"></a><div class="webflare-div-image">
<img width="638" height="604" src="images/Chap3-167.gif" /></div></li></ol>















<h4><em>
<a id="pgfId-1088204"></a>Second Method</em></h4>

<ol><li>
<a id="pgfId-1088205"></a>Select <em>pss </em>or<em> hb results</em>.</li><li>
<a id="pgfId-1088210"></a>Select <em>Power</em>.</li><li>
<a id="pgfId-1088215"></a>Select <em>variable</em>.</li><li>
<a id="pgfId-1088220"></a>Select <em>Magnitude</em>, <em>dB10</em>, or <em>dBm</em>.</li><li>
<a id="pgfId-1088225"></a>Select the <em>harmonic number</em>.</li><li>
<a id="pgfId-1088230"></a>Select <em>Loadpull Contour</em>.</li><li>
<a id="pgfId-1088231"></a>Specify 2 more than the number of curves you want. </li><li>
<a id="pgfId-1100402"></a>Select the <em>Closed Contours</em> check box. This causes the contours from the loadpull to be displayed as circles or ellipses, depending on the distortion of the circuit.<br />
<a id="pgfId-1343113"></a><div class="webflare-div-image">
<img width="668" height="779" src="images/Chap3-168.gif" /></div></li><li>
<a id="pgfId-1088232"></a>Select the top terminal of the top port of the triplexer circuit. <br />
<a id="pgfId-1088233"></a>The loadpull curves appear in the waveform tool. <br />
<a id="pgfId-1088237"></a><div class="webflare-div-image">
<img width="638" height="594" src="images/Chap3-169.gif" /></div></li></ol>
















<h2>
<a id="pgfId-1066235"></a><a id="loadpullfeature"></a>Power-Added E<a id="marker-1298823"></a>fficiency</h2>

<ol><li>
<a id="pgfId-1066236"></a>Set up an hb run as desired. A sweep is shown below.<br />
<a id="pgfId-1066240"></a><div class="webflare-div-image">
<img width="635" height="761" src="images/Chap3-170.gif" /></div></li><li>
<a id="pgfId-1066247"></a>Run the simulation. </li><li>
<a id="pgfId-1066248"></a>When the simulation completes, select <em>Results - Direct Plot - Main Form</em>. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1066252"></a><div class="webflare-div-image">
<img width="636" height="747" src="images/Chap3-171.gif" /></div></li><li>
<a id="pgfId-1066253"></a>Select <em>Power Added Eff</em>.</li><li>
<a id="pgfId-1066254"></a>Set the number of DC sources in the circuit you want to include for the PAE measurement.</li><li>
<a id="pgfId-1066255"></a>Select the frequency of the output.</li><li>
<a id="pgfId-1066256"></a>Select the top terminal of the load in the schematic. </li><li>
<a id="pgfId-1066257"></a>Select the top terminal of the input port.</li><li>
<a id="pgfId-1066262"></a>Select the positive terminal of the DC source that supplies power to the amplifier. If you set multiple sources, select the positive terminals of all the sources. <br />
<a id="pgfId-1066267"></a>The PAE is plotted in the waveform tool.<br />
<a id="pgfId-1066271"></a><div class="webflare-div-image">
<img width="635" height="405" src="images/Chap3-172.gif" /></div></li></ol>




















<h3>
<a id="pgfId-1066274"></a><a id="34804"></a>Oscillators</h3>

<p>
<a id="pgfId-1066275"></a>On the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1066276"></a>Set the <em>Run Transient?</em> selection appropriately.<br />
<a id="pgfId-1256062"></a><div class="webflare-div-image">
<img width="500" height="801" src="images/Chap3-173.gif" /></div></li><li>
<a id="pgfId-1117400"></a>For oscillators, selecting the <em>Detect Steady State</em> check box is strongly recommended. This will run tstab until steady-state is reached, and then switch to harmonic balance. When <em>Decide automatically</em> is set for <em>Run Transient?</em>, <em>Detect Steady State</em> is always on.</li><li>
<a id="pgfId-1118277"></a>Specify a frequency that is within 0.5 times the actual oscillation frequency and 1.5 times this frequency.</li><li>
<a id="pgfId-1066281"></a>Set the harmonics and the oversample factor as needed for your oscillator. <em>auto</em> harmonics is available when <em>Run Transient?</em> is set to <em>Decide automatically</em> or <em>yes</em>.</li><li>
<a id="pgfId-1066282"></a>Always select <em>conservative</em>.<br />
<a id="pgfId-1256224"></a>For LC and crystal oscillators, no further action is necessary. For ring oscillators, specify the initial conditions in ADE Explorer to force one stage to the high or low state.</li><li>
<a id="pgfId-1256225"></a>If you want to see the startup waveform, select <em>yes</em> for saveinit.</li><li>
<a id="pgfId-1256238"></a>Select any net with the oscillator signal present for the oscillator node.</li><li>
<a id="pgfId-1066299"></a>If you want the output frequency versus tuning voltage, define an appropriate sweep for your oscillator.</li><li>
<a id="pgfId-1249752"></a>Run the simulation.</li></ol>














<h4>
<a id="pgfId-1088870"></a>Oscillator Tuning R<a id="marker-1298854"></a>ange</h4>

<p>
<a id="pgfId-1088835"></a>To plot the tuning range, on the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1066320"></a></p>
<div class="webflare-div-image">
<img width="669" height="638" src="images/Chap3-174.gif" /></div>

<ol><li>
<a id="pgfId-1066321"></a>Click the <em>Harmonic Frequency</em> radio button.</li><li>
<a id="pgfId-1088881"></a>Select the<em> Add to Outputs</em> check box.</li><li>
<a id="pgfId-1066322"></a>Select the desired harmonic number to plot from the <em>Harmonic Frequency</em> field.</li><li>
<a id="pgfId-1066323"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1066324"></a>The tuning range plot appears. <br />
<a id="pgfId-1066328"></a><div class="webflare-div-image">
<img width="635" height="469" src="images/Chap3-175.gif" /></div></li></ol>







<h4>
<a id="pgfId-1088903"></a>Plotting Modu<a id="marker-1298866"></a>lation Sensitivity</h4>

<p>
<a id="pgfId-1088917"></a>From plotting the oscillator frequency as shown below, an expression is added in the ADE Explorer window.</p>

<p>
<a id="pgfId-1343816"></a></p>
<div class="webflare-div-image">
<img width="667" height="460" src="images/Chap3-176.gif" /></div>

<ol><li>
<a id="pgfId-1343817"></a>Double-click the expression under the <em>Details</em> column and then click the ... button.<br />
<a id="pgfId-1089076"></a>The Calculator starts with the expression in the buffer. This expression will be different for different circuits.<br />
<a id="pgfId-1089098"></a><div class="webflare-div-image">
<img width="668" height="737" src="images/Chap3-177.gif" /></div></li><li>
<a id="pgfId-1089062"></a>Set the plotting mode to <em>New Subwindow</em>.</li><li>
<a id="pgfId-1089123"></a>Select the <em>deriv</em> function.<br />
<a id="pgfId-1089137"></a>The expression changes in the buffer.<br />
<a id="pgfId-1089147"></a><div class="webflare-div-image">
<img width="668" height="736" src="images/Chap3-178.gif" /></div></li><li>
<a id="pgfId-1089169"></a>Click the <em>Plot</em> icon.<br />
<a id="pgfId-1089182"></a>The modulation sensitivity appears in the new subwindow.<br />
<a id="pgfId-1089211"></a><div class="webflare-div-image">
<img width="668" height="426" src="images/Chap3-179.gif" /></div></li></ol>

















<h3>
<a id="pgfId-1278775"></a>Oscillator Tuning Mod<a id="marker-1298879"></a>e Analysis</h3>

<p>
<a id="pgfId-1278776"></a>The oscillator tuning mode analysis tunes the oscillator so that phase noise can be measured at the desired oscillation frequency. It is supported in both harmonic balance and shooting methods and is typically used in Monte Carlo simulations to obtain the phase noise.</p>
<p>
<a id="pgfId-1278777"></a>In oscillator tuning mode analysis, the oscillator frequency is treated as the target frequency, and the value of a circuit parameter is obtained to achieve the target frequency. The circuit parameter can be an arbitrary netlist variable or an instance parameter. </p>
<ol><li>
<a id="pgfId-1278778"></a>Open the hb <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1278779"></a>Set up the target frequency in the <em>Fundamental Frequency</em> field.</li><li>
<a id="pgfId-1278780"></a>Select the <em>Oscillator</em> check box.</li><li>
<a id="pgfId-1278781"></a>Specify the output node from the <code>Oscillator node+</code> field. Alternatively, click <em>Select</em> and choose the output node from the schematic. Here, <code>collector</code> is selected.</li><li>
<a id="pgfId-1278782"></a>Select the <em>Enable tuning mode analysis</em> check box.</li><li>
<a id="pgfId-1278783"></a>Choose the parameter that needs to be tuned from the drop-down list. Here, <em>Component Param. </em>has been selected.<br />
<a id="pgfId-1278787"></a><div class="webflare-div-image">
<img width="668" height="313" src="images/Chap3-180.gif" /></div></li><li>
<a id="pgfId-1278788"></a>Specify the name of the parameter in the <em>Component Name</em> field. Alternatively, click <em>Select Component </em>and select the parameter from the schematic. When you select a parameter from the schematic a pop-up window appears that contains a list of selectable parameters.<br />
<a id="pgfId-1278792"></a><div class="webflare-div-image">
<img width="668" height="448" src="images/Chap3-181.gif" /></div></li><li>
<a id="pgfId-1278793"></a>Select a parameter from the list. The <em>Parameter Name</em> field is automatically populated with the name of the parameter (<em>dc</em> in the figure above). </li><li>
<a id="pgfId-1278794"></a>Select the <em>Tuning range</em> check box and specify the minimum and maximum ranges for the parameter, if required.<br />
<a id="pgfId-1278798"></a><div class="webflare-div-image">
<img width="668" height="166" src="images/Chap3-182.gif" /></div></li><li>
<a id="pgfId-1278799"></a>Run the simulation.</li><li>
<a id="pgfId-1278800"></a>After the simulation completes, click <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> to display the <em>Direct Plot Form</em>.<br />
<a id="pgfId-1278804"></a><div class="webflare-div-image">
<img width="668" height="463" src="images/Chap3-183.gif" /></div></li><li>
<a id="pgfId-1278805"></a>Select <em>Tuning Parameter</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1278806"></a>Click <em>Add to Outputs</em>.</li><li>
<a id="pgfId-1278807"></a>Click <em>OK</em>.<br />
<a id="pgfId-1278808"></a>The value of the tuning parameter is added under the maestro in the ADE Explorer window, as shown below.<br />
<a id="pgfId-1281282"></a><div class="webflare-div-image">
<img width="665" height="457" src="images/Chap3-184.gif" /></div></li></ol>

































<h3>
<a id="pgfId-1273990"></a>Oscillator Tuning Mode With<a id="marker-1298927"></a> Sweeps</h3>

<ol><li>
<a id="pgfId-1273997"></a>Sweeps and Monte Carlo are also supported with tuning mode. Below is an example of a sweep of temperature with tuning mode.</li><li>
<a id="pgfId-1274014"></a>Enable sweeps in the hb Choosing Analyses form. In this example, temperature is swept from -40 t0 160C. Tuning mode is enabled as before.<br />
<a id="pgfId-1281374"></a><div class="webflare-div-image">
<img width="461" height="780" src="images/Chap3-185.gif" /></div></li><li>
<a id="pgfId-1274286"></a>Now run the simulation. Because the tuning parameter has already been added to the ADE Explorer window in the previous section, the tuning voltage is plotted after the simulation.<br />
<a id="pgfId-1281609"></a><div class="webflare-div-image">
<img width="663" height="485" src="images/Chap3-186.gif" /></div></li><li>
<a id="pgfId-1274357"></a>The trend in tuning voltage and phase noise is plotted.</li></ol>












<h2>
<a id="pgfId-1273791"></a><a id="14890"></a>Two Input Frequ<a id="marker-1298985"></a>encies</h2>

<p>
<a id="pgfId-1089247"></a>To enable an additional frequency, set the variable in ADE Explorer to the frequency you want instead of 0 (zero). In the window below, the variable frf1 has been set to 1.901G.</p>

<p>
<a id="pgfId-1088990"></a></p>
<div class="webflare-div-image">
<img width="668" height="528" src="images/Chap3-187.gif" /></div>

<p>
<a id="pgfId-1089308"></a>To set the 2-tone hb analysis:</p>
<ol><li>
<a id="pgfId-1089309"></a>Open the <em>Choosing Analyses</em> form from the Analog Design Environment (ADE) Explorer window.<br />
<a id="pgfId-1089313"></a><div class="webflare-div-image">
<img width="635" height="780" src="images/Chap3-188.gif" /></div></li><li>
<a id="pgfId-1089314"></a>Decide whether you want to set the harmonics manually or automatically for the first tone. For auto tstab, and auto selection of harmonics for the first tone, select <em>Decide automatically</em> from the <em>Run transient?</em> drop-down list.</li><li>
<a id="pgfId-1119362"></a>You can specify either the frequencies of the inputs, or obtain a list of the source names and frequencies in the schematic. <em>Frequencies</em> are shown above.</li><li>
<a id="pgfId-1089319"></a>Click the appropriate radio button to select the number of inputs.</li><li>
<a id="pgfId-1089324"></a>Set the frequencies, number of harmonics, and oversample factor. For an automatic calculation of the number of harmonics for the first tone, set the number of harmonics to auto in Tone1.</li><li>
<a id="pgfId-1089325"></a>If you have a frequency divider in your circuit, set the divide ratio. This assumes that the Tone1 input will be divided in frequency.</li><li>
<a id="pgfId-1089326"></a>If you want to enable a frequency cut, choose <em>Select</em> from the <em>Harmonics</em> drop-down list box and set a value for <em>MaximOrder</em>.</li><li>
<a id="pgfId-1089331"></a>Set the accuracy you want for the analysis.</li><li>
<a id="pgfId-1345516"></a>If you want to manually set transient-aided hb, select <em>Yes</em> from the <em>Run Transient?</em> drop-down list and set a time for the transient tin the <em>Stop Time (tstab)</em> field. If you want to see the startup waveform, select <em>yes</em> for saveinit.</li><li>
<a id="pgfId-1345520"></a>Enable sweeps by checking the <em>Sweep</em> checkbox, or use the parametric plot tool in ADE Explorer. In the <em>Choosing Analyses</em> form, you can specify up to three variables. In the parametric plot tool, the number of variables is unlimited.</li><li>
<a id="pgfId-1159554"></a>Set the variable name to be swept.</li><li>
<a id="pgfId-1089348"></a>Set the sweep range and step information.</li><li>
<a id="pgfId-1249841"></a>If you want to run specific points, check the appropriate check box at the left side of the <em>Add Specific Points</em> field.<br />
<a id="pgfId-1089351"></a>The form below shows the hb <em>Choosing Analyses</em> form with <em>Names</em> selected. Only the differences are shown from the previous section.<br />
<a id="pgfId-1089355"></a><div class="webflare-div-image">
<img width="637" height="745" src="images/Chap3-189.gif" /></div></li><li>
<a id="pgfId-1345603"></a>When <em>Names</em> is selected, ADE Explorer reads the schematic and lists all the sources in the circuit.<br />
<a id="pgfId-1345606"></a><div class="webflare-div-image">
<img width="637" height="250" src="images/Chap3-190.gif" /></div>
<a id="pgfId-1345621"></a>The <em>Expr</em> field lists the entry that sets the frequency, and the values field evaluates the variable expression and lists the value.<br />
<a id="pgfId-1345622"></a><em>Mxham</em> lists the number of harmonics for that tone. <em>auto</em> is allowed if <em>Decide automatically</em> or <em>Yes</em> are selected from the <em>Run transient?</em> drop-down list.<br />
<a id="pgfId-1345617"></a><em>Ovsap</em> lists the oversample factor for that tone.<br />
<a id="pgfId-1345618"></a><em>Tstab</em> specifies which tone is eligible for transient-aided hb. <br /><div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1119934"></a>
Tstab should be enabled for the tone that causes the most distortion in the circuit.</div></li><li>
<a id="pgfId-1089366"></a>To make changes, select the line and then edit the entries in the fields just below.</li><li>
<a id="pgfId-1089367"></a>When you are done with your edits, click <em>Change, select another field, or press the &lt;<em>Tab</em><em>&gt; key</em></em>.</li><li>
<a id="pgfId-1089368"></a>When you are done with the setup, run the simulation.</li><li>
<a id="pgfId-1089369"></a>When the simulation completes, select <em>Results - Direct Plot - Main Form</em> in ADE Explorer.<br />
<a id="pgfId-1089370"></a>The form looks as below:<br />
<a id="pgfId-1089374"></a><div class="webflare-div-image">
<img width="637" height="798" src="images/Chap3-191.gif" /></div></li><li>
<a id="pgfId-1089375"></a>The <em>Plotting Mode</em> drop-down list box has the following options:<ul><li>
<a id="pgfId-1089380"></a><em>Append</em> - Add the new plot to an existing plot in the selected subwindow. This option is selected above.</li><li>
<a id="pgfId-1089381"></a><em>Replace</em> - Replace the data in the selected subwindow.</li><li>
<a id="pgfId-1089382"></a><em>New SubWin</em> - Open a new subwindow and plot the data.</li><li>
<a id="pgfId-1089383"></a><em>New Win</em> - Open a new window and plot the data.</li></ul></li><li>
<a id="pgfId-1089384"></a>Select the analysis type you want to plot from the list. <em>hb_mt</em> is selected in the figure above.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1092297"></a>_<em>mt</em> means multiple tone.</div></li><li>
<a id="pgfId-1089389"></a>Select the specific item you want to plot from the list in the <em>Function</em> section. The figure above shows plotting the voltage on a node.</li><li>
<a id="pgfId-1089394"></a>Different items can be plotted by using the <em>Select</em> drop-down list. You can choose from a number of different things by clicking the <em>Select</em> drop-down list. For example, <em>Differential nets</em>.</li><li>
<a id="pgfId-1089399"></a>If you want to plot the spectrum at a specific power level, select <em>spectrum</em> or <em>frequency</em>. If you want to see a swept measurement of a specific harmonic, select <em>variable</em>. If you want to plot the time-domain waveform at a specific power level, select <em>ifft</em>.</li><li>
<a id="pgfId-1089404"></a>For a harmonic plot, select <em>peak</em> or <em>rms</em>. <em>rms</em> is selected in the above figure.</li><li>
<a id="pgfId-1089409"></a>Select the data type you want to plot. If you want <em>dBm</em>, select <em>Power</em> in the <em>Function</em> section.</li><li>
<a id="pgfId-1089414"></a>Select the desired harmonic or power level (as appropriate for your selection in the sweep section)</li><li>
<a id="pgfId-1089419"></a>If you want to add an expression to the ADE window so that it plots automatically after a simulation, select <em>Add To Outputs</em>.<br />
<a id="pgfId-1089424"></a>At any time when filling the <em>Direct Plot Form</em>, appropriate directions on what to do are given at the bottom of the form. In this example, a variable value needs to be selected in the variables table. </li></ol>



























































<p>
<a id="pgfId-1089425"></a>This is the wide range display of all the harmonics. <em>For more information on the waveform tool, see the documentation for ViVA (IC6.1).</em> </p>

<p class="webflare-indent1">
<a id="pgfId-1089429"></a></p>
<div class="webflare-div-image">
<img width="669" height="458" src="images/Chap3-192.gif" /></div>
<h3>
<a id="pgfId-1089882"></a>Multiple Divid<a id="multiple_divider_mode"></a>er Mode</h3>

<p>
<a id="pgfId-1345886"></a>Generally speaking, multiple receivers are simulated at the same time to analyze leakage from the LOs into the other radio. An example of what if analysis to find what resistance values (top) and capacitor values (bottom) need to be achieved is shown below. Two LNA and Mixer chains are shown with resistors coupling the LO of the bottom receiver into the top LNA and capacitors from the top LO into the bottom LNA.</p>

<p>
<a id="pgfId-1307852"></a></p>
<div class="webflare-div-image">
<img width="660" height="524" src="images/Chap3-193.gif" /></div>

<ol><li>
<a id="pgfId-1304228"></a>In the <em>Choosing Analyses</em> form, select <em>hb</em>.</li><li>
<a id="pgfId-1304240"></a>Select <em>Yes</em> from the <em>Run Transient?</em> drop-down list, and specify a tstab long enough for the longest divider to cycle at least twice.</li><li>
<a id="pgfId-1304248"></a>Select <em>Frequencies</em>.</li><li>
<a id="pgfId-1304256"></a>Select <em>Multi-divider Mode</em>.</li><li>
<a id="pgfId-1304264"></a>Select the number of tones applied to the circuit.</li><li>
<a id="pgfId-1304282"></a>Type the divider input frequencies in the <em>Fundamental Frequency</em> fields.</li><li>
<a id="pgfId-1304290"></a>Set harmonics manually. Set enough harmonics to capture at least five harmonics at the input frequency to the divider.</li><li>
<a id="pgfId-1304305"></a>Set <em>Oversample Factor</em> to two or four. Use four for very square output waveforms.</li><li>
<a id="pgfId-1304320"></a>Specify the divider ratio for each signal in the <em>Freq Divide Ratio</em> fields.</li><li>
<a id="pgfId-1304327"></a>Choose <em>Select</em> from the <em>Harmonics</em> drop-down list.</li><li>
<a id="pgfId-1304334"></a>Select <em>funnel</em> cut.</li><li>
<a id="pgfId-1304341"></a>Specify 5 in the <em>MaximOrder (int)</em> field.</li><li>
<a id="pgfId-1304348"></a>Run the simulation.</li><li>
<a id="pgfId-1304355"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</li><li>
<a id="pgfId-1304378"></a>Plot the output as desired. In the example below, the complete ifft and the spectral content at the receiver inputs are plotted.<br />
<a id="pgfId-1308017"></a><div class="webflare-div-image">
<img width="619" height="401" src="images/Chap3-194.gif" /></div></li></ol>

















<h3>
<a id="pgfId-1304082"></a>Compres<a id="marker-1299023"></a>sion Point</h3>

<p>
<a id="pgfId-1089912"></a>To get the compression point curve on the Direct Plot Form, first run an hb analysis (see <a href="Chap3.html#14890">Two Input Frequencies</a>).</p>
<p>
<a id="pgfId-1345942"></a>Follow the steps below to get the compression point curve on the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1089917"></a>Select <em>Compression Point</em>.<br />
<a id="pgfId-1257013"></a><div class="webflare-div-image">
<img width="669" height="792" src="images/Chap3-195.gif" /></div></li><li>
<a id="pgfId-1346047"></a>Select the desired value (port, net, or differential net) from the <em>Select</em> drop-down list.</li><li>
<a id="pgfId-1346051"></a>Select whether you want the output power or the gain plotted on the Y axis as a function of the input power from the <em>Format</em> drop-down list.</li><li>
<a id="pgfId-1089452"></a>Select the desired amount of compression in the <em>Gain Compression (dB)</em> field. For small amounts of compression you might need to use conservative in the hb <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1089453"></a>Specify the desired level of input power to begin drawing the 1dB down ideal 1dB per dB curve. The default is to drop down the amount of compression specified at the lowest power point of the sweep.</li><li>
<a id="pgfId-1089454"></a>Select the desired output-referred or input-referred compression point.</li><li>
<a id="pgfId-1089455"></a>Select the desired frequency of the output harmonic.</li></ol>










<p>
<a id="pgfId-1089456"></a>This is the compression plot. The ideal 1dB per dB curve is drawn and the compression point is shown at the upper right of the plot. </p>

<p class="webflare-indent1">
<a id="pgfId-1089460"></a></p>
<div class="webflare-div-image">
<img width="669" height="462" src="images/Chap3-196.gif" /></div>
<h3>
<a id="pgfId-1089461"></a>IFF<a id="marker-1299028"></a>T</h3>

<p>
<a id="pgfId-1089939"></a>To get the time-domain waveform, select the following values on the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1089466"></a>Select <em>Voltage</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1346090"></a>Select <em>ifft </em>from the <em>Sweep</em> section.</li><li>
<a id="pgfId-1089467"></a>For multi tone simulations, the default is to filter out the higher harmonics of the hb analysis in order to improve the plotting speed.</li><li>
<a id="pgfId-1089468"></a>Select the desired input power for the ifft plot. </li></ol>



<p>
<a id="pgfId-1089469"></a>This results in a good waveform that plots quickly. Only the lower frequency harmonics are present in this plot. </p>

<p>
<a id="pgfId-1089473"></a></p>
<div class="webflare-div-image">
<img width="668" height="470" src="images/Chap3-197.gif" /></div>

<p>
<a id="pgfId-1089474"></a>To get the best waveform, select the <em>Complete ifft</em> checkbox. The plotting time can be considerable for 3 and 4 tone simulations. </p>

<p>
<a id="pgfId-1089478"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/image009.gif" /></div>

<p>
<a id="pgfId-1089479"></a>Note that not all the harmonics are present in the upper (default) waveform. You choose if you want a quick idea or the plot with all the harmonics. If you want the higher order harmonics in the waveform, select the<em> Complete ifft</em> checkbox in the <em>Direct Plot Form</em>. The full waveform and the zoomed-in views are shown below. </p>

<p>
<a id="pgfId-1089483"></a></p>
<div class="webflare-div-image">
<img width="668" height="526" src="images/Chap3-199.gif" /></div>

<p>
<a id="pgfId-1089989"></a></p>

<div class="webflare-div-image">
<img width="668" height="601" src="images/Chap3-200.gif" /></div>
<h3>
<a id="pgfId-1090072"></a>Compression Vs Pout</h3>

<p>
<a id="pgfId-1090026"></a>Another thing you can plot from a sweep is the compression versus the output power. To do this:</p>
<ol><li>
<a id="pgfId-1346255"></a>Select <em>Comp Vs Pout </em>from the <em>Function</em> section.<br />
<a id="pgfId-1089488"></a><div class="webflare-div-image">
<img width="670" height="734" src="images/Chap3-201.gif" /></div></li><li>
<a id="pgfId-1346305"></a>Several different types of data can be selected. For example, a net, or differential nets. A port is shown in the figure above.</li><li>
<a id="pgfId-1346338"></a>The zero compression input power can be set in the field, as shown below. The default is the lowest power point of the sweep.<br />
<a id="pgfId-1089498"></a><div class="webflare-div-image">
<img width="670" height="53" src="images/Chap3-202.gif" /></div></li><li>
<a id="pgfId-1089499"></a>Select the frequency of the harmonic that you want to plot. <br />
<a id="pgfId-1089503"></a><div class="webflare-div-image">
<img width="670" height="193" src="images/Chap3-203.gif" /></div></li><li>
<a id="pgfId-1090087"></a>Select the port in the circuit.</li></ol>
















<p>
<a id="pgfId-1089504"></a>The output is displayed as below. </p>

<p>
<a id="pgfId-1089508"></a></p>
<div class="webflare-div-image">
<img width="665" height="469" src="images/Chap3-204.gif" /></div>
<h2>
<a id="pgfId-1090105"></a><a id="35028"></a>Example Using the Harmonic Port with Harmonic Balance</h2>

<p>
<a id="pgfId-1170908"></a>The port component has a feature called the harmonic port that allows the specification of different impedances at different harmonic numbers. This is available for harmonic balance large-signal analyses only, and does not work with any other analysis.</p>
<p>
<a id="pgfId-1170936"></a>For this example, a 2.4GHz LNA is the example circuit.</p>

<p>
<a id="pgfId-1257522"></a></p>
<div class="webflare-div-image">
<img width="666" height="617" src="images/Chap3-205.gif" /></div>

<p>
<a id="pgfId-1257530"></a>The input and output ports are set up normally, as shown in the properties forms below.</p>

<p>
<a id="pgfId-1257591"></a></p>
<div class="webflare-div-image">
<img width="462" height="800" src="images/Chap3-206.gif" /></div>

<p>
<a id="pgfId-1257531"></a>PORT1 is the input and PORT2 is the output.</p>

<p>
<a id="pgfId-1257561"></a></p>
<div class="webflare-div-image">
<img width="616" height="735" src="images/Chap3-207.gif" /></div>
<h4><em>
<a id="pgfId-1171599"></a>One Input Frequency</em></h4>

<p>
<a id="pgfId-1171656"></a>The harmonic balance <em>Choosing Analyses</em> form has a single input applied.</p>

<p>
<a id="pgfId-1257697"></a></p>
<div class="webflare-div-image">
<img width="429" height="767" src="images/Chap3-208.gif" /></div>

<p>
<a id="pgfId-1170979"></a>To use the harmonic port, select <em>Harmonic Port</em> on the <em>Edit Object Properties</em> form. In this case, the port being used as a load in the circuit is selected. The <em>Edit harmonic port</em> window is displayed.</p>

<p>
<a id="pgfId-1257753"></a></p>
<div class="webflare-div-image">
<img width="568" height="432" src="images/Chap3-209.gif" /></div>

<p>
<a id="pgfId-1171236"></a>For this setup, a single input frequency is applied to the circuit. In this case, harmonic numbers 1, 2, 3, 4, and 5 exist in the simulation result. In the <em>Harmonic</em> column, you enter the harmonic number. In the <em>Resistance</em> column, you enter the resistance. In the <em>Reactance</em> column, you enter the series reactance in ohms. Positive reactance adds inductance, and negative reactance adds capacitance. Multiple entries are allowed, therefore, different impedances can be set for each harmonic. The resistance or reactance can be left blank, which is interpreted as zero resistance or reactance.</p>

<p>
<a id="pgfId-1257795"></a></p>
<div class="webflare-div-image">
<img width="571" height="433" src="images/Chap3-210.gif" /></div>

<p>
<a id="pgfId-1171257"></a>Here is an example where the third harmonic is set to 1 ohm in series with +j1mohm. This should lower the amplitude of the third harmonic.</p>

<p>
<a id="pgfId-1257864"></a></p>
<div class="webflare-div-image">
<img width="581" height="532" src="images/Chap3-211.gif" /></div>

<p>
<a id="pgfId-1171335"></a>The top trace is the normal port, and the bottom is the trace with the third harmonic set to 1ohm in series with +j1milliohm. Note that the third harmonic is smaller.</p>

<h4><em>
<a id="pgfId-1171454"></a>Two Input Frequencies</em></h4>

<p>
<a id="pgfId-1171768"></a>Now the harmonic balance <em>Choosing Analyses</em> form has two frequencies.</p>

<p>
<a id="pgfId-1257953"></a></p>
<div class="webflare-div-image">
<img width="436" height="767" src="images/Chap3-212.gif" /></div>

<p>
<a id="pgfId-1257941"></a>Also, the diamond cut is set with a very large <em>MaximOrder</em>. The reason for doing this is to see the harmonic numbers that correspond to the frequencies produced by the circuit. Each frequency has 2 harmonic numbers that indicate which harmonics are mixing with which to produce a specific output frequency. For example, take the 2.44GHz term. The harmonic number is 1 0. The frequency that is produced is 1*2.44G + 0*2.46G. Now look at the intermod at 2.42GHz. This index is 2 -1. The frequency is 2*2.44G - 1*2.46G. These are the harmonic numbers that can be set for the harmonic port. Wild cards (*) are not allowed in the harmonic number specification.</p>
<p>
<a id="pgfId-1171806"></a>Note that if there were three input frequencies, there would be three numbers that specify every output frequency.</p>
<p>
<a id="pgfId-1171813"></a>In this case, if the harmonic was specified as 3, there would be an error produced by spectre because there is a single index in the harmonic, but there are 2 indices for all the harmonics of the existing simulation. The number of numbers in the harmonic field must match the number of input freqeuncies in the circuit.</p>

<p>
<a id="pgfId-1258080"></a></p>
<div class="webflare-div-image">
<img width="663" height="437" src="images/Chap3-213.gif" /></div>

<p>
<a id="pgfId-1172037"></a>The above example sets the impedance of the third order intermods to be much lower than 50 ohms. If the source is in series, setting the resistance and/or reactance to a large number can block harmonics you do not want. If the port is in parallel like this one, setting small resistance and reactance values can short out an undesired harmonic. This can be used for debugging the circuit, or for setting values to maximize power-added efficiency.</p>

<p>
<a id="pgfId-1258134"></a></p>
<div class="webflare-div-image">
<img width="664" height="531" src="images/Chap3-214.gif" /></div>

<p>
<a id="pgfId-1172058"></a>The top trace above is from the normal port, and the bottom trace is from the harmonic port. The third order harmonics are much smaller because they are essentially shorted out.</p>

<h2>
<a id="pgfId-1170882"></a>Three Tone Harmoni<a id="marker-1299090"></a>c Balance</h2>

<p>
<a id="pgfId-1092373"></a>Generally, a 3 tone harmonic balance simulation is used to calculate large-signal IP3 for transmit applications. If you need a small-signal IP3 measurement, see Rapid IP3 in the hbac section of this chapter. For a small-signal IP3 measurement, Rapid IP3 is much faster and is usually more accurate than a 3-tone harmonic balance simulation.</p>
<p>
<a id="pgfId-1120628"></a>In a 3-tone simulation, first decide if you want to remove the higher order terms from the solution. If you remove the high order harmonics from the simulation, it can run faster because fewer harmonics are calculated. </p>
<p>
<a id="pgfId-1258194"></a><em>On the Choosing Analyses form</em>:</p>

<p>
<a id="pgfId-1092377"></a></p>
<div class="webflare-div-image">
<img width="668" height="800" src="images/Chap3-215.gif" /></div>

<ol><li>
<a id="pgfId-1089514"></a>To trim the high-order harmonics, choose <em>Select</em> from the <em>Harmonics</em> drop-down list.<br />
<a id="pgfId-1089519"></a><em>Funnel is recommended for systems where one or more signals cause a lot of distortion compared to the rest of the signals. Generally, these systems are mixers or sampling circuits that have large amplitude LO or sampling clock signals. Funnel </em>calculates the harmonics whose order is less than that specified in <em>MaximOrder</em> from the simulation and adds the harmonics of the LO and RF tones but not the higher order mixing products.<br />
<a id="pgfId-1120801"></a>Funnel cuts the harmonics whose order is higher than that specified in <em>MaximOrder</em>, but it does not cut the lower-order harmonics of the mixing products. For example, you might set funnel and <em>MaximOrder</em> to six. This calculates the sixth order and lower mixing products, but allows the higher order (up to the 10 harmonics specified for Tone1) LO harmonics to be calculated. This is useful for mixer simulations where you know that the LO produces relatively more harmonics than you want with <em>MaximOrder</em>. Setting <em>maximOrder</em> to six is the recommended starting point for a large-signal IP3 measurement in a down-convert mixer.</li><li>
<a id="pgfId-1089526"></a>To see the actual harmonic frequencies to be run in a list, type a frequency range in the fields next to <em>Harmonics</em> drop-down list.<br />
<a id="pgfId-1089530"></a><div class="webflare-div-image">
<img width="634" height="290" src="images/Chap3-216.gif" /></div></li><li>
<a id="pgfId-1089531"></a>Click <em>OK</em> and start the simulation.</li></ol>









<h3>
<a id="pgfId-1092396"></a>Large-Sign<a id="marker-1299105"></a>al IP3</h3>

<p>
<a id="pgfId-1092382"></a>To plot a large-signal IP3, in the <em>Direct Plot Form</em>:</p>

<p class="webflare-indent1">
<a id="pgfId-1089535"></a></p>
<div class="webflare-div-image">
<img width="633" height="753" src="images/Chap3-217.gif" /></div>

<ol><li>
<a id="pgfId-1089536"></a>Select <em>IPN Curves</em>.</li><li>
<a id="pgfId-1098289"></a>Select the <em>Variable Sweep</em> radio button.</li><li>
<a id="pgfId-1089537"></a>Select the input power level you want to do the third order projection from. The default is the lowest power of the sweep.</li><li>
<a id="pgfId-1089538"></a>Select Input or Output referred from the drop-down list.</li><li>
<a id="pgfId-1089539"></a>Select the order from the <em>Order</em> drop-down list. <em>3rd</em> order is the default.</li><li>
<a id="pgfId-1089540"></a>Select the 2nd or 3rd order frequency in the <em>2nd Order Harmonic or 3rd Order Harmonic</em> fields.</li><li>
<a id="pgfId-1089541"></a>Select the first order frequency in the <em>1st Order Harmonic field</em>.</li></ol>






<p>
<a id="pgfId-1089545"></a>The IP3 calculation (Input Referred IP3 = 4.97 dBm in the plot below) looks like it is tied to the last datapoint of the third order curve. It is tied there so it will be displayed on the screen. It actually calculates the intercept point. </p>
<p>
<a id="pgfId-1089546"></a>The extrapolation point (ep = -50 in the plot below) is the input power level that the IP3 calculation is done from. This is the input power level where the ideal curves and the measured data overlay.</p>

<p>
<a id="pgfId-1089550"></a></p>
<div class="webflare-div-image">
<img width="668" height="416" src="images/Chap3-218.gif" /></div>

<p>
<a id="pgfId-1089551"></a>In the IP3 plot for a small-signal IP3 measurement, look for the ideal curves and the data to nearly overlay each other on the third order curve for at least a 10dB range of input power. The plot above shows the data and the ideal curves being essentially the same from -50 to about -15 dBm.</p>
<p>
<a id="pgfId-1121158"></a>The bottom right corner of the plot shows the following in the order as listed below:</p>
<ul><li>
<a id="pgfId-1089552"></a>Output of the circuit.</li><li>
<a id="pgfId-1089553"></a>Third order frequency.</li><li>
<a id="pgfId-1089554"></a>First order frequency.</li></ul>


<p>
<a id="pgfId-1090244"></a>Note that the above IP3 is really a small-signal IP3 measurement. For a much faster IP3 calculation use Rapid IP3 as documented in the hbac and pac sections. For a large-signal IP3 calculation, set the extrapolation point to the desired input power for the large-signal measurement as shown below in the direct plot form.</p>

<p>
<a id="pgfId-1090270"></a></p>
<div class="webflare-div-image">
<img width="668" height="780" src="images/Chap3-219.gif" /></div>

<p>
<a id="pgfId-1090296"></a>Now either select replot, or select the output port in the schematic.</p>

<p>
<a id="pgfId-1097595"></a></p>
<div class="webflare-div-image">
<img width="668" height="438" src="images/Chap3-220.gif" /></div>

<p>
<a id="pgfId-1097596"></a>Note that the IP3 calculation has changed from 4.97dBm to 2.11dBm.</p>

<h3>
<a id="pgfId-1097612"></a>Multi-Sinusoid<a id="marker-1299110"></a> hb Analysis</h3>

<p>
<a id="pgfId-1097630"></a>The port component has been enhanced to support the generation of up to nine sinusoids simultaneously. To do this, <em>Frequency</em> 2 needs to be set to the spacing frequency. All the sinusoids need to have equal spacing frequencies. <em>Frequency 1</em> in the port needs to be set to the center frequency of the multiple output frequencies. The center frequency needs to be one of the frequencies that is generated. For example, imagine that 1GHz, 1.01GHz, and 1.02GHz need to be generated. The center frequency in this case is 1.01GHz and the spacing is 10MHz. Now imagine that 1GHz, 1.01GHz, 1.02GHz, and 1.03GHz need to be generated. Now the center frequency could be either 1.01GHz or 1.02GHz.</p>
<p>
<a id="pgfId-1097632"></a>Once the center frequency and spacing are defined, click <em>Display Multi Sinusoid</em>. Next, specify the number of carriers you want to generate. There is a maximum limit of nine in one port. If you need more than nine tones, add more ports in series, all with the same center frequency and spacing. Specify the frequencies you need to generate in the additional ports. Divide the port resistance desired by the number of ports you have in series. Note that when you do this, you will need to scale the power in dBm for all the tones in the multi sinusoid because the voltage is set in the port assuming there is a match with the port resistance on the port output. In the case of stacking, the overall resistance is the desired port resistance.</p>

<div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1106467"></a>
The phase unit for the multi-sinusoid outputs is radians, not degrees.</div>

<p>
<a id="pgfId-1097633"></a>Once the input frequencies are defined, fields are displayed to specify the frequency and amplitude of each sinusoid to be generated. All the frequencies must be either the center frequency specified in the <em>Frequency </em>1 field, or <em>Frequency 1</em> with integer spacing frequency offsets from frequency one.</p>
<p>
<a id="pgfId-1097634"></a>Below is an example of the port setup to generate three signals.</p>

<p>
<a id="pgfId-1097622"></a></p>
<div class="webflare-div-image">
<img width="668" height="802" src="images/Chap3-221.gif" /></div>

<p>
<a id="pgfId-1097721"></a>Note that the frequency 2.45G is not generated for this test. For a composite triple beat measurement, one of the frequencies will be missing. For that frequency, just do not specify it.</p>
<p>
<a id="pgfId-1097722"></a>When the hb analysis is set up in ADE Explorer for an amplifier, specify only two input frequencies. The center frequency and the spacing frequency should be specified in the <em>Fundamental Frequency</em> field.</p>
<p>
<a id="pgfId-1097791"></a>For harmonics, set the total number of possible carriers in the total frequency range. In this case, there are three signals, but there is a fourth possible harmonic at 2.45GHz. In this case, the number of harmonics needs to be four for both tones.</p>
<p>
<a id="pgfId-1097792"></a>Since all the inputs are sinusoids, <em>Oversample Factor</em> is set to one.</p>
<p>
<a id="pgfId-1097793"></a>An example is shown below.</p>

<p>
<a id="pgfId-1097702"></a></p>
<div class="webflare-div-image">
<img width="668" height="772" src="images/Chap3-222.gif" /></div>

<p>
<a id="pgfId-1097801"></a>Now run the simulation. The output node of the circuit is plotted.</p>

<p>
<a id="pgfId-1097827"></a></p>
<div class="webflare-div-image">
<img width="668" height="505" src="images/Chap3-223.gif" /></div>

<p>
<a id="pgfId-1097845"></a>An example with five input frequencies is shown below.</p>

<p>
<a id="pgfId-1097875"></a></p>
<div class="webflare-div-image">
<img width="668" height="798" src="images/Chap3-224.gif" /></div>

<p>
<a id="pgfId-1097893"></a>If an LNA-Mixer combination is to be simulated, then there are three tones for this simulation: the center frequency, the spacing frequency, and the LO frequency. For the center and spacing frequencies, five carriers are possible, so five harmonics are set. Ten harmonics are set for the LO. The hb <em>Choosing Analyses</em> form is shown below.</p>

<p>
<a id="pgfId-1097921"></a></p>
<div class="webflare-div-image">
<img width="668" height="744" src="images/Chap3-225.gif" /></div>

<p>
<a id="pgfId-1097950"></a>Now run the simulation. The down-converted output of the circuit is shown below. </p>

<p>
<a id="pgfId-1433333"></a></p>
<div class="webflare-div-image">
<img width="668" height="432" src="images/Chap3-226.gif" /></div>
<h3>
<a id="pgfId-1433337"></a>Low Memory Usage For hb Multi-Tone Analysis</h3>

<p>
<a id="pgfId-1433338"></a>When performing multi-tone hb analysis, you can use the <em>Lowmem </em>option on the hb Choosing Analysis form to reduce the memory cost. This option is available for all hb and hb-based small signal analyses. Depending on the case, the <em>Lowmem</em> option can reduce the peak memory cost by 0 to 70 percent. Memory reductions get larger as the number of total harmonics increases. In general, a 3-tone hb simulation with many harmonics will get the best benefit. Adding small-signal analyses like hbnoise with <em>Lowmem</em> to these analyses will also benefit.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1433339"></a>Lowmem is supported only for driven multi-tone hb circuits. Autonomous and single-tone hb circuits are not supported.</div>
<p>
<a id="pgfId-1433340"></a><em>Lowmem</em> is enabled on the hb Choosing Analysis form when a multi-tone is selected in the <em>Number of Tones</em> field:</p>

<p>
<a id="pgfId-1433344"></a></p>
<div class="webflare-div-image">
<img width="403" height="786" src="images/Chap3-227.gif" /></div>

<p>
<a id="pgfId-1433345"></a>The following image shows a sample netlist with <em>Lowmem</em> set <em>yes</em>.</p>

<p>
<a id="pgfId-1433349"></a></p>
<div class="webflare-div-image">
<img width="674" height="713" src="images/Chap3-228.gif" /></div>
<h2>
<a id="pgfId-1097598"></a><a id="94160"></a>Harmonic Balance AC Ana<a id="HBAC"></a>lysis (hb<a id="marker-1433326"></a>AC)</h2>
<h3>
<a id="pgfId-1066362"></a>Small-signal Versus Large-Signal Analysis for Conversion Gain</h3>

<p>
<a id="pgfId-1069062"></a>One way to measure conversion gain is to apply the LO and the RF signals in harmonic balance (hb) and calculate the full large-signal response at each RF input frequency, and then plot the output as a function of the sweep frequency. While this works, because all the large-signal effects and many harmonics are calculated, the required time for the simulation can be significant.</p>
<p>
<a id="pgfId-1069063"></a>The alternative is to use a small-signal approach similar to the AC analysis. The AC analysis runs considerably faster than running the transient at multiple frequencies because it ignores the large-signal effects. In circuits with frequency translation, the AC analysis is unusable because the calculation is based on the DC bias point. In hbac analysis, instead of using the DC bias point, the harmonic balance solution with just the LO is used as the basis of the calculation. The large-signal analysis only calculates the harmonics of a single input, and no mixing products, and then hbac is run after the hb analysis. The overall time savings can be very significant.</p>
<p>
<a id="pgfId-1069064"></a>The hb solution with the LO calculates the amplitude of the harmonics and it characterizes the nonlinearity of the system. Therefore, in hbac, the output mixing products of the input signal mixing with the LO harmonics can be calculated. Because the signal is considered to be small-signal, harmonics of the hbac test signal are not calculated. Like AC analysis, hbac allows the input to be swept in frequency in order to calculate a frequency response of the output mixing products.</p>
<p>
<a id="pgfId-1095988"></a>For example, think of a perfectly linear circuit with a single input applied. Because the circuit is perfectly linear, the output spectrum that would be calculated by the hb analysis would have only the first harmonic in it. Because the circuit is linear, if a second input was applied, no frequency translation can occur.</p>
<p>
<a id="pgfId-1095990"></a>Now imagine a real circuit with a single small input amplitude signal at 1GHz. Because the circuit has nonlinear devices, the output will contain 1GHz and the integer multiples of 1 GHz. Because the input signal is small, the amplitude of the harmonics is small, and if a second input were applied at 1.1 GHz, that signal would be very weakly converted when it is mixed with the harmonics of the circuit. Certainly, 1.1GHz would appear at the output with no mixing. 100MHz and 2.1GHz are produced by mixing with the 1GHz fundamental frequency. 900MHz and 3.1GHz are produced when 1.1GHz mixes with the second harmonic of the 1GHz input. 1.1GHz mixes with the other harmonics as well, producing a wide range of output frequencies from a single input frequency.</p>
<p>
<a id="pgfId-1095992"></a>Now imagine that the 1GHz signal is large. The output harmonics above the first harmonic are much larger. If the input went up 10dB, the first harmonic goes up 10dB, the second harmonic goes up 20dB, the third harmonic goes up 30dB, and so on. If a second input at 1.1GHz were applied to the circuit, this mixes with the harmonics of 1GHz and more strongly mixes up and down in frequency.</p>
<p>
<a id="pgfId-1095994"></a>Therefore, the harmonic content of the hb analysis contains information about how strongly a circuit translates frequencies, and this is used by the small-signal analyses hbac, hbnoise, and hbsp in order to calculate the small-signal conversion gain. This section is about hbac analysis.</p>

<h3>
<a id="pgfId-1069054"></a>Example: Conversion Gain (Down con<a id="marker-1299177"></a>version)</h3>

<p>
<a id="pgfId-1069102"></a>Consider the double-balanced diode mixer shown below.</p>

<p>
<a id="pgfId-1069233"></a></p>
<div class="webflare-div-image">
<img width="668" height="572" src="images/Chap3-229.gif" /></div>

<p>
<a id="pgfId-1069338"></a>The RF input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed.</p>
<p>
<a id="pgfId-1069339"></a>The property list is shown below.</p>

<p>
<a id="pgfId-1069342"></a></p>
<div class="webflare-div-image">
<img width="668" height="724" src="images/Chap3-230.gif" /></div>

<p>
<a id="pgfId-1069376"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> -&gt; <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type the desired value, and press <em>Enter</em>.</p>
<p>
<a id="pgfId-1069377"></a>The LO frequency is 1GHz and its amplitude is 1.4 volts peak. This is +13 dBm. The RF frequency is 1.1GHz, but it is disabled because the amplitude is set to 0 (zero). Setting either the frequency or the amplitude to zero disables the production of that waveform from the port.</p>

<p>
<a id="pgfId-1069335"></a></p>
<div class="webflare-div-image">
<img width="668" height="582" src="images/Chap3-231.gif" /></div>

<p>
<a id="pgfId-1069116"></a>The hb analysis needs to be set up first. The example below shows a single input at 1GHz with 51 harmonics. For more information, see the harmonic balance section.</p>

<p>
<a id="pgfId-1069123"></a></p>
<div class="webflare-div-image">
<img width="668" height="784" src="images/Chap3-232.gif" /></div>

<p>
<a id="pgfId-1069130"></a>Next, the hbAC analysis needs to be set up. Like AC, the frequency range specified in the form is the input frequency range. <em>Maximum sideband</em> should be left blank so that all the mixing products from all the harmonic balance harmonics are present in the output of hbac.</p>

<p>
<a id="pgfId-1069137"></a></p>
<div class="webflare-div-image">
<img width="668" height="720" src="images/Chap3-233.gif" /></div>

<p>
<a id="pgfId-1069440"></a>Once the analyses are set up, run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</p>
<p>
<a id="pgfId-1069441"></a>The example below shows a typical plot.</p>

<p>
<a id="pgfId-1069144"></a></p>
<div class="webflare-div-image">
<img width="668" height="543" src="images/Chap3-234.gif" /></div>

<p>
<a id="pgfId-1069470"></a>When the net in the schematic is selected, the waveform is displayed.</p>
<p>
<a id="pgfId-1069471"></a>Note that all the short line segments are the mixing products that are produced when mixed with the harmonics in the harmonic balance large-signal analysis.</p>

<p>
<a id="pgfId-1069151"></a></p>
<div class="webflare-div-image">
<img width="668" height="464" src="images/Chap3-235.gif" /></div>

<p>
<a id="pgfId-1069158"></a>Usually, the frequencies that are produced for the down-converted product are desired. In the <em>Direct Plot Form</em>, select <em>sideband</em> instead of <em>spectrum</em>, and then select the desired frequency range from the list at the bottom of the form. Only that mixing product will be displayed, as shown below. The conversion loss is about 6dB.</p>

<p>
<a id="pgfId-1069165"></a></p>
<div class="webflare-div-image">
<img width="668" height="461" src="images/Chap3-236.gif" /></div>
<h3>
<a id="pgfId-1069538"></a>Example: Conversion Gain (Up Conv<a id="marker-1299188"></a>ersion)</h3>

<p>
<a id="pgfId-1069539"></a>The process is similar for an up-conversion mixer. In this case the input frequency is low, as shown below.</p>

<p>
<a id="pgfId-1069172"></a></p>
<div class="webflare-div-image">
<img width="668" height="719" src="images/Chap3-237.gif" /></div>

<p>
<a id="pgfId-1069179"></a>In the <em>Direct Plot Form</em>, both the outputs above and below the LO frequency might be desired. Select the first frequency, and click the second while holding the &lt;<em>Ctrl&gt;</em> key. Now select the node in the circuit and the results will plot.</p>

<p>
<a id="pgfId-1069186"></a></p>
<div class="webflare-div-image">
<img width="668" height="677" src="images/Chap3-238.gif" /></div>

<p>
<a id="pgfId-1069193"></a>Note that the conversion loss is almost identical for both mixing products.</p>

<p>
<a id="pgfId-1069200"></a></p>
<div class="webflare-div-image">
<img width="668" height="442" src="images/Chap3-239.gif" /></div>
<h3>
<a id="pgfId-1069207"></a>Overview of Simulation Capabilities</h3>
<h4>
<a id="pgfId-1069633"></a>Specialized Analys<a id="marker-1299193"></a>is=None</h4>
<h4><em>
<a id="pgfId-1069643"></a>Down Conversion: Input Near the First harmonic</em></h4>

<p>
<a id="pgfId-1069660"></a>At the bottom of the hbac <em>Choosing Analyses</em> form, there is a selection called <em>Specialized Analyses</em>. The default is <em>None</em>, and this is for measuring the conversion gain that is the average conversion gain with the large signal applied to the circuit (usually the LO). The mixing products that are produced are called sidebands. The sideband number is the harmonic number that is being mixed with to provide the output. A positive number means that the output mixing product is higher in frequency than the input frequency specified in the <em>Choosing Analyses</em> form. A negative number means that the output is lower in frequency than the input frequency. A diagram is shown below.</p>

<p>
<a id="pgfId-1069683"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3diag1.gif" /></div>

<p>
<a id="pgfId-1069717"></a>We tend to think of positive frequencies. The default is to reflect negative frequencies to positive frequencies.</p>
<p>
<a id="pgfId-1069718"></a>The sideband number is the harmonic that the input mixes with. Negative numbers are downconverted in frequency, and positive numbers are upconverted in frequency. </p>
<p>
<a id="pgfId-1069719"></a>Again, in hbac, a single input frequency is applied at a time, and then the output mixing products are calculated through the highest harmonic of the harmonic balance simulation specified by the<em> Maximum sideband</em> parameter. Leaving that parameter blank is recommended, and this calculates the mixing products for all the harmonics in hb. There is no run-time penalty for calculating all the mixing products. There is a runtime penalty for increasing the number of harmonics in the hb analysis.</p>
<p>
<a id="pgfId-1069720"></a>Note that the input causes harmonics and the output mixing products cause harmonics. Consider a mixer with a 1GHz LO and a 1.1GHz input. All the LO harmonics are calculated by the hb analysis. When 1.1GHz mixes with 1GHz, an output at 100MHz is produced. Because the circuit is nonlinear, harmonics of 100MHz are produced. hbac is a small-signal analysis, and the assumption is that those harmonics do not matter. They are not calculated. In practical circuits, this limitation is not usually significant because generally, we work with the output frequency itself, not its harmonics.</p>

<h4><em>
<a id="pgfId-1069709"></a>Up-conversion: Input Near Zero Frequency</em></h4>

<p>
<a id="pgfId-1069747"></a>In a similar manner, up-conversion is shown below.</p>

<p>
<a id="pgfId-1069766"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3diag2.gif" /></div>
<h4><em>
<a id="pgfId-1069791"></a>Frequency S<a id="marker-1299201"></a>weep</em></h4>

<p>
<a id="pgfId-1069821"></a>This analysis is like AC, where the input frequency is swept. The input frequency range is specified in the hbac <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1105839"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonic in the harmonic balance analysis. For example, assume that the harmonic balance is at 1GHz, and a log sweep is desired above the first harmonic of the hb analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 in the <em>Relative Harmonic</em> field. Next, type 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade.</p>
<p>
<a id="pgfId-1105840"></a>The sweep will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1105844"></a></p>
<div class="webflare-div-image">
<img width="668" height="306" src="images/Chap3-242.gif" /></div>

<p>
<a id="pgfId-1105845"></a>To use a log sweep below the first harmonic, use the same frequency range, and type -1 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1105849"></a></p>
<div class="webflare-div-image">
<img width="668" height="383" src="images/Chap3-243.gif" /></div>
<h4><em>
<a id="pgfId-1069824"></a>Maximu<a id="marker-1299219"></a>m Sideband</em></h4>

<p>
<a id="pgfId-1096112"></a>Conceptually, an infinite number of mixing products are produced when a single input is applied to a nonlinear system. From the practical point of view, usually only a small number of mixing products need to be measured.</p>
<p>
<a id="pgfId-1096113"></a>There is a property in the <em>Choosing Analyses</em> form called <em>Maximum sideband</em> that is used to define how many mixing products should be calculated. If <em>Maximum sideband</em> is zero, the hbac analysis will only contain the frequency that appears without mixing or aliasing of any type. This is not equivalent to a linear AC analysis because hbac takes into account the instantaneously varying nature of the LO signal because of the large signal being present in the hb analysis.</p>
<p>
<a id="pgfId-1069846"></a>When <em>Maximum sideband</em> is one, the outputs without frequency translation and the outputs that mix or alias with the first harmonic are present in the hbac analysis. When <em>Maximum sideband</em> is 10, the hbac analysis includes mixing through the 10th harmonic of the harmonic balance analysis. Usually the number of harmonics in the hb analysis and the maximum number of sidebands should agree. This is easily accomplished by leaving the <em>Maximum sideband </em>field blank in the <em>Choosing Analyses</em> form in ADE Explorer.</p>

<h4><em>
<a id="pgfId-1069862"></a>Setting Harmonics and Sidebands</em></h4>

<p>
<a id="pgfId-1329555"></a>The process of setting harmonics and sidebands is similar to setting the maximum number of harmonics for the harmonic balance simulation. Start with an estimate based on the harmonic content of the input signal(s) and the nonlinearity of the circuit. Then run a simulation. Raise harmonics and sidebands and run again. If the conversion gain measurement did not change, then the original number of harmonics and sidebands might be able to be reduced. If it did change, then more are needed. Getting a stable hbac output may take more or fewer harmonics and sidebands than the harmonic balance simulation by itself.</p>

<h4>
<a id="pgfId-1329557"></a><a id="marker-1329556"></a>Modulated</h4>

<p>
<a id="pgfId-1329558"></a>Modulated hbac is typically used for measuring AM to PM measurements in driven circuits and oscillators. In this case, the input is usually the power supply ripple at low frequency, and the desired output is near the first harmonic of the output. Hbac apples a modulated input signal to the circuit, and is able to measure a modulated output signal from the circuit. The types of modulation are Single Side Band (SSB), AM, and PM.</p>
<p>
<a id="pgfId-1069890"></a>A diagram is shown below for ssb input.</p>

<p>
<a id="pgfId-1069881"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3diag3.gif" /></div>

<p>
<a id="pgfId-1069925"></a>Note that although the input occurs at one frequency, the AM output can be measured directly from the single input.</p>
<p>
<a id="pgfId-1069926"></a>When AM is applied at the input, the following diagram is shown.</p>

<p>
<a id="pgfId-1069917"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3diag4.gif" /></div>

<p>
<a id="pgfId-1092460"></a>The difference is that in addition to the input at low positive frequency, another input (to form an AM signal) is applied at low negative input. This second input adds to the output signal near the first harmonic.</p>
<p>
<a id="pgfId-1092461"></a>For PM, the negative input amplitude is negative, as shown below.</p>

<p>
<a id="pgfId-1092465"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3diag5.gif" /></div>

<p>
<a id="pgfId-1070021"></a>By running all three inputs, the SSB/AM/PM input to SSB/AM/PM output can be calculated. This is a setup choice in the <em>Choosing Analyse</em>s form.</p>
<p>
<a id="pgfId-1070022"></a>In the <em>Choosing Analyses</em> form, the input frequency range, and the output harmonic must also be specified.</p>
<p>
<a id="pgfId-1070023"></a>All the plot functions are implemented in the <em>Direct Plot Form</em>.</p>

<h4>
<a id="pgfId-1070036"></a>Rapid IP2/IP3 (AC a<a id="marker-1299229"></a>nd PAC)</h4>

<p>
<a id="pgfId-1070037"></a>Note that Rapid IP2 and Ra<a id="marker-1299234"></a>pid IP3 in hbac can only be selected when a single tone hb analysis is run. This would be the LO signal for a mixer. hbAC and AC add the ability to have multiple input frequencies. The Rapid IP2 and Rapid IP3 that is available in the AC analysis form allows the calculation of IP2 and IP3 for amplifiers, or other circuits where there is no frequency translation. In hbac, Rapid IP3 and Rapid IP2 are provided for circuits that translate frequencies, whether that translation is an up or down conversion. Note that hbac and ac are small-signal analyses, so the limitation is that the measurement is a small-signal IP3. If you need a large-signal IP2 or IP3 measurement, use a large-signal analysis like hb or qpss to make the measurement. Note that when you are using Rapid IP2 or Rapid IP3 in the AC analysis, either a SpectreRF license is required, or an additional mmsim token is required to run the analysis.</p>
<p>
<a id="pgfId-1070053"></a>hbAC and AC Rapid IP3 also add the ability to calculate the harmonics and mixing products that are generated by the two input frequencies. Make sure that the input level is in the small-signal range. Rapid IP2 and IP3 have exceptionally small numerical noise floors, therefore, it is recommended that you specify a level that is too small, rather than too large.</p>
<p>
<a id="pgfId-1070054"></a>The plot functions for Rapid IP2 and IP3 are implemented in the <em>Direct Plot Form</em>. Select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. In the <em>Direct Plot Form</em>, select <em>ac</em> or <em>hbac</em> from the <em>Analysis</em> section. Next, select <em>Rapid IP2</em> or <em>Rapid IP3</em> (depending on which was set up) from the <em>Function</em> section, and click <em>Plot</em>. The X and Y points are shown for the intercept. The X value is input-referred IP2/IP3, and the Y is output-referred IP2/IP3.</p>

<h4>
<a id="pgfId-1294642"></a>Triple Be<a id="marker-1299239"></a>at</h4>

<p>
<a id="pgfId-1294663"></a>Triple Beat is similar to Rapid IP3, except three inputs are allowed. This is provided for the case where there are two small-signal tones closely spaced in frequency from the transmitter that leak in to the receiver along with a small-signal intended RF input signal. In this case, a third order product is produced at the transmitter tone spacing frequency away from the RF input frequency. Note that triple beat is a small-signal analysis. The amplitude of all the tones must be in the small-signal region, or the result will be incorrect.</p>

<h4>
<a id="pgfId-1070075"></a>Compression and IP2 distortion summary</h4>

<p>
<a id="pgfId-1070076"></a>The distortion summaries measure distortion in an amplifier in AC or in circuits that have frequency translation in hbac. The idea is to find which devices in a signal path contribute relatively more or less to t<a id="marker-1299244"></a>he distortion. Since IP3 and compression are related mathematically, the compression distortion summary provides information about which devices contribute the most amount of third order intermodulation distortion. The IP2 distortion summary measures which devices contribute to the second order distortion. Note that when you are using the distortion summaries in the AC analysis, either a SpectreRF license is required, or an additional mmsim token is required to run the analysis.</p>
<p>
<a id="pgfId-1070077"></a>Both distortion summaries use the <em>PAC Magnitude</em> property in the input port. Make sure that the PAC Magnitude (in volts or dBm) is actually in the small-signal range, or the results will not be accurate. This is because the hbac results do not take into account the large-signal limits like slew-rate or power supply voltage.</p>
<p>
<a id="pgfId-1070078"></a>The distortion summaries provide a list output, not a plot output. Accordingly, instead of selecting <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>, select <em>Results</em> - <em>Print</em> - <em>HBAC Distortion Summary</em>.</p>
<p>
<a id="pgfId-1070079"></a>For the compression distortion, you get the actual gain with the distortion of each device by itself divided by the ideal small-signal gain provided by the hbac analysis. In addition, the amplitude of the first three harmonics of the linear output frequency is calculated.</p>
<p>
<a id="pgfId-1070080"></a>For the IM2 distortion summary, you get the total IM2 output amplitude, and the amplitude that results from having only a single device in the circuit.</p>

<h4>
<a id="pgfId-1070013"></a>Sam<a id="marker-1299249"></a><a id="marker-1299333"></a>pled </h4>

<p>
<a id="pgfId-1244004"></a>Sampled is provided in order to calculate the instantaneous conversion gain at a voltage threshold crossing in the ifft or at specific timepoints in the ifft. This is useful for measuring the conversion gain from the power supply to the oscillator output at a threshold crossing, or at specific times in the LO waveform to the output of a mixer. </p>

<h2>
<a id="pgfId-1066550"></a>ADE Explorer Implementation</h2>
<h3>
<a id="pgfId-1092754"></a>Circuit, Input port Setting, and ADE Explorer Setup for all the Examples in This Section</h3>

<p>
<a id="pgfId-1092755"></a>Consider the following circuit:</p>

<p>
<a id="pgfId-1092759"></a></p>
<div class="webflare-div-image">
<img width="577" height="558" src="images/Chap3-247.gif" /></div>

<p>
<a id="pgfId-1070206"></a>This above circuit is an LNA and a mixer for a 2.4GHz application that is implemented in CMOS. The input source (a port in Cadence terminology) has the values for its frequency and amplitude set to variable names. The PAC magnitude property is set to 1 volt in order to allow easy conversion gain measurements. The reason for the variables is that the frequency and amplitude can be changed in the ADE Explorer environment without changing the schematic. </p>
<p>
<a id="pgfId-1070225"></a>The <em>Edit Object Properties</em> form for the input port is shown below.</p>

<p>
<a id="pgfId-1070232"></a></p>
<div class="webflare-div-image">
<img width="668" height="792" src="images/Chap3-248.gif" /></div>

<p>
<a id="pgfId-1070254"></a>ADE Explorer has the variables set to appropriate values, as shown below.</p>

<p>
<a id="pgfId-1070268"></a></p>
<div class="webflare-div-image">
<img width="668" height="543" src="images/Chap3-249.gif" /></div>

<p>
<a id="pgfId-1070290"></a>Note that the variables <em>fb1</em> and <em>fb2</em> (which set the input frequency of the input port) are set to zero, which effectively disables the RF input. Only the LO signal is applied to the circuit.</p>

<h3>
<a id="pgfId-1070136"></a>Using hbAC Analysis for Co<a id="marker-1299364"></a>nversion Gain Measurement</h3>

<p>
<a id="pgfId-1066551"></a>Set up the hb analysis with just the large signal that causes the frequency translation to occur. For more information, see the harmonic balance section.</p>

<p>
<a id="pgfId-1066555"></a></p>
<div class="webflare-div-image">
<img width="637" height="743" src="images/Chap3-250.gif" /></div>

<p>
<a id="pgfId-1066556"></a>Set up the hbac Choosing Analyses form as follows:</p>

<p>
<a id="pgfId-1066560"></a></p>
<div class="webflare-div-image">
<img width="637" height="703" src="images/Chap3-251.gif" /></div>

<ol><li>
<a id="pgfId-1066561"></a>Specify the input frequency range.</li><li>
<a id="pgfId-1066562"></a>For hbac, or pac where pss is set to the Harmonic Balance engine, the <em>Maximum Sideband</em> field should be left blank in which case, all the mixing products are calculated for all the harmonics in the hb analysis.</li><li>
<a id="pgfId-1250027"></a>For a normal conversion gain measurement, set the <em>Specialized Analysis</em> field to <em>None</em>.<br />
<a id="pgfId-1194496"></a>For a conversion gain measurement, set the PAC magnitude to 1 volt on the <em>Edit Object Properties</em> form for the RF input port as shown earlier. This is always volts peak. <br />
<a id="pgfId-1259062"></a><div class="webflare-div-image">
<img width="471" height="727" src="images/Chap3-252.gif" /></div></li><li>
<a id="pgfId-1066569"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.<br />
<a id="pgfId-1066570"></a>The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1066574"></a><div class="webflare-div-image">
<img width="637" height="542" src="images/Chap3-253.gif" /></div>
<a id="pgfId-1066576"></a>The harmonic balance analysis characterizes the nonlinearity of the system as a series of harmonics. Hbac injects an input frequency, and because the system nonlinearity has been characterized by the harmonic balance simulation, the input tone mixes with the harmonics of the LO to produce outputs at multiple frequencies. These mixing products are calculated for mixing the hbAC input frequency range with the hb harmonics. Because the amplitude of the RF input signal is assumed to be small, the harmonics of the hbac input and harmonics of the output mixing products are not calculated. <br />
<a id="pgfId-1349764"></a>To measure the outputs you desire, place a marker at the desired output frequency of interest and read the conversion gain, as shown below.<br />
<a id="pgfId-1349765"></a>The low frequency conversion gain is just over 19dB.<br />
<a id="pgfId-1349772"></a><div class="webflare-div-image">
<img width="637" height="456" src="images/Chap3-254.gif" /></div></li></ol>




















<p>
<a id="pgfId-1070381"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1092805"></a>To plot just the desired output mixing product, select <em>sideband</em> instead of <em>spectrum</em>, and select the desired output mixing product form the list, as shown below.<br />
<a id="pgfId-1070442"></a><div class="webflare-div-image">
<img width="668" height="679" src="images/Chap3-255.gif" /></div></li><li>
<a id="pgfId-1070519"></a>Now select the output node, or click the <em>Replot</em> button in the <em>Direct Plot Form</em>. The waveform tool displays the output, as shown below.<br />
<a id="pgfId-1070521"></a><div class="webflare-div-image">
<img width="668" height="456" src="images/Chap3-256.gif" /></div></li><li>
<a id="pgfId-1070522"></a>Position a marker by moving the cursor to the desired output frequency and type <em>m</em>. The marker appears, as shown in the figure above.</li><li>
<a id="pgfId-1070559"></a>To position the marker at an exact frequency, place it as above, and then move your cursor over the intercept point on the trace. Click and hold the right mouse button, move to <em>Marker Properties</em>, and release the mouse button. The <em>Point Marker Properties</em> window appears, as shown below.<br />
<a id="pgfId-1070595"></a><div class="webflare-div-image">
<img width="668" height="515" src="images/Chap3-257.gif" /></div></li><li>
<a id="pgfId-1070585"></a>Type the frequency in the <em>Position</em> field, and click <em>OK</em> or <em>Apply</em>.</li></ol>

















<h3>
<a id="pgfId-1070646"></a>Commonly Used HB<a id="hbac_options"></a>AC Opt<a id="marker-1299430"></a>ions</h3>
<p>
<a id="pgfId-1070660"></a></p>
<div class="webflare-div-image">
<img width="668" height="597" src="images/Chap3-258.gif" /></div>
<h4>
<a id="pgfId-1104227"></a>Freq<a id="marker-1299443"></a>axis</h4>
<p>
<a id="pgfId-1104231"></a></p>
<div class="webflare-div-image">
<img width="668" height="597" src="images/Chap3-259.gif" /></div>

<p>
<a id="pgfId-1104232"></a><em>freqaxis</em> specifies whether you want to see the negative frequency axis or not.</p>
<p>
<a id="pgfId-1104233"></a>The analysis calculates the output frequencies and amplitudes, so <em>out</em> and <em>absout</em> are reasonable choices. <em>out</em> displays the negative frequency axis. <em>absout</em> (absolute value of the output) displays positive output frequencies. This is the default. Below is the default of absout.</p>

<p>
<a id="pgfId-1259349"></a></p>
<div class="webflare-div-image">
<img width="654" height="467" src="images/Chap3-260.gif" /></div>

<p>
<a id="pgfId-1104662"></a>Next is the output with freqaxis set to out. This is the same data as the above plot except the negative output frequencies have not been reflected up to the positive frequencies.</p>

<p>
<a id="pgfId-1259417"></a></p>
<div class="webflare-div-image">
<img width="633" height="361" src="images/Chap3-261.gif" /></div>

<p>
<a id="pgfId-1104234"></a>If you select <em>in</em>, all the outputs at the different frequencies are plotted on the same input frequency range scale. This is not recommended. The default is <em>absout</em>.</p>

<h4>
<a id="pgfId-1104245"></a>Tolera<a id="marker-1299481"></a>nce</h4>

<p>
<a id="pgfId-1104246"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1104815"></a>Hbac uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough, and the tolerance option specifies that accuracy for hbac. For driven circuits, the default is 1e-6. For oscillators, the default is 1e-4.</p>

<h4>
<a id="pgfId-1104266"></a>Resgm<a id="marker-1299491"></a>rescycle</h4>

<p>
<a id="pgfId-1104267"></a>Leave this option at the default.</p>

<h4>
<a id="pgfId-1104832"></a>Hbprecon<a id="marker-1299496"></a>d_solver</h4>

<p>
<a id="pgfId-1104846"></a>This option has two settings; basicsolver and autoset. Basicsolver is the only solver available in standard Spectre. Autoset is the default solver when APS is used. This solver is faster. If stagnation is detected, Spectre prints a message in the Spectre output window.</p>

<h4>
<a id="pgfId-1104268"></a>Anno<a id="marker-1299501"></a>tate</h4>

<p>
<a id="pgfId-1104269"></a>This option controls the amount of output in the spectre output window. Selecting title produces the least amount of detail, and selecting steps gives the most amount of detail. The default is status.</p>

<h4>
<a id="pgfId-1104922"></a>Sa<a id="marker-1299506"></a>ve</h4>

<p>
<a id="pgfId-1104923"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved. In ADE Explorer, this is accomplished using the <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Design</em> and then selecting the nodes and terminals specifically in the schematic. At the netlist level, this is accomplished by using a save statement with a list of names to be saved.</p>

<h4>
<a id="pgfId-1104924"></a>Nes<a id="marker-1299515"></a>tlvl</h4>

<p>
<a id="pgfId-1104925"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this option controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> can be any integer. The example below shows <em>lvlpub</em> selected that saves two levels of hierarchy.</p>

<p>
<a id="pgfId-1104929"></a></p>
<div class="webflare-div-image">
<img width="668" height="74" src="images/Chap3-262.gif" /></div>
<h4>
<a id="pgfId-1104270"></a>AdditionalParams</h4>

<p>
<a id="pgfId-1259485"></a><em>additionalParams</em> is typically used for new features that are being beta tested early in the release cycle where there is not a gui selection available yet.</p>

<h3>
<a id="pgfId-1259487"></a>hbAC With Multi<a id="marker-1299538"></a>ple hb Inputs</h3>

<p>
<a id="pgfId-1250112"></a>Harmonic balance is available in the hb form and the pss and qpss forms when harmonic balance is selected for the engine. Hbac is available in the hbac form and in the pac and qpac forms when the engine is set to harmonic balance in pss and qpss. In the example below, hb and hbac were used. The LO is set to 2.4GHz as before. To set up the second (RF) input for the harmonic balance analysis, the variable <code>fb1</code> was set to <code>2.5G</code> in the ADE Explorer window, as shown below. This variable sets the frequency of the first source in the RF port component. In this case, the LO is at 2.4GHz and the RF is at 2.5GHz.</p>

<p>
<a id="pgfId-1070826"></a></p>
<div class="webflare-div-image">
<img width="668" height="568" src="images/Chap3-263.gif" /></div>

<p>
<a id="pgfId-1070880"></a>The harmonic balance analysis was set up to calculate the LO harmonics automatically, and three RF harmonics. For more information on Harmonic balance, please see the Harmonic Balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1070910"></a></p>
<div class="webflare-div-image">
<img width="668" height="727" src="images/Chap3-264.gif" /></div>

<p>
<a id="pgfId-1070928"></a>The hbac form is set up exactly the same as the hbac form was for the first example in the ADE Explorer implementation section.</p>

<p>
<a id="pgfId-1070947"></a></p>
<div class="webflare-div-image">
<img width="668" height="702" src="images/Chap3-265.gif" /></div>

<p>
<a id="pgfId-1070969"></a>Now the analysis was run. The harmonic balance output plot below shows that because there were more input frequencies, many more harmonics are produced by the circuit, which is as expected.</p>

<p>
<a id="pgfId-1070999"></a></p>
<div class="webflare-div-image">
<img width="664" height="443" src="images/Chap3-266.gif" /></div>

<p>
<a id="pgfId-1071021"></a>Because there are many more harmonics to mix with, many more mixing products are produced by hbac, as shown below.</p>

<p>
<a id="pgfId-1071040"></a></p>
<div class="webflare-div-image">
<img width="668" height="488" src="images/Chap3-267.gif" /></div>

<p>
<a id="pgfId-1071070"></a>The mixing products below -200dB are at the numerical noise floor of the simulation.</p>
<p>
<a id="pgfId-1071072"></a>The next figure shows a zoomed in area near zero frequency. Only the mixing products larger than -25 dB are shown.</p>

<p>
<a id="pgfId-1071062"></a></p>
<div class="webflare-div-image">
<img width="668" height="476" src="images/Chap3-268.gif" /></div>

<p>
<a id="pgfId-1350377"></a>If the output frequency were 6GHz, note that there are three different values. Which one is correct? Actually, they all are. They are produced by mixing with different harmonics from the large-signal analysis.</p>
<p>
<a id="pgfId-1071113"></a>To identify which harmonics are being mixed with, select the top trace. On the left side of the display an entry is highlighted. The example below shows the top trace selected. (It is bold. It is difficult to see in the figure below, but in the waveform tool it is much easier.)</p>

<p>
<a id="pgfId-1071131"></a></p>
<div class="webflare-div-image">
<img width="668" height="474" src="images/Chap3-269.gif" /></div>

<p>
<a id="pgfId-1350410"></a>On the right side of the legend, it reads (-1 0) The first number is the harmonic number of the tone with tstab set, or is listed as <em>Tone1</em> in the hb <em>Choosing Analyses</em> form. This is LO in this example. The second number is the RF input.</p>
<p>
<a id="pgfId-1071167"></a>-1 0 means that the input frequency is mixed down with the first harmonic of the LO, and not mixed with the RF. The input frequency range in the hbac (qpac) <em>Choosing Analyses</em> form is 2.40001G to 2.8G. If you take 2.40001G as a second small-signal input (that is what hbac does) and mix it down with the first harmonic of the LO at 2.4G, you get very near zero. When you mix 2.8G down with 2.4G, you get 400M. So this component starts at near zero, and sweeps up to 400M as the input sweeps from 2.40001G to 2.8G.</p>
<p>
<a id="pgfId-1071169"></a>Now select the second trace down, as shown below.</p>

<p>
<a id="pgfId-1071157"></a></p>
<div class="webflare-div-image">
<img width="666" height="393" src="images/Chap3-270.gif" /></div>

<p>
<a id="pgfId-1350469"></a>The legend reads 1 -2.</p>
<p>
<a id="pgfId-1071210"></a>2.40001G mixes up with the first harmonic of the LO, and then mixes down with the second harmonic of the RF. So, 2.40001G + 2.4G - 2*2.5G is very near -200M. As the input sweeps up in frequency, the output becomes less negative, passes through zero, and then sweeps up to +200M. Because the negative frequencies are reflected to the positive frequency domain, the resultant response looks like a less than sign (&lt;) in the above plot.</p>
<p>
<a id="pgfId-1071253"></a>Note that the ambiguity goes away when the frequency sweep on the input source is restricted to a smaller range.</p>

<p>
<a id="pgfId-1071243"></a></p>
<div class="webflare-div-image">
<img width="668" height="695" src="images/Chap3-271.gif" /></div>
<p>
<a id="pgfId-1071282"></a></p>
<div class="webflare-div-image">
<img width="668" height="399" src="images/Chap3-272.gif" /></div>
<h3>
<a id="pgfId-1351055"></a>Rapid IP3/IP2</h3>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1351059"></a>The first discussion is about Rapi<a id="marker-1351057"></a>d IP<a id="marker-1351058"></a>3.</div>
<p>
<a id="pgfId-1096164"></a>Rapid IP3 and Rapi<a id="marker-1299658"></a>d IP<a id="marker-1301456"></a>2 are available in the AC and the hbac <em>Choosing Analyses</em> forms. Rapid IP3 in the AC form is for measuring IP3 of amplifiers where there is no frequency translation, and Rapid IP3 in the hbac form allows the measurement of IP3 where frequency translations are present. Rapid IP3 and IP2 measure small-signal IP3 and IP2.</p>
<ol><li>
<a id="pgfId-1071343"></a>First set up the hb form with just the LO applied, as shown below. For more information, see the harmonic balance section.<br />
<a id="pgfId-1071371"></a><div class="webflare-div-image">
<img width="668" height="746" src="images/Chap3-273.gif" /></div></li><li>
<a id="pgfId-1071378"></a>Select the hbac analysis. At the bottom of the form, in the <em>Specialized Analysis</em> section, select <em>Rapid IP3</em> or <em>Rapid IP2</em>, depending on what you want to measure. The entries for the forms are identical, except for the frequency of the intermodulation product. For switched FET mixers, make sure that the psp model is used. Incorrect results will be produced for BSIM3 and BSIM4 models due to a limitation in these models.</li><li>
<a id="pgfId-1071411"></a>Define the input port, input frequencies, input power, the frequencies of the linear and second or third order products, and the output node. An example setup for Rapid IP3 is shown below. Make sure the input power is in the small-signal range for your circuit.<br />
<a id="pgfId-1071461"></a><div class="webflare-div-image">
<img width="668" height="758" src="images/Chap3-274.gif" /></div></li><li>
<a id="pgfId-1071432"></a>Leave the <em>Maximum Non-linear Harmonics</em> field blank.</li><li>
<a id="pgfId-1092932"></a>Run the simulation. When the simulation is complete, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. <br />
<a id="pgfId-1071508"></a><div class="webflare-div-image">
<img width="668" height="432" src="images/Chap3-275.gif" /></div></li><li>
<a id="pgfId-1092973"></a>Select <em>hbac</em> results.</li><li>
<a id="pgfId-1093004"></a>Select <em>Rapid IP3</em> or <em>RapidIP2</em>, whichever was run. </li><li>
<a id="pgfId-1093012"></a>Click <em>Plot</em>. </li></ol>



















<p>
<a id="pgfId-1071515"></a>The waveform is displayed. The marker shown at the intercept point shows the input and output-referred IP3 or IP2.</p>

<p>
<a id="pgfId-1071578"></a></p>
<div class="webflare-div-image">
<img width="668" height="548" src="images/Chap3-276.gif" /></div>
<h3>
<a id="pgfId-1070523"></a>Tripl<a id="marker-1299676"></a>e B<a id="triplebeat"></a>eat</h3>

<p>
<a id="pgfId-1294947"></a>Triple beat is similar to Rapid IP3 and IP2 except it allows three inputs instead of two. Currently, it is available only in the hbac <em>Choosing Analyses</em> form. This capability is provided for the case where two small-signal closely spaced inputs from a transmitter leak into a receiver along with the standard RF input to the receiver. The use model is similar to Rapid IP3. Apply the LO signal in hb, and then use hbac triple beat to simulate the three inputs to the receiver. This is a small-signal analysis. If the input levels for all three tones are not in the small-signal range, the result will be incorrect because hbac ignores large signal effects.</p>
<ol><li>
<a id="pgfId-1294973"></a>To run triple beat, first set up the hb <em>Choosing Analyses</em> form with just the LO signal applied.<br />
<a id="pgfId-1296542"></a><div class="webflare-div-image">
<img width="403" height="782" src="images/Chap3-277.gif" /></div></li><li>
<a id="pgfId-1294974"></a>Set up the hbac form with the RF signal and the two leakage signals. In this example, the RF signal is at 2.405G, and the other two signals are 1MHz apart. With the LO at 2.4GHz, this gives an intended baseband output at 5M, and triple beat products at the transmitter spacing (1MHz) above and below the 5MHz output.<br />
<a id="pgfId-1296611"></a><div class="webflare-div-image">
<img width="574" height="723" src="images/Chap3-278.gif" /></div></li><li>
<a id="pgfId-1294961"></a>Run the simulation,</li><li>
<a id="pgfId-1296633"></a>Choose <em>Results</em> - <em>Direct Plot</em> - <em>Main Form </em>to open the<em> Direct Plot Form</em>.</li><li>
<a id="pgfId-1294968"></a>Select <em>hbac</em> from the <em>Analysis</em> section. </li><li>
<a id="pgfId-1296684"></a>Select <em>Triple Beat</em> from the <em>Function</em> section. </li><li>
<a id="pgfId-1296706"></a>If desired, select <em>Add To Outputs</em>. This will add an expression under the <em>Maestro</em> tab of the ADE Explorer window.<br />
<a id="pgfId-1296716"></a><div class="webflare-div-image">
<img width="462" height="364" src="images/Chap3-279.gif" /></div>
<a id="pgfId-1295099"></a>The waveform tool plots the linear ratio of IM<a id="marker-1301489"></a>3 divided by IM<a id="marker-1301498"></a>1 with the X axis values from 1 to 10. This function is more useful in the ADE Explorer window itself.<br />
<a id="pgfId-1296738"></a><div class="webflare-div-image">
<img width="661" height="443" src="images/Chap3-280.gif" /></div></li><li>
<a id="pgfId-1295138"></a>In ADE Explorer, click the <em>Plot Outputs</em> icon. The expression updates with the linear ratio of IM1 divided by IM3<br />
<a id="pgfId-1296770"></a>.<div class="webflare-div-image">
<img width="662" height="409" src="images/Chap3-281.gif" /></div></li><li>
<a id="pgfId-1351295"></a>To convert the output to dB, double-click the expression in the area highlighted by the blue box above and click the Open Calculator button (shown with three dots).</li><li>
<a id="pgfId-1351300"></a>The calculator opens with the expression in the buffer.<br />
<a id="pgfId-1296891"></a><div class="webflare-div-image">
<img width="565" height="644" src="images/Chap3-282.gif" /></div></li><li>
<a id="pgfId-1295237"></a>If necessary, select <em>All</em> just below the <em>Function</em> Panel legend. This is highlighted above. Select the <em>dB20</em> function.</li><li>
<a id="pgfId-1351378"></a>The expression changes, as shown below.<br />
<a id="pgfId-1351388"></a><div class="webflare-div-image">
<img width="617" height="642" src="images/Chap3-283.gif" /></div></li><li>
<a id="pgfId-1295263"></a>Click <em>Tools</em> - <em>Send Buffer to ADE Outputs</em>.The expression is added under the Maestro tab of the ADE Explorer window, as shown below.</li><li>
<a id="pgfId-1297005"></a>Double-click the empty cell under the Name column and add a title, such as Triple_beat_dbm.<br />
<a id="pgfId-1364447"></a><div class="webflare-div-image">
<img width="668" height="454" src="images/Chap3-284.gif" /></div></li><li>
<a id="pgfId-1351556"></a>In ADE Explorer, click the <em>Plot Outputs</em> icon. The ratio is now in dB.<br />
<a id="pgfId-1297038"></a><div class="webflare-div-image">
<img width="664" height="476" src="images/Chap3-285.gif" /></div></li><li>
<a id="pgfId-1295368"></a>If the IM1 and IM3 levels are desired, choose <em>Tools</em> - <em>Results Browser</em>.<br />
<a id="pgfId-1297083"></a><div class="webflare-div-image">
<img width="666" height="485" src="images/Chap3-286.gif" /></div>
<a id="pgfId-1295374"></a>The Virtuoso Visualization and Analysis window is displayed.<br />
<a id="pgfId-1297118"></a><div class="webflare-div-image">
<img width="641" height="432" src="images/Chap3-287.gif" /></div></li><li>
<a id="pgfId-1351888"></a>Double-click the <em>hbac_mb</em> results.</li><li>
<a id="pgfId-1351889"></a>Click the right mouse button on <em>IM1 output V(V)=&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>your result_here</em></span><em>&gt;</em> expression and select <em>Calculator</em>. The calculator opens with the expression in the buffer.<br />
<a id="pgfId-1297190"></a><div class="webflare-div-image">
<img width="605" height="639" src="images/Chap3-288.gif" /></div></li><li>
<a id="pgfId-1295426"></a>In the calculator, examine the expression. If there is a slash before <em>IM1</em>, remove it. Refer to the red box above. If desired, add the <em>dB20</em> function.<br />
<a id="pgfId-1297265"></a><div class="webflare-div-image">
<img width="663" height="640" src="images/Chap3-289.gif" /></div></li><li>
<a id="pgfId-1295470"></a>Click <em>Tools</em> - <em>Send buffer to ADE Outputs</em>. </li><li>
<a id="pgfId-1352056"></a>If the level for the IM3 product is desired, follow the previous steps, but send the IM3 expression to the calculator. </li><li>
<a id="pgfId-1352091"></a>Specify a name for the expressions under the <em>Name</em> column of the ADE Explorer window.</li><li>
<a id="pgfId-1352084"></a>When you are done, click the <em>Plot Outputs</em> icon in ADE. The results are displayed in Value column, as shown below.<br />
<a id="pgfId-1297369"></a><div class="webflare-div-image">
<img width="667" height="469" src="images/Chap3-290.gif" /></div></li></ol>















































































<h2>
<a id="pgfId-1295238"></a>Compression Disto<a id="marker-1299823"></a>rtion Summary</h2>

<p>
<a id="pgfId-1071596"></a>Note that the <em>Compression Distortion Summary</em> is available in the AC and the hbac <em>Choosing Analyses</em> forms. <em>Compression Distortion Summary</em> in the AC form is for measuring Compression Distortion of amplifiers where there is no frequency translation, and <em>Compression Distortion Summary</em> in the hbac form allows the measurement of Compression Distortion where frequency translations are present.</p>
<p>
<a id="pgfId-1066595"></a>With the Compression Distortion summary, you can see which components in a frequency translating circuit cause relatively more and less distortion.</p>
<p>
<a id="pgfId-1071619"></a>Note that compression and IP3 are related mathematically, so this analysis gives information about which components contribute more and less to the IP3 measurement as well as which components contribute to compression.</p>
<ol><li>
<a id="pgfId-1066600"></a>First set up the hb analysis with just the LO applied, as shown below. For more information, see the harmonic balance section.<br />
<a id="pgfId-1071642"></a><div class="webflare-div-image">
<img width="668" height="783" src="images/Chap3-291.gif" /></div></li><li>
<a id="pgfId-1066601"></a>Now select the hbac analysis.</li><li>
<a id="pgfId-1071667"></a>Select <em>Compression Distortion Summary</em> from the <em>Specialized Analyses</em> drop-down list.<br />
<a id="pgfId-1071698"></a>The following notice appears to remind you to set the PAC amplitude parameter in the source in the small-signal range.<br />
<a id="pgfId-1071702"></a><div class="webflare-div-image">
<img width="637" height="119" src="images/Chap3-292.gif" /></div></li><li>
<a id="pgfId-1066602"></a>If you leave the <em>Contributor Instances</em> field blank, all the nonlinear devices in your circuit will be run. If you want a subset, click <em>Select</em>, and select the instances that you want on the schematic.</li><li>
<a id="pgfId-1066603"></a>Specify the input frequency in the <em>Frequency of Input Source</em> field.</li><li>
<a id="pgfId-1066604"></a>Specify the output frequency in the <em>Frequency of Linear Output Signal </em>field.</li><li>
<a id="pgfId-1066605"></a>Leave the <em>Maximum Non-Linear Harmonics</em> field blank.</li><li>
<a id="pgfId-1066606"></a>Select the output node in the circuit.<br />
<a id="pgfId-1071732"></a>The completed form should appear similar to the one shown below.<br />
<a id="pgfId-1071739"></a><div class="webflare-div-image">
<img width="668" height="646" src="images/Chap3-293.gif" /></div></li><li>
<a id="pgfId-1066612"></a>In the <em>Edit Object Properties</em> form, make sure that the <em>PAC magnitude (dBm)</em> is set in the small-signal range. In this example, it is set to <code>-30Bm</code>. <br />
<a id="pgfId-1066616"></a><div class="webflare-div-image">
<img width="637" height="202" src="images/Chap3-294.gif" /></div></li><li>
<a id="pgfId-1066617"></a>If you make changes to your schematic that you want for the distortion summary, but you do not want to save them to the circuit file, make the desired changes and then select <em>Check - Current Cellview</em> in the schematic window. Later, if you want to save them, just select <em>Check</em> and <em>Save</em>. If you do not want them, quit the schematic window, and do not save the changes.<br />
<a id="pgfId-1066621"></a><div class="webflare-div-image">
<img width="637" height="555" src="images/Chap3-295.gif" /></div>
<a id="pgfId-1066622"></a>ADE Explorer will netlist from the checked view, so it will get the changes.</li><li>
<a id="pgfId-1066623"></a>When you are done, run the simulation. </li><li>
<a id="pgfId-1066624"></a>When the simulation completes, select <em>Results - Print - hbAC Distortion Summary</em>.<br />
<a id="pgfId-1066625"></a>The summary is displayed below:<br />
<a id="pgfId-1066629"></a><div class="webflare-div-image">
<img width="637" height="228" src="images/Chap3-296.gif" /></div><ul><li>
<a id="pgfId-1066630"></a>The first column is the instance name in the schematic.</li><li>
<a id="pgfId-1066631"></a>The second column is the gain with the signal applied divided by the ideal gain.<br />
<a id="pgfId-1071804"></a>Gain compression is shown as a negative number. Gain expansion is shown as a positive number.</li><li>
<a id="pgfId-1066632"></a>The third, fourth, and fifth columns are the amplitudes of the first, second, and third harmonic of the linear output frequency with just the nonlinearity of that single device taken into account.</li></ul></li></ol>














































<h3>
<a id="pgfId-1071836"></a>IM2 Distorti<a id="marker-1299842"></a>on Summary</h3>

<p>
<a id="pgfId-1071850"></a>The steps for the IM2 distortion summary are very similar to the Compression distortion summary in the previous section. The differences are noted below.</p>
<ul><li>
<a id="pgfId-1071873"></a>The IM2 distortion summary provides the output voltage (magnitude, real, and imaginary parts) of the 2nd order distortion signal for each component in the schematic by itself.</li><li>
<a id="pgfId-1071897"></a>The IM2 distortion summary does not provide a selection mechanism for the devices in the circuit. All the devices are run in the IM2 distortion summary.</li><li>
<a id="pgfId-1071918"></a>The output format is slightly different. The first column is the instance name in the schematic. The second column is the magnitude of the IM2 product that is produced by that single component in volts. The third column has the real and imaginary parts of the voltage. A sample is shown below.<br />
<a id="pgfId-1329538"></a><div class="webflare-div-image">
<img src="images/Chap3E/3rdw.gif" /></div></li></ul>





<h3>
<a id="pgfId-1352888"></a>Modulated hbAC Anal<a id="marker-1352887"></a>ysis for an Oscillator</h3>

<p>
<a id="pgfId-1352890"></a>Modulated hbac analysis is usually applied to oscillators to measure AM to PM conversion from low-frequencies on the power supply (ripple) to the output near the first harmonic. It can also be applied to digital circuits for the same purpose. Although the shape of the transfer function is different, the steps are the same for both applications. Note that a relatively large number of harmonics and an oversample factor of at least 4 is needed for simulating the digital circuit.</p>
<p>
<a id="pgfId-1071999"></a>In the circuit, make sure that any PAC magnitude terms are removed on the input source (if there is one), and set the PAC Magnitude to 1 volt in the source that is used as the power supply. If you do not want to save the change permanently, just select <em>Check</em> - <em>Current View</em> in the schematic.</p>
<p>
<a id="pgfId-1072001"></a>This example is for an oscillator. The circuit is shown below:</p>

<p>
<a id="pgfId-1071989"></a></p>
<div class="webflare-div-image">
<img width="668" height="534" src="images/Chap3-298.gif" /></div>

<p>
<a id="pgfId-1072035"></a>In ADE Explorer, set the values for the power supply voltage and for the tuning voltage.</p>

<p>
<a id="pgfId-1072058"></a></p>
<div class="webflare-div-image">
<img width="668" height="564" src="images/Chap3-299.gif" /></div>

<p>
<a id="pgfId-1072110"></a>Set up the harmonic balance analysis For more information, see the Harmonic Balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1329526"></a></p>
<div class="webflare-div-image">
<img width="668" height="783" src="images/Chap3-300.gif" /></div>

<p>
<a id="pgfId-1329527"></a>In the hbac <em>Choosing Analyses</em> form, first select <em>Modulated</em> in the <em>Specialized Analyses</em> section, as shown below.</p>

<p>
<a id="pgfId-1072165"></a></p>
<div class="webflare-div-image">
<img width="668" height="718" src="images/Chap3-301.gif" /></div>

<p>
<a id="pgfId-1072195"></a>Note that this causes the <em>Sweep Type </em>to be set to <em>relative</em>. Since the gain from power supply ripple to the output is desired, the relative harmonic number is zero, and then the desired frequency range is entered. <em>Maximum sideband</em> can be left blank, or it can match the hb harmonics, as shown above.</p>
<p>
<a id="pgfId-1314179"></a>Set the <em>Input type</em> to <em>SSB/AM/PM</em>.</p>
<p>
<a id="pgfId-1072197"></a>Next, the output harmonics can be set. Note that a list of harmonics can be entered. The easiest way is to click the <em>Choose</em> button to the right of the field and select the desired frequencies from a list in the <em>Choose Harmonic</em> window, as shown below.</p>

<p>
<a id="pgfId-1072183"></a></p>
<div class="webflare-div-image">
<img width="668" height="274" src="images/Chap3-302.gif" /></div>

<p>
<a id="pgfId-1072222"></a>The same process is used to set the input frequency, but only one frequency range is allowed.</p>

<p>
<a id="pgfId-1072252"></a></p>
<div class="webflare-div-image">
<img width="668" height="280" src="images/Chap3-303.gif" /></div>

<p>
<a id="pgfId-1072286"></a>Once the analysis has been set up, run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. </p>
<p>
<a id="pgfId-1072308"></a>In the Direct Plot form select <em>SSB</em> for <em>Input</em>. Select <em>PM</em> for <em>Output</em>. Since many output frequencies were calculated, you need to select the one you want to plot. In this example, the output just above the first harmonic is selected. Once this is done, select a net in the schematic.</p>

<p>
<a id="pgfId-1072278"></a></p>
<div class="webflare-div-image">
<img width="668" height="667" src="images/Chap3-304.gif" /></div>

<p>
<a id="pgfId-1072345"></a>The output is displayed. To make a measurement at a specific frequency, position a marker. The measurement is in radians per volt of input on the supply that has PAC magnitude set.</p>

<p>
<a id="pgfId-1072364"></a></p>
<div class="webflare-div-image">
<img width="668" height="482" src="images/Chap3-305.gif" /></div>
<h3>
<a id="pgfId-1098380"></a>Sampled hbAC Ana<a id="marker-1299892"></a>lysis for a Mixer</h3>

<p>
<a id="pgfId-1098405"></a>hbAC sampled is for measuring the conversion gain at a specific instantaneous time in the ifft waveform. The first step is to determine an appropriate threshold for the measurement by setting up the hb analysis, as shown below.</p>

<p>
<a id="pgfId-1098424"></a></p>
<div class="webflare-div-image">
<img width="668" height="723" src="images/Chap3-306.gif" /></div>

<p>
<a id="pgfId-1098456"></a>Now run the analysis. When the analysis completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer and plot the time-domain waveform, as shown below.</p>

<p>
<a id="pgfId-1098511"></a></p>
<div class="webflare-div-image">
<img width="668" height="607" src="images/Chap3-307.gif" /></div>

<p>
<a id="pgfId-1098532"></a>The waveform is shown below.</p>

<p>
<a id="pgfId-1098555"></a></p>
<div class="webflare-div-image">
<img width="668" height="523" src="images/Chap3-308.gif" /></div>

<p>
<a id="pgfId-1098585"></a>Note that 2.5 volts is a good threshold voltage.</p>
<p>
<a id="pgfId-1098612"></a>Now set up the hbac <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1098634"></a></p>

<div class="webflare-div-image">
<img width="668" height="815" src="images/Chap3-309.gif" /></div>

<p>
<a id="pgfId-1098661"></a>At the top of the form, set up the input frequency range like normal.</p>
<ol><li>
<a id="pgfId-1098663"></a>At the bottom of the form, select <em>Sampled</em>. Usually the gain to a node is desired, therefore, select <em>voltage</em>.</li><li>
<a id="pgfId-1098665"></a>Click <em>Select</em> located to the right of the <em>Net+</em> field and select the node in the schematic.</li><li>
<a id="pgfId-1098667"></a>Specify the desired threshold voltage based on the ifft from the hb analysis</li><li>
<a id="pgfId-1098668"></a>Choose an option from the <em>Crossing Direction</em> drop-down list. In the example, <em>all</em> is selected.</li><li>
<a id="pgfId-1098670"></a>If you need more than 16 crossing points, type the number you need in the <em>Maximum Samples</em> field.</li><li>
<a id="pgfId-1098672"></a>If you want to sample at specific times from the ifft waveform, you can type in the times in the <em>Additional Timepoints</em> field.</li><li>
<a id="pgfId-1098674"></a>Now run the simulation. When the simulation completes, open the <em>Direct Plot Form</em> and set it up, as shown below.<br /><ffi2-fig-frame-in-2 id="#id1098653">
<a id="pgfId-1098653"></a></ffi2-fig-frame-in-2><div class="webflare-div-image">
<img width="668" height="713" src="images/Chap3-310.gif" /></div></li><li>
<a id="pgfId-1098795"></a>Select <em>hbac</em> results.</li><li>
<a id="pgfId-1098796"></a>Select <em>Voltage</em>.</li><li>
<a id="pgfId-1098797"></a>Select <em>spectrum</em>.</li><li>
<a id="pgfId-1098798"></a>Select <em>dB20</em>.</li><li>
<a id="pgfId-1098799"></a>Select the time you want from the <em>Variable Value (eventtime)</em> list.</li><li>
<a id="pgfId-1098800"></a>Select the output node in the schematic.</li></ol>
















<p>
<a id="pgfId-1098783"></a>The waveform is plotted, as shown below.</p>

<p>
<a id="pgfId-1098837"></a></p>
<div class="webflare-div-image">
<img width="668" height="427" src="images/Chap3-311.gif" /></div>

<p>
<a id="pgfId-1098855"></a>Because the sweep was log spaced, the X Axis of the waveform tool is set to log. To zoom in to the frequency of interest, double-click one of the numbers on the X Axis, and type in the output frequency range of interest. This is shown below.</p>
<p>
<a id="pgfId-1100442"></a>To measure the conversion gain to the output, move the tracking cursor to the output frequency and read the gain.</p>

<p>
<a id="pgfId-1098874"></a></p>
<div class="webflare-div-image">
<img width="668" height="458" src="images/Chap3-312.gif" /></div>
<h2>
<a id="pgfId-1072112"></a><a id="24789"></a>Harmonic Balance N<a id="hbnoise"></a>oise Analysis (hbn<a id="marker-1299927"></a>oise)</h2>
<h3>
<a id="pgfId-1066644"></a>Small-Signal Versus Large-Signal Analysis for Noise</h3>

<p>
<a id="pgfId-1079673"></a>In most cases, noise is a small-signal problem in the real world. Consider an amplifier. One approach is to calculate the small-signal gain from the noise sources to the output, then calculate the frequency response of the noise source, and then add up the noise power at the output. This is done in the linear noise analysis. This runs quickly because the gain calculation just takes the tangent at the DC operating point for everything in the circuit. This ignores large-signal effects like slew-rate limits and clipping. Because noise in most circuits is actually very small compared to the output levels, this approach works well. Because it is a linear approach, frequency translations cannot be calculated.</p>
<p>
<a id="pgfId-1079674"></a>When the input to the amplifier gets large enough that it starts to create nonlinearity, the frequency translations in the circuit need to be taken into account. Noise near the harmonics can mix up or down to the output frequency. In this case, the large signal needs to be applied in a large-signal analysis like harmonic balance (hb) where the nonlinearity and harmonic levels can be calculated. After the hb runs, hbnoise runs and is similar to linear noise except the frequency translations of the circuit are taken into account. Instead of calculating a single gain from the noise source to the output, both the amplitude of the noise and the gain for the noise sources at the significant harmonics needs to be calculated, and each noise source now has several contributions at the output from several different noise frequencies. The basic strategy is to apply the signals that cause nonlinearity in the hb analysis, and follow that with an hbnoise calculation.</p>
<p>
<a id="pgfId-1079675"></a>This same approach can be taken for mixers where the LO signal deliberately introduces nonlinearity for the purpose of frequency translation. The LO signal is applied to the mixer in the hb analysis, and hbnoise follows that.</p>
<p>
<a id="pgfId-1079676"></a>This works with the mixer by itself, or in combination with other circuits, like an LNA, mixer, and a baseband amplifier.</p>
<p>
<a id="pgfId-1079689"></a>Many designs need to tolerate a large amplitude blocking signal. Apply the LO and the blocking signal (and not the RF signal) in the hb analysis and follow with hbnoise. The blocker power can be swept in the hb analysis and hbnoise run after each sweep value for the blocker power to measure the desensitization.</p>
<p>
<a id="pgfId-1309071"></a>For large-signal noise problems, or for systems that are not periodic, transient noise is provided. For more information on this, refer to the <em>Spectre Classic Simulator, Spectre APS, Spectre X, and Spectre XPS</em>. This approach requires specifying a maximum noise frequency to be analyzed, which in RF systems is usually quite high. Two timepoints are created in the period of noisefmax. The transient needs to be run over many noise points in order to characterize the noise present in the circuit and needs post-processing to see the results in the frequency domain. This usually requires much more time than using small-signal noise analyses.</p>

<h3>
<a id="pgfId-1079665"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1079729"></a>The fundamental quantity calculated in hbnoise is the output noise of the circuit with a large signal applied and including the noise translations caused by the nonlinearity of the circuit. In order to run hbnoise, a harmonic balance (hb) analysis needs to be run first in order to calculate the nonlinearity of the circuit and the amplitude of the harmonics that are present to mix with. Hbnoise takes this information from the hb analysis and then for each noise source it calculates the transfer functions from all the frequencies specified in the <em>Choosing Analyses</em> form. Then it calculates the frequency response of the noise source itself. Next, it calculates the total noise power at the output for that source at all the noise frequencies that contribute at the output. At the end, it adds up all the noise power from all the sources at all the frequencies. Input-referred calculations require the selection of the input frequency range by setting the reference sideband. This selection is necessary because there are many transfer functions from the input to the output caused by mixing or aliasing from the different harmonics of the system. The passband frequency is needed for the noise figure calculations.</p>
<p>
<a id="pgfId-1079730"></a>Note that hbnoise is a small-signal calculation that works for periodic systems. If the noise is large-signal, or the system is not periodic, transient noise should be used.</p>

<h3>
<a id="pgfId-1079721"></a>Example</h3>

<p>
<a id="pgfId-1079745"></a>Consider the double-balanced diode mixer below where a single-sideband noise figure measurement is desired.</p>

<p>
<a id="pgfId-1079764"></a></p>
<div class="webflare-div-image">
<img width="668" height="649" src="images/Chap3-313.gif" /></div>

<p>
<a id="pgfId-1079782"></a>The input source has variables set to define the frequency and amplitude of the two large-signal outputs. This is done so that the frequency and the amplitude can be set in the ADE Explorer window without changing the schematic. </p>
<p>
<a id="pgfId-1079810"></a>The property list for the input port is shown below.</p>

<p>
<a id="pgfId-1079801"></a></p>
<div class="webflare-div-image">
<img width="668" height="784" src="images/Chap3-314.gif" /></div>

<p>
<a id="pgfId-1079828"></a>The variables have values set in the Design variables section. The easiest way to get the variables list is to generate a netlist from ADE Explorer or use <em>Variables</em> - <em>Copy From CellView</em>. This will cause all the variable names to be entered in the variables section. Just click in the value field for each variable and enter a value. Press <em>Enter</em> when you are done. In the figure below, the LO frequency set by the variable flo is 1GHz. The variable <code>vrf</code> which sets the linear amplitude of the large-signal RF inputs is zero. This disables the large-signal waveform. This circuit just has the signal that causes the frequency translations to occur (the LO signal) applied. Note that 1.4 volts peak is +13 dBm, which is a common drive level for a passive diode mixer.</p>

<p>
<a id="pgfId-1079853"></a></p>
<div class="webflare-div-image">
<img width="668" height="527" src="images/Chap3-315.gif" /></div>

<p>
<a id="pgfId-1079886"></a>The hb analysis needs to be run first in order to measure the amplitude of the harmonics and to characterize the nonlinearity of the system. From this, the noise folding from all the noise sources can be calculated in the hbnoise analysis. For more information on the setup of the hb form, please refer to the hb large-signal analysis section.</p>
<p>
<a id="pgfId-1079887"></a>In the form below, the 1GHz LO is solved using automatic harmonics.</p>

<p>
<a id="pgfId-1079878"></a></p>
<div class="webflare-div-image">
<img width="668" height="713" src="images/Chap3-316.gif" /></div>

<p>
<a id="pgfId-1079930"></a>The noise output frequency and the number of noise translations to be calculated are set up in the hbnoise form. In the example below, the output frequency is near baseband. Leaving the <em>Maximum sideband </em>field blank causes noise translations from all the harmonics in the hb analysis to be calculated.</p>
<p>
<a id="pgfId-1079931"></a>The reference sideband selects the passband frequency for the noise figure calculation.</p>

<p>
<a id="pgfId-1079921"></a></p>
<div class="webflare-div-image">
<img width="668" height="740" src="images/Chap3-317.gif" /></div>

<p>
<a id="pgfId-1079969"></a>Once both forms are set up, the simulation is run. To plot outputs, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The top of the form lists all the analyses that were run. Select <em>hbnoise</em> where the noise figure is calculated. Next, select <em>NF</em> because that is what is desired to plot. If the noise figure over a bandwidth is desired, select <em>Integrated Over Bandwidth</em>, and specify the frequency range you desire for the measurement.</p>

<p>
<a id="pgfId-1079962"></a></p>
<div class="webflare-div-image">
<img width="668" height="570" src="images/Chap3-318.gif" /></div>

<p>
<a id="pgfId-1080023"></a>When you are done, click <em>Plot</em>. </p>
<p>
<a id="pgfId-1080058"></a>The waveform window plots the noise figure and the noise figure over the range you specified to be displayed, as shown below.</p>

<p>
<a id="pgfId-1080065"></a></p>
<div class="webflare-div-image">
<img width="668" height="417" src="images/Chap3-319.gif" /></div>
<h3>
<a id="pgfId-1080095"></a>Noise Output Near Zero Frequency</h3>

<p>
<a id="pgfId-1080096"></a>First, the hb analysis is run to calculate the nonlinearity and the harmonics. Then hbnoise is run to calculate the noise. In all systems there is a maximum number of noise translations that need to be taken into account. Either the system harmonics become so small that the amount of noise translation becomes minimal or the devices themselves have finite noise bandwidths. </p>
<p>
<a id="pgfId-1080111"></a>These noise calculations from mixing or aliasing with the different harmonics are called sidebands.</p>

<p>
<a id="pgfId-1080083"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_80.gif" /></div>

<p>
<a id="pgfId-1080137"></a>In the diagram above the X axis is frequency. The top represents the harmonics that are calculated by the hb analysis. The bottom represents the noise output frequency. The arrows show the various mixing paths to the output frequency. Hbnoise calculates the noise contribution at the output with all these mixing paths in place. Black is the noise that occurs without mixing. Purple is the noise that mixes with the first harmonic. Blue is the noise that mixes with the second harmonic. Red is the noise that mixes with the third harmonic.</p>
<p>
<a id="pgfId-1080138"></a>In hbnoise, the output frequency (which is usually a range of frequencies) is specified along with the highest harmonic to calculate the mixing products.</p>

<h3>
<a id="pgfId-1080129"></a>Noise Output Near The First Harmonic</h3>
<p>
<a id="pgfId-1080176"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_81.gif" /></div>

<p>
<a id="pgfId-1080205"></a>Here the noise output frequency is shifted up to just above the first harmonic frequency. Black is the noise that occurs without mixing. Purple is the noise that mixes with the first harmonic. Blue is the noise that mixes with the second harmonic. Note that the noise frequency just below the first harmonic mixes with the second harmonic to provide the output just above the first harmonic. Red is the noise that mixes with the third harmonic. Note that the second term that mixes with the third harmonic is just above the fourth harmonic of the hb analysis which is not shown. The noise term shown with a dotted line is mixing with the fourth harmonic of the system.</p>

<h3>
<a id="pgfId-1080232"></a>Frequency Sweep</h3>

<p>
<a id="pgfId-1080233"></a>Since the fundamental quantity that is calculated in hbnoise is the output noise, the frequency range defined in the <em>Choosing Analyses</em> form defines an output frequency range to calculate the noise for. For driven circuits, the default is to sweep an absolute frequency range. Oscillators will be covered later.</p>
<p>
<a id="pgfId-1080234"></a>For an up-conversion system, sometimes a log frequency range is desired near one of the harmonics of the system. In that case, select relative sweep, and specify a harmonic number. In the output frequency range, type in the desired offset frequency from that harmonic. Note that this is only available for frequencies above the desired harmonic number because to get this below the harmonic requires taking the log of a negative number, which does not exist.</p>
<p>
<a id="pgfId-1080235"></a>When automatic is selected for sweep type, 100 total points will be calculated. In most cases, fewer points are needed so it is usually better to select linear or log and then specify the sweep you desire. Typically 3 to 5 points per decade or about 20 total points are needed.</p>

<h3>
<a id="pgfId-1080236"></a>Maximum Sideband</h3>

<p>
<a id="pgfId-1080237"></a>There is a property in the <em>Choosing Analyses</em> form called <em>Maximum sideband </em>that is used to define how many mixing products should be calculated. If <em>Maximum sideband </em>is zero, the noise analysis will only contain the noise that appears without mixing or aliasing of any type. This is not equivalent to a linear noise analysis because hbnoise takes into account the instantaneously varying nature of the noise because of the large signal being present in the hb analysis.</p>
<p>
<a id="pgfId-1080238"></a>When <em>Maximum sideband </em>is one, then the noise without frequency translation and the noise that mixes or aliases with the first harmonic is present in the noise analysis. When <em>Maximum sideband </em>is 10, the noise analysis includes noise mixing through the 10th harmonic of the harmonic balance analysis. Usually the number of harmonics in the hb analysis and the maximum number of sidebands should agree. This is easily accomplished by leaving the <em>Maximum sideband </em>field blank in the <em>Choosing Analyses</em> form in ADE Explorer.</p>

<h3>
<a id="pgfId-1080239"></a>Setting Harmonics and Sidebands</h3>

<p>
<a id="pgfId-1080240"></a>The process of setting harmonics and sidebands is similar to setting the maximum number of harmonics for the harmonic balance simulation. Start with an estimate based on the harmonic content of the input signal(s) and the nonlinearity of the circuit. Then run a simulation. Raise harmonics and sidebands and run again. If the noise measurement did not change, then the original number of harmonics and sidebands might be able to be reduced. If it did change, then more are needed. Getting a stable hbnoise output may take more or fewer harmonics and sidebands than the harmonic balance simulation by itself.</p>

<h3>
<a id="pgfId-1080270"></a>Nois<a id="marker-1299971"></a>e Separ<a id="marker-1269032"></a>ation</h3>

<p>
<a id="pgfId-1080271"></a>In addition to the total output noise, the individual noise contributions can be plotted if noise separation is selected in the <em>Choosing Analyses</em> form. More information about the noise separation will be provided later. Noise separation is available when the noise type is set to <em>timeaverage</em>. The things that can be plotted are: </p>
<ol><li>
<a id="pgfId-1093302"></a>Total noise at the output from each individual input frequency. </li><li>
<a id="pgfId-1093316"></a>The noise at the output from each instance name with all noise mechanisms included for mixing from an individual input frequency. </li><li>
<a id="pgfId-1093332"></a>The noise at the output from each instance name with all noise mechanisms broken out separately for mixing from an individual input frequency. </li><li>
<a id="pgfId-1093341"></a>The current noise at the noise instance for each instance name with all noise mechanisms included for mixing from an individual input frequency. </li><li>
<a id="pgfId-1093350"></a>The noise current in the instance from each instance name with all noise mechanisms broken out separately for mixing from an individual input frequency.</li><li>
<a id="pgfId-1093359"></a>The gain to the output from each individual instance with all the individual noise sources broken out separately for mixing from an individual input frequency.</li></ol>






<h3>
<a id="pgfId-1097156"></a>Multiple hbnoise</h3>

<p>
<a id="pgfId-1401010"></a>Some systems contain multiple points in the circuit where the noise measurement is desired. When the <em>Noise Type</em> is <em>timeaverage</em>, multiple hbnoise analyses are allowed. At the top of the hbnoise <em>Choosing Analyses</em> form, an option called <em>Multiple hbnoise</em> is provided. When this option is selected, up to six hbnoise analyses can be made after a single hb analysis. </p>

<h3>
<a id="pgfId-1422865"></a>Hbnoise after Multi-Tone hb</h3>

<p>
<a id="pgfId-1422852"></a>When sampled(jitter) is selected, any number of sampled measurements can be made. </p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1422887"></a>Currently, you cannot have a mix of <em>timeaverage</em> and <em>sampled</em>, but this will be made available in a future release.When multiple input frequencies are present in the circuit, there are more frequencies in the large-signal analysis to mix with. Not only are the harmonics of both tones present, the intermodulation products are present as well. In this case, the noise analysis becomes more involved because the transfer functions from all the frequencies present in the large-signal have to be calculated for each noise source. Also, the meaning of <em>Maximum sideband</em> slightly changes. If 5 were selected, all the noise translations would be calculated through the 5th harmonic of the tone with tstab enabled. In the harmonic balance <em>Choosing Analyses</em> form it is <em>Tone1</em> when <em>Frequencies</em> is selected, and the tone with tstab set to <em>yes</em> in the <em>Names</em> list. It is recommended that the largest number of harmonics for any tone in the hb list be used as maximum sideband. This can easily be accomplished by leaving the number of sidebands field being left blank.</div>
<p>
<a id="pgfId-1328015"></a>Note that noise type=timeaverage is the only available choice for a 2-tone driven circuit.</p>

<h3>
<a id="pgfId-1328016"></a>AM/PM Noise for Driven Circuits and Oscillators </h3>

<p>
<a id="pgfId-1329520"></a>Starting with IC617, the noise UI has been re-designed. <em>modulated</em> has been removed and its functionalities have been merged to <em>timeaverage</em>, leaving three noise types now. In addition, the FM jitter option has been removed. It is calculated through timeaverage PM noise, which should be used when you want to get phase noise.</p>
<p>
<a id="pgfId-1322429"></a>When <em>Noise Type</em> is set to <em>timeaverage</em>, USB, LSB, AM and PM noise are directly available.You can choose, for example, PM noise alone, or you can select the ALL(AM,PM,USB,LSB) option, if you need all four types of noise. The available options are <em>USB</em>, <em>AM</em>, <em>PM</em>, <em>AM&amp;PM</em>, and <em>ALL(AM,PM,USB,LSB)</em>.</p>
<p>
<a id="pgfId-1322805"></a><em>USB</em> denotes the total noise in the frequencies above the fundamental frequency and LSB denotes the noise below the fundamental frequency. </p>
<p>
<a id="pgfId-1386532"></a>For more information on changes, refer to the blog <em><a actuate="user" class="URL" href="https://community.cadence.com/cadence_blogs_8/b/cic/archive/2017/02/21/virtuoso-video-diary-performing-noise-simulation-in-spectre-rf-using-the-improved-pnoise-and-direct-plot-form-options" show="replace" xml:link="simple">Noise Simulation in Spectre RF Using Improved Pnoise/Hbnoise and Direct Plot Form Options</a></em>.</p>
<p>
<a id="pgfId-1322162"></a>AM and PM noise are discussed below.</p>
<p>
<a id="pgfId-1315175"></a>To illustrate AM noise, see the phasor diagram below.</p>

<p>
<a id="pgfId-1080224"></a></p>
<div class="webflare-div-image">
<img width="668" height="353" src="images/Chap3-322.gif" /></div>

<p>
<a id="pgfId-1080349"></a>This diagram illustrates a periodic signal with AM noise. The black phasor is the output signal, and AM noise is a random vector that varies the amplitude of the signal.</p>
<p>
<a id="pgfId-1080350"></a>PM noise is shown in the phasor diagram below.</p>

<p>
<a id="pgfId-1080341"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_83.gif" /></div>

<p>
<a id="pgfId-1080404"></a>In this case, the amplitude is constant, but the noise is a random vector perpendicular to the signal phasor. The timing of the signal varies a bit from cycle to cycle.</p>
<p>
<a id="pgfId-1322543"></a>The FM jitter and phase noise are only available through the PM noise option.</p>
<p>
<a id="pgfId-1080405"></a>Most circuits produce a combination of AM and PM noise. This concept is shown below.</p>

<p>
<a id="pgfId-1080389"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_84.gif" /></div>

<p>
<a id="pgfId-1080448"></a>In this case, a random vector at any angle and amplitude is produced that varies at each instant of time. If the uncertainty creates a round shape, the AM component and the PM component are the same size.</p>
<p>
<a id="pgfId-1080449"></a>In many circuits, AM or PM noise may dominate. If the PM noise dominates, the circle turns into an ellipse that is large in the perpendicular direction than in the parallel direction. This is shown below.</p>

<p>
<a id="pgfId-1080436"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_85.gif" /></div>
<h3>
<a id="pgfId-1080521"></a><a id="64223"></a>Jitter</h3>

<p>
<a id="pgfId-1096248"></a>Jitter is limited to single input frequency circuits. Jitter is usually applied to digital circuits where the average noise over the entire waveform is not appropriate. The noise in the high state and in the low state does not matter because the output voltage is so far from the voltage that triggers the load that it does not matter. The only time the noise matters is at the exact time where the trigger event is generated. Also, the noise in the low and high state is quite small because one device is completely off, and the other device is driven on. It is basically acting as a resistor. The device is not very good as an amplifier because the output is pulled hard into a rail. As the state changes, both devices are on, and they are relatively better amplifiers, so the noise is likely to be larger in the switching interval. In jitter for driven circuits, the voltage threshold for the noise measurement, and the selection of the rising edge, the falling edge, or both is made. At the threshold voltage specified, a noise measurement is made at that instant. Once the noise voltage is known, the timing uncertainty can be determined from the slew rate. Since the RMS noise voltage is calculated, the timing uncertainty is one standard deviation from the ideal crossing time. This is illustrated below.</p>

<p>
<a id="pgfId-1080513"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/3_86.gif" /></div>

<p>
<a id="pgfId-1401159"></a>In most cases, shooting PSS will provide a faster simulation that is much less prone to error. If you must use harmonic balance, ensure that you have enough harmonics in the HB simulation in order to get the correct slope of the above waveform. If you under specify the number of harmonics, the slope will be smaller and the jitter measurement will be correspondingly larger. You can get an estimate of how many harmonics you need from the tstab waveform by taking the period of the signal divided by the fastest 10% to 90% rise or fall times in the circuit.</p>
<p>
<a id="pgfId-1401922"></a>sampled(jitter) has three modes:</p>
<ul><li>
<a id="pgfId-1422996"></a>Edge crossing mode: Allows a jitter measurement at a time specified by a threshold specification and rise or fall direction. The measurement can be made on that same net or at another net in the circuit. This is provided so the switch clock of a switched-capacitor circuit can specify the time for a noise measurement at the output of the filter.</li><li>
<a id="pgfId-1402347"></a>Sampled phase mode: This is like the old timedomain hbnoise. In this mode, you can specify a list of times in the hb timedomain waveform and the noise measurements will be made at the specified times.</li><li>
<a id="pgfId-1402538"></a>Edge delay mode: Allows both the trigger and the measurement to be edges anywhere in the circuit. You can use the rising edge of a pulse as the trigger and the falling edge of the same pulse to be the measurement, and then you will get the jitter on the pulse. You can also set the input to an inverter as the trigger and the output of the inverter as the measurement, in which case you will measure the jitter of the inverter.</li></ul>



<h3>
<a id="pgfId-1080564"></a><a id="73478"></a>Oscillators</h3>
<h4>
<a id="pgfId-1329515"></a>timeaverage USB noise</h4>

<p>
<a id="pgfId-1329516"></a>For oscillators, the hbnoise frequency range defaults to <em>relative</em>. Specify the harmonic number as appropriate for the system you are simulating. If you are simulating an oscillator by itself, then the harmonic number is likely to be 1. If you have an oscillator and a diode frequency doubler, then the harmonic number is likely to be 2. If you have an oscillator with a frequency divider, in the hb form, you should specify the approximate frequency of oscillation for the oscillator itself, and set the freqdivide property to the divider ratio. This has the effect of dropping the first harmonic frequency by the divide ratio. In the hbnoise form, if the noise is desired on the frequency divided output, then the relative harmonic is 1. If the noise is desired at the output of the oscillator, the relative harmonic number is the divide ratio. The meaning of relative is to take the frequency of harmonic number specified and add to it the frequencies specified in the Choosing Analyses form. If the oscillator had a 1GHz output, and the hbnoise had 1M relative to the first harmonic specified, the actual output frequency is 1G + 1M, or 1001M.</p>
<p>
<a id="pgfId-1080569"></a>Oscillators do not need noise figure calculations and are not typically driven. The output is usually a voltage, and an output node is typically selected.</p>
<p>
<a id="pgfId-1389477"></a>Hbnoise is a small-signal analysis and is not limited by large-signal effects such as clipping or slew-rate limits. As a result, at low offset frequency, the phase noise might be significantly greater than 0dBC/Hz. This indicates that the noise is larger than the oscillations, which is not physically possible. If you want to see the phase noise curve level off at low frequency, set the <em>lorentzian</em> option to <em>yes</em>.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1435268"></a>The <em>lorentzian</em> option is supported only when <em>Noise Type</em> is set to <em>timeaverage</em>.</div>

<h3>
<a id="pgfId-1389479"></a>sampled(jit<a id="marker-1435354"></a>ter)</h3>

<p>
<a id="pgfId-1389480"></a>This is like the jitter measurement described above.</p>

<h2>
<a id="pgfId-1080556"></a><a id="12580"></a>Noise Calc<a id="noise_calculations"></a>ulations in the Simulator</h2>
<h3>
<a id="pgfId-1080676"></a>Noise Factor and Noise Figure</h3>

<p>
<a id="pgfId-1080677"></a>When the hbnoise analysis is set up with voltage selected instead of probe for the input, noise figure and noise factor cannot be calculated because the system resistance specified in the port component is not available to the simulator. Using a port as the input probe is required to obtain noise figure and noise factor calculations.</p>
<p>
<a id="pgfId-1080678"></a>In the <em>Direct Plot Form</em>, noise factor and noise figure are both single-sideband measurements.</p>
<p>
<a id="pgfId-1080679"></a>Noi<a id="marker-1300020"></a>se factor is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080680"></a>((All the noise power at the output from all the components with all the frequency translations) - (Noise power at the output from the load))/Noise power at the output from the resistance of the input port from the passband frequency only.</pre>

<p>
<a id="pgfId-1080681"></a>In the <em>Choosing Analyses</em> form, the input port is identified by the instance name. The port component is a voltage source in series with a resistor and is considered as a single element. No access is provided to the results for the internal node where the resistor and voltage source join.</p>
<p>
<a id="pgfId-1080682"></a>In order to determine the passband frequency, the reference sideband must be supplied. This specifies the passband frequency for the noise figure calculation. The easiest way to select the reference sideband is to use the <em>Select from list</em> feature in the hbnoise <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1080683"></a>The noise from the load is normally defined by selecting the port or resistor that is serving as the load for the circuit in the Choosing Analyses form.</p>
<p>
<a id="pgfId-1080684"></a>Nois<a id="marker-1300025"></a>e figure is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080685"></a>10*log(10) (Noise Factor)</pre>

<p>
<a id="pgfId-1080688"></a>Noise factor (IEEE) is similar to the noise figure measurement above. If you subtract from the numerator all the noise from the input port at all frequencies except the passband, you have the IEEE noise factor.</p>
<p>
<a id="pgfId-1080689"></a>As mentioned earlier, in order to calculate the IEEE noise factor, a port component must be used as the input. In the <em>Choosing Analyses</em> form, the input port is identified by the instance name. The port component is a voltage source in series with a resistor and is considered as a single element. No access is provided to the results for the internal node where the resistor and voltage source join.</p>
<p>
<a id="pgfId-1080690"></a>In order to determine the passband frequency, the reference sideband must be supplied. This specifies the passband frequency for the noise figure calculation. The easiest way to select the reference sideband is to use the<em> Select from list</em> feature in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1080691"></a>The noise from the load is normally defined by selecting the port or resistor that is serving as the load for the circuit in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1080692"></a>Noise Factor IEEE is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080693"></a>((All the noise power at the output from all the components with all the frequency translations) - (Noise power at the output from the resistor in the input port at all frequencies except for the passband) - (Noise power at the output from the load))/Noise power at the output from the resistance of the input port from the passband frequency only.</pre>

<p>
<a id="pgfId-1080694"></a>Noise figure IEEE is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080750"></a>10*log(10) (IEEE Noise Factor)</pre>

<p>
<a id="pgfId-1080697"></a>Noise factor DSB is similar to the single sideband noise factor above, except in the denominator, the noise power from the input port at the image frequency is added.</p>
<p>
<a id="pgfId-1080698"></a>Noise factor (DSB) is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080699"></a>((All the noise power at the output from all the components with all the frequency translations) - (Noise power at the output from the load))/Noise power at the output from the resistance of the input port from the passband and image frequencies only.</pre>

<p>
<a id="pgfId-1093579"></a>As mentioned earlier, in order to calculate the DSB noise factor, a port component must be used as the input. In the <em>Choosing Analyses</em> form, the input port is identified by the instance name. The port component is a voltage source in series with a resistor and is considered as a single element. No access is provided to the results for the internal node where the resistor and voltage source join.</p>
<p>
<a id="pgfId-1093580"></a>In order to determine the passband frequency, the reference sideband must be supplied. This specifies the passband frequency and by inference the image frequency for the noise figure calculation. The easiest way to select the reference sideband is to use the <em>Select from list</em> feature in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1080702"></a>The noise from the load is normally defined by selecting the port or resistor that is serving as the load for the circuit in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1080703"></a>Noise figure (DSB) is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080704"></a>10*log(10) (Noise Factor (DSB))</pre>

<p>
<a id="pgfId-1080791"></a><strong>Summary</strong>:</p>
<p>
<a id="pgfId-1080792"></a><code>No</code> = total output noise<br /><code>Ns</code> = noise at the output due to the input probe at the passband frequency (the source)<br /><code>Nsi</code> = noise at the output due to the image harmonic at the source<br /><code>Nso</code> = noise at the output due to harmonics other than input at the source<br /><code>Nl</code> = noise at the output due to the output probe (the load)<br /><code>IRN</code> = input referred noise<br /><code>G</code> = gain of the circuit<br /><code>F</code> = noise factor<br /><code>NF</code> = noise figure<br /><code>Fdsb</code> = double sideband noise factor<br /><code>NFdsb</code> = double sideband noise figure<br /><code>Fieee</code> = IEEE single sideband noise factor<br /><code>NFieee</code> = IEEE single sideband noise figure</p>
<p>
<a id="pgfId-1080807"></a>then,</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080808"></a>IRN = sqrt(No^2/G^2)<br />F = (No^2 - Nl^2)/Ns^2<br />NF = 10*log10(F)<br />Fdsb = (No^2 - Nl^2)/(Ns^2+Nsi^2)<br />NFdsb = 10*log10(Fdsb)<br />Fieee = (No^2 - Nl^2 - Nso^2)/Ns^2<br />NFieee = 10*log10(Fieee)</pre>

<p>
<a id="pgfId-1080815"></a>When the hbnoise analysis is set up with voltage selected instead of probe, noise figure cannot be calculated.</p>

<h3>
<a id="pgfId-1081028"></a>Input-Referred Noise</h3>

<p>
<a id="pgfId-1081029"></a>When the hbnoise analysis is set up with the input source being a port, input-referred noise may not be exact. In this case, the input-referred noise is referred to the voltage source that is inside the port component. The amplitude of the noise is divided by two, which assumes a perfect match. If an accurate input-referred noise is desired, set the <em>Input Source</em> to <em>voltage</em>, and select the input node. This will disable the noise figure calculation.</p>

<h3>
<a id="pgfId-1081030"></a>Noise transfer function</h3>

<p>
<a id="pgfId-1081031"></a>Hbnoise calculates the forward gain from the passband to the output and saves it. In the <em>Direct Plot Form</em>, this is called <em>Transfer Function</em>, and is in linear volts at the output divided by volts at the input.</p>

<h2>
<a id="pgfId-1334119"></a>Comm<a id="hbnoise_options"></a>only Used Options</h2>
<p>
<a id="pgfId-1366038"></a></p>
<div class="webflare-div-image">
<img width="668" height="666" src="images/Chap3-327.gif" /></div>
<h4>
<a id="pgfId-1366043"></a>To<a id="marker-1366041"></a>lerance</h4>

<p>
<a id="pgfId-1366044"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1128521"></a>Hbnoise uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough, and the tolerance option specifies that accuracy for hbnoise. For driven circuits, the default is 1e-6. For oscillators, the default is 1e-4.</p>

<h4>
<a id="pgfId-1128529"></a>Resg<a id="marker-1300057"></a>mrescycle</h4>

<p>
<a id="pgfId-1128530"></a>Leave this option at the default. </p>

<h4>
<a id="pgfId-1128531"></a>Hbpreco<a id="marker-1300062"></a>nd_solver</h4>

<p>
<a id="pgfId-1128532"></a>The basic solver is the only solver available in standard Spectre. Autoset is the default solver when APS is used. This solver is faster. If stagnation is detected, Spectre prints a message in the Spectre output window.</p>

<h4>
<a id="pgfId-1128533"></a>Ann<a id="marker-1300072"></a>otate</h4>

<p>
<a id="pgfId-1128534"></a>This option controls the amount of output in the spectre output window. Selecting <em>title</em> produces the least amount of detail, and selecting <em>steps</em> gives the most amount of detail. The options between produce more details as you move from left to right.</p>

<h4>
<a id="pgfId-1366031"></a>Stim<a id="marker-1366030"></a>uli</h4>

<p>
<a id="pgfId-1366032"></a>This option is not implemented in the <em>Direct Plot Form </em>in ADE Explorer. It is used for the hbxf analysis that runs when an hbnoise is run. The default is <em>sources</em> which calculates the forward conversion gain in hbxf from the sources in the circuit only. <em>nodes_and_terminals</em> also calculates the conversion gain from all the nodes in the circuit to the output. To display these results in ADE Explorer, you must use the results browser and the calculator.</p>

<h4>
<a id="pgfId-1366022"></a>Sa<a id="marker-1366021"></a>ve</h4>

<p>
<a id="pgfId-1366012"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved. In ADE Explorer, this is accomplished using <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Design</em> and then selecting the nodes and terminals specifically in the schematic. At the netlist level, this is accomplished by using a save statement with a list of names to be saved. </p>

<h4>
<a id="pgfId-1128537"></a>Nes<a id="marker-1300087"></a>tlvl</h4>

<p>
<a id="pgfId-1128538"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> can be any integer. The example below shows <em>lvlpub</em> selected that saves two levels of hierarchy.</p>

<p>
<a id="pgfId-1128542"></a></p>
<div class="webflare-div-image">
<img width="668" height="73" src="images/Chap3-328.gif" /></div>
<h4>
<a id="pgfId-1128543"></a>Saveallsi<a id="marker-1300092"></a>debands</h4>

<p>
<a id="pgfId-1128544"></a>Leave this option at the default value of <em>no</em>. If you want to see the noise contributors from the different noise input frequencies, select <em>yes</em> for noise separation in the hbnoise <em>Choosing Analyses</em> form.</p>

<h4>
<a id="pgfId-1128567"></a>Loren<a id="marker-1300097"></a>tzian</h4>

<p>
<a id="pgfId-1128568"></a>This option is documented in the oscillator section. It only affects oscillators.</p>
<p>
<a id="pgfId-1128569"></a>AdditionalParams</p>
<p>
<a id="pgfId-1128570"></a>This is a field for <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements. Multiple <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements are allowed with a space between them. Generally, this is used to unlock the beta features.</p>

<h2>
<a id="pgfId-1365999"></a>ADE Explorer Implementation</h2>

<p>
<a id="pgfId-1366000"></a>This section jumps from theory to practical with examples on how to use the individual analysis types that have been covered. Driven circuits and oscillators will be shown.</p>

<h3>
<a id="pgfId-1329746"></a>Driven Circuits</h3>
<h4>
<a id="pgfId-1329748"></a><a id="45619"></a>Noise Type = timeaverage USB noise</h4>

<p>
<a id="pgfId-1329749"></a>On the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1081515"></a>First, set up the harmonic balance analysis. For more information, see the Harmonic Balance section at the beginning of this chapter.<br />
<a id="pgfId-1261134"></a><div class="webflare-div-image">
<img width="409" height="783" src="images/Chap3-329.gif" /></div></li><li>
<a id="pgfId-1129429"></a>In the hbnoise <em>Choosing Analyses</em> form, specify the output frequency range of your circuit.<br />
<a id="pgfId-1081532"></a><div class="webflare-div-image">
<img width="668" height="235" src="images/Chap3-330.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1081563"></a>Since the fundamental quantity that is calculated by the noise analysis is the noise at the output, the frequency range is always the output frequency range.</div></li><li>
<a id="pgfId-1081539"></a>Set about 3 to 5 points per decade in the <em>Points Per Decade</em> field.</li><li>
<a id="pgfId-1353739"></a>Leave the <em>Maximum sideband</em> field blank or set it to the same number as the number of harmonics in the hb analysis. This specifies that the noise that mixes with all the hb harmonics is calculated.<br />
<a id="pgfId-1353743"></a><div class="webflare-div-image">
<img width="668" height="85" src="images/Chap3-331.gif" /></div></li><li>
<a id="pgfId-1353744"></a>Specify the output of the circuit. When the output is set to <em>probe</em>, a resistor or a port can be selected and this noise will be subtracted from the noise figure calculation.<br />
<a id="pgfId-1081654"></a><div class="webflare-div-image">
<img width="668" height="170" src="images/Chap3-332.gif" /></div></li><li>
<a id="pgfId-1081661"></a>Select <em>port</em> from the <em>Input Source</em> drop-down list for noise figure calculation.</li><li>
<a id="pgfId-1081688"></a>Choose <em>Select from list</em> from the drop-down list for reference sideband, which specifies the input frequency range for the noise figure calculation.<br />
<a id="pgfId-1081695"></a><div class="webflare-div-image">
<img width="668" height="192" src="images/Chap3-333.gif" /></div></li><li>
<a id="pgfId-1081706"></a>Select the passband frequency range from the list.</li><li>
<a id="pgfId-1081743"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list to calculate the average noise power at the output averaged over the entire time of one cycle of the input waveform.<br />
<a id="pgfId-1365989"></a><div class="webflare-div-image">
<img width="668" height="210" src="images/Chap3-334.gif" /></div></li><li>
<a id="pgfId-1365990"></a>Select the check box for <em>Noise Separation</em> to enable plotting of the individual noise contributors in the circuit. Noise separation is only available when <em>Noise Type</em> is set to <em>timeaverage.</em></li></ol>



































<h4>
<a id="pgfId-1365962"></a>Multiple hbn<a id="marker-1365961"></a>oise</h4>

<p>
<a id="pgfId-1097264"></a>When <em>Noise type</em> is set to <em>timeaverage</em>, multiple hbnoise analyses can be run after a single hb analysis. This is useful for LNA-Mixer combinations, or in any circuit where there are multiple points in the circuit where noise is important.</p>
<p>
<a id="pgfId-1097281"></a>To run multiple analyses after a single hb:</p>
<ol><li>
<a id="pgfId-1097231"></a>First, set up the harmonic balance simulation. for more information, see the harmonic balance section at the beginning of this chapter.<br />
<a id="pgfId-1261233"></a><div class="webflare-div-image">
<img width="482" height="783" src="images/Chap3-335.gif" /></div></li><li>
<a id="pgfId-1130353"></a>Select the <em>Multiple hbnoise</em> check box located at the top of the hbnoise <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1097232"></a>Set up all the noise analyses you want to run, as shown below.<br />
<a id="pgfId-1097215"></a><div class="webflare-div-image">
<img width="668" height="747" src="images/Chap3-336.gif" /></div></li></ol>










<p>
<a id="pgfId-1098940"></a><a id="31118"></a>Noise Type = timeaverage AM, PM, AM&amp;PM</p>
<p>
<a id="pgfId-1329872"></a>timeaverage also allows the measurement of the AM and PM components of noise separately.</p>
<p>
<a id="pgfId-1098941"></a>First, set up the hb analysis as appropriate for your circuit. For more information, see the harmonic balance section of this chapter.</p>

<p>
<a id="pgfId-1098955"></a></p>
<div class="webflare-div-image">
<img width="668" height="647" src="images/Chap3-337.gif" /></div>

<p>
<a id="pgfId-1098985"></a>On the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1099011"></a>Set up an appropriate frequency range of interest.<br />
<a id="pgfId-1099036"></a><div class="webflare-div-image">
<img width="668" height="234" src="images/Chap3-338.gif" /></div></li><li>
<a id="pgfId-1099043"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list.<br />
<a id="pgfId-1365953"></a><div class="webflare-div-image">
<img width="668" height="227" src="images/Chap3-339.gif" /></div></li><li>
<a id="pgfId-1365954"></a>Select the ALL(AM,PM,USB,LSB) radio button. <br />
<a id="pgfId-1365955"></a>When you select the ALL(AM,PM,USB,LSB) option, Sweeptype automatically changes to relative.</li><li>
<a id="pgfId-1365956"></a>Specify a number in the <em>Relative Harmonic</em> field.</li><li>
<a id="pgfId-1365957"></a>Run the simulation. </li></ol>













<p>
<a id="pgfId-1099169"></a>Now plot the Output noise using the <em>Direct Plot Form</em>.</p>
<p>
<a id="pgfId-1099170"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1099157"></a>Select <em>Output Noise</em> from the <em>Function</em> section.<br />
<a id="pgfId-1365946"></a><br /><div class="webflare-div-image">
<img width="668" height="659" src="images/Chap3-340.gif" /></div></li><li>
<a id="pgfId-1365947"></a>Select <em>AM</em> or <em>PM</em> from the <em>Noise Type</em> radio buttons.</li><li>
<a id="pgfId-1391882"></a>Enter the frequency in the <em>Value At (Hz)</em> field if you want to plot the value at a specific frequency. You can enter a list of frequencies separate by a space in this field.</li><li>
<a id="pgfId-1391906"></a>Choose SSB or DSB for AM and PM noise. DSB is 3dB higher than SSB noise.<br />
<a id="pgfId-1391907"></a>Note the DSB AM noise is 3dB larger than the output noise. This is because the output noise is derived from the positive frequencies only, and the DSB AM and PM noise is derived using the double sidebands.</li><li>
<a id="pgfId-1391883"></a>If you want this signal to plot automatically when a new simulation is run, select <em>Add To Outputs</em>. The expression is automatically evaluated in ADE.</li></ol>










<h4>
<a id="pgfId-1330164"></a>Noise Type = sampled(jit<a id="marker-1330163"></a>ter)</h4>

<p>
<a id="pgfId-1330415"></a>Driven jitter is usually used for measuring the noise in a digital circuit at a specific threshold crossing. In this mode you must use enough harmonics to get a correct slope of the waveform. This must be done manually. Auto harmonics might not give you enough harmonics. </p>
<p>
<a id="pgfId-1423732"></a>On the hb Choosing Analyses form:</p>
<ol><li>
<a id="pgfId-1424068"></a>Set a variable for the <em>Number of Harmonics</em> field.<br /><div class="webflare-div-image">
<img width="467" height="819" src="images/Chap3-341.gif" /></div></li><li>
<a id="pgfId-1403876"></a>Set the variable to a small number in ADE and run the simulation. </li><li>
<a id="pgfId-1424088"></a>Open <em>Results - Direct Plot - Main Form</em> and plot the timedomain waveform with <em>Add to Outputs</em> selected in the Direct Plot Form.<br /><div class="webflare-div-image">
<img width="666" height="363" src="images/Chap3-342.gif" /></div></li><li>
<a id="pgfId-1403968"></a>Run a sweep in ADE. <br />
<a id="pgfId-1424171"></a>After the simulation is complete, a family of waveforms will be plotted. Zoom in to the rising and falling edges to view the waveform details.</li></ol>










<p>
<a id="pgfId-1405194"></a><em></em></p>

<div class="webflare-div-image">
<img width="648" height="457" src="images/Chap3-343.gif" /></div>

<p>
<a id="pgfId-1405155"></a><em></em></p>

<div class="webflare-div-image">
<img width="651" height="425" src="images/Chap3-344.gif" /></div>

<p class="webflare-indent1">
<a id="pgfId-1405218"></a>The rising edge needs more harmonics than the falling edge. Approximately 40 harmonics are needed in the example shown above.</p>
<p class="webflare-indent1">
<a id="pgfId-1404308"></a>Disable the sweep and set the variable to the number of harmonics you determine. In this example, it was set to 40.</p>
<p>
<a id="pgfId-1099362"></a>On the hbnoise <em>Choosing Analyses</em> form, the stop frequency is half the input frequency. The start frequency is four decades below that. About five points per decade is usually sufficient. <em>Maximum sideband</em> should be left blank. </p>

<h4>
<a id="pgfId-1404710"></a>Edge Crossing Mode</h4>

<p>
<a id="pgfId-1404736"></a>In this mode, you specify a trigger which is an edge in the circuit. This determines the time in the waveform to make the measurement. The measurement is specified separately in order to allow one waveform to set the time and measure another net at that time. </p>
<p>
<a id="pgfId-1424734"></a>Click <em>Add</em>. The threshold is set appropriately. The <em>Edge Direction</em> option can be set to <em>rise</em> or <em>fall</em>.</p>
<p>
<a id="pgfId-1435728"></a>You can also specify <em>Sleep Time</em>, which is the length of time that Spectre will wait before checking for the crossing event in pnoise and hbnoise sampled(jitter) analysis. It is netlisted in Spectre as &quot;delay&quot;. This is used in circuits (such as dividers) where there are multiple edges in the PSS and hb periodic steady state interval.</p>
<p>
<a id="pgfId-1435773"></a></p>

<div class="webflare-div-image">
<img width="351" height="562" src="images/Chap3-345.gif" /></div>

<p>
<a id="pgfId-1099367"></a>When the simulation completes, use the <em>Direct Plot Form</em> to plot the jitter. For driven circuits, select <em>Jee</em><a id="marker-1435815"></a>, which is edge-to-edge jitter. In the below example, 77p is the rising edge, and 275p is the falling edge.</p>

<p>
<a id="pgfId-1099371"></a></p>
<div class="webflare-div-image">
<img width="668" height="660" src="images/Chap3-346.gif" /></div>

<p>
<a id="pgfId-1365893"></a>The output noise frequency response and the edge-to-edge jitter are displayed. The jee measurement is one standard deviation for the expected jitter.</p>

<p>
<a id="pgfId-1366232"></a></p>
<div class="webflare-div-image">
<img width="661" height="435" src="images/Chap3-347.gif" /></div>
<h4>
<a id="pgfId-1366176"></a>Sampled phase mode</h4>

<p>
<a id="pgfId-1405693"></a>First, plot the timedomain waveform for the net that you want to measure. Place markers at the lowest and highest voltage that you want to explore.</p>
<p>
<a id="pgfId-1405774"></a></p>

<div class="webflare-div-image">
<img width="666" height="529" src="images/Chap3-348.gif" /></div>

<p>
<a id="pgfId-1405862"></a>In this case, times from 72psec to 84psec would capture the variation in noise voltage from 1 Volt below the threshold to 1 Volt above the threshold.</p>
<p>
<a id="pgfId-1366177"></a>On the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1130953"></a>In the hbnoise <em>Choosing Analyses</em> form, select Sampled Phase
<em></em><br /><div class="webflare-div-image">
<img width="292" height="736" src="images/Chap3-349.gif" /></div></li><li>
<a id="pgfId-1082248"></a>Set the stop frequency to half the input hb frequency.
<br /><div class="webflare-div-image">
<img width="668" height="141" src="images/Chap3-350.gif" /></div></li><li>
<a id="pgfId-1082253"></a>Set the start frequency to four decades smaller than the stop frequency.</li><li>
<a id="pgfId-1082254"></a>Leave the <em>Maximum sideband</em> field blank.</li><li>
<a id="pgfId-1082301"></a>Select the net to be measured.</li><li>
<a id="pgfId-1365888"></a>Type <em>1</em> (one) in the <em>Samples Per Period</em> field.</li><li>
<a id="pgfId-1406863"></a>Select the <em>Add Specific Points</em> check box.</li><li>
<a id="pgfId-1365890"></a>Type a list of times in the <em>Add Specific Points</em> field.</li><li>
<a id="pgfId-1406917"></a>Click <em>Add</em>.</li><li>
<a id="pgfId-1406939"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1082381"></a>Run the simulation and open the Direct Plot Form.
<br /><div class="webflare-div-image">
<img width="431" height="565" src="images/Chap3-351.gif" /></div></li><li>
<a id="pgfId-1407102"></a>If required, select the appropriate noise analysis in the <em>Measurement Selection</em> drop-down list.</li><li>
<a id="pgfId-1407203"></a>Select <em>HB Integ Output Noise</em>.</li><li>
<a id="pgfId-1407240"></a>Set the frequency range to the values used in hbnoise.</li><li>
<a id="pgfId-1407299"></a>If required, click <em>Add To Outputs</em>.</li><li>
<a id="pgfId-1407351"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1423232"></a>The noise waveform appears in another subwindow.<br /><div class="webflare-div-image">
<img width="667" height="472" src="images/Chap3-352.gif" /></div></li><li>
<a id="pgfId-1407436"></a>To put the noise waveform in the same subwindow as the output waveform, right-click the X Axis in the left subwindow.</li><li>
<a id="pgfId-1407568"></a>Select <em>Allow Any Units</em>.</li><li>
<a id="pgfId-1407611"></a>Drag the noise waveform into the same subwindow as the waveform and delete the other subwindow.</li><li>
<a id="pgfId-1407723"></a>Zoom in to the area of interest.<br /><div class="webflare-div-image">
<img width="666" height="444" src="images/Chap3-353.gif" /></div>
<a id="pgfId-1407777"></a>The rising edge and the noise voltage are plotted.</li></ol>





































<h4>
<a id="pgfId-1408018"></a>Edge Delay Mode</h4>

<ol><li>
<a id="pgfId-1408053"></a>In the hbnoise Choosing Analyses form, set the stop frequency to half the PSS frequency.
<br /><div class="webflare-div-image">
<img width="352" height="720" src="images/Chap3-354.gif" /></div></li><li>
<a id="pgfId-1408195"></a>Set the start frequency to four decades below that.</li><li>
<a id="pgfId-1408261"></a>Select <em>Edge Delay</em> for <em>Timing Event</em>.</li><li>
<a id="pgfId-1408291"></a>Select the net that starts the jitter measurement time.</li><li>
<a id="pgfId-1408356"></a>Set the appropriate voltage for <em>Threshold Value</em>.</li><li>
<a id="pgfId-1408402"></a>Select <em>Rise</em> or <em>Fall</em> from the <em>Edge Direction</em> drop-down list.</li><li>
<a id="pgfId-1435576"></a>(Optional) Set <em>Sleep Time</em>, which is the length of time that Spectre will wait before checking for the crossing event in hbnoise sampled(jitter) analysis.</li><li>
<a id="pgfId-1408440"></a>Select the net that stops the jitter measurement.</li><li>
<a id="pgfId-1426150"></a>Select <em>Rise</em> or <em>Fall</em> from the <em>Edge Direction</em> drop-down list.</li><li>
<a id="pgfId-1408543"></a>Click <em>Apply</em>.</li><li>
<a id="pgfId-1408574"></a>Click <em>OK</em> to close the form.</li><li>
<a id="pgfId-1408591"></a>Run the simulation.</li><li>
<a id="pgfId-1426204"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>..<br /><div class="webflare-div-image">
<img width="640" height="649" src="images/Chap3-355.gif" /></div></li><li>
<a id="pgfId-1408721"></a>If you ran multiple analyses, select the appropriate hbnoise analysis in the <em>Measurement Selection</em> drop-down list.</li><li>
<a id="pgfId-1408841"></a>Select the <em>Jdelay</em> from the Function section.</li><li>
<a id="pgfId-1408863"></a>Set <em>Integration Limits</em> as the range you had set in the hbnoise analysis.</li><li>
<a id="pgfId-1408939"></a>If required, select <em>Add To Outputs</em>.</li><li>
<a id="pgfId-1408985"></a>Click Plot.<br /><div class="webflare-div-image">
<img width="668" height="452" src="images/Chap3-356.gif" /></div>
<a id="pgfId-1409018"></a>The jitter is shown in the marker attached to the trace.</li></ol>




























<h3>
<a id="pgfId-1082426"></a>Oscillators</h3>
<h4>
<a id="pgfId-1082440"></a>Noise Type = timeaverage PM noise</h4>

<p>
<a id="pgfId-1082462"></a>The settings are the same as driven <em>Noise Type = timeaverage</em> with the exception of being a relative sweep by default and usually for oscillators the PM component of noise is desired. Since the phase noise of the oscillator is near one of the harmonics, <em>Sweeptype</em> is set to <em>relative</em> by default. A harmonic number is provided for the case where there is a frequency multiplier or a frequency divider on the output of the oscillator. <em>Noise type = timeaverage</em> also has the ability to plot the noise contributors from mixing with each harmonic when noise separation is selected. There is an example of noise separation later in this chapter.</p>
<p>
<a id="pgfId-1082463"></a>The hbnoise setup is similar to driven except that the relative harmonic is specified and <em>PM noise</em> or <em>All</em> would be selected.</p>
<p>
<a id="pgfId-1131080"></a>First, set up the harmonic balance analysis. For more information, see the Harmonic Balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1261692"></a></p>
<div class="webflare-div-image">
<img width="411" height="768" src="images/Chap3-357.gif" /></div>

<p>
<a id="pgfId-1082450"></a>On the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1082489"></a>Select <em>relative</em> from the <em>Sweeptype</em> drop-down list.<br />
<a id="pgfId-1082493"></a><div class="webflare-div-image">
<img width="668" height="41" src="images/Chap3-358.gif" /></div></li><li>
<a id="pgfId-1082494"></a>Specify the appropriate harmonic number for your design. In this example, the first harmonic is specified in the <em>Relative Harmonic</em> field.</li><li>
<a id="pgfId-1082495"></a>The frequency range should be the relative frequency range.<br />
<a id="pgfId-1082499"></a><div class="webflare-div-image">
<img width="668" height="78" src="images/Chap3-359.gif" /></div></li><li>
<a id="pgfId-1082501"></a>Leave the <em>Maximum sideband</em> field blank.<br />
<a id="pgfId-1082505"></a><div class="webflare-div-image">
<img width="668" height="85" src="images/Chap3-360.gif" /></div></li><li>
<a id="pgfId-1082506"></a>Select <em>voltage</em> from the <em>Output</em> drop-down list.<br />
<a id="pgfId-1082516"></a><div class="webflare-div-image">
<img width="668" height="109" src="images/Chap3-361.gif" /></div></li><li>
<a id="pgfId-1365879"></a>Specify the output node in the <em>Positive Output Node</em> field.</li><li>
<a id="pgfId-1365876"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list. This gives an averaged noise measurement.<br />
<a id="pgfId-1082598"></a><div class="webflare-div-image">
<img width="668" height="207" src="images/Chap3-362.gif" /></div></li><li>
<a id="pgfId-1389690"></a>Select <em>PM</em>, <em>AM&amp;PM</em>, or <em>ALL</em> to calculate the PM component of noise.</li><li>
<a id="pgfId-1389677"></a>Select <em>yes</em> for <em>Noise Separation</em> if you want to plot the individual noise contributors.</li><li>
<a id="pgfId-1317889"></a>Run the simulation.</li><li>
<a id="pgfId-1317890"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.<br />
<a id="pgfId-1317894"></a><div class="webflare-div-image">
<img width="572" height="682" src="images/Chap3-363.gif" /></div></li><li>
<a id="pgfId-1317895"></a>In the <em>Direct Plot Form</em>, select <em>hbnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1317896"></a>Select <em>Output Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1409830"></a>Select <em>dBc/Hz</em> from the <em>Units</em> section.</li><li>
<a id="pgfId-1409876"></a>(Optional)To measure phase noise at different offset frequencies using an expression, type those frequencies in the <em>Value At (Hz)</em> field. <br />
<a id="pgfId-1426857"></a>Separate the entries with a space. When you also select the <em>Add To Outputs</em> check box, the expressions will be entered in ADE that measure the phase noise at all the frequencies in the list.</li><li>
<a id="pgfId-1410239"></a>Select <em>Noise convention</em> as needed.</li><li>
<a id="pgfId-1317897"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1426928"></a>The phase noise is plotted.<br /><div class="webflare-div-image">
<img width="663" height="446" src="images/Chap3-364.gif" /></div></li><li>
<a id="pgfId-1365871"></a>To plot the cycle or cycle-to-cycle jitter, select <em>Jc</em> or <em>Jcc</em><a id="marker-1365870"></a> from the <em>Function</em> section.<br />
<a id="pgfId-1365866"></a><div class="webflare-div-image">
<img width="529" height="727" src="images/Chap3-365.gif" /></div></li><li>
<a id="pgfId-1365847"></a> Specify the start and stop frequencies as shown in the figure above.</li><li>
<a id="pgfId-1427022"></a><em>Click</em> Add To Outputs.<br />
<a id="pgfId-1427025"></a>An expression to measure the cycle jitter result is entered into ADE.</li></ol>






















































<h4><em>
<a id="pgfId-1317937"></a>NoiseType=sampled(jitter)</em></h4>

<p>
<a id="pgfId-1411066"></a>If you have square wave circuits, pss shooting is likely to run faster and be less error prone than harmonic balance. For more information, see the discussion in the driven circuit sampled(jitter) section.</p>
<p>
<a id="pgfId-1082896"></a>This capability is seldom used for oscillators. There is the ability to plot the single-sideband phase noise from the Direct Plot Form, however the result will usually agree with timeaverage except at high frequency offsets. When using hbnoise, you must take care to have enough harmonics to accurately capture the output waveform. Refer to the sampled(jitter) for driven circuits section to know more about the process.</p>
<p>
<a id="pgfId-1412170"></a>All the modes available for driven circuits are available for oscillators. The only mode with value for oscillators is edge crossing mode. The other modes will not be covered in this section. To know more about the other modes, refer to the sampled(jitter) driven circuits section. First, set up the harmonic balance analysis. Ensure that you have enough harmonics to accurately capture the slope of the output waveform. For more information, see the harmonic balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1263290"></a></p>
<div class="webflare-div-image">
<img width="482" height="779" src="images/Chap3-366.gif" /></div>

<p>
<a id="pgfId-1082919"></a>On the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1082947"></a>Select <em>sampled(jitter) </em>from the <em>Noise Type</em> drop-down list.<br />
<a id="pgfId-1082926"></a><br /><div class="webflare-div-image">
<img width="609" height="469" src="images/Chap3-367.gif" /></div></li><li>
<a id="pgfId-1411463"></a>Select the output net.</li><li>
<a id="pgfId-1323692"></a>In the <em>Threshold Value</em> field, specify the voltage for instantaneous noise measurement. If you are not sure of the appropriate voltage, run the hb analysis, and plot the timedomain waveform for the output node(s).</li><li>
<a id="pgfId-1435466"></a>(Optional) Specify <em>Sleep Time</em>, which is the length of time that Spectre will wait before checking for the crossing event in hbnoise sampled(jitter) analysis.</li><li>
<a id="pgfId-1323698"></a>Select a value from the <em>Edge Direction</em> drop-down list.</li><li>
<a id="pgfId-1411499"></a>Select <em>Enabled</em>.</li><li>
<a id="pgfId-1411529"></a>Run the simulation.</li><li>
<a id="pgfId-1427458"></a>After the simulation completes, select <em>Results - Direct Plot - Main Form.</em><br /><div class="webflare-div-image">
<img width="660" height="453" src="images/Chap3-368.gif" /></div></li><li>
<a id="pgfId-1411617"></a>Select <em>hbnoise sampled</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1411656"></a>If you ran multiple analyses, select the appropriate run from the <em>Measurement Selection</em> drop-down list.</li><li>
<a id="pgfId-1411771"></a>Select <em>Edge Phase Noise</em> for the <em>Function</em> section.</li><li>
<a id="pgfId-1411805"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1427568"></a>The waveform appears. Note that this is single sideband phase noise.<br /><div class="webflare-div-image">
<img width="662" height="454" src="images/Chap3-369.gif" /></div></li></ol>





















<h2>
<a id="pgfId-1323701"></a>Examples</h2>
<h3>
<a id="pgfId-1084755"></a>Driven Circuit Noise Setup</h3>

<p>
<a id="pgfId-1084756"></a>First, set up the harmonic balance analysis. For more information, see the Harmonic Balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1263356"></a></p>
<div class="webflare-div-image">
<img width="488" height="811" src="images/Chap3-370.gif" /></div>

<p>
<a id="pgfId-1132702"></a>On the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1066851"></a>Specify the output frequency range of your circuit.<br />
<a id="pgfId-1066855"></a><div class="webflare-div-image">
<img width="636" height="237" src="images/Chap3-371.gif" /></div></li><li>
<a id="pgfId-1066856"></a>If you use log spacing, set about 3 to 5 points per decade in the <em>Points Per Decade</em> field.</li><li>
<a id="pgfId-1066857"></a>In hbnoise, and pnoise or qpnoise when Harmonic Balance is set for the pss or qpss engine, you can leave the <em>Maximum sideband</em> field blank. Then, all the mixing products from the large-signal analysis will be considered.<br />
<a id="pgfId-1066861"></a><div class="webflare-div-image">
<img width="636" height="89" src="images/Chap3-372.gif" /></div></li><li>
<a id="pgfId-1412603"></a>If you want a noise figure calculation, select the <em>Noise Figure</em> check box.</li><li>
<a id="pgfId-1066862"></a>Select the resistor or port component used for the load resistance. This excludes the noise from this component for the noise figure calculation, but keeps it for the total noise output calculation.<br />
<a id="pgfId-1066866"></a><div class="webflare-div-image">
<img width="636" height="221" src="images/Chap3-373.gif" /></div></li><li>
<a id="pgfId-1356781"></a>If you want a noise figure calculation, you must use a port as the input for the circuit. Set the instance name.<br />
<a id="pgfId-1356785"></a></li><li>
<a id="pgfId-1356786"></a>The easiest way to select the reference sideband is to set it to choose <em>Select from list</em>.<br />
<a id="pgfId-1066876"></a><div class="webflare-div-image">
<img width="636" height="202" src="images/Chap3-374.gif" /></div></li><li>
<a id="pgfId-1066877"></a>Specify the passband frequency range that you want for the noise figure and input-referred noise calculations.</li><li>
<a id="pgfId-1066882"></a>If you want to see the noise contributions from the individual frequencies and the different device noise calculations individually on the output of the noise analysis, enable noise separation.<br />
<a id="pgfId-1066886"></a><div class="webflare-div-image">
<img width="636" height="217" src="images/Chap3-375.gif" /></div></li><li>
<a id="pgfId-1066887"></a>When you are done with the setup, run the simulation. </li></ol>

































<h4>
<a id="pgfId-1083018"></a><a id="98934"></a>Noise Sum<a id="marker-1300600"></a>mary</h4>

<p>
<a id="pgfId-1365768"></a>The noise summary provides information about the devices that contribute noise to the output. It supports all USB, LSB, AM and PM noise. This information is available any time an hbnoise simulation completes.</p>
<p>
<a id="pgfId-1365769"></a>In ADE Explorer, select <em>Results</em> - <em>Print</em> - <em>Noise Summary</em>. You will see the following options depending on the selection you have made for <em>Noise Type</em> in the hbnoise Choosing Analysis form</p>
<p>
<a id="pgfId-1379642"></a><em>hbnoise_am</em> - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>AM</em> or <em>ALL(AM.PM.USB,LSB)</em> as the contribution type. <em>hbnoise_am</em> has information about the amplitude modulated noise.</p>
<p>
<a id="pgfId-1379651"></a><em>hbnoise_pm</em> - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>PM</em> or <em>ALL(AM.PM.USB,LSB)</em> as the contribution type. <em>hbnoise_pm</em> as information about the phase modulated noise.</p>
<p>
<a id="pgfId-1379682"></a><em>hbnoise_usb</em> - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>USB</em> or <em>ALL(AM.PM.USB,LSB)</em> as the contribution type. <em>hbnoise_usb</em> has information about the total noise from frequencies above the output frequency.</p>
<p>
<a id="pgfId-1379713"></a><em>hbnoise_lsb</em> - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>ALL(AM.PM.USB,LSB)</em> as the contribution type. <em>hbnoise_lsb</em> has information about the total noise from frequencies above the output frequency. </p>
<p>
<a id="pgfId-1379751"></a>If noise separation is enabled, an additional <em>hbnoise_src</em> option will be added along with the above options. <em>hbnoise_src</em> has information about the noise currents at the individual noise sources at the noise source. </p>
<p>
<a id="pgfId-1083047"></a>If you want the noise contributors at a single frequency, select <em>spot noise</em>. If you want to have the noise integrated over a frequency range, select <em>integrated noise</em>.</p>
<p>
<a id="pgfId-1083049"></a>If you want noise in volts, set the <em>noise unit</em> to <em>V.</em></p>
<p>
<a id="pgfId-1379955"></a>You can choose a value from the <em>hierarchy level</em> drop down box to view the noise contributions from all noise sources within each instance at the specified level of hierarchy.</p>
<p>
<a id="pgfId-1083051"></a>Generally, <em>Include All Types</em> should be selected. If you just want the noise from specific types of noise generators, you can select them from the list.</p>
<p>
<a id="pgfId-1083053"></a>Truncate just applies to the list. The total input and output-referred noise at the bottom of the noise summary output always includes all the noise from everything in the circuit.</p>
<p>
<a id="pgfId-1250423"></a>The figure below is the noise summary window with the sort being noise contributors. Then there are three windows that show the three different sorted outputs.</p>

<p>
<a id="pgfId-1263452"></a></p>
<div class="webflare-div-image">
<img width="659" height="576" src="images/Chap3-376.gif" /></div>

<p>
<a id="pgfId-1172771"></a>The output below shows the noise summary sorted by noise contributors. The largest noise contributor is on the top of the list.</p>

<p>
<a id="pgfId-1083118"></a></p>
<div class="webflare-div-image">
<img width="632" height="644" src="images/Chap3-377.gif" /></div>

<p>
<a id="pgfId-1173777"></a>The output below shows the noise summary sorted by composite noise. The largest total noise instance is on the top of the list, and the individual noise contributors for that component are shown below the instance name.</p>

<p>
<a id="pgfId-1083141"></a></p>
<div class="webflare-div-image">
<img width="650" height="729" src="images/Chap3-378.gif" /></div>

<p>
<a id="pgfId-1174120"></a>The output below shows the noise summary sorted by device name. The devices are listed in alphabetical order.</p>

<p>
<a id="pgfId-1083167"></a></p>
<div class="webflare-div-image">
<img width="619" height="640" src="images/Chap3-379.gif" /></div>

<p>
<a id="pgfId-1133009"></a>For all of the noise summaries, here is a table of the abbreviations used in the <em>Param</em> column:</p>
<p>
<a id="pgfId-1133010"></a><strong>Resistor and Inductor</strong>:</p>

<p>
<a id="pgfId-1133024"></a></p>
<table class="webflareTable" id="#id1133011">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133013">
<a id="pgfId-1133013"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133015">
<a id="pgfId-1133015"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133017"></a><code>rn</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133019"></a>resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133021"></a><code>fn</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133023"></a>Flicker noise</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1133025"></a><strong>Diode</strong>:</p>

<p>
<a id="pgfId-1133039"></a></p>
<table class="webflareTable" id="#id1133026">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133028">
<a id="pgfId-1133028"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133030">
<a id="pgfId-1133030"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133032"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133034"></a>Diode current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133036"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133038"></a>Series parasitic resistor noise</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1133040"></a><strong>Gummel-Poon BJT</strong>:</p>

<p>
<a id="pgfId-1133070"></a></p>
<table class="webflareTable" id="#id1133041">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1263879">
<a id="pgfId-1263879"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1263881">
<a id="pgfId-1263881"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263883"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263885"></a>Flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263887"></a>ic</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263889"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263891"></a>ib</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263893"></a>Base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263895"></a>rc</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263897"></a>Thermal noise from the collector parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263899"></a>rb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263901"></a>Thermal noise from the base parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263903"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1263905"></a>Thermal noise from the emitter parasitic resistor</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1268567"></a><strong>HiCUM</strong>:</p>

<p>
<a id="pgfId-1268601"></a></p>
<table class="webflareTable" id="#id1268568">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1268570">
<a id="pgfId-1268570"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1268572">
<a id="pgfId-1268572"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268574"></a>ib</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268576"></a>Base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268578"></a>ic</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268580"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268582"></a>rbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268584"></a>Thermal noise from the internal base parasitic resistor (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268586"></a>rbx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268588"></a>Thermal noise from the external base parasitic resistor (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268590"></a>rcx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268592"></a>Collector parasitic resistor thermal noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268594"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268596"></a>Emitter parasitic resistor thermal noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268598"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268600"></a>Flicker noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 3-1
<a id="pgfId-1268632"></a>HiCUM Schematic Diagram</strong></p>
<p>
<a id="pgfId-1268605"></a></p>
<div class="webflare-div-image">
<img width="674" height="470" src="images/Chap3-380.gif" /></div>

<p>
<a id="pgfId-1133110"></a><strong>VBIC</strong>:</p>

<p>
<a id="pgfId-1133168"></a></p>
<table class="webflareTable" id="#id1133111">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133113">
<a id="pgfId-1133113"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133115">
<a id="pgfId-1133115"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133117"></a>rbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133119"></a>Thermal noise in resistor Rbi (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133121"></a>rbx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133123"></a>Thermal noise in resistor Rbx (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133125"></a>rci</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133127"></a>Thermal noise in resistor Rci (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133129"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133131"></a>Thermal noise in resistor Re (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133133"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133135"></a>Thermal noise in resistor Rs (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133137"></a>itzf</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133139"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133141"></a>ibe</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133143"></a>Total base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133145"></a>ibex</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133147"></a>Node Bx to E base current shot noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133149"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133151"></a>Ibe flicker noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133153"></a>fnx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133155"></a>Ibex flicker noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133157"></a>iccp</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133159"></a>Parasitic transport collector to emitter current noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133161"></a>ibep</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133163"></a>Parasitic transport base to emitter current noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133165"></a>fnp</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133167"></a>Ibep flicker Noise (See diagram below)</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 3-2
<a id="pgfId-1268642"></a>VBIC Schematic Diagram</strong></p>
<p>
<a id="pgfId-1133486"></a></p>
<div class="webflare-div-image">
<img width="665" height="630" src="images/Chap3-381.gif" /></div>

<p>
<a id="pgfId-1133487"></a><strong>BSIM3</strong>:</p>

<p>
<a id="pgfId-1133509"></a></p>
<table class="webflareTable" id="#id1133488">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133490">
<a id="pgfId-1133490"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133492">
<a id="pgfId-1133492"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133494"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133496"></a>Flicker Noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133498"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133500"></a>Thermal noise from the resistive drain current</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133502"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133504"></a>Thermal noise from the source parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133506"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133508"></a>Thermal noise from the drain parasitic resistor</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1133510"></a><strong>BSIM4</strong>:</p>

<p>
<a id="pgfId-1133568"></a></p>
<table class="webflareTable" id="#id1133511">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133513">
<a id="pgfId-1133513"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133515">
<a id="pgfId-1133515"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133517"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133519"></a>Flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133521"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133523"></a>Thermal noise from the resistive drain current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133525"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133527"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133529"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133531"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133533"></a>igd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133535"></a>Gate-to-drain tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133537"></a>igs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133539"></a>Gate-to-source tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133541"></a>igb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133543"></a>Gate-to-bulk tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133545"></a>rbdb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133547"></a>Resistor thermal noise between dbNode and bNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133549"></a>rbpb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133551"></a>Resistor thermal noise between bNode and bNodePrime (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133553"></a>rbpd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133555"></a>Resistor thermal noise between Bulk and dbNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133557"></a>rbps</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133559"></a>Resistor thermal noise between bulk and bNode prime</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133561"></a>rbsb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133563"></a>Resistor thermal noise between sbNode and bNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133565"></a>rgbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133567"></a>Gate Bias-Independent Resistor thermal noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 3-3
<a id="pgfId-1268652"></a>BSIM4 Schematic Diagrams</strong></p>
<p>
<a id="pgfId-1133572"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/intrinsic.GIF" /></div>
<p>
<a id="pgfId-1133576"></a></p>
<div class="webflare-div-image">
<img width="597" height="316" src="images/Chap3-383.gif" /></div>

<p>
<a id="pgfId-1133577"></a><strong>PSP-103</strong></p>

<p>
<a id="pgfId-1133643"></a></p>
<table class="webflareTable" id="#id1133578">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133580">
<a id="pgfId-1133580"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1133582">
<a id="pgfId-1133582"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133584"></a>sfl</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133586"></a>Channel current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133588"></a>sth</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133590"></a>Channel current thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133592"></a>sig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133594"></a>induced gate noise at 1 Hz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133596"></a>sigth</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133598"></a>Induced gate noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133600"></a>shotgd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133602"></a>Gate current shot noise from gate to drain</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133604"></a>shotgs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133606"></a>Gate current shot noise from gate to source</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133608"></a>sjnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133610"></a>Source to Bulk leakage current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133612"></a>djnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133614"></a>Drain to Bulk leakage and avalanche current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133616"></a>rgatenoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133618"></a>Gate resistance thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133620"></a>rbulknoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133622"></a>Bulk resistor thermal noise between node BP and BI (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133624"></a>rjnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133626"></a>Source side bulk resistor thermal noise between node BI and BS (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133628"></a>rjundnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133630"></a>Drain side bulk resistor thermal noise between node BI and BD (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133632"></a>rwellnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133634"></a>Well resistor thermal noise between node BI and B (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133636"></a>rsourcenoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133638"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133640"></a>rdrainnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1133642"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 3-4
<a id="pgfId-1268668"></a>PSP-103 Schematic Diagram</strong></p>
<p>
<a id="pgfId-1133647"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/psp103_43.gif" /></div>

<p>
<a id="pgfId-1268692"></a>EKV<strong> 3.0</strong></p>

<p>
<a id="pgfId-1268746"></a></p>
<table class="webflareTable" id="#id1268693">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1268695">
<a id="pgfId-1268695"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1268697">
<a id="pgfId-1268697"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268699"></a>fn_id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268701"></a>Channel current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268703"></a>fn_ig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268705"></a>Gate current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268707"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268709"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268711"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268713"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268715"></a>rg</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268717"></a>Gate parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268719"></a>rsb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268721"></a>Thermal noise for the substrate resistor connected between BSi and B. (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268723"></a>rdb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268725"></a>Thermal noise for the substrate resistor connected between BDi and B. (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268727"></a>rbbs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268729"></a>Thermal noise for the substrate resistor connected between BSi and Bi. (See diagram below where it is labeled RDSB/2)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268731"></a>rbbd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268733"></a>Thermal noise for the substrate resistor connected between BDi and Bi. (See diagram below where it is labeled RDSB/2)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268735"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268737"></a>Thermal noise of the channel resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268739"></a>cor</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268741"></a>Induced gate noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268743"></a>shot_ig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1268745"></a>Gate current shot noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 3-5
<a id="pgfId-1268764"></a>EKV 3.0 Schematic Diagrams</strong></p>
<p>
<a id="pgfId-1268790"></a></p>
<div class="webflare-div-image">
<img src="images/Chap3E/27_1.GIF" /></div>

<p>
<a id="pgfId-1133648"></a>For other model types:</p>
<ol><li>
<a id="pgfId-1133649"></a>In a UNIX/LINUX shell window type <code>which spectre</code>.<br />
<a id="pgfId-1133650"></a>This should return a path that ends in <code>/bin/spectre</code>.</li><li>
<a id="pgfId-1133651"></a>Triple-click the line with the path, and then click the center mouse button to enter it as a command.</li><li>
<a id="pgfId-1133652"></a>Use the backspace key, and delete the word <code>spectre</code>.</li><li>
<a id="pgfId-1133653"></a>Type <code>cdnshelp</code> at the end of the expression, and press <code>Enter</code>.<br />
<a id="pgfId-1133654"></a>A browser window will be displayed.</li><li>
<a id="pgfId-1133655"></a>Close the <em>Tip of the day</em> window.</li><li>
<a id="pgfId-1133656"></a>At the top, you should see the release number of the simulator you are using.</li><li>
<a id="pgfId-1133657"></a>Click the plus sign (+) to the left of the <em>MMSim</em> folder.</li><li>
<a id="pgfId-1133658"></a>Click the plus sign (+) to the left of the <em>Spectre Circuit Simulator Components and Device Models Reference</em> folder.</li><li>
<a id="pgfId-1133659"></a>Select the device type you are using.</li><li>
<a id="pgfId-1133660"></a>At the bottom of that device listing, you will see <em>Component Statements</em>. Double-click on this.</li><li>
<a id="pgfId-1133661"></a>Enter the name of the parameter in the search box in the right pane of the cdnshelp window.</li><li>
<a id="pgfId-1133662"></a>Click the down arrow to the right of the <em>Find</em> field until you see the parameter name in the pane on the right side, and then see the definition of that parameter.</li></ol>














<h4>
<a id="pgfId-1174242"></a>Plotting Noise Figure</h4>

<p>
<a id="pgfId-1066889"></a>On the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1066893"></a></p>
<div class="webflare-div-image">
<img width="668" height="608" src="images/Chap3-386.gif" /></div>

<ol><li>
<a id="pgfId-1066894"></a>Select hbNoise from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1066895"></a>Select the desired type of noise plot from the <em>Function</em> section.</li><li>
<a id="pgfId-1066896"></a>If you want the noise figure over a specified bandwidth, check the <em>Integrated Over Bandwidth</em> checkbox.</li><li>
<a id="pgfId-1066897"></a>Specify the frequency range you want for the noise figure calculation.</li><li>
<a id="pgfId-1066898"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1066899"></a>The dsb noise figure and the noise figure calculation over your bandwidth are displayed. <br /><div class="webflare-div-image">
<img width="664" height="442" src="images/Chap3-387.gif" /></div></li></ol>







<h4>
<a id="pgfId-1066904"></a>Viewing noise separation results</h4>
<h4>
<a id="pgfId-1083234"></a>Viewing the total noise at the output from a single noise input frequency</h4>

<p>
<a id="pgfId-1134376"></a>This capability allows the noise from all sources in the circuit at different noise input frequencies to be measured. For example, all the noise that does not change frequency (the zero sideband) can be plotted, along with the other noise input frequencies (sidebands). This plotting capability allows problem frequencies to be identified.</p>
<p>
<a id="pgfId-1066905"></a>On the <em>Direct Plot Form</em>:</p>

<p class="webflare-indent1">
<a id="pgfId-1066909"></a></p>
<div class="webflare-div-image">
<img width="636" height="778" src="images/Chap3-388.gif" /></div>

<ol><li>
<a id="pgfId-1066910"></a>Select <em>hbnoise separation</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1380094"></a>Select the noise type from the <em>Noise Type</em> section. By default, <em>USB</em> is selected.</li><li>
<a id="pgfId-1066911"></a>To view the total noise at the output select <em>Sideband Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066912"></a>Select <em>V/sqrt(Hz)</em> or <em>v**2/Hz</em> from the <em>Signal</em> <em>Level</em> radio buttons.</li><li>
<a id="pgfId-1066913"></a>Select the appropriate modifier from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1066914"></a>Select the sideband number form the <em>Output Sideband </em>list. 0 means no frequency translation.</li><li>
<a id="pgfId-1066915"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1066920"></a><div class="webflare-div-image">
<img width="636" height="430" src="images/Chap3-389.gif" /></div>
<a id="pgfId-1083271"></a>The output noise from sideband zero is plotted. This is the noise that is present at the output with no frequency translations included.</li></ol>












<h4>
<a id="pgfId-1066921"></a>Plotting Noise from S<a id="marker-1300619"></a>ideband -1</h4>

<p>
<a id="pgfId-1066922"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1066923"></a>Select the -1 sideband from the <em>Output Sideband</em> list. -1 means the noise frequency is shifted down in frequency by -1*first harmonic of hb from the frequency that is specified as the noise output frequency in the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1066927"></a><div class="webflare-div-image">
<img width="488" height="749" src="images/Chap3-390.gif" /></div></li><li>
<a id="pgfId-1066928"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1066936"></a><div class="webflare-div-image">
<img width="636" height="410" src="images/Chap3-391.gif" /></div>
<a id="pgfId-1066938"></a>As a suggestion, use the <em>Graph</em> - <em>Add Label</em> menu option to place labels in order to identify the traces. <br />
<a id="pgfId-1083341"></a><div class="webflare-div-image">
<img width="668" height="412" src="images/Chap3-392.gif" /></div><div class="webflare-information-macro webflare-macro-tip">
<a id="pgfId-1134620"></a>
If you select multiple sidebands to be plotted at the same time, the sideband number will be shown at the right side of the legend in the waveform window.</div>
<a id="pgfId-1134624"></a><div class="webflare-div-image">
<img width="510" height="691" src="images/Chap3-394.gif" /></div>
<a id="pgfId-1134629"></a><div class="webflare-div-image">
<img width="641" height="367" src="images/Chap3-395.gif" /></div></li></ol>


















<h4>
<a id="pgfId-1066939"></a>Viewing total noise at <a id="marker-1300643"></a>the output from each instance</h4>

<p>
<a id="pgfId-1135453"></a>Once the problem frequencies are identified in the plot of <em>Sideband Output</em>, the problem components need to be identified. From the previous plot, the zero sideband contributes the largest amount of noise to the overall output noise. Using the <em>Instance Output</em> option allows the identification of which components in the zero sideband contribute the most noise. The total noise for all the noise mechanisms within the component is plotted.</p>
<p>
<a id="pgfId-1066940"></a>On the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1066944"></a></p>
<div class="webflare-div-image">
<img width="668" height="766" src="images/Chap3-396.gif" /></div>

<ol><li>
<a id="pgfId-1066945"></a>Select <em>Instance Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066946"></a>Select <em>V/sqrt(Hz)</em> or <em>v**2/Hz</em>.</li><li>
<a id="pgfId-1066947"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1066948"></a>Select the sideband number.</li><li>
<a id="pgfId-1066949"></a>Select the type of component to display.</li><li>
<a id="pgfId-1163175"></a>If you want every noise source to be considered, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1163176"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances that you want to exclude from the plot.</li><li>
<a id="pgfId-1066954"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1163159"></a>Specify the number of results you want to plot.</li><li>
<a id="pgfId-1066955"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1066956"></a>The total noise at the output for the top three BJTs is plotted. <br />
<a id="pgfId-1066960"></a><div class="webflare-div-image">
<img width="637" height="386" src="images/Chap3-397.gif" /></div>
<a id="pgfId-1083450"></a>To see which transistor goes with which trace, click the plus sign (highlighted in red on the previous graphic) to the left or the text at the upper left of the display area. The legends expand, and you can see which trace is which in the <em>Name</em> field on the left side of the display tool. You can also either select the trace or the individual entry in the <em>Name</em> field and the trace and legend will highlight.<br />
<a id="pgfId-1083484"></a><div class="webflare-div-image">
<img width="668" height="386" src="images/Chap3-398.gif" /></div></li></ol>


















<h4>
<a id="pgfId-1066961"></a>Viewing the exact noise mechanism within the devices</h4>

<p>
<a id="pgfId-1135681"></a>The sideband with the largest contribution was determined by selecting <em>Sideband Output</em> and plotting. The specific component was identified by selecting <em>Instance Output</em>. The specific noise mechanisms can be identified using <em>Source output</em>. This plots the largest individual noise mechanisms for the sideband you select.</p>
<p>
<a id="pgfId-1066962"></a>On the<em> Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1066966"></a></p>
<div class="webflare-div-image">
<img width="670" height="799" src="images/Chap3-399.gif" /></div>

<ol><li>
<a id="pgfId-1093857"></a>Select <em>Source Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1093858"></a>Select <em>V/sqrt(Hz)</em> or <em>v**2/Hz</em>.</li><li>
<a id="pgfId-1093859"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1164325"></a>Select the sideband number.</li><li>
<a id="pgfId-1164326"></a>Select the type of component to display.</li><li>
<a id="pgfId-1163854"></a>If you want every noise source to be considered, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1163855"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1163856"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1066976"></a>If you want to restrict to one device, put its instance name in the <em>include inst</em> field. A list of devices separated by a space is also acceptable.</li><li>
<a id="pgfId-1066977"></a>If you want to exclude a device (or devices) enter the instance name(s) in the <em>exclude inst</em> field.</li><li>
<a id="pgfId-1066978"></a>Specify the number of results you want to plot in the <em>by top </em>field.</li><li>
<a id="pgfId-1066979"></a>Click <em>Plot.</em><br />
<a id="pgfId-1066980"></a>The exact noise mechanism within the devices is plotted. To see which noise source goes with which trace, select the plus sign to the left or the text at the upper left of the display area. The legends will be shown individually in the <em>Name</em> field of the waveform tool. The device name and the individual noise contributor will be shown. You can select either the individual legend or the trace and both the legend and the trace will highlight. For a list of the noise parameters for the different device types, see the list beginning just after the noise summary.<br />
<a id="pgfId-1365759"></a><div class="webflare-div-image">
<img width="668" height="379" src="images/Chap3-400.gif" /></div><ul><li>
<a id="pgfId-1365760"></a>The base current shot noise is in green.</li><li>
<a id="pgfId-1365761"></a>The base parasitic resistance is yellow.</li><li>
<a id="pgfId-1365745"></a>The flicker noise is red.</li></ul></li></ol>




















<h4>
<a id="pgfId-1365735"></a>Viewing the total noise currents within the devices</h4>
<p>
<a id="pgfId-1135971"></a></p>
<div class="webflare-div-image">
<img width="421" height="765" src="images/Chap3-401.gif" /></div>

<p>
<a id="pgfId-1135973"></a>This capability has limited value. All the noise currents from all the noise mechanisms within the instance are added up. No gain function is applied or are available for this measurement. It just adds up everything within that instance.</p>

<ol><li>
<a id="pgfId-1135974"></a>Select <em>Instance source</em>.</li><li>
<a id="pgfId-1135975"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the Signal Level selection.</li><li>
<a id="pgfId-1135976"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1135977"></a>Select the sideband number.</li><li>
<a id="pgfId-1135978"></a>If you want every noise source to be considered, select I<em>nclude All Types</em>.</li><li>
<a id="pgfId-1135979"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1135980"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1135981"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1135982"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1135986"></a>The frequency response curves are displayed.<br />
<a id="pgfId-1264451"></a><div class="webflare-div-image">
<img width="637" height="400" src="images/Chap3-402.gif" /></div></li></ol>













<h4><em>
<a id="pgfId-1135987"></a>Plotting the individual noise source currents</em></h4>
<p>
<a id="pgfId-1135991"></a></p>
<div class="webflare-div-image">
<img width="384" height="767" src="images/Chap3-403.gif" /></div>

<p>
<a id="pgfId-1135992"></a>This capability plots the individual noise currents within the device. it gives you the noise at the source instead of at the output of the simulation. This enables you to identify the largest individual noise sources in the circuit. Note that the largest noise source in the circuit may not contribute the largest noise at the output of the circuit. It depends on the relative gains from the individual sources to the output. These gain functions are available, and are shown in the next section.</p>

<ol><li>
<a id="pgfId-1135993"></a>Select <em>Primary Source</em>.</li><li>
<a id="pgfId-1135994"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the <em>Signal Level</em> section.</li><li>
<a id="pgfId-1135995"></a>Select <em>Magnitude</em> or <em>dB20</em> in the Modifier section.</li><li>
<a id="pgfId-1135996"></a>Select the sideband number.</li><li>
<a id="pgfId-1135997"></a>If you want every noise source to be considered, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1135998"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1135999"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst.</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1136000"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1136001"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1136002"></a>The frequency response curves are displayed.<br />
<a id="pgfId-1136006"></a><div class="webflare-div-image">
<img width="626" height="372" src="images/Chap3-404.gif" /></div>
<a id="pgfId-1136007"></a>For a list of the noise parameter names, please see the table under the section <a href="Chap3.html#98934">Noise Summary</a>.</li></ol>
















<h4><em>
<a id="pgfId-1136008"></a>Plotting the gain from the individual noise sources to the output</em></h4>
<p>
<a id="pgfId-1136012"></a></p>
<div class="webflare-div-image">
<img width="349" height="768" src="images/Chap3-405.gif" /></div>

<p>
<a id="pgfId-1136013"></a>This capability gives the gain from the individual noise currents to the output of the circuit. The noise current from the previous section times the gain that is plotted in this section gives the noise at the output of the circuit.</p>

<ol><li>
<a id="pgfId-1136014"></a>Select <em>Source Noise Gain</em>.</li><li>
<a id="pgfId-1136015"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the <em>Signal Level</em> section.</li><li>
<a id="pgfId-1136016"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1136017"></a>Select the sideband number.</li><li>
<a id="pgfId-1136018"></a>If you want every noise source to be considered, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1136019"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1136020"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst.</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1136021"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1136022"></a>Click <em>Plot</em>.</li></ol>









<p>
<a id="pgfId-1365722"></a>The frequency response curves are displayed. For a list of the abbreviations used for the noise parameters, please see <a href="Chap3.html#98934">Noise Summary</a>.</p>

<p>
<a id="pgfId-1365719"></a></p>
<div class="webflare-div-image">
<img width="663" height="422" src="images/Chap3-406.gif" /></div>
<h4>
<a id="pgfId-1083586"></a>Multiple hb<a id="marker-1300780"></a>noise</h4>

<p>
<a id="pgfId-1365707"></a>Multiple hbnoise allows multiple pnoise analyses to be run after a harmonic balance simulation so that you can characterize the noise at several points in your circuit. For example, in an LNA-Mixer circuit, you might want to characterize the noise at the LNA output and at the output of the mixer. Multiple hbnoise allows these analyses to be run without needing multiple simulations.</p>
<p>
<a id="pgfId-1365709"></a>Consider an LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1096740"></a></p>
<div class="webflare-div-image">
<img width="668" height="545" src="images/Chap3-407.gif" /></div>

<p>
<a id="pgfId-1096773"></a>In the above circuit, there are two outputs that need to be measured. The first is at the LNA output, and the second is at the mixer output. The noise frequencies are different at the two outputs.</p>
<p>
<a id="pgfId-1137458"></a>First, set up the harmonic balance analysis. For more information, see the Harmonic Balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1264724"></a></p>
<div class="webflare-div-image">
<img width="440" height="779" src="images/Chap3-408.gif" /></div>

<p>
<a id="pgfId-1137459"></a>In the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1096809"></a>Select <em>Multiple hbnoise</em>, and set up the noise analysis for one of the outputs. The mixer output is shown below.<br />
<a id="pgfId-1096840"></a><div class="webflare-div-image">
<img width="668" height="730" src="images/Chap3-409.gif" /></div></li><li>
<a id="pgfId-1096879"></a>Select the second line in the multiple hbnoise section and set up that analysis.<br />
<a id="pgfId-1096907"></a><div class="webflare-div-image">
<img width="668" height="799" src="images/Chap3-410.gif" /></div></li><li>
<a id="pgfId-1096847"></a>Run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct plot</em> - <em>Main Form</em>. When multiple hbnoise is run, the <em>Direct Plot Form</em> adds the ability to select which hbnoise results to plot. This is the purpose of the Multiple Out selection.<br />
<a id="pgfId-1096957"></a><div class="webflare-div-image">
<img width="668" height="450" src="images/Chap3-411.gif" /></div></li><li>
<a id="pgfId-1096964"></a>Click <em>Plot</em>. The single-sideband noise figure measurement for the LNA is shown below.<br />
<a id="pgfId-1096988"></a><div class="webflare-div-image">
<img width="668" height="431" src="images/Chap3-412.gif" /></div></li><li>
<a id="pgfId-1097013"></a>To plot the noise figure of the overall circuit, set the <em>Multiple Out</em> selection to the Mixer output at Port2. For direct conversion, usually double-sideband noise figure is desired.<br />
<a id="pgfId-1097046"></a><div class="webflare-div-image">
<img width="668" height="480" src="images/Chap3-413.gif" /></div></li><li>
<a id="pgfId-1097053"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1097089"></a>The waveform tool shows the noise figure curve and the integrated noise figure to 1MHz.<br />
<a id="pgfId-1097118"></a><div class="webflare-div-image">
<img width="668" height="435" src="images/Chap3-414.gif" /></div></li></ol>





























<h4>
<a id="pgfId-1083535"></a>Noise as a Function of Blocker Power</h4>

<p>
<a id="pgfId-1174853"></a>This is a classic desensitization measurement that measures noise figure as the blocker amplitude gets large. In order to accomplish this, variables need to be added to the RF source so that the input power of the blocker can be easily swept. The RF power in dBm is set by the variable prf in the following properties list.</p>

<p>
<a id="pgfId-1331905"></a></p>
<div class="webflare-div-image">
<img width="670" height="742" src="images/Chap3-415.gif" /></div>

<ul><li>
<a id="pgfId-1331906"></a>Note that the source has two large-signal tones set up.</li><li>
<a id="pgfId-1331907"></a>The first large-signal tone has the frequency set to the variable <span class="webflare-courier-new" style="white-space:pre"><em>fb1</em></span> and the amplitude set to <span class="webflare-courier-new" style="white-space:pre"><em>prf</em></span>.</li><li>
<a id="pgfId-1066995"></a>The second tone has the frequency set to the variable <span class="webflare-courier-new" style="white-space:pre"><em>fb2</em></span> and the amplitude set to <span class="webflare-courier-new" style="white-space:pre"><em>prf</em></span>. Either of the variables can be used to set the blocker frequency.</li></ul>


<p>
<a id="pgfId-1066996"></a>To measure the noise as a function of blocker power:</p>
<ol><li>
<a id="pgfId-1066997"></a>Apply the signals that cause the large-signal effects in the harmonic balance (hb) analysis, and then run an hbNoise analysis.<br /><div class="webflare-div-image">
<img width="662" height="386" src="images/Chap3-416.gif" /></div><ul><li>
<a id="pgfId-1067002"></a>The LO is set to 2.4GHz. This is highlighted in red above.</li><li>
<a id="pgfId-1067007"></a>The first RF is set to 2.5G and -30 dBm. This is highlighted in blue above. This is the blocking signal.</li><li>
<a id="pgfId-1093907"></a>The second RF tone is disabled by setting its frequency to zero. <br />
<a id="pgfId-1297440"></a>In this case, the frequency set by <code>fb1</code> is the blocker. On the hb <em>Choosing Analyses</em> form:<br /><div class="webflare-div-image">
<img width="667" height="782" src="images/Chap3-417.gif" /></div></li></ul></li><li>
<a id="pgfId-1067022"></a>Set up the hb analysis appropriately.<br />
<a id="pgfId-1067023"></a>Because the RF power will be quite high, the number of RF harmonics is higher than normal to preserve the accuracy.</li><li>
<a id="pgfId-1067024"></a>Sweep the RF power over an appropriate range.<br />
<a id="pgfId-1250529"></a>An appropriate range depends on what you are designing. Generally, you start about 15 to 25dB smaller than the compression point, and stop the sweep near the compression point. On the hbnoise <em>Choosing Analyses</em> form:<br />
<a id="pgfId-1067029"></a><div class="webflare-div-image">
<img width="670" height="795" src="images/Chap3-418.gif" /></div></li><li>
<a id="pgfId-1067030"></a>Usually, a single frequency is run in hbnoise, when the blocker power is swept. This is done to allow the direct plot functions to work properly after the simulation.</li><li>
<a id="pgfId-1067031"></a>Specify the desired output frequency.</li><li>
<a id="pgfId-1067032"></a>For <em>Maximum sideband</em>, either leave the field blank which causes SpectreRF to calculate all the noise mixing frequencies from all the harmonics set in the hb <em>Choosing Analyses</em> form, or specify the same number that is used to set the highest number of harmonics in the hb <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1365703"></a>The rest of the properties are set up as they would be in a normal simulation. Once you have finished setting up the hb and hbnoise <em>Choosing Analyses</em> forms, run the simulation.</li><li>
<a id="pgfId-1365704"></a>When the simulation completes, select <em>Results - Direct Plot - Main Form</em> in ADE Explorer.<br />
<a id="pgfId-1365700"></a><div class="webflare-div-image">
<img width="637" height="559" src="images/Chap3-419.gif" /></div></li><li>
<a id="pgfId-1067040"></a>Select the desired noise figure measurement.</li><li>
<a id="pgfId-1067041"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1067042"></a>The resulting plot appears. <br />
<a id="pgfId-1067046"></a><div class="webflare-div-image">
<img width="637" height="398" src="images/Chap3-420.gif" /></div></li><li>
<a id="pgfId-1067047"></a>To make the plot more useful, right-click one of the numbers on the X Axis and select <em>Swap Sweep Var</em> from the context menu.<br />
<a id="pgfId-1083672"></a>The <em>Swap Sweep Var</em> window is displayed. Note that the <em>Sweep Variables</em> field is set to <em>prf</em>, which is the variable that was swept.<br />
<a id="pgfId-1365689"></a><div class="webflare-div-image">
<img width="668" height="207" src="images/Chap3-421.gif" /></div></li><li>
<a id="pgfId-1365690"></a>Specify a value in the <em>X Value</em> field. This is the frequency of the noise figure measurement and in this example it is 10MHz.</li><li>
<a id="pgfId-1365691"></a>Click <em>OK</em>.<br />
<a id="pgfId-1365692"></a>A new subwindow is displayed with the noise figure on the vertical axis, and the blocker power on the X Axis.<br />
<a id="pgfId-1414000"></a>Select Card mode to display just the right subwindow.<br /><div class="webflare-div-image">
<img width="668" height="422" src="images/Chap3-422.gif" /></div></li></ol>














































<h4>
<a id="pgfId-1365675"></a>Noise Type = sampled(jitter)</h4>

<p>
<a id="pgfId-1428370"></a>Driven jitter is usually used for measuring the noise in a digital circuit at a specific threshold crossing. This is usually the voltage that causes succeeding stages to be clocked.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1428386"></a>To get a correct slope of the waveform n this mode, you must manually specify enough harmonics. Auto harmonics will get you close but might not give you enough harmonics.</div>
<p>
<a id="pgfId-1415188"></a>In the hb Choosing Analyses form:</p>
<ol><li>
<a id="pgfId-1428545"></a>First, set a variable for the number of harmonics. <br /><div class="webflare-div-image">
<img width="467" height="823" src="images/Chap3-423.gif" /></div></li><li>
<a id="pgfId-1415189"></a>Set the variable to a small number in ADE.</li><li>
<a id="pgfId-1428641"></a>Run the simulation. </li><li>
<a id="pgfId-1428647"></a>Plot the timedomain waveform with Add to Outputs selected in the Direct Plot Form.<br /><div class="webflare-div-image">
<img width="664" height="445" src="images/Chap3-424.gif" /></div></li><li>
<a id="pgfId-1415193"></a>Now run a sweep in ADE. <br />
<a id="pgfId-1428707"></a>After the simulation completes, a family of waveforms will be plotted. </li><li>
<a id="pgfId-1428774"></a>Zoom in to the rising and falling edges to see the waveform details.<em></em><br /><div class="webflare-div-image">
<img width="668" height="448" src="images/Chap3-425.gif" /></div><div class="webflare-div-image">
<img width="666" height="439" src="images/Chap3-426.gif" /></div>
<a id="pgfId-1415203"></a>The rising edge needs more harmonics than the falling edge. Approximately 40 harmonics are needed in the example shown above.</li><li>
<a id="pgfId-1429065"></a>Disable the sweep and set the variable to the number of harmonics you determine. <br />
<a id="pgfId-1429111"></a>In the above example, it was set to 40.</li><li>
<a id="pgfId-1415219"></a>On the hbnoise <em>Choosing Analyses</em> form, set the stop frequency as half the input frequency. </li><li>
<a id="pgfId-1429137"></a>Set the start frequency as four decades below the stop frequency. <br />
<a id="pgfId-1429182"></a>About five points per decade is usually sufficient. </li><li>
<a id="pgfId-1429146"></a>Leave the <em>Maximum sideband</em> blank. </li></ol>
























<h4><em>
<a id="pgfId-1415220"></a>Edge Crossing Mode</em></h4>

<p>
<a id="pgfId-1415221"></a>In this mode, you can specify a trigger which is an edge in the circuit. This determines the time in the waveform to make the measurement. The measurement is specified separately in order to allow one waveform to set the time and measure another net at that time. </p>
<ul><li>
<a id="pgfId-1429688"></a>Select <em>Enabled</em>.</li><li>
<a id="pgfId-1429517"></a>Set the <em>Threshold Value</em> set appropriately. </li><li>
<a id="pgfId-1429547"></a>Set <em>Edge Direction</em> to <em>rise</em> or <em>fall</em>.</li><li>
<a id="pgfId-1435504"></a>(Optional) Set <em>Sleep Time</em>, which is the length of time that Spectre will wait before checking for the crossing event in hbnoise sampled(jitter) analysis.<br />
<a id="pgfId-1435567"></a>.<div class="webflare-div-image">
<img width="665" height="757" src="images/Chap3-427.gif" /></div></li></ul>







<p>
<a id="pgfId-1429640"></a>When the simulation completes, use the <em>Direct Plot Form</em> to plot the jitter.</p>
<p>
<a id="pgfId-1433588"></a>For driven circuits, select <em>Jee</em><a id="marker-1415231"></a>, which is edge-to-edge jitter. In the below example, 77p is the rising edge, and 275p is the falling edge.</p>

<p>
<a id="pgfId-1415236"></a></p>
<div class="webflare-div-image">
<img width="668" height="707" src="images/Chap3-428.gif" /></div>

<p>
<a id="pgfId-1415237"></a>The output noise frequency response and the edge-to-edge jitter are displayed. The jee measurement is one standard deviation for the expected jitter.</p>

<p>
<a id="pgfId-1415242"></a></p>
<div class="webflare-div-image">
<img width="667" height="431" src="images/Chap3-429.gif" /></div>
<h4>
<a id="pgfId-1415244"></a>Sampled phase mode</h4>

<p>
<a id="pgfId-1415245"></a>First, plot the timedomain waveform for the net you want to measure. Place markers at the lowest and highest voltage you want to explore.</p>

<div class="webflare-div-image">
<img width="640" height="453" src="images/Chap3-430.gif" /></div>

<p>
<a id="pgfId-1415250"></a>In this case, times from 72psec to 84psec would capture the variation in noise voltage from 1 Volt below the threshold to 1 Volt above the threshold.</p>
<p>
<a id="pgfId-1415251"></a>On the hbnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1415257"></a>Select <em>Sampled Phase</em>.<em></em><br /><div class="webflare-div-image">
<img width="619" height="770" src="images/Chap3-431.gif" /></div></li><li>
<a id="pgfId-1415267"></a>Set the stop frequency to half the input hb frequency.<br />
<a id="pgfId-1415271"></a><div class="webflare-div-image">
<img width="668" height="141" src="images/Chap3-432.gif" /></div></li><li>
<a id="pgfId-1415272"></a>Set the start frequency to four decades smaller than the stop frequency.</li><li>
<a id="pgfId-1415273"></a>Leave the <em>Maximum sideband</em> field blank.</li><li>
<a id="pgfId-1415278"></a>Select the net to be measured.</li><li>
<a id="pgfId-1415283"></a>Type <em>1</em> (one) in the <em>Samples Per Period</em> field.</li><li>
<a id="pgfId-1415285"></a>Select the <em>Add Specific Points</em> check box.</li><li>
<a id="pgfId-1415286"></a>Type a list of times in the <em>Add Specific Points</em> field.</li><li>
<a id="pgfId-1415287"></a>Click <em>Add</em>.</li><li>
<a id="pgfId-1415288"></a>Click <em>OK</em> and run the simulation.</li><li>
<a id="pgfId-1415293"></a>After the simulation completes, select <em>Results - Direct Plot - Main Form</em>.<br /><div class="webflare-div-image">
<img width="666" height="571" src="images/Chap3-433.gif" /></div></li><li>
<a id="pgfId-1415298"></a>If needed, select the appropriate noise analysis in the <em>Measurement Selection</em> drop-down list.</li><li>
<a id="pgfId-1415299"></a>Select <em>HB Integ Output Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1415300"></a>Set the frequency range to the values used in hbnoise.</li><li>
<a id="pgfId-1415301"></a>If needed, select <em>Add To Outputs</em>.</li><li>
<a id="pgfId-1415302"></a>Click Plot.<br />
<a id="pgfId-1430160"></a>The noise waveform appears in another subwindow.<br /><div class="webflare-div-image">
<img width="664" height="448" src="images/Chap3-434.gif" /></div></li><li>
<a id="pgfId-1415307"></a>To put the noise waveform in the same subwindow as the output waveform, right-click the X Axis in the left subwindow.</li><li>
<a id="pgfId-1415308"></a>Select <em>Allow Any Units</em>.</li><li>
<a id="pgfId-1415309"></a>Drag the noise waveform into the same subwindow as the waveform and delete the other subwindow.</li><li>
<a id="pgfId-1415310"></a>Zoom in to the area of interest.<br /><div class="webflare-div-image">
<img width="663" height="453" src="images/Chap3-435.gif" /></div>
<a id="pgfId-1415315"></a>The rising edge and the noise voltage are plotted.</li></ol>






































<h4><em>
<a id="pgfId-1415319"></a>Edge Delay Mode</em></h4>

<p>
<a id="pgfId-1430265"></a></p>

<div class="webflare-div-image">
<img width="666" height="784" src="images/Chap3-436.gif" /></div>

<ol><li>
<a id="pgfId-1415324"></a>On the hbnoise Choosing Analyses form, set the stop frequency to half the PSS frequency.</li><li>
<a id="pgfId-1415325"></a>Set the start frequency to four decades below that.</li><li>
<a id="pgfId-1415326"></a>Select <em>Edge Delay</em>.</li><li>
<a id="pgfId-1415327"></a>Select the net that starts the jitter measurement time.</li><li>
<a id="pgfId-1415328"></a>Set an appropriate <em>Threshold Value</em>.</li><li>
<a id="pgfId-1415329"></a>Select the appropriate <em>Edge Direction</em>.</li><li>
<a id="pgfId-1435619"></a>(Optional) Set <em>Sleep Time</em>, which is the length of time that Spectre will wait before checking for the crossing event in hbnoise sampled(jitter) analysis.</li><li>
<a id="pgfId-1415330"></a>Select the net that stops the jitter measurement.</li><li>
<a id="pgfId-1415331"></a>Select the rising or falling edge.</li><li>
<a id="pgfId-1415332"></a>Click <em>Add</em>.</li><li>
<a id="pgfId-1415333"></a>Click <em>OK</em> and run the simulation.</li><li>
<a id="pgfId-1415334"></a>After the simulation completes, select <em>Results - Direct Plot - Main Form</em>.<br /><div class="webflare-div-image">
<img width="660" height="652" src="images/Chap3-437.gif" /></div></li><li>
<a id="pgfId-1415339"></a>If you ran multiple analyses, select the appropriate hbnoise analysis in the <em>Measurement Selection</em> drop-down list.</li><li>
<a id="pgfId-1415340"></a>Select <em>Jdelay</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1415341"></a>Set the frequency range to the range you set in the hbnoise analysis.</li><li>
<a id="pgfId-1415342"></a>If desired, select <em>Add To Outputs</em>.</li><li>
<a id="pgfId-1415343"></a>Click <em>Plot</em>.
<br /><div class="webflare-div-image">
<img width="664" height="444" src="images/Chap3-438.gif" /></div>
<a id="pgfId-1415348"></a>The jitter is shown in the marker attached to the trace.</li></ol>
























<h2>
<a id="pgfId-1365670"></a><a id="11391"></a>Oscillators</h2>
<h4>
<a id="pgfId-1084775"></a>Noise Type = timeaverage PM noise</h4>

<p>
<a id="pgfId-1084793"></a>Noise type=timeaverage is used to measure the USB, LSB, AM and PM noise separately. USB and LSB results have the total noise (AM and PM) and are by definition single sideband results. For oscillators, PM is suggested because usually the PM component of noise is desired. In the Direct Plot Form, you must use PM to plot phase noise. You cannot do so using the USB or LSB results.</p>
<ol><li>
<a id="pgfId-1365641"></a>First, set variables to define the tuning voltage (vt) and power supply voltages (VDD) in ADE Explorer.<br />
<a id="pgfId-1365645"></a><div class="webflare-div-image">
<img width="630" height="493" src="images/Chap3-439.gif" /></div></li><li>
<a id="pgfId-1139982"></a>Set up the hb form as shown in the following figure. For more information, see the hb section at the beginning of this chapter.<br />
<a id="pgfId-1084841"></a><div class="webflare-div-image">
<img width="668" height="783" src="images/Chap3-440.gif" /></div></li><li>
<a id="pgfId-1250590"></a>Next set up the hbnoise form (More information is provided below).<br />
<a id="pgfId-1265878"></a><div class="webflare-div-image">
<img width="666" height="805" src="images/Chap3-441.gif" /></div></li><li>
<a id="pgfId-1067069"></a>The sweep defaults to relative to the frequency of the specified harmonic of the hb analysis. The frequencies specified in the <em>Choosing Analyses</em> form are added to the frequency of the specified harmonic when <em>relative</em> is selected. In this case, the first harmonic is specified because there no frequency multiplier on the output of the oscillator.</li><li>
<a id="pgfId-1067070"></a>Relative to the oscillator frequency, specify a frequency offset.</li><li>
<a id="pgfId-1067071"></a>Either specify the number of harmonics for the hb, or leave the <em>Maximum sideband</em> field blank, which has the same effect.</li><li>
<a id="pgfId-1067072"></a>Set <em>Output</em> to <em>voltage</em>.</li><li>
<a id="pgfId-1067073"></a>Select the output node.</li><li>
<a id="pgfId-1067076"></a>If you want noise separation, you must first select <em>sources</em> from the <em>Noise Type</em> drop-down list and then you can select the noise separation.</li><li>
<a id="pgfId-1365630"></a>Run the simulation. </li><li>
<a id="pgfId-1365631"></a>To plot the single-sideband phase noise, in ADE Explorer, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</li></ol>






















<p>
<a id="pgfId-1365617"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1365618"></a>Select <em>hbnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1365619"></a>Select PM from the <em>Noise Type</em> section.<br />
<a id="pgfId-1365623"></a><div class="webflare-div-image">
<img width="668" height="631" src="images/Chap3-442.gif" /></div></li><li>
<a id="pgfId-1085038"></a>Select <em>Output Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1418080"></a>Select <em>dBc/Hz</em> from the <em>Units</em> section.</li><li>
<a id="pgfId-1418414"></a>(Optional) To measure phase noise at specific frequencies using expressions in ADE, type a list of frequencies separated by spaces in the <em>Value At (Hz)</em> field. This requires you to click the Add To Outputs check box at the bottom of the form.</li><li>
<a id="pgfId-1418105"></a>Select <em>SSB</em> or <em>DSB</em> from the <em>Noise Convention</em> section.</li><li>
<a id="pgfId-1085084"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1085127"></a><div class="webflare-div-image">
<img width="668" height="464" src="images/Chap3-443.gif" /></div></li></ol>













<h4>
<a id="pgfId-1085178"></a>Commonly Used hb<a id="hbnoise_options_osc"></a>noise Options for Oscillators</h4>

<p>
<a id="pgfId-1165721"></a>For the rest of the options, please see the Commonly Used hbnoise Options.</p>

<p>
<a id="pgfId-1332951"></a></p>
<div class="webflare-div-image">
<img width="543" height="737" src="images/Chap3-444.gif" /></div>
<h4>
<a id="pgfId-1365608"></a>Loren<a id="marker-1365607"></a>tzian</h4>

<p>
<a id="pgfId-1105198"></a>There are two ways of looking at phase noise. One way is to think of measuring the spectral output of the oscillator with a network analyzer. In this case, as the frequency gets close to the oscillator frequency, the amplitude starts going up, levels off, and then drops as the oscillator frequency is passed. In this case, the noise cannot be larger than the oscillations themselves, which is 0 dBc. If this is how you view phase noise, set the <em>lorentzian</em> option to <em>yes</em>.</p>
<p>
<a id="pgfId-1105180"></a>If you think in terms of jitter, in one cycle of the oscillator output, because of the noise, you can calculate one standard deviation of the timing. If you go two cycles, and you integrate the noise with respect to time, you get twice as much noise power, or about 1.4 times the noise voltage or jitter. When you get to an infinite number of oscillator cycles, the jitter also becomes infinite. As you increase the time, you are lowering the noise frequency, and in this case, as the time becomes large, the frequency becomes very low. At infinite time, you get infinite jitter, and this occurs at zero offset from the carrier. Jitter is just another way of looking at phase noise. In other words, the phase noise can easily exceed the carrier amplitude (0 dBc) as the offset frequency becomes small because it is heading to infinity at zero frequency offset. If this is how you view phase noise, set the <em>lorentzian</em> option to <em>no</em>.</p>
<p>
<a id="pgfId-1105181"></a><em>Lorentzian=yes</em> means calculate the leveling off. <em>Lorentzian=cornerfreqonly</em> calculates the continuously rising phase noise, but it places a marker on the phase noise curve at the frequency where the phase noise would level off. <em>no</em> causes the phase noise to continue to rise as the offset frequency approaches zero.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1435139"></a>The <em>lorentzian</em> option is supported only when <em>Noise Type</em> is set to <em>timeaverage</em>.</div>

<h4><em>
<a id="pgfId-1085224"></a>Comparison Between Lorentzian Yes and No </em></h4>

<p>
<a id="pgfId-1085257"></a>As noted above, lorentzian causes leveling off of the phase noise at low frequency.</p>
<p>
<a id="pgfId-1365594"></a>Note that when <em>lorentzian=no</em>, the phase noise curve goes above 0 dBc. This would mean that the noise is larger than the amplitude of the oscillator. This is because hbnoise is a small-signal analysis that does not recognize the large-signal limits of the circuit like clipping. It is similar to AC where you can specify an input magnitude of 1 megavolt, and see 10 megavolts on the output.</p>

<p>
<a id="pgfId-1365598"></a></p>
<div class="webflare-div-image">
<img width="668" height="434" src="images/Chap3-445.gif" /></div>

<p>
<a id="pgfId-1085953"></a><a id="77299"></a>To plot cycle jitter or cycle-to-cycle jitter:</p>
<ol><li>
<a id="pgfId-1085975"></a>On the<em> Direct Plot Form</em>, select <em>hbnoise </em>from the <em>Analysis</em> section.<br />
<a id="pgfId-1085994"></a><div class="webflare-div-image">
<img width="600" height="663" src="images/Chap3-446.gif" /></div></li><li>
<a id="pgfId-1086001"></a>Select <em>Jc</em> or <em>Jcc</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1086037"></a>The frequency range will default to the range set in the <em>Choose Analyses</em> form.<br />
<a id="pgfId-1178030"></a>Cycle jitter (sometimes called period jitter) and cycle-to-cycle jitter are calculated by integrating the noise in the phase noise curve. Cycle jitter fixes the first threshold in time, and measures one standard deviation of the variation of the crossing of the second edge. Cycle-to-cycle jitter measures one standard deviation of the variation in the period of the waveform.</li><li>
<a id="pgfId-1086048"></a>Click <em>Add To outputs</em>.<br />
<a id="pgfId-1086121"></a>The Jc or Jcc calculation is sent to the ADE for evaluation. Click the Plot Outputs icon to see the result.<br /><div class="webflare-div-image">
<img width="668" height="390" src="images/Chap3-447.gif" /></div></li></ol>











<h4>
<a id="pgfId-1086164"></a>Noise Type = sampled(jitter)</h4>

<p>
<a id="pgfId-1419548"></a>This is usually applied to oscillators with square wave output. In most cases, pss shooting with pnoise will run faster and be less error prone. To run hb with hbnoise, ensure that you have enough harmonics to accurately capture the slew rate of the digital output signal before you run the hbnoise analysis.</p>
<p>
<a id="pgfId-1419889"></a>In most cases, you will get the same result except at large offset frequencies compared to PM noise from timeaverage.</p>
<p>
<a id="pgfId-1086175"></a>This analysis gives an instantaneous measurement of jitter at a threshold voltage on the timedomain waveform. This is useful for measuring the jitter of an oscillator that is driving a digital component. </p>
<ol><li>
<a id="pgfId-1431515"></a>First, set up the hb analysis. <br /><div class="webflare-div-image">
<img width="668" height="759" src="images/Chap3-448.gif" /></div></li><li>
<a id="pgfId-1431528"></a>Set a variable to define <em>Number of Harmonics.</em></li><li>
<a id="pgfId-1431543"></a>Set <em>Oversample Factor</em> to <em>2</em>.</li><li>
<a id="pgfId-1420260"></a>Set the variable to a reasonable starting value in ADE. <br />
<a id="pgfId-1431609"></a>20 is used in this example.<br /><div class="webflare-div-image">
<img width="617" height="420" src="images/Chap3-449.gif" /></div></li><li>
<a id="pgfId-1420376"></a>Run the simulation.</li><li>
<a id="pgfId-1431619"></a>After the simulation completes, select Results - Direct Plot - Main Form. </li><li>
<a id="pgfId-1431624"></a>Select <em>Add To Outputs</em> to enter an expression into ADE.<br /><div class="webflare-div-image">
<img width="666" height="692" src="images/Chap3-450.gif" /></div>
<a id="pgfId-1420517"></a>The waveform plots.</li><li>
<a id="pgfId-1420562"></a>Run a sweep in ADE to sweep the number of harmonics over a range.<br /><div class="webflare-div-image">
<img width="667" height="386" src="images/Chap3-451.gif" /></div></li><li>
<a id="pgfId-1420653"></a>Run the simulation. <br />
<a id="pgfId-1431766"></a>A family of waveforms will be plotted.</li><li>
<a id="pgfId-1420715"></a>Open the legend to see the value for the number of harmonics.</li><li>
<a id="pgfId-1420783"></a>Highlight the traces to determine an optimum number of harmonics. Determine the smallest number that causes no further increase in slope as the number of harmonics is increased. In this example, 11 harmonics was set.<br /><div class="webflare-div-image">
<img width="571" height="472" src="images/Chap3-452.gif" /></div></li><li>
<a id="pgfId-1421021"></a>Set the ADE variable to the value you determined above.</li><li>
<a id="pgfId-1086227"></a>Next, set up the hbnoise <em>Choosing Analyses</em> form. <br /><div class="webflare-div-image">
<img width="668" height="748" src="images/Chap3-453.gif" /></div>
<a id="pgfId-1096493"></a>In the <em>Choosing Analyses</em> form:<ul><li>
<a id="pgfId-1421662"></a>The stop frequency must be set to a value close to half the oscillator frequency. </li><li>
<a id="pgfId-1421689"></a>Set the start frequency appropriately.</li><li>
<a id="pgfId-1421762"></a>Set the sweep parameters appropriately.</li><li>
<a id="pgfId-1421809"></a>Leave the <em>Maximum Sideband</em> field blank. <br />
<a id="pgfId-1431941"></a>This will use all the harmonics in the hb analysis.</li><li>
<a id="pgfId-1365537"></a>Select <em>sampled(jitter)</em> from the <em>Noise Type</em> drop-down list.</li><li>
<a id="pgfId-1421414"></a>Select <em>Edge Crossing</em> for the timing event.</li><li>
<a id="pgfId-1421464"></a>Select the output net(s).</li><li>
<a id="pgfId-1365539"></a>Specify a threshold voltage for the timedomain waveform in the <em>Threshold Value</em> field.</li><li>
<a id="pgfId-1086284"></a>Specify a crossing direction in the <em>Edge Direction</em> field. In this example, <em>rise</em> is selected.</li><li>
<a id="pgfId-1421921"></a>Select the output net.</li><li>
<a id="pgfId-1421952"></a>Click <em>Add</em>.</li></ul></li><li>
<a id="pgfId-1365532"></a>Run the simulation.</li><li>
<a id="pgfId-1365533"></a>In the ADE Explorer window, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</li><li>
<a id="pgfId-1432155"></a>On the <em>Direct Plot Form</em>, select <em>hbnoise sampled</em>.</li><li>
<a id="pgfId-1432160"></a>Select <em>Edge Phase Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1432202"></a>Click <em>Plot</em>. <br /><div class="webflare-div-image">
<img width="668" height="418" src="images/Chap3-454.gif" /></div>
<a id="pgfId-1422248"></a>The phase noise will be plotted. This is single-sideband phase noise.<br /><div class="webflare-div-image">
<img width="671" height="442" src="images/Chap3-455.gif" /></div></li><li>
<a id="pgfId-1086457"></a>Now plot the cycle jitter (Jc) or the cycle-to-cycle jitter.<br /><div class="webflare-div-image">
<img width="668" height="743" src="images/Chap3-456.gif" /></div></li><li>
<a id="pgfId-1422504"></a>Select <em>Jc</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1422524"></a>Set the frequency range same as you used in hbnoise.</li><li>
<a id="pgfId-1422581"></a>Click <em>Add To Outputs</em>.<br />
<a id="pgfId-1422610"></a>An expression is entered in ADE.</li><li>
<a id="pgfId-1422650"></a>In ADE, click the <em>Plot Outputs</em> icon.<br />
<a id="pgfId-1422697"></a>The cycle jitter is displayed in ADE.<br /><div class="webflare-div-image">
<img width="653" height="437" src="images/Chap3-457.gif" /></div></li></ol>








































































<h3>
<a id="pgfId-1394691"></a><a id="22283"></a>Creating an Oscilla<a id="oscmacro"></a>tor Macro Source</h3>

<p>
<a id="pgfId-1394752"></a>When simulating an oscillator in hb and hbnoise, the harmonics and phase noise of the oscillator can be saved to a file. This file can then be read by vsource or port to create that same waveform and noise characteristics as the oscillator originally had.</p>
<ol><li>
<a id="pgfId-1394794"></a>Open an oscillator circuit, as shown below.<br />
<a id="pgfId-1394846"></a><div class="webflare-div-image">
<img width="668" height="370" src="images/Chap3-458.gif" /></div></li><li>
<a id="pgfId-1394849"></a>Open ADE Explorer.<br />
<a id="pgfId-1394852"></a><div class="webflare-div-image">
<img width="668" height="403" src="images/Chap3-459.gif" /></div></li><li>
<a id="pgfId-1394855"></a>Open the Choosing Analyses form and select hb.</li><li>
<a id="pgfId-1395106"></a>Specify the fundamental frequency in the <em>Fundamental Frequency</em> field.</li><li>
<a id="pgfId-1395183"></a>Select <em>conservative</em> for Accuracy Defaults (errpreset).</li><li>
<a id="pgfId-1395261"></a>Select <em>Oscillator</em>.</li><li>
<a id="pgfId-1395288"></a>Specify the positive oscillator node in the <em>Oscillator node+</em> field. Alternatively, click <em>Select</em> and select a node from the schematic.<br />
<a id="pgfId-1395497"></a><div class="webflare-div-image">
<img width="668" height="761" src="images/Chap3-460.gif" /></div></li><li>
<a id="pgfId-1394858"></a>Select the <em>Generate Osc Macro Source</em> option.<br />
<a id="pgfId-1395568"></a><div class="webflare-div-image">
<img width="668" height="185" src="images/Chap3-461.gif" /></div></li><li>
<a id="pgfId-1395571"></a>Specify the output node in the <em>Positive Out Node</em> field, as shown in the figure above.</li><li>
<a id="pgfId-1395574"></a>Specify the file name where you want to save the oscillator frequency output in the <em>Save File Name</em> field, as shown below.<br />
<a id="pgfId-1395928"></a><div class="webflare-div-image">
<img width="668" height="186" src="images/Chap3-462.gif" /></div></li><li>
<a id="pgfId-1395578"></a>Click Apply.</li><li>
<a id="pgfId-1395963"></a>Select <em>hbnoise</em> in the Choosing Analysis form.</li><li>
<a id="pgfId-1396014"></a>Specify 1 in the <em>Relative Harmonic</em> field.</li><li>
<a id="pgfId-1396071"></a>Specify 1 in the <em>Start</em> field and <em>100M</em> in the Stop field.</li><li>
<a id="pgfId-1396139"></a>Select <em>Logarithmic</em> from the <em>Sweep Type</em> drop-down list and specify 5 in the <em>Points Per Decade</em> field.</li><li>
<a id="pgfId-1396258"></a>Select <em>voltage</em> from the <em>Output</em> drop-down list and specify the positive output node in the <em>Positive Output Node</em> field.</li><li>
<a id="pgfId-1396394"></a>Select <em>PM</em> as the contribution type.</li><li>
<a id="pgfId-1396435"></a>Select the <em>Generate Osc Macro Source</em> option and specify the same file name in the <em>Save File Name</em> field that you have specified in the hb <em>Choosing Analyses</em> form. This will append the phase noise information for the oscillator in the file.<br />
<a id="pgfId-1396686"></a><div class="webflare-div-image">
<img width="668" height="758" src="images/Chap3-463.gif" /></div></li><li>
<a id="pgfId-1396639"></a>Click OK and run the simulation.</li></ol>










































<p>
<a id="pgfId-1396843"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window. The direct plot form is displayed, as shown below.</p>

<p>
<a id="pgfId-1397000"></a></p>
<div class="webflare-div-image">
<img width="668" height="661" src="images/Chap3-464.gif" /></div>

<p>
<a id="pgfId-1397023"></a>In the Direct Plot form:</p>
<ol><li>
<a id="pgfId-1396837"></a>Select <em>hbnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1397106"></a>Select <em>Output Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1397128"></a>Select <em>dBc/Hz</em> from the <em>Units</em> Section</li><li>
<a id="pgfId-1397193"></a>Click <em>Plot</em>.</li></ol>



<p>
<a id="pgfId-1397211"></a>The phase noise is plotted in the waveform window, as shown below.</p>

<p>
<a id="pgfId-1397317"></a></p>
<div class="webflare-div-image">
<img width="668" height="434" src="images/Chap3-465.gif" /></div>

<p>
<a id="pgfId-1397282"></a>Open the <em>osc_macro1</em> file in a terminal window.</p>

<p>
<a id="pgfId-1397656"></a></p>
<div class="webflare-div-image">
<img width="668" height="782" src="images/Chap3-466.gif" /></div>

<p>
<a id="pgfId-1397441"></a>Note the harmonics information is saved at the top and phase noise information is saved at the bottom of the file.</p>
<ol><li>
<a id="pgfId-1397410"></a>Place a source in the schematic. Use a <em>vsource</em> from <em>analogLib</em>, as shown below.<br />
<a id="pgfId-1397986"></a><div class="webflare-div-image">
<img width="471" height="301" src="images/Chap3-467.gif" /></div></li><li>
<a id="pgfId-1397962"></a>Select the <em>vsource</em> from the schematic and press <code>q</code> to open the Edit Objects Properties Form as shown below.<br />
<a id="pgfId-1398196"></a><div class="webflare-div-image">
<img width="594" height="459" src="images/Chap3-468.gif" /></div></li><li>
<a id="pgfId-1398151"></a>Select <em>oscmacro</em> from the <em>Source type</em> drop-down list, as shown in the figure above.</li><li>
<a id="pgfId-1398306"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1398321"></a>In the ADE explorer window, choose <em>Setup</em> - <em>Simulation Files</em> and add the path to the <em>osc_macro1</em> file that you saved under the <em>Include Paths</em> section, as shown below.<br />
<a id="pgfId-1398545"></a><div class="webflare-div-image">
<img width="668" height="440" src="images/Chap3-469.gif" /></div></li><li>
<a id="pgfId-1399058"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1398676"></a>Now set up the PSS shooting analysis with the frequency specified in the osc_macro1 file, as shown below.<br />
<a id="pgfId-1398824"></a><br /><div class="webflare-div-image">
<img width="668" height="788" src="images/Chap3-470.gif" /></div></li><li>
<a id="pgfId-1398827"></a>Set up the pnoise analysis with the frequency range specified in the osc_macro1 file, as shown below<br />
<a id="pgfId-1398830"></a><div class="webflare-div-image">
<img width="668" height="783" src="images/Chap3-471.gif" /></div></li><li>
<a id="pgfId-1398833"></a>Click <em>OK</em> and run the simulation.</li><li>
<a id="pgfId-1399284"></a>Plot the results using the Direct Plot Form.<br />
<a id="pgfId-1399369"></a>The waveform window is displayed, as shown below.
<a id="pgfId-1399463"></a><div class="webflare-div-image">
<img width="668" height="407" src="images/Chap3-472.gif" /></div></li></ol>


































<p>
<a id="pgfId-1399432"></a>Note that the result is the same as the oscillator circuit.&#160;&#160;&#160;&#160;</p>

<h2>
<a id="pgfId-1088476"></a>hbS<a id="hbsp"></a>P Analysis</h2>
<h3>
<a id="pgfId-1090359"></a>Overview of hb<a id="marker-1301105"></a>sp</h3>

<p>
<a id="pgfId-1090397"></a>Hbsp is an extension to the idea of linear S-Parameters, so that S-Parameters can be measured for circuits that translate frequency. In linear S-Parameters, a wave is launched from the input and that wave is usually partially reflected at the circuit connection, and it propagates to the output where it can be measured. Then a wave is launched at the output source, some of it is reflected back to the output, and a wave appears at the input. Using this idea, linear S-Parameters can be used effectively to characterize many linear systems.</p>
<p>
<a id="pgfId-1090398"></a>With hbsp, a wave is launched at the input just like in S-Parameter analysis. Some of this wave is reflected back to the input, depending on the input match. Because the system is nonlinear, this wave can mix with harmonics of the periodic source that is driving the circuit to cause waves to appear at the output at many different mixing frequencies. Hbsp supports a 2-port simulation where one of the output mixing products can be measured at a time.</p>
<p>
<a id="pgfId-1090399"></a>As an example, imagine a mixer that has a 1.1GHz RF input, and a 1GHz Local Oscillator signal. The forward wave is launched at 1.1GHz, and at the output of the mixer 1.1GHz is produced with no frequency translation. This measures the RF to IF isolation. 100MHz and 2.1GHz are the mixing products produced by mixing with the first harmonic of the LO signal. For a down conversion mixer, the 100MHz term is desired to measure the conversion gain. One of these waves can be measured in hbsp. Like linear S-Parameters, hbsp measures the power gain of the system.</p>
<p>
<a id="pgfId-1090400"></a>For the reverse gain and match calculation, the input is at the output frequency of the mixer, and the output is at the input frequency of the mixer. The forward gain path is from 1.1GHz to 100MHz, and the reverse gain path is from 100MHz to 1.1GHz. Therefore, S11 is a measure of the input match at the RF frequency, and S22 is the output match at the IF frequency. S21 measures the forward conversion gain, and S12 measures the reverse conversion gain.</p>

<h3>
<a id="pgfId-1090389"></a>Example</h3>

<p>
<a id="pgfId-1090412"></a>Consider a double-balanced diode mixer, as shown below.</p>

<p>
<a id="pgfId-1090493"></a></p>
<div class="webflare-div-image">
<img width="668" height="648" src="images/Chap3-473.gif" /></div>

<p>
<a id="pgfId-1365514"></a>The properties of the LO source are as follows. The frequency and amplitude are set to variable names so they can be changed in ADE Explorer without changing the schematic.</p>
<p>
<a id="pgfId-1365508"></a></p>

<div class="webflare-div-image">
<img width="668" height="814" src="images/Chap3-474.gif" /></div>

<p>
<a id="pgfId-1250713"></a>The RF source is similar, but with different variable names.</p>

<p>
<a id="pgfId-1365500"></a></p>
<div class="webflare-div-image">
<img width="668" height="794" src="images/Chap3-475.gif" /></div>

<p>
<a id="pgfId-1365501"></a>The variables are set in the ADE Explorer window. The <em>frf</em> variable is set to 0 (zero) in order to disable the large-signal waveform. Only the <em>LO</em> is applied at 1GHz. 1.4 volts is +13 dBm.</p>

<p>
<a id="pgfId-1090592"></a></p>
<div class="webflare-div-image">
<img width="668" height="464" src="images/Chap3-476.gif" /></div>

<p>
<a id="pgfId-1090610"></a>Next, set up the hb <em>Choosing Analyses</em> form. The hb analysis is used to characterize the nonlinearity of the system and measures the amplitude of the harmonics.</p>

<p>
<a id="pgfId-1090633"></a></p>
<div class="webflare-div-image">
<img width="668" height="758" src="images/Chap3-477.gif" /></div>

<p>
<a id="pgfId-1090707"></a>Harmonics are set to auto so that the simulator will choose the number of harmonics automatically, and oversample factor is raised above one because the currents in the diodes are very nonsinusoidal. For more information on setting the oversample factor, refer to the harmonic balance section at the beginning of this chapter.</p>

<h4>
<a id="pgfId-1365482"></a>Down Conversion and RF to IF Isolation hbsp Setup</h4>

<ol><li>
<a id="pgfId-1365483"></a>Open the hbsp <em>Choosing Analyses</em> form from the ADE Explorer window.<br />
<a id="pgfId-1365487"></a><div class="webflare-div-image">
<img width="668" height="753" src="images/Chap3-478.gif" /></div></li><li>
<a id="pgfId-1090780"></a>Specify the input or output frequency range in the <em>Start</em> and <em>Stop</em> fields. <br />
<a id="pgfId-1090825"></a>Both up conversion and the down conversion will be shown.The LO frequency is 1GHz as was shown in the harmonic balance <em>Choosing Analyses</em> form. In the figure below, the frequency range chosen is 1.05G to 1.15G. For down conversion, this is the input frequency range. The down-converted output is from 50M to 150M.<br />
<a id="pgfId-1090800"></a><div class="webflare-div-image">
<img width="668" height="234" src="images/Chap3-479.gif" /></div></li><li>
<a id="pgfId-1250738"></a>Enter 1 in the<em> Port #</em> column.<br />
<a id="pgfId-1267571"></a><div class="webflare-div-image">
<img width="668" height="215" src="images/Chap3-480.gif" /></div></li><li>
<a id="pgfId-1187298"></a>Click <em>Select Port</em> and select the input port in the circuit.</li><li>
<a id="pgfId-1090887"></a>Click <em>Choose Harmonic</em>.<br />
<a id="pgfId-1101068"></a>The Choose Harmonic window is displayed.<br />
<a id="pgfId-1090897"></a><div class="webflare-div-image">
<img width="668" height="248" src="images/Chap3-481.gif" /></div></li><li>
<a id="pgfId-1094386"></a>In the <em>Choose Harmonic</em> window, select the input frequency range.</li><li>
<a id="pgfId-1090931"></a>Click <em>OK</em>. </li><li>
<a id="pgfId-1094374"></a>Click <em>Add</em>.<br />
<a id="pgfId-1090941"></a>Port 1 is added to the list with the input frequency range.<br />
<a id="pgfId-1090971"></a><div class="webflare-div-image">
<img width="668" height="216" src="images/Chap3-482.gif" /></div></li><li>
<a id="pgfId-1090951"></a>Follow the steps from 2 through 8 to add a second IF output port at the downconverted frequency. The second port is added, as shown below.<br />
<a id="pgfId-1090961"></a><br /><div class="webflare-div-image">
<img width="668" height="219" src="images/Chap3-483.gif" /></div></li><li>
<a id="pgfId-1144187"></a>Follow the steps from 2 through 8 to add a third IF output port at the non-converted frequency. This will measure the RF to IF isolation. The third port is added, as shown below.<br />
<a id="pgfId-1144191"></a><br /><div class="webflare-div-image">
<img width="668" height="219" src="images/Chap3-484.gif" /></div>
<a id="pgfId-1091010"></a>The noise analysis is the same as the noise analysis in hbnoise. Refer to the hbnoise section for details. In the figure below, noise has been disabled because we will not be performing noise analysis.<br />
<a id="pgfId-1091053"></a><div class="webflare-div-image">
<img width="668" height="95" src="images/Chap3-485.gif" /></div></li><li>
<a id="pgfId-1365465"></a>Run the simulation.</li><li>
<a id="pgfId-1365470"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.<br />
<a id="pgfId-1365471"></a>The <em>Direct Plot Form</em> is displayed.</li><li>
<a id="pgfId-1191859"></a>In the <em>Direct Plot Form</em>, select <em>hbsp</em> from the <em>Analysis</em> section.<br />
<a id="pgfId-1267728"></a><div class="webflare-div-image">
<img width="430" height="768" src="images/Chap3-486.gif" /></div></li><li>
<a id="pgfId-1191860"></a>Now plot S11, S21, and S22 by clicking the buttons near the bottom of the <em>Direct Plot Form</em>.<br />
<a id="pgfId-1091194"></a>The waveform window is displayed, as shown below.<br />
<a id="pgfId-1091208"></a><div class="webflare-div-image">
<img width="668" height="436" src="images/Chap3-487.gif" /></div></li></ol>



























































<p>
<a id="pgfId-1144452"></a>Now plot the RF to IF isolation by selecting S31.</p>

<p>
<a id="pgfId-1365460"></a></p>
<div class="webflare-div-image">
<img width="665" height="440" src="images/Chap3-488.gif" /></div>

<p>
<a id="pgfId-1365461"></a>The RF to IF isolation in the ideal case is quite high at just over 121dB.</p>

<h4>
<a id="pgfId-1365462"></a>UP Conversion hbsp Setup</h4>

<p>
<a id="pgfId-1365446"></a>Remember that the LO is at 1GHz as it was before. Now we will reverse the input and output frequencies. The input is from 50M to 60M, and there are two outputs. One output is from 850M to 950M and the other output is from 1.05G to 1.06G. We will focus on the output at 1.05G to 1.06G in this example.</p>
<p>
<a id="pgfId-1365434"></a>The frequency sweep range is unchanged at 1.05G to 1.06G.</p>
<p>
<a id="pgfId-1365422"></a>For up-conversion, reset the hbsp<em> Choosing Analyses</em> form and follow the same steps to specify the frequency for the two ports, as shown in the following figure.</p>
<p>
<a id="pgfId-1365408"></a></p>

<div class="webflare-div-image">
<img src="images/Chap3E/3_228.gif" /></div>

<p>
<a id="pgfId-1365412"></a>Note that the input and output frequencies have changed. Now the input is from 50M to 60M, and the output is from 1.05G to 1.06G. This is done using the same <em>Choose Harmonic</em> button as before.</p>
<p>
<a id="pgfId-1365396"></a>Also, since the gain with no frequency translation from RF to IF is not made because measuring it at 100MHz to 100MHz has little value. The 50M to 60M term at the output of an up-conversion mixer is always filtered out anyway.</p>
<p>
<a id="pgfId-1192411"></a>The plots of the S-Parameters are shown below.</p>

<p>
<a id="pgfId-1091326"></a></p>
<div class="webflare-div-image">
<img width="668" height="498" src="images/Chap3-490.gif" /></div>

<p>
<a id="pgfId-1091352"></a>All the calculations that are available in sp are available in hbsp. Some things like the stability factor Kf are only defined when the input frequency and the output frequency are the same. When parameters become invalid because of frequency differences between the input and output, the <em>Direct Plot Form</em> displays an error, and the parameter does not plot.</p>
<p>
<a id="pgfId-1192503"></a>The difference between sp and hbsp is that in sp, there is no signal applied to the circuit. In hbsp, a signal is applied to the circuit. The S-Parameters are measured with that signal applied. Also, many times the input and output frequencies are different in hbsp, and by definition, linear S-Parameters cannot change frequencies.</p>
<p>
<a id="pgfId-1091353"></a>In the example above, the signal in the harmonic balance large-signal analysis was an LO signal for a mixer, but in the example below, the signal in harmonic balance is the RF input to a power amplifier. In the next example, the input and the output are at the same frequency and the input power is swept.</p>

<h4>
<a id="pgfId-1091344"></a>Amplifier with Swept Input Power</h4>

<p>
<a id="pgfId-1192568"></a>Imagine an amplifier with a tiny amplitude RF input signal at 1GHz. In this case, the amplifier is very linear, and if an S-parameter measurement is done at a small offset frequency, for example, 1.01GHz, the same measurement is obtained as a linear S-Parameter measurement at 1.01GHz.</p>
<p>
<a id="pgfId-1192575"></a>Now imagine that the input signal at 1GHz is near the compression point of the amplifier. Because the system is much more nonlinear, if a small-signal S-Parameter measurement is done at 1.01GHz, the S-Parameters would be different. Because the input signal is large, the instantaneous input impedance changes, and this changes the input match at 1.01GHz. Similarly, the other S-Parameter measurements would be affected.</p>
<p>
<a id="pgfId-1192582"></a>Hbsp runs after hb, so it can be used to characterize the small-signal performance with the large signal present. This is not a large-signal S-parameter measurement, but it is close. If a true large-signal S-Parameter measurement is needed, use LSSP to run that simulation. Only S11, S22, S21, and S12 can be measured with the LSSP.</p>
<ol><li>
<a id="pgfId-1091407"></a>Set the hb <em>Choosing Analyses</em> form as appropriate for your amplifier, as shown below. The delta-power at high input power is small by adding the additional points to the <em>Choosing Analyses</em> form. At high power, things change quickly, so more resolution is needed.<br />
<a id="pgfId-1091417"></a><div class="webflare-div-image">
<img width="668" height="781" src="images/Chap3-491.gif" /></div></li><li>
<a id="pgfId-1091428"></a>In the hbsp <em>Choosing Analyses</em> form, set a single frequency point, as shown below.<br />
<a id="pgfId-1091477"></a><div class="webflare-div-image">
<img width="668" height="793" src="images/Chap3-492.gif" /></div>
<a id="pgfId-1091505"></a>Note that both <em>PORT1</em> and <em>PORT2</em> are set to the same frequency. Use a single frequency point so the gain and stability functions return a single point in the sweep. You can use multiple points if you are familiar with the calculator.</li><li>
<a id="pgfId-1091484"></a>Run the simulation.</li><li>
<a id="pgfId-1091539"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.<br />
<a id="pgfId-1091566"></a>The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1091579"></a><div class="webflare-div-image">
<img width="668" height="719" src="images/Chap3-493.gif" /></div></li></ol>

















<p>
<a id="pgfId-1091555"></a><strong>Plotting S21</strong></p>
<p>
<a id="pgfId-1091621"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1091635"></a>Select the <em>hbsp</em> radio button from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1091657"></a>Select the <em>SP</em> radio button from the <em>Function</em> section.</li><li>
<a id="pgfId-1091674"></a>Select the <em>dB20</em> radio button from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1091681"></a>Click <em>S21</em>.<br />
<a id="pgfId-1091697"></a>The waveform displays <em>S21</em> as a function of input power.<br />
<a id="pgfId-1091714"></a><div class="webflare-div-image">
<img width="668" height="465" src="images/Chap3-494.gif" /></div></li></ol>








<p>
<a id="pgfId-1091736"></a><strong>Plotting Kf</strong><a id="marker-1301209"></a></p>
<p>
<a id="pgfId-1091767"></a>To plot the stability factor Kf, select the <em>Kf</em> radio button in the <em>Function</em> section and click <em>Plot</em>, as shown below. For the actual equations used for the different measurements below, refer to <a href="Chap8.html#15189">Chapter 8, &#8220;AnalogLib Components Used in RF Simulation,&#8221;</a>.</p>

<p>
<a id="pgfId-1091809"></a></p>
<div class="webflare-div-image">
<img width="668" height="571" src="images/Chap3-495.gif" /></div>

<p>
<a id="pgfId-1091827"></a>The waveform window displays Kf as a function of input power.</p>

<p>
<a id="pgfId-1091850"></a></p>
<div class="webflare-div-image">
<img width="668" height="612" src="images/Chap3-496.gif" /></div>

<p>
<a id="pgfId-1091872"></a><strong>Plotting Noise Figure</strong><a id="marker-1301214"></a></p>
<p>
<a id="pgfId-1091901"></a>To plot the Noise Figure, select the <em>NF</em> radio button in the <em>Function</em> section and click <em>Plot</em>, as shown below.</p>

<p>
<a id="pgfId-1091889"></a></p>
<div class="webflare-div-image">
<img width="668" height="571" src="images/Chap3-497.gif" /></div>

<p>
<a id="pgfId-1091942"></a>The waveform window displays noise figure as a function of RF input power.</p>

<p>
<a id="pgfId-1091953"></a></p>
<div class="webflare-div-image">
<img width="668" height="453" src="images/Chap3-498.gif" /></div>

<p>
<a id="pgfId-1091975"></a>Note that this is a power amplifier and not an LNA. Most LNAs have a much lower noise figure in the low RF input power region.</p>

<h3>
<a id="pgfId-1434959"></a>HBS<a id="hbsp_options"></a>P Options</h3>

<p>
<a id="pgfId-1434960"></a>Below is the HBSP Options form.</p>

<p>
<a id="pgfId-1434964"></a></p>
<div class="webflare-div-image">
<img width="668" height="699" src="images/Chap3-499.gif" /></div>
<h4>
<a id="pgfId-1434965"></a>Relative tolerance</h4>

<p>
<a id="pgfId-1434966"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1434967"></a>Specifies the relative tolerance for harmonic balance-based linear solver. Default value is 1.0e-2.</p>

<h4>
<a id="pgfId-1434968"></a>Tolerance</h4>

<p>
<a id="pgfId-1434969"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1434970"></a>HBSP uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough. The tolerance option specifies that accuracy for HBSP. The default value is 1e-4.</p>

<h4>
<a id="pgfId-1434971"></a>Gear Order</h4>

<p>
<a id="pgfId-1434972"></a>Gear order used for small-signal integration. The default value is 2.</p>

<h4>
<a id="pgfId-1434973"></a>Solver</h4>

<p>
<a id="pgfId-1434974"></a>Leave this option at the default. The default solver is the <em>turbo</em> solver.</p>

<h4>
<a id="pgfId-1434975"></a>Hbprecond_solver </h4>
<h4>
<a id="pgfId-1434976"></a>This option is only available only when harmonic balance is selected in PSS and APS is used.</h4>

<p>
<a id="pgfId-1434977"></a>The basic solver is the only solver available in standard Spectre when harmonic balance is selected. <em>autoset</em> is the default solver in harmonic balance when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window. If you have stagnation, it will save a small amount of time to set this option to <em>basicsolver</em>.</p>

<h4>
<a id="pgfId-1434978"></a>Gear_order</h4>

<p>
<a id="pgfId-1434979"></a>Do not change this option.</p>

<h4>
<a id="pgfId-1434980"></a>Resgmrescycle</h4>

<p>
<a id="pgfId-1434981"></a>Leave this option at the default. For the <em>resgmres</em> linear solver, there are several different options.</p>

<h4>
<a id="pgfId-1434982"></a>hbprecond_solver</h4>

<p>
<a id="pgfId-1434983"></a>This option has two settings; <em>basicsolver</em> and <em>autoset</em>. <em>basicsolver</em> is the only solver available in standard Spectre. <em>autoset</em> is the default solver when APS is used. This solver is faster. If stagnation is detected, Spectre prints a message in the Spectre output window.</p>

<h4>
<a id="pgfId-1434984"></a>Annotate</h4>

<p>
<a id="pgfId-1434985"></a>This option controls the level of detail in the Spectre output log. Selections to the left in the form have less detail in the Spectre output log. Selections to the right in the form have increasing levels of detail in the output log.</p>

<h4>
<a id="pgfId-1434986"></a>Freqaxis</h4>

<p>
<a id="pgfId-1434987"></a>HBSP displays all the results on the same frequency scale. The default is <em>absin</em> (absolute value of the input frequency) If there is a negative input frequency, <em>in</em> will show that frequency on the negative frequency axis. <em>out</em> shows the output frequency range on the X axis.</p>

<h4>
<a id="pgfId-1434988"></a>file</h4>

<p>
<a id="pgfId-1434989"></a>Outputs S-parameter data into the specified file.</p>

<h4>
<a id="pgfId-1434990"></a>datafmt</h4>

<p>
<a id="pgfId-1434991"></a>Specifies the data format of the S-parameter output file. Possible values are <em>spectre</em>, <em>touchstone</em>, and <em>touchstone2</em>. The default value is <em>spectre</em>.</p>

<h4>
<a id="pgfId-1434992"></a>datatype</h4>

<p>
<a id="pgfId-1434993"></a>Specifies the data type of the S-parameter output file. Possible values are <em>realimag</em>, <em>magphase</em>, and <em>dbphase</em>. The default value is <em>realimag</em>.</p>

<h4>
<a id="pgfId-1434994"></a>AdditionalParams</h4>

<p>
<a id="pgfId-1434995"></a><em>additionalParams</em> is typically used for new features that are being beta tested. Entries in this field are <code>keyword=value</code> pairs.</p>
<p>
<a id="pgfId-1434955"></a>For more information about the other options, type <code>spectre -h psp</code> at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1372943"></a>Harmonic Balance Trans<a id="hbxf_analysis"></a>fer Function Analysis (HBXF)</h2>

<p>
<a id="pgfId-1390072"></a>One way to measure conversion gain is to apply the LO and the RF signals in harmonic balance (hb) analysis and calculate the full large-signal response at each RF input frequency, and then plot the output as a function of the sweep frequency. While this works, because all the large-signal effects and many harmonics are calculated, the required time for the simulation can be significant.</p>
<p>
<a id="pgfId-1390073"></a>The alternative is to use a small-signal approach similar to the xf analysis. The xf analysis runs considerably faster than running the transient at multiple frequencies because it ignores the large-signal effects. In circuits with frequency translation, the xf analysis is unusable because the calculation is a linear calculation based on the DC bias point. In hbxf analysis, instead of using the DC bias point, the hb solution with just the LO is used as the basis of the calculation. The large-signal analysis calculates the harmonics of the single input that causes the frequency translation to occur, (usually the LO signal or sample clock) and then hbxf is run after the hb analysis to calculate the conversion gain. The conversion gain is calculated based on the nonlinearity in the hb solution. The overall time savings can be very significant.</p>
<p>
<a id="pgfId-1390074"></a>Hbxf requires a shift in mentality for most engineers. We are accustomed to driving an input and then measuring what comes out. In hbxf, you define an output in the circuit and the output frequency range, and then hbxf determines the input frequencies that will cause the output and it then measures the forward conversion gain from all the sources in the circuit to the output defined in the hbxf choosing analysis form.</p>
<p>
<a id="pgfId-1390075"></a>In hbac, we apply the LO signal (or the sample clock) in the hb analysis, and then drive the input with the small-signal hbac analysis and measure the mixing products that come out. While this is very intuitive, the output display can be very confusing to read when the conversion gain near several hb harmonics is desired. Hbxf changes the focus to the output. One output frequency at a time is considered. Hbxf is a two step process. First, the LO is applied to the mixer. This is the signal that causes the frequency translation to occur. Next the input frequencies that cause the output frequency are calculated</p>
<p>
<a id="pgfId-1390076"></a>For example, imagine a system with a 1GHz LO signal, and a 1MHz output signal. In HBXF, we specify 1MHz as the output frequency. In this system, inputs at 1MHz, 999MHz, 1001MHz, 1999MHz, 2001MHz, and so on will cause 1MHz to be produced at the output. Next, the forward conversion gain from the sources in the circuit at all those input frequencies is calculated. Since the input frequencies are different, the conversion gain is different for every input frequency. Using hbxf, you can measure the conversion gain near a number of LO harmonics (or clock harmonics) at the same time.</p>

<h3>
<a id="pgfId-1372946"></a>Example: Conversion Gain (Down Conversion)</h3>

<p>
<a id="pgfId-1372947"></a>Consider a double-balanced diode mixer shown below.</p>

<p>
<a id="pgfId-1372951"></a></p>
<div class="webflare-div-image">
<img width="662" height="576" src="images/Chap3-500.gif" /></div>

<p>
<a id="pgfId-1372952"></a>The RF input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. The property list is shown below.</p>

<p>
<a id="pgfId-1372956"></a></p>
<div class="webflare-div-image">
<img width="668" height="802" src="images/Chap3-501.gif" /></div>

<p>
<a id="pgfId-1372957"></a>The easiest way to get the variables list into the ADE Explorer window is to select <em>Variables</em> -&gt; <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type the desired value, and press &lt;Enter&gt;.</p>
<p>
<a id="pgfId-1372958"></a>The LO frequency is 1GHz and its amplitude is 1.4 volts peak. This is +13 dBm. The RF frequency is 1.1GHz, but it is disabled because the amplitude is set to 0 (zero). Setting either the frequency or the amplitude to zero disables the production of that waveform from the port.</p>

<p>
<a id="pgfId-1372962"></a></p>
<div class="webflare-div-image">
<img width="668" height="570" src="images/Chap3-502.gif" /></div>

<p>
<a id="pgfId-1372963"></a>The hb analysis needs to be set up first. The example below shows a single input at 1GHz. For more information, see the harmonic balance section.</p>

<p>
<a id="pgfId-1372967"></a></p>
<div class="webflare-div-image">
<img width="668" height="781" src="images/Chap3-503.gif" /></div>

<p>
<a id="pgfId-1372968"></a>Next, the hbxf analysis needs to be set up. Like xf, the frequency range specified in the form is the output frequency range. Maximum sideband should be left blank so that all the mixing products from all the harmonic balance harmonics are present in the output of hbxf.</p>

<p>
<a id="pgfId-1372972"></a></p>
<div class="webflare-div-image">
<img width="668" height="749" src="images/Chap3-504.gif" /></div>

<p>
<a id="pgfId-1372973"></a>Once the analyses are set up, the simulation can be run. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>

<p>
<a id="pgfId-1372977"></a></p>
<div class="webflare-div-image">
<img width="348" height="512" src="images/Chap3-505.gif" /></div>

<p>
<a id="pgfId-1372978"></a>HBXF calculates the transfer functions from all the independent sources in the circuit to that output node. Therefore, to plot, you select the source in the circuit that you want the forward conversion transfer functions to be displayed. When the source in the schematic is selected, the waveform is displayed.</p>

<p>
<a id="pgfId-1372982"></a></p>
<div class="webflare-div-image">
<img width="663" height="415" src="images/Chap3-506.gif" /></div>

<p>
<a id="pgfId-1372983"></a>Note that all the short line segments are the forward conversion gain from the selected source (the input source in this case) to the output.</p>
<p>
<a id="pgfId-1390239"></a>To measure the conversion gain, zoom in to the curve at your input frequency and place a marker to measure the gain.</p>

<h3>
<a id="pgfId-1390353"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1390354"></a>The primary application of hbxf is to measure conversion gain. Hbxf is a small-signal analysis. It calculates the small-signal conversion gain. If you need a large-signal measurement of conversion gain, then use a large-signal analysis like harmonic balance (hb) or quasi-periodic steady-state (qpss) analysis. Hbxf measures gain in a way that requires some thought for most engineers who are accustomed to connecting an input, driving the system, and measuring what comes out. This is the idea of hbac, where we capture the large-signal operating point in hb, and then drive a small-signal input, and measure the mixing products that are produced. If you think of this methodology, to measure the conversion gain around several harmonics usually requires a separate simulation near each harmonic.</p>
<p>
<a id="pgfId-1390355"></a>Hbxf was created to allow the measurement of the conversion gain transfer functions near all the hb harmonics in the same simulation run. In hbac, we have one input frequency at a time, and output mixing products at multiple output frequencies are calculated. In hbxf, we focus on one output mixing product at a time, and measure the input frequencies that cause that output frequency, and measure the forward conversion gain from the sources in the circuit at all those input frequencies to the single output frequency. Multiple output frequencies are usually analyzed in an hbxf analysis. Unlike hbac where the output can be seen at every net in the circuit, hbxf calculates the gain only from all the independent sources in the circuit. Therefore, to measure a conversion gain, you select the source instance from the <em>Direct Plot Form</em> instead of selecting a net.</p>
<p>
<a id="pgfId-1390356"></a>For example, imagine a mixer with an LO frequency of 1GHz. Now, imagine the down conversion case where the output is 1MHz. Given the LO frequency, inputs at 1MHz, 999MHz, 1.001GHz, 1.999GHz, 2.001GHz, 2.999GHz, 3.01GHz, and so on cause an output at 1MHz. Depending on the circuit, all those different input to output paths have different gain from each input frequency to the output at 1MHz. In hbxf, you specify the highest hb harmonic to calculate the transfer functions from in the maximum sideband field in the <em>Choosing Analyses</em> form. All these different input frequencies are called sidebands in hbxf.</p>
<p>
<a id="pgfId-1390357"></a>Hbxf has two different modes, which are set by the selection in the <em>Specialized Analysis</em> section of the <em>Choosing Analyses</em> form. <em>Specialized Analysis = None</em> measures the conversion gain that occurs given the nonlinearity created by large-signal in the circuit. <em>Sampled</em> supplies a measurement of the instantaneous gain when the gain is repeatedly measured at a single phase (point in time) of the periodic large signal. This is useful for measuring deterministic jitter in a digital circuit. Note that shooting is more suited to this measurement because many harmonics would be needed in harmonic balance to get a close approximation of the digital waveform.</p>

<h3>
<a id="pgfId-1390396"></a>Normal Conversion Gain Measurement (Specialized Analysis = None)</h3>

<p>
<a id="pgfId-1390397"></a>This mode is used to make a normal conversion gain measurement.</p>

<p>
<a id="pgfId-1390384"></a></p>
<div class="webflare-div-image">
<img width="668" height="340" src="images/Chap3-507.gif" /></div>

<p>
<a id="pgfId-1390436"></a>The figure above illustrates a down-conversion case where the output is just above zero Hz.</p>
<p>
<a id="pgfId-1390437"></a>In the figure above, the top spectrum in black represents the harmonics created by the hb large-signal analysis. The negative and positive frequencies are shown and the DC component is in the center. The colored arrows show the transfer functions from the different input frequencies to the output frequency that is shown on the bottom axis. Hbxf takes the maximum sideband property from the hbxf <em>Choosing Analyses</em> form, and calculates the specified sidebands, which are input to output conversion gain transfer functions. In this example, maximum sideband is set to three. If the maximum sidebands field is left blank, then the transfer functions from all the hb harmonics are calculated.</p>
<p>
<a id="pgfId-1390438"></a>The sideband numbers indicate which harmonic number is being mixed with for the transfer function calculation. Zero means that there is no frequency translation. One is the mixing product that occurs with an input frequency shift of +1 times the hb first harmonic frequency. Mixing frequencies to the left have negative numbers because the input frequency that causes the output is more negative than the output frequency.</p>
<p>
<a id="pgfId-1390439"></a>For example, imagine a large-signal input at 1GHz in the hb analysis and an output frequency of 100MHz to be calculated. With no mixing, there is a gain from the sources in the circuit to the output of the circuit at 100MHz. This is called the zero sideband because there is zero frequency shift from the input to the output. This is not the same measurement as a measurement in the ac analysis because the ac only includes the DC operating point, and the hbxf analysis takes into account the circuit with the LO or clock signal applied.</p>
<p>
<a id="pgfId-1390440"></a>The input frequencies that mix with the first harmonic at 1GHz to provide an output at 100MHz are at -900MHz and 1.1GHz. The frequency that is below the zero sideband is the -1 sideband and the frequency above the zero sideband is the +1 sideband.</p>
<p>
<a id="pgfId-1390441"></a>Similarly, there are terms that mix with the second and third harmonics.</p>

<p>
<a id="pgfId-1390424"></a></p>
<div class="webflare-div-image">
<img width="668" height="369" src="images/Chap3-508.gif" /></div>

<p>
<a id="pgfId-1390477"></a>Usually, we think of positive frequencies only. This is shown above. The negative frequency inputs are reflected up into the positive frequencies. This is the default for hbxf.</p>
<p>
<a id="pgfId-1390478"></a>Your application sets the number of sidebands that you need. If you have specs through the fifth harmonic, you need to set maximum sidebands to 5.</p>

<h4>
<a id="pgfId-1390490"></a>Frequency Sweep</h4>

<p>
<a id="pgfId-1390491"></a>This analysis is like xf, where the output frequency is varied. The output frequency range to be analyzed is specified in the hbxf <em>Choosing Analyses</em> form. Hbxf then calculates the conversion gain terms.</p>
<p>
<a id="pgfId-1390492"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonic in the hb analysis. For example, assume that the hb is at 1GHz, and a log sweep is desired above the first harmonic of the hb analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 in the <em>Relative Harmonic</em> field. Next, type in 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade.</p>
<p>
<a id="pgfId-1390493"></a>The sweep will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1390465"></a></p>
<div class="webflare-div-image">
<img width="668" height="307" src="images/Chap3-509.gif" /></div>

<p>
<a id="pgfId-1390547"></a>To use a log sweep below the first harmonic, use the same frequency range, and type in -1 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1390535"></a></p>
<div class="webflare-div-image">
<img width="668" height="437" src="images/Chap3-510.gif" /></div>
<h4>
<a id="pgfId-1390599"></a>Maximum Sideband</h4>

<p>
<a id="pgfId-1390600"></a>Sideband is the name of the hbxf conversion gain terms. The sideband number is the hb harmonic number that is mixed with. If the sideband number is negative, the input frequency is more negative than the output frequency. If the sideband is positive, the input frequency is more positive than the output frequency.</p>
<p>
<a id="pgfId-1390601"></a>Conceptually, an infinite number of conversion gain terms exist when a single output frequency is analyzed in a nonlinear system. From the practical point of view, usually only a small number of conversion gain terms need to be measured near the LO frequency and a small number of harmonics.</p>
<p>
<a id="pgfId-1390602"></a>There is a property in the <em>Choosing Analyses</em> form called <em>Maximum sideband</em> that is used to define how many mixing products should be calculated. If <em>Maximum sideband</em> is 0, the hbxf analysis will only contain the frequency that appears without mixing or aliasing of any type. This is not equivalent to a linear AC analysis because hbxf takes into account the instantaneously varying nature of the LO or sample clock signal because of the large signal being present in the hb analysis.</p>
<p>
<a id="pgfId-1390621"></a>When <em>Maximum sideband</em> is 1, the inputs without frequency translation and the inputs that mix or alias with the first harmonic of the hb analysis are present in the hbxf analysis. When <em>Maximum sideband</em> is 10, the hbxf analysis includes mixing through the 10th harmonic of the hb analysis. The number of sidebands can be any number up to the number of harmonics specified in the hb analysis.</p>

<h4>
<a id="pgfId-1390622"></a>Setting Harmonics and Sidebands</h4>

<p>
<a id="pgfId-1390623"></a>With harmonic balance, only the harmonics specified in the hb <em>Choosing Analyses</em> form exist in the solution. In the hbxf analysis, because only the harmonics specified in the hb <em>Choosing Analyses</em> form exist, the maximum sideband term can only be set to the number of harmonics specified in the hb analysis or less.</p>
<p>
<a id="pgfId-1390624"></a>Note that with harmonic balance, the number of harmonics (and oversample factor if you have non-sinusoidal waveforms) in the hb analysis needs to be determined. Start with a number of harmonics in the hb analysis based on an estimate of how many harmonics the circuit actually produces with your input waveform, and run the hb and hbxf analyses. Remember that for non-sinusoidal waveforms, oversample factor also needs to be set greater than one. For more information, see the hb section at the beginning of this chapter. Run the analysis and make the desired measurement. Now increase the number of harmonics by roughly 50% and run the simulation again. If the answer does not change, then you had enough harmonics originally, and you might actually be able to decrease the number of harmonics from the original setting. If you have non-sinusoidal waveforms, increase the oversample factor to between two and four before increasing the number of harmonics to find the minimum value for both oversample factor and harmonics.</p>
<p>
<a id="pgfId-1390625"></a>Hbxf is usually preferred to hbac when you need to measure both the passband and the image. Below is a plot of the hbxf and hbac output for a mixer with a 1.9GHz LO and a 100MHz IF. The passband is at 1.8GHz and the image is at 2GHz.</p>

<p>
<a id="pgfId-1390587"></a></p>
<div class="webflare-div-image">
<img width="668" height="419" src="images/Chap3-511.gif" /></div>

<p>
<a id="pgfId-1390665"></a>On the left is an hbxf plot when the input port is probed, thus measuring the gain from the input to the output of the mixer. To read the gain, go to the input frequency, and read the gain on the vertical scale. At the passband frequency of 1.8GHz the gain is about 5dB. The LO frequency is at the junction of the red and blue traces.</p>
<p>
<a id="pgfId-1390666"></a>To measure passband and image gain in pac, the input frequency starts at 1.6GHz and stops at 2.2GHz. At 1.6GHz, the output frequency is -300MHz, but hbac reflects the negative frequencies to the positive frequency domain by default. When the input frequency is 1.9GHz and the output is zero Hz. As the input continues above 1.9GHz, the output frequency becomes positive, and follows the curve back to 300MHz. Most people find the curve from hbac to be more confusing than the curve from hbxf, so if you need to measure both the passband and the image, or if you need to measure the conversion gain near several of the hb harmonics, hbxf is recommended.</p>
<p>
<a id="pgfId-1390667"></a>Note that in the hbac result above, you cannot just add the gain values at a specific frequency. If the frequency was 100MHz, you do have two different gain values of about +5dB. </p>
<p>
<a id="pgfId-1390668"></a>Hbxf can measure the gain near many harmonics at the same time by increasing the maximum sideband parameter in the <em>Choosing Analyses</em> form up to the number of harmonics calculated in the hb analysis. Below is an example of conversion gain through the fifth harmonic. Your application will determine the number of sidebands to set.</p>

<p>
<a id="pgfId-1390653"></a></p>
<div class="webflare-div-image">
<img width="668" height="431" src="images/Chap3-512.gif" /></div>

<p>
<a id="pgfId-1390724"></a>Note that the conversion gain is still relatively high near the third harmonic.</p>
<p>
<a id="pgfId-1390725"></a>Hbxf can also be used to measure the conversion gain from the battery that supplies power to the output. All the gain and conversion gain terms should be below unity, or a potential oscillator is created. In the plot below, the gain from the bias source to the output at the IF frequency of 100MHz is below 0dB. This circuit is not a potential oscillator.</p>

<p>
<a id="pgfId-1390712"></a></p>
<div class="webflare-div-image">
<img width="668" height="420" src="images/Chap3-513.gif" /></div>

<p>
<a id="pgfId-1390770"></a>Hbxf is useful for up-conversion applications as well, with the limitation that a small-signal gain measurement is made. This is shown below.</p>

<p>
<a id="pgfId-1390762"></a></p>
<div class="webflare-div-image">
<img width="668" height="338" src="images/Chap3-514.gif" /></div>

<p>
<a id="pgfId-1390817"></a>The difference is that the output frequency is just above the first harmonic. The rules for the sidebands are the same. -1 means that the input frequency is shifted down from the output frequency by -1 * hb first harmonic frequency.</p>
<p>
<a id="pgfId-1390818"></a>Usually, we think in terms of the positive frequency domain, which is shown below.</p>

<p>
<a id="pgfId-1390805"></a></p>
<div class="webflare-div-image">
<img width="668" height="331" src="images/Chap3-515.gif" /></div>
<h3>
<a id="pgfId-1390862"></a>Sampled HBXF</h3>

<p>
<a id="pgfId-1390863"></a>This analysis is seldom used.</p>
<p>
<a id="pgfId-1390864"></a>The basic idea is to measure the conversion gain as if the conversion gain was repeatedly measured at the same phase (instant in time) in the periodic large signal that is driving the circuit over an infinite number of cycles of the large signal. This measurement is impossible to duplicate in the lab. The primary application is for measuring the gain from the power supply to the output which is driving a digital circuit or a comparator that is triggered at a specific voltage level in order to measure deterministic jitter. It is seldom used because shooting pss with pxf is better suited for this application.</p>

<h2>
<a id="pgfId-1372995"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1372996"></a>This section jumps from the theoretical to the practical with examples of how to use the individual analysis types we just covered. The focus is only on the hbxf Choosing Analyses form so you can see where the individual settings are made. For examples with all the steps shown, see the examples section that follows this section.</p>

<h3>
<a id="pgfId-1372997"></a>HBXF for a Normal Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1372998"></a>Here is an example of the <em>Choosing Analyses</em> form for a normal conversion gain measurement.</p>

<p>
<a id="pgfId-1373002"></a></p>
<div class="webflare-div-image">
<img width="668" height="698" src="images/Chap3-516.gif" /></div>

<ul><li>
<a id="pgfId-1373003"></a><em>Sweeptype</em> can be relative or absolute.</li><li>
<a id="pgfId-1373004"></a>The frequency sweep range is always an output frequency range. It is not a sweep in the traditional sense of connecting an input, sweeping over a frequency range, and measuring the output. Instead, it is an output frequency range to be analyzed. At each output frequency in the sweep, the input frequencies that will mix with the harmonic balance harmonics to cause that output frequency are calculated, and the forward conversion gain is calculated.</li><li>
<a id="pgfId-1373005"></a>Linear and log spacings are provided. Generally, Auto should be avoided because it will always calculate 100 frequency points. Usually, a much smaller number is needed, so it is recommended that you set linear or log, and control the resolution yourself.</li><li>
<a id="pgfId-1373006"></a>Maximum sideband is typically left blank so that all the mixing products from all the harmonic balance harmonics are present in the output of hbxf.</li><li>
<a id="pgfId-1373007"></a>The output can measure either a voltage or a current. The voltage measurement is the default. Specify the output node or nodes in the circuit. If the output is a current select probe for the output, add an iprobe from analogLib (a current probe) in series with the output in the schematic, and specify the instance name in the <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1373008"></a>When <em>Specialized Analysis</em> is set to <em>None</em>, a normal conversion gain measurement is made.</li></ul>






<h3>
<a id="pgfId-1373009"></a>Sampled HBXF</h3>

<p>
<a id="pgfId-1390910"></a>Sampled hbxf is typically used to measure deterministic jitter of a digital circuit caused by ripple on a power supply. Although the capability is provided in hbxf, this application is much better suited to pss with sampled pxf. Usually, hb would require many harmonics to get an accurate reproduction of the digital waveform. In this case, pss with sampled pxf is likely to be much faster. Because of this, sampled hbxf is not covered in this document. See Chapter 4 for shooting pss with sampled pxf.</p>

<h3>
<a id="pgfId-1373033"></a>HBX<a id="hbxf_options"></a>F Options</h3>

<p>
<a id="pgfId-1373034"></a>The Harmonic Balance XF Options form is shown below.</p>

<p>
<a id="pgfId-1373038"></a></p>
<div class="webflare-div-image">
<img width="668" height="701" src="images/Chap3-517.gif" /></div>

<p>
<a id="pgfId-1373039"></a>The following options are occasionally used:</p>

<h4><em>
<a id="pgfId-1373040"></a>relative Tolerance </em></h4>

<p>
<a id="pgfId-1373041"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1391016"></a>Relative tolerance for harmonic balance-based linear solver. Default value is 1.0e-2.</p>

<h4><em>
<a id="pgfId-1373042"></a>tolerance</em></h4>

<p>
<a id="pgfId-1373043"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1373044"></a>HBXF uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough, and the tolerance option specifies that accuracy for hbxf. For driven circuits, the default is 1e-6. For oscillators, the default is 1e-4.</p>

<h4><em>
<a id="pgfId-1373045"></a>gear_order</em></h4>

<p>
<a id="pgfId-1373046"></a>Do not change this option.</p>

<h4><em>
<a id="pgfId-1373047"></a>solver</em></h4>

<p>
<a id="pgfId-1373048"></a>Leave this option at the default.</p>
<p>
<a id="pgfId-1373049"></a>The solver option is used only for driven circuits. The default solver is the turbo solver.</p>

<h4><em>
<a id="pgfId-1373058"></a>resgmrescycle</em></h4>

<p>
<a id="pgfId-1373059"></a>Leave this option at the default. For the resgmres linear solver, there are several different options.</p>

<h4><em>
<a id="pgfId-1373060"></a><strong>hbprecond_solver</strong></em></h4>

<p>
<a id="pgfId-1373061"></a>This option has two settings; <em>basicsolver</em> and <em>autoset</em>. Basicsolver is the only solver available in standard Spectre. <code>autoset</code> is the default solver when APS is used. This solver is faster. If stagnation is detected, Spectre prints a message in the Spectre output window.</p>

<h4><em>
<a id="pgfId-1373062"></a>annotate</em></h4>

<p>
<a id="pgfId-1373063"></a>This option controls the level of detail in the Spectre output log. Selections to the left in the form produce less detail. Selections to the right in the form have increasing levels of detail. The default value is <em>status</em>.</p>

<h4><em>
<a id="pgfId-1373064"></a>stimuli</em></h4>

<p>
<a id="pgfId-1373065"></a>This function is not currently implemented.</p>

<h4><em>
<a id="pgfId-1373066"></a>freqaxis</em></h4>

<p>
<a id="pgfId-1373067"></a><em>freqaxis</em> specifies whether you want to see the negative frequency axis or not. The analysis calculates the input frequencies and forward conversion gain, so <em>in</em> and <em>absin</em> are reasonable choices. <em>in</em> displays the negative frequency axis. <em>absin</em> (absolute value of the input) displays positive input frequencies. This is the default.</p>

<h4><em>
<a id="pgfId-1373068"></a>save</em></h4>

<p>
<a id="pgfId-1373069"></a>This function is not currently implemented.</p>

<h4><em>
<a id="pgfId-1373070"></a>additionalParams</em></h4>

<p>
<a id="pgfId-1373071"></a>This is a field for <span class="webflare-courier-new" style="white-space:pre"><em>&lt;option_name&gt;</em></span><code>=value</code> statements. Multiple <span class="webflare-courier-new" style="white-space:pre"><em>&lt;option_name&gt;</em></span><code>=value </code>statements are allowed with a space between them. Generally, this is used to unlock the beta features.</p>
<p>
<a id="pgfId-1373072"></a>For more information about the other options, type spectre -h hbxf at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1373073"></a>Examples for Driven Circuits</h2>
<h3>
<a id="pgfId-1373074"></a>HBXF Normal Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1373075"></a>Consider the following circuit:</p>

<p>
<a id="pgfId-1373079"></a></p>
<div class="webflare-div-image">
<img width="574" height="564" src="images/Chap3-518.gif" /></div>

<p>
<a id="pgfId-1373080"></a>The circuit is a double-balanced down-conversion mixer with a 1.9GHz LO.</p>
<p>
<a id="pgfId-1373081"></a>ADE Explorer has the variables set to appropriate values, as shown below.</p>

<p>
<a id="pgfId-1373085"></a></p>
<div class="webflare-div-image">
<img width="668" height="503" src="images/Chap3-519.gif" /></div>

<p>
<a id="pgfId-1373086"></a>This setup causes the LO to be driven, and both RF inputs to be turned off for the hb analysis by setting the RF frequencies to zero. You can disable a signal for the hb analysis by setting its frequency to zero.</p>

<h3>
<a id="pgfId-1373087"></a>Using HBXF Analysis for Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1373088"></a>Set up the hb analysis with just the large signal that causes the frequency translation to occur.</p>
<p>
<a id="pgfId-1373089"></a>For more information, see the harmonic balance section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1373093"></a></p>
<div class="webflare-div-image">
<img width="668" height="797" src="images/Chap3-520.gif" /></div>

<p>
<a id="pgfId-1373094"></a>Set up the hbxf Choosing Analyses form, as follows:</p>

<p>
<a id="pgfId-1373098"></a></p>
<div class="webflare-div-image">
<img width="668" height="789" src="images/Chap3-521.gif" /></div>

<ol><li>
<a id="pgfId-1373099"></a>Specify an appropriate output frequency range for your circuit.</li><li>
<a id="pgfId-1373100"></a>You can set either linear or log spacing setting. Auto usually takes more frequency point than are required, and thus extends the runtime.</li><li>
<a id="pgfId-1373101"></a>Leave the<em> Maximum Sideband</em> field left blank in which case, all the mixing products are calculated for all the harmonics in the hb analysis.</li><li>
<a id="pgfId-1373102"></a>Set the output nodes, as shown in the example. If the <em>Negative Output Node</em> field is left blank, as shown above, the global ground node is used by the simulator for the reference node. If you have an output current, add an iprobe from analogLib in series with the output, and select <em>probe</em> in the <em>Output</em> section. Then specify the iprobe in the <em>Output Probe Instance</em> field.</li><li>
<a id="pgfId-1373103"></a>Run the simulation</li></ol>




<p>
<a id="pgfId-1373104"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.</p>

<p>
<a id="pgfId-1373108"></a></p>
<div class="webflare-div-image">
<img width="668" height="512" src="images/Chap3-522.gif" /></div>

<p>
<a id="pgfId-1373109"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1373110"></a>Select <em>hbxf</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1373111"></a>Select <em>db20</em> from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1373112"></a>Select the voltage or current source from the schematic. <br />
<a id="pgfId-1373113"></a>Note that when you plot hbxf results, you are selecting an instance, not a node. You will get the conversion gain results for the source you select in the circuit. The example below shows the conversion gain from the input source in the circuit.</li></ol>



<p>
<a id="pgfId-1373114"></a>The waveform window is displayed, as shown below.</p>

<p>
<a id="pgfId-1373118"></a></p>
<div class="webflare-div-image">
<img width="668" height="505" src="images/Chap3-523.gif" /></div>

<p>
<a id="pgfId-1373119"></a>Since the <em>Sweeptype</em> was set to <em>Logarithmic</em>, the data is displayed with a log axis in the waveform tool. In some cases, a linear X Axis is easier to read. To accomplish this, move the mouse cursor over one of the numbers on the X Axis and click the right mouse button. Deselect <em>Log Scale</em> from the context menu. This is shown below.</p>

<p>
<a id="pgfId-1373123"></a></p>
<div class="webflare-div-image">
<img width="661" height="501" src="images/Chap3-524.gif" /></div>

<p>
<a id="pgfId-1373124"></a>To read the conversion gain, move to the desired input frequency, and read the gain off the Y axis. The gain at 1.91GHz is about 15dB. The place to look is in the red rectangle above. Alternatively, position your mouse cursor on the trace at the input frequency, and read the value in the cursor readout. You can also place a marker at the input frequency to read out the conversion gain. To do this, move your mouse cursor near the trace at the input frequency, and type m.</p>
<p>
<a id="pgfId-1373125"></a>The conversion gain near the third and fifth harmonics of the LO is also reasonably high as well. The gain near the third harmonic is near -5dB, and the gain near the third harmonic is near -25 dB. See the red and blue boxes below.</p>

<p>
<a id="pgfId-1373129"></a></p>
<div class="webflare-div-image">
<img width="668" height="503" src="images/Chap3-525.gif" /></div>

<p>
<a id="pgfId-1373130"></a>In the Direct Plot Form, select <em>New Win</em> from the <em>Plotting</em> mode drop-down list and select the DC source that is supplying power to the circuit.</p>

<p>
<a id="pgfId-1373134"></a></p>
<div class="webflare-div-image">
<img width="668" height="478" src="images/Chap3-526.gif" /></div>

<p>
<a id="pgfId-1373135"></a>Note that the gain is about +4.5dB at 150MHz. This circuit is a potential oscillator.</p>

<h3>
<a id="pgfId-1373136"></a>Sampled HBXF Analysis</h3>

<p>
<a id="pgfId-1391125"></a>As noted earlier, this analysis is likely to run much faster using shooting pss and sampled pxf. See Chapter 4 for directions for this capability.</p>

<h3>
<a id="pgfId-1373219"></a>Examples for Oscillators</h3>
<h3>
<a id="pgfId-1373220"></a>Conversion Gain From Power Supply to the Output Frequency</h3>

<p>
<a id="pgfId-1373221"></a>Consider the following circuit:</p>

<p>
<a id="pgfId-1373225"></a></p>
<div class="webflare-div-image">
<img width="668" height="472" src="images/Chap3-527.gif" /></div>

<p>
<a id="pgfId-1373226"></a>On the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1373227"></a>Set up the hb analysis, as shown below. For more information, refer to harmonic balance section at the beginning of this chapter.<br />
<a id="pgfId-1373231"></a><div class="webflare-div-image">
<img width="668" height="746" src="images/Chap3-528.gif" /></div></li><li>
<a id="pgfId-1373232"></a>Now, set up the hbxf analysis, as shown below.<br />
<a id="pgfId-1373236"></a><div class="webflare-div-image">
<img width="668" height="784" src="images/Chap3-529.gif" /></div></li><li>
<a id="pgfId-1373237"></a>Set the frequency range to a frequency range that is relevant for your needs. In this example, the frequency range is from 100Hz to 100MHz above the first harmonic of the oscillator frequency.</li><li>
<a id="pgfId-1373238"></a>Select <em>Logarithmic</em> from the <em>Sweep Type</em> drop-down list.</li><li>
<a id="pgfId-1373239"></a>Specify 3 to 5 in the <em>Points Per Decade</em> field. Here, 4 is specified.</li><li>
<a id="pgfId-1373240"></a>Leave the <em>Maximum Sidebands</em> field blank.</li><li>
<a id="pgfId-1373241"></a>Specify the output node in the <em>Positive Output Node</em> field.</li><li>
<a id="pgfId-1373242"></a>Click <em>OK</em> and run the simulation.</li></ol>















<p>
<a id="pgfId-1373243"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The Direct Plot Form is displayed, as shown below.</p>

<p>
<a id="pgfId-1373247"></a></p>
<div class="webflare-div-image">
<img width="668" height="645" src="images/Chap3-530.gif" /></div>

<p>
<a id="pgfId-1373248"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1373249"></a>Select hbxf from the Analysis section.</li><li>
<a id="pgfId-1373250"></a>Select sideband from the Sweep section</li><li>
<a id="pgfId-1373251"></a>Select db20 from the Modifier section.</li><li>
<a id="pgfId-1373252"></a>Select your input frequency range in the list in the <em>Input Sideband</em> section.</li><li>
<a id="pgfId-1373253"></a>Select the power supply from the schematic window.</li></ol>




<p>
<a id="pgfId-1373254"></a>The waveform is displayed, as shown below.</p>

<p>
<a id="pgfId-1373258"></a></p>
<div class="webflare-div-image">
<img width="668" height="476" src="images/Chap3-531.gif" /></div>

<p>
<a id="pgfId-1373259"></a>To read the gain, go to the input frequency, and read the gain from the Y axis. The gain is about 57dB at 100KHz in this example.</p>

<h2>
<a id="pgfId-1373323"></a>Harmonic Balance Stabil<a id="hbstb_analysis"></a>ity Analysis (HBSTB)</h2>

<p>
<a id="pgfId-1373324"></a>The HBSTB analysis is used to evaluate the stability of a periodically varying feedback circuit. It is a small-signal analysis like STB analysis, except that the circuit is first linearized about a periodically varying operating point as opposed to a simple DC operating point.</p>
<p>
<a id="pgfId-1373325"></a>Linearizing about a periodically time-varying operating point allows the stability evaluation to include the effect of the time-varying operating point.</p>
<p>
<a id="pgfId-1373326"></a>Evaluating the stability of a periodically varying circuit is a two-step process. In the first step, the small stimulus is ignored and HB analysis is used to compute the periodic steady-state response of the circuit to a possibly large periodic stimulus. As part of the HB analysis, the periodically time-varying representation of the circuit is computed and saved for later use. In the second step, a probe is used to compute the loop gain of the zero sideband. The local stability can be evaluated using gain margin, phase margin, or a Nyquist plot of the loop gain.</p>

<h3>
<a id="pgfId-1373327"></a>Example: Variation in Loop Gain of an Opamp with Swept Input Signal Amplitude</h3>

<p>
<a id="pgfId-1373328"></a>Consider the opamp circuit below.</p>

<p>
<a id="pgfId-1373332"></a></p>
<div class="webflare-div-image">
<img width="668" height="501" src="images/Chap3-532.gif" /></div>

<p>
<a id="pgfId-1373333"></a>To use hbstb, an <code>iprobe</code> from analogLib (single-ended) or a <code>diffstbprobe</code> from analogLib (differential) needs to be added in series with the feedback path. Note the arrow in the current probe is in the same direction as the direction of the feedback.</p>
<p>
<a id="pgfId-1373334"></a>The input source to the circuit has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. This allows changes in frequency or amplitude from the ADE Explorer environment without needing to change the schematic itself.</p>
<p>
<a id="pgfId-1373336"></a>The property list for the input source is shown below.</p>

<p>
<a id="pgfId-1373340"></a></p>
<div class="webflare-div-image">
<img width="668" height="705" src="images/Chap3-533.gif" /></div>

<p>
<a id="pgfId-1373341"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> -&gt; <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type in the desired value, and press &lt;<code>Enter</code>&gt;. When you have set the variables, if you want to add the values back into the cellview, in the ADE Explorer window, select <em>Variables</em> - <em>Copy To Cellview</em>, and then perform a <em>Check and Save</em> in the schematic.</p>

<p>
<a id="pgfId-1373345"></a></p>
<div class="webflare-div-image">
<img width="668" height="531" src="images/Chap3-534.gif" /></div>

<p>
<a id="pgfId-1373346"></a>The input frequency for this example is 100KHz and its amplitude is 100 millivolts peak.</p>
<p>
<a id="pgfId-1373347"></a>The basic strategy is to apply the signal that causes the distortion in the hb analysis, and then measure the loop gain using the hbstb analysis.</p>
<p>
<a id="pgfId-1373348"></a>The hb analysis needs to be set up first. The example below shows a single input at 100KHz. The amplitude is swept from 0.1 volts to 1.5 volts peak with a step value of 0.2 volts. For more information, see the hb section at the beginning of this chapter. This will characterize the amplifier at a range of different input amplitudes. At each amplitude, both the hb and hbstb analyses are run.</p>

<p>
<a id="pgfId-1373352"></a></p>
<div class="webflare-div-image">
<img width="668" height="766" src="images/Chap3-535.gif" /></div>

<p>
<a id="pgfId-1373353"></a>Next, the hbstb analysis needs to be set up. The frequency range depends on your application. The <em>Probe Instance</em> is the <code>iprobe</code> from analogLib in the circuit. If you have a differential circuit, use <code>diffstbprobe</code> from analogLib. <code>diffstbprobe</code> allows the measurement of common-mode and differential-mode loop gain.</p>

<p>
<a id="pgfId-1373357"></a></p>
<div class="webflare-div-image">
<img width="503" height="642" src="images/Chap3-536.gif" /></div>

<p>
<a id="pgfId-1373358"></a>Once the analyses are set up, run the simulation. When the simulation finishes, select</p>
<p>
<a id="pgfId-1373359"></a><em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1373360"></a>The example below shows the <em>Direct Plot Form</em>. If you want dB for the loop gain amplitude plot, plot the magnitude and phase separately This example shows dB for the loop gain magnitude plot.</p>

<p>
<a id="pgfId-1373364"></a></p>
<div class="webflare-div-image">
<img width="422" height="522" src="images/Chap3-537.gif" /></div>

<p>
<a id="pgfId-1373365"></a>Here is the output voltage of the opamp versus input voltage for the sweep. The curve begins to compress at 1.1 volts peak.</p>
<p>
<a id="pgfId-1373369"></a></p>

<div class="webflare-div-image">
<img width="668" height="688" src="images/Chap3-538.gif" /></div>

<p>
<a id="pgfId-1373370"></a>Here is the loop gain and phase curve for the 0.1 volt input.</p>

<p>
<a id="pgfId-1373374"></a></p>
<div class="webflare-div-image">
<img width="668" height="458" src="images/Chap3-539.gif" /></div>

<p>
<a id="pgfId-1373375"></a>Note that the DC phase is 180, and not zero. From feedback theory, we would expect zero. So what causes this difference? In feedback theory, we always assume there is a forward and reverse transfer function, and an inverting summing junction with a gain of unity. In feedback theory, we plot the forward and reverse transfer functions only. When the phase is zero, and then applied through the inverting input, the phase becomes 180. In the circuit, we cannot separate out the summing junction. Thus, the condition of instability is a linear magnitude of 1 and a phase of zero, or multiples of 360 degrees.</p>
<p>
<a id="pgfId-1373376"></a>Vertical marker V2 has been placed at (nearly) unity gain (0dB). The phase is about 87.8 degrees. The distance to zero phase is 87.8 degrees. This is the phase margin for this circuit at low input amplitude. The unity gain frequency is about 800KHz.</p>
<p>
<a id="pgfId-1373377"></a>Below is the plot with a 1.1 volt input.</p>

<p>
<a id="pgfId-1373381"></a></p>
<div class="webflare-div-image">
<img width="668" height="446" src="images/Chap3-540.gif" /></div>

<p>
<a id="pgfId-1373382"></a>The DC gain has dropped from about 66dB to about 52 dB. The unity gain frequency has dropped from about 800KHz to about 178KHz. The phase margin has actually improved.</p>

<h3>
<a id="pgfId-1373383"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1373384"></a>The HBSTB analysis is used to evaluate the stability of a periodically varying feedback circuit. First the large signal is applied in HB. An <code>iprobe</code> (single-ended) or a <code>diffstbprobe</code> (differential) is placed in the circuit in series with the feedback path. Both probes are in analogLib. HBSTB applies a voltage to the source(s) in the probe, and measures the amplitude and phase of the signal across the probe. This is the loop gain of the circuit. <code>diffstbprobe</code> allows the measurement of common-mode and differential-mode gain in the differential circuit.</p>
<p>
<a id="pgfId-1373385"></a>In some cases, placing the probe in the circuit can break some local feedback paths. If this happens, the loop gain calculation will be incorrect. If you are unsure if this could be happening in your circuit, place the probe in a different position in the loop. If the loop gain stays the same, both results are correct. If it changed, try a third point in the circuit. When the two points agree, you have the loop gain.</p>
<p>
<a id="pgfId-1391716"></a>Unlike shooting pss with pstb which requires maxacfreq to be set in pss to go to a very large stb frequency compared to the pss frequency, hbstb just needs enough harmonics to accurately characterize the circuit. If the highest frequency in hbstb is larger than the frequency of the highest harmonic in hb, make sure you compare the hbstb result with a run that includes more harmonics in hb. If the result didn&#8217;t change in hbstb, the original number of harmonics was enough. If it did change, you need more harmonics in hb.</p>

<h2>
<a id="pgfId-1373386"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1373387"></a>Here is an example of the Choosing Analyses form for a normal loop gain measurement.</p>

<p>
<a id="pgfId-1373391"></a></p>
<div class="webflare-div-image">
<img width="668" height="644" src="images/Chap3-541.gif" /></div>

<ul><li>
<a id="pgfId-1373392"></a>The frequency sweep range specifies the limits and spacing of the loop gain measurement.</li><li>
<a id="pgfId-1373393"></a>Linear and log sweeps are provided. Generally, log sweeps are used. The number of points depends on how rapidly the loop gain changes with frequency in your circuit. High Q circuits will need more resolution than shown in this example.</li><li>
<a id="pgfId-1373394"></a>A probe must be used in the circuit and specified in the <em>Probe Instance</em> field. For single-ended circuits, an <code>iprobe</code> from analogLib should be used. For differential circuits, a <code>diffstbprobe</code> should be used. When <code>diffstbprobe</code> is used, you will have an additional choice in the <em>Choosing Analyses</em> form that allows the selection of differential or common-mode measurements of loop gain.</li></ul>



<h3>
<a id="pgfId-1373396"></a>HBSTB Op<a id="hbstb_options"></a>tions</h3>

<p>
<a id="pgfId-1373397"></a>The HBSTB Options form is displayed below.</p>

<p>
<a id="pgfId-1373401"></a></p>
<div class="webflare-div-image">
<img width="668" height="663" src="images/Chap3-542.gif" /></div>
<h4><em>
<a id="pgfId-1373402"></a>relative tolerance</em></h4>

<p>
<a id="pgfId-1373403"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1391746"></a>Specifies the relative tolerance for harmonic balance-based linear solver. Default value is 1.0e-2.</p>

<h4><em>
<a id="pgfId-1373404"></a>tolerance</em></h4>

<p>
<a id="pgfId-1373405"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1373406"></a>HBSTB uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough, and the tolerance option specifies that accuracy for hbstb. The default value is 1.0e-04 for harmonic balance-based solver.</p>

<h4><em>
<a id="pgfId-1373407"></a>gear_order</em></h4>

<p>
<a id="pgfId-1373408"></a>Do not change this option.</p>

<h4><em>
<a id="pgfId-1373409"></a>solver</em></h4>

<p>
<a id="pgfId-1373410"></a>Leave this option at the default.</p>
<p>
<a id="pgfId-1373411"></a>The solver option is used only for driven circuits. The default solver is the turbo solver.</p>

<h4><em>
<a id="pgfId-1373420"></a>regmrescycle</em></h4>

<p>
<a id="pgfId-1373421"></a>Leave this option at the default. For the resgmres linear solver, there are several different options.</p>

<h4><em>
<a id="pgfId-1373422"></a>hbprecond_solver</em></h4>

<p>
<a id="pgfId-1373423"></a>This option has two settings; <code>basicsolver</code> and <code>autoset</code>. <em>basicsolver</em> is the only solver available in standard Spectre. <em>autoset</em> is the default solver when APS is used. This solver is faster. If stagnation is detected, Spectre prints a message in the Spectre output window.</p>

<h4><em>
<a id="pgfId-1373424"></a>oscsolver</em></h4>

<p>
<a id="pgfId-1373425"></a>Leave this option at the default.</p>
<p>
<a id="pgfId-1373426"></a>The <em>oscsolver</em> option is used only for oscillators. The default solver is the turbo solver.</p>

<h4><em>
<a id="pgfId-1373427"></a>annotate</em></h4>

<p>
<a id="pgfId-1373428"></a>This option controls the level of detail in the Spectre output log. Selections to the left in the form produce less detail. Selections to the right in the form have increasing levels of detail. The default value is <em>status</em>.</p>

<h4><em>
<a id="pgfId-1373429"></a>save</em></h4>

<p>
<a id="pgfId-1373430"></a>This function is not currently implemented.</p>

<h4><em>
<a id="pgfId-1373431"></a>nestlvl</em></h4>

<p>
<a id="pgfId-1373432"></a>This function is not currently implemented.</p>

<h4><em>
<a id="pgfId-1373433"></a>additionalParams</em></h4>

<p>
<a id="pgfId-1373434"></a>This is a field for <code>&lt;option_name&gt;=value</code> statements. Multiple <code>&lt;option_name&gt;=value</code> statements are allowed with a space between them. Generally, this is used to unlock the beta features.</p>
<p>
<a id="pgfId-1373435"></a>For more information about the other options, type spectre -h hbstb at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1373436"></a>Oscillator Example</h2>

<p>
<a id="pgfId-1373437"></a>For the differential oscillator circuit below, a <code>diffstbprobe</code> has been placed at mirror locations in the differential circuit. This is shown in the red box below.</p>

<p>
<a id="pgfId-1373441"></a></p>
<div class="webflare-div-image">
<img width="668" height="574" src="images/Chap3-543.gif" /></div>

<ol><li>
<a id="pgfId-1373442"></a>First, an hb analysis needs to be set up. For more information, refer to the harmonic balance section at the beginning of this chapter.<br />
<a id="pgfId-1373446"></a><div class="webflare-div-image">
<img width="668" height="766" src="images/Chap3-544.gif" /></div></li><li>
<a id="pgfId-1373447"></a>Now set up the hbstb analysis. The resolution of this sweep is quite high.<br />
<a id="pgfId-1373451"></a><br /><div class="webflare-div-image">
<img width="668" height="642" src="images/Chap3-545.gif" /></div>
<a id="pgfId-1373452"></a>The frequency sweep range, and the number of points will be determined by your circuit. In this case, from linear stb analysis, all the interesting variations started at 1GHz. Narrow peaks were detected, which forced many points in order to resolve the amplitude of the peaks.</li><li>
<a id="pgfId-1373454"></a>Click <em>OK</em> and run the simulation.</li></ol>











<p>
<a id="pgfId-1373455"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed, as shown below.</p>

<p>
<a id="pgfId-1373459"></a></p>
<div class="webflare-div-image">
<img width="668" height="520" src="images/Chap3-546.gif" /></div>

<p>
<a id="pgfId-1373460"></a>Now the loop gain and phase are plotted using the <em>Direct Plot Form</em>.</p>
<p>
<a id="pgfId-1373461"></a>The plot of the loop gain and phase is shown. The red trace is loop gain, and the blue trace is the phase.</p>

<p>
<a id="pgfId-1373465"></a></p>
<div class="webflare-div-image">
<img width="668" height="446" src="images/Chap3-547.gif" /></div>

<p>
<a id="pgfId-1373466"></a>A vertical marker has been placed at the zero degree point on the phase curve. The frequency readout shows 5.150GHz.</p>
<p>
<a id="pgfId-1373467"></a>The plot of the output spectrum is shown below.</p>

<p>
<a id="pgfId-1373471"></a></p>
<div class="webflare-div-image">
<img width="668" height="434" src="images/Chap3-548.gif" /></div>

<p>
<a id="pgfId-1373472"></a>Note that the frequency in hb is the same as the small-signal hbstb analysis. The nonlinearities of the oscillator are taken into account in the hbstb simulation.</p>
<p>
<a id="pgfId-1374082"></a></p>

<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="Chap2.html" id="prev" title="Setting up a SpectreRF Simulation">Setting up a SpectreRF Simulat ...</a></em></b><b><em><a href="Chap4.html" id="nex" title="Single Input Large and Small-signal Analyses">Single Input Large and Small-s ...</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2020, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>