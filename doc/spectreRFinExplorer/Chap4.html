
<html><head><title>Single Input Large and Small-signal Analyses</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2020-06-25" />
<meta name="CreateTime" content="1593085621" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Provides user information for Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis" />
<meta name="DocTitle" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Single Input Large and Small-signal Analyses" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.2.1" />
<meta name="Keyword" content="spectreRFinExplorer" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2020-06-25" />
<meta name="ModifiedTime" content="1593085621" />
<meta name="NextFile" content="Chap5.html" />
<meta name="Group" content="SpectreRF" />
<meta name="Platform" content="Custom IC Design" />
<meta name="PrevFile" content="Chap3.html" />
<meta name="c_product" content="Spectre" />
<meta name="Product" content="Spectre" />
<meta name="ProductFamily" content="Spectre" />
<meta name="ProductVersion" content="19.1" />
<meta name="RightsManagement" content="Copyright 2012-2020 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide -- Single Input Large and Small-signal Analyses" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="Version" content="19.1" />
<meta name="SpaceKey" content="spectreRFinExplorer191" />
<meta name="webflare-version" content="2.0" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="spectreRFinExplorerTOC.html">Contents</a></li><li><a class="prev" href="Chap3.html" title="Frequency Domain Analyses: Harmonic Balance">Frequency Domain Analyses: Har ...</a></li><li style="float: right;"><a class="viewPrint" href="spectreRFinExplorer.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="Chap5.html" title="Multiple Input Large and Small-signal Analyses">Multiple Input Large and Small ...</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre Circuit Simulator and Accelerated Parallel Simulator RF Analysis in ADE Explorer User Guide<br />Product Version 19.1, June 2020</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>4
<a id="pgfId-1065082"></a></h1>
<h1>
<a id="pgfId-1065083"></a><hr />
<a id="26138"></a>Single Input Large and Small-signal Analyses<hr />
</h1>
<h2>
<a id="pgfId-1065320"></a>Overview of Simulation Capabilities</h2>

<p>
<a id="pgfId-1075922"></a>SpectreRF offers two different modes, Spectre and APS. Spectre uses traditional simulation techniques. APS makes the CMOS models more efficient and allows multi-threading for the device current evaluation. In addition, APS adds full parallel solving of all the matrices, thus speeding up the simulation even more. There is no loss in accuracy because there is no change in the actual equations that are simulated, or in the options that control the accuracy of the simulation. These choices are available and are implemented for periodic steady-state (pss) shooting and pss harmonic balance. Both large-signal and small-signal <code>pac</code>, <code>pxf</code>, <code>psp</code>, <code>pstb</code>, and <code>pnoise</code> analyses have the Spectre and APS implementations.</p>

<h2>
<a id="pgfId-1075911"></a><a id="12426"></a>Overview of Periodic <a id="pss_analysis"></a>Steady-State (pss) Ana<a id="marker-1065319"></a>lysis</h2>

<p>
<a id="pgfId-1065322"></a><a id="PSS"></a>Pss calculates the settled time and frequency domain response of your system. Harmonic balance and shooting engines are available. Harmonic balance solves in the frequency domain and uses an ifft to calculate the time-domain response. Shooting calculates the settled time-domain waveforms and calculates the frequency-domain content using a Fourier transform.</p>
<p>
<a id="pgfId-1075994"></a>All the harmonics of the beat frequency are calculated in the pss analysis up to the maximum harmonic specified in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1075995"></a>Pss needs to simulate an integer number of cycles. This limits the practical application of pss to single-input frequency circuits, or multiple-input frequency circuits that have a relatively high common multiple frequency, called the beat frequency. For example, if 1GHz and 1.1GHz frequencies are applied, the beat frequency is 100M. Solving for the fifth harmonic of the 1.1GHz input requires that 55 harmonics be calculated. This is a reasonable problem for pss. If the inputs are 1GHz and 1.001GHz, 5005 harmonics are needed to calculate through the fifth harmonic of 1.001GHz. This is not a good application for pss. If you need to simulate this kind of system, use qpss-harmonic balance or hb analysis instead.</p>

<h2>
<a id="pgfId-1075986"></a>Example</h2>

<p>
<a id="pgfId-1076013"></a>A behavioral amplifier circuit is shown below.</p>

<p>
<a id="pgfId-1076032"></a></p>
<div class="webflare-div-image">
<img width="668" height="575" src="images/Chap4-2.gif" /></div>

<p>
<a id="pgfId-1076055"></a>The properties for the amplifier are shown below.</p>

<p>
<a id="pgfId-1076062"></a></p>
<div class="webflare-div-image">
<img width="668" height="800" src="images/Chap4-3.gif" /></div>

<p>
<a id="pgfId-1076245"></a>The amplifier has input and output impedances of 50 ohms and the gain is 20dB.</p>
<p>
<a id="pgfId-1076246"></a>The input source on the left of the schematic is called a port. The properties of the port are shown below.</p>

<p>
<a id="pgfId-1076267"></a></p>
<div class="webflare-div-image">
<img width="668" height="746" src="images/Chap4-4.gif" /></div>

<p>
<a id="pgfId-1252677"></a>The port is set to generate sinusoids, and one signal is defined. For the pss analysis, you must enter a name for the signal in the <em>Frequency name 1</em> field. Variable names are used to set the frequency and amplitude so that the frequency and amplitude can be changed in ADE Explorer without needing to change the schematic. The ADE Explorer setup is shown below.</p>

<p>
<a id="pgfId-1076342"></a></p>
<div class="webflare-div-image">
<img width="668" height="542" src="images/Chap4-5.gif" /></div>

<p>
<a id="pgfId-1076375"></a>The input frequency is 2.4GHz and the input power is -30 dBm.</p>
<p>
<a id="pgfId-1076402"></a>Next, the pss analysis is set up, as shown below.</p>
<p>
<a id="pgfId-1076421"></a></p>

<div class="webflare-div-image">
<img width="668" height="791" src="images/Chap4-6.gif" /></div>

<p>
<a id="pgfId-1092299"></a>The pss <em>Choosing </em>Analyses form is set to a single input at 2.4GHz with 6 harmonics and moderate accuracy.</p>
<p>
<a id="pgfId-1092300"></a>The simulation is run, and then in ADE Explorer, <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> is selected. The <em>Direct Plot Form</em> is displayed, as shown below.</p>

<p>
<a id="pgfId-1076793"></a></p>
<div class="webflare-div-image">
<img width="668" height="680" src="images/Chap4-7.gif" /></div>

<p>
<a id="pgfId-1076831"></a></p>
<p>
<a id="pgfId-1209379"></a>Here, dBm is calculated based on the voltage on a node. At the bottom of the <em>Direct Plot Form</em> are directions. In this case, the net on the schematic needs to be selected.</p>
<p>
<a id="pgfId-1076832"></a>The waveform window is shown below.</p>

<p>
<a id="pgfId-1076492"></a></p>
<div class="webflare-div-image">
<img width="668" height="481" src="images/Chap4-8.gif" /></div>

<p>
<a id="pgfId-1076863"></a>The basic display shows the harmonics that were calculated by pss. Markers have been placed on the first harmonics of the input and output. The input is -30dBm, and the output is -10dBm.</p>

<h2>
<a id="pgfId-1076882"></a>Harmonic Balance</h2>

<p>
<a id="pgfId-1076904"></a>There are three ways to run Harmonic Balance simulations in SpectreRF. These are: </p>
<ul><li>
<a id="pgfId-1076978"></a>pss-hb</li><li>
<a id="pgfId-1076985"></a>qpss-hb </li><li>
<a id="pgfId-1076993"></a>hb </li></ul>


<p>
<a id="pgfId-1077000"></a>Qpss with the harmonic balance engine selected and hb are the exact same analysis, however the hb <em>Choosing Analyses</em> form has all the latest improvements, and the qpss form does not. If you are considering using qpss-harmonic balance, it is strongly recommended that you use the hb <em>Choosing Analyses</em> form instead. </p>
<p>
<a id="pgfId-1076906"></a>Harmonic balance in the pss analysis is slightly different than in hb and qpss harmonic balance. In pss, it is always a single-tone simulation. This means that all the harmonics of the beat frequency are calculated by pss instead of just the harmonics of the signals and the mixing products.</p>
<p>
<a id="pgfId-1092399"></a>Also, there are some analysis options that are available directly in the ADE Explorer GUI for pss-harmonic balance that are not in the ADE Explorer GUI for hb. Although you do not require these options, you can still use an option that is not in the ADE Explorer GUI for hb by typing <code>option_name=value</code> in the <em>AdditionalParams</em> field for the option that you want to use in hb.</p>
<p>
<a id="pgfId-1076892"></a>In the example below, there are two input frequencies at 2.4GHz and 2.5GHz.</p>

<p>
<a id="pgfId-1076926"></a></p>
<div class="webflare-div-image">
<img width="668" height="519" src="images/Chap4-9.gif" /></div>

<p>
<a id="pgfId-1076933"></a>The simulation was run with 135 harmonics so that the fifth harmonic of 2.5GHz was captured. Usually, running hb or qpss-harmonic balance is faster because fewer harmonics need to be calculated. This example is for reference only.</p>

<p>
<a id="pgfId-1076940"></a></p>
<div class="webflare-div-image">
<img width="668" height="807" src="images/Chap4-10.gif" /></div>

<p>
<a id="pgfId-1076947"></a>The output spectrum shows that all the harmonics of 100MHz are calculated.</p>

<p>
<a id="pgfId-1076954"></a></p>
<div class="webflare-div-image">
<img width="668" height="470" src="images/Chap4-11.gif" /></div>

<p>
<a id="pgfId-1077183"></a>Again note that hb or qpss-harmonic balance requires fewer harmonics to be calculated because just the significant harmonics that the circuit actually produces are calculated.</p>
<p>
<a id="pgfId-1077184"></a>Other than this difference, pss-harmonic balance is exactly the same as hb. For more information on harmonic balance, refer to <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance&#8221;</a>.</p>

<h2>
<a id="pgfId-1076961"></a>DC Princip<a id="marker-1204551"></a>les</h2>

<p>
<a id="pgfId-1077207"></a>In order to understand the pss analysis, the fundamentals of simulation need to be discussed. Since the transient starts from a DC analysis that provides the time-zero timepoint, the DC Principles are reviewed. Since shooting pss is an extension to the transient analysis, <a href="Chap4.html#53151">Transient Principles</a> are also provided as a review.</p>
<p>
<a id="pgfId-1077208"></a>In any simulation, there has to be an equal number of simultaneous equations as unknowns in the circuit. In simulation, the KCL equations at each node are used. The fundamental assumption is that the sum of the currents at each node has to be zero.</p>
<p>
<a id="pgfId-1077209"></a>The capacitors and inductors can be removed from the circuit because they have no effect on the DC solution. The resistors have linear current and voltage relationships and go directly into a linear algebra matrix. Sources also go directly into the matrix. These values do not change from iteration to iteration. The nonlinearities do not have constant resistance with respect to the applied input voltage.Therefore, they are replaced by resistors and current sources which go into the matrix. Now all the entries in the matrix are linear, and the matrix can be solved. An iterative technique is used to calculate the DC bias point.</p>
<p>
<a id="pgfId-1077210"></a>Consider the circuit shown below.</p>

<p>
<a id="pgfId-1076968"></a></p>
<div class="webflare-div-image">
<img width="668" height="412" src="images/Chap4-12.gif" /></div>

<p>
<a id="pgfId-1077391"></a>On a current versus voltage plot, the system looks, as shown below.</p>

<p>
<a id="pgfId-1077468"></a></p>
<div class="webflare-div-image">
<img width="668" height="447" src="images/Chap4-13.gif" /></div>

<p>
<a id="pgfId-1077720"></a>The intercept where the battery/resistor current coming in is equal to the diode current going out is the exact solution to the problem. Since computers cannot solve algebraic equations, an iterative approach is used to calculate the solution.</p>
<p>
<a id="pgfId-1093055"></a>A starting voltage is assumed for each nonlinearity in the circuit. The default is to assume that the device is on. For a diode, that means about 0.7 volts across the device.</p>
<p>
<a id="pgfId-1093056"></a>In the device model, the I versus V curve is available, and the ability to calculate the tangent at any voltage is also provided. For the first iteration, a line is drawn vertically from the starting point, and at the point where the vertical line intersects the I-V curve, the tangent is calculated. The nonlinear junction is replaced with a resistor and a current source. The current source value is the negative Y-Axis intercept of the tangent, and the conductance of the resistor is the slope of the tangent. The reason for doing this is that the resistor and current sources go directly into a linear algebra matrix that can be inverted and solved for voltages on each node. From that solution, a new tangent is calculated, that value is placed in the matrix, and it is solved again. This is shown below for the first two iterations.</p>

<p>
<a id="pgfId-1093263"></a></p>
<div class="webflare-div-image">
<img width="668" height="514" src="images/Chap4-14.gif" /></div>

<p>
<a id="pgfId-1093264"></a>Note that the iterations can continue forever, always getting closer to the correct answer, but never achieving the correct answer.</p>
<p>
<a id="pgfId-1077758"></a>This process is used for every nonlinearity in the circuit. Note that for a more complicated device, there may also be nonlinear-controlled sources to model the output current.</p>

<h3>
<a id="pgfId-1077775"></a>Converg<a id="marker-1204580"></a>ence</h3>

<p>
<a id="pgfId-1077776"></a>The iterations stop (and the circuit has converged) when the answer is close enough. Close enough is defined by the settings of the convergence options <code>reltol</code>, <code>vabstol</code>, and <code>iabstol</code>. Just after the linear solution is calculated, the current from the linear solution is compared with the nonlinear current from the nonlinear equation for all the nonlinearities in the circuit. When the difference in current is less than <code>reltol</code> * nonlinear current + <code>iabstol</code> for all the devices, a second check is made. When the change in voltage from the last iteration to this one for all nodes in the circuit is less than <code>reltol</code> * (the larger of the last or this iteration voltage) + <code>vabstol</code>, then a KCL check is made for all the nodes. When the sum of the currents at each node is less than <code>reltol</code> * (largest current into the node) + <code>iabstol</code>, the solution has converged. All three criteria need to be met everywhere in the circuit to have the iterations stop. When this happens, the circuit converges and the iterations stop. Again, note that the solution is not exact. To get a more accurate solution, <code>reltol</code> and <code>vabstol</code> need to be reduced from the defaults. More accuracy in DC usually costs a few more iterations.</p>
<p>
<a id="pgfId-1077778"></a>The default for <code>reltol</code> is <code>1e-3</code> (0.1%). The default for <code>vabstol</code> is <code>1e-6</code> (1 microvolt). The default for <code>iabstol</code> is <code>1e-12</code> (1 picoamp). By default, when the answer is within 0.1% plus a little bit, the simulator stops iterating.</p>
<p>
<a id="pgfId-1077779"></a>With the default values, note that when the solution is 1 millivolt, the error that is allowed is 0.1% of 1 millivolt + 1 microvolt or 2 microvolts. When the solution is larger than 1 millivolt, the relative term dominates the error tolerance. Similarly, when the current reaches 1 nanoamp, the relative tolerance becomes dominant. Because most circuits have voltages and currents larger than these, the relative term (<code>reltol</code>) usually dominates the error tolerances. The absolute terms (<code>vabstol</code> and <code>iabstol</code>) apply just to a very small region near zero.</p>
<p>
<a id="pgfId-1077780"></a>The voltage that exists from the sources in the circuit at time zero is applied, and the solution of the DC algorithm is used as the first timepoint.</p>

<h3>
<a id="pgfId-1077803"></a>Ski<a id="marker-1204586"></a>pdc</h3>

<p>
<a id="pgfId-1093558"></a>The default for <code>skipdc</code> is <code>no</code>. Normally, a DC solution is run for the initial transient solution at time zero.</p>
<p>
<a id="pgfId-1093595"></a>In some cases, the time zero timepoint does not converge. Using the <code>skipdc</code> option allows the simulation to proceed to the transient without a DC solution for the time zero point. In this case, an assumed solution is used as the starting point. For the nodes that have batteries connected to ground, the assumed solution is the battery voltage. For nodes that have initial conditions specified, the initial condition is used. For all other nodes, zero volts is assumed.</p>
<p>
<a id="pgfId-1093631"></a>When <code>skipdc</code> is set to <code>yes</code>, the assumed solution is used at time zero and the transient sources start immediately. Sometimes, this causes problems for the transient, therefore, setting <code>skipdc</code> to <code>sigrampup</code> causes the time-varying to start at minus 10 percent of the stop time in the <code>tstab</code> and ramp up from zero to the final value at zero seconds. When the default for <code>skipdc</code> causes problems for the transient, easing the input signal can help the transient get started.</p>

<h2>
<a id="pgfId-1077822"></a><a id="53151"></a>Transient Princip<a id="marker-1206279"></a>les</h2>

<p>
<a id="pgfId-1077823"></a>In the transient, the input voltage is allowed to vary as a function of time, and the capacitor and inductors are added to the circuit. The capacitors are modeled using a resistor and a current source in parallel, and the inductors are modeled as a battery in series with a resistor. The values of the resistors, batteries, and current sources are adjusted at each timepoint to accurately model the correct behavior of the capacitor and inductor. Note that the matrix is still scalar (No real and imaginary part). Keeping the matrix scalar speeds up the solution at each timepoint.</p>
<p>
<a id="pgfId-1077824"></a>The system is broken into individual timepoints, and a solution is made at each timepoint.</p>

<h3>
<a id="pgfId-1077847"></a>Convergence</h3>

<p>
<a id="pgfId-1093780"></a>At each timepoint, the system is solved for using an iterative process, just like the DC solution. The difference is that in the transient, history is used to predict the movement of the circuit, so that the number of iterations at each timepoint is reduced. The same convergence criteria is used in the transient as in the DC analysis with the exception of where the <code>reltol</code> * <code>voltage</code> or <code>reltol</code> * <code>current</code> terms come from in the circuit. This is controlled by the <code>relref</code> option.</p>

<h3>
<a id="pgfId-1077850"></a><a id="91916"></a>Relr<a id="marker-1204600"></a>ef</h3>

<p>
<a id="pgfId-1077851"></a>Consider a sine wave, as shown below.</p>

<p>
<a id="pgfId-1077871"></a></p>
<div class="webflare-div-image">
<img width="668" height="319" src="images/Chap4-15.gif" /></div>

<ul><li>
<a id="pgfId-1077488"></a>Pointlocal criteria is <code>reltol</code> * the voltage or current at this node at this iteration or the last iteration, whichever is larger. Note that as convergence is attained, the solution is almost exactly the sinusoid, so when the voltage is small, the uncertainty is small. When the voltage is large, the uncertainty is large. This is shown below.<br />
<a id="pgfId-1078029"></a><div class="webflare-div-image">
<img width="668" height="321" src="images/Chap4-16.gif" /></div>
<a id="pgfId-1078101"></a>Although this is the most accurate solution, more time is required for the simulation because of the very small error tolerances near zero. Usually, the local criteria, which is shown next is preferable.</li><li>
<a id="pgfId-1078102"></a>Local criteria is <code>reltol</code> * the voltage or <code>reltol</code> * <code>current</code> at this node at this or the previous iteration, or at any solution in the past. With a sinusoid starting at zero, the uncertainty is zero and gets larger as the voltage gets larger. Once the voltage reaches the peak, the uncertainty is constant after that. This is because <code>reltol</code> * peak voltage is always larger than <code>reltol</code>* the current solution.<br />
<a id="pgfId-1110832"></a><div class="webflare-div-image">
<img width="668" height="320" src="images/Chap4-17.gif" /></div>
<a id="pgfId-1110833"></a>The error tolerance is larger after the first peak compared to <code>pointlocal</code>, but it is never larger than the value at the peak. This is a good compromise for accuracy of the simulation.</li><li>
<a id="pgfId-1078166"></a>Global criteria is <code>reltol</code> * largest voltage anywhere in the circuit now or at any time in the past. For most circuits, the largest voltage in the circuit is the power supply voltage and the largest current is the power supply current. Since the power supply voltage and current is usually larger than the node voltages and currents, the error is larger, as shown below.<br />
<a id="pgfId-1078167"></a><div class="webflare-div-image">
<img width="668" height="340" src="images/Chap4-18.gif" /></div>
<a id="pgfId-1094008"></a>Note that when global criteria are used, the error tolerance gets much larger for low voltage nodes and low current branches. Because of this, the accuracy degrades when using global criteria.</li><li>
<a id="pgfId-1094030"></a>Note that for <code>pointlocal</code> and for local criteria at <code>time = zero</code>, when the voltage is zero, <code>reltol</code> * voltage is also zero. Since every iteration produces a different solution, an absolute term needs to be added to the relative term so that convergence can be obtained when the voltage or current signal goes through zero. For voltages, this is set by the option <code>vabstol</code>, which defaults to 1 microvolt. (<code>1e-6</code>) For currents, this is set by the option <code>iabstol</code> which defaults to 1 picoamp (<code>1e-12</code>). This small absolute tolerance is added to the relative term at all timepoints. The absolute term is shown below.<br />
<a id="pgfId-1077576"></a><div class="webflare-div-image">
<img width="668" height="313" src="images/Chap4-19.gif" /></div>
<a id="pgfId-1077584"></a>The <code>relref</code> option affects the transient-based analysis only (tran, pss shooting, qpss shooting, and envelope shooting). It uses different combinations of criteria (<code>pointlocal</code>, <code>local</code>, <code>global</code>) for the different settings of <code>relref</code>.<br />
<a id="pgfId-1077591"></a><table class="webflareTable" id="#id1078308">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078396"></a></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078398"></a>Pointlocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078400"></a>Alllocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078402"></a>Sigglobal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078404"></a>Allglobal</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078406"></a>Device Current Check</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078408"></a>Pointlocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078410"></a>Local</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078412"></a>Global</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078414"></a>Global</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078436"></a>Delta-V Check</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078418"></a>Pointlocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078420"></a>Local</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078422"></a>Global</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078424"></a>Global</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078438"></a>KCL Check</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078428"></a>Pointlocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078430"></a>Local</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078432"></a>Local</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1078434"></a>Global</p>
</td>
</tr>
</tbody></table></li></ul>



























<p>
<a id="pgfId-1077598"></a>Note that in the order of most accurate to least accurate, the <code>relref</code> settings are <code>pointlocal</code>, <code>alllocal</code>, <code>sigglobal</code>, and <code>allglobal</code>. The default for most SpectreRF simulations is <code>alllocal</code>.</p>

<h3>
<a id="pgfId-1077605"></a>Integration Methods</h3>
<h4>
<a id="pgfId-1077612"></a>Trapezoidal Me<a id="marker-1204638"></a>thod</h4>

<p>
<a id="pgfId-1110825"></a>In the transient, numerical integration is used for integrating current to get voltage on capacitors and for integrating voltage to get current in inductors. One method is to assume that the current is constant at the average current that flows during the interval. Because the current is constant, the voltage is a ramp during the timestep. The waveform that might be produced is shown below.</p>

<p>
<a id="pgfId-1077626"></a></p>
<div class="webflare-div-image">
<img width="668" height="264" src="images/Chap4-20.gif" /></div>

<p>
<a id="pgfId-1077633"></a>Note that the real waveform is usually a curve. This is shown below.</p>

<p>
<a id="pgfId-1077640"></a></p>
<div class="webflare-div-image">
<img width="668" height="270" src="images/Chap4-21.gif" /></div>

<p>
<a id="pgfId-1078587"></a>Note that the area between the straight line and the curve is the charge that is in the physical system, but not in the simulation. Errors are introduced in the simulation because of a finite timestep that is in the simulation. The timestep cannot go infinitely small because it would take infinitely long to run the simulation. As a consequence, numerical integration errors are inherent in the time-domain simulation because of the finite timestep.</p>
<p>
<a id="pgfId-1078588"></a>This error can be controlled by making the timestep smaller, as shown below.</p>

<p>
<a id="pgfId-1077647"></a></p>
<div class="webflare-div-image">
<img width="668" height="269" src="images/Chap4-22.gif" /></div>

<p>
<a id="pgfId-1078635"></a>Note that by taking twice as many timepoints, the sum of the errors is much less than the previous case. One way to accomplish this is to set a small maximum timestep. Although this produces the most accurate waveform, the runtime cost is usually quite high because the maximum timestep is used everywhere in the simulation.</p>
<p>
<a id="pgfId-1078636"></a>When the waveform is at a constant value, there is no numerical integration error. The place where the error occurs is the curvature that is produced by the circuit. Spectre controls the timestep based on the curvature that is produced by the circuit. Because of this, the timestep is inherently a variable, as shown in the below waveform. The X symbols on the waveform indicate the place where a timepoint exists in the transient output data.</p>

<p>
<a id="pgfId-1077654"></a></p>
<div class="webflare-div-image">
<img width="668" height="490" src="images/Chap4-23.gif" /></div>

<p>
<a id="pgfId-1078674"></a>Note that where the waveform is flat, the timestep bumps out, and where there is a high curvature, lots of points are taken. In this way, the accuracy of the waveform is preserved with the least possible number of timepoints. This is done to reduce the runtime and is the normal method of timestep control.</p>
<p>
<a id="pgfId-1078675"></a>The trapezoidal method is generally good for normal transient simulations because the method does not exaggerate or damp any ringing that the circuit might produce. Although it is not visible in the waveform above, the trapezoidal method has ringing. At each point, there is an error term that alternates its sign at each timepoint. First a bit up, then a bit down.</p>

<h4>
<a id="pgfId-1078692"></a>Gear2 m<a id="marker-1204668"></a>ethod</h4>

<p>
<a id="pgfId-1078693"></a>In the Gear2 method, the current is assumed to be a polynomial fit in the timestep. This requires the simulation history to determine the curve. Because of this, the simulation takes about 5% longer to run compared to trapezoidal. Because the current is more accurately represented, the method is a bit more accurate than trapezoidal. It also slightly numerically damps any ringing that the circuit might produce. This effect disappears completely when the timesteps are small, which is usually accomplished by setting <code>reltol</code> to <code>1e-4</code> or smaller. For very high Q circuits, small numerical integration errors cause large errors in the voltage in the resonator. For that reason, harmonic balance is usually preferable to shooting for high Q circuits. If you must simulate a high Q circuit using the transient analysis, always use the <code>traponly</code> numerical integration method.</p>

<h2>
<a id="pgfId-1077661"></a><a id="92939"></a>Controlling A<a id="marker-1206025"></a>ccuracy</h2>

<p>
<a id="pgfId-1094574"></a>The simulator works by setting a limit for the curvature. This limit is controllable by setting <code>lteratio</code> and/or <code>reltol</code>. The product of <code>reltol</code> times <code>lteratio</code> sets the actual limit. Increasing <code>lteratio</code> sets a higher amount of curvature and leads to more errors when evaluating the numerical integration. The output with <code>lteratio</code> set to 10 times the default, is shown below.</p>

<p>
<a id="pgfId-1077675"></a></p>
<div class="webflare-div-image">
<img width="668" height="484" src="images/Chap4-24.gif" /></div>

<p>
<a id="pgfId-1077682"></a>The waveshape is substantially similar. In this case, it is OK to allow more numerical integration errors. If the details of a small portion of the waveform need to be accurate, zoom in to the time scale that is needed, as shown below.</p>

<p>
<a id="pgfId-1077696"></a></p>
<div class="webflare-div-image">
<img width="668" height="440" src="images/Chap4-25.gif" /></div>

<p>
<a id="pgfId-1078829"></a>Note the obvious piecewise linear behavior in the waveform. This is an indicator that at this time scale, the error is unacceptable. <code>Lteratio</code> and <code>reltol</code> were reduced for the following waveform.</p>

<p>
<a id="pgfId-1078840"></a></p>
<div class="webflare-div-image">
<img width="668" height="420" src="images/Chap4-26.gif" /></div>

<p>
<a id="pgfId-1078975"></a>The waveshape is substantially changed. This is because the numerical errors were significant at the time/voltage scale that we needed for the measurement.</p>
<p>
<a id="pgfId-1078976"></a>There is still a bit of piecewise linear behavior. Reducing <code>reltol</code> and <code>lteratio</code> further will only be slightly more accurate and the runtime will be much longer. In simulation, a trade-off of accuracy versus runtime needs to be made using <code>reltol</code>, <code>vabstol</code>, and <code>lteratio</code> to get the accuracy that is needed without excessive runtimes.</p>

<h3>
<a id="pgfId-1078960"></a>Shooti<a id="marker-1204721"></a>ng P<a id="shooting_pss"></a>SS</h3>
<h3>
<a id="pgfId-1078847"></a>Overview</h3>

<p>
<a id="pgfId-1079010"></a>Shooting is a way of calculating the steady-state waveforms of a periodic system. Any waveshape is allowed as an input with the limitation that the waveform must be periodic. First, a transient is run for the duration set by the <em>Stop time</em> (<code>tstab</code>) option. Next, one period of the pss beat frequency is simulated while still using the normal transient algorithm. Then, the transient continues for one period of the waveform with the addition of saving all the solution matrices at each timestep. This is called the shooting window.</p>
<p>
<a id="pgfId-1079012"></a>At the end of simulating this period of the input, the beginning and ending states are compared. If all the voltages and currents are equal, the steady-state solution has been achieved, and the simulation stops. In general, because the transient analysis starts from a settled DC solution at time zero, there is still settling behavior going on at the end of the first time through the shooting window. This causes the solutions to be different at the beginning and ending of the shooting window. The simulator now looks through all the solution matrices which contain information about the behavior of the circuit and the nonlinear resistors, capacitors, and inductors in the circuit, Using this information, an estimate is made of the final settled voltage for every node in the circuit. This is brought back as the starting point for the shooting window, and one period is run again. At the end, the voltages and currents are again compared to see if they are equal. This process continues until the beginning and ending states are equal. This process is called the shooting Newton method.</p>
<p>
<a id="pgfId-1079013"></a>Graphically, this is shown below.</p>

<p>
<a id="pgfId-1078998"></a></p>
<div class="webflare-div-image">
<img width="668" height="424" src="images/Chap4-27.gif" /></div>

<p>
<a id="pgfId-1079055"></a>The estimate for every node is brought back as the starting point, and the period just after 15 nsec is simulated again. This continues until the beginning and ending voltages and currents almost match.</p>
<p>
<a id="pgfId-1079056"></a>Note that PSS Shooting is really an extension to the transient analysis. All the concepts and options that were discussed before in the transient review section apply to shooting pss as well.</p>

<h3>
<a id="pgfId-1079087"></a>Oscillators</h3>

<p>
<a id="pgfId-1079088"></a>The algorithm is slightly different for oscillators. First, the tstab interval is simulated. Next, a single period of the estimated frequency from the <em>Choosing Analyses</em> form is simulated. So far, this is exactly the same as driven pss. To achieve reliable convergence, the oscillator must reach near the steady-state behavior during this phase.</p>
<p>
<a id="pgfId-1079089"></a>Because the oscillator may also have a frequency divider at the output, additional four periods of the estimated frequency in the pss <em>Choosing Analyses</em> form are simulated. During this time, Spectre looks for a frequency divided output.</p>
<p>
<a id="pgfId-1079090"></a>Next, one period of the lowest frequency in the circuit is determined. If the oscillator does not have a frequency divider, then one period of the oscillator output is solved for. If the oscillator has a divider, one period of the divided down frequency is solved for.</p>
<p>
<a id="pgfId-1079091"></a>Once one period is determined, then the steady-state waveforms for all the nodes and the period are solved for so that the beginning and ending voltages and currents almost match, and the period is stable for at least two iterations. Because the period is an additional variable to be solved for compared to a driven circuit where the period is known, oscillators typically take more iterations to converge to the solution.</p>

<h4>
<a id="pgfId-1201435"></a>Oscillator Tuni<a id="marker-1204738"></a>ng Mode</h4>

<p>
<a id="pgfId-1201446"></a>Pss has the ability to tune an oscillator to a specified frequency, and then run the small-signal analyses (usually noise) that are specified. This is typically used in sweeps and in Monte Carlo simulations where the phase noise is desired at a specified frequency.</p>
<p>
<a id="pgfId-1201567"></a>Tuning mode adjusts a parameter in the circuit to produce the set frequency target. This is done automatically when tuning mode is enabled without setting any sweep parameters or interpolation of the resulting curves. When the tuning frequency is reached, any small-signal analyses like noise are run. This allows the simulator to tune the oscillator to a specified frequency and then make a noise measurement. This is useful in Monte Carlo analysis to see how the oscillator performs with process variations. The parameter to be tuned can be a variable, temperature, or a specified device parameter. Oscillator tuning mode is also supported in the hb analysis. See <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance,&#8221;</a> for details.</p>
<p>
<a id="pgfId-1203407"></a>In this mode, the target frequency to tune to is the frequency that is specified in the pss <em>Choosing Analyses</em> form as the fundamental frequency. You specify a parameter that is to be varied to achieve the desired frequency. This can be a variable, a device parameter, or temperature. When the analysis runs, the oscillator will be tuned to the desired frequency, and then all the small-signal analyses will be run. </p>
<p>
<a id="pgfId-1203408"></a>Direct plot functions have been added to plot the tuning parameter.</p>

<h3>
<a id="pgfId-1203409"></a>Del<a id="marker-1204743"></a>ay Time</h3>

<p>
<a id="pgfId-1079572"></a>All the signal sources have a property called delay time. During the delay time, the source stays at a constant value, and then the waveform starts. The system does not become periodic until the longest delay time has elapsed. Delay times longer than one period of the output waveform of a source should be avoided. The beginning of the tstab interval is the longest delay time in the sources of the circuit.</p>

<h3>
<a id="pgfId-1079594"></a>Piecewise Linear Sources for Power Supplies</h3>

<p>
<a id="pgfId-1095235"></a>In some cases, nonperiodic piecewise linear sources are used. This is one way to start an oscillator by giving the power supply a small bump just after the transient analysis starts. In this case, set the first point at zero seconds and 80% to 90% of the full supply voltage, and specify a second point about half period of the operating frequency at the full supply voltage. Do not specify a point at one second (or some other fairly large time) and the supply voltage. Spectre will maintain the voltage of a source if the simulation time exceeds the last point from a piecewise linear source. If there is a one second point, then something that is usually at a high frequency has to simulate for one second before the circuit becomes periodic. Tstab would start at the last point in the piecewise linear waveform.</p>

<h3>
<a id="pgfId-1095329"></a>Ts<a id="marker-1204748"></a>ta<a id="tstab"></a>b</h3>

<p>
<a id="pgfId-1225730"></a>In the pss Choosing Analyses form, there is a property called <em>Stop time (tstab)</em>. The default value for tstab is zero. However, if a value is specified for the parameter, then a normal transient is run to a stop time equal to tstab. For driven circuits, it is seldom necessary to set tstab, but oscillators usually require it to be set.</p>
<p>
<a id="pgfId-1225731"></a>For shooting pss, when <em>Run transient?</em> is set to <em>yes</em>, the <em>Detect Steady State</em> option is enabled automatically. This option can be selected to switch from running tstab directly in the shooting window when steady state is detected, if this occurs before the stop time specified in the <em>Stop Time(tstab)</em> field. When you set the <em>Run transient?</em> option to <em>Decide automatically,</em> tstab is run until steady state is achieved and then switches to the shooting phase automatically.</p>
<p>
<a id="pgfId-1223594"></a>Dynamic parameters are supported in tstab just like in the transient analysis. Typically only reltol is changed over the tstab interval with loose (large) values of reltol at the beginning of tstab and then tighter values toward the end. A single option is supported in the GUI. Note that the default values are already fairly loose in the tstab interval by default.</p>

<h3>
<a id="pgfId-1079631"></a>Beat Fr<a id="marker-1204753"></a>equency</h3>

<p>
<a id="pgfId-1079632"></a>The beat frequency is the periodicity of the system. If a single input frequency is applied, it is the frequency of the input signal. For frequencies that have inconvenient frequencies, but easy periods, a selection is available to set the period instead of the frequency.</p>
<p>
<a id="pgfId-1079633"></a>If there are two input frequencies, the highest common multiple frequency must be set as the beat frequency. The limitation is that an integer number of cycles must be simulated for all the input frequencies. This is required because pss checks the differences between the currents and voltages at the beginning and end of the shooting window and this difference must be zero. This forces an integer number of cycles for all the sources in the circuit to be simulated.</p>
<p>
<a id="pgfId-1095650"></a>As an example, if a 1 GHz frequency is applied to the system, the beat frequency (periodicity) of the system is 1 GHz. If 1 GHz and 1.1 GHz frequencies are applied, the beat frequency is 100 MHz. In this system, 10 cycles of 1GHz and 11 cycles of 1.1 GHz need to be simulated to get the steady-state waveform. If 1 GHz and 1.001GHz need to be simulated, the beat frequency is 1 MHz. This is not a practical pss simulation because 1000 cycles of 1 GHz and 1001 cycles of 1.001 GHz need to be simulated, and at least 3003 harmonics need to be calculated to measure the third harmonic of 1.001 GHz. The time required for the simulation and the memory requirement is excessive for this case. In this case, using qpss or hb is much faster and requires much less memory. </p>
<p>
<a id="pgfId-1095651"></a>For oscillators, an estimate of the oscillator frequency is required in the <em>Beat Frequency</em> field. If the linear oscillator initial condition is used, the frequency range needs to be from 0.5 to 1.5 times the actual oscillation frequency. If the default oscillator initial condition is used, then the frequency must be between 0.25 and four times the actual frequency of oscillation.</p>

<h3>
<a id="pgfId-1079656"></a>Number of Harmonics</h3>

<p>
<a id="pgfId-1095715"></a>In the case of PSS Shooting, this is a post-processing specification that might have an effect on the minimum number of timepoints in the solution. This parameter specifies the number of harmonics to calculate in the Fourier transform that is run after the time-domain simulation to calculate the harmonics of the large-signal response. The Fourier transform is not an FFT that requires exactly spaced samples of the waveform. Rather, it is Fourier integral-based, which uses the timepoints that were actually calculated by the pss analysis as the input. Since the waveform that the Fourier-integral based algorithm sees are the actual timepoints, all the harmonics specified are accurate, even if you only specify one or two harmonics. Zero (0) is a perfectly legal value for the number of harmonics, and it just means that no Fourier transform will be run after the time-domain solution is calculated.</p>
<p>
<a id="pgfId-1079658"></a>If the number of harmonics is raised above 10, then more timepoints will be forced in the pss solution in order to keep the accuracy of the frequency-domain results very high. 20 timepoints will be run in the period of the highest harmonic. Therefore, if maximum harmonics is set to 20, a minimum of 400 timepoints are forced in the pss analysis. If a large number of harmonics is specified, runtime and memory requirements get large. Unless you really need a lot of harmonics, do not set a large number.</p>

<h3>
<a id="pgfId-1079660"></a>Accuracy Defaults (err<a id="marker-1204758"></a>preset)</h3>

<p>
<a id="pgfId-1079661"></a>Errpreset sets the default values for six options in order to tune the simulator for your needs. Use <code>conservative</code> if you need high accuracy. <code>Moderate</code> is a general-purpose setting, and should be used for most simulations. <code>Liberal</code> is not recommended.</p>
<p>
<a id="pgfId-1079798"></a>The following chart summarizes the options and the values for driven circuits.</p>

<p>
<a id="pgfId-1078861"></a></p>
<table class="webflareTable" id="#id1079742">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079744"></a><strong>errpreset</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079746"></a><strong>Reltol<a href="#pgfId-1079990">1</a></strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079748"></a><strong>Relref</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079750"></a><strong>Method</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079752"></a><strong>Lteratio<a href="#pgfId-1080016">2</a></strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079861"></a><strong>Steadyratio</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079863"></a><strong>Maxstep</strong></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079754"></a><strong>Liberal</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079756"></a>1e-3</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079758"></a>Sigglobal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079760"></a>Traponly</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079762"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079865"></a>0.001</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079867"></a>Period/50</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079764"></a><strong>Moderate</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079766"></a>1e-3</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079768"></a>Alllocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079770"></a>Gear2only</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079772"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079869"></a>0.001</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079871"></a>Period/200</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079774"></a><strong>Conservative</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079776"></a>1e-4</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079778"></a>Alllocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079780"></a>Gear2only</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079782"></a>10 or 3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079873"></a>0.01</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1079875"></a>Period/200</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1080039"></a>For example, if <code>errpreset</code> is set to <code>moderate</code> and <code>reltol</code> is set to <code>3e-4</code>, <code>reltol</code> during the tstab interval is <code>3e-4</code>, and <code>reltol</code> in the shooting window is also <code>3e-4</code> because it is smaller than <code>1e-3</code>, which is the maximum value that can be used in the shooting window. <code>Lteratio</code> is 3.5 for the tstab interval and for the shooting window.</p>
<p>
<a id="pgfId-1080040"></a>If <code>errpreset</code> is <code>conservative</code> and <code>reltol</code> is set to <code>3e-4</code>, then <code>reltol</code> in the tstab interval is <code>3e-4</code>, and in the shooting window it is <code>1e-4</code>. This is because the maximum value for <code>reltol</code> in the shooting window for <code>conservative</code> is <code>1e-4</code>. <code>Lteratio</code> is <code>10</code> for both the tstab interval and the shooting window.</p>
<p>
<a id="pgfId-1080041"></a>For oscillators, the defaults are slightly different.</p>

<p>
<a id="pgfId-1078868"></a></p>
<table class="webflareTable" id="#id1080054">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080056"></a><strong>errpreset</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080061"></a><strong>Reltol<a href="#pgfId-1080060">3</a></strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080063"></a><strong>Relref</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080065"></a><strong>Method</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080067"></a><strong>Lteratio<a href="#pgfId-1080070">4</a></strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080072"></a><strong>Steadyratio</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080074"></a><strong>Maxstep</strong></p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080076"></a><strong>Liberal</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080078"></a>1e-3</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080080"></a>Sigglobal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080082"></a>Traponly</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080084"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080086"></a>0.001</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080088"></a>Period/50</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080090"></a><strong>Moderate</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080092"></a>1e-4</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080094"></a>Alllocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080096"></a>Gear2only</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080098"></a>3.5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080100"></a>0.001</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080102"></a>Period/200</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080104"></a><strong>Conservative</strong></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080106"></a>1e-5</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080108"></a>Alllocal</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080110"></a>Gear2only</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080112"></a>10</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080114"></a>0.1</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1080116"></a>Period/200</p>
</td>
</tr>
</tbody></table>
<h3>
<a id="pgfId-1080268"></a>PSS Shooting Convergence</h3>

<p>
<a id="pgfId-1080269"></a>As discussed earlier, the waveform is iteratively solved for during the shooting window. This means that exact solutions are never obtained because there is another iteration that will produce a closer answer. The iterations must stop when the solution is accurate enough. This is set using the convergence options <code>reltol</code>, <code>vabstol</code>, <code>iabstol</code>, <code>lteratio</code>, <code>errpreset</code>, and an option called <code>steadyratio</code>. The iterations stop when all the voltages in all the nodes and all the currents in all the branches match at the beginning and end within the following tolerance:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1080270"></a>(Convergence Criteria) * Lteratio * Steadyratio</pre>

<p>
<a id="pgfId-1080271"></a>The convergence criteria depend on the setting of <code>reltol</code>, <code>vabstol</code>, <code>iabstol</code>, <code>errpreset</code>, and the setting of <code>relref</code>. <code>Lteratio</code> defaults to <code>3.5</code> or <code>10</code>, depending on the setting of <code>reltol</code> and <code>errpreset</code>.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1300146"></a>If the PSS analysis does not converge, the unconverged solution is not saved.</div>
<p>
<a id="pgfId-1080272"></a><code>Steadyratio</code> depends on the setting of <code>errpreset</code>. For more details regarding this option see <a href="Chap4.html#96566">Steadyratio (Shooting Only)</a>.</p>

<h2>
<a id="pgfId-1080344"></a>ADE Implementation and Numerical Noise Floor</h2>

<p>
<a id="pgfId-1080352"></a>Next, we will discuss how SpectreRF is implemented into ADE Explorer and also provide information about how the simulation accuracy is affected by setting a number of simulator options. </p>
<p>
<a id="pgfId-1080353"></a>A transistor-level LNA is shown below.</p>

<p>
<a id="pgfId-1080345"></a></p>
<div class="webflare-div-image">
<img width="668" height="616" src="images/Chap4-28.gif" /></div>

<p>
<a id="pgfId-1080346"></a>The input frequencies for the transistor-level LNA are set to 2.4 GHz and 2.5 GHz, as shown in the ADE Explorer window below.</p>

<p>
<a id="pgfId-1080148"></a></p>
<div class="webflare-div-image">
<img width="668" height="558" src="images/Chap4-29.gif" /></div>

<p>
<a id="pgfId-1080417"></a>Note that this setup is approaching the limit of what pss can do because 25 periods of the higher input frequency need to be simulated in the shooting window. If the frequencies were closer together, qpss or hb would be much more efficient.</p>
<p>
<a id="pgfId-1080418"></a>The pss <em>Choosing Analyses</em> form is shown below.</p>

<p>
<a id="pgfId-1080155"></a></p>
<div class="webflare-div-image">
<img width="668" height="793" src="images/Chap4-30.gif" /></div>

<p>
<a id="pgfId-1080491"></a> All the sources in the circuit are read in to the <em>Fundamental Tones</em> table at the top of the <em>Choosing Analyses</em> form. When the <em>Auto Calculate </em>option is selected, ADE Explorer calculates the periodicity of the circuit and displays it in the grayed-out <em>Beat Frequency</em> field. </p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1096423"></a>When <em>Auto Calculate</em> is selected, manual editing of the <em>Beat Frequency</em> field is not allowed.</div>
<p>
<a id="pgfId-1219097"></a>50 harmonics have been set to allow the second harmonic of the 2.5GHz tone to be calculated.</p>
<p>
<a id="pgfId-1219109"></a>Driven circuits usually do not require tstab to be set. For circuits that do have tstab set simulation options can be changed at different times during the tstab interval by using dynamic parameters. This example shows reltol starting very loose, and then switching to a more accurate value at 10nsec. The setting of reltol during tstab is shown in the spectre output window.</p>

<p>
<a id="pgfId-1223652"></a></p>
<div class="webflare-div-image">
<img width="643" height="757" src="images/Chap4-31.gif" /></div>
<h2>
<a id="pgfId-1096604"></a><a id="94126"></a>Accuracy and Settin<a id="marker-1206428"></a>gs and Trade-Offs</h2>

<p>
<a id="pgfId-1080517"></a>A comparison is made for several settings. Moderate and conservative settings are used.</p>
<p>
<a id="pgfId-1080518"></a>After that, values for <em>reltol</em> and <em>vabstol</em> are specified, as shown below in the <em>Simulator Options</em> form. This form can be opened by selecting <em>Simulation</em> - <em>Options</em> - <em>Analog </em>in ADE Explorer.</p>

<p>
<a id="pgfId-1080162"></a></p>
<div class="webflare-div-image">
<img width="668" height="477" src="images/Chap4-32.gif" /></div>

<p>
<a id="pgfId-1080570"></a>First, <code>reltol=1e-5</code> and <code>vabstol=3e-8</code> are used, and then <code>reltol=1e-6</code> and <code>vabstol=1e-8</code> are used. Finally, a lot of timepoints are forced by setting the maximum harmonics to 1000. For this test, <code>reltol</code> and <code>vabstol</code> are kept at <code>1e-6</code> and <code>1e-8</code>.</p>
<p>
<a id="pgfId-1080571"></a>The spectral result from all the simulations is shown below.</p>

<p>
<a id="pgfId-1080169"></a></p>
<div class="webflare-div-image">
<img width="668" height="470" src="images/Chap4-33.gif" /></div>

<p>
<a id="pgfId-1080614"></a>A marker is placed at 1.1 GHz in order to measure the numerical noise floor of the simulation. </p>
<p>
<a id="pgfId-1096942"></a>The top is with <code>errpreset</code> set to <code>moderate</code>.</p>
<p>
<a id="pgfId-1096943"></a>The second is <code>conservative</code>.</p>
<p>
<a id="pgfId-1096944"></a>The third is <code>reltol=1e-5</code> and <code>vabstol=3e-8</code>.</p>
<p>
<a id="pgfId-1080618"></a>The fourth is <code>reltol=1e-6</code> and <code>vabstol=1e-8</code>.</p>
<p>
<a id="pgfId-1080619"></a>The final one is with 1000 harmonics set. The display is scaled to show only the first 30 harmonics.</p>
<p>
<a id="pgfId-1080620"></a>Note that the numerical noise floor drops with the steps that are taken to increase accuracy. The runtime and memory requirement also increases for each successive level of accuracy.</p>
<p>
<a id="pgfId-1080637"></a>This is a good general series of steps to improve the accuracy of a shooting simulation. The basic process is to set up and run the simulation, make the accuracy better, and run the simulation again. If the answer does not change, then the original setting is good enough. If the answer changes, increase the accuracy again. Continue until you find the setting of the options that cause the answer to be accurate without excessive runtime.</p>
<p>
<a id="pgfId-1080638"></a>Note that there is a practical minimum numerical noise floor at about -135dBm. Although it might be possible to lower the noise floor a bit more by taking even more timepoints in the simulation, the time and memory requirements usually are not worth the lower noise floor. Still, -142dBm is a pretty good numerical noise floor of about 3e-8 volts RMS.</p>
<p>
<a id="pgfId-1080639"></a>Additionally, you might try using the <em>highorder</em> option to improve accuracy. This is shown in the pss options section. This option requires significantly longer to run but produces a more accurate result.</p>

<h2>
<a id="pgfId-1080652"></a>Which Engine Should be Selected?</h2>

<p>
<a id="pgfId-1080653"></a>Conceptually, shooting and harmonic balance produce the same answer as long as enough harmonics and/or a high enough oversample factor are used in hb and the accuracy of shooting is controlled well enough for your requirement. In general, if the accurate waveform is desired for a system with square waves in the solution, then shooting should be selected. If the system is very nonlinear like a sample-and-hold or a switched-capacitor filter, shooting should always be used. If the waveforms are nearly sinusoidal, then harmonic balance should be selected. If it is something in between, then try both engines and use the one that produces the fastest runtime. Note that even for square wave systems, harmonic balance can be used effectively as long as the time-domain waveform is not desired, and oversample factor is set to at least four. For more details on harmonic balance, see <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance&#8221;</a>.</p>

<h3>
<a id="pgfId-1080176"></a>Important Outputs in the Spectre.out File</h3>
<p>
<a id="pgfId-1080183"></a></p>
<div class="webflare-div-image">
<img width="668" height="794" src="images/Chap4-34.gif" /></div>

<p>
<a id="pgfId-1080190"></a>The circuit inventory (highlighted in red above) lists the contents of the circuit.</p>
<p>
<a id="pgfId-1080774"></a>If APS is used, it is noted in the section highlighted in green above.</p>
<p>
<a id="pgfId-1080789"></a>The section highlighted in blue below contains the option settings for tstab simulation.</p>
<p>
<a id="pgfId-1254054"></a>The section highlighted in brown below lists the options for shooting iterations.</p>

<p>
<a id="pgfId-1080804"></a></p>
<div class="webflare-div-image">
<img width="668" height="729" src="images/Chap4-35.gif" /></div>

<p>
<a id="pgfId-1080956"></a></p>
<p>
<a id="pgfId-1254412"></a>When the <code>Conv_Norm</code> number gets less than one, the iterations stop. In this case, the error is 6.03e-3 times the maximum allowed, and the largest mismatch is I0.I28.I6.Is1 terminal 1, and the mismatch is 10.1339 microamps (highlighted in green below).</p>

<p>
<a id="pgfId-1081000"></a></p>
<div class="webflare-div-image">
<img width="668" height="763" src="images/Chap4-36.gif" /></div>

<p>
<a id="pgfId-1081060"></a>When the Conv_Norm is less than one, the iterations stop (highlighted in red above).</p>
<p>
<a id="pgfId-1081061"></a>The total number of timesteps in the solution is listed (highlighted in blue above). The first listing is the number of timesteps in the tstab interval. The second listing is the number of timepoints in the shooting interval.</p>
<p>
<a id="pgfId-1081062"></a>CPU time, elapsed (clock) time, and memory statistics are listed (highlighted in pink above). When APS is used with multi-threading, the CPU time is generally larger than the elapsed time. CPU time totals the usage of all CPUs.</p>

<h2>
<a id="pgfId-1081075"></a>Guidelines for Setting up Osci<a id="marker-1206488"></a>llators for Simulation</h2>
<h3>
<a id="pgfId-1081076"></a>Beat frequency</h3>

<p>
<a id="pgfId-1081077"></a>Enter a frequency that is between 0.25 * actual frequency to 4 * actual frequency. As long as the specified frequency is within this range, the solution should be possible.</p>

<h3>
<a id="pgfId-1081078"></a>Tstab</h3>

<p>
<a id="pgfId-1081079"></a>Tstab is the time interval that is used to start the oscillator and allows the oscillations to build up to a near steady-state amplitude. <em>Decide automatically</em> is recommended for the <em>Run transient?</em> selection to automate the tstab setting.</p>
<p>
<a id="pgfId-1219172"></a>Dynamic parameters are available during the tstab interval. Dynamic parameters allow changing option settings during tstab and are typically used to reduce the accuracy (which speeds up the simulation) at the beginning and then tighten the accuracy at the end to improve convergence. </p>

<h3>
<a id="pgfId-1081080"></a><a id="81120"></a>Different ways to start the oscillator</h3>

<p>
<a id="pgfId-1081048"></a>The first thing to do when simulating oscillators is to reliably start the oscillator. Different methods are used for different types of oscillators. These are:</p>
<ul><li>
<a id="pgfId-1081199"></a><strong>Moderate Q Feedback Oscillators</strong>: If the oscillator is a feedback oscillator, then the linear oscillator initial condition (oscic) is highly recommended. When this is selected, the beat frequency needs to be within 0.5 * actual frequency to 1.5 * actual frequency. This performs a variation of the linear stability analysis after the DC analysis for the first timepoint in the tstab interval. It provides a very good estimate of the oscillating frequency and amplitude at every node and this estimate is used at the beginning of the tstab interval. This allows the duration of the tstab period to be about 5 to 10 periods of the oscillator frequency for normal Q circuits. In many cases, the tstab time can be set to zero. Doing this, causes the pss analysis to start with the estimated frequency and amplitude from the linear oscic.<br />
<a id="pgfId-1129366"></a>Another way to start the oscillator is to use a piecewise linear source as the power supply. At time zero, the voltage is about 80% to 90% of nominal. The second timepoint should be about one half the period of the oscillator and the full power supply voltage. The bump in voltage causes a voltage transient that starts things up. For differential oscillators, do this on one side of the differential system.<br />
<a id="pgfId-1081202"></a>A third way is to add a current pulse to a point in the circuit that causes the oscillation to start using an ipulse component from <em>analogLib</em>. Specify a single pulse that is large enough to get things started. This is accomplished by adding an ipulse component from <em>analogLib</em> and specifying the zero value to zero, the one value to be about a milliamp, the rise and fall times to about one tenth of a period, and the pulse width to about three tenths of a period. Leave the period field blank to indicate that only a single pulse should be generated. The ipulse is an ideal open when the current is zero, so it does not load the circuit.<br />
<a id="pgfId-1081466"></a>For all the different methods other than the linear oscic, tstab must be long enough for the oscillator to reach near steady-state operation. For most oscillators, this is about 100 periods of the oscillation frequency.</li><li>
<a id="pgfId-1081506"></a><strong>High Q Oscillators</strong>: For high Q oscillators, harmonic balance is recommended. The reason for this is that in harmonic balance, the motional equivalent circuit (electrical representation of the crystal) goes directly into the frequency domain representation of the circuit. In shooting, there is always a small numerical integration error in the solution. For high Q circuits, this error causes uncertainty in the pss result that can cause the pss analysis to become inaccurate.</li><li>
<a id="pgfId-1081536"></a><strong>Ring Oscillators</strong>: For ring oscillators, start the oscillation by specifying initial conditions at the output of one stage of the ring. Force the output of this stage to low or high with the initial conditions. This will force the oscillator into a known state at time zero, and then at the beginning of the transient, the node(s) will begin the switch to the other state, thereby starting the oscillator. Tstab should be set to about 1 or 2 periods.</li></ul>





<p>
<a id="pgfId-1081544"></a>For all the different methods other than the linear oscic, tstab must be long enough for the oscillator to reach near steady-state operation. For most oscillators, this is about 100 periods of the oscillation frequency. When using linear oscic, this can usually be shortened to about 10 periods or even zero.</p>
<p>
<a id="pgfId-1097785"></a>As usual for any pss analysis, first the tstab interval is simulated. Then one period of the frequency supplied in the pss <em>Choosing Analyses</em> form is simulated. For oscillators, an additional four periods of the specified frequency in the pss setup is simulated. In the last interval, Spectre checks for possible divided-down frequencies. If these frequencies are found, Spectre adjusts the frequency/period to correspond to the new lower frequency and tries to solve for that lower frequency. </p>

<h3>
<a id="pgfId-1081558"></a>Saveinit- A way to save the startup waveform</h3>

<p>
<a id="pgfId-1081559"></a>For many oscillators, it is desirable to see the actual startup waveform in order to verify that the startup is robust. To see the startup waveform, select <em>yes</em> for the <em>Save Initial Transient Results (saveinit)</em> property in the <em>Choosing Analyses</em> form. This will write the initial waveforms to the output data for viewing.</p>

<h3>
<a id="pgfId-1081560"></a>Oscillator Node- Used to estimate the frequency for the first pss iteration</h3>

<p>
<a id="pgfId-1081561"></a>When linear oscic is used, the oscillator node must be a node that is inside the feedback system for the oscillator. This is used to estimate the initial oscillating frequency. If the oscillator is differential, specify a pair of nodes in a symmetrical location in the oscillator.</p>
<p>
<a id="pgfId-1081562"></a>Regardless of the setting for oscic, the oscillator node is used at the end of the tstab interval to determine an initial estimate of the actual oscillation frequency.</p>
<p>
<a id="pgfId-1097894"></a>If the amplitude on this node drops to less than 1mV peak, an error is displayed indicating that the amplitude of the oscillator node is too small to properly estimate the frequency, and the simulation stops. If the frequency gets to 1000 * frequency specified, an error is displayed indicating that the frequency is too high to be reliable.</p>

<h2>
<a id="pgfId-1097895"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1081585"></a>Below is an example ADE Explorer setup for an oscillator circuit. Let us set up a PSS analysis, run the simulation, and plot the output waveform.</p>
<p>
<a id="pgfId-1081586"></a>Consider an oscillator shown below.</p>

<p>
<a id="pgfId-1098164"></a></p>
<div class="webflare-div-image">
<img width="668" height="599" src="images/Chap4-37.gif" /></div>

<ol><li>
<a id="pgfId-1098165"></a>Select <em>Analyses</em> - <em>Choose</em> to open the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1098169"></a><div class="webflare-div-image">
<img width="668" height="805" src="images/Chap4-38.gif" /></div></li><li>
<a id="pgfId-1254670"></a>Specify an estimate of the oscillation frequency (highlighted in red above). If you use <em>linear</em> oscic, the estimate should be between 0.5 * actual oscillating frequency to 1.5 * actual oscillating frequency. Otherwise, it can be between 0.25 and 4 times the actual operating frequency.</li><li>
<a id="pgfId-1254671"></a>Select <em>Conservative</em> (recommended) for oscillators (highlighted in green above).</li><li>
<a id="pgfId-1289037"></a>Select the Calculate initial conditions automatically check box.</li><li>
<a id="pgfId-1289038"></a>The oscillator node should be inside the feedback system if <em>linear</em> oscic is used (highlighted in blue above). If the <em>default</em> oscic is used, the node just needs a signal on it.</li><li>
<a id="pgfId-1289039"></a><em>Select linear</em> oscic (recommended) for feedback oscillators (highlighted in purple above). <br />
<a id="pgfId-1289040"></a><em>default</em> oscic starts from the time zero timepoint in the tstab interval.</li></ol>










<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1081729"></a>For a driven circuit, the process is the same except that the oscillator node and the oscillator initial condition fields are not shown.</div>

<h3>
<a id="pgfId-1081622"></a>Spectre Output File (Oscillators)</h3>
<p>
<a id="pgfId-1081629"></a></p>
<div class="webflare-div-image">
<img width="498" height="616" src="images/Chap4-39.gif" /></div>

<p>
<a id="pgfId-1080841"></a>The estimate of the oscillation frequency from the linear oscic (highlighted in red above) is shown first.</p>

<p>
<a id="pgfId-1080197"></a></p>
<div class="webflare-div-image">
<img width="668" height="756" src="images/Chap4-40.gif" /></div>

<p>
<a id="pgfId-1080204"></a>The frequency from the end of the tstab interval (highlighted in red above) is displayed next.</p>

<p>
<a id="pgfId-1080211"></a></p>
<div class="webflare-div-image">
<img width="668" height="617" src="images/Chap4-41.gif" /></div>

<p>
<a id="pgfId-1203452"></a>The solution frequency and the number of timesteps (highlighted in red above) are shown. The first listing of <em>accepted pss timesteps</em> is the number of timesteps in the tstab interval. The second number is the number in the shooting interval. </p>

<h3>
<a id="pgfId-1203453"></a>Dynamic Parameters in tstab</h3>

<p>
<a id="pgfId-1219430"></a>Simulator options can be changed at different times during the tstab interval using dynamic parameters. This is typically used to loosen convergence tolerances which makes the simulation less accurate but faster at the beginning of tstab and then tightening the tolerances at the end to improve convergence. Single options are supported directly in the <em>Choosing Analyses</em> form.</p>

<h3>
<a id="pgfId-1219338"></a>Oscillator Tunin<a id="marker-1206539"></a>g Mode</h3>

<p>
<a id="pgfId-1201927"></a>Oscillator tuning mode is provided to tune the oscillator to a desired frequency and then run the selected small-signal analyses. This is useful for sweeps and for Monte Carlo simulations. To run an oscillator tuning analysis, perform the following:</p>
<ol><li>
<a id="pgfId-1201928"></a>Open an oscillator circuit, and start ADE Explorer. Open the <em>Choosing Analyses</em> form, and select <em>pss</em> analysis.</li><li>
<a id="pgfId-1201929"></a>Fill out the form as usual, except for the following:<ol><li>
<a id="pgfId-1201930"></a>In the <em>Fundamental Frequency</em> field, type the desired frequency target.</li><li>
<a id="pgfId-1201931"></a>Click the check box next to <em>Enable tuning mode analysis</em>.</li><li>
<a id="pgfId-1201932"></a>Select whether you want to tune a variable, temperature, or a component parameter. the example below shows a component parameter.<br />
<a id="pgfId-1203553"></a><div class="webflare-div-image">
<img width="541" height="781" src="images/Chap4-42.gif" /></div></li><li>
<a id="pgfId-1201938"></a>Enable the desired small-signal analyses.</li><li>
<a id="pgfId-1201942"></a>Run the analyses. When the simulation completes, open the <em>Direct Plot Form</em> from ADE Explorer.<br />
<a id="pgfId-1203666"></a><div class="webflare-div-image">
<img width="449" height="494" src="images/Chap4-43.gif" /></div></li></ol></li></ol>













<h2>
<a id="pgfId-1082076"></a>PSS Options</h2>

<p>
<a id="pgfId-1082077"></a>The option<a id="pss_options"></a>s are divided into five tabs: <em>Convergence</em>, <em>Accuracy</em>, <em>Output</em>, <em>Reuse</em>, and <em>Misc</em> (miscellaneous).</p>
<p>
<a id="pgfId-1099189"></a>The options are shown in the order that they occur in the options form in ADE Explorer.</p>

<h3>
<a id="pgfId-1099191"></a>Convergence tab</h3>
<p>
<a id="pgfId-1082265"></a></p>
<div class="webflare-div-image">
<img width="668" height="476" src="images/Chap4-44.gif" /></div>
<h4>
<a id="pgfId-1082081"></a>I<a id="marker-1204959"></a>c (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1099499"></a>Initial conditions can be specified graphically by selecting <em>Simulation</em> - <em>Convergence Aids</em> - <em>Initial Condition</em> in ADE Explorer. Initial conditions can also be specified from a file using the <em>readic</em> property. Capacitors and inductors have the initial condition properties in the property list for the component. For capacitors, this is an initial voltage across the capacitor, and for inductors, it is an initial current in the inductor. The default is to observe all the initial conditions in the DC analysis that is used as the time-zero timepoint. The initial conditions force a voltage or current to be present in the time-zero solution. The initial conditions are released for the rest of the transient simulation in the tstab interval. The <em>ic</em> option controls the initial conditions that should be observed in the time-zero timepoint. <em>all</em> is the default. <em>dev</em> means that only the initial conditions on capacitors and inductors are observed. <em>node</em> means that only the initial conditions on a node are observed. <em>dc</em> means that no initial conditions are observed. The example below shows the ic option set to <em>node</em>.</p>

<p>
<a id="pgfId-1099503"></a></p>
<div class="webflare-div-image">
<img width="668" height="40" src="images/Chap4-45.gif" /></div>
<h4>
<a id="pgfId-1082240"></a>Skip<a id="marker-1204971"></a>dc (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1082594"></a>In some cases, the time-zero timepoint DC analysis does not converge. Instead of stopping the simulation, <em>skipdc</em> allows the tstab simulation to continue using an assumed solution for the time-zero timepoint. The default is <em>no</em> and a DC analysis is run to get the initial timepoint. <em>yes</em> means skip the DC solution, and proceed directly to the tstab simulation. All the nodes with initial conditions specified start at the initial condition value. Nodes with batteries start at the battery voltage. Nodes with no initial conditions start at zero volts. For <code>skipdc=yes</code>, the signal sources start as specified immediately in the tstab simulation. <em>sigrampup</em> uses the same assumptions for the starting voltages as <em>yes</em> does, but the start time is set to negative one tenth of the stop time for the tstab interval. At this time, the signal source time-varying part starts at zero and linearly ramps up to the full value at time = zero. After time = zero, the sources have the full amplitude time-varying part. The example below shows the <em>skipdc</em> option set to <em>sigrampup</em>.</p>

<p>
<a id="pgfId-1082595"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap4-46.gif" /></div>
<h4>
<a id="pgfId-1082293"></a>Rea<a id="marker-1204981"></a>dic (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1099713"></a>This specifies an ascii file that contains two columns to be read as initial conditions. The first column is the node name. The second column is the voltage value. If the entry does not start with / (slash), the entry is located in the netlist directory. To find the netlist directory, select <em>Setup</em>- <em>Simulator/Directory/Host</em> in ADE Explorer. Look in the <em>Project Directory</em> field for the location of the simulation directory. Navigate to that directory and then to the <span class="webflare-courier-new" style="white-space:pre"><em>&lt;Circuit Name&gt;</em></span><code>/spectre/</code><span class="webflare-courier-new" style="white-space:pre"><em>&lt;schematic or config&gt;</em></span><code>/netlist</code> directory. You can also click (<img width="30" height="24" src="images/Chap4-47.gif" /><span>) and browse to the directory. An example is shown below.</span></p>
<p>
<a id="pgfId-1082620"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-48.gif" /></div>
<h4>
<a id="pgfId-1082420"></a>Rea<a id="marker-1204990"></a>dns (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1082422"></a>This specifies an ascii file with the same format as an ic file that is used as nodesets for the time-zero DC solution. Nodesets do not force a voltage to be held for the time-zero solution. Instead, they are a way of speeding up the time-zero calculation. As a suggestion, set the <em>write</em> option and the <em>readns</em> option to the same filename. The <em>write</em> option writes the time-zero solution to a file. When this is used as a starting point, many fewer iterations are needed for the time-zero point to converge. An example is shown below.</p>

<p>
<a id="pgfId-1082657"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-49.gif" /></div>
<h4>
<a id="pgfId-1082448"></a>Cm<a id="marker-1204998"></a>in (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1082450"></a><em>cmin</em> can be used to improve convergence in the tstab and shooting intervals for shooting and for the tstab interval for harmonic balance. If a value is set for <em>cmin</em>, a capacitor with this value is added to every node with the other terminal of the capacitor connected to the global ground node. If a 10f to 50f capacitor is added, this prevents instantaneous changes from occurring from timepoint to timepoint, thus improving the convergence at the cost of adding non-physical capacitors to the circuit. An example with 10 femtoFarads is shown below. Note that if 10 is entered, a 10 Farad capacitor is added from every node to ground. Remember the multiplier in the entry. An example is shown below.</p>

<p>
<a id="pgfId-1082689"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-50.gif" /></div>
<h4>
<a id="pgfId-1111542"></a>Max<a id="marker-1205010"></a>iters (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1082492"></a>The transient analysis for tstab (for both shooting and hb) and shooting interval iterate to a solution at each timepoint. <em>maxiters</em> specifies the maximum number of iterations before the timestep is cut for another try at convergence. In some cases, model parameters can cause discontinuities in the device current or capacitance. If this occurs, the change in the circuit condition can be large enough to require more than the five iterations that are the default. Specifying <em>maxiters</em> to the 40 to 100 range usually allows the simulator to converge in spite of the discontinuity. An example with <em>maxiters</em> set to 40 is shown below.</p>

<p>
<a id="pgfId-1082747"></a></p>
<div class="webflare-div-image">
<img width="668" height="32" src="images/Chap4-51.gif" /></div>
<h3>
<a id="pgfId-1082151"></a>Accuracy Tab </h3>

<p>
<a id="pgfId-1080239"></a>The <em>Accuracy</em> tab is split into two categories: INTEGRATION METHOD PARAMETERS and ACCURACY PARAMETERS. For each parameter, the most commonly used settings are discussed. </p>

<p>
<a id="pgfId-1080246"></a></p>
<div class="webflare-div-image">
<img width="668" height="816" src="images/Chap4-52.gif" /></div>
<h4>
<a id="pgfId-1082939"></a>Meth<a id="marker-1205029"></a>od (Shooting only)</h4>

<p>
<a id="pgfId-1082940"></a>This option controls the integration method for the shooting window. Note that harmonic balance does not have the <em>method</em> option because the solver works in the frequency domain. The default value for the shooting window is determined by the setting of <em>errpreset</em>. For <em>moderate</em> and <em>conservative</em>, the default is <em>gear2only</em>. For <em>liberal</em> it is <em>traponly</em>. Generally <em>gear2only</em> is preferred because of the absence of trapezoidal ringing inherent in the <em>trap</em> (trapezoidal) method. Note that <em>liberal</em> is not recommended for RF simulation.</p>
<p>
<a id="pgfId-1082941"></a>In the case where you are simulating a crystal oscillator with shooting, the method option should be set to <em>traponly</em>. The ringing that is inherent in the trapezoidal method is present and may cause convergence failure because of the unpredictable amplitude of the ringing, which depends on the accumulated total numerical integration error. The benefit of having a method that neither damps nor emphasizes the oscillations is required when simulating high Q oscillators. Even though <code>trap</code> neither emphasizes nor damps the oscillations, the small numerical integration errors caused by the finite timestep can still cause some inaccuracy in the simulation result. Using <em>gear2only</em> is not recommended even though convergence is more likely because the numerical damping inherent in the <em>gear2only</em> method causes unacceptable damping in the resonator, which causes smaller than real amplitude inside the resonator. Because of this, the overall solution will result in an error and can cause inaccurate measurement of the phase noise.</p>

<h4>
<a id="pgfId-1082957"></a>Tstabmet<a id="marker-1205034"></a>hod (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1100301"></a>This option controls the integration method in the tstab interval. The default value is determined by the setting of <em>errpreset</em> and whether the circuit is driven or is an oscillator. For <em>moderate</em> and <em>conservative</em> with a driven circuit, the default is <em>gear2only</em>. For <em>liberal</em> it is <em>traponly</em>. Generally <em>gear2only</em> is preferred because of the absence of trapezoidal ringing inherent in the <em>trap</em> (trapezoidal) method. The default for <em>tstabmethod</em> is <em>traponly</em> for oscillators. <em>traponly</em> is used for oscillators because with the defaults, the tstab interval uses relatively loose convergence options in order to speed up the simulation. This causes relatively long timesteps which for the <em>gear2</em> method would cause noticeable numerical damping. <em>traponly</em> does not numerically damp, therefore, it provides a better estimate of the oscillating frequency and amplitude. An example with <em>tstabmethod</em> set to <em>gear2only</em> is shown below.</p>

<p>
<a id="pgfId-1080253"></a></p>
<div class="webflare-div-image">
<img width="668" height="141" src="images/Chap4-53.gif" /></div>
<h4>
<a id="pgfId-1082994"></a>Relr<a id="marker-1205049"></a>ef (Shooting (tstab and shooting window) and Harmonic Balance (tstab only))</h4>

<p>
<a id="pgfId-1100491"></a>In the order of most to least accurate, the <em>relref</em> settings are <em>pointlocal</em>, <em>alllocal</em>, <em>sigglobal</em>, <em>allglobal</em>. The default for <em>moderate</em> and <em>conservative</em> is <em>alllocal</em> which is preferred. <em>relref</em> is used in the transient analysis in the tstab interval for both shooting and harmonic balance and in the shooting window for shooting. <em>relref</em> is used in hb only for the tstab interval because the solver works in the frequency domain. In some cases, the timestep can collapse to near zero. The symptom is that in the Spectre output window, the percent done number remains the same for many reporting intervals. The solution to this is to set <em>relref</em> to <em>sigglobal</em>, which is slightly less accurate. In the Fourier transform, the noise floor usually degrades by 3 to 6 dB. Another possibility is to use the <em>lteminstep</em> option as described in the <em>AdditionalParams</em> option of the <em>Misc</em> tab.</p>
<p>
<a id="pgfId-1082997"></a>Refer to <a href="Chap4.html#91916">Relref</a> for a detailed discussion on <em>relref</em>.</p>
<p>
<a id="pgfId-1082998"></a>An example with <em>relref</em> set to <em>sigglobal</em> is shown below.</p>

<p>
<a id="pgfId-1083019"></a></p>
<div class="webflare-div-image">
<img width="668" height="36" src="images/Chap4-54.gif" /></div>
<h4>
<a id="pgfId-1083056"></a>Lte<a id="marker-1205059"></a>ratio Shooting ((tstab and shooting window) and Harmonic Balance (tstab only))</h4>

<p>
<a id="pgfId-1083058"></a><em>lteratio</em> is a multiplier for the allowable numerical integration error in the tstab interval and the shooting window. The default is 3.5 or 10 depending on the setting of <em>reltol</em> and <em>errpreset</em>. See <a href="Chap4.html#92939">Controlling Accuracy</a> for details. <em>lteratio</em> cannot be set smaller than 1.0 and is normally between 3.5 and 100. In some cases, the timestep collapses to near zero and setting <em>relref</em> to <em>sigglobal</em> does not fix the problem. In this case, there might be a model discontinuity. To test this, disable numerical integration timestep control by setting <em>lteratio</em> to 1e9. Note that this is an extreme measure not to be used under normal simulations. If the timestep still collapses, there is a discontinuity in one of the models in the circuit. This could be a device model or a Verilog-A model. If it is necessary to set <em>lteratio</em> very large to get the simulation to complete, you must also set <em>maxstep</em> small enough to preserve the accuracy of the simulation. An example with <em>lteratio</em> set to the smallest value of <em>1.0</em> is shown below. Note that <em>lteminstep</em> might also be used to treat this condition. See the <a href="Chap4.html#26535">AdditionalParams (Shooting and Harmonic Balance)</a> section in the <em>Misc</em> tab on how to use this option.</p>

<p>
<a id="pgfId-1078882"></a></p>
<div class="webflare-div-image">
<img width="668" height="36" src="images/Chap4-55.gif" /></div>
<h4>
<a id="pgfId-1083123"></a><a id="96566"></a>Stead<a id="marker-1205068"></a>yratio (Shooting Only)</h4>

<p>
<a id="pgfId-1083125"></a>The maximum mismatch between the beginning and ending values for the voltages and currents in the shooting window is determined by the <em>convergence criteria</em> * <em>lteratio</em> * <em>steadyratio</em>. In some cases, with oscillators, <em>conv_norm</em> drops to a small value and then bumps up and down. However, it never gets less than one, therefore, the convergence fails. In this case, setting <em>steadyratio</em> to 1.0 will cause convergence if the <em>conv_norm</em> number gets to 10 or less. While larger settings of <em>steadyratio</em> may cause the oscillator to converge, more mismatch from beginning to end of the shooting window is allowed, which allows much more startup behavior to be in the solution. Setting <em>steadyratio</em> larger than one is not recommended. An example with <em>steadyratio</em> set to 1.0 is shown below.</p>

<p>
<a id="pgfId-1078889"></a></p>
<div class="webflare-div-image">
<img width="668" height="43" src="images/Chap4-56.gif" /></div>
<h4>
<a id="pgfId-1083163"></a>Steadyratio (Harmonic Balance Only)</h4>

<p>
<a id="pgfId-1083165"></a><em>steadyratio</em> in harmonic balance is used as a multiplier for the maximum delta that is allows from iteration to iteration. The default is 1.0. In some cases, <em>resd_norm</em> falls below one which indicates that the KCL check at each node is passing, but the Delta Norm is greater than one, which indicates that the motion from iteration-to-iteration is larger than the maximum allowed. Only in this case should <em>steadyratio</em> be set larger than one. Set it just larger than the value of the<em> resd_norm</em>. In this case, the smaller harmonics are changing relatively a lot, but because they are small, they do not affect the accuracy of the solution.</p>

<h4>
<a id="pgfId-1083167"></a>Itr<a id="marker-1205075"></a>es (Shooting Only)</h4>

<p>
<a id="pgfId-1083169"></a>Use the default for this option. <em>itres</em> controls the precision (number of digits solved for) in the first iteration. The default is 1e-4 which causes 4 digits of resolution in the first iteration. Subsequent iterations are solved with more precision.</p>

<h4>
<a id="pgfId-1083170"></a>Itres (Harmonic Balance Only)</h4>

<p>
<a id="pgfId-1083172"></a>The default for<em> itres</em> for harmonic balance is 0.9, which allows up to 90% difference from the exact solution on the first iteration. Although this seems large, solving exactly for the first iteration can frequently cause non-convergence. As the iterations progress, the difference is reduced so that at the solution, full accuracy is achieved. In the case of very linear systems like an amplifier, tightening <em>itres</em> to the 1e-2 to 1e-4 range can reduce the number of frequency domain iterations and runtime. Also, when transient assist is used, the fft provides an excellent starting point for the first iteration. Therefore, setting <em>itres</em> to the 1e-2 to 1e-4 range can also reduce the number of frequency domain iterations and the runtime.</p>

<h4>
<a id="pgfId-1083331"></a>Resgmr<a id="marker-1205085"></a>escycle (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1083332"></a>Leave this option at the default.</p>

<h4>
<a id="pgfId-1083333"></a>Inexa<a id="marker-1205090"></a>ct Newton (Shooting Only)</h4>

<p>
<a id="pgfId-1083334"></a>In the simulation time between iterations, an estimate is made for the starting point for the next iteration (shooting) or the harmonic content for the next iteration (hb). <em>inexactNewton</em> causes an inexact solution for the matrix that calculates the next starting point to be calculated. In some cases, solving the matrix exactly on the first iteration can cause the iterative solver to need many iterations to achieve convergence. Setting i<em>nexactNewton</em> causes a different series of iterations, which may speed up the simulation. The inexactness is reduced as the iterations progress. Try this option when the time spent between iterations is excessive.</p>

<h4>
<a id="pgfId-1083245"></a>Max<a id="marker-1205095"></a>acfreq (Shooting Only)</h4>

<p>
<a id="pgfId-1083247"></a>If maximum sideband in <em>pac</em>, <em>pnoise</em>, <em>pxf</em>, or <em>psp</em> is set larger than 40, then the <em>pss</em> option <em>maxacfreq</em> needs to be set to the pss beat frequency times the largest maximum sideband number in the small-signal analyses. For example, if <em>pac</em> has 20 for maximum sidebands, <em>pnoise</em> has 70, <em>pxf</em> has 10, and <em>psp</em> has 50, then <em>maxacfreq</em> needs to be set to the pss frequency times 70.</p>
<p>
<a id="pgfId-1083248"></a>Spectre may issue a warning at the beginning of the small-signal analysis like the following one from pnoise if <em>maxacfreq</em> is not set and more than 40 sidebands are specified. If you see this warning in a small-signal analysis, set the pss option <em>maxacfreq</em> to the pss beat frequency times the number of sidebands used in the small-signal analysis. In the example below, <em>maxacfreq</em> should be set to 150 * pss frequency.</p>

<p>
<a id="pgfId-1078896"></a></p>
<div class="webflare-div-image">
<img width="668" height="392" src="images/Chap4-57.gif" /></div>

<p>
<a id="pgfId-1078903"></a>An example of <em>maxacfreq</em> set to 120 GHz is shown below.</p>

<p>
<a id="pgfId-1083386"></a></p>
<div class="webflare-div-image">
<img width="668" height="44" src="images/Chap4-58.gif" /></div>
<h4>
<a id="pgfId-1083415"></a>Maxpe<a id="marker-1205122"></a>riods (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1083417"></a>Any iterative method may fail to converge, and therefore needs an iteration limit. Maxperiods sets the maximum number of times the waveform in the shooting window can be simulated or the number of hb iterations. The default is 20 times for a driven circuit, and 50 times for an oscillator in shooting, and 100 for hb. This is a minimum allowed value for this option. Setting a number less than this default will be ignored by Spectre. This should be set higher only after watching the conv_norm during the pss iterations. If the conv_norm is trending down with no sudden large increase, setting more iterations may allow convergence. If the conv_norm trends down, and then gets large quickly, setting more iterations is very unlikely to help. An example with 100 is shown below.</p>

<p>
<a id="pgfId-1078910"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-59.gif" /></div>
<h4>
<a id="pgfId-1083479"></a>Finitedif<a id="marker-1205133"></a>f (Shooting Only)</h4>

<p>
<a id="pgfId-1083481"></a>Leave this option at the default. This is set automatically when <em>readpss</em> is set. It allows small changes in circuit values when the <em>readpss</em> option is used.</p>

<h4>
<a id="pgfId-1083482"></a>Higho<a id="marker-1205139"></a>rder (Shooting Only)</h4>

<p>
<a id="pgfId-1083484"></a>The normal integration method in the shooting window is <em>gear2only</em> which is a second order integration method. <em>highorder</em> allows the integration method to have up to 16th order numerical integration, thus making the numerical noise floor of the simulation much smaller. When <em>highorder</em> is set to <em>yes</em>, a normal pss is run until convergence is achieved, and then that solution is refined using a higher order integration method. In practice this has value for very linear systems like LNAs, and has smaller value for more complicated blocks like mixers. When <em>highorder</em> is set to <em>yes</em>, there can be considerable time when the highorder algorithm is running, but there is no output to the spectre output window. This is normal for highorder. An example of <code>highorder=yes</code> is shown below.</p>

<p>
<a id="pgfId-1083553"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-60.gif" /></div>

<p>
<a id="pgfId-1083554"></a>Below is the runtime for <code>highorder = no</code>.</p>

<p>
<a id="pgfId-1083555"></a></p>
<div class="webflare-div-image">
<img width="668" height="767" src="images/Chap4-61.gif" /></div>

<p>
<a id="pgfId-1083594"></a>Below is the runtime and the report of the order that was used in the simulation when <em>highorder</em> was set to <em>yes</em>. The runtime is much longer.</p>

<p>
<a id="pgfId-1082176"></a></p>
<div class="webflare-div-image">
<img width="668" height="677" src="images/Chap4-62.gif" /></div>

<p>
<a id="pgfId-1082183"></a>Below is a spectral comparison between standard pss and <em>highorder</em> set to <em>yes</em>. The convergence options are at the default and <em>conservative</em> is selected. The results are for an LNA. The numerical noise floor at 1GHz dropped from -148dBm to -292 dBm.</p>

<p>
<a id="pgfId-1083639"></a></p>
<div class="webflare-div-image">
<img width="668" height="483" src="images/Chap4-63.gif" /></div>

<p>
<a id="pgfId-1083777"></a>Below is a comparison of runtimes for an LNA-Mixer circuit. The first is with <em>highorder</em> set to <em>no</em>, and the second is with <em>highorder</em> set to <em>yes</em>.</p>

<p>
<a id="pgfId-1083650"></a></p>
<div class="webflare-div-image">
<img width="668" height="756" src="images/Chap4-64.gif" /></div>

<p>
<a id="pgfId-1083882"></a></p>

<div class="webflare-div-image">
<img width="668" height="760" src="images/Chap4-65.gif" /></div>

<p>
<a id="pgfId-1083883"></a>The runtime is much longer for <code>highorder=yes</code>, however, it allows the intermodulation products to be resolved. <em>highorder</em> set to <em>yes</em> is shown in the bottom subwindow below.</p>

<p>
<a id="pgfId-1083884"></a></p>
<div class="webflare-div-image">
<img width="668" height="424" src="images/Chap4-66.gif" /></div>
<h4>
<a id="pgfId-1083918"></a>Psara<a id="marker-1205224"></a>tio (Shooting Only)</h4>

<p>
<a id="pgfId-1083920"></a>This is active when <em>highorder</em> is set to <em>yes</em>. The default is <em>one</em>. Setting smaller values produce more accurate solutions at the expense of runtime. Normally, the default should be used. In the example below, <em>psaratio</em> is set to 0.2 and a comparison of the numerical noise floor at 1GHz is made for the LNA used above. The noise floor dropped about 8 dBm when <em>psaratio</em> is lowered.</p>

<p>
<a id="pgfId-1083671"></a></p>
<div class="webflare-div-image">
<img width="668" height="41" src="images/Chap4-67.gif" /></div>

<p>
<a id="pgfId-1083678"></a></p>

<div class="webflare-div-image">
<img width="668" height="466" src="images/Chap4-68.gif" /></div>
<h4>
<a id="pgfId-1083989"></a>Maxord<a id="marker-1205248"></a>er (Shooting Only)</h4>

<p>
<a id="pgfId-1083991"></a>Leave this option at the default of 16. The order is set automatically in the highorder algorithm.</p>
<p>
<a id="pgfId-1083992"></a>This is active when <em>highorder</em> is set to <em>yes</em>. This controls the maximum order used for the highorder method. </p>

<h4>
<a id="pgfId-1083994"></a>Fullpss<a id="marker-1205253"></a>vec (Shooting Only)</h4>

<p>
<a id="pgfId-1083996"></a>Leave this option at the default. At the end of each pss iteration, the settled steady-state point needs to be estimated. Because of the inherently variable timestep, not all the timepoints in the pss solution need to be used to estimate the next starting point. Setting <em>fullpssvec</em> to <em>yes</em> causes all the timepoints to be read in to calculate the starting voltages for the next iteration.</p>

<h4>
<a id="pgfId-1084022"></a>Fdhar<a id="marker-1205268"></a>ms (Shooting Only)</h4>

<p>
<a id="pgfId-1084024"></a><em>fdharms</em> controls the number of harmonics of the pss beat frequency that are exposed to the <code>nport</code>, <code>mtline</code>, and <code>tline</code> components. This should be set to the number of harmonics that are set for maximum harmonics in the pss <em>Choosing Analyses</em> form.</p>

<h3>
<a id="pgfId-1083977"></a>Output Tab</h3>
<p>
<a id="pgfId-1084105"></a></p>
<div class="webflare-div-image">
<img width="668" height="596" src="images/Chap4-69.gif" /></div>
<h4>
<a id="pgfId-1084049"></a>Annot<a id="marker-1205282"></a>ate (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084051"></a>This option controls the level of detail in the output log. The default is <em>status</em>. <em>no</em> produces no output. <em>title</em> produces only the conv_norm number at each iteration. <em>sweep</em> counts down from 10 to zero at each iteration and displays conv_norm. <em>status</em> provides output at 2.5% and then at every 5% of the way to the end at each iteration and the conv_norm number. <em>steps</em> provides output at each timestep in the simulation and the conv_norm number at each iteration. An example is shown below with <em>title</em> selected.</p>

<p>
<a id="pgfId-1083685"></a></p>
<div class="webflare-div-image">
<img width="668" height="34" src="images/Chap4-70.gif" /></div>

<p>
<a id="pgfId-1083692"></a>Below is the Spectre output with <em>title</em> selected.</p>

<p>
<a id="pgfId-1083699"></a></p>
<div class="webflare-div-image">
<img width="549" height="735" src="images/Chap4-71.gif" /></div>

<p>
<a id="pgfId-1083706"></a>Below is the output with <em>sweep</em> selected.</p>

<p>
<a id="pgfId-1083713"></a></p>
<div class="webflare-div-image">
<img width="668" height="754" src="images/Chap4-72.gif" /></div>

<p>
<a id="pgfId-1083720"></a>Below is the output with status <em>selected</em>.</p>

<p>
<a id="pgfId-1083727"></a></p>
<div class="webflare-div-image">
<img width="668" height="754" src="images/Chap4-73.gif" /></div>

<p>
<a id="pgfId-1082190"></a>Below is the output with <em>steps</em> selected.</p>

<p>
<a id="pgfId-1082197"></a></p>
<div class="webflare-div-image">
<img width="668" height="753" src="images/Chap4-74.gif" /></div>
<h4>
<a id="pgfId-1084280"></a>Sa<a id="marker-1205336"></a>ve (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084282"></a>The default is <em>allpub</em>. This saves all the public voltages at all levels of the hierarchy in the schematic. It excludes the internal nodes of the device models. <em>all</em> adds the internal nodes of all the devices. <em>lvl</em> saves all the nodes including the internal nodes of the devices through the level of hierarchy set in the <em>nestlvl</em> option. <em>lvlpub</em> is like <em>lvl</em>, but it does not save the internal nodes. <em>selected</em> saves only the nodes that are specifically saved. In ADE Explorer, this is accomplished using the <em>Outputs</em> - <em>To Be Saved</em> - <em>Select On Schematic</em> and then selecting the nodes and terminals specifically in the schematic. At the netlist level, this is accomplished by using a save statement with a list of names to be saved. </p>

<h4>
<a id="pgfId-1084311"></a>Nes<a id="marker-1205342"></a>tlvl (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084313"></a>If <em>save</em> is set to <em>lvl</em> or <em>lvlpub</em>, this controls the maximum level of hierarchy to be saved. If <em>nestlvl</em> is <em>1</em>, only the top level is saved. If <em>nestlvl </em>is 2, the top level and the next level down are saved. The value for <em>nestlvl</em> can be any integer. The example below shows <em>lvlpub</em> selected that saves two levels of hierarchy.</p>

<p>
<a id="pgfId-1082204"></a></p>
<div class="webflare-div-image">
<img width="668" height="79" src="images/Chap4-75.gif" /></div>
<h4>
<a id="pgfId-1084354"></a>Com<a id="marker-1205351"></a>pression (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084356"></a>Normally, this should not be used for RF simulation. It is not digital compression. For RF simulation, where the input is sinusoidal, the size of the results file will normally double. It is useful only for circuits that are predominantly square wave.</p>

<h4>
<a id="pgfId-1084358"></a>Opp<a id="marker-1205356"></a>oint (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084360"></a>Normally, this should be left at the default of <em>rawfile</em>. It controls where the time-zero operating point solution should be saved to.</p>

<h4>
<a id="pgfId-1084362"></a>Skip<a id="marker-1205361"></a>start (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084364"></a>Normally, this is not used for RF simulation unless there is a very long tstab. It is a way of reducing the amount of data in the output file from the tstab interval by not writing many of the timepoints to the output file. Skipstart controls the simulation time where the skipping is to start. The default is 0 (zero).</p>

<h4>
<a id="pgfId-1084366"></a>Skip<a id="marker-1205366"></a>stop (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084368"></a>Normally, this is not used for RF simulation unless there is a very long tstab. This specifies the simulation time in the tstab interval where the skipping is to stop. The default is the stop time in the tstab interval.</p>

<h4>
<a id="pgfId-1084370"></a>Skipc<a id="marker-1205376"></a>ount (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084372"></a>If <em>skipstart</em> and <em>skipstop</em> are set either <em>skipcount</em> or <em>strobeperiod</em> should be set, but not both. <em>skipcount</em> saves one out of every skipcount points to the output data file. A <em>skipcount</em> of 3 saves one, then skips two points. Skipcount of 10 saves one in 10 timepoints to the output file. The default is 1, which saves every point. An example is shown below. If <em>tstab</em> is 1u, the first 5% and the last 5% has all the datapoints saved, and in between, one out of ten points is saved.</p>

<p>
<a id="pgfId-1082211"></a></p>
<div class="webflare-div-image">
<img width="668" height="183" src="images/Chap4-76.gif" /></div>
<h4>
<a id="pgfId-1084575"></a>Strobep<a id="marker-1205382"></a>eriod (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084577"></a>If <em>skipstart</em> and <em>skipstop</em> are set either <em>skipcount</em> or <em>strobeperiod</em> should be set, but not both. <em>strobeperiod</em> forces simulation datapoints between <em>skipstart</em> and <em>skipstop</em> at the interval of <em>strobeperiod</em>. Below is an example where the first 5% and the last 5% have all the datapoints, and in between there are timepoints at 0.01usecond intervals. Note that the simulator may actually calculate many points between the <em>skipstart</em> and <em>skipstop</em> times, but only the data at the strobe interval is saved to the output file.</p>

<p>
<a id="pgfId-1084421"></a></p>
<div class="webflare-div-image">
<img width="668" height="40" src="images/Chap4-77.gif" /></div>
<h4>
<a id="pgfId-1084615"></a>Strobe<a id="marker-1205390"></a>delay (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084617"></a><em>strobedelay</em> specifies a time after the skipstart point for the beginning of the strobing. <em>strobedelay</em> must be between 0 (zero) and the time set in <em>strobeperiod</em>.</p>

<h4>
<a id="pgfId-1084619"></a>Outputtype (Sh<a id="marker-1205395"></a>ooting Only)</h4>

<p>
<a id="pgfId-1084621"></a>This controls what type of information is to be saved in the output file. The default of <em>all</em> saves both the time and frequency data, but the data can be restricted to either time or frequency domain data.</p>

<h3>
<a id="pgfId-1084432"></a>Reuse Tab</h3>
<p>
<a id="pgfId-1084439"></a></p>
<div class="webflare-div-image">
<img width="668" height="595" src="images/Chap4-78.gif" /></div>
<h4>
<a id="pgfId-1084669"></a>Writ<a id="marker-1205415"></a>e (Shooting Only)</h4>

<p>
<a id="pgfId-1084671"></a><em>write</em> specifies a filename to which the DC solution used as the first timepoint be written to. If the name does not start with slash (/), the file will be written in the <em>netlist</em> directory. To determine the netlist directory location, select <em>Setup</em> - <em>Simulator/Directory/Host</em> in ADE Explorer. The <em>Project Directory</em> field lists the location of the simulation directory. From this directory, the netlist directory is in <em>&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>Circuit Name</em></span><em>&gt;/&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>simulator name</em></span><em>&gt;/&lt;schematic or config&gt;/netlist</em>. </p>
<p>
<a id="pgfId-1084710"></a>An example is shown below.</p>

<p>
<a id="pgfId-1084692"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap4-79.gif" /></div>
<h4>
<a id="pgfId-1084724"></a>Write<a id="marker-1205426"></a>final (Shooting Only)</h4>

<p>
<a id="pgfId-1084726"></a><em>writefinal</em> writes the final pss timepoint from the shooting window (not the final timepoint of the tstab interval) to the filename specified. See the description for <em>write</em> for the location. An example is shown below.</p>

<p>
<a id="pgfId-1084446"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap4-80.gif" /></div>
<h4>
<a id="pgfId-1084769"></a>Swap<a id="marker-1205433"></a>file (Shooting Only)</h4>

<p>
<a id="pgfId-1084771"></a>During the shooting interval, the solution matrices need to be saved in order to calculate the settled voltages of every node for the next iteration. The solution matrices are the internal solution for all the simultaneous equations for the circuit. The solution vector is also saved, and this is the solution voltages and currents. Normally, this data is kept in memory which makes the Spectre process get larger, starting with the second iteration of pss. On 32-bit systems, a maximum process-size of slightly less than 4GB limits the size of the circuit that can be simulated. Even on 64-bit systems, there is a limit set by the amount of memory that is installed on the system that is running Spectre. </p>
<p>
<a id="pgfId-1102983"></a>Swapping that is done by the operating system is inefficient because there is no logical relationship for the swapped memory pages. Setting swapfile to a name causes Spectre to write all the solution matrices to the disk in sequential cylinders so that the read time from the disk is faster than using swapping by the operating system. Disk accesses are inherently much slower than memory accesses, however, using swapfile is considerably faster than swapping in the OS. Using swapfile reduces the size of the Spectre process so that it fits in the memory installed in the machine, or allows larger circuits to be simulated. There is a large amount of data that typically is written to the disk. Because of this, the best choice is to write the data in a disk that is local to the machine. If the data is written over a high-latency network, it might actually be better to use the local swap space. Only a trial can determine which is better. Below is an example of setting <em>swapfile</em>.</p>

<p>
<a id="pgfId-1084453"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap4-81.gif" /></div>

<p>
<a id="pgfId-1084460"></a><em>swapfile</em> writes to the netlist directory by default. To locate the simulation directory, select <em>Setup</em> - <em>Save Options </em>and look in the <em>Simulator Results Directory Location </em>field. Navigate to that directory, and then navigate to the <em>&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>Circuit_Name</em></span><em>&gt;/spectre/&lt;schematic_or_config&gt;/netlist</em> directory. If the size of the swapfile gets larger than 1GB, it splits into multiple files, as shown below.</p>

<p>
<a id="pgfId-1084467"></a></p>
<div class="webflare-div-image">
<img width="668" height="183" src="images/Chap4-82.gif" /></div>
<h4>
<a id="pgfId-1131503"></a>Writeps<a id="marker-1205453"></a>s (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1131504"></a>This option specifies that the full internal state of the pss analysis be written out to the file specified in the option. An example is shown below.</p>

<p>
<a id="pgfId-1131508"></a></p>
<div class="webflare-div-image">
<img width="668" height="41" src="images/Chap4-83.gif" /></div>

<p>
<a id="pgfId-1084481"></a>For large circuits, the file can be quite large.</p>

<p>
<a id="pgfId-1084488"></a></p>
<div class="webflare-div-image">
<img width="668" height="153" src="images/Chap4-84.gif" /></div>
<h4>
<a id="pgfId-1084940"></a>Readp<a id="marker-1205461"></a>ss (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1084942"></a>This option specifies the file to be read in as a starting point for the next pss analysis. If nothing is changed in the circuit, then only one iteration is performed and small-signal analyses can be run with a much faster time for the pss analysis. Changes can be made to the circuit or analysis options as long as the topology of the circuit stays the same. Changes introduce a discontinuity at the beginning of the pss analysis, which might be large enough to cause the pss to not converge. </p>
<p>
<a id="pgfId-1084963"></a>An example of <em>readpss</em> is shown below.</p>

<p>
<a id="pgfId-1084495"></a></p>
<div class="webflare-div-image">
<img width="668" height="37" src="images/Chap4-85.gif" /></div>

<p>
<a id="pgfId-1084502"></a>When a circuit value is changed, a refinement is done automatically. Basically, the pss analysis is re-run. Instead of starting from scratch, it starts from the solution that is in the <em>writepss</em> file. This is shown below.</p>

<p>
<a id="pgfId-1084986"></a></p>
<div class="webflare-div-image">
<img width="668" height="745" src="images/Chap4-86.gif" /></div>
<h4>
<a id="pgfId-1085146"></a>Check<a id="marker-1205487"></a>pss (Shooting Only)</h4>

<p>
<a id="pgfId-1085148"></a>Leave this option at the default of <em>yes</em>. This option is used in conjunction with the <em>readpss</em> option and the <em>highorder</em> option. If <em>readpss</em> is set to a filename, (The pss is read from a file), and if <em>highorder</em> is set to <em>yes,</em> only then is <em>checkpss</em> read. If <em>checkpss</em> is set to <em>yes</em> (default), then any changes in the circuit are observed, and the <em>readpss</em> file serves as the starting point for the pss iterations. If the <em>checkpss</em> option is set to <em>no</em>, then none of the changes to the circuit elements are used. The readpss file is used directly with no changes.</p>

<h4>
<a id="pgfId-1085150"></a>Sav<a id="marker-1205493"></a>eclock (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085152"></a><em>saveclock</em> saves the state of the simulation in the tstab interval at the time interval in seconds specified by <em>saveclock</em>. When the clock time has passed in the tstab interval, the file specified by the option <em>savefile</em> is created. When subsequent clock time intervals have passed, the file is overwritten. Use only one of the save options at a time. The example below shows <em>saveclock</em> set to three minutes.</p>

<p>
<a id="pgfId-1084997"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-87.gif" /></div>
<h4>
<a id="pgfId-1085197"></a>Savepe<a id="marker-1205498"></a>riod (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085199"></a><em>saveperiod</em> saves the state of the simulation in the tstab interval at the simulation time interval in seconds specified by <em>saveperiod</em>. When the simulation time has passed in the tstab interval, the file specified by the option savefile is created. When subsequent simulation time intervals have passed, the file is overwritten. Use only one of the save options at a time. The example below shows <em>saveperiod</em> set to 25 nanoseconds.</p>

<p>
<a id="pgfId-1085004"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-88.gif" /></div>
<h4>
<a id="pgfId-1085246"></a>Saveti<a id="marker-1205506"></a>me (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085248"></a><em>savetime</em> is a list of times in the tstab interval where the state of the simulation is written out. The list should be specified with spaces between the entries. The information is written out with the filename specified in the <em>savefile</em> option with extensions for the time after that. Use only one of the save options at a time.</p>
<p>
<a id="pgfId-1085249"></a>The example below shows four times in the tstab interval to save.</p>

<p>
<a id="pgfId-1085011"></a></p>
<div class="webflare-div-image">
<img width="668" height="38" src="images/Chap4-89.gif" /></div>
<h4>
<a id="pgfId-1085296"></a>Save<a id="marker-1205514"></a>file (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1289117"></a>This is the file name to write out the tstab state information to. If you do not specify a filename that starts with the slash (/) character, the file is stored in the <em>netlist</em> directory. To locate the <em>netlist</em> directory, first select <em>Setup</em> - <em>Simulator/Directory/Host</em> menu in ADE Explorer, and read the path to the project directory. This is the path to the <em>simulation</em> directory. In the simulation directory, navigate to the <em>&lt;</em><span class="webflare-courier-new" style="white-space:pre"><em>circuit_name</em></span><em>&gt;/spectre/&lt;schematic or config&gt;/netlist</em> directory.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1289119"></a>Do not specify a relative path name like <em>./save_file/run1</em>.</div>

<h4>
<a id="pgfId-1085300"></a>Reco<a id="marker-1205526"></a>ver (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085362"></a><em>recover</em> specifies the file name to recover the tstab simulation from. If <em>saveperiod</em> or <em>saveclock</em> are used to make the savefile, then just the same name as specified in <em>savefile</em> is used. If <em>savetimes</em> has a list of times specified, then several files are created at the times specified in the list. Click (<img width="31" height="26" src="images/Chap4-90.gif" />
) and browse to the netlist directory where the savefiles are shown.</p>

<p>
<a id="pgfId-1085366"></a></p>
<div class="webflare-div-image">
<img width="668" height="454" src="images/Chap4-91.gif" /></div>

<p>
<a id="pgfId-1085367"></a>Select one from the list, and click <em>Open</em>. This adds the full path to the <em>recover</em> option, as shown below. Also note that in the example below, the <em>savefile</em> option is still set, and times after the restart times are specified. This is specifically allowed. As long as tstab is 200n or larger, the files at 175n and 200n will be added and can be reused later.</p>

<p>
<a id="pgfId-1085405"></a></p>
<div class="webflare-div-image">
<img width="668" height="212" src="images/Chap4-92.gif" /></div>

<p>
<a id="pgfId-1085032"></a>Now change tstab to a later time. In this case 200n was set.</p>

<p>
<a id="pgfId-1085039"></a></p>
<div class="webflare-div-image">
<img width="668" height="800" src="images/Chap4-93.gif" /></div>

<p>
<a id="pgfId-1085046"></a>When the simulation runs, the savefiles are created, as shown below.</p>

<p>
<a id="pgfId-1085053"></a></p>
<div class="webflare-div-image">
<img width="668" height="455" src="images/Chap4-94.gif" /></div>

<p>
<a id="pgfId-1085060"></a>The waveform from the original tstab and the restarted tstab overlay is shown below.</p>

<p>
<a id="pgfId-1085067"></a></p>
<div class="webflare-div-image">
<img width="668" height="426" src="images/Chap4-95.gif" /></div>

<p>
<a id="pgfId-1085074"></a>Even in the zoomed-in view, the waveforms overlay, as shown below.</p>

<p>
<a id="pgfId-1085081"></a></p>
<div class="webflare-div-image">
<img width="668" height="424" src="images/Chap4-96.gif" /></div>
<h3>
<a id="pgfId-1085088"></a>Misc Tab</h3>
<p>
<a id="pgfId-1085095"></a></p>
<div class="webflare-div-image">
<img width="668" height="475" src="images/Chap4-97.gif" /></div>
<h4>
<a id="pgfId-1085727"></a>Ste<a id="marker-1205608"></a>p (Shooting Only)</h4>

<p>
<a id="pgfId-1085729"></a>Leave this option at the default. All the nodes are checked for curvature in the local truncation error (Numerical integration error) check. If that node has a capacitor or inductor connected to it, the timestep should be controlled to reduce the numerical integration error. If the node does not have a capacitor or inductor connected to it and it has a lot of curvature, the timestep can only be reduced to the value specified in the <em>step</em> option. The default is the simulation interval divided by 1000.</p>

<h4>
<a id="pgfId-1085751"></a>Max<a id="marker-1205614"></a>step (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085753"></a>In shooting, <em>maxstep</em> is observed in the tstab interval and in the shooting window. In harmonic balance, it is observed in the tstab interval only. Normally, <em>maxstep</em> should be left at the default and either setting <em>errpreset</em> or changing <em>reltol</em> is used to control the accuracy. In some cases, extreme accuracy is needed, and this is accomplished by setting a small maxstep value. A small constant timestep produces maximum accuracy at the cost of runtime and memory consumption. </p>
<p>
<a id="pgfId-1085784"></a>An example with <em>maxstep</em> set to 1 picosecond set is shown below.</p>

<p>
<a id="pgfId-1084509"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap4-98.gif" /></div>
<h4>
<a id="pgfId-1085804"></a>Ts<a id="marker-1205624"></a>tart (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085806"></a>Normally, this is not used. <em>tstart</em> specifies the starting time for the tstab interval and defaults to 0 (zero). A negative, 0, or positive <em>tstart</em> is allowed. An example with <em>tstart</em> set to 100n is shown below.</p>

<p>
<a id="pgfId-1084516"></a></p>
<div class="webflare-div-image">
<img width="668" height="37" src="images/Chap4-99.gif" /></div>
<h4>
<a id="pgfId-1085843"></a>Use envelope for tstab (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1085845"></a>This option is not recommended because we are considering ending support for this feature. Normally, a transient analysis is used for the tstab interval. In the case of circuits that have high frequencies and long time constants like oscillator amplitude control or crystal oscillators, the time required for the transient analysis can be excessive. In this case, select <em>yes</em> for <em>Use Envelope for tstab</em>, and set up a shooting envelope analysis. In the pss <em>Choosing Analyses</em> form, set tstab slightly larger than the stop time for the envelope analysis. The example below shows the <em>Use Envelope for tstab</em> option set to <em>yes</em>. For more information on the envelope analysis, see <a href="Chap6.html#72102">Chapter 6, &#8220;Envelope (ENVLP) Analysis&#8221;</a>.</p>

<p>
<a id="pgfId-1084523"></a></p>
<div class="webflare-div-image">
<img width="668" height="37" src="images/Chap4-100.gif" /></div>

<p>
<a id="pgfId-1104476"></a>The envlp and pss <em>Choosing Analyses</em> forms are shown below.</p>
<p>
<a id="pgfId-1084530"></a></p>

<div class="webflare-div-image">
<img width="668" height="816" src="images/Chap4-101.gif" /></div>

<p>
<a id="pgfId-1084537"></a></p>

<div class="webflare-div-image">
<img width="668" height="812" src="images/Chap4-102.gif" /></div>
<h4>
<a id="pgfId-1232698"></a>memory usage estimation (Harmonic Balance only)</h4>

<p>
<a id="pgfId-1232708"></a>The <em>memory usage estimation</em> option provides an estimate of the memory required to perform Harmonic Balance analysis. If this option is set to <em>yes</em>, an estimate of the memory required to perform hb analysis is printed in the log file. You can use this estimate to plan the computing resources before performing hb analysis. In memory estimation mode, the simulator performs a short simulation and exits after printing the estimate in the log file without saving the harmonic balance results. You must set this option to <em>off</em> to perform actual hb analysis. Memory estimation is not recommended for simulations that require less than 500MB of disk space.</p>

<h4>
<a id="pgfId-1086006"></a><a id="26535"></a>Additional<a id="marker-1206890"></a>Params (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1086008"></a>This is a field for <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements. Multiple <code>&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>option_name</em></span><code>&gt;=value</code> statements are allowed with a space between them. Generally, this is used to unlock the beta features, however, there is one case where this field might be useful for an option that is not in the GUI.</p>
<p>
<a id="pgfId-1086009"></a>In some cases, either in the tstab interval or in the shooting window, the timestep collapses to near zero. The symptom is that the percent complete stays at the same value for many reporting intervals. In this case, there might be a discontinuity in one of the models. </p>
<p>
<a id="pgfId-1104656"></a>In transient simulation, two things can reduce the timestep; having too much numerical integration error or taking too many iterations at a single timestep can cause the timestep to be cut. Spectre does not report what is causing the timestep to become small. One way to eliminate the possibility of numerical integration error (which is called local truncation error in the simulator) as the cause of reducing the timestep is to set <em>lteratio</em> to 1e9. The disadvantage of this is that it disables the normal method of timestep control, therefore, <em>maxstep</em> must be set to maintain accuracy. </p>
<p>
<a id="pgfId-1104781"></a>Another way to accomplish this is to set <em>lteminstep</em> to a value of about the stop time divided by 1e5. This allows the normal method of timestep control, but if for some reason the numerical integration error wants to cut the timestep too small, the error is ignored. <em>lteminstep</em> is the way to specify this. To do this in ADE Explorer, type <code>lteminstep=&lt;</code><span class="webflare-courier-new" style="white-space:pre"><em>Stop_Time</em></span><code>&gt;/1e5</code>. If you use <code>lteratio=1e9</code>, or if you set <em>lteminstep</em> and you still have very small timesteps, try increasing <em>maxiters</em> in the <em>Convergence</em> tab to between 40 and 100. When <em>lteratio</em> or <em>lteminstep</em> is set and you still have timestep problems, there is likely a discontinuity in either a device model or in a Verilog-A model. An example is shown below.</p>

<p>
<a id="pgfId-1085929"></a></p>
<div class="webflare-div-image">
<img width="668" height="35" src="images/Chap4-103.gif" /></div>

<p>
<a id="pgfId-1232649"></a></p>

<h2>
<a id="pgfId-1086063"></a>Help for Convergence Issues</h2>

<p>
<a id="pgfId-1086064"></a>Spectre can have difficulties in three areas:</p>
<ul><li>
<a id="pgfId-1086065"></a><strong>Trouble with the time-zero timepoint</strong><br />
<a id="pgfId-1085940"></a>Occasionally, Spectre begins the simulation process, reports the inventory, and then reports that it is starting the tstab interval, and then appears to hang. If you have access to a CPU monitor, you will find that the CPU is at nearly 100% utilization. The likely cause is that the voltages from the signal sources at time=zero are non-zero, and the DC algorithm for calculating the time-zero timepoint is stuck either in <code>homotopy</code>=<code>source</code> or <code>gmin</code>. In this case, use the global options form (<em>Simulation</em> - <em>Options</em> - <em>Analog</em> in ADE Explorer) and set the <em>homotopy</em> option in the <em>Algorithm</em> tab to <em>dptran</em>. This is highly likely to resolve the problem. If this is ineffective, try setting  to  in the global options  tab. If the problem persists, set  and skip the time-zero calculation entirely.</li><li>
<a id="pgfId-1086107"></a><strong>Trouble in the tstab interval</strong><br />
<a id="pgfId-1105051"></a>The typical problem here is that in some cases, the timestep collapses to near zero, and as a result, the simulation appears to be stuck at a certain point. If this is the case, first try setting <em>relref</em> to <em>sigglobal</em>. This causes the accuracy to degrade a bit, but it allows the simulation to get past the troublesome point. If this fails, in the pss options form set the <em>lteminstep</em> option to about the tstab time divided by 1e5. If tstab is 100n, then type <code>lteminstep=100n/1e5</code> in the <em>additionalParams</em> field, and try again. If this does not fix the problem, there is likely a discontinuous model in the circuit. To be sure, set <code>maxiters=100,</code> <code>lteratio=1e9</code>, and <code>maxstep</code> about equal to <code>tstab/1e4</code>. Now run the simulation. If the problem persists, there is very likely a discontinuous model somewhere in the circuit. Use the Spectre output on which the nodes do not converge to determine which model has the problem.<br />
<a id="pgfId-1086109"></a>If you see the same problem in the shooting window, use the same series of steps.</li><li>
<a id="pgfId-1085947"></a><strong>Trouble in the shooting interval</strong><br />
<a id="pgfId-1086142"></a><strong>Driven Circuits</strong><ul><li>
<a id="pgfId-1086166"></a>Check that the option <em>iabstol</em> is not set smaller than 1e-12.</li><li>
<a id="pgfId-1086167"></a>If there is a frequency divider in the circuit, remember that the input frequency will be divided down. Specify the divided-down frequency as the pss frequency. Remember that pss must simulate one cycle of the periodicity of the circuit in order to converge.</li><li>
<a id="pgfId-1086168"></a>Set a longer tstab. A longer tstab allows the circuit to get closer to steady-state and thus converge better.</li><li>
<a id="pgfId-1086169"></a>Check the tstab stopping point. For a sine wave, you want to avoid having the tstab waveform stop at a peak or valley of the waveform. For a square wave, the best point to stop at in the tstab waveform is just before the next transition where most of the voltages have relatively settled.</li><li>
<a id="pgfId-1086170"></a>Try changing the tstab time by a fraction of a period. Just moving to a different point can help convergence. Generally, the longer the tstab, the higher the probability of convergence.</li><li>
<a id="pgfId-1086158"></a>Do not over-tighten <em>reltol</em> and <em>vabstol</em>. A practical minimum for <em>reltol</em> is 1e-6 and for <em>vabstol</em>, 1e-8. Although some circuits may allow smaller values, many would not.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1300178"></a>If the PSS analysis does not converge, the unconverged solution is not saved.</div></li></ul>
<a id="pgfId-1085954"></a><strong>Oscillators</strong><ul><li>
<a id="pgfId-1086206"></a>Make sure that the oscillator is starting by selecting <em>yes</em> for <em>saveinit</em> and then viewing the startup waveform. If the waveform looks like a DC level for a while and then starts near the end of the tstab interval, try one of the methods listed in <a href="Chap4.html#81120">Different ways to start the oscillator</a> to start the oscillator more robustly.</li><li>
<a id="pgfId-1086207"></a>In some cases, Spectre will find a node that looks like it is a frequency divider output even though there is no divider in the circuit. When this happens frequently, convergence is negatively affected. Look at the starting and stopping times during the shooting iterations to see if this is happening and if you are sure that there is no frequency divider in the circuit, set the estimated frequency in the <em>Choosing Analyses</em> form to about 3.5 times the actual frequency of oscillation. The reason this works is that at the end of tstab, one period of the estimate is simulated, and then four periods of the estimated frequency is simulated, and during this interval, Spectre looks for a frequency divided output. Setting the estimated frequency to 3.5 times the real oscillation frequency causes just over one cycle of the real oscillation frequency to be simulated, and so Spectre cannot find a frequency-divided output.</li><li>
<a id="pgfId-1086208"></a>If there is a frequency divider in the circuit, make sure that the oscillator node is on the output of the frequency divider and the pss estimated frequency is the divided down frequency.</li><li>
<a id="pgfId-1086209"></a>Change tstab by a fraction of a period so that the starting and ending point are different. For sinusoidal oscillators, avoid peaks and valleys. For square wave oscillators, try to end tstab just before a transition. When using this strategy, note that the save and recover options can prevent the need to resimulate from time zero each time a different tstab is used.</li><li>
<a id="pgfId-1086210"></a>Try a longer tstab. Sometimes there are long time constants in the bias circuitry. When using this strategy, note that the <em>save</em> and <em>recover</em> options can prevent the need to resimulate from time zero each time a different tstab is used.</li><li>
<a id="pgfId-1086211"></a>Try setting <code>reltol=1e-5</code> and <code>vabstol=3e-8</code>. Setting tighter tolerances makes the amplitude and frequency estimate from the tstab interval more accurate.</li><li>
<a id="pgfId-1086212"></a>Try setting <em>maxacfreq</em> to about the frequency times 1000. This forces more timepoints, which makes the simulation more accurate. More time and more memory are required when this is set.</li><li>
<a id="pgfId-1132489"></a>If the <em>conv_norm</em> number is trending down with no large increases from iteration to iteration, try setting <em>maxperiods</em> to the 200 range. If <em>conv_norm</em> generally trends down during the additional iterations, set maxperiods to a higher value. If the <em>conv_norm</em> trends down, and then suddenly has a large increase, it is unlikely that setting <em>maxperiods</em> to a higher value will succeed.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1300204"></a>If the PSS analysis does not converge, the unconverged solution is not saved.</div></li></ul></li></ul>


























<h2>
<a id="pgfId-1085961"></a>Examples</h2>

<p>
<a id="pgfId-1132510"></a>Generally speaking, this section shows examples using shooting. The reason is that harmonic balance has Chapter 3, which is dedicated to the hb <em>Choosing Analyses</em> form. All the capabilities shown are available for shooting and harmonic balance unless otherwise noted.</p>

<h3>
<a id="pgfId-1132511"></a>Pss Shooting with a single input to an amplifier or the LO applied in a mixer</h3>

<p>
<a id="pgfId-1132507"></a>The example below shows an amplifier.</p>

<p>
<a id="pgfId-1257102"></a></p>
<div class="webflare-div-image">
<img width="668" height="570" src="images/Chap4-104.gif" /></div>

<ol><li>
<a id="pgfId-1086262"></a>In the schematic, for the RF port assign names for the sources in the <em>Frequency name 1</em> and <em>Frequency name 2</em> fields. <br />
<a id="pgfId-1105530"></a>This is just a name for you to use to remember the function of that signal. In this case, the name and the variable that sets the frequency are the same, but they do not need to agree. It is perfectly acceptable to have a name like RF1 and a frequency variable freq1. Additionally, the amplitude of both RF signals is set to the same variable name. This is not required either. In the case of measuring a large-signal IP3 where you deliberately want to match the amplitudes of both inputs, it is convenient to use the same name in both amplitudes. <br />
<a id="pgfId-1086291"></a>In the case where you want the flexibility to introduce a blocking signal in addition to an RF signal, it makes sense to use two different variables because the blocker usually has a very high amplitude compared to the RF signal.<br />
<a id="pgfId-1085968"></a><div class="webflare-div-image">
<img width="668" height="755" src="images/Chap4-105.gif" /></div></li><li>
<a id="pgfId-1085975"></a>In ADE Explorer, assign values for the variables that are used in the input port. In this example, the first RF frequency is set to 2.4GHz, and the second RF frequency is set to 0, which disables that frequency from being generated.<br />
<a id="pgfId-1085982"></a><div class="webflare-div-image">
<img width="668" height="500" src="images/Chap4-106.gif" /></div></li><li>
<a id="pgfId-1086470"></a>In the ADE Explorer <em>Choosing Analyses</em> form, select pss in the <em>Analysis</em> section.<br />
<a id="pgfId-1086513"></a><div class="webflare-div-image">
<img width="668" height="188" src="images/Chap4-107.gif" /></div></li><li>
<a id="pgfId-1086471"></a>Select an engine that you want to use. <em>Shooting</em> and <em>Harmonic Balance</em> are both available in pss.<br />
<a id="pgfId-1086534"></a><div class="webflare-div-image">
<img width="668" height="32" src="images/Chap4-108.gif" /></div></li><li>
<a id="pgfId-1086583"></a>All the sources in the top-level circuit are read in to the list in the <em>Fundamental Tones</em> section. If you have signal sources lower in the level of the hierarchy, select <em>Update From Hierarchy</em>.<br />
<a id="pgfId-1086584"></a><div class="webflare-div-image">
<img width="668" height="188" src="images/Chap4-109.gif" /></div></li><li>
<a id="pgfId-1086585"></a>For the beat frequency, either select <em>Auto Calculate</em>, or type the frequency for the periodicity of the circuit.<br />
<a id="pgfId-1086621"></a><div class="webflare-div-image">
<img width="668" height="48" src="images/Chap4-110.gif" /></div>
<a id="pgfId-1086474"></a>If you are simulating a frequency divider, selecting <em>Auto Calculate</em> is inappropriate because it bases the calculation on the frequency of the source in the circuit. In this case, specify the frequency of the divider output.</li><li>
<a id="pgfId-1086475"></a>Specify the number of harmonics that you want to calculate from the waveform in the <em>Number of harmonics</em> field.<br />
<a id="pgfId-1086647"></a><div class="webflare-div-image">
<img width="668" height="48" src="images/Chap4-111.gif" /></div>
<a id="pgfId-1086476"></a>If you do not want harmonics to be calculated, type 0 (zero) in the <em>Number of harmonics</em> field. When the number of harmonics is raised above 10, more timepoints are forced in the pss which raise the simulation time and the memory required for the simulation.</li><li>
<a id="pgfId-1086477"></a>In most cases, moderate accuracy is enough. If you want more accuracy, select <em>conservative</em>. If this is not enough, refer to the section <a href="Chap4.html#94126">Accuracy and Settings and Trade-Offs</a>.<br />
<a id="pgfId-1086679"></a><div class="webflare-div-image">
<img width="668" height="44" src="images/Chap4-112.gif" /></div></li><li>
<a id="pgfId-1086811"></a>Run the simulation. </li><li>
<a id="pgfId-1105868"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer. The <em>Direct Plot Form</em> is displayed, as shown below.<br />
<a id="pgfId-1086812"></a><div class="webflare-div-image">
<img width="668" height="736" src="images/Chap4-113.gif" /></div></li></ol>
















































<h3>
<a id="pgfId-1086813"></a>Plotting the output spectrum in d<a id="marker-1206984"></a>Bm</h3>

<p>
<a id="pgfId-1086357"></a>In the Direct Plot form:</p>
<ol><li>
<a id="pgfId-1257545"></a>Select <em>pss</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1257546"></a>Select <em>Power </em>from the <em>Function </em>section. </li><li>
<a id="pgfId-1257547"></a>To plot the power in dBm from a voltage on a net with an assumed resistor on that net, select <em>Net ( specify R )</em> from the <em>Select</em> drop-down list. </li><li>
<a id="pgfId-1086881"></a>Select <em>dBm </em>from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1086893"></a>Select the net in the schematic you want to plot. </li></ol>




<p>
<a id="pgfId-1086365"></a>The spectral plot is shown in the waveform tool.</p>

<p>
<a id="pgfId-1086373"></a></p>
<div class="webflare-div-image">
<img width="668" height="462" src="images/Chap4-114.gif" /></div>
<h3>
<a id="pgfId-1086381"></a>Same Example Using Harmonic Balance</h3>

<p>
<a id="pgfId-1086389"></a>The hb <em>Choosing Analyses</em> form is only slightly different from the shooting form. The list of sources in the <em>Tones</em> section lists all the sources including the ones that have the frequency set to zero. There is an <em>Oversample Factor</em> field. There is also an hbhomotopy choice. For more information on harmonic balance, see <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance&#8221;</a>.</p>
<p>
<a id="pgfId-1086397"></a></p>

<div class="webflare-div-image">
<img width="668" height="811" src="images/Chap4-115.gif" /></div>

<p>
<a id="pgfId-1086405"></a>The waveform results agree for shooting and harmonic balance, as shown in the waveform tool.</p>

<h3>
<a id="pgfId-1086419"></a>Loa<a id="marker-1205791"></a>dpull<a id="79487"></a></h3>

<p>
<a id="pgfId-1159893"></a>Generally, loadpull is performed using harmonic balance. There are several reasons, but the biggest reason is that harmonic balance is almost always faster than shooting for a loadpull simulation. For harmonic balance loadpull information, see <a href="Chap3.html#43267">Loadpull</a>.</p>

<h4>
<a id="pgfId-1205829"></a>PSS Shooting Loadpull</h4>

<ol><li>
<a id="pgfId-1160950"></a>For a loadpull simulation, copy a a triplexer (for setting the reflection and angle for up to three harmonics) or the ten_plexer (for up to 10 harmonics) into a local writable library, and rename the cell. These components are located in the <code>rfLib</code> library.<br />
<a id="pgfId-1166005"></a><div class="webflare-div-image">
<img width="548" height="729" src="images/Chap4-116.gif" /></div></li><li>
<a id="pgfId-1166006"></a>Open the triplexer_local schematic, and select the portAdapter for the desired harmonic. The top portAdapter is for the first harmonic, and the harmonic numbers increase as you move down in the schematic. The top portAdapter is highlighted below.<br />
<a id="pgfId-1166067"></a><div class="webflare-div-image">
<img width="627" height="593" src="images/Chap4-117.gif" /></div>
<a id="pgfId-1161347"></a>The properties list is set as follows:<br />
<a id="pgfId-1166185"></a><div class="webflare-div-image">
<img width="525" height="804" src="images/Chap4-118.gif" /></div></li><li>
<a id="pgfId-1161408"></a>Change <em>Phase of Gamma (degrees)</em> and<em> Mag of Gamma (linear scale)</em> to variable names. Note that the phase is above the magnitude in the properties list.<br />
<a id="pgfId-1166313"></a><div class="webflare-div-image">
<img width="505" height="780" src="images/Chap4-119.gif" /></div></li><li>
<a id="pgfId-1166416"></a>Save the local copy.</li><li>
<a id="pgfId-1166420"></a>Add the local copy of the triplexer or ten_plexer as the load in the schematic. Save the schematic.<br />
<a id="pgfId-1166426"></a><div class="webflare-div-image">
<img width="595" height="766" src="images/Chap4-120.gif" /></div>
<a id="pgfId-1161412"></a><div class="webflare-div-image">
<img width="668" height="574" src="images/Chap4-121.gif" /></div>
<a id="pgfId-1160959"></a></li><li>
<a id="pgfId-1162421"></a>Add the two variables you used in the local triplexer or ten_plexer into ADE Explorer.<br />
<a id="pgfId-1160970"></a><div class="webflare-div-image">
<img width="638" height="458" src="images/Chap4-122.gif" /></div>
<a id="pgfId-1160971"></a>The example above shows <span class="webflare-courier-new" style="white-space:pre"><em>mag</em></span> and <span class="webflare-courier-new" style="white-space:pre"><em>theta</em></span> variables added. These variables should not be used to set any component values in the circuit.<br />
<a id="pgfId-1160972"></a>Triplexer from your local library directory contains three filters for the first, second, and third harmonics and portAdapters with port loads for each of the three filters.</li><li>
<a id="pgfId-1162175"></a>Open the PSS <em>Choose Analyses</em> form.<br />
<a id="pgfId-1166511"></a><div class="webflare-div-image">
<img width="451" height="795" src="images/Chap4-123.gif" /></div></li><li>
<a id="pgfId-1160974"></a>Set up the top of the form as usual.</li><li>
<a id="pgfId-1162816"></a>Select the <em>Loadpull</em> checkbox.<br />
<a id="pgfId-1160978"></a><div class="webflare-div-image">
<img width="489" height="161" src="images/Chap4-124.gif" /></div></li><li>
<a id="pgfId-1160979"></a>Click <em>Select</em> on the right of the greyed out<em> Load Instance</em> field.</li><li>
<a id="pgfId-1160980"></a>In the triplexer_local schematic, select the topmost portAdapter on the right side of the schematic if you want a loadpull for the first harmonic. Select the next portAdapter down for a loadpull of the second harmonic. Select the third portAdapter down for the third harmonic. The first harmonic portAdapter is highlighted below.<br />
<a id="pgfId-1166677"></a><div class="webflare-div-image">
<img width="606" height="460" src="images/Chap4-125.gif" /></div>
<a id="pgfId-1160981"></a>The instance name is entered in the <em>Load Instance</em> field. Direct entry by typing is not allowed for this field.<br />
<a id="pgfId-1160985"></a><div class="webflare-div-image">
<img width="638" height="34" src="images/Chap4-126.gif" /></div></li><li>
<a id="pgfId-1160986"></a>Click the <em>Variable</em> button on the right of the <em>rho (Z)</em> field. Select the variable you entered in ADE Explorer. <br />
<a id="pgfId-1160987"></a>This variable is used to set the value of the reflection coefficient in the port.</li><li>
<a id="pgfId-1160988"></a>Specify a sweep range, and set the spacing.<br />
<a id="pgfId-1160992"></a><div class="webflare-div-image">
<img width="638" height="280" src="images/Chap4-127.gif" /></div></li><li>
<a id="pgfId-1160993"></a>When completed, select <em>OK</em>. <br />
<a id="pgfId-1160994"></a>The values are displayed in the <em>Choose Analyses</em> form. </li><li>
<a id="pgfId-1160999"></a>Click the <em>Variable</em> button on the right of the <em>phi (Z)</em> field. This sets the angle of the reflection coefficient.</li><li>
<a id="pgfId-1161000"></a>In the <em>Select Design Variable </em>window, select the second variable you entered and specify the sweep limits.<br />
<a id="pgfId-1161004"></a><div class="webflare-div-image">
<img width="638" height="279" src="images/Chap4-128.gif" /></div></li><li>
<a id="pgfId-1161005"></a>When completed, click <em>OK</em>. <br />
<a id="pgfId-1161006"></a>The variables are updated in the <em>Choose Analyses</em> form.<br />
<a id="pgfId-1161012"></a><div class="webflare-div-image">
<img width="458" height="160" src="images/Chap4-129.gif" /></div></li><li>
<a id="pgfId-1161013"></a>When completed, click <em>OK</em> and run the simulation in ADE Explorer.</li><li>
<a id="pgfId-1161014"></a>In ADE Explorer, select <em>Results - Direct Plot - Main Form</em>.</li></ol>
















































































<p>
<a id="pgfId-1161015"></a>There are two methods of plotting loa<a id="marker-1207385"></a>dpull curves.</p>

<h4><em>
<a id="pgfId-1258550"></a>First method</em></h4>

<ol><li>
<a id="pgfId-1258551"></a>Select <em>pss </em>from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1258552"></a>Select <em>Power Contours</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1161027"></a>Select <em>Magnitude</em>, <em>dB10</em>, or <em>dBm</em> as the power modifier.</li><li>
<a id="pgfId-1161032"></a>Specify 2 more than the number of contour lines you want.<br />
<a id="pgfId-1161033"></a>The smallest and largest power occurs at a single point which is plotted, but are very difficult to see in the waveform tool.</li><li>
<a id="pgfId-1161034"></a>Select the <em>Close Contours</em> check box. This causes the contours from the loadpull to be displayed as circles or ellipses, depending on the distortion of the circuit.</li><li>
<a id="pgfId-1161035"></a>Select the first harmonic. </li><li>
<a id="pgfId-1161036"></a>Select the top terminal of the top port in the triplexer.<br />
<a id="pgfId-1161037"></a>The power contours appear. <br />
<a id="pgfId-1161041"></a><div class="webflare-div-image">
<img width="662" height="541" src="images/Chap4-130.gif" /></div></li></ol>











<h4><em>
<a id="pgfId-1161042"></a>Second method</em></h4>

<ol><li>
<a id="pgfId-1161043"></a>Select <em>pss results</em>.</li><li>
<a id="pgfId-1161048"></a>Select <em>Power</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1161053"></a>Select <em>variable</em> from the <em>Sweep</em> section.</li><li>
<a id="pgfId-1161058"></a>Select <em>Magnitude</em>, <em>dB10</em>, or <em>dBm</em> from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1161063"></a>Select the <em>harmonic number</em>.</li><li>
<a id="pgfId-1161068"></a>Select <em>Loadpull Contour</em>.</li><li>
<a id="pgfId-1161069"></a>Specify 2 more than the number of curves you want. </li><li>
<a id="pgfId-1161070"></a>Select the <em>Closed Contours</em> check box. This causes the contours from the loadpull to be displayed as circles or ellipses, depending on the distortion of the circuit.</li><li>
<a id="pgfId-1161071"></a>Select the top terminal of the top port of the triplexer circuit. <br />
<a id="pgfId-1161072"></a>The loadpull curves appear in the waveform tool. <br />
<a id="pgfId-1161076"></a><a id="loadpullfeature"></a><div class="webflare-div-image">
<img width="638" height="533" src="images/Chap4-131.gif" /></div></li></ol>












<h3>
<a id="pgfId-1160857"></a>Two Input Frequ<a id="marker-1207201"></a>encies</h3>

<p>
<a id="pgfId-1087321"></a>Two input frequencies can be simulated as long as the beat frequency is high compared to the frequencies that are applied to the circuit. In general, if the pss beat frequency is smaller than about 1/25th the highest input frequency, the simulation is faster if you use qpss or hb.</p>
<p>
<a id="pgfId-1087322"></a>In the example below, 30 periods of 900MHz and 31 periods of 960 MHz need to be calculated. This is on the edge of acceptability for pss. For this simulation, it might be faster to simulate using qpss or hb because fewer harmonics need to be solved, which requires less memory and time.</p>

<p>
<a id="pgfId-1086426"></a></p>
<div class="webflare-div-image">
<img width="668" height="782" src="images/Chap4-132.gif" /></div>

<p>
<a id="pgfId-1087338"></a>Note that when the frequencies are moved slightly to 910M and 970M, the beat frequency drops to 10MHz. In this case, it would definitely be faster to use hb or qpss. These analyses are much faster than pss. Also, since the pss frequency is lower, more harmonics need to be calculated in order to see the desired mixing products.</p>

<p>
<a id="pgfId-1087345"></a></p>
<div class="webflare-div-image">
<img width="668" height="744" src="images/Chap4-133.gif" /></div>
<h3>
<a id="pgfId-1087352"></a>Swe<a id="marker-1207489"></a>eps</h3>

<p>
<a id="pgfId-1087572"></a>For the next plots, a sweep is set up in the pss <em>Choosing Analyses</em> form. A sweep is needed in order to measure compression.</p>
<p>
<a id="pgfId-1087574"></a>Sweeps can be made either in the parametric plot tool in ADE Explorer where the number of swept things is not limited, or in the pss <em>Choosing Analyses</em> form, where the number of swept things is limited to three. This example shows using the pss <em>Choosing Analyses</em> form shown below. For documentation on the parametric plot tool, please refer to the ADE Explorer documentation.</p>
<p>
<a id="pgfId-1087359"></a></p>

<div class="webflare-div-image">
<img width="668" height="802" src="images/Chap4-134.gif" /></div>

<ol><li>
<a id="pgfId-1087366"></a>Select a sweep number from the <em>Sweep</em> drop-down list.<br />
<a id="pgfId-1087937"></a><div class="webflare-div-image">
<img width="668" height="84" src="images/Chap4-135.gif" /></div></li><li>
<a id="pgfId-1087875"></a>Select the type of parameter that is being varied from the <em>Variable</em> drop-down list.<br />
<a id="pgfId-1087373"></a><div class="webflare-div-image">
<img width="668" height="100" src="images/Chap4-136.gif" /></div></li><li>
<a id="pgfId-1087380"></a>Type the variable name in the <em>Variable Name</em> field. You can also select the variable from a list. To do this, click <em>Select Design Variable</em>. and the list is displayed.<br />
<a id="pgfId-1087387"></a><div class="webflare-div-image">
<img width="668" height="447" src="images/Chap4-137.gif" /></div>
<a id="pgfId-1088027"></a>Select the desired variable, and click <em>OK</em> to enter the variable.</li><li>
<a id="pgfId-1088029"></a>Define the sweep range. Set up a sweep range, and if you desire values that are in between the sweep values, or above or below the sweep values, select <em>Add Specific Points</em>. Type a list of values separated by spaces. This is shown below.<br />
<a id="pgfId-1088058"></a><div class="webflare-div-image">
<img width="668" height="205" src="images/Chap4-138.gif" /></div></li></ol>




















<p>
<a id="pgfId-1087394"></a>For many power measurements, currents need to be saved. If you are using Shooting, these currents can be saved, To save all the currents from the ADE Explorer environment. Select <em>Outputs</em> - <em>Save All</em>, and then select <em>all</em> for <em>Select Device Currents (currents)</em>. This takes the currents that are calculated from every component in the circuit and adds them into the simulator result file.</p>

<p>
<a id="pgfId-1087401"></a></p>
<div class="webflare-div-image">
<img width="668" height="677" src="images/Chap4-139.gif" /></div>

<p>
<a id="pgfId-1088124"></a>For hb, port, and voltage source, only currents are saved, and this save is automatic. The ADE Explorer <em>Save Options</em> form shown above has no effect in hb. If you need to measure a current other than in a port or voltage source, add an iprobe in series with the branch. </p>
<p>
<a id="pgfId-1088126"></a>If all the currents need to be saved when harmonic balance is used as the engine, select <em>yes</em> for the <em>Select AC terminal currents (useprobes)</em> option above. This adds a zero volt battery in series with every branch in the circuit. Although this results in saving all the currents, it also adds entries in the harmonic balance matrices for each voltage source. As a result, the hb matrices get much larger, therefore, more time and memory are required to solve the equations.</p>
<p>
<a id="pgfId-1106887"></a>In addition, there is a very small chance of causing unresolvable numerical issues and the simulator issues a singular matrix error message. If you see this error, turn off the <em>Select AC terminal currents (useprobes)</em> option and run the simulation again.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1088130"></a>The <em>Select AC terminal currents (useprobes)</em> option is not recommended if you run a small-signal analysis after the large-signal shooting pss analysis.</div>

<h3>
<a id="pgfId-1088326"></a>Compress<a id="marker-1207533"></a>ion Point</h3>

<p>
<a id="pgfId-1088328"></a>This requires a swept input power setup as shown in the section <a href="Chap4.html#79487">Loadpull</a>.</p>
<p>
<a id="pgfId-1088330"></a>Make sure that the power at the first point in the sweep is low enough so that there is no compression in the output at that power level. The first point in the sweep is used to establish the uncompressed power for the compression measurement.</p>
<p>
<a id="pgfId-1066249"></a>To plot a compression point measurement:</p>
<ol><li>
<a id="pgfId-1088380"></a>Select <em>Results - Direct Plot - Main Form</em> in ADE Explorer.<br />
<a id="pgfId-1088396"></a>The Direct Plot Form is displayed, as shown below.<br />
<a id="pgfId-1066253"></a><div class="webflare-div-image">
<img width="670" height="702" src="images/Chap4-140.gif" /></div></li><li>
<a id="pgfId-1066255"></a>Select <em>Compression Point</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066256"></a>Select the type of thing that needs to be probed in the circuit from the <em>Select</em> drop-down list.</li><li>
<a id="pgfId-1066257"></a>Specify the compression level.</li><li>
<a id="pgfId-1066258"></a>Specify input or output-referred compression amount.</li><li>
<a id="pgfId-1066259"></a>Select the output harmonic to be plotted.</li><li>
<a id="pgfId-1066260"></a>Make the selection that is shown at the bottom of the <em>Direct Plot Form</em>. In this example, a port in the schematic that is used as a load should be selected.<br />
<a id="pgfId-1066261"></a>The compression curve is displayed.<br />
<a id="pgfId-1066273"></a><div class="webflare-div-image">
<img width="668" height="455" src="images/Chap4-141.gif" /></div></li></ol>















<h3>
<a id="pgfId-1088425"></a>Voltag<a id="marker-1207552"></a>e Gain</h3>

<p>
<a id="pgfId-1088427"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>. A sweep is not required for this measurement.</p>
<p>
<a id="pgfId-1088429"></a>The voltage gain direct plot function provides the output spectrum divided by the amplitude of the input at the specified input frequency. Note that the input amplitude at the input frequency has a single value. All the output harmonics at all the calculated output frequencies are scaled by the single voltage at the input.</p>
<p>
<a id="pgfId-1066274"></a>To plot the voltage gain:</p>

<p>
<a id="pgfId-1066278"></a></p>
<div class="webflare-div-image">
<img width="670" height="671" src="images/Chap4-142.gif" /></div>

<ol><li>
<a id="pgfId-1066279"></a>Select <em>Voltage Gain</em> from <em>Function</em> section.</li><li>
<a id="pgfId-1066280"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1066281"></a>Select the power level of the sweep.</li><li>
<a id="pgfId-1066282"></a>Select the input harmonic frequency.</li><li>
<a id="pgfId-1066283"></a>Select the output node in the schematic.</li><li>
<a id="pgfId-1066284"></a>Select the input node in the schematic.</li></ol>





<p>
<a id="pgfId-1066289"></a>Below is the output spectrum of the circuit, divided by the amplitude of the input at the input frequency.</p>

<p>
<a id="pgfId-1066293"></a></p>
<div class="webflare-div-image">
<img width="670" height="446" src="images/Chap4-143.gif" /></div>
<h3>
<a id="pgfId-1088462"></a>Power <a id="marker-1207568"></a>Gain</h3>

<p>
<a id="pgfId-1088464"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>. A sweep is not required for this measurement.</p>
<p>
<a id="pgfId-1088466"></a>The power gain direct plot function provides the output spectral power divided by the power of the input at the specified input frequency. Note that the input power at the input frequency has a single value. All the output harmonics at all the calculated output frequencies are scaled by the single voltage at the input.</p>
<p>
<a id="pgfId-1066294"></a>To plot the power gain of a circuit:</p>

<p>
<a id="pgfId-1066298"></a></p>
<div class="webflare-div-image">
<img width="670" height="803" src="images/Chap4-144.gif" /></div>

<ol><li>
<a id="pgfId-1066299"></a>Select <em>Power Gain</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066300"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1066301"></a>Select the input power.</li><li>
<a id="pgfId-1066302"></a>Select the frequency of the input.</li><li>
<a id="pgfId-1066303"></a>Select the terminal of the load.</li><li>
<a id="pgfId-1066304"></a>Select the terminal of the input source.</li></ol>





<p>
<a id="pgfId-1066309"></a>Below is the output power spectrum, divided by the magnitude of the input power at the input frequency.</p>

<p>
<a id="pgfId-1066313"></a></p>
<div class="webflare-div-image">
<img width="670" height="495" src="images/Chap4-145.gif" /></div>
<h3>
<a id="pgfId-1088504"></a>Power-Added Ef<a id="marker-1207586"></a>ficiency</h3>

<p>
<a id="pgfId-1088506"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>. A sweep is not required for this measurement.</p>
<p>
<a id="pgfId-1066314"></a>To plot power-added efficiency:</p>

<p>
<a id="pgfId-1066318"></a></p>
<div class="webflare-div-image">
<img width="670" height="686" src="images/Chap4-146.gif" /></div>

<ol><li>
<a id="pgfId-1066319"></a>Select <em>Power Added Eff</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066320"></a>Select the frequency of the input.</li><li>
<a id="pgfId-1066321"></a>Select the number of DC sources that power the circuit.</li><li>
<a id="pgfId-1066322"></a>Select the terminal of the output load.<br />
<a id="pgfId-1167282"></a><div class="webflare-div-image">
<img width="403" height="26" src="images/Chap4-147.gif" /></div></li><li>
<a id="pgfId-1066323"></a>Select the terminal of the input source.<br />
<a id="pgfId-1066327"></a><div class="webflare-div-image">
<img width="634" height="26" src="images/Chap4-148.gif" /></div></li><li>
<a id="pgfId-1066328"></a>Select the terminal(s) of the DC sources.<br />
<a id="pgfId-1066332"></a><div class="webflare-div-image">
<img width="634" height="26" src="images/Chap4-149.gif" /></div></li></ol>

















<p>
<a id="pgfId-1066333"></a>The swept PAE curve is displayed.</p>

<p>
<a id="pgfId-1066337"></a></p>
<div class="webflare-div-image">
<img width="670" height="400" src="images/Chap4-150.gif" /></div>
<h3>
<a id="pgfId-1088525"></a>Compression Vers<a id="marker-1207620"></a>us Output Power</h3>

<p>
<a id="pgfId-1088551"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>.</p>
<p>
<a id="pgfId-1066339"></a>To plot compression versus output power:</p>

<p>
<a id="pgfId-1066343"></a></p>
<div class="webflare-div-image">
<img width="670" height="715" src="images/Chap4-151.gif" /></div>

<ol><li>
<a id="pgfId-1066344"></a>Select <em>Comp Vs Pout</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066345"></a>Select the output frequency.</li><li>
<a id="pgfId-1066346"></a>Select the load port in the circuit.</li></ol>


<p>
<a id="pgfId-1066347"></a>The compression curve is displayed. The assumption is that the first point in the sweep has no compression.</p>

<p>
<a id="pgfId-1066351"></a></p>
<div class="webflare-div-image">
<img width="670" height="486" src="images/Chap4-152.gif" /></div>
<h3>
<a id="pgfId-1088592"></a>Power Gain Versus Out<a id="marker-1207631"></a>put Power</h3>

<p>
<a id="pgfId-1088594"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>.</p>
<p>
<a id="pgfId-1088596"></a>To see the power gain versus the output power:</p>

<p>
<a id="pgfId-1066356"></a></p>
<div class="webflare-div-image">
<img width="670" height="777" src="images/Chap4-153.gif" /></div>

<ol><li>
<a id="pgfId-1066357"></a>Select <em>Power Gain</em> <em>vs Pout</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066358"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1066359"></a>Select the output frequency.</li><li>
<a id="pgfId-1066360"></a>Select the input frequency.</li><li>
<a id="pgfId-1066361"></a>Select the terminal of the load.</li><li>
<a id="pgfId-1066362"></a>Select the terminal of the input source.</li></ol>





<p>
<a id="pgfId-1066367"></a>The plot is displayed. The vertical axis is the power gain. The horizontal axis is the swept input power. </p>

<p>
<a id="pgfId-1066371"></a></p>
<div class="webflare-div-image">
<img width="670" height="429" src="images/Chap4-154.gif" /></div>
<h3>
<a id="pgfId-1088633"></a>Plotting T<a id="marker-1207647"></a>HD</h3>

<p>
<a id="pgfId-1088635"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>. A sweep is not required for this measurement.</p>
<p>
<a id="pgfId-1066372"></a>To plot the total harmonic distortion:</p>

<p>
<a id="pgfId-1066376"></a></p>
<div class="webflare-div-image">
<img width="670" height="703" src="images/Chap4-155.gif" /></div>

<ol><li>
<a id="pgfId-1066377"></a>Select <em>THD</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066378"></a>Select the output frequency.</li><li>
<a id="pgfId-1066379"></a>Select the net in the schematic.</li></ol>


<p>
<a id="pgfId-1066380"></a>The THD versus input power plot is displayed.</p>

<p>
<a id="pgfId-1066384"></a></p>
<div class="webflare-div-image">
<img width="670" height="453" src="images/Chap4-156.gif" /></div>
<h3>
<a id="pgfId-1088674"></a>Large-sig<a id="marker-1207665"></a>nal IP3</h3>

<p>
<a id="pgfId-1088676"></a>This example shows a swept measurement. To set this up, see <a href="Chap4.html#79487">Loadpull</a>.</p>
<p>
<a id="pgfId-1088678"></a>In pss, all the harmonics of the input waveform are calculated. If the input frequencies get close together, the pss beat frequency becomes small compared to the highest input frequency. If you need to simulate more than 25 periods of the highest input frequency, switch to hb or qpss which run faster than pss.</p>
<p>
<a id="pgfId-1066385"></a>To plot a large-signal IP3, both inputs are enabled in the ADE Explorer window by specifying the values under the <em>Design Variables</em> section of the ADE Explorer for the frequency and amplitude of both RF sources. Note that in this case, the highest frequency (950MHz) divided by the beat frequency (50MHz) is 19. This is a reasonable problem for pss.</p>

<p>
<a id="pgfId-1066389"></a></p>
<div class="webflare-div-image">
<img width="670" height="500" src="images/Chap4-157.gif" /></div>

<p>
<a id="pgfId-1066390"></a>The input is swept over a reasonable range of power levels. If the lower boundary of the sweep is too small, the noise floor of the simulator will be present in the result. If the input power gets too high, the inter-modulation product gets unpredictable. In this example, the power is deliberately started at a very small value and the stopping power is in a very nonlinear region. This is done so the proper way to plot an IP3 can be shown later,</p>

<p>
<a id="pgfId-1066394"></a></p>
<div class="webflare-div-image">
<img width="670" height="779" src="images/Chap4-158.gif" /></div>

<ol><li>
<a id="pgfId-1066396"></a>When the setup is complete, run the simulation.</li><li>
<a id="pgfId-1066397"></a>When the simulation completes, select <em>Results - Direct Plot - Main Form</em> in ADE Explorer.<br />
<a id="pgfId-1066401"></a><div class="webflare-div-image">
<img width="635" height="744" src="images/Chap4-159.gif" /></div></li><li>
<a id="pgfId-1066402"></a>Select <em>IPN Curves</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1066403"></a>Select the type of output signal to plot (or Port) The default is to select a port in the schematic.</li><li>
<a id="pgfId-1066404"></a>Select <em>Variable Sweep</em>.</li><li>
<a id="pgfId-1113924"></a>Set the order of the curves to be plotted. Usually, the order is 2nd or 3rd.</li><li>
<a id="pgfId-1066405"></a>Select whether you want input or output-referred IP3 or IP2.</li><li>
<a id="pgfId-1108180"></a>Leave the extrapolation point blank for the first plot (explained later).</li><li>
<a id="pgfId-1113879"></a>Select the third or second-order frequency from the 2nd or <em>3rd Order Harmonic</em> field.<br />
<a id="pgfId-1113886"></a>Usually, you select the frequency that has the highest amplitude, which is often the lower frequency term.</li><li>
<a id="pgfId-1113881"></a>Select the first-order frequency from the <em>1st Order Harmonic</em> field. Usually you want the smallest amplitude, which is often the higher frequency term.</li><li>
<a id="pgfId-1108087"></a>Select the output port in the schematic.</li></ol>















<p>
<a id="pgfId-1066411"></a>The swept large-signal IP3 is plotted, as shown below.</p>

<p>
<a id="pgfId-1066415"></a></p>
<div class="webflare-div-image">
<img width="670" height="469" src="images/Chap4-160.gif" /></div>

<ul><li>
<a id="pgfId-1088825"></a>Plotting IP3 always involves setting an extrapolation point. First plot the curve using the default for the extrapolation point. </li><li>
<a id="pgfId-1088826"></a>At high power, the third-order curve becomes unpredictable. At low power, the simulation has a noise floor. The data from the intermodulation product starts to level off.</li><li>
<a id="pgfId-1088827"></a>Set the extrapolation point above the noise floor, but below the large-signal region.</li><li>
<a id="pgfId-1088828"></a>The actual data for the intermodulation product should follow the ideal curve for at least one data point in the sweep above and below the extrapolation point.</li><li>
<a id="pgfId-1066421"></a>When -30 is set as the extrapolation point, the data for the third-order frequency follows the ideal curve above and below the extrapolation point, as shown below.<br />
<a id="pgfId-1088844"></a><div class="webflare-div-image">
<img width="668" height="779" src="images/Chap4-161.gif" /></div></li><li>
<a id="pgfId-1088880"></a>Note that the IP3 calculation has increased by about 7dB. Make sure that the extrapolation point is set correctly to get the correct measurement.<br />
<a id="pgfId-1088906"></a><br /><div class="webflare-div-image">
<img width="668" height="489" src="images/Chap4-162.gif" /></div></li><li>
<a id="pgfId-1088958"></a>The above plot is actually a small-signal IP3 measurement. If this is your objective, using rapid IP3 or IP2 in the AC <em>Choosing Analyses</em> form for amplifiers and in the PAC <em>Choosing Analyses</em> form for circuits that translate frequencies will run much faster and will provide a solution that is just as accurate.</li><li>
<a id="pgfId-1088959"></a>Note that <code>bsim3</code> and <code>bsim4</code> models have a limitation that causes the IP3 measurement to become inaccurate for switched-FET mixers whether it is done in rapid IP3, pss, qpss, or hb. In this case, the psp model is highly recommended. If this model is not available from the foundry, use pss, qpss, or hb at as high an input amplitude as possible without causing large-signal behavior in the third-order product.</li></ul>
















<h3>
<a id="pgfId-1088985"></a>Oscillator Simulation</h3>

<p>
<a id="pgfId-1089017"></a>There are no input signals for an oscillator. In the pss analysis, the waveform needs to be calculated. To do this, both the frequency and the amplitudes need to be solved. This requires more iterations to calculate the solution.</p>
<p>
<a id="pgfId-1089018"></a>In ADE Explorer, variables are used to set the tuning voltage and the power supply voltage.</p>

<p>
<a id="pgfId-1089005"></a></p>
<div class="webflare-div-image">
<img width="668" height="503" src="images/Chap4-163.gif" /></div>
<h3>
<a id="pgfId-1089047"></a>Setting Dynamic Paramet<a id="dynamic_params"></a>ers in Tstab</h3>

<p>
<a id="pgfId-1225752"></a>To set the dynamic parameters:</p>
<ol><li>
<a id="pgfId-1222132"></a>Open the PSS <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1225800"></a><div class="webflare-div-image">
<img width="425" height="804" src="images/Chap4-164.gif" /></div></li><li>
<a id="pgfId-1222249"></a>Specify an estimate of the oscillation frequency and set the number of harmonics to be calculated.</li><li>
<a id="pgfId-1222674"></a>Select <em>conservative</em>.</li><li>
<a id="pgfId-1225124"></a>Choose <em>Yes</em> for <em>Run transient?</em>.</li><li>
<a id="pgfId-1225125"></a>Specify the stop time for tstab in the <em>Stop Time (tstab)</em> field.</li><li>
<a id="pgfId-1225126"></a>Select <em>yes</em> for <em>Save Initial Transient Results (saveinit)</em>.</li><li>
<a id="pgfId-1222698"></a>Select <em>Dynamic Parameter</em>.</li><li>
<a id="pgfId-1222706"></a>Choose <em>Parameter vector</em> from the drop-down list.</li><li>
<a id="pgfId-1222729"></a>Specify the name of the option that you want to vary in the tstab interval in the <em>Parameter name</em> field. The example shows <em>reltol</em>.</li><li>
<a id="pgfId-1222714"></a>Specify 0 (zero) in the <em>Time</em> field.</li><li>
<a id="pgfId-1222722"></a>Specify a reasonable value for the option. This example steps reltol from 1e-2 to 1e-7 every 40 nsec in the tstab interval. Note that 1e-2 is a very large value for reltol.</li><li>
<a id="pgfId-1222743"></a>Click Add.</li><li>
<a id="pgfId-1222736"></a>Add other time-value pairs as appropriate.</li><li>
<a id="pgfId-1222750"></a>Select <em>Oscillator</em>.</li><li>
<a id="pgfId-1222757"></a>Click Select to the right of the <em>Oscillator node+</em> field.</li><li>
<a id="pgfId-1222764"></a>Select a net in the schematic that has an oscillator signal.</li><li>
<a id="pgfId-1222771"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1222778"></a>Run the simulation. The setting for the option appear in the Spectre output window.<br />
<a id="pgfId-1225227"></a><div class="webflare-div-image">
<img width="642" height="757" src="images/Chap4-165.gif" /></div></li><li>
<a id="pgfId-1222785"></a>When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.<br />
<a id="pgfId-1225306"></a><div class="webflare-div-image">
<img width="393" height="327" src="images/Chap4-166.gif" /></div></li><li>
<a id="pgfId-1222792"></a>Select <em>tstab</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1222799"></a>Click a net in the schematic with the oscillator signal on it. A waveform is plotted.<br />
<a id="pgfId-1225380"></a><div class="webflare-div-image">
<img width="619" height="369" src="images/Chap4-167.gif" /></div></li><li>
<a id="pgfId-1222870"></a>To measure the instantaneous frequency, select the waveform and choose <em>Measurements</em> - <em>Derived Plots</em>.<br />
<a id="pgfId-1225483"></a><div class="webflare-div-image">
<img width="619" height="568" src="images/Chap4-168.gif" /></div></li><li>
<a id="pgfId-1222884"></a>In the <em>Derived plots</em> window, deselect the <em>Period</em> and <em>Dutycycle</em> options.<br />
<a id="pgfId-1225533"></a><div class="webflare-div-image">
<img width="510" height="480" src="images/Chap4-169.gif" /></div></li><li>
<a id="pgfId-1222891"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1222898"></a>The instantaneous frequency is plotted.<br />
<a id="pgfId-1225580"></a><div class="webflare-div-image">
<img width="619" height="367" src="images/Chap4-170.gif" /></div>
<a id="pgfId-1222983"></a>Note the effect of reltol on the frequency. When reltol is 1e-2, the frequency is low and not very stable. When reltol is 1e-3, the frequency increases and is slightly more stable. As reltol gets smaller, the frequency creeps up and values smaller than 1e-4 produce stable frequencies. Setting values smaller than 1e-5 do not have much effect on stability or frequency, but do have the effect of increasing simulation time.</li></ol>






















































<h3>
<a id="pgfId-1222239"></a>Normal Oscillator Simulation</h3>

<ol><li>
<a id="pgfId-1261930"></a>In the pss <em>Choosing Analyses</em> form:</li><li>
<a id="pgfId-1261935"></a>Select <em>pss</em>.<br />
<a id="pgfId-1089337"></a><div class="webflare-div-image">
<img width="668" height="186" src="images/Chap4-171.gif" /></div></li><li>
<a id="pgfId-1089310"></a>Select the engine that you want to use.<br />
<a id="pgfId-1089373"></a><div class="webflare-div-image">
<img width="668" height="25" src="images/Chap4-172.gif" /></div></li><li>
<a id="pgfId-1089311"></a>Specify a frequency estimate that is between 0.5 and 1.5 times the actual oscillation frequency if you are using the linear oscillator initial condition, or from 0.25 to four times the actual oscillating frequency if you use the default oscic.<br />
<a id="pgfId-1089396"></a><div class="webflare-div-image">
<img width="668" height="48" src="images/Chap4-173.gif" /></div></li><li>
<a id="pgfId-1089312"></a>Set the number of harmonics you want for the spectral calculation.<br />
<a id="pgfId-1089427"></a><div class="webflare-div-image">
<img width="668" height="66" src="images/Chap4-174.gif" /></div></li><li>
<a id="pgfId-1089313"></a>Select the accuracy. <em>conservative</em> accuracy is recommended for oscillators.<br />
<a id="pgfId-1108562"></a><div class="webflare-div-image">
<img width="668" height="44" src="images/Chap4-175.gif" /></div></li><li>
<a id="pgfId-1108563"></a>Set <em>Run transient?</em> to <em>Decide automatically</em>. This automates the setting of tstab and switches to the pss algorithm as soon as steady-state is reached.</li><li>
<a id="pgfId-1089316"></a>If you want to see the startup waveform, select yes for <em>saveinit</em>.<br />
<a id="pgfId-1089545"></a><div class="webflare-div-image">
<img width="668" height="114" src="images/Chap4-176.gif" /></div></li><li>
<a id="pgfId-1089317"></a>Select <em>Oscillator</em>. If you have a single-ended oscillator, specify one node inside the feedback system for the <em>Oscillator node</em>. If you have a differential oscillator, specify two nodes at mirror locations in the <em>Oscillator node+</em> and the <em>Oscillator node-</em>.<br />
<a id="pgfId-1089593"></a><div class="webflare-div-image">
<img width="668" height="124" src="images/Chap4-177.gif" /></div></li><li>
<a id="pgfId-1089618"></a>Select the <em>Calculate initial conditions (ic) automatically</em> option.</li><li>
<a id="pgfId-1262025"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main form</em> in ADE Explorer.</li></ol>







































<h3>
<a id="pgfId-1089642"></a>Plotting the Oscillator Sta<a id="marker-1207816"></a>rtup Waveform</h3>

<p>
<a id="pgfId-1089643"></a>To plot the startup waveform, select tstab results and then select a node in the circuit. If you do not see the tstab results, go back to the <em>Choosing Analyses</em> form and select <em>yes</em> for <em>saveinit</em>.</p>
<p>
<a id="pgfId-1089644"></a>For linear oscic, the startup characteristics of the waveform are not very evident. If you want to see the startup waveform to evaluate how robustly your oscillator starts up, use the default oscic and provide a very small starting kick at time zero plus so that the waveform starts small in amplitude and builds up. In this case, it is likely that tstab needs to be longer to allow the oscillator to reach a near steady-state operation before going into the pss solver.</p>

<p>
<a id="pgfId-1089664"></a></p>
<div class="webflare-div-image">
<img width="668" height="354" src="images/Chap4-178.gif" /></div>

<p>
<a id="pgfId-1089694"></a>The result is displayed in the waveform tool. Note that with the linear oscic, the oscillator starts at time = zero with the estimate of the frequency and amplitude from the very beginning. This allows a very short tstab. Also note that the simulation continues after the setting of tstab. During this time, Spectre searches the oscillator for a divided-down output frequency.</p>

<p>
<a id="pgfId-1089717"></a></p>
<div class="webflare-div-image">
<img width="668" height="405" src="images/Chap4-179.gif" /></div>
<h3>
<a id="pgfId-1089756"></a>Plotting the Oscillator Out<a id="marker-1207837"></a>put Spectrum</h3>

<p>
<a id="pgfId-1089757"></a>To plot the output spectrum, select <em>pss</em>, and then select either <em>Voltage</em> or <em>Power</em>. </p>

<p>
<a id="pgfId-1089744"></a></p>
<div class="webflare-div-image">
<img width="668" height="677" src="images/Chap4-180.gif" /></div>

<p>
<a id="pgfId-1090192"></a>When a node is selected in the schematic, the power in dBm is plotted in the waveform tool, as shown below.</p>

<p>
<a id="pgfId-1090215"></a></p>
<div class="webflare-div-image">
<img width="668" height="411" src="images/Chap4-181.gif" /></div>
<h3>
<a id="pgfId-1090345"></a>Additions for Oscillator Swept Tuning Voltage</h3>

<p>
<a id="pgfId-1090346"></a>In the pss <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1109022"></a>Select <em>Sweep</em>. </li><li>
<a id="pgfId-1109040"></a>Type the variable name that sets the tuning voltage in the <em>Variable Name</em> field. </li><li>
<a id="pgfId-1109048"></a>Set a reasonable sweep range for your oscillator.<br />
<a id="pgfId-1090330"></a><div class="webflare-div-image">
<img width="668" height="802" src="images/Chap4-182.gif" /></div></li><li>
<a id="pgfId-1090553"></a>Run the simulation. </li><li>
<a id="pgfId-1109106"></a>When the simulation completes, select Results - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1090574"></a><div class="webflare-div-image">
<img width="668" height="747" src="images/Chap4-183.gif" /></div></li></ol>











<h3>
<a id="pgfId-1090554"></a>Plotting Output Power Versus Tu<a id="marker-1207899"></a>ning Voltage</h3>

<p>
<a id="pgfId-1090555"></a>To plot the power as a function of the tuning voltage:</p>
<ol><li>
<a id="pgfId-1090720"></a>Select <em>pss</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1090725"></a>Select <em>Power</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1090730"></a>Select <em>variable</em> from the <em>Sweep</em> section. </li><li>
<a id="pgfId-1090735"></a>Select <em>dBm</em> from the <em>Modifier</em> section. </li><li>
<a id="pgfId-1090740"></a>Select the harmonic number. The frequency range is also shown.</li><li>
<a id="pgfId-1090775"></a>Select the node in the schematic you want to plot.</li></ol>





<p>
<a id="pgfId-1090706"></a>The output power versus the tuning voltage is plotted, as shown below.</p>

<p>
<a id="pgfId-1090396"></a></p>
<div class="webflare-div-image">
<img width="668" height="425" src="images/Chap4-184.gif" /></div>
<h3>
<a id="pgfId-1090919"></a>Plotting Output Power Versus Output <a id="marker-1207922"></a>Frequency</h3>

<p>
<a id="pgfId-1090920"></a>Now plot the harmonic frequency on the same plot.</p>

<p>
<a id="pgfId-1090907"></a></p>
<div class="webflare-div-image">
<img width="668" height="666" src="images/Chap4-185.gif" /></div>

<p>
<a id="pgfId-1090955"></a>The frequency is plotted on the same subwindow. A second vertical axis is used.</p>

<p>
<a id="pgfId-1090978"></a></p>
<div class="webflare-div-image">
<img width="668" height="462" src="images/Chap4-186.gif" /></div>

<p>
<a id="pgfId-1091012"></a>To plot the output power versus the frequency, right click on one of the numbers on the X Axis, and select Y vs. Y. The <em>Y vs Y</em> window appears. Select the frequency for the X Axis from the <em>Select a Trace</em> drop-down list and click <em>OK</em>.</p>

<p>
<a id="pgfId-1091039"></a></p>
<div class="webflare-div-image">
<img width="668" height="178" src="images/Chap4-187.gif" /></div>

<p>
<a id="pgfId-1091058"></a>The plot of the output power versus the output frequency is plotted in a new subwindow.</p>

<p>
<a id="pgfId-1091085"></a></p>
<div class="webflare-div-image">
<img width="668" height="463" src="images/Chap4-188.gif" /></div>
<h3>
<a id="pgfId-1091136"></a>Plotting the Output Frequency Versus the Tun<a id="marker-1207962"></a>ing Voltage</h3>

<p>
<a id="pgfId-1091137"></a>Now quit the waveform window, and select <em>Add To Outputs</em> in the <em>Direct Plot Form</em>, and plot the harmonic frequency again.</p>

<p>
<a id="pgfId-1091157"></a></p>
<div class="webflare-div-image">
<img width="668" height="666" src="images/Chap4-189.gif" /></div>

<p>
<a id="pgfId-1091108"></a>The tuning curve is plotted again, as shown below.</p>

<p>
<a id="pgfId-1091205"></a></p>
<div class="webflare-div-image">
<img width="668" height="440" src="images/Chap4-190.gif" /></div>

<p>
<a id="pgfId-1091229"></a>In ADE Explorer, a new expression is added under the maestro tab.</p>

<p>
<a id="pgfId-1091374"></a></p>
<div class="webflare-div-image">
<img width="668" height="441" src="images/Chap4-191.gif" /></div>
<h3>
<a id="pgfId-1091417"></a>Plotting the Modulation Sensi<a id="marker-1207991"></a>tivity</h3>

<ol><li>
<a id="pgfId-1091418"></a>Double-click the expression in the <em>Details</em> column under the <em>maestro</em> tab. </li><li>
<a id="pgfId-1091405"></a>Click the (<img width="35" height="26" src="images/Chap4-192.gif" /><span>) button.</span><br />
<a id="pgfId-1109770"></a>The calculator opens with the expression in it.<br />
<a id="pgfId-1091472"></a><div class="webflare-div-image">
<img width="668" height="641" src="images/Chap4-193.gif" /></div></li><li>
<a id="pgfId-1091563"></a>Select the derivative function. The expression changes.<br />
<a id="pgfId-1091597"></a><div class="webflare-div-image">
<img width="668" height="640" src="images/Chap4-194.gif" /></div></li><li>
<a id="pgfId-1091640"></a>Set the plotting mode to <em>New Subwindow</em>.</li><li>
<a id="pgfId-1110015"></a>Click the <em>Plot</em> icon.</li></ol>














<p>
<a id="pgfId-1091681"></a>The modulation sensitivity in MHz/Volt is plotted in the subwindow on the right.</p>

<p>
<a id="pgfId-1091700"></a></p>
<div class="webflare-div-image">
<img width="668" height="428" src="images/Chap4-195.gif" /></div>
<h3>
<a id="pgfId-1202423"></a>Oscillator Tuning <a id="marker-1208035"></a>Mode Analysis</h3>

<p>
<a id="pgfId-1202424"></a>The oscillator tuning mode analysis tunes the oscillator so that phase noise can be measured at the desired oscillation frequency. It is supported in both harmonic balance and shooting methods and is typically used in Monte Carlo simulations or sweeps to obtain the phase noise.</p>
<p>
<a id="pgfId-1202425"></a>In oscillator tuning mode analysis, the oscillator frequency is treated as the target frequency, and the value of a circuit parameter is obtained to achieve the target frequency. The circuit parameter can be an arbitrary ADE variable or an instance parameter. </p>
<ol><li>
<a id="pgfId-1202426"></a>Open the pss <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1202427"></a>Set up the target frequency in the <em>Beat Frequency</em> field.</li><li>
<a id="pgfId-1202428"></a>Select the <em>Oscillator</em> check box.</li><li>
<a id="pgfId-1202429"></a>Specify the output node from the <code>Oscillator node+</code> field. Alternatively, click <em>Select</em> and choose the output node from the schematic. Here, <code>vc2</code> is selected.</li><li>
<a id="pgfId-1202430"></a>Select the <em>Enable tuning mode analysis</em> check box.</li><li>
<a id="pgfId-1202431"></a>Choose the parameter that needs to be tuned from the drop-down list. Here, <em>Component Param. </em>has been selected.<br />
<a id="pgfId-1202435"></a><div class="webflare-div-image">
<img width="668" height="258" src="images/Chap4-196.gif" /></div></li><li>
<a id="pgfId-1202436"></a>Specify the name of the parameter in the <em>Component Name</em> field. Alternatively, click <em>Select Component </em>and select the parameter from the schematic. When you select a parameter from the schematic a pop-up window appears that contains a list of selectable parameters.<br />
<a id="pgfId-1202440"></a><div class="webflare-div-image">
<img width="668" height="448" src="images/Chap4-197.gif" /></div></li><li>
<a id="pgfId-1202441"></a>Select a parameter from the list. The <em>Parameter Name</em> field is automatically populated with the name of the parameter (<em>dc</em> in the figure above). </li><li>
<a id="pgfId-1263308"></a>Select the <em>Tuning range</em> check box and specify the minimum and maximum ranges for the parameter, if required.</li><li>
<a id="pgfId-1263312"></a>Run the simulation.</li><li>
<a id="pgfId-1202448"></a>After the simulation completes, click <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> to display the <em>Direct Plot Form</em>.<br />
<a id="pgfId-1202452"></a><div class="webflare-div-image">
<img width="668" height="490" src="images/Chap4-198.gif" /></div></li><li>
<a id="pgfId-1202453"></a>Select <em>Tuning Parameter</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1202454"></a>Click <em>Add to Outputs</em>.</li><li>
<a id="pgfId-1263417"></a>Click <em>OK</em>.<br />
<a id="pgfId-1263469"></a>The value of the tuning parameter is added in the <em>Value </em>column under the <em>maestro</em> tab of the ADE Explorer window, as shown below.<br />
<a id="pgfId-1263474"></a><div class="webflare-div-image">
<img width="663" height="456" src="images/Chap4-199.gif" /></div></li></ol>





























<h3>
<a id="pgfId-1202461"></a>Oscillator Tuning Mode With Sw<a id="marker-1208063"></a>eeps</h3>

<p>
<a id="pgfId-1202462"></a>Sweeps and Monte Carlo are also supported with tuning mode. Below is an example of a sweep of temperature with tuning mode and a phase noise measurement.</p>
<ol><li>
<a id="pgfId-1202463"></a>Enable sweeps in the pss <em>Choosing Analyses</em> form. In this example, temperature is swept from -20 t0 120C. Tuning mode is enabled as before.<br />
<a id="pgfId-1204008"></a><div class="webflare-div-image">
<img width="445" height="782" src="images/Chap4-200.gif" /></div></li><li>
<a id="pgfId-1202469"></a>Because of the sweep, pnoise has been changed to a single frequency offset, which simplifies plotting of phase noise after the sweep.<br />
<a id="pgfId-1204129"></a><div class="webflare-div-image">
<img width="426" height="778" src="images/Chap4-201.gif" /></div></li><li>
<a id="pgfId-1202474"></a>Now run the simulation. Because the tuning parameter and phase noise have already been added under the <em>Maestro</em> tab in ADE Explorer in the previous section, the tuning voltage and the phase noise are plotted after the simulation.<br />
<a id="pgfId-1204255"></a><div class="webflare-div-image">
<img width="619" height="374" src="images/Chap4-202.gif" /></div></li><li>
<a id="pgfId-1202478"></a>To make the phase noise plot more useful, select the X Axis, click the right mouse button, and select <em>Swap Sweep Var</em>. In the window that pops up, click <em>OK</em>. Then delete the original phase noise plot.<br />
<a id="pgfId-1204312"></a><div class="webflare-div-image">
<img width="661" height="373" src="images/Chap4-203.gif" /></div></li><li>
<a id="pgfId-1202687"></a>The trend in tuning voltage and phase noise is plotted.</li></ol>





















<h2>
<a id="pgfId-1202691"></a>Periodic AC A<a id="marker-1202689"></a>naly<a id="pac_analysis"></a>sis (PAC)</h2>
<h3>
<a id="pgfId-1125333"></a>Small-signal Versus Large-Signal Analysis for Conversion Gain</h3>

<p>
<a id="pgfId-1125334"></a>One way to measure conversion gain is to apply the LO and the RF signals in harmonic balance (hb) or quasi-periodic steady-state (qpss) and calculate the full large-signal response at each RF input frequency, and then plot the output as a function of the sweep frequency. While this works, because all the large-signal effects and many harmonics are calculated, the required time for the simulation can be significant.</p>
<p>
<a id="pgfId-1125335"></a>The alternative is to use a small-signal approach similar to the AC analysis. The AC analysis runs considerably faster than running the transient at multiple frequencies because it ignores the large-signal effects. In circuits with frequency translation, the AC analysis is unusable because the calculation is based on the DC bias point. In hb Periodic AC (<a id="PAC"></a>PAC) analysis, instead of using the DC bias point, the harmonic balance periodic steady-state (pss) solution with just the LO is used as the basis of the calculation. The large-signal analysis only calculates the harmonics of a single input, and no mixing products, and then hb pac is run after the hb pss analysis and calculates the outputs that are produced by mixing the pac input with the harmonics that are in the pss analysis. The overall time savings can be very significant.</p>

<h3>
<a id="pgfId-1125337"></a>Example: Conversion Gain (Down C<a id="marker-1208130"></a>onversion)</h3>

<p>
<a id="pgfId-1125338"></a>Consider the double-balanced diode mixer shown below.</p>

<p>
<a id="pgfId-1125342"></a></p>
<div class="webflare-div-image">
<img width="668" height="590" src="images/Chap4-204.gif" /></div>

<p>
<a id="pgfId-1125343"></a>The RF input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. Also note that the pac magnitude term is set to 1 volt. This makes it easy for a conversion gain measurement because the input signal is 0dB when the <em>dB20</em> modifier is used in the <em>Direct Plot Form</em> for the pac result.</p>
<p>
<a id="pgfId-1125344"></a>The property list is shown below.</p>

<p>
<a id="pgfId-1125348"></a></p>
<div class="webflare-div-image">
<img width="668" height="786" src="images/Chap4-205.gif" /></div>

<p>
<a id="pgfId-1125349"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> - <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type the desired value, and press <em>Enter</em>.</p>
<p>
<a id="pgfId-1125350"></a>The LO frequency is 1GHz and its amplitude is 1.4 volts peak. This is +13 dBm. (+13 dBm is a common drive level for diode mixers.) The RF frequency is 1.1GHz, but it is disabled because the amplitude is set to 0 (zero). Setting either the frequency or the amplitude to zero disables the production of that waveform from the port. This provides an easy way to enable or disable signals without needing to change the schematic.</p>

<p>
<a id="pgfId-1125354"></a></p>
<div class="webflare-div-image">
<img width="668" height="461" src="images/Chap4-206.gif" /></div>

<p>
<a id="pgfId-1125355"></a>The pss analysis needs to be set up first. Note that both shooting and harmonic balance are available in pss for the engine. The example below shows a single input at 1GHz with 10 harmonics using the shooting engine. For more information, see <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>. Diode mixers have rapid changes in the diode currents. Because of this rapid change, shooting is likely to be faster and more accurate than harmonic balance. </p>

<p>
<a id="pgfId-1125362"></a></p>
<div class="webflare-div-image">
<img width="668" height="776" src="images/Chap4-207.gif" /></div>

<p>
<a id="pgfId-1125363"></a>Next, the PAC analysis needs to be set up. Like AC, the frequency range specified in the form is the input frequency range. When shooting is used for the pss engine, <em>Maximum sideband</em> should be set somewhere less than four times the number of harmonics set in the pss analysis. Setting 10 sidebands calculates the mixing products from the input frequency in PAC with the harmonics through the tenth harmonic in the pss analysis. The actual number chosen depends on the mixing products that are important in your application. When harmonic balance is chosen for the engine, leave the <em>Maximum sideband</em> field blank. </p>

<p>
<a id="pgfId-1125367"></a></p>
<div class="webflare-div-image">
<img width="668" height="667" src="images/Chap4-208.gif" /></div>

<p>
<a id="pgfId-1125368"></a>Once the analyses are set up, the simulation can be run by selecting <em>Simulation</em> - <em>Netlist and Run</em> in ADE Explorer. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</p>
<p>
<a id="pgfId-1125369"></a>The example below shows a typical <em>Direct Plot Form</em> setup to measure the conversion gain.</p>

<p>
<a id="pgfId-1125373"></a></p>
<div class="webflare-div-image">
<img width="668" height="568" src="images/Chap4-209.gif" /></div>

<p>
<a id="pgfId-1125374"></a>When the net in the schematic is selected, the waveform is displayed.</p>
<p>
<a id="pgfId-1125375"></a>Note that all the short line segments are the mixing products that are produced when mixed with the harmonics in the periodic steady-state (pss) large-signal analysis.</p>
<p>
<a id="pgfId-1125379"></a></p>

<div class="webflare-div-image">
<img width="668" height="444" src="images/Chap4-210.gif" /></div>

<p>
<a id="pgfId-1125380"></a>In the down-conversion case, the frequencies that are produced for the down-converted output product are desired. In the <em>Direct Plot Form</em>, select <em>sideband</em> instead of <em>spectrum</em>, and then select the desired frequency range from the list at the bottom of the form. Only that mixing product will be displayed, as shown below.</p>

<p>
<a id="pgfId-1125384"></a></p>
<div class="webflare-div-image">
<img width="668" height="710" src="images/Chap4-211.gif" /></div>

<p>
<a id="pgfId-1125385"></a>The conversion loss is about 6dB.</p>
<p>
<a id="pgfId-1125389"></a></p>

<div class="webflare-div-image">
<img width="668" height="414" src="images/Chap4-212.gif" /></div>
<h3>
<a id="pgfId-1125390"></a>Example: Conversion Gain (Up Con<a id="marker-1208200"></a>version)</h3>

<p>
<a id="pgfId-1125391"></a>The process is similar for an up-conversion mixer. In this case, the input frequency is low, as shown below. The LO remains at 1GHz, as it was in the previous section. </p>
<p>
<a id="pgfId-1125392"></a>The RF outputs are 50MHz through 150MHz above and below the 1 GHz LO.</p>

<p>
<a id="pgfId-1125396"></a></p>
<div class="webflare-div-image">
<img width="668" height="776" src="images/Chap4-213.gif" /></div>

<p>
<a id="pgfId-1125397"></a>In the <em>Direct Plot Form</em>, both the outputs above and below the LO frequency might be desired.</p>
<p>
<a id="pgfId-1125398"></a>Select the first frequency, and click the second while holding the <em>Ctrl</em> key. Now select the output net in the circuit and the results will plot.</p>

<p>
<a id="pgfId-1125402"></a></p>
<div class="webflare-div-image">
<img width="668" height="703" src="images/Chap4-214.gif" /></div>

<p>
<a id="pgfId-1125403"></a>Note that the conversion loss is almost identical for both mixing products.</p>
<p>
<a id="pgfId-1125407"></a></p>

<div class="webflare-div-image">
<img width="668" height="486" src="images/Chap4-215.gif" /></div>
<h3>
<a id="pgfId-1125408"></a>PAC General Principles</h3>

<p>
<a id="pgfId-1125409"></a>The pss solution with LO calculates the amplitude of the harmonics and characterizes the nonlinearity of the system. Therefore, in pac, the output mixing products of the input signal mixing with the LO harmonics can be calculated. Like ac analysis, pac allows the input to be swept in frequency to calculate a frequency response of the output mixing products. Also, like ac, when pac is used for conversion gain measurements, the conversion gain is the same regardless of the input amplitude. The small-signal conversion gain is calculated and is a good representation of the gain until compression is approached or exceeded in the real circuit. If a measurement of compression is required, use a large-signal analysis like pss, hb, or qpss.</p>

<h4>
<a id="pgfId-1125410"></a>PAC used with Harmo<a id="marker-1208279"></a>nic Balance PSS</h4>

<p>
<a id="pgfId-1125411"></a>When harmonic balance is used for the pss analysis, the harmonics of the circuit are calculated directly by the harmonic balance engine.</p>
<p>
<a id="pgfId-1125412"></a>Think of a perfectly linear circuit with a single input applied. Because the circuit is perfectly linear, in the pss analysis when harmonic balance is used, the frequency domain solution only has the harmonic at the input frequency at every net in the circuit. No other harmonics are created because the system is perfectly linear. Because the circuit is linear, if a second input is applied, no frequency translation can occur.</p>
<p>
<a id="pgfId-1125413"></a>Now imagine a real circuit with a single small input amplitude signal at 1GHz. In the frequency domain with harmonic balance selected in pss, the first harmonic is present along with the higher harmonics. Because the input signal is small, the signals at the harmonics of 1GHz are very small. If a second input is applied at 1.1 GHz, that signal is weakly converted when it is mixed with the harmonics of the circuit. Certainly, 1.1GHz would appear at the output with no mixing. 100MHz and 2.1GHz are produced by mixing with the 1GHz fundamental frequency. 900MHz and 3.1GHz are produced when 1.1GHz mixes with the second harmonic of the 1GHz input. 1.1GHz mixes with the other harmonics as well, producing a wide range of output frequencies from a single input frequency. The harmonic output might look like the figure below. Only the first three harmonics are shown. The black harmonics are the pss harmonics, and the red mixing products are pac outputs, which are called sidebands.</p>

<p>
<a id="pgfId-1125417"></a></p>
<div class="webflare-div-image">
<img width="668" height="399" src="images/Chap4-216.gif" /></div>

<p>
<a id="pgfId-1125418"></a>Note that there is an output mixing product that is created at 100MHz. Because the real circuit is nonlinear, harmonics of 100MHz are created in the circuit. In pac, the assumption is that all the signals are small, and with this assumption, the harmonics of 100MHz do not need to be calculated. This assumption also applies to all the other outputs in pac. Therefore, the PAC output is a partial output from the circuit with only the main mixing products displayed. Since in most cases, these are the desired outputs, conversion gain can still be obtained by using pac. In other words, pac calculates the main mixing products that are created by mixing with the pss harmonics, but the harmonics of the pac outputs are not calculated.</p>
<p>
<a id="pgfId-1125419"></a>Now imagine that the 1GHz signal is larger. If the input goes up 10dB, the first harmonic goes up 10dB, In the frequency domain, if harmonic balance is selected in pss, the second harmonic would come up 20dB, the third harmonic would come up 30dB, and so on. If a second input at 1.1GHz is applied to the circuit, this mixes with the fundamental and the harmonics of 1GHz and more strongly mixes up-and-down in frequency. This is illustrated below. The black harmonics are the pss harmonics, and the red mixing products are pac outputs, which are called sidebands.</p>
<p>
<a id="pgfId-1208413"></a></p>

<div class="webflare-div-image">
<img width="668" height="401" src="images/Chap4-217.gif" /></div>
<h4>
<a id="pgfId-1208416"></a>PAC used with Shooti<a id="marker-1208414"></a><a id="marker-1208415"></a>ng PSS</h4>

<p>
<a id="pgfId-1208417"></a>Shooting is a variation of the transient analysis where the individual timepoints are calculated, and the entire waveform is iterated to calculate the steady-state waveform. The transient algorithm works by using all the equations at all the nodes in the circuit where the assumption is made that the sum of the currents is zero at every node and at every timepoint. Ohm&#39;s law is observed, and the equations look like <code>I=V*G</code> where <code>G</code> is the conductance. In general, the matrix form of the equations is constructed, so the system of simultaneous equations becomes <code>[G]*[V]=[I]</code> where <code>[G]</code> is a square matrix, and <code>[V]</code> and <code>[I]</code> are columns. To solve for [<code>V]</code>, the <code>[G]</code> matrix is inverted and this matrix multiplies the <code>[I]</code> matrix to solve for all the voltages on all the nodes. At the end of the pss analysis, all the solution matrices are saved as data to be passed to the small-signal analyses. The result is that the conductance is calculated and saved for every nonlinear component in the circuit at every timepoint.</p>
<p>
<a id="pgfId-1125426"></a>For the following circuit:</p>

<p>
<a id="pgfId-1125430"></a></p>
<div class="webflare-div-image">
<img width="668" height="202" src="images/Chap4-218.gif" /></div>

<p>
<a id="pgfId-1125431"></a>Below is the I-versus-V curve with 3 different values for the input voltage. The center, positive peak of the input, and the negative peak of the input are shown. The input amplitude is small.</p>

<p>
<a id="pgfId-1125435"></a></p>
<div class="webflare-div-image">
<img width="668" height="444" src="images/Chap4-219.gif" /></div>

<p>
<a id="pgfId-1125436"></a>In the above figure, the amplitude of the 1 GHz signal causes small variations in the slope of the tangent of the nonlinear curve as the input signal is varied in amplitude. The slope is the conductance. Because the circuit has a nonlinear device, the conductance of the device varies slightly from timepoint to timepoint in the pss analysis. Because the input signal at 1.0GHz is small, the variation in conductance from timepoint to timepoint is small. The slope changes just a little bit as the input signal is moved over its range.</p>
<p>
<a id="pgfId-1125437"></a>Now imagine that the 1GHz signal is 10dB larger. A 10dB change is a linear factor of about 3.16. The larger amplitude of the input causes a larger portion of the nonlinear device curves to be traversed, and thus the variation in conductance becomes larger. If a second input at 1.1GHz were applied to the circuit, this mixes with the fundamental and the harmonics of 1GHz and more strongly mixes up and down in frequency. This is illustrated below.</p>

<p>
<a id="pgfId-1125441"></a></p>
<div class="webflare-div-image">
<img width="668" height="424" src="images/Chap4-220.gif" /></div>

<p>
<a id="pgfId-1125442"></a>Therefore, the variation in the conductance of the devices from timepoint to timepoint when shooting is selected in pss, or the harmonic content if harmonic balance is selected in pss contains information about how strongly a circuit translates frequencies, and this is used by the pac small-signal analysis to calculate the small-signal conversion gain. </p>

<h3>
<a id="pgfId-1264989"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1264990"></a>PAC has a choice called specialized analysis which is located near the bottom of the <em>Choosing Analyses</em> form. This sets the mode of the measurement to be either averaged over the whole pss waveform or at a specific timepoint in the pss waveform. Many different types of analyses can be performed, like conversion gain, distortion contribution, and instantaneous gain measurements. Below is a description of the capabilities for each specialized analysis setting.</p>
<p>
<a id="pgfId-1125445"></a>Also note that in this section, just the concepts are discussed without any mention of how to do the setup in ADE Explorer. To see the ADE Explorer setup, see <a href="Chap4.html#49926">ADE Implementation</a>. </p>

<h4>
<a id="pgfId-1125446"></a>Specialized Analys<a id="marker-1208385"></a>is=None</h4>
<h4><em>
<a id="pgfId-1125447"></a>Down Conversion: Input Near the First harmonic</em></h4>

<p>
<a id="pgfId-1125448"></a>At the bottom of the pac <em>Choosing Analyses</em> form, there is a selection called <em>Specialized Analyses</em>. The default is <em>None</em>, and this is for measuring the conversion gain that is the average conversion gain with the large signal applied to the circuit (usually the LO or the sample clock) applied to the circuit. The mixing products that are produced are called sidebands. The sideband number is the harmonic number that is being mixed with to provide the output. A positive number means that the output mixing product is higher in frequency than the input frequency specified in the <em>Choosing Analyses</em> form. A negative number means that the output is lower in frequency than the input frequency. A diagram is shown below.</p>

<p>
<a id="pgfId-1125452"></a></p>
<div class="webflare-div-image">
<img width="668" height="385" src="images/Chap4-221.gif" /></div>

<p>
<a id="pgfId-1125453"></a>We tend to think of positive frequencies. The default is to reflect negative frequencies to positive frequencies.</p>
<p>
<a id="pgfId-1125454"></a>Again, in pac, a single input frequency is applied at a time, and then the output mixing products are calculated through the highest harmonic of the periodic steady-state (pss) simulation specified by the <em>Maximum sideband</em> parameter. <em>Maximum sideband</em> defaults to seven for shooting and the total number of harmonics specified in the pss analysis for hb. Usually <em>Maximum sideband</em> is set to calculate the desired mixing products. This can be accomplished by setting <em>Maximum sideband</em> or by using the select from range capability in the pac <em>Choosing Analyses</em> form.</p>

<h4><em>
<a id="pgfId-1125455"></a>Up-conversion: Input Near Zero Frequency</em></h4>

<p>
<a id="pgfId-1125456"></a>In a similar manner, up-conversion is shown below.</p>

<p>
<a id="pgfId-1125460"></a></p>
<div class="webflare-div-image">
<img width="668" height="381" src="images/Chap4-222.gif" /></div>
<h4>
<a id="pgfId-1125461"></a>Frequency S<a id="marker-1208435"></a>weep</h4>

<p>
<a id="pgfId-1125462"></a>This analysis is like AC, where the input frequency is swept. The input frequency range is specified in the pac <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1125464"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonic in the pss analysis. For example, assume that the pss is at 1GHz, and a log sweep is desired above the first harmonic of the pss analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 in the <em>Relative Harmonic</em> field. Next, type in 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade.</p>
<p>
<a id="pgfId-1125465"></a>The sweep will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1125469"></a></p>
<div class="webflare-div-image">
<img width="668" height="301" src="images/Chap4-223.gif" /></div>

<p>
<a id="pgfId-1125470"></a>To use a log sweep below the first harmonic, use the same frequency range, and type in -1 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1125474"></a></p>
<div class="webflare-div-image">
<img width="668" height="383" src="images/Chap4-224.gif" /></div>
<h4>
<a id="pgfId-1125475"></a>Maximum Si<a id="marker-1208456"></a>deband</h4>

<p>
<a id="pgfId-1125476"></a>Sideband is the name of the PAC output mixing product. The sideband number is the pss harmonic number that is mixed with. If the sideband number is negative, the output frequency is mixed down in frequency from the input. If the sideband is positive, the output is mixed up in frequency.</p>
<p>
<a id="pgfId-1125477"></a>Conceptually, an infinite number of mixing products are produced when a single input is applied to a nonlinear system. From the practical point of view, usually only a small number of mixing products need to be measured.</p>
<p>
<a id="pgfId-1125478"></a>There is a property in the <em>Choosing Analyses</em> form called <em>Maximum sideband</em> that is used to define how many mixing products should be calculated. If <em>Maximum sideband</em> is zero, the pac analysis will only contain the frequency that appears without mixing or aliasing of any type. This is not equivalent to a linear AC analysis because pac takes into account the instantaneously varying nature of the LO or sample clock signal because of the large signal being present in the pss analysis.</p>
<p>
<a id="pgfId-1125479"></a>When <em>Maximum sideband</em> is one, the outputs without frequency translation and the outputs that mix or alias with the first harmonic of the pss analysis are present in the pac analysis. When <em>Maximum sideband</em> is 10, the pac analysis includes mixing through the 10th harmonic of the pss analysis. When shooting is used for the pss analysis, the number of sidebands can be any number up to four times the number of harmonics specified in the pss analysis. When harmonic balance is selected, up to the number of harmonics in the pss analysis can be selected.</p>

<h4>
<a id="pgfId-1125481"></a>Setting Harmonics and Sidebands</h4>
<h4><em>
<a id="pgfId-1125482"></a>Shooting</em></h4>

<p>
<a id="pgfId-1125483"></a>The pss analysis, when shooting is selected, has a minimum of 200 timepoints, so it inherently has frequency domain content through the 100th harmonic of the pss beat frequency. Maximum harmonic is a pss post-processing property that specifies how many harmonics to calculate in the Fourier transform of the waveform in pss. If the number of harmonics is zero, it just means that no frequency domain information should be calculated in the simulation. If the number of harmonics is 10 or less, there is no effect on the PSS waveform. When maximum harmonics gets larger than 10, the minimum number of timepoints in the pss analysis is increased. 20 timepoints at the frequency of the highest harmonic are forced. Thus, if maximum harmonics is raised, the pss waveform gets more accurate at the cost of longer runtimes and more memory required to run the pss simulation because more timepoints are forced in the pss simulation.</p>
<p>
<a id="pgfId-1125484"></a>In order for the pac analysis to correctly measure conversion gain, the wave shape at the highest mixing harmonic needs to be accurate, so with the default settings in shooting pss, up to 40 sidebands can be accurately calculated in the pac analysis. In most cases, only a small number of sidebands needs to be calculated, and so with shooting, you can count on the pac result to be accurate.</p>
<p>
<a id="pgfId-1125485"></a>If you need more than 40 sidebands when you are using shooting pss, you need to set the <em>maxacfreq</em> option in the pss analysis to the pss beat frequency times the number of sidebands requested in the pac analysis, or alternatively, set the number of pss harmonics to the number of sidebands divided by four. Either method works to set the maximum timestep in the pss analysis as required for the pac analysis to be accurate.</p>

<h4><em>
<a id="pgfId-1125486"></a>Harmonic Balance</em></h4>

<p>
<a id="pgfId-1125487"></a>When <em>Harmonic Balance</em> is selected in the pss analysis, only the harmonics specified in the pss <em>Choosing Analyses</em> form exist in the solution. In the pac analysis, because only the harmonics specified in the pss-hb <em>Choosing Analyses</em> form exist, the maximum sideband term can only be the number of harmonics specified in the pss analysis or less. Usually when <em>Harmonic Balance</em> is selected in the pss analysis, the <em>Maximum sideband</em> field in pac usually should be left blank which calculates all the output mixing products.</p>
<p>
<a id="pgfId-1125488"></a>Note that with harmonic balance, the number of harmonics (and oversample factor if you have non-sinusoidal waveforms) in the pss analysis needs to be determined. Start with a number of harmonics in the pss based on an estimate of how many harmonics the circuit actually produces with your input waveform, and run the pss and pac analyses. Remember that for non-sinusoidal waveforms, oversample factor also needs to be set greater than one. Run the analysis and do the desired measurement. Now increase the number of harmonics by roughly 50% and run the simulation again. If the answer does not change, then you had enough harmonics originally, and you might actually be able to decrease the number of harmonics from the original setting. If you have non-sinusoidal waveforms, increase the oversample factor before increasing the number of harmonics to find the minimum value for both oversample factor and harmonics.</p>

<h4><em>
<a id="pgfId-1125489"></a>Modulat<a id="marker-1208463"></a>ed</em></h4>

<p>
<a id="pgfId-1125490"></a>Modulated pac is typically used for measuring AM to PM measurements in driven circuits and oscillators. In this case, the input is usually the power supply ripple at low frequency, and the desired output is near the first harmonic of the output. Modulated is an averaged measurement over the whole pss waveform (shooting) or all the harmonics (harmonic balance). Pac apples a modulated input signal to the circuit, and is able to measure a modulated output signal from the circuit. The types of modulation are Single Side Band (SSB), AM, and PM.</p>
<p>
<a id="pgfId-1125491"></a>A diagram is shown below for SSB input.</p>

<p>
<a id="pgfId-1125495"></a></p>
<div class="webflare-div-image">
<img width="668" height="355" src="images/Chap4-225.gif" /></div>

<p>
<a id="pgfId-1125496"></a>Note that although the input occurs at one frequency, the AM output can be measured directly from the single input.</p>
<p>
<a id="pgfId-1125497"></a>When AM is applied at the input, the following figure is shown.</p>
<p>
<a id="pgfId-1125501"></a></p>

<div class="webflare-div-image">
<img width="668" height="369" src="images/Chap4-226.gif" /></div>

<p>
<a id="pgfId-1125502"></a>The difference is that in addition to the input at low positive frequency, another input (to form an AM signal) is applied at a low negative input. This second input adds to the output signal near the first harmonic.</p>
<p>
<a id="pgfId-1125503"></a>For PM, the negative input amplitude is negative, as shown below.</p>

<p>
<a id="pgfId-1125507"></a></p>
<div class="webflare-div-image">
<img width="668" height="367" src="images/Chap4-227.gif" /></div>

<p>
<a id="pgfId-1125508"></a>By running all three inputs, the SSB/AM/PM input to SSB/AM/PM output can be calculated. This is a setup choice in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1125509"></a>In the <em>Choosing Analyses</em> form, the input frequency range, and the output harmonic must also be specified.</p>
<p>
<a id="pgfId-1125510"></a>All the plot functions are implemented in the <em>Direct Plot Form</em>.</p>

<h4>
<a id="pgfId-1125511"></a>Rapid IP2/IP3 (AC and PAC)</h4>

<p>
<a id="pgfId-1125512"></a>Rapid I<a id="marker-1208496"></a>P2 and Rapid<a id="marker-1208501"></a> IP3 have been added to the ac and pac analyses. First, a provision has been made to allow two input frequencies. Second, the ac and pac analyses have been enhanced so that harmonics of those signals and the intermodulation distortion can be calculated. Doing this in a small-signal analysis is much faster than doing this in a large-signal analysis because the large-signal effects are ignored. </p>
<p>
<a id="pgfId-1125513"></a>The Rapid IP2 and Rapid IP3 that is available in the ac <em>Choosing Analyses</em> form allows the calculation of IP2 and IP3 for amplifiers. In pac, Rapid IP3 and Rapid IP2 are provided for circuits that translate frequencies, whether that translation is an up or down conversion. In this case, the signal that is causing the frequency translation (the LO or the sample clock) is applied in the pss analysis first in order to characterize the nonlinearity of the system so that the correct IP2/IP3 measurement can be made. Note that pac and ac are small-signal analyses, so the limitation is that the measurement is a small-signal IP3 or IP2. If you need a large-signal IP2 or IP3 measurement, use a large-signal analysis like hb or qpss to make the measurement. Note that when you are using Rapid IP2 or Rapid IP3 in the ac analysis, either a SpectreRF license is required, or an additional mmsim token is required to run the analysis.</p>
<p>
<a id="pgfId-1125514"></a>Make sure that the input level for the IP3 or IP2 measurement is in the small-signal range. Rapid IP2 and IP3 have exceptionally small numerical noise floors, therefore, it is recommended that you specify a level that is too small, rather than too large. Rapid IP2 and Rapid IP3 work by evaluating the device equations for nonlinearity. Do not specify one volt as the input amplitude because this is generally in a large-signal range, and usually causes the devices to reach points where the device currents are deliberately linearized, thus making the IP2/3 measurement more linear than it actually is.</p>
<p>
<a id="pgfId-1125515"></a>The plot functions for Rapid IP2 and Rapid IP3 are implemented in the <em>Direct Plot Form</em>. </p>
<ol><li>
<a id="pgfId-1125516"></a>Select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. In the Direct Plot Form.</li><li>
<a id="pgfId-1125517"></a>Select <em>ac</em> or <em>pac</em> from the <em>Analysis</em> section. </li><li>
<a id="pgfId-1125518"></a>Select <em>Rapid IP2</em> or<em> Rapid IP3</em> (depending on which was set up) from the <em>Function</em> section, and click <em>Plot</em>. </li></ol>


<p>
<a id="pgfId-1125519"></a>The X and Y points are shown for the intercept.</p>
<p>
<a id="pgfId-1125520"></a>The X value is input-referred IP2/IP3, and the Y is output-referred IP2/IP3.</p>
<p>
<a id="pgfId-1125521"></a>Note that if you have a switched-FET mixer and you are using the BSIM3 or BSIM4 models, due to a model limitation, the IP3 calculation from rapid IP2/IP3 will be incorrect. In this case, the PSP model is recommended. If a PSP model is not available, use hb or qpss with an input amplitude that is as large as possible while still being in the small-signal range for your circuit or switch to a 1dB gain compression measurement, The compression measurement is much more accurate than the IP3 measurement for switched FET mixers.</p>

<h4>
<a id="pgfId-1125522"></a>Compression and IP2 distortion summary</h4>

<p>
<a id="pgfId-1125523"></a>The distortion summaries measure distortion for an amplifier in ac or in circuits that have frequency translation in pac. The idea is to find which devices in a signal path contribute relatively more or less to the distortion. Since IP3 and compression are related mathematically, the compression distortion summary provides information about which devices contribute the most amount of third order intermodulation distortion. The IP2 distortion summary measures which devices contribute to the second order distortion. Note that when you are using the distortion summaries in the ac analysis for amplifiers, either a SpectreRF license is required, or an additional mmsim token is required to run the analysis.</p>
<p>
<a id="pgfId-1125524"></a>Both distortion summaries use the <em>PAC Magnitude</em> property in the input port. Make sure that the <em>PAC Magnitude</em> (in volts or dBm) is actually in the small-signal range, (At least 10 dB smaller than the 1dB gain compression point) or the results will not be accurate. This is because the pac results do not take into account the large-signal limits like slew-rate or power supply voltage and the device models deviate from the ideal equations at very large amplitude by just continuing a linear slope above a certain amplitude. That amplitude depends on the device model parameters and is likely to be reached with a 1 volt input amplitude. The compression distortion summaries have an extremely low numerical noise floor, so it is better to set an input amplitude that is too small, than to set it too large.</p>
<p>
<a id="pgfId-1125525"></a>The distortion summaries provide a list output, not a plot output. Accordingly, instead of selecting <em>Results</em> - <em>Direct Plot </em>- <em>Main Form</em>, select <em>Results</em> - <em>Print</em> - <em>PAC Distortion Summary</em>.</p>
<p>
<a id="pgfId-1125526"></a>For the compression distortion, you get the actual gain with the distortion of each device by itself divided by the ideal small-signal gain provided by the pac analysis. In addition, the amplitude of the first three harmonics of the linear output frequency is calculated.</p>
<p>
<a id="pgfId-1125527"></a>For the IM2 distortion summary, you get the total IM2 output amplitude that results from having only a single device in the circuit.</p>

<h4>
<a id="pgfId-1125528"></a>Sam<a id="marker-1208506"></a>pled</h4>

<p>
<a id="pgfId-1125529"></a>Sampled is provided in order to calculate the instantaneous conversion gain at a voltage threshold crossing in the pss waveform or at specific timepoints in the pss simulation. Note that this analysis is fundamentally different than the analyses discussed earlier. All the previous analyses measured the average conversion gain that is produced when all the harmonics are taken into account (hb) or all the timepoints are taken into account (shooting). In sampled, an instantaneous measurement at a single point in time (or a list of times) of the LO or clock waveform is made.</p>
<p>
<a id="pgfId-1125530"></a>Note that when harmonic balance is selected, sampled pac is the same as in shooting, but the time-domain waveform is the ifft of the harmonics calculated by the harmonic balance analysis. This is useful for measuring the conversion gain from the power supply to the oscillator output at a threshold crossing, or at specific times in the LO waveform to the output of a mixer.</p>
<p>
<a id="pgfId-1125531"></a>When shooting is selected, a minimum of 200 timepoints exist in the solution waveform, and shooting automatically makes the timestep smaller in areas of rapid change, thus, there is likely a datapoint in the pss analysis that is very near the voltage level you specify as a threshold. In harmonic balance, the timepoints in the ifft depend on the number of harmonics and the oversample factor. Set a large enough number of harmonics and/or set a large enough oversample factor to make sure that there is a timepoint in the ifft that is very near the actual threshold value you specify in the <em>Choosing Analyses</em> form.</p>

<h2>
<a id="pgfId-1125532"></a><a id="49926"></a>ADE Implementation</h2>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1125533"></a>In general, the examples in this section show shooting pss. The examples work for harmonic balance pss unless otherwise noted. This is done mostly to show shooting. Harmonic balance has its own section in <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance.&#8221;</a>.</div>
<p>
<a id="pgfId-1125534"></a>The settings in the PAC form can be slightly different for shooting and harmonic balance, and the method for both is covered in each section.</p>

<h3>
<a id="pgfId-1125535"></a>Circuit, Input port Setting, and ADE Explorer Setup for all the Examples in This Section</h3>

<p>
<a id="pgfId-1125536"></a>Consider the following circuit:</p>

<p>
<a id="pgfId-1125540"></a></p>
<div class="webflare-div-image">
<img width="668" height="526" src="images/Chap4-228.gif" /></div>

<p>
<a id="pgfId-1125541"></a>This above circuit is an LNA and a mixer for a 2.4GHz application that is implemented in CMOS. The input source (a port in Cadence terminology) has the values for its frequency and amplitude set to variable names. The PAC magnitude property is set to 1 volt in order to allow easy conversion gain measurements. The reason for the variables is that the frequency and amplitude can be changed in the ADE Explorer environment without changing the schematic.</p>
<p>
<a id="pgfId-1125542"></a>The <em>Edit Object Properties</em> form for the input port is shown below.</p>

<p>
<a id="pgfId-1125546"></a></p>
<div class="webflare-div-image">
<img width="668" height="793" src="images/Chap4-229.gif" /></div>

<p>
<a id="pgfId-1125547"></a>ADE Explorer has the variables set to appropriate values, as shown below.</p>
<p>
<a id="pgfId-1125551"></a></p>

<div class="webflare-div-image">
<img width="668" height="525" src="images/Chap4-230.gif" /></div>

<p>
<a id="pgfId-1125552"></a>Note that the variables fb1 and fb2 (which set the input frequency of the input port) are set to zero, which effectively disables the RF input. Only the LO signal is applied to the circuit for the pss analysis.</p>

<h3>
<a id="pgfId-1125553"></a>Using PAC Analysis for Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1125554"></a>Set up the pss analysis with just the large signal that causes the frequency translation to occur, which is generally the LO signal or the sample clock. For more information, refer to <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>. Regarding whether to use shooting or harmonic balance, pick the analysis that produces the smallest runtime. In general, shooting is recommended for systems that have sharp edges, and harmonic balance is recommended for systems that are more sinusoidal.</p>

<p>
<a id="pgfId-1125561"></a></p>
<div class="webflare-div-image">
<img width="668" height="786" src="images/Chap4-231.gif" /></div>

<p>
<a id="pgfId-1125562"></a>Set up the pac <em>Choosing Analyses</em> form as follows:</p>

<p>
<a id="pgfId-1125566"></a></p>
<div class="webflare-div-image">
<img width="668" height="761" src="images/Chap4-232.gif" /></div>

<ol><li>
<a id="pgfId-1125567"></a>Specify the input frequency range. In this case, the <em>Sweeptype</em> is set to <em>absolute</em>, which means that there is no frequency shift applied to the input frequency. If a log sweep above the first harmonic is desired, set the <em>Sweeptype</em> to <em>relative</em>, and specify one as the relative harmonic number. The input frequency range would be 1MHz to 100MHz to get the same frequency range as in the example above. Relative shifts the frequency specified the harmonic number times the pss frequency.</li><li>
<a id="pgfId-1125568"></a>For pac, the <em>Maximum sideband</em> field should be set to the highest harmonic of the pss analysis that mixing products are desired to be calculated. This is generally determined by the application. If you only need one or two output mixing product, choose <em>Select from range</em>, and highlight the sidebands you want to calculate. Setting <em>Maximum sideband</em> for pac is usually not critical as long as enough sidebands are calculated to measure the desired output mixing product (called a sideband). The <em>Direct Plot Form</em> allows the plotting of individual output mixing products as will be shown later. As a general recommendation, set the number of sidebands equal to the number of pss harmonics.</li><li>
<a id="pgfId-1125569"></a>For a conversion gain measurement, set the <em>PAC Magnitude</em> to 1 volt on the <em>Edit Object Properties</em> form, as shown earlier. This is always volts peak.</li><li>
<a id="pgfId-1125570"></a>Now run the simulation. In ADE Explorer, select <em>Simulation</em> - <em>Netlist and Run</em>.</li><li>
<a id="pgfId-1125571"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1125575"></a><div class="webflare-div-image">
<img width="668" height="574" src="images/Chap4-233.gif" /></div></li></ol>








<p>
<a id="pgfId-1125576"></a>Mixing products are calculated for mixing the pac input frequency range with the harmonics calculated in the pss analysis. Harmonics of the pac input and harmonics of the output mixing products are not calculated because pac is a small-signal analysis. Because it is small-signal, the harmonics of the input and the harmonics of the mixing products are so small that they do not matter.</p>
<p>
<a id="pgfId-1125577"></a>To measure the outputs you desire, place a marker at the desired output frequency of interest and read the conversion gain, as shown below.</p>

<p>
<a id="pgfId-1125581"></a></p>
<div class="webflare-div-image">
<img width="668" height="428" src="images/Chap4-234.gif" /></div>

<p>
<a id="pgfId-1125582"></a>To plot a single output sideband (mixing product), in the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1125583"></a>Select <em>sideband</em> instead of <em>spectrum</em>, and select the desired output mixing product form the list as shown below.<br />
<a id="pgfId-1125587"></a><div class="webflare-div-image">
<img width="668" height="697" src="images/Chap4-235.gif" /></div></li><li>
<a id="pgfId-1125588"></a>Select the output net in the schematic, or click the <em>Replot</em> button in the <em>Direct Plot Form</em>. The waveform tool displays the output, as shown below.<br /><ffi2-fig-frame-in-2 id="#id1125592">
<a id="pgfId-1125592"></a></ffi2-fig-frame-in-2><div class="webflare-div-image">
<img width="668" height="449" src="images/Chap4-236.gif" /></div></li><li>
<a id="pgfId-1125593"></a>Position a marker by moving the cursor to the desired output frequency and type <code>m</code>. The marker appears, as shown in the figure above.</li><li>
<a id="pgfId-1125594"></a>To position the marker at an exact frequency, place it as above, and then move your cursor over the intercept point on the trace. Click and hold the right mouse button, move  to <em>Marker Properties</em>, and release the mouse button. The <em>Point Marker Properties</em> window appears, as shown below.<br />
<a id="pgfId-1125598"></a><br /><div class="webflare-div-image">
<img width="668" height="679" src="images/Chap4-237.gif" /></div></li><li>
<a id="pgfId-1125599"></a>Type the frequency in the <em>Position</em> field, and click <em>OK</em> or <em>Apply</em>.</li></ol>

















<h3>
<a id="pgfId-1125600"></a>Sampled Circuits and Switched-capac<a id="marker-1208599"></a>itor Filters</h3>

<p>
<a id="pgfId-1125601"></a>For sampled circuits or for switched-capacitor circuits, always use shooting pss because the clocking waveforms have rapid transitions. Shooting captures these transitions in a natural and accurate way.</p>
<p>
<a id="pgfId-1125602"></a>In pac, generally only the sideband with zero frequency translation is desired, so <em>Maximum sideband</em> can be set to zero. A warning is produced in the Spectre output window stating that the number of sidebands is lower than anticipated. This warning can be ignored.</p>
<p>
<a id="pgfId-1125603"></a>Note that the average gain is determined by pac. In the sampling circuit, this is generally very near unity gain, but for the switched-capacitor circuit without a sample and hold, the gain is generally a bit less than half amplitude which is about -6dB. This is because the output waveform follows the input waveform for a little less than half the time, and the capacitors are reset by the switches the other half the time.</p>
<p>
<a id="pgfId-1125604"></a>If you desire to see the aliasing at different harmonics of the clock, use pxf analysis. For example, imagine a sampling frequency of 1MHz. In pac, with the zero sideband only, the input and output frequencies are always the same. Therefore, if the input is at 1.1MHz in pac, the output is also at 1.1MHz. Generally, the term that is interesting is the term that aliases down from 1.1MHz to 100KHz which is not measured by the pac analysis (The input and output frequencies are the same in the zero sideband.) To see the aliasing at the different harmonics, use pxf with an output frequency of near zero to 500KHz, and specify <em>Maximum sideband</em> to the harmonic number desired. If the <em>Maximum sideband</em> is greater than 40, either set the pss option <em>maxacfreq</em> to the number of sidebands times the pss beat frequency, or set the number of harmonics to the number of sidebands divided by four.</p>

<h3>
<a id="pgfId-1125605"></a>Commonly Used P<a id="pac_options"></a>AC Options</h3>
<h4>
<a id="pgfId-1125606"></a>Freq<a id="marker-1208617"></a>axis</h4>
<p>
<a id="pgfId-1125610"></a></p>
<div class="webflare-div-image">
<img width="668" height="740" src="images/Chap4-238.gif" /></div>

<p>
<a id="pgfId-1125611"></a><em>freqaxis</em> specifies whether you want to see the negative frequency axis or not.</p>
<p>
<a id="pgfId-1125612"></a>The analysis calculates the output frequencies and amplitudes, so <em>out</em> and <em>absout</em> are reasonable choices. <em>out</em> displays the negative frequency axis. <em>absout</em> (absolute value of the output) displays positive output frequencies. This is the default.</p>
<p>
<a id="pgfId-1125613"></a>If you select <em>in</em>, all the outputs at the different frequencies are plotted on the same input frequency range scale. This is not recommended. The default is <em>absout</em>.</p>
<p>
<a id="pgfId-1125614"></a>Below is an example of <em>freqaxis</em> set to <em>out</em>. Note that the data is the same as before. It is just displayed with the negative frequency axis present. The negative frequencies have not been reflected up to the positive frequency domain.</p>

<p>
<a id="pgfId-1125618"></a></p>
<div class="webflare-div-image">
<img width="668" height="442" src="images/Chap4-239.gif" /></div>

<p>
<a id="pgfId-1125619"></a>Below is an example with the <em>freqaxis</em> option set to <em>in</em>. All the outputs at different frequencies are plotted on the input frequency scale. The frequency can be calculated by selecting the appropriate sideband from the list on the left side of the waveform tool, and then adding the sideband number times the pss beat frequency to the frequency displayed on the X axis.</p>
<p>
<a id="pgfId-1125623"></a></p>

<div class="webflare-div-image">
<img width="668" height="476" src="images/Chap4-240.gif" /></div>
<h4>
<a id="pgfId-1125624"></a>Toler<a id="marker-1208648"></a>ance</h4>

<p>
<a id="pgfId-1125625"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1125626"></a>Pac uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough, and the tolerance option specifies that accuracy for pac. For shooting, the default tolerance is 1e-9. For driven circuits where HB is the pss engine, the default is 1e-6. For oscillators where hb is selected for the pss engine, the default is 1e-4.</p>

<h4>
<a id="pgfId-1125627"></a>Solv<a id="marker-1208653"></a>er</h4>

<p>
<a id="pgfId-1125628"></a>The solver option is used only for driven circuits. The default solver is the turbo solver.</p>
<p>
<a id="pgfId-1125629"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1125630"></a>When shooting is used, sometimes when the pac input frequency is very close to the frequency of one of the harmonics in the pss, warning messages will appear in the pac output warning that the accuracy might not be good enough. If you see these messages, select the std solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but which takes longer to run than the turbo solver.</p>

<h4>
<a id="pgfId-1148615"></a>Hbpreco<a id="marker-1208691"></a>nd_solver </h4>
<h4>
<a id="pgfId-1148616"></a>This option is only available only when harmonic balance is selected in PSS.</h4>

<p>
<a id="pgfId-1148603"></a>The basic solver is the only solver available in standard Spectre. Autoset is the default solver when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window.</p>

<h4>
<a id="pgfId-1125631"></a>Oscs<a id="marker-1208696"></a>olver</h4>

<p>
<a id="pgfId-1125632"></a>The oscsolver option is used only for oscillators. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1125633"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1125634"></a>When shooting is used, sometimes when the pac input frequency is very close to the frequency of one of the harmonics in the pss, warning messages appear in the pac output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but takes longer to run than the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1125635"></a>For very large oscillator designs, the ira oscsolver may take less memory and run faster with no loss in accuracy, however, it is less robust for convergence compared to <em>turbo</em> or <em>std</em>.</p>

<h4>
<a id="pgfId-1125636"></a>Gear_o<a id="marker-1208701"></a>rder</h4>

<p>
<a id="pgfId-1125637"></a>Do not change this option.</p>

<h4>
<a id="pgfId-1125645"></a>Resgmr<a id="marker-1208711"></a>escycle</h4>

<p>
<a id="pgfId-1125646"></a>Leave this option at the default.</p>

<h4>
<a id="pgfId-1125647"></a>Outputperiod</h4>

<p>
<a id="pgfId-1125648"></a>Do not use this option.</p>

<h4>
<a id="pgfId-1125649"></a>AdditionalPa<a id="marker-1208716"></a>rams</h4>

<p>
<a id="pgfId-1125650"></a><em>In some cases when shooting is used in pss on an oscillator circuit measurements near a pss harmonic may be questionable. If this occurs, type osc_version=dts in the addionalParams field to solve the issue.</em></p>
<p>
<a id="pgfId-1234991"></a><em>additionalParams</em> is typically used for new features that are being beta tested.</p>
<p>
<a id="pgfId-1125651"></a>For more information about the other options, type <code>spectre -h pac</code> at the command prompt in a Unix shell window</p>

<h3>
<a id="pgfId-1125652"></a>PAC With Multiple P<a id="marker-1208731"></a>SS Inputs</h3>

<p>
<a id="pgfId-1125653"></a>This is generally used when the conversion gain is desired with a large blocker signal present at the RF input. The basic strategy is to apply the signals that cause the nonlinearity to occur (the LO and the blocking signal) in the pss, and then use pac to measure the conversion gain when the blocker is present. In many cases, the blocker power is swept in order to measure the degradation in conversion gain when the blocker gets large.</p>
<p>
<a id="pgfId-1125654"></a>Multiple input frequencies might be able to be run in the PSS, depending on the ratio between the highest input frequency divided by the pss beat frequency. If this ratio is about 25 or less, then pss can be used for the simulation. If the ratio is greater than 25, consider using harmonic balance (hb) or qpss to run the simulation because it is very likely to take less time to run.</p>
<p>
<a id="pgfId-1125655"></a>To set up the second input, the variable fb1 was set to 2.5G in the ADE Explorer window, as shown</p>
<p>
<a id="pgfId-1125656"></a>below. This variable sets the frequency of the first source in the port component that supplies the RF signal. In this case, the LO is at 2.4GHz and the RF is at 2.5GHz.</p>

<p>
<a id="pgfId-1125660"></a></p>
<div class="webflare-div-image">
<img width="668" height="558" src="images/Chap4-241.gif" /></div>

<p>
<a id="pgfId-1125661"></a>The pss was set up with 175 total harmonics of 100MHz to allow harmonics through the seventh harmonic of the LO signal at 2.5GHz to be calculated. For more information on pss, <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>.</p>

<p>
<a id="pgfId-1125668"></a></p>
<div class="webflare-div-image">
<img width="668" height="789" src="images/Chap4-242.gif" /></div>

<p>
<a id="pgfId-1125669"></a>Remember that the frequency range is the input frequency range. In this example, the frequencies just above the first harmonic of the LO are swept.</p>
<p>
<a id="pgfId-1125670"></a>The pac form is set up to calculate the mixing products for all the harmonics that are calculated in the pss analysis. When shooting is used in the pss analysis, up to four times as many sidebands can be specified in pac as harmonics are specified in pss. When harmonic balance is used in pss, <em>Maximum sideband</em> can be set up to the number of harmonics in the pss analysis. Sidebands are the mixing products that are produced when the input signal mixes with the harmonics in the pss analysis.</p>

<p>
<a id="pgfId-1125674"></a></p>
<div class="webflare-div-image">
<img width="668" height="646" src="images/Chap4-243.gif" /></div>

<p>
<a id="pgfId-1125675"></a>Now run the analysis. The spectral plot below from the pss analysis shows that because there were more input frequencies in the circuit, many more harmonics are produced by the circuit, which is as expected.</p>

<p>
<a id="pgfId-1125679"></a></p>
<div class="webflare-div-image">
<img width="668" height="437" src="images/Chap4-244.gif" /></div>

<p>
<a id="pgfId-1125680"></a>As shown below, because there are many more pss harmonics to mix with, many more mixing products (sidebands) are produced by pac.</p>
<p>
<a id="pgfId-1125684"></a></p>

<div class="webflare-div-image">
<img width="668" height="421" src="images/Chap4-245.gif" /></div>

<p>
<a id="pgfId-1125685"></a>The next figure shows a zoomed-in area near zero frequency. Only the mixing products larger than -100 dB are shown.</p>

<p>
<a id="pgfId-1125689"></a></p>
<div class="webflare-div-image">
<img width="668" height="420" src="images/Chap4-246.gif" /></div>

<p>
<a id="pgfId-1125690"></a>Note that the index in the pac analysis is the frequency shift from the input frequency to the output frequency in multiples of the pss beat frequency. The output highlighted above mixes with the 24th harmonic of 100MHz, which is the LO signal in the circuit. This is the main output mixing product when RF mixes with LO.</p>
<p>
<a id="pgfId-1125691"></a>Note that the RF input in the pac analysis at 2.4001G to 2.45G can also mix with 2.5G (The additional RF signal.) When the RF input is at 2.4001G the IF output is 99.9MHz when it mixes with the other RF tone at 2.5GHz. As the input frequency in the pac sweeps up, the output frequency sweeps down to 50MHz. Since it is mixing with 2.5GHz, the output frequency is downshifted by -25*100MHz, thus the sideband number shown in the legend at the left is -25. This is shown below.</p>
<p>
<a id="pgfId-1125695"></a></p>

<div class="webflare-div-image">
<img width="668" height="456" src="images/Chap4-247.gif" /></div>
<h3>
<a id="pgfId-1125696"></a>Rapid IP3/IP2</h3>

<p>
<a id="pgfId-1125697"></a>Rapid IP<a id="marker-1208805"></a>3 and Rapid I<a id="marker-1208811"></a>P2 are available in the ac and the pac <em>Choosing Analyses</em> forms. Rapid IP3 in the ac form is for measuring IP3 of amplifiers where there is no frequency translation, and Rapid IP3 in the pac form allows the measurement of IP3 where frequency translations are present. Rapid IP3 and IP2 measure small-signal IP3 and IP2.</p>
<p>
<a id="pgfId-1125698"></a>The example below is for an LNA-mixer circuit.</p>
<ol><li>
<a id="pgfId-1125699"></a>First set up the pss form with just the LO applied, as shown below. For more information, see <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>. Both the shooting and harmonic balance pss engines are supported in pac.<br />
<a id="pgfId-1125706"></a><div class="webflare-div-image">
<img width="668" height="785" src="images/Chap4-248.gif" /></div>
<a id="pgfId-1125707"></a>In the example below, the LO is at 2.4GHz, and the RF inputs are at 2.401GHz and 2.4012GHz. This makes the main mixing products at the output of the mixer at 1MHz and 1.2MHz. The third order intermods are at 800KHz and 1.4MHz. Because the frequencies are similar, either the 1 or 1.2 MHz products can be set as the linear frequency, and either the 800KHz or 1.4MHz term can be used for the third order frequency. Generally, the smallest amplitude linear term and the largest amplitude third order term are used for the IP3 measurement. If IP2 was desired, the second order product is at the difference frequency between the 2 RF inputs (200KHz in this example). The first order terms are the same as IP3.</li><li>
<a id="pgfId-1125708"></a>Select the <em>pac</em> analysis. At the bottom of the form in the <em>Specialized Analysis</em> section, select <em>Rapid IP3</em> or <em>Rapid IP2</em>, depending on what you want to measure. The entries for the forms are identical, except for the frequency of the intermodulation product. For switched FET mixers, make sure that the psp model is used. Incorrect results are produced for BSIM3 and BSIM4 models due to a limitation in the model. If you need to measure IP3 with a BSIM3 or 4 model, use hb analysis with as large an amplitude as possible while maintaining the amplitude in the small-signal region.</li><li>
<a id="pgfId-1125709"></a>Define the input port, input frequencies, input power, the frequencies of the linear and second or third order products, and the output node. An example for Rapid IP3 is shown below. Make sure that the input power is in the small-signal range. (At least 10dB smaller than the compression point)</li><li>
<a id="pgfId-1125710"></a>Select the output net in the circuit.<br />
<a id="pgfId-1125711"></a>Note that for amplifiers, the pss analysis does not need to be set up. Just use the ac <em>Choosing Analyses</em> form which has the same appearance as the pac <em>Choosing Analyses</em> form shown below. The linear output frequency can be either of the two input frequencies. The third-order frequency can be the frequency spacing above or below the RF input frequencies.<br />
<a id="pgfId-1125715"></a><div class="webflare-div-image">
<img width="668" height="760" src="images/Chap4-249.gif" /></div></li><li>
<a id="pgfId-1125716"></a>Leave the <em>Maximum Non-linear Harmonics</em> field blank. The default value is appropriate for the Rapid IP2/IP3 calculation.</li><li>
<a id="pgfId-1125717"></a>Run the simulation. When the simulation is complete, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.<br />
<a id="pgfId-1125721"></a><div class="webflare-div-image">
<img width="668" height="460" src="images/Chap4-250.gif" /></div></li><li>
<a id="pgfId-1125722"></a>Select <em>pac</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1125723"></a>Select <em>Rapid IP3</em> from the <em>Function</em> section.<br />
<a id="pgfId-1125724"></a>Rapid IP2 is shown if an IP2 analysis is run.</li><li>
<a id="pgfId-1125725"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1125726"></a>The waveform is displayed. The marker shown at the intercept point shows the input and  output-referred IP3 or IP2.<br />
<a id="pgfId-1125730"></a><br /><div class="webflare-div-image">
<img width="668" height="451" src="images/Chap4-251.gif" /></div></li></ol>



























<h3>
<a id="pgfId-1125731"></a>Compression Distortion Summary</h3>

<p>
<a id="pgfId-1125732"></a>The compression distortion summary is provided in order to get a relative measure of which components in a gain path contribute more or less compression. Because compression and IP3 are related mathematically, the compression distortion provides information about which components contribute to IP3. </p>
<p>
<a id="pgfId-1125733"></a>Note that the Compression Distortion Summary is available in the ac and the pac <em>Choosing Analyses</em> forms. Compression Distortion Summary in the ac form is for measuring which components add compression in amplifiers where there is no frequency translation, and Compression Distortion Summary in the pac form allows the measuring of components that contribute to compression where frequency translations are present in the circuit.</p>
<p>
<a id="pgfId-1125734"></a>Note that for sampling circuits or for switched-capacitor filters, the sample clock(s) are applied in the pss, and the small-signal input Is applied in the pac analysis.</p>
<p>
<a id="pgfId-1125735"></a>The <em>Contributor Instances</em> field is provided so that you can select which components in the circuit should be considered in the analysis. If the <em>Contributor Instances</em> field is left blank, all the nonlinearities in your circuit are run.</p>
<p>
<a id="pgfId-1125736"></a>The following example is for an LNA-Mixer circuit.</p>
<ol><li>
<a id="pgfId-1125737"></a>First set up the pss analysis with just the LO or sample clock applied, as shown below. For more information, see <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>.<br />
<a id="pgfId-1125744"></a><div class="webflare-div-image">
<img width="668" height="757" src="images/Chap4-252.gif" /></div></li><li>
<a id="pgfId-1125745"></a>Now select pac analysis.</li><li>
<a id="pgfId-1125746"></a>Select <em>Compression Distortion Summary</em> from the <em>Specialized Analyses</em> drop-down list.<br />
<a id="pgfId-1125747"></a>The following notice appears to remind you to set the PAC amplitude parameter in the source in the schematic to a value somewhere in the small-signal range. This is generally at least 10dB smaller than the 1dB gain compression point.<br />
<a id="pgfId-1125751"></a><div class="webflare-div-image">
<img width="668" height="122" src="images/Chap4-253.gif" /></div></li><li>
<a id="pgfId-1125752"></a>If you leave the <em>Contributor Instances</em> field blank, all the nonlinear devices in your circuit will be run. If you want a subset, click <em>Select</em>, and select the instances you want on the schematic.</li><li>
<a id="pgfId-1125753"></a>Specify the input frequency in the <em>Frequency of Input Source</em> field.</li><li>
<a id="pgfId-1125754"></a>Specify the output frequency in the <em>Frequency of Linear Output Signal</em> field.</li><li>
<a id="pgfId-1125755"></a>Leave the <em>Maximum Non-Linear Harmonics</em> field blank. The default value is <em>optimum</em> for the compression distortion measurement.</li><li>
<a id="pgfId-1125756"></a>Select the output node in the circuit. When the <em>Out-</em> field is left blank, ADE Explorer automatically assigns this to the global ground node.<br />
<a id="pgfId-1125757"></a>The completed form appears similar to the one shown below.<br />
<a id="pgfId-1125761"></a><div class="webflare-div-image">
<img width="668" height="715" src="images/Chap4-254.gif" /></div></li><li>
<a id="pgfId-1125762"></a>In the <em>Edit Object Properties</em> form, make sure that the <em>PAC magnitude (dBm)</em> is set in the small-signal range. In this example, it is set to -30Bm.<br />
<a id="pgfId-1125766"></a><div class="webflare-div-image">
<img width="668" height="203" src="images/Chap4-255.gif" /></div></li><li>
<a id="pgfId-1125767"></a>If you make changes to your schematic that you want for the distortion summary, but you do not want to save them to the circuit file, make the desired changes and then select <em>Check</em> - <em>Current Cellview</em> in the schematic window. Later, if you want to save them, just select <em>Check </em>and<em> Save</em>. If you do not want them, quit from the schematic window, and do not save the changes.<br />
<a id="pgfId-1125772"></a><div class="webflare-div-image">
<img width="668" height="615" src="images/Chap4-256.gif" /></div>
<a id="pgfId-1125773"></a>ADE Explorer will netlist from the checked view, so it will get the changes.</li><li>
<a id="pgfId-1125774"></a>When you are done, run the simulation.</li><li>
<a id="pgfId-1125775"></a>When the simulation completes, select <em>Results</em> - <em>Print</em> - <em>PAC Distortion Summary</em>.<br />
<a id="pgfId-1125776"></a>The summary is displayed below.<br />
<a id="pgfId-1125780"></a><div class="webflare-div-image">
<img width="668" height="644" src="images/Chap4-257.gif" /></div><ul><li>
<a id="pgfId-1125781"></a>The first column is the instance name in the schematic.</li><li>
<a id="pgfId-1125782"></a>The second column is the gain with the nonlinearity of that single device divided by the ideal gain from the ac or pac analysis.<br />
<a id="pgfId-1125783"></a>Gain compression is shown as a negative number. Gain expansion is shown as a positive number.</li><li>
<a id="pgfId-1125784"></a>The third, fourth, and fifth columns are the amplitudes of the first, second, and third harmonic of the linear output frequency with just the nonlinearity of that single device taken into account.</li></ul></li></ol>














































<h4>
<a id="pgfId-1125785"></a>Sampled Circuits and Switched-capacitor Filters</h4>

<p>
<a id="pgfId-1125786"></a>For sampled circuits or for switched-capacitor circuits, always use shooting pss because the clocking waveforms have rapid transitions. Shooting captures these transitions in a natural and accurate way.</p>
<p>
<a id="pgfId-1125787"></a>In pac, set up the compression distortion form just as you would for the mixer example above. Note that the linear output frequency is the input frequency. Otherwise, the setup is exactly the same as the setup shown above.</p>

<h3>
<a id="pgfId-1125788"></a>IM2 Distortion Summary</h3>

<p>
<a id="pgfId-1125789"></a>The steps for the IM2 distortion summary are very similar to the Compression Distortion Summary in the previous section. The differences are noted below.</p>
<ul><li>
<a id="pgfId-1125790"></a>The IM2 distortion summary provides the output voltage (magnitude, real, and imaginary  parts) of the second order distortion signal for each component in the schematic by itself.</li><li>
<a id="pgfId-1125791"></a>The IM2 distortion summary does not provide a selection mechanism for the devices in the circuit. All the devices are run in the IM2 distortion summary.</li><li>
<a id="pgfId-1125792"></a>The output format is slightly different. The first column is the instance name in the schematic. The second column is the magnitude of the IM2 product that is produced by that single component in volts. The third column has the real and imaginary parts of the voltage. A sample is shown below.<br />
<a id="pgfId-1125796"></a><div class="webflare-div-image">
<img width="668" height="661" src="images/Chap4-258.gif" /></div></li></ul>





<h4>
<a id="pgfId-1125797"></a>Sampled Circuits and Switched-capacitor Filters</h4>

<p>
<a id="pgfId-1125798"></a>For sampled circuits or for switched-capacitor circuits, always use shooting pss because the clocking waveforms have rapid transitions. Shooting captures these transitions in a natural and accurate way.</p>
<p>
<a id="pgfId-1125799"></a>In pac, set up the IP2 distortion form just as you would for the mixer example above. Note that the linear output frequency is one of the input frequencies and the intermodulation frequency is the frequency spacing. Otherwise, the setup is exactly the same as the setup shown above.</p>

<h3>
<a id="pgfId-1125800"></a>Modulated PAC Analysis</h3>

<p>
<a id="pgfId-1125801"></a>Modulated pac analysis is usually applied to oscillators to measure AM-to-PM conversion from low-frequencies on the power supply (ripple) to the output near the first harmonic. It can also be applied to digital circuits for the same purpose. Although the shape of the transfer function is different, the steps are the same for both applications.</p>
<p>
<a id="pgfId-1125802"></a>In the circuit, make sure that any PAC magnitude terms are removed on the input source (if there is one), and set the PAC Magnitude to 1 volt in the source that is used as the power supply. If you do not want to save the change permanently, just select <em>Check</em> - <em>Current View </em>in the schematic.</p>
<p>
<a id="pgfId-1125803"></a>This example is for an oscillator. The circuit is shown below:</p>

<p>
<a id="pgfId-1125807"></a></p>
<div class="webflare-div-image">
<img width="668" height="529" src="images/Chap4-259.gif" /></div>

<p>
<a id="pgfId-1125808"></a>In ADE Explorer, set values for the power supply voltage and for the tuning voltage.</p>

<p>
<a id="pgfId-1125812"></a></p>
<div class="webflare-div-image">
<img width="668" height="510" src="images/Chap4-260.gif" /></div>

<p>
<a id="pgfId-1125813"></a>Set up the pss analysis. For more information on pss, see <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>.</p>

<p>
<a id="pgfId-1125820"></a></p>
<div class="webflare-div-image">
<img width="668" height="778" src="images/Chap4-261.gif" /></div>

<p>
<a id="pgfId-1125821"></a>In the pac <em>Choosing Analyses</em> form, first select <em>Modulated</em> in the <em>Specialized Analyses</em> section, as shown below.</p>

<p>
<a id="pgfId-1125825"></a></p>
<div class="webflare-div-image">
<img width="668" height="739" src="images/Chap4-262.gif" /></div>

<p>
<a id="pgfId-1125826"></a>Note that selecting <em>Modulated</em> causes the <em>Sweep type</em> to be set to <em>relative</em>. Since the gain from power supply ripple to the output is desired, the relative harmonic number is zero, and then the desired frequency range is entered. If the shooting engine is used, maximum sideband can be up to 4 times the number of harmonics in the pss analysis harmonics as shown above. Setting the <em>Sweeptype</em> to <em>relative</em> allows a frequency shift in multiples of the pss beat frequency to be applied to the input frequency. In this example, when the relative harmonic is zero, the input frequency range is not shifted at all in frequency.</p>
<p>
<a id="pgfId-1125827"></a>Maximum sideband needs to be set larger than is needed for measuring the output frequency. In this case, the input signal is the ripple at low frequency, and the output is near the first harmonic. Because of this, <em>Maximum sideband</em> needs to be one or larger. In this case, the setting of <em>Maximum sideband</em> is set to the same number as the maximum harmonics setting in pss.</p>
<p>
<a id="pgfId-1125828"></a><em>Input Type</em> is set to <em>SSB/AM/PM</em> so that all the combinations of SSB, AM, and PM to SSB, AM, or PM can be calculated.</p>
<p>
<a id="pgfId-1125829"></a>Next, the output frequency ranges to be calculated can be set. Note that a list of harmonics can be entered. The easiest way is to click the <em>Choose</em> button to the right of the field, and select the desired frequencies from a list in the <em>Choose Harmonic</em> window, as shown below.</p>

<p>
<a id="pgfId-1125833"></a></p>
<div class="webflare-div-image">
<img width="668" height="293" src="images/Chap4-263.gif" /></div>

<p>
<a id="pgfId-1125834"></a>The same process is used to set the input frequency, but only one frequency range is allowed.</p>

<p>
<a id="pgfId-1125838"></a></p>
<div class="webflare-div-image">
<img width="668" height="291" src="images/Chap4-264.gif" /></div>

<p>
<a id="pgfId-1125839"></a>Once the analysis has been set up, run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</p>
<p>
<a id="pgfId-1125840"></a>The input defaults to <em>AM</em>. Select <em>PM</em> for the output. Since many output frequencies were calculated, you need to select the one you want to plot. In this example, the output just above the first harmonic is selected. Once this is done, select a net in the schematic.</p>

<p>
<a id="pgfId-1125844"></a></p>
<div class="webflare-div-image">
<img width="668" height="701" src="images/Chap4-265.gif" /></div>

<p>
<a id="pgfId-1125845"></a>The output is displayed. To make a measurement at a specific frequency, position a marker. The measurement is in radians per volt of input on the supply that has PAC magnitude set.</p>

<p>
<a id="pgfId-1125849"></a></p>
<div class="webflare-div-image">
<img width="668" height="487" src="images/Chap4-266.gif" /></div>
<h3>
<a id="pgfId-1125850"></a>Sampled PAC Analysis</h3>

<p>
<a id="pgfId-1125851"></a>Pac sampled is for measuring the conversion gain at a specific instantaneous time in the pss waveform. The first step is to determine an appropriate threshold for the measurement by setting up the pss analysis, as shown below. Shooting is shown below, but this is also available in harmonic balance. For harmonic balance, the waveform is an ifft of the harmonics.</p>

<p>
<a id="pgfId-1125855"></a></p>
<div class="webflare-div-image">
<img width="668" height="778" src="images/Chap4-267.gif" /></div>

<p>
<a id="pgfId-1125856"></a>Now run the analysis. When the analysis completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer and plot the time-domain waveform on the output net, as shown below.</p>
<p>
<a id="pgfId-1125857"></a>The waveform is shown below.</p>

<p>
<a id="pgfId-1125861"></a></p>
<div class="webflare-div-image">
<img width="668" height="420" src="images/Chap4-268.gif" /></div>

<p>
<a id="pgfId-1125862"></a>Note that 2.5 volts is a value near the middle of the waveform. This is chosen as the threshold for the calculation. Pick a threshold that is appropriate for your system.</p>
<p>
<a id="pgfId-1125863"></a>Now set up the pac <em>Choosing Analyses</em> form.</p>
<ol><li>
<a id="pgfId-1125864"></a>At the top of the form, set up the input frequency range like normal.</li><li>
<a id="pgfId-1125865"></a>At the bottom of the form, select <em>Sampled</em>. Usually the gain to a node is desired, so select voltage.</li><li>
<a id="pgfId-1125866"></a>Click <em>Select</em> to the right of the <em>Net+</em> field and select the node in the schematic. Note that if the <em>Net-</em> field is left blank, the global ground node is used.</li><li>
<a id="pgfId-1125867"></a>Specify the desired threshold voltage based on the time-domain waveform from the pss analysis</li><li>
<a id="pgfId-1125868"></a>Choose an option from the <em>Crossing Direction</em> drop-down box. In the example, <em>all</em> is selected.</li><li>
<a id="pgfId-1125869"></a>If you need more than 16 crossing points, type the number you need in the <em>Maximum Samples</em> field.</li><li>
<a id="pgfId-1125870"></a>If you want to sample at specific times from the pss waveform, you can type in the times in the <em>Additional Timepoints</em> field.<br />
<a id="pgfId-1125874"></a><div class="webflare-div-image">
<img width="668" height="782" src="images/Chap4-269.gif" /></div></li><li>
<a id="pgfId-1125875"></a>Now run the simulation. When the simulation completes, open the <em>Direct Plot Form</em> and set it up, as shown below.<br />
<a id="pgfId-1125879"></a><div class="webflare-div-image">
<img width="668" height="589" src="images/Chap4-270.gif" /></div></li><li>
<a id="pgfId-1125880"></a>Select <em>pac</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1125881"></a>Select <em>Voltage </em>from the <em>Function</em> section.</li><li>
<a id="pgfId-1125882"></a>Select <em>spectrum</em> from the <em>Sweep</em> section.</li><li>
<a id="pgfId-1125883"></a>Select <em>dB20</em> from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1125884"></a>Select the time you want from the list.</li><li>
<a id="pgfId-1125885"></a>Select the output node in the schematic.</li></ol>





















<p>
<a id="pgfId-1125886"></a>The waveform is plotted as shown below</p>

<p>
<a id="pgfId-1125890"></a></p>
<div class="webflare-div-image">
<img width="668" height="384" src="images/Chap4-271.gif" /></div>

<p>
<a id="pgfId-1125891"></a>To zoom in to the frequency of interest, double-click one of the numbers on the X Axis, and type in the output frequency range of interest. This is shown below.</p>
<p>
<a id="pgfId-1125892"></a>To measure the conversion gain to the output, move the tracking cursor to the output frequency and read the gain or place a point marker by typing <code>m</code>.</p>
<p>
<a id="pgfId-1125896"></a></p>

<div class="webflare-div-image">
<img width="668" height="435" src="images/Chap4-272.gif" /></div>
<h2>
<a id="pgfId-1137773"></a>Periodic N<a id="pnoise"></a>oise Analysis (<strong><em>Pnoise</em></strong>)</h2>
<h3>
<a id="pgfId-1137774"></a>Small-Signal Versus Large-Signal Analysis for Noise</h3>

<p>
<a id="pgfId-1137775"></a>In most cases, noise is a small-signal problem in the real world. Consider an amplifier. One approach is to calculate the small-signal gain from the noise sources to the output, then calculate the frequency response of the noise source, and then add up the noise power at the output. This is done in the linear noise analysis. This runs quickly because the gain calculation just takes the tangent at the DC operating point for everything in the circuit. This ignores large-signal effects like slew-rate limits and clipping. Because noise in most circuits is actually very small compared to the output levels, this approach works well. Because it is a linear approach, frequency translations cannot be calculated.</p>
<p>
<a id="pgfId-1243261"></a>When the input to the amplifier gets large enough that it starts to create nonlinearity, the frequency translations in the circuit need to be taken into account. Noise near the harmonics can mix up or down to the output frequency. In this case, the large signal needs to be applied in a large-signal analysis like periodic steady-state (pss) where the nonlinearity and harmonic levels can be calculated. After the pss runs, pnoise runs and is similar to linear noise except the frequency translations of the circuit are taken into account. Instead of calculating a single gain from the noise source to the output, both the amplitude of the noise and the gain for the noise sources at the significant harmonics needs to be calculated, and each noise source now has several contributions at the output from several different noise frequencies that mix or alias to the output frequency. The basic strategy is to apply the signals that cause nonlinearity in the pss analysis, and follow that with a pnoise calculation.</p>
<p>
<a id="pgfId-1137777"></a>This same approach can be taken for mixers where the LO signal deliberately introduces nonlinearity for the purpose of frequency translation. The LO signal is applied to the mixer in the pss analysis, and pnoise follows that. This works with the mixer by itself, or in combination with other circuits, like an LNA and a baseband amplifier.</p>
<p>
<a id="pgfId-1137779"></a>Many designs need to tolerate a large amplitude blocking signal. The basic strategy is to apply the LO and the blocking signal (and not the RF signal) in the pss analysis and follow with pnoise. Note that depending on the frequencies of the LO and the blocker, pss may not be appropriate. If the highest frequency divided by the periodicity of the system (the pss beat frequency) is about 25 or less, pss-pnoise is a reasonable approach. If the highest input frequency is 2.5GHz and the periodicity is 1MHz, use hb-hbnoise or qpss-qpnoise instead because they will require much less time and memory to run. This is because pss calculates all the harmonics of the pss beat frequency, and 2500 harmonics would be needed just to calculate the fundamental frequency of the 2.5GHz input. Both hb and qpss calculate just the mixing frequencies that are actually produced by the circuit, which is a much smaller number of harmonics. The blocker power can be swept in the pss analysis and pnoise is run after each sweep value for the blocker power to measure the increase in noise with higher blocker power (desensitization).</p>
<p>
<a id="pgfId-1137780"></a>For large-signal noise problems, or for systems that are not periodic, transient noise is provided. For more information on this, refer to the <em>Spectre&#174; Circuit Simulator and Accelerated Parallel Simulator User Guide</em>. This approach requires specifying a maximum noise frequency to be analyzed, which in RF systems is usually quite high. Two timepoints are created in the period of noisefmax. The transient needs to be run over many noise points in order to characterize the noise present in the circuit and needs post-processing to see the results in the frequency domain. This usually requires much more time than using small-signal noise analyses.</p>

<h3>
<a id="pgfId-1137781"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1137782"></a>The fundamental quantity calculated in pnoise is the output noise of the circuit with a large signal applied and including the noise translations caused by the nonlinearity of the circuit. In order to run pnoise, a periodic steady-state (pss) analysis needs to be run first in order to calculate the nonlinearity of the circuit and the amplitude of the harmonics that are present to mix with. Pnoise takes this information from the pss analysis and then for each noise source, it calculates the transfer functions from all the frequencies specified by the maximum sideband field in the <em>Choosing Analyses</em> form. Then it calculates the frequency response of the noise source itself. Next, it calculates the total noise power at the output for that source at all the noise frequencies that contribute at the output. Finally, it adds up all the noise power from all the sources at all the frequencies. Input-referred calculations require the selection of the input frequency range by setting the reference sideband. This selection is necessary because there are many transfer functions from the input to the output caused by mixing or aliasing from the different harmonics of the system. The passband frequency is also needed for the noise figure calculations.</p>
<p>
<a id="pgfId-1137783"></a>Note that pnoise is a small-signal calculation that works for periodic systems. If the noise is large-signal, or the system is not periodic, transient noise should be used.</p>

<h3>
<a id="pgfId-1137784"></a>Example</h3>

<p>
<a id="pgfId-1137785"></a>Consider the double-balanced diode mixer below where a single-sideband noise figure measurement is desired.</p>

<p>
<a id="pgfId-1137789"></a></p>
<div class="webflare-div-image">
<img width="668" height="569" src="images/Chap4-273.gif" /></div>

<p>
<a id="pgfId-1137790"></a>The input source has variables set to define the frequency and amplitude of the two large-signal outputs. This is done so that the frequency and the amplitude can be set in the ADE Explorer window without changing the schematic. </p>
<p>
<a id="pgfId-1137791"></a>The property list is shown below.</p>

<p>
<a id="pgfId-1137799"></a></p>
<div class="webflare-div-image">
<img width="668" height="785" src="images/Chap4-274.gif" /></div>

<p>
<a id="pgfId-1137800"></a>The variables have values set under the <em>Design Variables</em> section in the <em>Setup</em> pane of ADE Explorer. The easiest way to get the variables list is to generate a netlist from ADE Explorer or use <em>Variables</em> - <em>Copy From CellView</em>. This causes all the variable names to be entered in the variables section. Just click the value field for each variable and enter a value. Press &lt;Enter&gt; when you are done. In the figure below, the LO frequency set by the variable flo is 1GHz. This circuit just has the signal that causes the frequency translations to occur (the LO signal) applied. Note that 1.4 volts peak is +13 dBm. This is a common drive level for diode mixers.</p>

<p>
<a id="pgfId-1137805"></a></p>
<div class="webflare-div-image">
<img width="668" height="425" src="images/Chap4-275.gif" /></div>

<p>
<a id="pgfId-1137806"></a>The pss analysis needs to be run first in order to measure the amplitude of the harmonics and to characterize the nonlinearity of the system. From this, the noise folding from all the noise sources can be calculated in the pnoise analysis. For more information on the setup of the pss form, please refer to <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>.</p>
<p>
<a id="pgfId-1137807"></a>Pss can be set to use either the shooting engine or the harmonic balance engine. The example below uses the shooting engine. Because shooting is a variation of the transient which automatically reduces the timestep in areas or rapid transition (where the diodes switch) and because the pss includes at least 200 timepoints in the solution, the PSS Shooting solution itself contains information to the 100th harmonic of 1GHz. For the pnoise to be accurate, at least 5 timepoints are needed at the highest frequency that is being calculated in the pnoise. Thus, with the defaults, frequency translations through the 40th harmonic of 1GHz can be accurately calculated when shooting is selected as the engine.</p>

<p>
<a id="pgfId-1137811"></a></p>
<div class="webflare-div-image">
<img width="545" height="782" src="images/Chap4-276.gif" /></div>

<p>
<a id="pgfId-1141881"></a>When harmonic balance is selected as the engine, the number of harmonics and the oversample factor need to be set appropriately. For more information, see <a href="Chap3.html#42683">Chapter 3, &#8220;Frequency Domain Analyses: Harmonic Balance,&#8221;</a> Below is an example of harmonic balance in the pss <em>Choosing Analyses</em> form.</p>

<p>
<a id="pgfId-1141896"></a></p>
<div class="webflare-div-image">
<img width="460" height="739" src="images/Chap4-277.gif" /></div>

<p>
<a id="pgfId-1141888"></a>Regardless of the engine that is used in the pss <em>Choosing Analyses</em> form, the noise output frequency and the number of noise translations to be calculated are set up in the pnoise form. When harmonic balance is selected for the engine in pss, leave the maximum sideband field blank or set it to the number of harmonics in the pss-hb <em>Choosing Analyses</em> form, which calculates the noise translations for all the harmonics that are calculated in the pss analysis. When shooting is selected, you must specify the number of noise translations you want to calculate in the maximum sidebands field. Up to 40 noise translations can be calculated with the default settings in pss. The example below shows 40 sidebands, which is the number of harmonics used in the pss-hb analysis that is shown in the preceding figure.</p>

<p>
<a id="pgfId-1141935"></a></p>
<div class="webflare-div-image">
<img width="448" height="775" src="images/Chap4-278.gif" /></div>

<p>
<a id="pgfId-1137820"></a>The reference sideband setting is used to specify the passband frequency for the noise figure calculation.</p>
<p>
<a id="pgfId-1137821"></a>In the example above, the output frequency is near baseband. </p>
<p>
<a id="pgfId-1142083"></a>The reference sideband selects the passband frequency for the noise figure calculation. Once both forms are set up, the simulation is run. To plot outputs, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>

<p>
<a id="pgfId-1142098"></a></p>
<div class="webflare-div-image">
<img width="394" height="548" src="images/Chap4-279.gif" /></div>

<p>
<a id="pgfId-1137825"></a>The top of the form lists all the analyses that were run. Select <em>pnoise</em> where the noise figure is calculated. Next, select <em>NF</em> because that is what is desired to be plotted. If the noise figure over a bandwidth is desired, select <em>Integrated Over Bandwidth</em>, and specify the frequency range you desire for the measurement.</p>
<p>
<a id="pgfId-1137827"></a>When you are done, click <em>Plot</em>. </p>
<p>
<a id="pgfId-1137828"></a>The waveform window plots the noise figure curve and the integrated noise figure calculation over the frequency range you specified in the direct plot form. This is shown below.</p>

<p>
<a id="pgfId-1137832"></a></p>
<div class="webflare-div-image">
<img width="668" height="439" src="images/Chap4-280.gif" /></div>
<h3>
<a id="pgfId-1137833"></a>Principles of Pnoise</h3>

<p>
<a id="pgfId-1235971"></a>Pnoise has three basic types of noise calculation. The first mode calculates the average noise power that occurs with the variations of the LO or clock signal taken into account. The noise is averaged over the LO or clock cycle. This is calculated when the <code>noisetype</code> parameter is set to <code>timeaverage</code>. The AM and PM components of the noise can also be calculated from <code>timeaverage</code>. For oscillators, when PM is selected, an averaged measurement can be made for FM jitter as well as phase noise. When the <code>noisetype</code> is set to <code>sampled(jitter)</code>, an instantaneous measurement of the noise at the threshold crossing in the pss analysis is calculated.This applies to both driven circuits and oscillators. There is a third setting in the <em>Choosing Analyses</em> form which is called <code>timedomain</code>. Conceptually, this does the same noise measurement as <code>noisetype=sampled(jitter)</code>, but it requires you to do the jitter calculation manually. It also allows multiple places in the rising and/or falling edges to be measured.</p>

<h3>
<a id="pgfId-1137835"></a>Noise Type=timeaverage </h3>
<h4>
<a id="pgfId-1137836"></a>Noise Output Near Zero Frequency </h4>

<p>
<a id="pgfId-1137837"></a>First, the pss analysis is run to calculate the nonlinearity and the harmonics. Then pnoise is run to calculate the noise. In all systems, there is a maximum number of noise translations that need to be taken into account. Either the system harmonics become so small that the amount of noise translation becomes minimal or the devices themselves have finite noise bandwidths. </p>
<p>
<a id="pgfId-1137838"></a>These noise calculations from mixing or aliasing with the different harmonics are called sidebands.</p>

<p>
<a id="pgfId-1137842"></a></p>
<div class="webflare-div-image">
<img src="images/Chap4E/3_80.gif" /></div>

<p>
<a id="pgfId-1137843"></a>In the diagram above the X axis is the frequency. The top represents the harmonics that are calculated by the pss analysis. The bottom represents the noise output frequency. The arrows show the various mixing paths to the output frequency. Pnoise calculates the noise contribution at the output with all these mixing paths in place. Black is the noise that occurs without mixing or aliasing. Purple is the noise that mixes with the first harmonic. Blue is the noise that mixes with the second harmonic. Red is the noise that mixes with the third harmonic.</p>
<p>
<a id="pgfId-1137844"></a>In pnoise, the output frequency range is specified along with the highest harmonic to calculate the mixing products.</p>

<h3>
<a id="pgfId-1137845"></a>Noise Output Near The First Harmonic</h3>
<p>
<a id="pgfId-1137849"></a></p>
<div class="webflare-div-image">
<img src="images/Chap4E/3_81.gif" /></div>

<p>
<a id="pgfId-1137850"></a>Here, the noise output frequency is just above the first harmonic frequency. Black is the noise that occurs without mixing. Purple is the noise that mixes with the first harmonic. Blue is the noise that mixes with the second harmonic. Note that the noise frequency just below the first harmonic mixes with the second harmonic to provide the output just above the first harmonic. Red is the noise that mixes with the third harmonic. Note that the second term that mixes with the third harmonic is just above the fourth harmonic of the pss analysis which is not shown. The noise term shown with a dotted line is mixing with the fourth harmonic of the system.</p>

<h3>
<a id="pgfId-1137851"></a>Frequency Sweep</h3>

<p>
<a id="pgfId-1137852"></a>Since the fundamental quantity that is calculated in pnoise is the output noise, the frequency range defined in the <em>Choosing Analyses</em> form defines an output frequency range to calculate the noise for. For driven circuits, the default is to sweep an absolute frequency range. Oscillators will be covered later in this chapter.</p>
<p>
<a id="pgfId-1137853"></a>For an up-conversion system, sometimes, a log frequency range is desired near one of the harmonics of the system. In that case, select relative sweep, and specify a harmonic number. In the output frequency range, type the desired offset frequency from that harmonic. Below is a diagram that shows relative to the first harmonic, which calculates the frequencies just above the first harmonic.</p>

<p>
<a id="pgfId-1142250"></a></p>
<div class="webflare-div-image">
<img width="534" height="246" src="images/Chap4-283.gif" /></div>

<p>
<a id="pgfId-1137857"></a>When a log sweep is desired below the first harmonic, set the relative harmonic to -1 as shown in the diagram below.</p>

<p>
<a id="pgfId-1142260"></a></p>
<div class="webflare-div-image">
<img width="527" height="281" src="images/Chap4-284.gif" /></div>

<p>
<a id="pgfId-1137861"></a>When automatic is selected for sweep type, 100 total points will be calculated. In most cases, fewer points are needed, so it is usually better to select linear or log and then specify the sweep you desire. Typically, 3 to 5 points per decade or about 20 total points are needed.</p>

<h3>
<a id="pgfId-1137862"></a>Maximum Sideband</h3>

<p>
<a id="pgfId-1137863"></a>There is a property in the <em>Choosing Analyses</em> form called <em>Maximum sideband </em>that is used to define how many mixing products should be calculated. If <em>Maximum sideband </em>is zero, the noise analysis will only contain the noise that appears without mixing or aliasing of any type. This is not equivalent to a linear noise analysis because pnoise takes into account the instantaneously varying nature of the noise because of the large signal being present in the pss analysis.</p>
<p>
<a id="pgfId-1178040"></a>When <em>Maximum sideband </em>is one, then the noise without frequency translation and the noise that mixes or aliases with the first harmonic of the pss is present in the noise analysis. When <em>Maximum sideband </em>is 10, the noise analysis includes noise mixing through the 10th harmonic of the pss analysis. When harmonic balance is selected as the pss engine, the number of harmonics in the pss analysis and the maximum number of sidebands should be the same. This is easily accomplished by leaving the <em>Maximum sideband </em>field blank in the <em>Choosing Analyses</em> form in ADE Explorer. When shooting is selected for the pss engine, up to 40 sidebands can be set in the maximum sideband field by default. If you need more than 40 sidebands in pnoise, consider using full-spectrum pnoise.</p>

<h3>
<a id="pgfId-1178041"></a>Full-Spectrum P<a id="fullspectrumpnoise"></a>noise</h3>

<p>
<a id="pgfId-1178042"></a>Full-Spectrum pnoise is useful for circuits like switched-capacitor filters or sampling circuits where aliasing occurs through very high harmonics of the clock. The runtime advantages are large with no loss in accuracy of the result. Full-Spectrum pnoise is available when shooting is selected for the pss engine and APS is selected in the <em>Setup</em> - <em>High Performance Simulation</em> menu in ADE Explorer. Selecting <em>fullspectrum</em> in the pnoise form forces APS to be selected in ADE Explorer. If you are running from the command line without using aps, fullspectrum will not be used. In normal pnoise when shooting is selected, you need to set the maximum sideband term. In full-spectrum pnoise you do not except in cases where the pss beat frequency is 100KHz or less. In this case, set maximum sidebands to the 1/F noise corner frequency divided by the pss beat frequency. Pnoise calculates all the noise translations it can, based on the maximum timestep in the pss analysis. The easiest way to change the maximum timestep in pss is to increase the number of harmonics above 10 in the pss <em>Choosing Analyses</em> form. Full-spectrum pnoise runs faster than normal pnoise when the maximum number of sidebands in pnoise is about 50 or greater. The larger the number of sidebands, the larger the speedup for fullspectrum.</p>
<p>
<a id="pgfId-1142388"></a>Fullspectrum pnoise is available for all available noisetypes. Noise separation is not supported when fullspectrum is selected.</p>

<h3>
<a id="pgfId-1142389"></a>Setting Harmonics and Sidebands </h3>
<h4>
<a id="pgfId-1142390"></a>Harmonic Balance as the PSS engine</h4>

<p>
<a id="pgfId-1142464"></a>The process of setting harmonics and sidebands is similar to setting the maximum number of harmonics for the harmonic balance simulation. Start with an estimate based on the harmonic content of the input signal(s) and the nonlinearity of the circuit. Then run a simulation. Raise harmonics and sidebands and run the simulation again. If the noise measurement did not change, then the original number of harmonics and sidebands may be reduced. If it did change, then more are needed. For more details on this, refer to the section <a href="Chap3.html#24789">Harmonic Balance Noise Analysis (hbnoise)</a>.</p>

<h4>
<a id="pgfId-1142465"></a>Shooting as the PSS Engine</h4>

<p>
<a id="pgfId-1137875"></a>For full-spectrum pnoise, start with 10 pss harmonics, Select full-spectrum, and select APS. Run the simulation, and plot the noise result. Now increase the number of harmonics in the pss analysis, which forces more pss timepoints, and run the simulation again. If the pnoise result did not change, then you had enough harmonics to begin with. If the noise result did change, then increase the number of pss harmonics and run the simulation again.</p>
<p>
<a id="pgfId-1142499"></a>For regular pnoise, estimate the number of sidebands based on the pss harmonic plot. As a coarse estimate, find the harmonic where the LO or clock signal drops to about 40 dB below the amplitude of the LO or clock first harmonic. For example, if this is the 10th harmonic, set maximum sideband to 10. Run the simulation and plot the noise measurement. Increase the number of sidebands until the noise result does not change anymore. Use the smallest number of sidebands that produces a stable result. If the number of sidebands is greater than about 50, consider using full-spectrum pnoise because it is likely to run faster than normal pnoise.</p>

<h3>
<a id="pgfId-1142501"></a>Noise Separation</h3>

<p>
<a id="pgfId-1137879"></a>In addition to the total output noise, the individual noise contributions can be plotted if noise separation is selected in the <em>Choosing Analyses</em> form. More information about the noise separation will be provided later. Noise separation is available when the noise type is set to <code>timeaverage</code> and is not available for fullspectrum pnoise. The things that can be plotted are:</p>
<ol><li>
<a id="pgfId-1137880"></a>Total noise at the output from each individual noise input frequency. This allows the identification of which noise frequencies are causing the noise problem.</li><li>
<a id="pgfId-1137881"></a>The noise at the output from each instance name with all noise mechanisms included for mixing from an individual noise input frequency. Once the noise frequency is identified in point 1 above, this capability plots the total noise from each component at the troublesome noise frequency. This allows the identification of which component in the circuit is causing the problem.</li><li>
<a id="pgfId-1137882"></a>The noise at the output from each instance name with all noise mechanisms broken out separately for mixing from an individual noise input frequency. This capability splits out the individual noise sources at the troublesome noise frequency. For example, if a parasitic resistor was found to be the problem, the component might be resized to reduce the noise.</li><li>
<a id="pgfId-1137883"></a>The current noise at the noise instance for each instance name with all noise mechanisms included for mixing from an individual noise input frequency. This capability has limited value. For this plot, all the noise source currents for all the noise mechanisms within the component are added together.</li><li>
<a id="pgfId-1137884"></a>The noise current in the instance from each instance name with all noise mechanisms broken out separately for mixing from an individual noise input frequency. This capability allows the identification of which noise sources are the largest in the circuit. The measurement is at the source, not at the output.</li><li>
<a id="pgfId-1137885"></a>The gain to the output from each individual instance with all the individual noise sources broken out separately for mixing from an individual input frequency. This capability plots the gain from the noise sources in point 5 above to the output of the circuit.</li></ol>






<h3>
<a id="pgfId-1137886"></a>Multiple Pnoise</h3>

<p>
<a id="pgfId-1137887"></a>Some systems contain multiple points in the circuit where the noise measurement is desired. When the <em>Noise Type</em> is <em>timeaverage</em>, multiple pnoise analyses are allowed. At the top of the pnoise <em>Choosing Analyses</em> form, an option called <em>Multiple pnoise</em> is provided. When this option is selected, up to six pnoise analyses can be made after a single pss analysis.</p>

<h3>
<a id="pgfId-1137890"></a>AM and PM Noise for Driven Circuits and Oscillators</h3>

<p>
<a id="pgfId-1240370"></a>Starting with IC617, the noise UI has been re-designed. Modulated has been removed and its functionalities have been merged to timeaverage, leaving three noise types now. In addition, the FM jitter option has been removed. FM jitter is calculated through timeaverage PM noise, which should be used when you want to get phase noise.</p>
<p>
<a id="pgfId-1243573"></a>When Noise Type is timeaverage, USB, LSB, AM and PM noise are directly available. You can choose, for example, PM noise alone, or you can select the ALL(AM,PM,USB,LSB) option, if all the four types are needed. The available options are <em>USB</em>, <em>AM</em>, <em>PM</em>, <em>AM&amp;PM</em>, and <em>ALL(AM,PM,USB,LSB)</em>.</p>
<p>
<a id="pgfId-1243574"></a>AM and PM noise is discussed below.</p>
<p>
<a id="pgfId-1236372"></a>To illustrate AM noise, see the phasor diagram below.</p>

<p>
<a id="pgfId-1137895"></a></p>
<div class="webflare-div-image">
<img width="668" height="382" src="images/Chap4-285.gif" /></div>

<p>
<a id="pgfId-1137896"></a>This diagram illustrates a periodic signal with AM noise. The black phasor is the output signal, and AM noise is a random vector that varies the amplitude of the signal.</p>
<p>
<a id="pgfId-1137897"></a>PM noise is shown in the phasor diagram below.</p>

<p>
<a id="pgfId-1137901"></a></p>
<div class="webflare-div-image">
<img width="668" height="402" src="images/Chap4-286.gif" /></div>

<p>
<a id="pgfId-1137902"></a>In this case, the amplitude is constant, but the noise is a random vector perpendicular to the signal phasor. The timing of the signal varies a bit from cycle to cycle.</p>
<p>
<a id="pgfId-1240391"></a>FM jitter and phase noise are only available through the PM noise option.</p>
<p>
<a id="pgfId-1137903"></a>Most circuits produce a combination of AM and PM noise. This concept is shown below.</p>

<p>
<a id="pgfId-1137907"></a></p>
<div class="webflare-div-image">
<img width="668" height="403" src="images/Chap4-287.gif" /></div>

<p>
<a id="pgfId-1137908"></a>In this case, a random vector at any angle and amplitude is produced that varies at each instant of time. If the uncertainty creates a round shape, the AM component and the PM component are the same size.</p>
<p>
<a id="pgfId-1137909"></a>In many circuits, AM or PM noise may dominate. If the PM noise dominates, the circle turns into an ellipse that is larger in the perpendicular direction than in the parallel direction. This is shown below.</p>

<p>
<a id="pgfId-1137913"></a></p>
<div class="webflare-div-image">
<img width="668" height="405" src="images/Chap4-288.gif" /></div>
<h3>
<a id="pgfId-1137916"></a><a id="64223"></a>Noise Type=sampled(jitter)</h3>

<p>
<a id="pgfId-1137917"></a>Jitter is usually applied to digital circuits where the average noise over the entire waveform is not appropriate. Noise in high state and low state does not matter because the output voltage is so far from the voltage that triggers the load that it does not matter. The only time the noise matters is at the exact time where the trigger event is generated. Also, the noise in the low and high state is quite small because one device is completely off, and the other device is driven on. It is basically a resistor. The device is not as good as an amplifier because the output is pulled hard into a rail. As the state changes, both devices are on, and they are relatively better amplifiers. As a result, the noise is likely to be larger in the switching interval. In jitter, the voltage for the noise measurement, and the selection of the rising edge, falling edge, or both, is made. At the specified threshold voltage, a noise measurement is made at that instant in time. Once the noise voltage is known, the timing uncertainty can be determined from the slew rate. Since the RMS noise voltage is calculated, the timing uncertainty is one standard deviation from the ideal crossing time. This is illustrated below. Currently, this calculation is done in post-processing with a Direct Plot function.</p>

<p>
<a id="pgfId-1303754"></a></p>
<div class="webflare-div-image">
<img width="668" height="235" src="images/Chap4-289.gif" /></div>

<p>
<a id="pgfId-1137921"></a>sampled(jitter) has three modes. Edge Crossing is the mode just described. You specify a threshold and direction called the trigger, which defines the time when the noise measurement is made. In many cases, the measurement net will be on the same net as the trigger as shown in the diagram above, but the measurement can be made on another net in the circuit. This is useful when you want to make a noise measurement on the output of a switched-capacitor filter triggered by the clock waveform.</p>
<p>
<a id="pgfId-1304330"></a>The Edge Delay mode is similar to edge crossing mode except that both the trigger and the measurement are edges in the circuit. For example, you might use the rising edge of a net and the falling edge for the same net to get the jitter of the pulse. Because both the trigger and the measurement are edges, the simulator calculates the jitter internally. This is done because the slew rate of the rising and falling edges are usually not the same.</p>
<p>
<a id="pgfId-1304816"></a>The Sampled Phase mode is the equivalent of the old time-domain pnoise selection. You specify a list of PSS times you want to use to calculate the noise voltage. There is a Direct Plot function to calculate the noise voltage at the different times. If you then divide by the derivative (slope) of the PSS waveform, you get the jitter.</p>

<h2>
<a id="pgfId-1137948"></a>Noise Calculations</h2>
<h3>
<a id="pgfId-1137949"></a>Phase Noise (Driven Circuit)</h3>

<p>
<a id="pgfId-1137950"></a>For a driven circuit with a single input frequency, phase noise is the total noise at the output divided by the amplitude of the first harmonic at the output node specified in the pnoise analysis. Note that phase noise from the pnoise results selection is a single-sideband phase noise. Only the frequencies above the oscillator frequency are included in the measurement. To get a double-sideband phase noise measurement, set the noise type to sampled(jitter), and select the pnoise jitter result set.</p>

<h3>
<a id="pgfId-1137951"></a>Noise Factor and Noise Figure</h3>

<p>
<a id="pgfId-1142748"></a>When the pnoise analysis is set up with voltage selected instead of probe for the input, noise figure and noise factor will not have the noise of the load subtracted automatically from the measurement. Using a port as the input probe is required to obtain noise figure and noise factor calculations.</p>
<p>
<a id="pgfId-1142749"></a>In the <em>Direct Plot Form</em>, noise factor and noise figure are both single-sideband measurements.</p>
<p>
<a id="pgfId-1137954"></a>Noise Factor</p>
<p>
<a id="pgfId-1137955"></a>Noise Factor is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137956"></a>((All the noise power at the output from all the components with all the frequency translations) - (Noise power at the output from the load))/Noise power at the output from the resistance of the input port from the passband frequency only.</pre>

<p>
<a id="pgfId-1137957"></a>Note that in order to calculate the noise factor, a port component must be used as the input. In the <em>Choosing Analyses</em> form, the input port is identified by the instance name. The port component is a voltage source in series with a resistor and is considered as a single element. No access is provided to the results for the internal node where the resistor and voltage source join.</p>
<p>
<a id="pgfId-1137958"></a>In order to determine the passband frequency, the reference sideband must be supplied. This specifies the passband frequency for the noise figure calculation. The easiest way to select the reference sideband is to use the <em>Select from list</em> feature in the pnoise <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1137959"></a>The noise from the load is normally defined by selecting the port or resistor that is serving as the load for the circuit in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1137960"></a>Noise Figure</p>
<p>
<a id="pgfId-1137961"></a>Noise figure is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137962"></a>10*log(10) (Noise Factor)</pre>

<p>
<a id="pgfId-1137963"></a>Noise factor (IEEE) is similar to the noise figure measurement above. If you subtract from the numerator all the noise from the input port at all frequencies except the passband, you have the IEEE noise factor.</p>
<p>
<a id="pgfId-1137964"></a>Note that in order to calculate the IEEE noise factor, a port component must be used as the input. In the <em>Choosing Analyses</em> form, the input port is identified by the instance name. The port component is a voltage source in series with a resistor and is considered as a single element. No access is provided to the results for the internal node where the resistor and voltage source join.</p>
<p>
<a id="pgfId-1137965"></a>In order to determine the passband frequency, the reference sideband must be supplied. This specifies the passband frequency for the noise figure calculation. The easiest way to select the reference sideband is to use the<em> Select from list</em> feature in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1137966"></a>The noise from the load is normally defined by selecting the port or resistor that is serving as the load for the circuit in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1137967"></a>Noise Factor IEEE</p>
<p>
<a id="pgfId-1137968"></a>Noise Factor IEEE is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137969"></a>((All the noise power at the output from all the components with all the frequency translations) - (Noise power at the output from the resistor in the input port at all frequencies except for the passband) - (Noise power at the output from the load))/Noise power at the output from the resistance of the input port from the passband frequency only.</pre>

<p>
<a id="pgfId-1137970"></a>Noise Figure IEEE</p>
<p>
<a id="pgfId-1137971"></a>Noise figure IEEE is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137972"></a>10*log(10) (IEEE Noise Factor)</pre>

<p>
<a id="pgfId-1137973"></a>Noise factor DSB is similar to the single sideband noise factor above, except in the denominator, the noise power from the input port at the image frequency is added.</p>
<p>
<a id="pgfId-1287376"></a>Note that Noise Figure and NFiee are both single-sideband measurements. The difference between the measurements is that in noise figure, all the noise frequencies from the input port that contribute noise at the output are included, and in NFieee, only the noise at the passband frequency is included. As a result, NFieee will produce a lower noise figure than Noise Figure. The difference between the measurements depends on the circuit.</p>

<p>
<a id="pgfId-1287380"></a>. </p>
<div class="webflare-div-image">
<img width="662" height="429" src="images/Chap4-290.gif" /></div>

<p>
<a id="pgfId-1287381"></a>Noise Factor DSB</p>
<p>
<a id="pgfId-1287382"></a>Noise factor (DSB) is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137980"></a>((All the noise power at the output from all the components with all the frequency translations) - (Noise power at the output from the load))/Noise power at the output from the resistance of the input port from the passband and image frequencies only.</pre>

<p>
<a id="pgfId-1137981"></a>Note that in order to calculate the DSB noise factor, a port component must be used as the input. In the <em>Choosing Analyses</em> form, the input port is identified by the instance name. The port component is a voltage source in series with a resistor and is considered as a single element. No access is provided to the results for the internal node where the resistor and voltage source join.</p>
<p>
<a id="pgfId-1137982"></a>In order to determine the passband frequency, the reference sideband must be supplied. This specifies the passband frequency and by inference the image frequency for the noise figure calculation. The easiest way to select the reference sideband is to use the <em>Select from list</em> feature in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1137983"></a>The noise from the load is normally defined by selecting the port or resistor that is serving as the load for the circuit in the <em>Choosing Analyses</em> form.</p>
<p>
<a id="pgfId-1137984"></a>Noise Figure DSB</p>
<p>
<a id="pgfId-1137985"></a>Noise figure (DSB) is:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137986"></a>10*log(10) (Noise Factor (DSB))</pre>

<p>
<a id="pgfId-1137987"></a><strong>Summary</strong>:</p>
<p>
<a id="pgfId-1137988"></a><code>No</code> = total output noise<br /><code>Ns</code> = noise at the output due to the input probe at the passband frequency (the source)<br /><code>Nsi</code> = noise at the output due to the image harmonic at the source<br /><code>Nso</code> = noise at the output due to harmonics other than input at the source<br /><code>Nl</code> = noise at the output due to the output probe (the load)<br /><code>IRN</code> = input referred noise<br /><code>G</code> = gain of the circuit<br /><code>F</code> = noise factor<br /><code>NF</code> = noise figure<br /><code>Fdsb</code> = double sideband noise factor<br /><code>NFdsb</code> = double sideband noise figure<br /><code>Fieee</code> = IEEE single sideband noise factor<br /><code>NFieee</code> = IEEE single sideband noise figure</p>
<p>
<a id="pgfId-1137989"></a>then,</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1137990"></a>IRN = sqrt(No^2/G^2)<br />F = (No^2 - Nl^2)/Ns^2<br />NF = 10*log10(F)<br />Fdsb = (No^2 - Nl^2)/(Ns^2+Nsi^2)<br />NFdsb = 10*log10(Fdsb)<br />Fieee = (No^2 - Nl^2 - Nso^2)/Ns^2<br />NFieee = 10*log10(Fieee)</pre>

<p>
<a id="pgfId-1137991"></a>When the pnoise analysis is set up with voltage selected instead of probe, noise figure cannot be calculated.</p>

<h3>
<a id="pgfId-1137992"></a>Input-Referred Noise</h3>
<div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1137993"></a>
When the pnoise analysis is set up with the input source being a port, input-referred noise may not be exact. In this case, the input-referred noise is referred to the voltage source that is inside the port component. The amplitude of the noise is divided by two, which assumes a perfect match. If an accurate input-referred noise is desired, set the <em>Input Source</em> to <em>voltage</em>, and select the input node. This will disable the noise figure calculation.</div>
<h3>
<a id="pgfId-1137994"></a>Noise transfer function</h3>

<p>
<a id="pgfId-1137995"></a>Pnoise calculates the forward gain from the input passband to the output and saves it. In the <em>Direct Plot Form</em>, this is called <em>Transfer Function</em>, and is in linear volts at the output divided by volts at the input.</p>

<p>
<a id="pgfId-1142828"></a></p>
<div class="webflare-div-image">
<img width="664" height="433" src="images/Chap4-292.gif" /></div>
<h3>
<a id="pgfId-1244744"></a><a id="63741"></a>Commonly Used P<a id="pnoise_options"></a>noise Options</h3>
<p>
<a id="pgfId-1267858"></a></p>
<div class="webflare-div-image">
<img width="621" height="738" src="images/Chap4-293.gif" /></div>
<h4>
<a id="pgfId-1267845"></a>Solver</h4>

<p>
<a id="pgfId-1267850"></a>This option is used for driven circuits only.</p>
<p>
<a id="pgfId-1138033"></a>The default is <em>turbo</em>.</p>
<p>
<a id="pgfId-1138034"></a>For harmonic balance pnoise, leave this option at the default value. For shooting pnoise, sometimes you will see warning messages that the residual is larger than the tolerance specified. This usually occurs at low offset frequencies. If you see this message, then select the <em>std</em> solver, which is more able to handle low offset frequencies. The runtime will increase when the std solver is selected.</p>

<h4>
<a id="pgfId-1138039"></a>Oscsolver</h4>

<p>
<a id="pgfId-1138040"></a>This option is used for oscillators only.</p>
<p>
<a id="pgfId-1138041"></a>The default is <em>turbo</em>.</p>
<p>
<a id="pgfId-1138042"></a>For harmonic balance pnoise, leave this option at the default value. For shooting pnoise, sometimes, you will see warning messages that the residual is larger than the tolerance specified. This usually occurs at low offset frequencies. If you see this message, then select the <code>std</code> solver, which is more able to handle low offset frequencies. The runtime will increase when the std solver is selected.</p>
<p>
<a id="pgfId-1138043"></a>The <code>ira</code> solver may use less memory than turbo or std, but it is less robust for convergence.</p>

<h4>
<a id="pgfId-1138048"></a>TD Noise Algorithm Version</h4>

<p>
<a id="pgfId-1138049"></a>Leave this option at the default. (dts)</p>
<p>
<a id="pgfId-1138050"></a>If your circuit has low frequency poles, (usually from a biasing circuit) the default dts solver is much more accurate than the standard solver.</p>

<h4>
<a id="pgfId-1138055"></a>hbprecond_solver</h4>

<p>
<a id="pgfId-1138056"></a>This option is only available when harmonic balance is set for the pss solver. When APS is not used, only the basic solver is available. When APS is used, first a much faster preconditioner is used. Occasionally, this preconditioner will stagnate, and when it does, it issues a warning that it is switching to the basic solver, and it reverts back to the basic solver. A preconditioner is a mathematical algorithm that makes the iterative matrix solving process faster.</p>

<h4>
<a id="pgfId-1138058"></a>Lorentzian</h4>

<p>
<a id="pgfId-1138064"></a>There are two ways of looking at phase noise. One way is to think of measuring the spectral output of the oscillator with a network analyzer. In this case, as the frequency gets close to the oscillator frequency, the amplitude starts going up, levels off, and then drops as the oscillator frequency is passed. In this case, the noise cannot be larger than the oscillations themselves, which is 0 dBc. If this is how you view phase noise, set the <em>lorentzian</em> option to <em>yes</em>.</p>
<p>
<a id="pgfId-1138065"></a>If you think in terms of jitter, in one cycle of the oscillator output, because of the noise, you can calculate one standard deviation of the timing. If you go two cycles, and you integrate the noise with respect to time, you get twice as much noise power, or about 1.4 times the noise voltage or jitter. When you get to an infinite number of oscillator cycles, the jitter also becomes infinite. As you increase the time, you are lowering the noise frequency, and in this case, as the time becomes large, the frequency becomes very low. At infinite time, you get infinite jitter, and this occurs at zero offset from the carrier. Jitter is just another way of looking at phase noise. In other words, the phase noise can easily exceed the carrier amplitude (0 dBc) as the offset frequency becomes small because it is heading to infinity at zero frequency offset. If this is how you view phase noise, set the <em>lorentzian</em> option to <em>no</em>.</p>
<p>
<a id="pgfId-1288995"></a>Lorentzian=yes means calculate the leveling off. Lorentzian=cornerfreqonly calculates the continuously rising phase noise, but it places a marker on the phase noise curve at the frequency where the phase noise would level off. No causes the phase noise to continue to rise as the offset frequency approaches zero.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1289003"></a>The <em>lorentzian</em> option is not available when <em>noisetype</em> is set to <em>sampled(jitter)</em> or <em>timedomain</em>.</div>

<h4>
<a id="pgfId-1288997"></a>Tolerance</h4>

<p>
<a id="pgfId-1138072"></a>Leave this option at the default.</p>
<p>
<a id="pgfId-1138073"></a>Pnoise uses an iterative solver to calculate the noise, and any iterative solver needs a tolerance term to specify when the system has been solved accurately enough. The default for shooting pnoise is 1e-9. Harmonic balance driven circuit pnoise tolerance is 1e-6 and 1e-4 for oscillators.</p>

<h4>
<a id="pgfId-1138074"></a>Gear_Order</h4>

<p>
<a id="pgfId-1138075"></a>Do not set this option.</p>

<h4>
<a id="pgfId-1138089"></a>Resgmrescycle</h4>

<p>
<a id="pgfId-1138090"></a>Leave this option at the default, which is <em>short</em>.</p>

<h4>
<a id="pgfId-1138092"></a>Saveallsidebands</h4>

<p>
<a id="pgfId-1138093"></a>Leave this option at the default value of <em>no</em>. If you want to see the noise contributors from the different noise input frequencies, select <em>yes</em> for noise separation in the pnoise main <em>Choosing Analyses</em> form.</p>

<h4>
<a id="pgfId-1138094"></a>Enable Osc PPV</h4>

<p>
<a id="pgfId-1138095"></a>This option is obsolete.</p>

<h4>
<a id="pgfId-1138100"></a>AdditionalParams</h4>

<p>
<a id="pgfId-1138101"></a>This is typically used for customers who are evaluating new features. If you know the option name and the value, you can type it here. For example, you can type solver=std in this field instead of using the check box in the options form.</p>

<h2>
<a id="pgfId-1138103"></a>ADE Implementation</h2>
<h3>
<a id="pgfId-1138104"></a>General Notes</h3>

<p>
<a id="pgfId-1138105"></a>All pnoise types are supported whether the pss engine is shooting or harmonic balance. Because Chapter 3 in this manual talks about harmonic balance exclusively, in this Chapter most of the examples will reference shooting pss. Where there are differences between shooting and harmonic balance, those differences will be noted. Otherwise, shooting and harmonic balance are completely interchangeable, and will provide the same answer as long as enough harmonics are used in harmonic balance.</p>
<p>
<a id="pgfId-1180019"></a>Because shooting takes a minimum of 200 timepoints in the pss, the pss data inherently contains data through the 100th harmonic of the pss. For this reason, unless there is a requirement to calculate noise translations through more than the 40th harmonic of the pss, it is seldom required to force more harmonics in shooting pss. Also with shooting pss, fullspectrum is available, which does not require setting sidebands at all in most cases. However, if the pss beat frequency is 100KHz or less, then set maximum sideband to the 1/F noise corner frequency divided by the pss beat frequency. In harmonic balance, only the harmonics that are solved in the pss exist. When harmonic balance is selected, if you set maximum sideband larger than the number of pss harmonics, a warning message will be entered in the Spectre output log, and maximum sideband will be reset to the number of pss harmonics.</p>

<h3>
<a id="pgfId-1138107"></a>Driven Circuits</h3>
<h4>
<a id="pgfId-1138109"></a><a id="45619"></a>Noise Type = timeaverage USB noise</h4>

<p>
<a id="pgfId-1138110"></a>On the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1138111"></a>First, set up the pss analysis. For more information on the pss analysis, see the beginning of this chapter.<br />
<a id="pgfId-1143250"></a><div class="webflare-div-image">
<img width="450" height="777" src="images/Chap4-294.gif" /></div></li><li>
<a id="pgfId-1138115"></a>In the pnoise Choosing Analysis form, specify the output frequency range of your circuit.<br />
<a id="pgfId-1138119"></a><div class="webflare-div-image">
<img width="668" height="235" src="images/Chap4-295.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1138120"></a>Since the fundamental quantity that is calculated by the noise analysis is the noise at the output, the frequency range is always the output frequency range.</div></li><li>
<a id="pgfId-1138121"></a>Set about 3 to 5 points per decade in the <em>Points Per Decade</em> field.</li><li>
<a id="pgfId-1138122"></a>When hb is selected as the engine in the pss form, leave the <em>Maximum sideband</em> field blank or set it to the same number as the number of harmonics in the HB analysis. This specifies that the noise that mixes with all the hb harmonics is calculated. When the pss engine is set to shooting, first decide whether or not to use full-spectrum pnoise, and if the default method is used, set a number of sidebands that is appropriate for your circuit. APS is selected automatically and is required when using full-spectrum pnoise. When fullspectrum pnoise is used, leave the Maximum Sideband field blank except for some special cases. If the PSS frequency is lower than the flicker noise corner frequency, set maximum sidebands to the next larger integer from the ratio of the noise corner frequency divided by the PSS frequency. In the case of an oscillator with a divider and you want to measure the flicker noise on the oscillator, set maximum sidebands to the divider ratio.<br />
<a id="pgfId-1138127"></a><div class="webflare-div-image">
<img width="668" height="122" src="images/Chap4-296.gif" /></div></li><li>
<a id="pgfId-1138128"></a>Specify the output of the circuit. When output is set to <em>probe</em>, a resistor or a port can be selected and this noise will be subtracted from the noise figure calculation. This is an easy way to get the correct answer for a noise figure calculation. <br />
<a id="pgfId-1138129"></a>The nodes that the probe is connected to also define the output nodes for the circuit. If you connect the probe across a differential circuit, the noise measurement is for that differential circuit. Also note that when you select a probe, it is only used in the noise figure calculation. The output noise includes the noise of the selected element.<br />
<a id="pgfId-1138133"></a><div class="webflare-div-image">
<img width="668" height="177" src="images/Chap4-297.gif" /></div></li><li>
<a id="pgfId-1138134"></a>Select <em>port</em> from the <em>Input Source</em> drop-down list for noise figure calculation.</li><li>
<a id="pgfId-1138135"></a>Choose <em>Select from list</em> from the drop-down list for reference sideband, which specifies the input frequency range (also called the passband frequency range) for the noise figure calculation.<br />
<a id="pgfId-1138139"></a><div class="webflare-div-image">
<img width="668" height="186" src="images/Chap4-298.gif" /></div></li><li>
<a id="pgfId-1138140"></a>Select the passband frequency range from the list.</li><li>
<a id="pgfId-1138141"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list to calculate the average noise power at the output averaged over the entire time of one cycle of the input waveform.<br />
<a id="pgfId-1138145"></a><div class="webflare-div-image">
<img width="668" height="193" src="images/Chap4-299.gif" /></div></li><li>
<a id="pgfId-1138146"></a>Select the <em>Noise Separation</em> check box to enable plotting of the individual noise contributors in the circuit. Noise separation is only available when <em>Noise Type</em> is set to <em>timeaverage</em>.</li></ol>




































<h4>
<a id="pgfId-1138147"></a>Multiple pnoise</h4>

<p>
<a id="pgfId-1138148"></a>When <em>Noise type</em> is set to <em>timeaverage</em>,<em> </em>multiple pnoise analyses can be run after a single pss analysis. This is useful for LNA-Mixer combinations, or in any circuit where there are multiple points in the circuit where noise is important.</p>
<p>
<a id="pgfId-1138149"></a>To run multiple analyses after a single pss:</p>
<ol><li>
<a id="pgfId-1138150"></a>First, set up the pss analysis as appropriate for your circuit. For more information, please see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1143297"></a><div class="webflare-div-image">
<img width="448" height="758" src="images/Chap4-300.gif" /></div></li><li>
<a id="pgfId-1138154"></a>Select the <em>Multiple pnoise</em> check box located at the top of the pnoise <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1138155"></a>Set up all the noise analyses you want to run, as shown below.<br />
<a id="pgfId-1138160"></a><div class="webflare-div-image">
<img width="668" height="745" src="images/Chap4-301.gif" /></div></li></ol>









<h4>
<a id="pgfId-1138162"></a><a id="31118"></a>Noise Type = timeaverage AM, PM, AM&amp;PM noise</h4>

<p>
<a id="pgfId-1138163"></a>Timeaverage allows the measurement of the AM and PM components of noise separately. </p>
<p>
<a id="pgfId-1138164"></a>First, set up the pss analysis as appropriate for your circuit. For more information, see the periodic steady-state section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1138168"></a></p>
<div class="webflare-div-image">
<img width="668" height="711" src="images/Chap4-302.gif" /></div>

<p>
<a id="pgfId-1138169"></a>On the pnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1138170"></a>Set up an appropriate frequency range of interest.<br />
<a id="pgfId-1138174"></a><div class="webflare-div-image">
<img width="668" height="232" src="images/Chap4-303.gif" /></div></li><li>
<a id="pgfId-1143415"></a>Set an appropriate number of sidebands. When harmonic balance is selected for the pss analysis, this field should be left blank. Fullspectrum is available for shooting only, and will be faster than the default pnoise when the number of noise sidebands is about 50 or greater with no loss in accuracy.<br />
<a id="pgfId-1243561"></a> <div class="webflare-div-image">
<img width="450" height="128" src="images/Chap4-304.gif" /></div></li><li>
<a id="pgfId-1243562"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list.<br />
<a id="pgfId-1243566"></a><div class="webflare-div-image">
<img width="668" height="190" src="images/Chap4-305.gif" /></div>
<a id="pgfId-1138188"></a>Run the simulation. </li></ol>















<p>
<a id="pgfId-1138189"></a>Now plot the Output noise using the Direct Plot Form.</p>
<p>
<a id="pgfId-1243552"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1243553"></a>Select <em>pnoise </em>from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1243554"></a>Select <em>AM</em> or <em>PM</em> from the <em>Noise Type</em> section. <em>AM</em> is selected here. Note that you can choose SSB or DSB for AM and PM noise, DSB is 3dB higher than SSB noise.</li><li>
<a id="pgfId-1217566"></a>Select V/sqrt(hz) from the <em>Units</em> section.<br />
<a id="pgfId-1138197"></a><div class="webflare-div-image">
<img width="668" height="550" src="images/Chap4-306.gif" /></div></li><li>
<a id="pgfId-1138200"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1138204"></a><div class="webflare-div-image">
<img width="668" height="397" src="images/Chap4-307.gif" /></div></li></ol>










<h4>
<a id="pgfId-1138206"></a>Noise Type=sampled(jitter)</h4>

<p>
<a id="pgfId-1306035"></a>This selection has three modes:</p>
<ul><li>
<a id="pgfId-1337037"></a><a href="Chap4.html#38245">Edge Crossing Mode</a></li><li>
<a id="pgfId-1337059"></a><a href="Chap4.html#62329">Edge Delay Mode</a></li><li>
<a id="pgfId-1337077"></a><a href="Chap4.html#37833">Sampled Phase mode</a></li></ul>


<p>
<a id="pgfId-1138207"></a>sampled(jitter) is usually used for measuring the noise in a digital circuit at a specific threshold crossing. Usually, shooting pss is used to capture the waveform, but this capability is also implemented in harmonic balance. Harmonic balance will considerably take longer than shooting PSS so it is discouraged. </p>
<p>
<a id="pgfId-1336961"></a>First set up a PSS analysis as shown below.</p>
<p>
<a id="pgfId-1324710"></a></p>

<div class="webflare-div-image">
<img width="668" height="768" src="images/Chap4-308.gif" /></div>

<p>
<a id="pgfId-1138212"></a>An appropriate threshold is needed, which can be determined by plotting the time domain waveform from the pss Direct Plot Form. The waveforms below show an appropriate threshold value to be 1.65V. Int2 and int3 are the nets at the input and output of an inverter.</p>

<p>
<a id="pgfId-1138216"></a></p>
<div class="webflare-div-image">
<img width="668" height="443" src="images/Chap4-309.gif" /></div>

<p>
<a id="pgfId-1138217"></a>On the pnoise Choosing Analyses form, </p>
<ol><li>
<a id="pgfId-1337100"></a>Set the stop frequency as half the input frequency.</li><li>
<a id="pgfId-1337107"></a>Set the start frequency 4 decades below that. </li><li>
<a id="pgfId-1337122"></a>Select <em>Add Specific Points</em> and log sweep with about 5 points per decade. </li><li>
<a id="pgfId-1337395"></a>Select the sidebands method.<br />
<a id="pgfId-1337436"></a>Generally, fullspectrum pnoise is recommended. </li><li>
<a id="pgfId-1337128"></a>Leave the <em>maximum sidebands</em> field blank when using <em>fullspectrum</em>.</li><li>
<a id="pgfId-1337133"></a>Set the <em>Noise Type</em> to <em>sampled(jitter)</em>.</li><li>
<a id="pgfId-1337165"></a>(Optional) Specify <em>Sample Ratio</em> as half the oscillator frequency.<br />
<a id="pgfId-1337217"></a>Sample ratio is the ratio between sampled frequency and fundamental frequency.</li></ol>









<h4><em>
<a id="pgfId-1306874"></a><a id="38245"></a>Edge Crossing Mode</em></h4>

<p>
<a id="pgfId-1306901"></a>In this mode, an edge sets the time of the measurement and the measurement net specifies where in the circuit the jitter measurement should be made. In the example below, the trigger is the rising edge of the output net as it crosses VDD/2 and the noise is measured on the same net. For switched-capacitor filters, the trigger could be the clock and the measurement could be the output net of the filter</p>

<p>
<a id="pgfId-1325043"></a>.</p>
<div class="webflare-div-image">
<img width="668" height="602" src="images/Chap4-310.gif" /></div>

<p>
<a id="pgfId-1138222"></a>When the simulation completes, use the Direct Plot Form to plot the jitter. For driven circuits, select <em>Jee</em>, which is an edge-to-edge jitter. </p>

<p>
<a id="pgfId-1138226"></a></p>
<div class="webflare-div-image">
<img width="668" height="666" src="images/Chap4-311.gif" /></div>

<p>
<a id="pgfId-1138227"></a>In the <em>Modifier</em> section, <em>UI</em> is unit interval, and <em>ppm</em> is parts per million.</p>
<p>
<a id="pgfId-1138228"></a>The output noise frequency response and the edge-to-edge jitter are displayed. The jee measurement is one standard deviation for the expected jitter.</p>

<p>
<a id="pgfId-1138232"></a></p>
<div class="webflare-div-image">
<img width="668" height="448" src="images/Chap4-312.gif" /></div>

<p>
<a id="pgfId-1307462"></a>Note that Edge Phase Noise is available in the <em>Function</em> section as a plot option. This is normally used for oscillators. It plots the single-sideband phase noise of the circuit.</p>

<p>
<a id="pgfId-1307639"></a></p>
<div class="webflare-div-image">
<img width="668" height="440" src="images/Chap4-313.gif" /></div>
<h4><em>
<a id="pgfId-1307673"></a><a id="37833"></a>Sampled Phase mode</em></h4>

<p>
<a id="pgfId-1308205"></a>This mode is equivalent to the old time-domain noise. In this mode, you specify a list of PSS times to use for noise voltage calculation. This is useful for digital circuits because you know that the threshold will vary as the process changes. This mode can give you a way of gauging how jitter varies during the transition.</p>
<p>
<a id="pgfId-1308542"></a>First, plot a PSS waveform for the net you want to measure. Decide the range of voltages in the waveform to calculate the noise voltage. In this example, VDD/2 is 1.65V, so we place markers at 0.65V and 2.65V. Now, read the PSS times from the markers. In this case, times from 72psec to 84psec are useful.</p>

<p>
<a id="pgfId-1325734"></a></p>
<div class="webflare-div-image">
<img width="668" height="448" src="images/Chap4-314.gif" /></div>

<p>
<a id="pgfId-1308879"></a>Now, set up the pnoise Choosing Analyses form. In the form:</p>
<ol><li>
<a id="pgfId-1325805"></a>Select <em>Sampled Phase</em>.</li><li>
<a id="pgfId-1325809"></a>Select the desired net for the output. </li><li>
<a id="pgfId-1325813"></a>Type <code>1</code>in the <em>Samples Per Period</em> field. </li><li>
<a id="pgfId-1325826"></a>Click the <em>Add Specific Points</em> check box. </li><li>
<a id="pgfId-1325829"></a>Type in a list of times separated by a space in the field to the right. <br />
<a id="pgfId-1325832"></a>In this example, there are points from 72p to 84p every one p.</li><li>
<a id="pgfId-1325843"></a>Click <em>Add</em>. <br />
<a id="pgfId-1325847"></a>Note that this setup has been added to the list. There is no limit to the number of analyses in sampled(jitter) mode.<br />
<a id="pgfId-1325915"></a><div class="webflare-div-image">
<img width="668" height="500" src="images/Chap4-315.gif" /></div></li><li>
<a id="pgfId-1309413"></a>Run the simulation.</li></ol>












<p>
<a id="pgfId-1326076"></a>After the simulation completes, select <em>Results</em> -<em> Direct Plot</em> - <em>Main Form</em>.</p>
<p>
<a id="pgfId-1326167"></a>In the Direct Plot Form,</p>
<ol><li>
<a id="pgfId-1326184"></a>Select <em>pnoise sampled</em> from the <em>Analysis</em> section. </li><li>
<a id="pgfId-1326188"></a>Set the <em>Measurement Selection</em> to the run with the sampled phase results. </li><li>
<a id="pgfId-1326191"></a>Select <em>Integrated Output Noise</em> from the <em>Function</em> section. </li><li>
<a id="pgfId-1326194"></a>If the frequency range is not set, set it to the frequency range used in the pnoise analysis.</li><li>
<a id="pgfId-1326197"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1309763"></a><div class="webflare-div-image">
<img width="668" height="550" src="images/Chap4-316.gif" /></div></li></ol>








<p>
<a id="pgfId-1309795"></a>The result is shown in a new subwindow.</p>

<p>
<a id="pgfId-1326392"></a></p>
<div class="webflare-div-image">
<img width="668" height="452" src="images/Chap4-317.gif" /></div>

<p>
<a id="pgfId-1309844"></a>In the left subwindow, right-click on the X axis and select <em>Allow Any Units</em> from the context menu, as shown below.</p>

<p>
<a id="pgfId-1309926"></a></p>
<div class="webflare-div-image">
<img width="682" height="451" src="images/Chap4-318.gif" /></div>

<p>
<a id="pgfId-1309940"></a>Pull the waveform from the right subwindow into the left subwindow. Zoom in to the edge. Note the variation in noise voltage as the edge transitions.</p>

<p>
<a id="pgfId-1310107"></a></p>
<div class="webflare-div-image">
<img width="682" height="447" src="images/Chap4-319.gif" /></div>
<h4><em>
<a id="pgfId-1310121"></a><a id="62329"></a>Edge Delay Mode</em></h4>

<p>
<a id="pgfId-1310153"></a>In this mode, both the trigger and the measurement are edges in the circuit. To set this up,</p>
<ol><li>
<a id="pgfId-1335303"></a>Select <em>Edge Delay</em>. </li><li>
<a id="pgfId-1326648"></a>Set the trigger edge and threshold. <br />
<a id="pgfId-1326651"></a>In this example, the trigger is the rising edge on the input to an inverter. </li><li>
<a id="pgfId-1326654"></a>Set the measurement edge and threshold. <br />
<a id="pgfId-1326657"></a>In this example, the falling edge of the same inverter is set. </li><li>
<a id="pgfId-1326660"></a>Click <em>Add</em>. <br />
<a id="pgfId-1326663"></a>Note that a third measurement is in the list.<br />
<a id="pgfId-1310550"></a><div class="webflare-div-image">
<img width="668" height="665" src="images/Chap4-320.gif" /></div></li><li>
<a id="pgfId-1310568"></a>Run the simulation. </li></ol>











<p>
<a id="pgfId-1328243"></a>After the simulation completes click <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</p>
<p>
<a id="pgfId-1326912"></a>In the Direct Plot Form,</p>
<ol><li>
<a id="pgfId-1310605"></a>Select the edge delay run from the <em>Measurement Selection</em> drop-down list. </li><li>
<a id="pgfId-1326960"></a>Select <em>JDelay</em> from the <em>Function</em> section. </li><li>
<a id="pgfId-1326963"></a>Select <em>Param-Event</em> and select the event from the list at the right. <br />
<a id="pgfId-1326966"></a>In this case there is a single measurement. </li><li>
<a id="pgfId-1326969"></a>Specify the frequency range from the <em>pnoise</em> Choosing Analyses form. </li><li>
<a id="pgfId-1326972"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1310893"></a><div class="webflare-div-image">
<img width="384" height="699" src="images/Chap4-321.gif" /></div></li></ol>









<p>
<a id="pgfId-1310907"></a>The frequency response of the jitter plots and a marker is placed at the end with the jitter measurement. This is one standard deviation of the jitter.</p>

<p>
<a id="pgfId-1311036"></a></p>
<div class="webflare-div-image">
<img width="670" height="447" src="images/Chap4-322.gif" /></div>
<h3>
<a id="pgfId-1138274"></a>Oscillators</h3>
<h4>
<a id="pgfId-1237516"></a>Noise Type = timeaverage USB noise</h4>

<p>
<a id="pgfId-1237517"></a>The settings are the same as driven <code>noise type = timeaverage</code> with the exception of being a relative sweep by default. Since the phase noise of the oscillator is near one of the harmonics, <em>Sweeptype</em> is set to <em>relative</em> by default. A harmonic number is provided for the case where there is a frequency multiplier or a frequency divider on the output of the oscillator. Noise type = timeaverage also has the ability to plot the noise contributors from mixing with each harmonic when noise separation is selected. There is an example of noise separation later in this chapter.</p>
<p>
<a id="pgfId-1138277"></a>The pnoise setup is similar to driven except that the relative harmonic is specified. The frequency of the relative harmonic number will be added (if the harmonic number is positive) or subtracted (if the harmonic number is negative) to the frequencies in the Frequency Sweep Range field.</p>
<ol><li>
<a id="pgfId-1138278"></a>First, set up the pss analysis as appropriate for your circuit. For more information on the pss analysis, see the periodic steady-state analysis section at the beginning of this chapter.<br />
<a id="pgfId-1143879"></a><div class="webflare-div-image">
<img width="438" height="763" src="images/Chap4-323.gif" /></div>
<a id="pgfId-1138282"></a>On the pnoise <em>Choosing Analyses</em> form:</li><li>
<a id="pgfId-1138284"></a>Specify the appropriate harmonic number for your design. In this example, the first harmonic is specified in the <em>Relative Harmonic</em> field. If you are designing an oscillator by itself, the harmonic number is one. If you have an oscillator with a frequency doubler on the output, the harmonic number is two.</li><li>
<a id="pgfId-1138285"></a>The frequency range is added to the frequency of the harmonic number that is specified.<br />
<a id="pgfId-1138289"></a><div class="webflare-div-image">
<img width="668" height="237" src="images/Chap4-324.gif" /></div></li><li>
<a id="pgfId-1143956"></a>If the pss engine is harmonic balance, leave the <em>Maximum sideband</em> field blank. If the pss engine is shooting, select whether the default method or the full-spectrum method should be used. Full-spectrum is faster than the default method when more than about 50 sidebands are required for your circuit and it also does not require the maximum sideband field to be set. When the default method is selected, specify the number of desired frequency translations in the <em>Maximum sideband</em> field (shown below). This will always be specific to the design. For a rough estimate, plot the frequency domain content, and find the harmonic number where the amplitude has dropped about 40dB. Try this number in maximum sidebands. To verify that you have enough sidebands, raise the number by about 50% and run again. If the noise result did not change, then you had enough sidebands to begin with. Up to 40 sidebands can be specified by default. If you need more than 40 sidebands, set the number of pss harmonics to the number of sidebands divided by two to four.<br />
<a id="pgfId-1138296"></a><div class="webflare-div-image">
<img width="668" height="122" src="images/Chap4-325.gif" /></div></li><li>
<a id="pgfId-1138297"></a>Select <em>voltage</em> from the <em>Output</em> drop-down list.<br />
<a id="pgfId-1138301"></a><div class="webflare-div-image">
<img width="668" height="131" src="images/Chap4-326.gif" /></div></li><li>
<a id="pgfId-1138302"></a>Specify the output node in the <em>Positive Output Node</em> field. When the negative node is left blank, the global ground node is used.</li><li>
<a id="pgfId-1138303"></a>Select <em>none</em> from the <em>Input Source</em> drop-down list.</li><li>
<a id="pgfId-1138304"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list. This gives a noise measurement that is the average noise power at the output with the large signal applied in the pss analysis and the noise folding specified by the maximum sideband parameter in the <em>Choosing Analyses</em> form.<br />
<a id="pgfId-1138308"></a><div class="webflare-div-image">
<img width="668" height="193" src="images/Chap4-327.gif" /></div></li><li>
<a id="pgfId-1138309"></a>Select <em>yes</em> for <em>Noise Separation,</em> if you want to plot the individual noise contributors. Fullspectrum does not support noise separation.</li></ol>






























<h4>
<a id="pgfId-1138356"></a>Noise Type = timeaverage PM noise</h4>
<h4><em>
<a id="pgfId-1138357"></a>Oscillator Phase Noise Measurement</em></h4>

<p>
<a id="pgfId-1138358"></a>This selection allows for measurement of cycle jitter, cycle-to-cycle jitter, and AM and PM components of phase noise. This is an averaged noise measurement over one cycle of the oscillator.</p>
<ol><li>
<a id="pgfId-1138359"></a>First, set up the pss form as appropriate for your circuit. For more information on the pss analysis, <a href="Chap4.html#12426">Chapter 4, &#8220;Overview of Periodic Steady-State (pss) Analysis,&#8221;</a>.<br />
<a id="pgfId-1144212"></a><div class="webflare-div-image">
<img width="427" height="783" src="images/Chap4-328.gif" /></div></li><li>
<a id="pgfId-1138363"></a>On the pnoise <em>Choosing Analyses</em> form, select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list.<br />
<a id="pgfId-1138368"></a><div class="webflare-div-image">
<img width="668" height="188" src="images/Chap4-329.gif" /></div></li><li>
<a id="pgfId-1138369"></a>Select the <em>ALL(AM,PM,USB,LSB) </em>radio button.</li><li>
<a id="pgfId-1138370"></a>Run the simulation. </li></ol>











<p>
<a id="pgfId-1138374"></a>After the simulation completes <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer.</p>
<ol><li>
<a id="pgfId-1138375"></a>Select <em>pnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1144301"></a>Select <em>Output Noise</em>.</li><li>
<a id="pgfId-1311928"></a>Select dBc/Hz.</li><li>
<a id="pgfId-1311950"></a>Select SSB (Single Sideband) or DSB. (Double Sideband)</li><li>
<a id="pgfId-1144302"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1144303"></a>The result is displayed in the waveform tool.<br />
<a id="pgfId-1289269"></a><div class="webflare-div-image">
<img width="664" height="397" src="images/Chap4-330.gif" /></div></li><li>
<a id="pgfId-1144379"></a>Select <em>Jc</em> or <em>Jcc</em> from the Function section.<br />
<a id="pgfId-1327651"></a>In the Modifier section, UI is Unit interval, and ppm is parts per million. </li><li>
<a id="pgfId-1144383"></a>Click <em>Add To Outputs.</em></li><li>
<a id="pgfId-1328009"></a>Click <em>OK</em>.</li></ol>













<p>
<a id="pgfId-1327857"></a></p>

<div class="webflare-div-image">
<img width="488" height="695" src="images/Chap4-331.gif" /></div>

<p>
<a id="pgfId-1327854"></a>The Jc or Jcc calculation is displayed in the ADE window, as shown below.</p>

<p>
<a id="pgfId-1144429"></a></p>
<div class="webflare-div-image">
<img width="660" height="400" src="images/Chap4-332.gif" /></div>
<h4><em>
<a id="pgfId-1138391"></a>Noise Type=sampled(jitter)</em></h4>

<p>
<a id="pgfId-1138392"></a>sampled(jitter) mode has the same three modes as for driven circuits. The most useful is the edge crossing mode for the calculation of phase noise at a threshold crossing. Note that timeaverage and sampled normally produce the same result for oscillators except at large offset frequencies. This example compares sampled and timeaverage results. Although this is supported for both shooting and harmonic balance, if the waveforms are mostly square waves, shooting will run faster and be much less error prone than harmonic balance. If you use hb, make sure that you set the number of harmonics to at least the period of the waveform divided by the fastest 10% to 90% risetime on the fastest transition in the circuit. Set up the pss analysis as appropriate for your circuit. For more information, see <a href="Chap4.html#12426">Chapter 4, &#8220;Overview of Periodic Steady-State (pss) Analysis,&#8221;</a>.</p>

<p class="webflare-indent1">
<a id="pgfId-1144454"></a></p>
<div class="webflare-div-image">
<img width="390" height="785" src="images/Chap4-333.gif" /></div>

<p>
<a id="pgfId-1138397"></a>In the pnoise <em>Choosing Analyses</em> form, </p>
<ol><li>
<a id="pgfId-1328710"></a>Select sampled(<em>jitter)</em> from the <em>Noise Type</em> drop-down list.<br />
<a id="pgfId-1138402"></a><div class="webflare-div-image">
<img width="668" height="607" src="images/Chap4-334.gif" /></div></li><li>
<a id="pgfId-1313305"></a>Select the <em>Edge Crossing</em> mode.</li><li>
<a id="pgfId-1313341"></a>Select the oscillator output net.</li><li>
<a id="pgfId-1138403"></a>Specify the voltage for instantaneous noise measurement in the <em>Threshold Value</em> field.</li><li>
<a id="pgfId-1138404"></a>Select a value from the <em>Crossing Direction</em> drop-down list.</li><li>
<a id="pgfId-1313391"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1138405"></a>Run the simulation.</li></ol>










<p>
<a id="pgfId-1138406"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer.</p>
<p>
<a id="pgfId-1328898"></a>In the Direct Plot Form:</p>
<ol><li>
<a id="pgfId-1138407"></a>Select <em>pnoise</em> <em>sampled</em> from the Analysis section.</li><li>
<a id="pgfId-1313474"></a>Select <em>Edge Phase Noise</em> from the Function section.</li><li>
<a id="pgfId-1313510"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1144512"></a><div class="webflare-div-image">
<img width="514" height="496" src="images/Chap4-335.gif" /></div></li></ol>






<p>
<a id="pgfId-1138415"></a>The phase noise is plotted in the waveform tool, as shown below.</p>

<p>
<a id="pgfId-1302233"></a></p>
<div class="webflare-div-image">
<img width="664" height="418" src="images/Chap4-336.gif" /></div>

<p>
<a id="pgfId-1314046"></a>Below is a comparison of SSB phase noise and sampled(jitter) for this example. The results are the same except at large offset frequencies where the amplitudes are very small.</p>

<p>
<a id="pgfId-1314249"></a></p>
<div class="webflare-div-image">
<img width="662" height="438" src="images/Chap4-337.gif" /></div>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1302577"></a>Starting with IC6.1.7 ISR17, both <em>timeaveraged</em> and <em>sampled(jitter)</em> allow multiple pnoise analyses, however, they cannot be mixed.</div>

<h2>
<a id="pgfId-1138416"></a>Examples</h2>
<h3>
<a id="pgfId-1138417"></a>Driven Circuit Noise Setup</h3>

<p>
<a id="pgfId-1138418"></a>On the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1138419"></a>First, set up the pss analysis for your circuit. For more information see the pss section at the beginning of this chapter. Shooting is shown in the example below.<br />
<a id="pgfId-1144599"></a><div class="webflare-div-image">
<img width="410" height="776" src="images/Chap4-338.gif" /></div></li><li>
<a id="pgfId-1138423"></a>In the pnoise <em>Choosing Analyses</em> form, specify the output frequency range of your circuit.<br />
<a id="pgfId-1138427"></a><div class="webflare-div-image">
<img width="636" height="232" src="images/Chap4-339.gif" /></div></li><li>
<a id="pgfId-1138428"></a>If you use log spacing, set about 3 to 5 points per decade in the <em>Points Per Decade</em> field.</li><li>
<a id="pgfId-1138429"></a>When Harmonic Balance is set for the pss engine, you can leave the <em>Maximum sideband</em> field blank. All the mixing products from the large-signal analysis will be considered. If the pss engine is shooting, select whether the default method or the full-spectrum method should be used. Full-spectrum is faster than the default method when many sidebands are required for your circuit and it does not require the sidebands to be set. When the default method is selected, specify the number of the desired frequency translations in the <em>Maximum sideband</em> field. Up to 40 sidebands can be specified by default. <br />
<a id="pgfId-1138435"></a><div class="webflare-div-image">
<img width="636" height="350" src="images/Chap4-340.gif" /></div></li><li>
<a id="pgfId-1272795"></a>Select the resistor or port component used for the load resistance. This excludes the noise from this component for the noise figure calculation, but keeps it for the total noise output calculation.</li><li>
<a id="pgfId-1272799"></a>If you want a noise figure calculation, you must use a port as the input for the circuit. Set the instance name.<br />
<a id="pgfId-1138445"></a><div class="webflare-div-image">
<img width="668" height="256" src="images/Chap4-341.gif" /></div></li><li>
<a id="pgfId-1138446"></a>The easiest way to select the reference sideband is to set it to <em>Select from list</em>.</li><li>
<a id="pgfId-1138451"></a>Select the passband frequency range you want for the noise figure and input-referred noise calculations.<br />
<a id="pgfId-1138455"></a><div class="webflare-div-image">
<img width="636" height="186" src="images/Chap4-342.gif" /></div></li><li>
<a id="pgfId-1138456"></a>If you want to see the noise contributions from the individual frequencies and the different device noise calculations individually on the output of the noise analysis, enable noise separation. This is not supported for the full-spectrum method.<br />
<a id="pgfId-1138460"></a><div class="webflare-div-image">
<img width="636" height="189" src="images/Chap4-343.gif" /></div></li><li>
<a id="pgfId-1138461"></a>When you are done with the setup, run the simulation. </li></ol>


































<h4>
<a id="pgfId-1138462"></a><a id="10582"></a>Noise Summary</h4>

<p>
<a id="pgfId-1138463"></a>The noise summary provides information about the devices that contribute noise to the output. It supports USB, LSB, AM and PM noise. This information is available any time a pnoise simulation completes.</p>
<p>
<a id="pgfId-1295632"></a>In ADE Explorer, select <em>Results</em> - <em>Print</em> - <em>Noise Summary</em>. You will see the following options depending on the selection you have made for Noise Type in the pnoise Choosing Analysis form</p>
<p>
<a id="pgfId-1295633"></a><em>pnoise_am</em> - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>AM</em> or <em>ALL(AM,PM,USB,LSB)</em> as the contribution type. <em>pnoise_am</em> has information about the amplitude modulated noise.</p>
<p>
<a id="pgfId-1295634"></a>pnoise_pm - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>PM</em> or <em>ALL(AM,PM,USB,LSB)</em> as the contribution type. <em>pnoise_pm</em> as information about the phase modulated noise.</p>
<p>
<a id="pgfId-1295635"></a>pnoise_usb - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>USB</em> or <em>ALL(AM,PM,USB,LSB)</em> as the contribution type. <em>pnoise_usb</em> has information about the total noise from frequencies above the output frequency.</p>
<p>
<a id="pgfId-1295636"></a>pnoise_lsb - This option is available if you select the <em>timeaverage</em> option from the <em>NoiseType</em> drop-down list and select <em>ALL(AM,PM,USB,LSB)</em> as the contribution type. <em>pnoise_lsb</em> has information about the total noise from frequencies above the output frequency. </p>
<p>
<a id="pgfId-1295689"></a>If noise separation is enabled, an additional <em>pnoise_src</em> option will be added along with the above options. <em>pnoise_src</em> has information about the noise currents at the individual noise sources at the noise source. </p>
<p>
<a id="pgfId-1295681"></a>If you want the noise contributors at a single frequency, select <em>spot noise</em>. If you want to have the noise integrated over a frequency range, select <em>integrated noise</em>.</p>
<p>
<a id="pgfId-1138466"></a>If you want noise in volts, set the <em>noise unit</em> to <em>V.</em></p>
<p>
<a id="pgfId-1295730"></a>You can choose a value from the <em>hierarchy level</em> drop-down box to view the noise contributions from all noise sources within each instance at the specified level of hierarchy.</p>
<p>
<a id="pgfId-1138467"></a>Generally, <em>Include All Types</em> should be selected. If you just want the noise from specific types of noise generators, you can select them from the list.</p>
<p>
<a id="pgfId-1138468"></a>If you want to specifically include or exclude instances in the list, use the select button to the right side of the include instances and exclude instances fields and then select the components in the schematic.</p>
<p>
<a id="pgfId-1138469"></a>Truncate just applies to the list. The total input and output-referred noise at the bottom of the noise summary output always includes all the noise from everything.</p>
<p>
<a id="pgfId-1138470"></a>The figure below is the noise summary window with the sort function being set to noise contributors. Then there are three windows that show the three different sorted outputs.</p>

<p>
<a id="pgfId-1138474"></a></p>
<div class="webflare-div-image">
<img width="668" height="577" src="images/Chap4-344.gif" /></div>

<p>
<a id="pgfId-1138480"></a>An example of the noise summary output sorted by noise contributors.</p>

<p class="webflare-indent1">
<a id="pgfId-1144739"></a></p>
<div class="webflare-div-image">
<img width="594" height="476" src="images/Chap4-345.gif" /></div>

<p>
<a id="pgfId-1138481"></a>An example of the noise summary output sorted by composite noise.</p>
<p>
<a id="pgfId-1138485"></a>The below output is sorted by device name.</p>

<p>
<a id="pgfId-1138486"></a></p>
<div class="webflare-div-image">
<img width="668" height="761" src="images/Chap4-346.gif" /></div>

<p>
<a id="pgfId-1138487"></a>For all of the noise summaries, here is a table of the abbrev<a id="noise_param_names"></a>iations used in the Param column:</p>
<p>
<a id="pgfId-1138488"></a>Resistor and Inductor:</p>

<p>
<a id="pgfId-1138502"></a></p>
<table class="webflareTable" id="#id1138489">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1138491">
<a id="pgfId-1138491"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1138493">
<a id="pgfId-1138493"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138495"></a><code>rn</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138497"></a>resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138499"></a><code>fn</code></p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138501"></a>Flicker noise</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1138504"></a>Diode:</p>

<p>
<a id="pgfId-1138518"></a></p>
<table class="webflareTable" id="#id1138505">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144942">
<a id="pgfId-1144942"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144944">
<a id="pgfId-1144944"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138511"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138513"></a>Diode current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138515"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138517"></a>Series parasitic resistor noise</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1138520"></a>Gummel-Poon BJT:</p>

<p>
<a id="pgfId-1138554"></a></p>
<table class="webflareTable" id="#id1138521">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144950">
<a id="pgfId-1144950"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144952">
<a id="pgfId-1144952"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138527"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138529"></a>Flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138531"></a>ic</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138533"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138535"></a>ib</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138537"></a>Base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138539"></a>rc</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138541"></a>Thermal noise from the collector parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138543"></a>rb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138545"></a>Thermal noise from the base parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138547"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138549"></a>Thermal noise from the emitter parasitic resistor</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1138556"></a>HiCUM:</p>

<p>
<a id="pgfId-1138590"></a></p>
<table class="webflareTable" id="#id1138557">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144957">
<a id="pgfId-1144957"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144959">
<a id="pgfId-1144959"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138563"></a>ib</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138565"></a>Base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138567"></a>ic</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138569"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138571"></a>rbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138573"></a>Thermal noise from the internal base parasitic resistor (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138575"></a>rbx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138577"></a>Thermal noise from the external base parasitic resistor (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138579"></a>rcx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138581"></a>Collector parasitic resistor thermal noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138583"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138585"></a>Emitter parasitic resistor thermal noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138587"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138589"></a>Flicker noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 4-1
<a id="pgfId-1178619"></a>HiCUM Schematic Diagram</strong></p>
<p>
<a id="pgfId-1138594"></a></p>
<div class="webflare-div-image">
<img width="674" height="470" src="images/Chap4-347.gif" /></div>

<p>
<a id="pgfId-1138598"></a>VBIC:</p>

<p>
<a id="pgfId-1138656"></a></p>
<table class="webflareTable" id="#id1138599">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144970">
<a id="pgfId-1144970"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144972">
<a id="pgfId-1144972"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138605"></a>rbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138607"></a>Thermal noise in resistor Rbi (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138609"></a>rbx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138611"></a>Thermal noise in resistor Rbx (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138613"></a>rci</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138615"></a>Thermal noise in resistor Rci (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138617"></a>re</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138619"></a>Thermal noise in resistor Re (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138621"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138623"></a>Thermal noise in resistor Rs (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138625"></a>itzf</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138627"></a>Collector current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138629"></a>ibe</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138631"></a>Total base current shot noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138633"></a>ibex</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138635"></a>Node Bx to E base current shot noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138637"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138639"></a>Ibe flicker noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138641"></a>fnx</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138643"></a>Ibex flicker noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138645"></a>iccp</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138647"></a>Parasitic transport collector to emitter current noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138649"></a>ibep</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138651"></a>Parasitic transport base to emitter current noise (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138653"></a>fnp</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138655"></a>Ibep flicker Noise (See diagram below)</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 4-2
<a id="pgfId-1178635"></a>VBIC Schematic Diagram</strong></p>
<p>
<a id="pgfId-1138974"></a></p>
<div class="webflare-div-image">
<img width="665" height="630" src="images/Chap4-348.gif" /></div>

<p>
<a id="pgfId-1138975"></a>BSIM3:</p>

<p>
<a id="pgfId-1138997"></a></p>
<table class="webflareTable" id="#id1138976">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144978">
<a id="pgfId-1144978"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144980">
<a id="pgfId-1144980"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138982"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138984"></a>Flicker Noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138986"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138988"></a>Thermal noise from the resistive drain current</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138990"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138992"></a>Thermal noise from the source parasitic resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138994"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1138996"></a>Thermal noise from the drain parasitic resistor</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1138998"></a>BSIM4:</p>

<p>
<a id="pgfId-1139056"></a></p>
<table class="webflareTable" id="#id1138999">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144992">
<a id="pgfId-1144992"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1144994">
<a id="pgfId-1144994"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139005"></a>fn</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139007"></a>Flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139009"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139011"></a>Thermal noise from the resistive drain current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139013"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139015"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139017"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139019"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139021"></a>igd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139023"></a>Gate-to-drain tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139025"></a>igs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139027"></a>Gate-to-source tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139029"></a>igb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139031"></a>Gate-to-bulk tunneling current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139033"></a>rbdb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139035"></a>Resistor thermal noise between dbNode and bNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139037"></a>rbpb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139039"></a>Resistor thermal noise between bNode and bNodePrime (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139041"></a>rbpd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139043"></a>Resistor thermal noise between Bulk and dbNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139045"></a>rbps</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139047"></a>Resistor thermal noise between bulk and bNode prime</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139049"></a>rbsb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139051"></a>Resistor thermal noise between sbNode and bNode (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139053"></a>rgbi</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139055"></a>Gate Bias-Independent Resistor thermal noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 4-3
<a id="pgfId-1178652"></a>BSIM4 Schematic Diagrams</strong></p>
<p>
<a id="pgfId-1139060"></a></p>
<div class="webflare-div-image">
<img src="images/Chap4E/intrinsic.GIF" /></div>
<p>
<a id="pgfId-1139064"></a></p>
<div class="webflare-div-image">
<img width="597" height="304" src="images/Chap4-350.gif" /></div>

<p>
<a id="pgfId-1139132"></a>PSP-103</p>

<p>
<a id="pgfId-1145037"></a></p>
<table class="webflareTable" id="#id1139067">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1145051">
<a id="pgfId-1145051"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1145053">
<a id="pgfId-1145053"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139073"></a>sfl</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139075"></a>Channel current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139077"></a>sth</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139079"></a>Channel current thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139081"></a>sig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139083"></a>induced gate noise at 1 Hz</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139085"></a>sigth</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139087"></a>Induced gate noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139089"></a>shotgd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139091"></a>Gate current shot noise from gate to drain</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139093"></a>shotgs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139095"></a>Gate current shot noise from gate to source</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139097"></a>sjnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139099"></a>Source to Bulk leakage current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139101"></a>djnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139103"></a>Drain to Bulk leakage and avalanche current noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139105"></a>rgatenoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139107"></a>Gate resistance thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139109"></a>rbulknoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139111"></a>Bulk resistor thermal noise between node BP and BI (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139113"></a>rjnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139115"></a>Source side bulk resistor thermal noise between node BI and BS (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139117"></a>rjundnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139119"></a>Drain side bulk resistor thermal noise between node BI and BD (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139121"></a>rwellnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139123"></a>Well resistor thermal noise between node BI and B (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139125"></a>rsourcenoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139127"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139129"></a>rdrainnoise</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1139131"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 4-4
<a id="pgfId-1178663"></a>PSP-103 Schematic Diagram</strong></p>
<p>
<a id="pgfId-1139136"></a></p>
<div class="webflare-div-image">
<img src="images/Chap4E/psp103_43.gif" /></div>

<p>
<a id="pgfId-1178681"></a>EKV<strong> 3.0</strong></p>

<p>
<a id="pgfId-1178735"></a></p>
<table class="webflareTable" id="#id1178682">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1178684">
<a id="pgfId-1178684"></a>Parameter</span>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<span class="tbl-head" id="#id1178686">
<a id="pgfId-1178686"></a>Meaning</span>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178688"></a>fn_id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178690"></a>Channel current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178692"></a>fn_ig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178694"></a>Gate current flicker noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178696"></a>rs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178698"></a>Source parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178700"></a>rd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178702"></a>Drain parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178704"></a>rg</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178706"></a>Gate parasitic resistor thermal noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178708"></a>rsb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178710"></a>Thermal noise for the substrate resistor connected between BSi and B. (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178712"></a>rdb</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178714"></a>Thermal noise for the substrate resistor connected between BDi and B. (See diagram below)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178716"></a>rbbs</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178718"></a>Thermal noise for the substrate resistor connected between BSi and Bi. (See diagram below where it is labeled RDSB/2)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178720"></a>rbbd</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178722"></a>Thermal noise for the substrate resistor connected between BDi and Bi. (See diagram below where it is labeled RDSB/2)</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178724"></a>id</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178726"></a>Thermal noise of the channel resistor</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178728"></a>cor</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178730"></a>Induced gate noise</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178732"></a>shot_ig</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1178734"></a>Gate current shot noise</p>
</td>
</tr>
</tbody></table>
<p><strong>Figure 4-5
<a id="pgfId-1178746"></a>EKV3.0 Schematic Diagrams</strong></p>
<p>
<a id="pgfId-1178673"></a></p>
<div class="webflare-div-image">
<img src="images/Chap4E/27_1.GIF" /></div>

<p>
<a id="pgfId-1145068"></a>For other model types:</p>
<ol><li>
<a id="pgfId-1145069"></a>In a unix/linux shell window type <code>which spectre</code>.<br />
<a id="pgfId-1145070"></a>This should return a path that ends in <code>tools/bin/spectre</code>.</li><li>
<a id="pgfId-1139140"></a>Triple-click the line with the path, and then click the center mouse button to enter it as a command.</li><li>
<a id="pgfId-1139141"></a>Use the backspace key, and delete the word <code>spectre</code>.</li><li>
<a id="pgfId-1139142"></a>Type <code>cdnshelp</code> at the end of the expression, and press <code>Enter</code>.<br />
<a id="pgfId-1139143"></a>A browser window will be displayed.</li><li>
<a id="pgfId-1139144"></a>Close the <em>Tip of the day</em> window.</li><li>
<a id="pgfId-1139145"></a>At the top, you should see the release number of the simulator you are using.</li><li>
<a id="pgfId-1139146"></a>Click the plus sign (+) to the left of the MMSim folder.</li><li>
<a id="pgfId-1139147"></a>Click the plus sign (+) to the left of the <em>Spectre Circuit Simulator Components and Device Models Reference</em> folder.</li><li>
<a id="pgfId-1139148"></a>Select the device type you are using.</li><li>
<a id="pgfId-1139149"></a>At the bottom of that device listing, you will see <em>Component Statements</em>. Double-click on this.</li><li>
<a id="pgfId-1139150"></a>Enter the name of the parameter in the search box in the right pane of the cdnshelp window.</li><li>
<a id="pgfId-1139151"></a>Click the down arrow to the right of the <em>Find</em> field until you see the parameter name in the pane on the right side, and then see the definition of that parameter.</li></ol>














<h4>
<a id="pgfId-1139168"></a>Noise Figure</h4>

<p>
<a id="pgfId-1139169"></a>On the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1139173"></a></p>
<div class="webflare-div-image">
<img width="668" height="626" src="images/Chap4-353.gif" /></div>

<ol><li>
<a id="pgfId-1139174"></a>Select <em>pnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1139175"></a>Select the desired type of noise plot from the <em>Function</em> section. <em>Noise Figure</em> is single-sideband noise figure.</li><li>
<a id="pgfId-1139176"></a>If you want the noise figure over a specified bandwidth, check the <em>Integrated Over Bandwidth</em> checkbox.</li><li>
<a id="pgfId-1139177"></a>Specify the frequency range you want for the noise figure calculation.</li><li>
<a id="pgfId-1139178"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1139179"></a>The dsb noise figure and the noise figure calculation over your bandwidth are displayed. <br />
<a id="pgfId-1139183"></a><div class="webflare-div-image">
<img width="636" height="463" src="images/Chap4-354.gif" /></div></li></ol>








<h4>
<a id="pgfId-1139184"></a>Viewing Noise Separation Results</h4>
<h4>
<a id="pgfId-1139185"></a>Viewing the Total Noise at the Output from a Single Noise Input Frequency</h4>

<p>
<a id="pgfId-1139186"></a>This capability allows the noise from all sources in the circuit at different noise input frequencies to be measured. For example, all the noise that does not change frequency (the zero sideband) can be plotted, along with the other noise input frequencies (sidebands) This plotting capability allows problem frequencies to be identified.</p>
<p>
<a id="pgfId-1139187"></a>On the Direct Plot Form:</p>

<p class="webflare-indent1">
<a id="pgfId-1139191"></a></p>
<div class="webflare-div-image">
<img width="636" height="779" src="images/Chap4-355.gif" /></div>

<ol><li>
<a id="pgfId-1139192"></a>Select <em>pnoise separation</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1296333"></a>Select the noise type from the <em>Noise Type</em> section. By default, <em>USB</em> is selected.</li><li>
<a id="pgfId-1139193"></a>To view the total noise at the output select <em>Sideband Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1139194"></a>Select <em>V/sqrt(Hz)</em> or <em>v**2/Hz</em> from the <em>Signal</em> <em>Level</em> radio buttons.</li><li>
<a id="pgfId-1139195"></a>Select the appropriate modifier from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1139196"></a>Select the sideband number form the <em>Output Sideband </em>list. 0 means no frequency translation.</li><li>
<a id="pgfId-1139197"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1139201"></a><div class="webflare-div-image">
<img width="636" height="462" src="images/Chap4-356.gif" /></div>
<a id="pgfId-1139202"></a>The output noise from sideband zero is plotted. This is the noise that is present at the output with no frequency translations included.</li></ol>












<h4>
<a id="pgfId-1139203"></a>Plotting Noise from Sideband -1</h4>

<p>
<a id="pgfId-1139204"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1139205"></a>Select the -1 sideband from the <em>Output Sideband</em> list. Selecting the -1 sideband means the noise frequency is shifted down in frequency by -1* first harmonic of pss from the frequency that is specified as the noise output frequency in the <em>Choosing Analyses</em> form. For example, if the pss frequency is 1.9G, and the noise output frequency is 1M, the noise input frequency is -1.899GHz.<br />
<a id="pgfId-1139209"></a><div class="webflare-div-image">
<img width="636" height="620" src="images/Chap4-357.gif" /></div></li><li>
<a id="pgfId-1139210"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1139216"></a><div class="webflare-div-image">
<img width="636" height="424" src="images/Chap4-358.gif" /></div>
<a id="pgfId-1139217"></a>As a suggestion, use the <em>Graph</em> - <em>Add Label</em> menu option to place labels to identify the traces, as shown in the figure above. <br />
<a id="pgfId-1159580"></a>If you select multiple sidebands to be plotted at the same time, the sideband number will be shown at the right side of the legend in the waveform window.<br />
<a id="pgfId-1145320"></a><div class="webflare-div-image">
<img width="503" height="775" src="images/Chap4-359.gif" /></div>
<a id="pgfId-1139225"></a><div class="webflare-div-image">
<img width="641" height="430" src="images/Chap4-360.gif" /></div></li></ol>
















<h4>
<a id="pgfId-1139227"></a>Viewing Total Noise at the Output from each Instance</h4>

<p>
<a id="pgfId-1139228"></a>Once the problem frequencies are identified in the plot of Sideband Output, the problem components need to be identified. From the previous plot, the zero sideband contributes the largest amount of noise to the overall output noise. Using the Instance Output allows the identification of which components in the zero sideband contribute the most noise. The total noise for all the noise mechanisms within the component is plotted.</p>
<p>
<a id="pgfId-1139229"></a>On the <em>Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1139233"></a></p>
<div class="webflare-div-image">
<img width="668" height="795" src="images/Chap4-361.gif" /></div>

<ol><li>
<a id="pgfId-1139234"></a>Select <em>Instance Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1139235"></a>Select <em>V/sqrt(Hz)</em> or <em>V**2/Hz</em>.</li><li>
<a id="pgfId-1139236"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1139237"></a>Select the sideband number. In this example, the zero sideband was determined to contribute the most noise at the output of the circuit.</li><li>
<a id="pgfId-1139238"></a>Select the type of component to display. If you want all of the types, choose <em>Include All Types</em>.</li><li>
<a id="pgfId-1139244"></a>Specify the number of results you want to plot in the <em>Truncate</em> section.</li><li>
<a id="pgfId-1139249"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1139250"></a>The total noise at the output for the top three components is plotted. <br />
<a id="pgfId-1139255"></a><div class="webflare-div-image">
<img width="665" height="502" src="images/Chap4-362.gif" /></div>
<a id="pgfId-1171351"></a>To see which component goes with which trace, select the plus sign (highlighted in red on the previous graphic) to the left or the text at the upper left of the display area. The legends expand, and you can see which trace is which in the Name field on the left side of the display tool. You can also either select the trace or the individual entry in the Name field and the trace and legend will highlight. The instance name is shown on the right side of the legend. You may need to change the size of the legend area by moving your mouse cursor over the line that separates the two areas in the waveform tool. The cursor will change shape. Now click-and-hold the mouse button, move to a new location, and release the mouse button.<br />
<a id="pgfId-1139260"></a><div class="webflare-div-image">
<img width="668" height="399" src="images/Chap4-363.gif" /></div></li></ol>















<h4>
<a id="pgfId-1139261"></a>Viewing the Exact Noise Mechanism Within the devices</h4>

<p>
<a id="pgfId-1139262"></a>The sideband with the largest contribution was determined by selecting Sideband Output and plotting. The specific component was identified by selecting Instance Output. The specific noise mechanisms can be identified using Source output. This plots the largest individual noise mechanisms for the sideband you select.</p>
<p>
<a id="pgfId-1139263"></a>On the<em> Direct Plot Form</em>:</p>

<p>
<a id="pgfId-1139267"></a></p>
<div class="webflare-div-image">
<img width="670" height="790" src="images/Chap4-364.gif" /></div>

<ol><li>
<a id="pgfId-1139268"></a>Select <em>Source Output</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1139269"></a>Select <em>V/sqrt(Hz)</em> or <em>v**2/Hz</em>.</li><li>
<a id="pgfId-1139270"></a>Select the appropriate modifier.</li><li>
<a id="pgfId-1139271"></a>Select the sideband number.</li><li>
<a id="pgfId-1139272"></a>Select the type of component to display. If you want all of the types, choose <em>Include All Types</em>.</li><li>
<a id="pgfId-1139277"></a>If you want to restrict to one device, put its instance name in the <em>include inst</em> field. A list of devices separated by a space is also acceptable.</li><li>
<a id="pgfId-1139278"></a>If you want to exclude a device (or devices) enter the instance name(s) in the <em>exclude inst</em> field.</li><li>
<a id="pgfId-1139279"></a>Specify the number of results you want to plot in the <em>by top </em>field.</li><li>
<a id="pgfId-1139280"></a>Click <em>Plot.</em><br />
<a id="pgfId-1274175"></a>The exact noise mechanism within the devices is plotted.<br />
<a id="pgfId-1274179"></a><div class="webflare-div-image">
<img width="637" height="457" src="images/Chap4-365.gif" /></div>
<a id="pgfId-1274180"></a>To see which noise source goes with which trace, select the plus sign to the left or the text at the upper left of the display area. The legends will be shown individually in the Name field of the waveform tool. The device name and the individual noise contributor will be shown. You can select either the individual legend or the trace and both the legend and the trace will be highlighted. The first part is the instance name, and the second part is the specific noise mechanism within that instance. For a list of the abbreviations used for the noise parameter, see the list that starts on page 123 (77 of 234) In the example below, fn is flicker noise, and id is the channel resistance thermal noise.<br />
<a id="pgfId-1145811"></a><div class="webflare-div-image">
<img width="668" height="473" src="images/Chap4-366.gif" /></div></li></ol>

















<h4>
<a id="pgfId-1145812"></a>Viewing the total noise currents within the devices</h4>
<p>
<a id="pgfId-1145775"></a></p>
<div class="webflare-div-image">
<img width="340" height="799" src="images/Chap4-367.gif" /></div>

<p>
<a id="pgfId-1139300"></a>This capability has limited value. All the noise currents from all the noise mechanisms within the instance are added up. No gain function is applied or are available for this measurement. It just adds up everything within that instance.</p>

<ol><li>
<a id="pgfId-1139301"></a>Select <em>Instance source</em>.</li><li>
<a id="pgfId-1145870"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the Signal Level selection.</li><li>
<a id="pgfId-1145871"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1145872"></a>Select the sideband number.</li><li>
<a id="pgfId-1139305"></a>If you want every noise source to be considered, select I<em>nclude All Types</em>.</li><li>
<a id="pgfId-1139306"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1139307"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst </em>field, and select the instances on the schematic.</li><li>
<a id="pgfId-1139308"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1139309"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1139313"></a>The frequency response curves are displayed.<br /><div class="webflare-div-image">
<img width="657" height="442" src="images/Chap4-368.gif" /></div></li></ol>












<h4><em>
<a id="pgfId-1139317"></a>Plotting the individual noise source currents</em></h4>
<p>
<a id="pgfId-1146052"></a></p>
<div class="webflare-div-image">
<img width="343" height="802" src="images/Chap4-369.gif" /></div>

<p>
<a id="pgfId-1139318"></a>This capability plots the individual noise currents within the device. This capability gives you the noise at the source instead of at the output of the simulation.</p>

<ol><li>
<a id="pgfId-1139319"></a>Select <em>Primary Source</em>.</li><li>
<a id="pgfId-1139320"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the <em>Signal Level</em> selection.</li><li>
<a id="pgfId-1139321"></a>Select <em>Magnitude</em> or <em>dB20</em> in the Modifier section.</li><li>
<a id="pgfId-1139322"></a>Select the sideband number.</li><li>
<a id="pgfId-1139323"></a>If you want every noise source to be considered, select I<em>nclude All Types</em>.</li><li>
<a id="pgfId-1139324"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1139325"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst.</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1139326"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1139327"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1139331"></a>The frequency response curves are displayed.<br />
<a id="pgfId-1146203"></a><div class="webflare-div-image">
<img width="592" height="366" src="images/Chap4-370.gif" /></div>
<a id="pgfId-1139332"></a>For a list of the noise parameter names, please see the <a href="Chap4.html#10582">Noise Summary</a>.</li></ol>
















<h4><em>
<a id="pgfId-1139336"></a>Plotting the gain from the individual noise sources to the output</em></h4>
<p>
<a id="pgfId-1146255"></a></p>
<div class="webflare-div-image">
<img width="346" height="798" src="images/Chap4-371.gif" /></div>

<p>
<a id="pgfId-1139337"></a>This capability gives the gain from the individual noise currents to the output of the circuit.</p>

<ol><li>
<a id="pgfId-1139338"></a>Select <em>Source Noise Gain</em>.</li><li>
<a id="pgfId-1139339"></a>Select <em>A/sqrt(Hz)</em> or <em>A**2/Hz</em> in the <em>Signal Level</em> selection.</li><li>
<a id="pgfId-1139340"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1139341"></a>Select the sideband number.</li><li>
<a id="pgfId-1139342"></a>If you want every noise source to be considered, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1139343"></a>To exclude instances, click <em>Select</em> to the right of the <em>exclude inst</em> field, and select the device instances you want to exclude from the plot.</li><li>
<a id="pgfId-1139344"></a>To include specific instances, click <em>Select</em> to the right of the <em>include inst.</em> field, and select the instances on the schematic.</li><li>
<a id="pgfId-1139345"></a>Set the number of curves to plot by setting the Truncate function.</li><li>
<a id="pgfId-1146432"></a>Click <em>Plot</em>.</li></ol>









<p>
<a id="pgfId-1146436"></a>The frequency response curves are displayed. For a list of the abbreviations used for the noise parameters, please see <a href="Chap4.html#10582">Noise Summary</a>.</p>

<p>
<a id="pgfId-1146445"></a></p>
<div class="webflare-div-image">
<img width="606" height="407" src="images/Chap4-372.gif" /></div>
<h3>
<a id="pgfId-1139352"></a>Multiple pnoise</h3>

<p>
<a id="pgfId-1139353"></a>Consider an LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1139357"></a></p>
<div class="webflare-div-image">
<img width="668" height="645" src="images/Chap4-373.gif" /></div>

<p>
<a id="pgfId-1139358"></a>In the above circuit, there are two outputs that need to be measured. The first is at the LNA output, and the second is at the mixer output. The noise frequencies are different at the two outputs.</p>
<ol><li>
<a id="pgfId-1139359"></a> First, set up the pss form as appropriate for your design. For more information on the pss analysis, please see the periodic steady-state analysis at the beginning of this chapter.<br />
<a id="pgfId-1146489"></a><div class="webflare-div-image">
<img width="468" height="765" src="images/Chap4-374.gif" /></div></li><li>
<a id="pgfId-1139363"></a>In the pnoise <em>Choosing Analyses</em> form, select <em>Multiple pnoise</em>, and set up the noise analysis for one of the outputs. The mixer output is shown below.<br />
<a id="pgfId-1139368"></a><div class="webflare-div-image">
<img width="668" height="785" src="images/Chap4-375.gif" /></div></li><li>
<a id="pgfId-1139369"></a>Select the second line in the <em>Multiple pnoise</em> section and set up that analysis.<br />
<a id="pgfId-1139373"></a><div class="webflare-div-image">
<img width="668" height="802" src="images/Chap4-376.gif" /></div></li><li>
<a id="pgfId-1139374"></a>Run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct plot</em> - <em>Main Form</em>. The single-sideband noise figure measurement for the LNA is shown below. The selection mechanism for the noise result is called Multiple Out and is highlighted below.<br />
<a id="pgfId-1139379"></a><div class="webflare-div-image">
<img width="668" height="668" src="images/Chap4-377.gif" /></div></li><li>
<a id="pgfId-1139380"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1139384"></a><div class="webflare-div-image">
<img width="668" height="482" src="images/Chap4-378.gif" /></div></li><li>
<a id="pgfId-1139385"></a>To plot the noise figure of the overall circuit, set the <em>Multiple Out</em> selection to the Mixer output at Port2. For direct conversion, usually double-sideband noise figure is desired.<br />
<a id="pgfId-1139389"></a><div class="webflare-div-image">
<img width="668" height="644" src="images/Chap4-379.gif" /></div></li><li>
<a id="pgfId-1139390"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1139391"></a>The waveform tool shows the noise figure curve and the integrated noise figure to 1MHz.<br />
<a id="pgfId-1139395"></a><div class="webflare-div-image">
<img width="668" height="459" src="images/Chap4-380.gif" /></div></li></ol>


































<h4>
<a id="pgfId-1139396"></a>Noise as a Function of Blocker Power</h4>
<p>
<a id="pgfId-1139400"></a></p>
<div class="webflare-div-image">
<img width="670" height="774" src="images/Chap4-381.gif" /></div>

<ul><li>
<a id="pgfId-1139401"></a>Note that the input source has 2 large-signal tones set up.</li><li>
<a id="pgfId-1139402"></a>The first large-signal tone has the frequency set to the variable <span class="webflare-courier-new" style="white-space:pre"><em>fb1</em></span> and the amplitude set to <span class="webflare-courier-new" style="white-space:pre"><em>pb</em></span>.</li><li>
<a id="pgfId-1139403"></a>The second tone has the frequency set to the variable <span class="webflare-courier-new" style="white-space:pre"><em>fb2</em></span> and the amplitude set to <span class="webflare-courier-new" style="white-space:pre"><em>pb</em></span>. This is the blocker signal.</li><li>
<a id="pgfId-1315426"></a>Note that for this measurement, you might need to switch to harmonic balance. If the blocker frequency and LO frequency have a low PSS beat frequency, then PSS will take a very long time to run and will use a lot of memory. In the case shown below, the PSS frequency of 100MHz is high enough to be possible.</li></ul>



<p>
<a id="pgfId-1139404"></a>To measure the noise as a function of blocker power:</p>
<ol><li>
<a id="pgfId-1139405"></a>Apply the signals that cause the large-signal effects in the pss analysis, and then run a pnoise analysis. In this case, the LO and the blocking signal should be applied in the pss analysis. Note that if the highest input frequency divided by the PSS beat frequency is above about 25, it is very likely that hb or qpss would run faster than pss because hb and qpss only calculate the actual frequencies produced by the circuit, while pss calculates all the harmonics of the beat frequency.<ul><li>
<a id="pgfId-1139407"></a>The LO is set to 2.4GHz (shown in green).</li><li>
<a id="pgfId-1139413"></a>The first RF is set to 2.5G and -24 dBm (shown in red). This is the blocker signal.</li><li>
<a id="pgfId-1139421"></a>The second RF tone is disabled by setting its frequency to zero (shown in yellow). <br /><ffi2-fig-frame-in-2 id="#id1275340">
<a id="pgfId-1275340"></a></ffi2-fig-frame-in-2><div class="webflare-div-image">
<img width="668" height="454" src="images/Chap4-382.gif" /></div></li></ul></li></ol>







<p>
<a id="pgfId-1139428"></a>On the pss <em>Choosing Analyses</em> form:</p>

<p>
<a id="pgfId-1139432"></a></p>
<div class="webflare-div-image">
<img width="667" height="794" src="images/Chap4-383.gif" /></div>

<ol><li>
<a id="pgfId-1139433"></a>Set up the pss analysis appropriately. For more information, see the pss section at the beginning of the chapter.</li><li>
<a id="pgfId-1139435"></a>Sweep the RF power over an appropriate range. Generally speaking, the power should start about 20 to 40 dB below the below the 1dB gain compression point, and sweep through the power level that is needed to meet the specification for the communication system you are working on. In general, this higher level would be near the compression point, or perhaps slightly above it.</li></ol>

<p>
<a id="pgfId-1139436"></a>On the pnoise <em>Choosing Analyses</em> form:</p>

<p>
<a id="pgfId-1139440"></a></p>
<div class="webflare-div-image">
<img width="670" height="799" src="images/Chap4-384.gif" /></div>

<ol><li>
<a id="pgfId-1139441"></a>Usually, a single frequency is run in the pnoise, when the blocker power is swept.</li><li>
<a id="pgfId-1139442"></a>Specify the desired output frequency.<br />
<a id="pgfId-1139443"></a><strong>Shooting</strong>: Because to go through the fifth harmonic of 2.5GHz requires that sidebands be set to 125, (5*25th harmonic of 100MHz), fullspectrum pnoise is chosen so the simulation time is reduced. When fullspectrum is chosen, the number of frequency translations depends on the maximum step in the pss analysis. The maximum step of the pss analysis depends on how the maximum harmonic field is set. In this case, to verify that enough sidebands are being used, first set the maximum harmonics term to a bit less than the number anticipated for pnoise. Run the simulation, and plot the noise figure. Roughly double the number of pss harmonics, and run the simulation again. If the noise figure plot did not change, you had enough to start with, and try reducing the number of harmonics in the pss analysis. Reducing the number of harmonics below 10 will have no effect on the simulation. If the noise figure increased, then double the number of harmonics again and re-run the simulation. Use the smallest number of harmonics that produces a stable pnoise result. If the default pnoise method is used, start with an estimate of the number of frequency translations you need based on the nonlinearity of the system. Set that as the number of sidebands, Divide this number by 4, and set that as the number of pss harmonics. Run the simulation, and plot the noise result. Now double the number of pss harmonics and the number of pnoise sidebands. Rerun the simulation and replot the noise result. If the noise result did not change, you had enough harmonics and sidebands to begin with. If it did change, double again, and replot. Use the smallest number of harmonics and sidebands that give a stable result.<br />
<a id="pgfId-1139444"></a><strong>Harmonic Balance</strong>: Leave the <em>Maximum sideband</em> field blank, and estimate the number of required harmonics in the pss analysis. Run the simulation and plot the noise. Now increase the number of harmonics in pss by about 50%, and run the simulation again. If the noise changed, increase the pss harmonics and run again. If the noise did not change, reduce the number of pss harmonics an run again. Use the smallest number of harmonics you can in pss that maintains the stable noise output in pnoise.</li><li>
<a id="pgfId-1139445"></a>The rest are set as the preceding section.</li><li>
<a id="pgfId-1139446"></a>Run the simulation when you are done. </li><li>
<a id="pgfId-1139447"></a>When the simulation completes, select <em>Results - Direct Plot - Main Form</em> in ADE Explorer.<br />
<a id="pgfId-1139451"></a><div class="webflare-div-image">
<img width="637" height="547" src="images/Chap4-385.gif" /></div></li><li>
<a id="pgfId-1139452"></a>Select <em>pnoise</em>.</li><li>
<a id="pgfId-1139453"></a>Select the desired noise figure measurement.</li><li>
<a id="pgfId-1139454"></a>Click <em>Plot</em>. <br />
<a id="pgfId-1139455"></a>The resulting plot appears.<br />
<a id="pgfId-1139459"></a><div class="webflare-div-image">
<img width="637" height="407" src="images/Chap4-386.gif" /></div></li><li>
<a id="pgfId-1139460"></a>To make the plot more useful, right-click one of the numbers on the X Axis and select <em>Swap Sweep Var</em> from the context menu.<br />
<a id="pgfId-1147568"></a><div class="webflare-div-image">
<img width="195" height="211" src="images/Chap4-387.gif" /></div>
<a id="pgfId-1139464"></a>The <em>Swap Sweep Var</em> window is displayed. Note that the <em>Sweep Variables</em> field is set to <em>prf</em>, which is the variable that was swept.<br />
<a id="pgfId-1139468"></a><div class="webflare-div-image">
<img width="668" height="205" src="images/Chap4-388.gif" /></div></li><li>
<a id="pgfId-1139469"></a>Specify 1000000 in the X Value field.</li><li>
<a id="pgfId-1275731"></a>Click <em>OK</em>.<br />
<a id="pgfId-1139470"></a>A new subwindow is displayed with the noise figure on the Y axis, and the blocker power on the X Axis.<br />
<a id="pgfId-1139474"></a><div class="webflare-div-image">
<img width="668" height="411" src="images/Chap4-389.gif" /></div></li></ol>


































<h4>
<a id="pgfId-1139475"></a>Noise Type = timeaverage AM, PM AM&amp;PM noise</h4>

<p>
<a id="pgfId-1139476"></a>timeaverage allows the measurement of the AM and PM components of noise separately. This can be applied to any driven circuit or oscillator. This section is for driven circuits. See the oscillator section if you have an oscillator. Note that this is an averaged measurement over the full cycle of the pss waveform, not an instantaneous measurement at a single threshold voltage.</p>
<p>
<a id="pgfId-1139477"></a>First, set up the pss analysis as appropriate for your circuit. For more information, refer to the section <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>.</p>

<p>
<a id="pgfId-1139482"></a></p>
<div class="webflare-div-image">
<img width="668" height="783" src="images/Chap4-390.gif" /></div>

<p>
<a id="pgfId-1139483"></a>On the pnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1139484"></a>Set up an appropriate frequency range of interest.<br />
<a id="pgfId-1139488"></a><div class="webflare-div-image">
<img width="668" height="235" src="images/Chap4-391.gif" /></div></li><li>
<a id="pgfId-1147733"></a><strong>Shooting</strong>: Set maximum sideband up to 4 times the number of pss harmonics. Up to 40 sidebands can be set using the defaults. Fullspectrum is not available for harmonic balance.<br />
<a id="pgfId-1147893"></a><div class="webflare-div-image">
<img width="608" height="120" src="images/Chap4-392.gif" /></div>
<a id="pgfId-1147894"></a><strong>Harmonic balance</strong>: Leave the <em>Maximum sideband</em> field blank. This calculates noise translations for all the harmonics in the pss-harmonic balance analysis.</li><li>
<a id="pgfId-1139497"></a>Select the output net or nets in the schematic. If the <em>Negative Output Node</em> field is left blank, the global ground net is used as the entry.<br />
<a id="pgfId-1243524"></a><div class="webflare-div-image">
<img width="602" height="131" src="images/Chap4-393.gif" /></div></li><li>
<a id="pgfId-1243525"></a>Select <em>timeaverage</em> from the <em>Noise Type</em> drop-down list.<br />
<a id="pgfId-1243529"></a><div class="webflare-div-image">
<img width="668" height="178" src="images/Chap4-394.gif" /></div></li><li>
<a id="pgfId-1139507"></a>Run the simulation.</li></ol>





















<p>
<a id="pgfId-1139508"></a>Now plot the output noise using the <em>Direct Plot Form</em>.</p>
<p>
<a id="pgfId-1139509"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1139510"></a>Select pnoise from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1139511"></a>Select <em>Output Noise</em> from the <em>Function</em> section.<br />
<a id="pgfId-1139515"></a><div class="webflare-div-image">
<img width="668" height="651" src="images/Chap4-395.gif" /></div></li><li>
<a id="pgfId-1300367"></a>Enter the frequency in the <em>Value At (Hz)</em> field if you want to plot the value at a specific frequency. You can enter a list of frequencies separate by a space in this field.</li><li>
<a id="pgfId-1300368"></a>If you want this signal to plot automatically when a new simulation is run, select <em>Add To Outputs</em>. The expression is automatically evaluated in ADE.</li><li>
<a id="pgfId-1300355"></a>Click <em>Plot</em>.</li><li>
<a id="pgfId-1139517"></a>Again, select <em>pnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1139518"></a>Select<em> AM</em> or <em>PM</em> from the <em>Noise Type</em> section. The AM noise is selected below. Note you can choose SSB or DSB noise for AM and PM, DSB is 3dB higher than SSB noise.<br />
<a id="pgfId-1139523"></a><div class="webflare-div-image">
<img width="668" height="552" src="images/Chap4-396.gif" /></div></li><li>
<a id="pgfId-1139524"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1139528"></a><div class="webflare-div-image">
<img width="668" height="464" src="images/Chap4-397.gif" /></div></li></ol>



















<p>
<a id="pgfId-1139529"></a>On the plot, note that DSB AM noise is 3dB larger than the output noise. This is because the output noise is derived the single sideband only (the positive frequencies), and the DSB AM or PM noise is derived using the double sideband.</p>

<h4>
<a id="pgfId-1139530"></a>Noise Type=Sampled(jitter)</h4>

<p>
<a id="pgfId-1139531"></a>Driven jitter is usually used for measuring the noise in a digital circuit at a specific threshold crossing.This is an instantaneous measurement at one or more points in the time-domain waveform at a single threshold voltage. Accordingly, the pss <em>Choose Analyses</em> form uses shooting, as shown below. For more information on the pss analysis, please see <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>. This is also supported for harmonic balance. Harmonic balance is not recommended because the runtime is likely to be much longer than shooting. If you must use harmonic balance, measure the 10% to 90% risetimes on the rising and falling edge of the net to be measured from the tstab waveform. Set at least the period divided by the fastest risetime for the number of harmonics. If you underspecify the number of harmonics in hb, the risetime of the waveform will be smaller than the real circuit, and this will reduce the accuracy of the measurement.</p>

<p class="webflare-indent1">
<a id="pgfId-1139535"></a></p>
<div class="webflare-div-image">
<img width="668" height="776" src="images/Chap4-398.gif" /></div>

<p>
<a id="pgfId-1139536"></a>An appropriate threshold is needed, which can be determined by plotting the time domain waveform from the pss <em>Direct Plot Form</em>. The waveform below shows an appropriate threshold value to be 1.65V for this circuit, which is a 3.3 Volt logic circuit.</p>

<p>
<a id="pgfId-1139540"></a></p>
<div class="webflare-div-image">
<img width="668" height="395" src="images/Chap4-399.gif" /></div>

<p>
<a id="pgfId-1139541"></a>On the pnoise <em>Choosing Analyses</em> form: </p>
<ol><li>
<a id="pgfId-1139542"></a>The stop frequency is half the input frequency.</li><li>
<a id="pgfId-1139543"></a>The start frequency is 4 decades below that.</li><li>
<a id="pgfId-1139544"></a>About 5 points per decade is usually sufficient.</li><li>
<a id="pgfId-1316891"></a>It is recommended to use fullspectrum pnoise because it will run faster.</li><li>
<a id="pgfId-1139545"></a><em>Maximum sideband</em> should be left blank.</li><li>
<a id="pgfId-1330211"></a>The <em>Output</em> field is set to <em>voltage</em>.</li><li>
<a id="pgfId-1139548"></a>The <em>Noise Type</em> is set to <em>sampled(jitter)</em>.</li><li>
<a id="pgfId-1317027"></a>Select the <em>Edge Crossing</em> Mode.</li><li>
<a id="pgfId-1317070"></a>Set Timing Event to <em>Edge Crossing</em>.</li><li>
<a id="pgfId-1317112"></a>Select the net that will be used to get the time of the measurement in the <em>Trigger</em> section.</li><li>
<a id="pgfId-1317211"></a>Set an appropriate threshold and edge direction as per your requirements.</li><li>
<a id="pgfId-1317293"></a>Specify the net where the noise measurement will be made.</li><li>
<a id="pgfId-1317433"></a>Click <em>OK</em>.<br />
<a id="pgfId-1317393"></a><div class="webflare-div-image">
<img width="668" height="736" src="images/Chap4-400.gif" /></div></li></ol>
















<p>
<a id="pgfId-1246583"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. </p>
<p>
<a id="pgfId-1330567"></a>On the Direct Plot Form, select <em>Jee</em>, which is edge-to-edge jitter. In the below example, 43p is the rising edge.</p>

<p>
<a id="pgfId-1139557"></a></p>
<div class="webflare-div-image">
<img width="668" height="689" src="images/Chap4-401.gif" /></div>

<p>
<a id="pgfId-1139558"></a>The output noise frequency response and the edge-to-edge jitter are displayed. The jee measurement is one standard deviation for the expected jitter.</p>

<p>
<a id="pgfId-1139563"></a></p>
<div class="webflare-div-image">
<img width="668" height="425" src="images/Chap4-402.gif" /></div>
<h4>
<a id="pgfId-1317625"></a>Edge Delay Mode</h4>

<p>
<a id="pgfId-1317648"></a>In this mode, the trigger and the measurement are both edges. In the example below, the <em>int2</em> net is the input to an inverter and <em>int3</em> is the output of the inverter. In this example, the jitter of the inverter connected between <em>int2</em> and <em>int3</em> is measured. You can also specify the same net from rising to falling edge to measure the jitter of a pulse. Both trigger and measurement can be any edge in the circuit. As a result, this mode is very flexible.</p>
<p>
<a id="pgfId-1318134"></a>In this mode, use the same frequency range as before. The stop frequency is half the PSS frequency and the start frequency is 4 decades below that. </p>
<ul><li>
<a id="pgfId-1330934"></a>Select <em>Edge Delay</em> for Timing Event.</li><li>
<a id="pgfId-1318352"></a>Specify the trigger net and threshold.</li><li>
<a id="pgfId-1318398"></a>Specify the measurement net and threshold.</li><li>
<a id="pgfId-1318448"></a>Click <em>OK</em>.<br />
<a id="pgfId-1318469"></a>.<div class="webflare-div-image">
<img width="554" height="673" src="images/Chap4-403.gif" /></div></li><li>
<a id="pgfId-1318484"></a>Run the simulation. </li></ul>








<p>
<a id="pgfId-1331148"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. </p>
<p>
<a id="pgfId-1318556"></a>On the Direct Plot Form:</p>
<ol><li>
<a id="pgfId-1318571"></a>Select <em>jDelay</em> from the Function section.</li><li>
<a id="pgfId-1318593"></a>Select <em>rms</em> for Signal Level.</li><li>
<a id="pgfId-1318612"></a>Select <em>Second</em> from the Modifier section.</li><li>
<a id="pgfId-1331422"></a>Set the frequency range equal to the pnoise frequency range.</li><li>
<a id="pgfId-1318694"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1331289"></a><div class="webflare-div-image">
<img width="423" height="638" src="images/Chap4-404.gif" /></div></li></ol>








<p>
<a id="pgfId-1318819"></a>Jitter is displayed in the marker.</p>

<p>
<a id="pgfId-1318713"></a></p>
<div class="webflare-div-image">
<img width="665" height="441" src="images/Chap4-405.gif" /></div>
<h4>
<a id="pgfId-1318880"></a>Sampled Phase mode</h4>

<p>
<a id="pgfId-1139565"></a>This is used to measure the output noise voltage at several timepoints in the pss waveform. First set up the PSS Choosing Analyses form and plot the waveform for the desired net.</p>
<p>
<a id="pgfId-1139570"></a>Position the markers at interesting timepoints, as shown below.</p>
<p>
<a id="pgfId-1139571"></a>To plot this waveform, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer.</p>
<ol><li>
<a id="pgfId-1139573"></a>Select <em>pss</em> from the Analysis section.</li><li>
<a id="pgfId-1139574"></a>Select <em>time</em> from the Sweep section.</li><li>
<a id="pgfId-1139575"></a>Select the desired net from the schematic.</li><li>
<a id="pgfId-1139576"></a>Move your mouse cursor to the point in the waveform where you want a marker, and type <code>m</code>.</li><li>
<a id="pgfId-1139577"></a>You can move the markers by moving to the dot that highlights the position of the marker on the trace, click and hold the mouse button, move to the desired location, and release the mouse button.<br />
<a id="pgfId-1148999"></a><div class="webflare-div-image">
<img width="668" height="424" src="images/Chap4-406.gif" /></div></li></ol>








<p>
<a id="pgfId-1149004"></a>On the pnoise <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1149005"></a>Set the <em>Sweeptype</em> to <em>default</em>.</li><li>
<a id="pgfId-1139588"></a>Set the <em>Stop</em> frequency to one half the PSS frequency.</li><li>
<a id="pgfId-1139589"></a>Set the <em>Start</em> frequency 4 decades below the <em>Stop</em> frequency.</li><li>
<a id="pgfId-1139590"></a>Select <em>Sweep Type</em> as <em>Logarithimic</em>.</li><li>
<a id="pgfId-1332413"></a>Select <em>Points per Decade</em> and specify about 5 points per decade.</li><li>
<a id="pgfId-1319467"></a>Select <em>Sampled Phase</em> for Timing Event.</li><li>
<a id="pgfId-1319495"></a>Select the net of interest.</li><li>
<a id="pgfId-1139595"></a> Type 1 in the <em>Samples Per Period</em> field. The default in sampled phase mode is to run a pnoise analysis at every timepoint in the pss analysis. Because noise is usually only required at several timepoints, setting the number of points to 1 causes a single point at the first timepoint in the pss analysis to be run in pnoise. </li><li>
<a id="pgfId-1139597"></a>Select the <em>Add Specific Points</em> check box and enter the time values from the markers positioned in the waveform. Use the space character to separate the entries.</li><li>
<a id="pgfId-1332021"></a>Click <em>OK</em> and run the simulation.<br />
<a id="pgfId-1332190"></a><br /><div class="webflare-div-image">
<img width="654" height="820" src="images/Chap4-407.gif" /></div></li></ol>













<p>
<a id="pgfId-1139599"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>.</p>
<p>
<a id="pgfId-1332141"></a>On the Direct Plot Form:</p>
<ol><li>
<a id="pgfId-1139600"></a>Select <em>pnoise sampled</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1139605"></a>Select <em>Integ Output Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1139606"></a>Select <em>Add to Outputs</em>.</li><li>
<a id="pgfId-1139607"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1332691"></a><br /><div class="webflare-div-image">
<img width="668" height="554" src="images/Chap4-408.gif" /></div>
<a id="pgfId-1139608"></a>The noise voltage is plotted as shown below. As expected, the maximum noise occurs near the 1.65 volt level of the waveform. This is shown in the right subwindow below.<br />
<a id="pgfId-1139612"></a><div class="webflare-div-image">
<img width="668" height="425" src="images/Chap4-409.gif" /></div>
<a id="pgfId-1320006"></a>To pull the noise waveform into the left subwindow, right-click on the X axis of the left subwindow and select <em>Allow Any Units</em> from the context menu.<br />
<a id="pgfId-1320153"></a><div class="webflare-div-image">
<img width="633" height="409" src="images/Chap4-410.gif" /></div><ul><li>
<a id="pgfId-1320168"></a>Drag the noise waveform into the left subwindow.</li><li>
<a id="pgfId-1320227"></a>Delete the right subwindow.</li><li>
<a id="pgfId-1320262"></a>Click the <em>Split all strips</em> icon.</li></ul><br />
<a id="pgfId-1320302"></a>Now you can see the noise voltage at different times of the edge.<br />
<a id="pgfId-1333026"></a><div class="webflare-div-image">
<img width="632" height="411" src="images/Chap4-411.gif" /></div></li></ol>
























<h2>
<a id="pgfId-1139629"></a><a id="11391"></a>Oscillators</h2>
<h4>
<a id="pgfId-1139630"></a>Noise Type = timeaverage</h4>

<p>
<a id="pgfId-1139631"></a>Noise type=timeaverage is used to measure the single sideband phase noise that is averaged over the entire cycle of the oscillator waveform.</p>
<ol><li>
<a id="pgfId-1139632"></a>First, set up the pss form as shown in the following figure. For more information see the pss section at the beginning of this chapter of the user guide.<br />
<a id="pgfId-1139636"></a><div class="webflare-div-image">
<img width="668" height="781" src="images/Chap4-412.gif" /></div></li><li>
<a id="pgfId-1139637"></a>Next, set up the pnoise form as shown below. For the oscillator, you may need to change the start and stop frequencies and the output node. Select <em>Timeaverage</em> from the <em>Noise Type</em> drop-down list to measure the average noise of the oscillator.<br />
<a id="pgfId-1139641"></a><div class="webflare-div-image">
<img width="666" height="761" src="images/Chap4-413.gif" /></div></li></ol>









<p>
<a id="pgfId-1149735"></a>The sweep defaults to relative to the frequency of the specified harmonic of the pss analysis. The frequencies specified in the <em>Choosing Analyses</em> form are added to the frequency of the specified harmonic when <em>relative</em> is selected. In this case, the first harmonic is specified because there is no frequency multiplier on the output of the oscillator.</p>
<ol><li>
<a id="pgfId-1139643"></a>Set the relative harmonic number. For an oscillator by itself, the relative harmonic is one. For an oscillator with a prescaler and you desire the output of the prescaler, the harmonic number is one. If you want the noise of the VCO without the prescaler, then the harmonic number is the divide ratio. If you have an oscillator with a frequency multiplier and you want the noise at the output of the frequency multiplier, enter the frequency multiplication ratio. If you want the noise at the output of the VCO by itself, enter one.</li><li>
<a id="pgfId-1139644"></a>Relative to the output frequency, specify a frequency offset.</li><li>
<a id="pgfId-1139645"></a>Generally, three to five points per decade in a log sweep are sufficient.</li><li>
<a id="pgfId-1139646"></a>Setting sidebands depends on whether shooting or harmonic balance has been chosen as the pss engine. <ol><li>
<a id="pgfId-1139647"></a> When harmonic balance is selected, leave the maximum sideband field blank, which causes the noise translations for all the pss harmonics to be calculated. Fullspectrum is not available for harmonic balance. Experiment with the number of harmonics and oversamplefactor to find the most efficient pss-pnoise runtime. <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a> for more information on setting harmonics.</li><li>
<a id="pgfId-1139648"></a>When shooting is the pss engine, fullspectrum is available and recommended. Fullspectrum calculates the number of noise translations to include based on the maximum timestep in the pss analysis. By default, frequency translations through the 20th harmonic are taken into account by fullspectrum pnoise. In the unusual case where the noise calculation needs to go through a very high harmonic of the pss analysis, increase the number of harmonics in the pss form to the minimum number of harmonics that causes the noise result to not change with a larger number of pss harmonics. Generally speaking, these will be switched-capacitor circuits or sampling circuits where aliasing can go through a very high harmonic of the clock. Fullspectrum on this type of circuit will run much faster than the default pnoise simulation. The larger the number of sidebands, the larger the speed differential.</li></ol></li><li>
<a id="pgfId-1278151"></a>Note that when <em>fullspectrum</em> pnoise is chosen, APS will be enabled in ADE Explorer. Full-spectrum will only be run in APS. It is not available in standard Spectre. APS requires additional tokens or different licensing to run compared to standard Spectre.</li><li>
<a id="pgfId-1278155"></a>Set <em>Output</em> to <em>voltage</em>.</li><li>
<a id="pgfId-1139654"></a>Select the output node.</li><li>
<a id="pgfId-1139655"></a>Set <em>Input Sources</em> to <em>none</em>. Input-referred noise is not defined for an oscillator.</li><li>
<a id="pgfId-1139656"></a>If you want noise separation, you must first select <em>default </em>for <em>Method </em>and set an appropriate number of sidebands in the <em>Maximum sideband </em>field. Then you can select the noise separation. Noise separation allows plotting of where specifically the noise is coming from.</li><li>
<a id="pgfId-1278168"></a>Run the simulation. </li></ol>











<p>
<a id="pgfId-1278169"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1278170"></a>On the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1139660"></a>Select <em>pnoise</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1139665"></a>Select <em>Output Noise</em> from the <em>Function</em> section.</li><li>
<a id="pgfId-1321243"></a>Select dBc/Hz from the Units section.</li><li>
<a id="pgfId-1321288"></a>Select SSB or DSB for single sideband or double sideband respectively.</li><li>
<a id="pgfId-1321372"></a>If desired, type a list of frequencies separated by a space if you have phase noise specs at defined offset frequencies.</li><li>
<a id="pgfId-1321511"></a>If you want expressions in ADE so that this setup will plot automatically after each simulation, click the <em>Add To Outputs</em> check box.</li><li>
<a id="pgfId-1139667"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1333337"></a><div class="webflare-div-image">
<img width="668" height="659" src="images/Chap4-414.gif" /></div></li></ol>










<p>
<a id="pgfId-1333267"></a>Phase noise is plotted in the waveform tool, as shown below.</p>
<p>
<a id="pgfId-1333630"></a></p>

<div class="webflare-div-image">
<img width="668" height="498" src="images/Chap4-415.gif" /></div>
<h4>
<a id="pgfId-1139673"></a>Noise Separation</h4>

<p>
<a id="pgfId-1139674"></a>One of the benefits of simulation is that since the noise terms are all calculated individually, we can store the data in a way to make these individual calculations available for viewing. To see the different noise separations, select <em>yes</em> for <em>Noise Separation</em> in the pnoise <em>Choosing Analyses</em> form. </p>
<p>
<a id="pgfId-1139675"></a>The default in pnoise is to calculate all the noise translations that are specified in the <em>Maximum sideband</em> property in the <em>Choosing Analyses</em> form, add all these contributions at the output, and display that total noise term. Enabling noise separation allows you to see which components and/or which frequencies contribute the most noise at the output. Once you know where the noise is coming from, you can design a solution to the problem.</p>
<p>
<a id="pgfId-1139676"></a>Noise separation is available for shooting and harmonic balance, but not for full spectrum shooting pnoise.</p>

<p>
<a id="pgfId-1149979"></a></p>
<div class="webflare-div-image">
<img width="401" height="762" src="images/Chap4-416.gif" /></div>

<p>
<a id="pgfId-1149980"></a>When the choice is made and the simulation is run, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer.</p>

<h4><em>
<a id="pgfId-1139682"></a>Viewing the total noise at the output from each sideband</em></h4>

<p>
<a id="pgfId-1139683"></a>This allows the measurement of the noise at the output from the individual noise input frequencies in the circuit.</p>
<p>
<a id="pgfId-1139684"></a>When noise separation is set to <em>yes</em> in the pnoise <em>Choosing Analyses</em> form, you can also plot subsets of the total noise in order to identify where the noise is coming from. In the <em>Direct Plot Form</em>, select the <em>pnoise separation</em> result set.</p>

<p>
<a id="pgfId-1139689"></a></p>
<div class="webflare-div-image">
<img width="508" height="621" src="images/Chap4-417.gif" /></div>

<p>
<a id="pgfId-1139691"></a>To view the total noise from mixing with different pss harmonics:</p>
<ol><li>
<a id="pgfId-1139692"></a>Select <em>Sideband Output</em>.<br />
<a id="pgfId-1139693"></a>Remember that the zero sideband means that the noise input is the same frequency as the noise output. Selecting the -1 sideband means that the noise that is below the output frequency that mixes with the first harmonic is plotted. -2 means that the noise frequency is below the noise output frequency, and it mixes with the second harmonic of the pss analysis. +1 means that the noise frequency is above the noise output frequency, and mixes with the first harmonic of the pss analysis.<br />
<a id="pgfId-1139694"></a>Example:<br />
<a id="pgfId-1139695"></a>In this case, the PSS frequency is 1.9G. In the pnoise form, <em>relative</em> is selected, and the relative harmonic number is 1. This means that the output noise just above the first harmonic frequency is being analyzed. When the noise output frequency is 1MHz, the zero sideband is 1MHz above the first harmonic of the pss analysis. The -1 sideband is (-1 * 1.9GHz) + 1MHz + 1.9GHz), or 1MHz. The +1 sideband is at (+1 * 1.9G) + 1MHz + 1.9GHz, or 3.801GHz.</li><li>
<a id="pgfId-1139696"></a>Select <em>V / sqrt(Hz)</em> or <em>V** 2 / Hz</em>.</li><li>
<a id="pgfId-1139697"></a>Select <em>Magnitude</em> or <em>dB20</em> in the <em>Modifier</em> section.</li><li>
<a id="pgfId-1139698"></a>Select one or more sidebands from the <em>Direct Plot Form</em>.</li><li>
<a id="pgfId-1139699"></a>Click <em>Plot</em>. The results display in the waveform tool. A vertical marker has been placed so the individual results at 1MHz can be read out.<br />
<a id="pgfId-1150801"></a><div class="webflare-div-image">
<img width="641" height="467" src="images/Chap4-418.gif" /></div></li><li>
<a id="pgfId-1139703"></a>To see the individual contributions, select the legend at the upper left for the sideband number you want to see. To see the noise at the output with no frequency translation, select the zero sideband as shown below. The legend and the curve will highlight.<br />
<a id="pgfId-1150848"></a><div class="webflare-div-image">
<img width="641" height="430" src="images/Chap4-419.gif" /></div></li><li>
<a id="pgfId-1139708"></a>To see the noise that is upconverted from near zero frequency, select the -1 sideband. Selecting the -1 sideband means that the noise frequency is one times the pss frequency (the oscillator frequency) below the noise output frequency. This includes the 1/F noise that upconverts to the output.<br />
<a id="pgfId-1150878"></a><div class="webflare-div-image">
<img width="607" height="429" src="images/Chap4-420.gif" /></div></li><li>
<a id="pgfId-1139713"></a>To see the noise that appears by mixing with the second harmonic, select the -2 sideband.<br />
<a id="pgfId-1150914"></a><div class="webflare-div-image">
<img width="605" height="427" src="images/Chap4-421.gif" /></div></li><li>
<a id="pgfId-1139722"></a>To see the noise converted by mixing with the third harmonic, select the -3 sideband.<br />
<a id="pgfId-1150941"></a><div class="webflare-div-image">
<img width="602" height="426" src="images/Chap4-422.gif" /></div></li></ol>






























<h4><em>
<a id="pgfId-1139723"></a>Viewing the total noise at the output for all the noise mechanisms in each noise device for one noise sideband</em></h4>

<p>
<a id="pgfId-1139724"></a>This capability allows you to plot the total noise from each device at each separate input frequency. This gives you an idea of not only the frequencies that are troublesome, but also the specific devices that are troublesome.</p>
<ol><li>
<a id="pgfId-1139729"></a>Select Instance Output.<br />
<a id="pgfId-1151011"></a><div class="webflare-div-image">
<img width="608" height="756" src="images/Chap4-423.gif" /></div></li><li>
<a id="pgfId-1139730"></a>Select <em>V / sqrt(Hz)</em> or <em>V**2 / Hz</em>.</li><li>
<a id="pgfId-1139731"></a>Select linear <em>Magnitude</em>, or <em>dB20</em>.</li><li>
<a id="pgfId-1139732"></a>Select only one noise sideband.</li><li>
<a id="pgfId-1139733"></a>To plot the noise from all the different device types, select<em> Include All Types</em>.</li><li>
<a id="pgfId-1139734"></a>To make individual selections, choose each individual device type in the list. To select more than one device type at a time, press and hold the &lt;Ctrl&gt; key while you choose an additional category.</li><li>
<a id="pgfId-1139735"></a>To include only the devices you select from the schematic included, select I<em>nclude None</em>, and click the <em>Select</em> button to the right of <em>Include Inst</em>. Now select the instances you want to include from the schematic. As you select the instances, the instance name will appear in the list. Select to the right of <em>Include inst</em>. Now select the instances you want in the schematic. As you click the instances, the instance Name will appear in the list.</li><li>
<a id="pgfId-1139736"></a>In the Truncate field, type in the number of traces you want to view. The instances with the largest noise contributions will be plotted.<br />
<a id="pgfId-1151359"></a><div class="webflare-div-image">
<img width="617" height="376" src="images/Chap4-424.gif" /></div></li></ol>















<p>
<a id="pgfId-1139741"></a>The highlighted trace above is a plot of all the noise contributors in <em>Q0</em> at the output of the circuit.</p>

<h4><em>
<a id="pgfId-1139742"></a>To plot the individual noise contributors form each instance from a single noise sideband</em></h4>

<p>
<a id="pgfId-1139743"></a>This plot splits the noise into each specific noise generator at each individual noise input frequency.</p>
<ol><li>
<a id="pgfId-1139748"></a>Select Source Output.<br />
<a id="pgfId-1151451"></a><div class="webflare-div-image">
<img width="605" height="765" src="images/Chap4-425.gif" /></div></li><li>
<a id="pgfId-1139749"></a>Select <em>V / sqrt(Hz)</em> or <em>V**2 / Hz</em>.</li><li>
<a id="pgfId-1139750"></a>Select linear <em>Magnitude</em>, or <em>dB20</em>.</li><li>
<a id="pgfId-1139751"></a>Select only one noise sideband.</li><li>
<a id="pgfId-1139752"></a>To plot the noise from all the different device types, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1139753"></a>To make individual selections, choose each individual device type in the list. To select more than one device type at a time, press and hold the &lt;Ctrl&gt; key while you choose an additional category.</li><li>
<a id="pgfId-1139754"></a>To include only the devices you select from the schematic included, select <em>Include None</em>, and click the <em>Select</em> button to the right of <em>Include Inst</em>. Now select the instances you want to include from the schematic. As you select the instances, the instance name will appear in the list. Select to the right of <em>Include inst</em>. Now select the instances you want in the schematic. As you click the instances, the instance Name will appear in the list.</li><li>
<a id="pgfId-1139755"></a>In the Truncate field, type in the number of traces you want to view. The instances with the largest noise contributions will be plotted.<br />
<a id="pgfId-1151634"></a><div class="webflare-div-image">
<img width="608" height="392" src="images/Chap4-426.gif" /></div></li></ol>















<p>
<a id="pgfId-1139760"></a>The instance name and the noise parameter are displayed in the waveform tool. See the red square in the above figure. For a table of the noise parameters, see <a href="Chap4.html#10582">Noise Summary</a>.</p>

<h4><em>
<a id="pgfId-1139761"></a>Viewing the total noise current from each instance at the source of the noise</em></h4>

<p>
<a id="pgfId-1151687"></a>Instance source changes the focus from the output to the noise source itself, and plots the actual noise currents at the source for each individual noise frequency. All the noise from all the individual noise sources combined for each device is available.</p>
<ol><li>
<a id="pgfId-1151688"></a>In the <em>Direct Plot Form</em>, select <em>Instance Source</em>.<br />
<a id="pgfId-1151693"></a><div class="webflare-div-image">
<img width="410" height="768" src="images/Chap4-427.gif" /></div></li><li>
<a id="pgfId-1139768"></a>Select <em>V / sqrt(Hz)</em> or <em>V**2 / Hz</em>.</li><li>
<a id="pgfId-1139769"></a>Select linear <em>Magnitude</em>, or <em>dB20</em>.</li><li>
<a id="pgfId-1139770"></a>Select only one noise sideband.</li><li>
<a id="pgfId-1139771"></a>To plot the noise from all the different device types, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1139772"></a>To make individual selections, choose each individual device type in the list. To select more than one device type at a time, press and hold the Control key while you choose an additional category.</li><li>
<a id="pgfId-1139773"></a>To include only the devices you select from the schematic included, select <em>Include None</em>, and click the <em>Select</em> button to the right of <em>Include Inst</em>. Now select the instances you want to include from the schematic. As you select the instances, the instance name will appear in the list. Select to the right of <em>Include inst</em>. Now select the instances you want in the schematic. As you click the instances, the instance Name will appear in the list.</li><li>
<a id="pgfId-1279204"></a>In the <em>Truncate</em> field, type in the number of traces you want to view. The instances with the largest noise contributions will be plotted. The total noise from all sources in Q0 at 1MHz offset is about -201 picoAmps per root hertz.<br />
<a id="pgfId-1279207"></a><div class="webflare-div-image">
<img width="593" height="338" src="images/Chap4-428.gif" /></div></li></ol>














<h4><em>
<a id="pgfId-1279208"></a>Viewing the individual noise current from each noise source within each instance at the source of the noise</em></h4>

<p>
<a id="pgfId-1139780"></a>This splits out the individual noise currents at the source for each individual noise source in the circuit.</p>
<ol><li>
<a id="pgfId-1139785"></a>In the <em>Direct Plot Form</em>, select <em>Primary Source</em>.<br />
<a id="pgfId-1151859"></a><div class="webflare-div-image">
<img width="397" height="768" src="images/Chap4-429.gif" /></div></li><li>
<a id="pgfId-1139786"></a>Select <em>V / sqrt(Hz)</em> or <em>V**2 / Hz</em>.</li><li>
<a id="pgfId-1139787"></a>Select linear <em>Magnitude</em>, or <em>dB20</em>.</li><li>
<a id="pgfId-1139788"></a>Select only one noise sideband.</li><li>
<a id="pgfId-1139789"></a>To plot the noise from all the different device types, select<em> Include All Types</em>.</li><li>
<a id="pgfId-1139790"></a>To make individual selections, choose each individual device type in the list. To select more than one device type at a time, press and hold the Control key while you choose an additional category.</li><li>
<a id="pgfId-1139791"></a>To include only the devices you select from the schematic included, select <em>Include None</em>, and click the <em>Select</em> button to the right of Include Inst. Now select the instances you want to include from the schematic. As you select the instances, the instance name will appear in the list. Select to the right of <em>Include inst</em>. Now select the instances you want in the schematic. As you click the instances, the instance Name will appear in the list.</li><li>
<a id="pgfId-1139792"></a>In the <em>Truncate</em> field, type in the number of traces you want to view. The instances with the largest noise contributions will be plotted. The individual noise from all the different sources in Q0 at 1MHz offset is shown below. To compare the noise with the total noise shown in the previous section, add the noise power (not the voltage) from the individual noise sources by taking the square root of the sum of the squares.<br />
<a id="pgfId-1152234"></a><div class="webflare-div-image">
<img width="601" height="390" src="images/Chap4-430.gif" /></div></li></ol>














<h4><em>
<a id="pgfId-1139796"></a>Viewing the transfer function from the individual sources of the noise to the output of the circuit</em></h4>

<ol><li>
<a id="pgfId-1139801"></a>In the <em>Direct Plot Form</em>, select <em>Src Noise Gain</em>.<br />
<a id="pgfId-1152295"></a><div class="webflare-div-image">
<img width="364" height="768" src="images/Chap4-431.gif" /></div></li><li>
<a id="pgfId-1139802"></a>Select <em>V / sqrt(Hz)</em> or <em>V**2 / Hz</em>.</li><li>
<a id="pgfId-1139803"></a>Select linear <em>Magnitude</em>, or <em>dB20</em>.</li><li>
<a id="pgfId-1139804"></a>Select only one noise sideband.</li><li>
<a id="pgfId-1139805"></a>To plot the noise from all the different device types, select <em>Include All Types</em>.</li><li>
<a id="pgfId-1139806"></a>To make individual selections, choose each individual device type in the list. To select more than one device type at a time, press and hold the Control key while you choose an additional category.</li><li>
<a id="pgfId-1139807"></a>To include only the devices you select from the schematic included, select <em>Include None</em>, and click the <em>Select</em> button to the right of <em>Include Inst</em>. Now select the instances you want to include from the schematic. As you select the instances, the instance name will appear in the list. Select to the right of <em>Include inst</em>. Now select the instances you want in the schematic. As you click the instances, the instance Name will appear in the list.</li><li>
<a id="pgfId-1152459"></a>In the <em>Truncate</em> field, type in the number of traces you want to view. The instances with the largest noise contributions will be plotted. The gain from all the noise sources to the output is plotted. Only the noise sources from Q0 are visible. For a table that lists the noise parameter for each device type, please see page 123 (77 of 234) of this document.<br />
<a id="pgfId-1152447"></a><div class="webflare-div-image">
<img width="606" height="397" src="images/Chap4-432.gif" /></div></li></ol>














<h4>
<a id="pgfId-1139817"></a>Commonly Used Pnoise Options</h4>
<p>
<a id="pgfId-1152537"></a></p>
<div class="webflare-div-image">
<img width="668" height="677" src="images/Chap4-433.gif" /></div>

<p>
<a id="pgfId-1152567"></a><bold>
TD Noise Algorithm Version=dts
: is the default and is required for most oscillators that have long time constants, perhaps from a Low Drop-Out (LDO) regulator. Either take the default or set <em>TD Noise Algorithm Version</em> to <em>dts</em> for every circuit.</bold></p>

<h4><em>
<a id="pgfId-1152568"></a>Lorentzian</em></h4>

<p>
<a id="pgfId-1152569"></a>There are two ways of looking at phase noise. One way is to think of measuring the spectral output of the oscillator with a network analyzer. In this case, as the frequency gets close to the oscillator frequency, the amplitude starts going up, levels off, and then drops as the oscillator frequency is passed. In this case, the noise cannot be larger than the oscillations themselves, which is 0 dBc. If this is how you view phase noise, set the <em>lorentzian</em> option to <em>yes</em>.</p>
<p>
<a id="pgfId-1139827"></a>If you think in terms of jitter, in one cycle of the oscillator output, because of the noise, you can calculate one standard deviation of the timing. If you go two cycles, and you integrate the noise with respect to time, you get twice as much noise power, or about 1.4 times the noise voltage or jitter. When you get to an infinite number of oscillator cycles, the jitter also becomes infinite. As you increase the time, you are lowering the noise frequency, and in this case, as the time becomes large, the frequency becomes very low. At infinite time, you get infinite jitter, and this occurs at zero offset from the carrier. Jitter is just another way of looking at phase noise. In other words, the phase noise can easily exceed the carrier amplitude (0 dBc) as the offset frequency becomes small because it is heading to infinity at zero frequency offset. If this is how you view phase noise, set the <em>lorentzian</em> option to <em>no</em>.</p>
<p>
<a id="pgfId-1139828"></a>lorentzian=yes means calculate the leveling off. lorentzian=cornerfreqonly calculates the continuously rising phase noise, but it places a marker on the phase noise curve at the frequency where the phase noise would level off. <em>no</em> causes the phase noise to continue to rise as the offset frequency approaches zero.</p>

<h4><em>
<a id="pgfId-1139830"></a>Comparison Between Lorentzian Yes and No </em></h4>

<p>
<a id="pgfId-1139831"></a>As noted above, lorentzian causes leveling off of the phase noise at low frequency.</p>
<p>
<a id="pgfId-1139832"></a>Note that when <em>lorentzian=no</em>, the phase noise curve goes above 0 dBc. This would mean that the noise is larger than the amplitude of the oscillator, which is not physical. This is because pnoise is a small-signal analysis that does not recognize the large-signal limits of the circuit like clipping. It is similar to AC where you can specify an input magnitude of 1 megavolt, and see 10 megavolts on the output.</p>

<p>
<a id="pgfId-1139836"></a></p>
<div class="webflare-div-image">
<img width="668" height="427" src="images/Chap4-434.gif" /></div>

<p>
<a id="pgfId-1139843"></a>or more information regarding the other pnoise options, refer to the <a href="Chap4.html#63741">Commonly Used Pnoise Options</a>.</p>
<p class="webflare-indent1">
<a id="pgfId-1139848"></a></p>
<p>
<a id="pgfId-1246752"></a>To plot cycle jitter or cycle-to-cycle jitter</p>
<ol><li>
<a id="pgfId-1139900"></a>On the<em> Direct Plot Form</em>, select <em>pnoise </em>jitter from the <em>Analysis</em> section.<br />
<a id="pgfId-1139906"></a><div class="webflare-div-image">
<img width="668" height="593" src="images/Chap4-435.gif" /></div></li><li>
<a id="pgfId-1139907"></a>Select <em>Jc</em> or <em>Jcc</em> from the <em>Function</em> section.<br />
<a id="pgfId-1139908"></a>The frequency range will default to the range set in the <em>Choose Analyses</em> form.</li><li>
<a id="pgfId-1139909"></a>Click <em>Plot</em>.<br />
<a id="pgfId-1139910"></a>The jc or jcc calculation is shown as a label that is added to the waveform tool.<br />
<a id="pgfId-1139915"></a><div class="webflare-div-image">
<img width="668" height="449" src="images/Chap4-436.gif" /></div></li></ol>











<h4>
<a id="pgfId-1139921"></a>Noise Type=sampled(jitter) </h4>

<p>
<a id="pgfId-1139922"></a>This analysis gives an instantaneous measurement of jitter at a threshold voltage on the timedomain waveform. This is useful for measuring the jitter of an oscillator that is driving a digital component.</p>
<ol><li>
<a id="pgfId-1139923"></a>First, set up the pss analysis. For more information on this, see <a href="Chap4.html#12426">Overview of Periodic Steady-State (pss) Analysis</a>.<br />
<a id="pgfId-1139927"></a><div class="webflare-div-image">
<img width="668" height="784" src="images/Chap4-437.gif" /></div></li><li>
<a id="pgfId-1139928"></a>Next, set up the pnoise <em>Choosing Analyses</em> form, as shown below. <br />
<a id="pgfId-1139932"></a><div class="webflare-div-image">
<img width="668" height="805" src="images/Chap4-438.gif" /></div>
<a id="pgfId-1139933"></a>On the pnoise <em>Choosing Analyses</em> form:<ul><li>
<a id="pgfId-1139934"></a>Select <em>sampled(jitter)</em> from the <em>Noise Type</em> drop-down list.</li><li>
<a id="pgfId-1322574"></a>Select <em>Edge Crossing</em>.</li><li>
<a id="pgfId-1139936"></a>Specify a threshold voltage for the time-domain waveform in the <em>Threshold Value</em> field.</li><li>
<a id="pgfId-1139937"></a>Specify a crossing direction. </li><li>
<a id="pgfId-1139938"></a>The stop frequency should be very close to half the oscillator frequency. </li><li>
<a id="pgfId-1139939"></a>The start frequency should be approximately the frequency where the phase noise reaches 0 dBc.<br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1324010"></a>Edge Delay and Sampled Phase modes have very limited value for oscillators. As a result, these modes are not documented in this section.</div></li></ul></li><li>
<a id="pgfId-1139940"></a>Run the simulation.</li></ol>




















<p>
<a id="pgfId-1334057"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1334224"></a>On the Direct Plot Form:</p>
<ol><li>
<a id="pgfId-1139942"></a>Select <em>pnoise sampled</em> from the Analysis section.</li><li>
<a id="pgfId-1322859"></a>Select <em>Edge Phase Noise</em> from the Function section.</li><li>
<a id="pgfId-1322891"></a>If desired, select <em>Add To Outputs</em>.</li><li>
<a id="pgfId-1322933"></a>Click <em>Plot</em>.</li></ol>



<p>
<a id="pgfId-1334485"></a></p>

<div class="webflare-div-image">
<img width="423" height="468" src="images/Chap4-439.gif" /></div>

<p>
<a id="pgfId-1334310"></a>The edge phase noise is plotted in the waveform tool, as shown below.</p>

<p>
<a id="pgfId-1334575"></a></p>
<div class="webflare-div-image">
<img width="640" height="529" src="images/Chap4-440.gif" /></div>

<p>
<a id="pgfId-1322981"></a>This plot will agree with timeaverage mode single sideband results except for small differences at large offset frequencies.</p>
<p>
<a id="pgfId-1139947"></a>Now plot the cycle jitter (Jc) or the cycle-to-cycle jitter.</p>
<ol><li>
<a id="pgfId-1323370"></a>Select <em>Jc</em> or <em>Jcc</em> from the Function section.</li><li>
<a id="pgfId-1323395"></a>Set the frequency range to agree with the pnoise setup.</li></ol>

<p>
<a id="pgfId-1334692"></a></p>

<div class="webflare-div-image">
<img width="668" height="746" src="images/Chap4-441.gif" /></div>

<ol><li>
<a id="pgfId-1323458"></a>Click <em>Add To Outputs</em>. </li></ol>
<p>
<a id="pgfId-1334797"></a>This will enter an expression into ADE that will evaluate with the cycle or cycle-to-cycle jitter in the ADE outputs section.</p>

<p>
<a id="pgfId-1323615"></a></p>
<div class="webflare-div-image">
<img width="665" height="401" src="images/Chap4-442.gif" /></div>
<h2>
<a id="pgfId-1157413"></a><a id="65248"></a><a id="11860"></a>Periodic Trans<a id="marker-1157412"></a>fer Function A<a id="pxf"></a>nalysis (PXF)</h2>
<h3>
<a id="pgfId-1180049"></a>Small-signal Versus Large-Signal Analysis for Conversion Gain</h3>

<p>
<a id="pgfId-1180050"></a>One way to measure conversion gain is to apply the LO and the RF signals in harmonic balance (hb) or quasi-periodic steady-state (qpss) analysis and calculate the full large-signal response at each RF input frequency, and then plot the output as a function of the sweep frequency. While this works, because all the large-signal effects and many harmonics are calculated, the required time for the simulation can be significant.</p>
<p>
<a id="pgfId-1180051"></a>The alternative is to use a small-signal approach similar to the xf analysis. The xf analysis runs considerably faster than running the transient at multiple frequencies because it ignores the large-signal effects. In circuits with frequency translation, the xf analysis is unusable because the calculation is a linear calculation based on the DC bias point. In pxf analysis, instead of using the DC bias point, the pss solution with just the LO is used as the basis of the calculation. The large-signal analysis calculates the harmonics of the single input that causes the frequency translation to occur, (usually the LO signal or sample clock) and then pxf is run after the pss analysis to calculate the conversion gain. The conversion gain is calculated based on the nonlinearity in the pss solution. The overall time savings can be very significant.</p>
<p>
<a id="pgfId-1182961"></a>In pac, we apply the LO signal (or the sample clock) in the pss analysis, and then drive the input with the small-signal pac analysis and measure the mixing products that come out. While this is very intuitive, the output display can be very confusing to read when the conversion gain near several pss harmonics is desired. Pxf changes the focus to the output. One output frequency at a time is considered. Pxf is a two step process. First, the input frequencies that cause the output frequency are calculated. For example, imagine a system with a 1GHz LO signal, and a 1MHz output signal. In PXF, we specify 1MHz as the output frequency. In this system, inputs at 1MHz, 999MHz, 1001MHz, 1999MHz, 2001MHz, and so on will cause 1MHz to be produced at the output. Next, the forward conversion gain from all those input frequencies is calculated. Since the input frequencies are different, the conversion gain is different for every input frequency. Using pxf, you can measure the conversion gain near a number of LO harmonics (or clock harmonics) at the same time.</p>

<h3>
<a id="pgfId-1180053"></a>Example: Conversion Gain (Down conversion)</h3>

<p>
<a id="pgfId-1180054"></a>Consider the double-balanced diode mixer shown below.</p>

<p>
<a id="pgfId-1180058"></a></p>
<div class="webflare-div-image">
<img width="617" height="482" src="images/Chap4-443.gif" /></div>

<p>
<a id="pgfId-1180059"></a>The RF input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. This allows changes in frequency or amplitude from the ADE Explorer environment without the need to change the schematic itself.</p>
<p>
<a id="pgfId-1180060"></a>The property list is shown below.</p>

<p>
<a id="pgfId-1180068"></a></p>
<div class="webflare-div-image">
<img width="668" height="694" src="images/Chap4-444.gif" /></div>

<p>
<a id="pgfId-1180069"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> - <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type in the desired value, and press <em>Enter</em>. When you have set the variables, if you want to add the values back into the cellview, in the ADE Explorer window, select <em>Variables</em> - <em>Copy To Cellview</em>, and then perform a <em>Check and Save</em> in the schematic.</p>
<p>
<a id="pgfId-1180070"></a>In this example, the LO frequency is 1GHz and its amplitude is 1.4 volts peak. This is +13 dBm, which is a common drive level for diode mixers. The design RF input frequency is 1.1GHz, but it is disabled because the amplitude is set to 0 (zero). Setting either the frequency or the amplitude to zero disables the production of that waveform from the port.</p>
<p>
<a id="pgfId-1180071"></a>The basic strategy is to apply the signal that causes the frequency translation in the pss analysis, and then measure the forward conversion gain using pxf analysis.</p>

<p>
<a id="pgfId-1180076"></a></p>
<div class="webflare-div-image">
<img width="668" height="404" src="images/Chap4-445.gif" /></div>

<p>
<a id="pgfId-1180077"></a>The pss analysis needs to be set up first. The example below shows a single input at 1GHz with 10 harmonics. For more information on setting up the pss analysis, see the pss section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1180082"></a></p>
<div class="webflare-div-image">
<img width="462" height="764" src="images/Chap4-446.gif" /></div>

<p>
<a id="pgfId-1180083"></a>Next, the pxf analysis needs to be set up. Like xf, the frequency range specified in the <em>Choosing Analyses</em> form is the output frequency range. <em>Maximum sideband</em> in this example is set to the number of harmonics in the pss analysis so that all the conversion gain terms from all the pss harmonics are present in the output of pxf.</p>

<p>
<a id="pgfId-1180088"></a></p>
<div class="webflare-div-image">
<img width="568" height="698" src="images/Chap4-447.gif" /></div>

<p>
<a id="pgfId-1180089"></a>Once the analyses are set up, the simulation can be run. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1180090"></a>The example below shows a typical <em>Direct Plot Form</em>.</p>

<p>
<a id="pgfId-1180095"></a></p>
<div class="webflare-div-image">
<img width="346" height="510" src="images/Chap4-448.gif" /></div>

<p>
<a id="pgfId-1180096"></a>The pxf <em>Direct Plot Form</em> is a bit non-intuitive. The <em>Choosing Analyses</em> form specifies the output frequency range and the output node. Pxf calculates the transfer functions from all the independent sources in the circuit to that output node. Therefore, to plot, you select the source in the circuit that you want the forward conversion transfer functions to be displayed. When the source in the schematic is selected, the waveform is displayed.</p>
<p>
<a id="pgfId-1180097"></a>Note that all the short line segments are the forward conversion gain from the selected source (the input source in this case) to the output. Because the sweep was a log sweep, the data is displayed on a log plot.</p>

<p>
<a id="pgfId-1183265"></a></p>
<div class="webflare-div-image">
<img width="683" height="420" src="images/Chap4-449.gif" /></div>

<p>
<a id="pgfId-1183266"></a>To make the plot more useful, set the X-Axis to linear. Move the mouse cursor over one of the numbers on the X Axis, click the right mouse button, and deselect <em>Log Scale</em>.</p>

<p>
<a id="pgfId-1180109"></a></p>
<div class="webflare-div-image">
<img width="683" height="416" src="images/Chap4-450.gif" /></div>

<p>
<a id="pgfId-1180110"></a>The LO frequency is 1GHz. To measure the conversion gain, go to the input frequency on the X Axis, and read the gain from the display. Note that the gain above and below 1GHz is just less than -5dB. The rectangle in red above shows where to look. The gain near 3GHz is just above -20dB. The green rectangle above show where to look. The gain near 5GHz is about negative 35dB. The gain near the even harmonics is quite small.</p>
<p>
<a id="pgfId-1180111"></a>Now position the markers at the desired input frequency for the conversion gain measurement. To do this, move the mouse cursor near the trace at the desired input frequency, and type <code>m</code>.</p>
<p>
<a id="pgfId-1180112"></a>As shown in the figure below, the conversion gain is about -6dB above and below the 1GHz LO frequency. This is very common for diode mixers.</p>

<p>
<a id="pgfId-1180116"></a></p>
<div class="webflare-div-image">
<img width="684" height="446" src="images/Chap4-451.gif" /></div>
<h3>
<a id="pgfId-1180117"></a>Example: Conversion Gain (Up Conversion)</h3>

<p>
<a id="pgfId-1180118"></a>The process is similar for an up-conversion mixer. In this case, the output frequency is just above the first harmonic of the pss analysis, as shown below.</p>

<p>
<a id="pgfId-1180123"></a></p>
<div class="webflare-div-image">
<img width="394" height="725" src="images/Chap4-452.gif" /></div>

<p>
<a id="pgfId-1180124"></a>The conversion gain plot is shown below. Note that the gain is very similar from near 0 Hz and near the image at just above 2GHz.</p>

<p>
<a id="pgfId-1180128"></a></p>
<div class="webflare-div-image">
<img width="683" height="441" src="images/Chap4-453.gif" /></div>
<h3>
<a id="pgfId-1180129"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1180130"></a>The primary application of pxf is to measure conversion gain. Pxf is a small-signal analysis. It calculates the small-signal conversion gain. If you need a large-signal measurement of conversion gain, then use a large-signal analysis like harmonic balance (hb) or quasi-periodic steady-state (qpss) analysis. Pxf measures gain in a way that requires some thought for most engineers who are accustomed to connecting an input, driving the system, and measuring what comes out. This is the idea of pac, where we capture the large-signal operating point in pss, and then drive a small-signal input, and measure the mixing products that are produced. If you think of this methodology, to measure the conversion gain around several harmonics usually requires a separate simulation near each harmonic.</p>
<p>
<a id="pgfId-1180131"></a>Pxf was created to allow the measurement of the conversion gain transfer functions near all the pss harmonics in the same simulation run. In pac, we have one input frequency at a time, and output mixing products at multiple output frequencies are calculated. In pxf, we focus on one output mixing product at a time, and measure the input frequencies that cause that output frequency, and measure the forward conversion gain from all those input frequencies to the single output frequency. Multiple output frequencies are usually analyzed in a pxf analysis. Unlike pac where the output can be seen at every node in the circuit, pxf calculates the gain only from all the independent sources in the circuit. Therefore, to measure a conversion gain, you select the source instance from the <em>Direct Plot Form</em> instead of selecting a net.</p>
<p>
<a id="pgfId-1180132"></a>For example, imagine a mixer with an LO frequency of 1GHz. Now, imagine the down conversion case where the output is 1MHz. Given the LO frequency, inputs at 1MHz, 999MHz, 1.001GHz, 1.999GHz, 2.001GHz, 2.999GHz, 3.01GHz, and so on cause an output at 1MHz. Depending on the circuit, all those different input to output paths have different gain from each input frequency to the output at 1MHz. In pxf, you specify the highest pss harmonic to calculate the transfer functions from in the maximum sideband field in the <em>Choosing Analyses</em> form. All these different input frequencies are called sidebands in pxf.</p>
<p>
<a id="pgfId-1180133"></a>Pxf has three different modes, which are set by the selection in the <em>Specialized Analysis</em> section of the <em>Choosing Analyses</em> form. <em>Specialized Analysis = None</em> measures the conversion gain that occurs given the nonlinearity created by large-signal in the circuit. <em>Timeaverage</em> allows the measurement of AM to PM conversion for circuits, and is useful for measuring the power supply ripple to output phase transfer function. <em>Sampled</em> is seldom used, and supplies a measurement of the instantaneous gain when the gain is repeatedly measured at a single phase (point in time) of the periodic large signal.</p>

<h4>
<a id="pgfId-1180135"></a>PXF used with Harmonic Balance PSS</h4>

<p>
<a id="pgfId-1180136"></a>When harmonic balance is used for the pss analysis, the harmonics of the circuit are calculated directly by the harmonic balance engine.</p>
<p>
<a id="pgfId-1180137"></a>Think of a perfectly linear circuit with a single output frequency to be analyzed. Because the circuit is perfectly linear, in the pss analysis when harmonic balance is used, the frequency domain solution only has the harmonic at the input frequency at every net in the circuit. No other harmonics are created because the system is perfectly linear. Because the circuit is linear, a gain function exists for the case where there is no frequency translation. Because the circuit is perfectly linear, no frequency translation can occur. Therefore, all the conversion gain terms have zero gain.</p>
<p>
<a id="pgfId-1180138"></a>Now imagine a real circuit with a single small input amplitude signal at 1GHz. In the frequency domain with harmonic balance selected in pss, 1GHz is present along with 2GHz, 3GHz and the other higher order harmonics. Because the input signal is small, the signals at the harmonics of 1GHz in pss are very small. If 100MHz is set as the output frequency, the conversion gain is small from 900MHz and 1.1GHz. Since the higher harmonics are even smaller than the amplitude of 1GHz, the conversion gain form 1.9 and 2.1HGHz along with the higher harmonics plus and minus 100MHz are also very small.</p>
<p>
<a id="pgfId-1180139"></a>The conversion gain might look like the figure below. Only the first three harmonics are shown. The black harmonics are the pss harmonics, and the red mixing products are pxf conversion gain measurements, which are called sidebands.</p>

<p>
<a id="pgfId-1180143"></a></p>
<div class="webflare-div-image">
<img width="668" height="414" src="images/Chap4-454.gif" /></div>

<p>
<a id="pgfId-1183712"></a>Now imagine that the 1GHz signal is larger. If the input goes up 10dB, the first harmonic goes up 10dB, In the frequency domain, if harmonic balance is selected in pss, the second harmonic would come up 20dB, the third harmonic would come up 30dB, and so on. If the conversion gain is calculated to 100MHz, the conversion gain is larger because all the harmonics have become larger. The circuit is more nonlinear. This is illustrated below. The black harmonics are the pss harmonics, and the red conversion gain calculations are pxf input frequencies with conversion gain measurements, which are called sidebands.</p>

<p>
<a id="pgfId-1183755"></a></p>
<div class="webflare-div-image">
<img width="668" height="414" src="images/Chap4-455.gif" /></div>
<h4>
<a id="pgfId-1183756"></a>Thus, the harmonic content from pss harmonic balance is a measure of the nonlinearity of the circuit, and forms the basis of the calculation for the conversion gain in pxf.</h4>
<h4>
<a id="pgfId-1180159"></a>PXF used with Shooting PSS</h4>

<p>
<a id="pgfId-1180160"></a>Shooting is a variation of the transient analysis where the individual timepoints are calculated, and the entire waveform is iterated to calculate the steady-state waveform. The transient algorithm works by using all the equations at all the nodes in the circuit where the assumption is made that the sum of the currents is zero at every node and at every timepoint. Ohm&#39;s law is observed, and the equations look like <code>I=V*G</code> where <code>G</code> is the conductance. In general, the matrix form of the equations is constructed, so the system of simultaneous equations becomes <code>[G]*[V]=[I]</code> where <code>[G]</code> is a square matrix, and <code>[V]</code> and <code>[I]</code> are column matrices. To solve for [<code>V]</code>, the <code>[G]</code> matrix is inverted and this matrix multiplies the <code>[I]</code> matrix to solve for all the voltages on all the nodes. At the end of the pss analysis, all the solution matrices are saved as data to be passed to the small-signal analyses. The result is that the conductance is calculated and saved for every nonlinear component in the circuit at every timepoint.</p>
<p>
<a id="pgfId-1180161"></a>For the following circuit:</p>

<p>
<a id="pgfId-1180165"></a></p>
<div class="webflare-div-image">
<img width="668" height="202" src="images/Chap4-456.gif" /></div>

<p>
<a id="pgfId-1180166"></a>Below is the I-versus-V curve with three different values for the input voltage. The center, positive peak of the input, and the negative peak of the input are shown. The input amplitude is small.</p>

<p>
<a id="pgfId-1180170"></a></p>
<div class="webflare-div-image">
<img width="668" height="444" src="images/Chap4-457.gif" /></div>

<p>
<a id="pgfId-1180171"></a>In the above figure, the amplitude of the 1 GHz signal causes small variations in the slope of the tangent of the nonlinear curve as the input signal is varied in amplitude. The slope is the conductance. Because the circuit has a nonlinear device, the conductance of the device varies slightly from timepoint to timepoint in the pss analysis. Because the input signal at 1.0GHz is small, the variation in conductance from timepoint to timepoint is small. The slope changes just a little bit as the input signal is moved over its range.</p>
<p>
<a id="pgfId-1180172"></a>Now imagine that the 1GHz signal is 10dB larger. A 10dB change is a linear factor of about 3.16. The larger amplitude of the input causes a larger portion of the nonlinear device curves to be traversed, and thus the variation in conductance becomes larger. The circuit becomes more nonlinear, and the conversion gain is larger. This is illustrated below.</p>

<p>
<a id="pgfId-1180176"></a></p>
<div class="webflare-div-image">
<img width="668" height="426" src="images/Chap4-458.gif" /></div>

<p>
<a id="pgfId-1180177"></a>Therefore, the variation in the conductance of the devices from timepoint to timepoint in PSS Shooting contains information about how strongly a circuit translates frequencies, and this is used by the pxf small-signal analysis to calculate the small-signal conversion gain.</p>

<h3>
<a id="pgfId-1180183"></a>Normal Conversion Gain Measurement (Specialized Analysis = None)</h3>

<p>
<a id="pgfId-1180184"></a>This mode is used to make a normal conversion gain measurement.</p>

<p>
<a id="pgfId-1180189"></a></p>
<div class="webflare-div-image">
<img width="668" height="400" src="images/Chap4-459.gif" /></div>

<p>
<a id="pgfId-1180190"></a>The figure above illustrates a down-conversion case where the output is just above zero Hz.</p>
<p>
<a id="pgfId-1180191"></a>In the figure above, the top spectrum in black represents the harmonics created by the pss large-signal analysis. The negative and positive frequencies are shown and the DC component is in the center. The colored arrows show the transfer functions from the different input frequencies to the output frequency that is shown on the bottom axis. Pxf takes the maximum sideband property from the pxf <em>Choosing Analyses</em> form, and calculates the specified sidebands, which are input to output conversion gain transfer functions. In this example, maximum sideband is set to three.</p>
<p>
<a id="pgfId-1180192"></a>The sideband numbers indicate which harmonic number is being mixed with for the transfer function calculation. Zero means that there is no frequency translation. One is the mixing product that occurs with an input frequency shift of +1 times the pss beat frequency. Mixing frequencies to the left have negative numbers because the input frequency that causes the output is more negative than the output frequency.</p>
<p>
<a id="pgfId-1180193"></a>For example, imagine a large-signal input at 1GHz in the pss analysis and an output frequency of 100MHz to be calculated. With no mixing, there is a gain from the sources in the circuit to the output of the circuit at 100MHz. This is called the zero sideband because there is zero frequency shift from the input to the output. This is not the same measurement as a measurement in the ac analysis because the ac only includes the DC operating point, and the pxf analysis takes into account the circuit with the LO or clock signal applied.</p>
<p>
<a id="pgfId-1180194"></a>The input frequencies that mix with the first harmonic at 1GHz to provide an output at 100MHz are at -900MHz and 1.1GHz. The frequency that is below the zero sideband is the -1 sideband and the frequency above the zero sideband is the +1 sideband.</p>
<p>
<a id="pgfId-1180195"></a>Similarly, there are terms that mix with the second and third harmonics.</p>

<p>
<a id="pgfId-1180199"></a></p>
<div class="webflare-div-image">
<img width="668" height="412" src="images/Chap4-460.gif" /></div>

<p>
<a id="pgfId-1180200"></a>Usually, we think of positive frequencies only. This is shown above. The negative frequency inputs are reflected up into the positive frequencies. This is the default for pxf.</p>
<p>
<a id="pgfId-1180201"></a>Your application sets the number of sidebands that you need. If you have specs through the fifth harmonic, you need to set maximum sidebands to 5.</p>

<h4>
<a id="pgfId-1180202"></a>Frequency Sweep</h4>

<p>
<a id="pgfId-1180203"></a>This analysis is like xf, where the output frequency is varied. The output frequency range to be analyzed is specified in the pxf <em>Choosing Analyses</em> form. Pxf then calculates the conversion gain terms.</p>
<p>
<a id="pgfId-1183992"></a>In addition to the frequency, there is a selection called <em>Sweep Type</em>. The choices are <em>relative</em> and <em>absolute</em>. When <em>absolute</em> is selected, the frequency range is used directly with no frequency conversion. When <em>relative</em> is selected, a <em>Relative Harmonic</em> field appears. The frequency sweep is shifted by the specified frequency of the harmonic in the pss analysis. For example, assume that the pss is at 1GHz, and a log sweep is desired above the first harmonic of the pss analysis. In this case, you need to select <em>relative</em> sweep, and specify 1 in the <em>Relative Harmonic</em> field. Next, type in 1K to 100M for the frequency range with a log sweep and 3 to 5 points per decade.</p>
<p>
<a id="pgfId-1180205"></a>The sweep will start at 1G + 1K, and sweep to 1G + 100M using log spacing from 1K to 100M. This is illustrated below.</p>

<p>
<a id="pgfId-1180209"></a></p>
<div class="webflare-div-image">
<img width="668" height="301" src="images/Chap4-461.gif" /></div>

<p>
<a id="pgfId-1180210"></a>To use a log sweep below the first harmonic, use the same frequency range, and type in -1 as the relative harmonic. This is illustrated below.</p>

<p>
<a id="pgfId-1180214"></a></p>
<div class="webflare-div-image">
<img width="668" height="383" src="images/Chap4-462.gif" /></div>
<h4>
<a id="pgfId-1180215"></a>Maximum Sideband</h4>

<p>
<a id="pgfId-1180216"></a>Sideband is the name of the pxf conversion gain terms. The sideband number is the pss harmonic number that is mixed with. If the sideband number is negative, the input frequency is more negative than the output frequency. If the sideband is positive, the input is more positive than the output frequency.</p>
<p>
<a id="pgfId-1180217"></a>Conceptually, an infinite number of conversion gain terms exist when a single output frequency is analyzed in a nonlinear system. From the practical point of view, usually only a small number of conversion gain terms need to be measured near the LO frequency and a small number of harmonics.</p>
<p>
<a id="pgfId-1180218"></a>There is a property in the <em>Choosing Analyses</em> form called <em>Maximum sideband</em> that is used to define how many mixing products should be calculated. If <em>Maximum sideband</em> is 0, the pxf analysis will only contain the frequency that appears without mixing or aliasing of any type. This is not equivalent to a linear AC analysis because pxf takes into account the instantaneously varying nature of the LO or sample clock signal because of the large signal being present in the pss analysis.</p>
<p>
<a id="pgfId-1180219"></a>When <em>Maximum sideband</em> is 1, the inputs without frequency translation and the inputs that mix or alias with the first harmonic of the pss analysis are present in the pxf analysis. When <em>Maximum sideband</em> is 10, the pxf analysis includes mixing through the 10th harmonic of the pss analysis. When shooting is used for the pss analysis, the number of sidebands can be any number up to four times the number of harmonics specified in the pss analysis. When harmonic balance is selected, up to the number of harmonics in the pss analysis can be specified.</p>

<h4>
<a id="pgfId-1180220"></a>Setting Harmonics and Sidebands</h4>
<h4><em>
<a id="pgfId-1184038"></a>Shooting</em></h4>

<p>
<a id="pgfId-1184039"></a>The pss analysis, when shooting is selected, has a minimum of 200 timepoints, so it inherently has frequency domain content through the 100th harmonic of the pss beat frequency. Maximum harmonic is a pss post-processing property that specifies how many harmonics to calculate in the Fourier transform of the waveform in pss. If the number of harmonics is zero, it just means that no frequency domain information should be calculated in the simulation. If the number of harmonics is 10 or less, there is no effect on the PSS waveform. When maximum harmonics gets larger than 10, the minimum number of timepoints in the pss analysis is increased. 20 timepoints in the period of the highest harmonic are forced. Thus, if maximum harmonics is raised above ten, the pss waveform gets more timepoints which increases the accuracy of the waveform, at the cost of longer runtimes and more memory required to run the pss simulation.</p>
<p>
<a id="pgfId-1180223"></a>In order for the pxf analysis to correctly measure conversion gain, the wave shape at the highest mixing harmonic needs to be accurate, so with the default settings in shooting pss, up to 40 sidebands can be accurately calculated in the pxf analysis. In most cases, only a small number of sidebands needs to be calculated, and so with shooting, you can usually count on the pxf result to be accurate.</p>
<p>
<a id="pgfId-1180224"></a>Although this is very unusual, if you need more than 40 sidebands when you are using shooting pss, you need to set the <em>maxacfreq</em> option in the pss analysis to the pss beat frequency times the number of sidebands requested in the pxf analysis, or alternatively, set the number of pss harmonics to the number of sidebands in pxf divided by four. Either method works to set the maximum timestep in the pss analysis as required for the pxf analysis to be accurate.</p>

<h4><em>
<a id="pgfId-1180225"></a>Harmonic Balance</em></h4>

<p>
<a id="pgfId-1180226"></a>When <em>Harmonic Balance</em> is selected in the pss analysis, only the harmonics specified in the pss <em>Choosing Analyses</em> form exist in the solution. In the pxf analysis, because only the harmonics specified in the pss-hb <em>Choosing Analyses</em> form exist, the maximum sideband term can only be the number of harmonics specified in the pss analysis or less. Usually, when <em>Harmonic Balance</em> is selected in the pss analysis, the <em>Maximum sideband</em> field in pxf usually should be left blank which calculates all the conversion gain calculations from all the harmonics in the pss analysis. The <em>Direct Plot Form</em> is then used to display just the conversion gain terms you want.</p>
<p>
<a id="pgfId-1180227"></a>Note that with harmonic balance, the number of harmonics (and oversample factor if you have non-sinusoidal waveforms) in the pss analysis needs to be determined. Start with a number of harmonics in the pss based on an estimate of how many harmonics the circuit actually produces with your input waveform, and run the pss and pxf analyses. Remember that for non-sinusoidal waveforms, oversample factor also needs to be set greater than one. For more information, see the pss section at the beginning of this chapter or the hb analysis at the beginning of Chapter 3. Run the analysis and make the desired measurement. Now increase the number of harmonics by roughly 50% and run the simulation again. If the answer does not change, then you had enough harmonics originally, and you might actually be able to decrease the number of harmonics from the original setting. If you have non-sinusoidal waveforms, increase the oversample factor to between four and eight before increasing the number of harmonics to find the minimum value for both oversample factor and harmonics.</p>
<p>
<a id="pgfId-1180229"></a>Pxf is usually preferred to pac when you need to measure both the passband and the image. Below is a plot of the pxf and pac output for an image reject mixer with a 1.9GHz LO and a 100MHz IF. The passband is at 1.8GHz and the image is at 2GHz.</p>

<p>
<a id="pgfId-1184089"></a></p>
<div class="webflare-div-image">
<img width="613" height="397" src="images/Chap4-463.gif" /></div>

<p>
<a id="pgfId-1180237"></a>On the left is a pxf plot when the input port is probed, thus measuring the gain from the input to the output of the image reject mixer. To read the gain, go to the input frequency, and read the gain on the vertical scale. At the passband frequency of 1.8GHz the gain is about 8dB. In the image at 2GHz, the gain is about -70 dB. The LO frequency is at the junction of the red and blue traces.</p>
<p>
<a id="pgfId-1184114"></a>To measure passband and image gain in pac, the input frequency starts at 1.7GHz and stops at 2.1GHz. At 1.7GHz, the output frequency is -200MHz, but pxf reflects the negative frequencies to the positive frequency domain by default. The trace starts at point A above, and sweeps down to zero at point B. The input frequency is 1.9GHz and the output is zero Hz. As the input continues above 1.9GHz, the output frequency becomes positive, and follows the curve to point C. Most people find the curve from pac to be more confusing than the curve from pxf, so if you need to measure both the passband and the image, or if you need to measure the conversion gain near the pss harmonics, pxf is recommended.</p>
<p>
<a id="pgfId-1184147"></a>Note that in the pac result above, you cannot just add the gain values at a specific frequency. If the frequency was 100MHz, you do have two different gain values of about +5dB and -70 dB. The output frequency for the +5dB curve is -100M, and the output for the -70dB curve is +100MHz. Since the frequencies are different, you cannot just add the two gain numbers.</p>
<p>
<a id="pgfId-1184193"></a>Pxf can measure the gain near may harmonics at the same time by increasing the maximum sideband parameter in the <em>Choosing Analyses</em> form. Below is an example of conversion gain through the fifth harmonic. Your application will determine the number of sidebands to set.</p>

<p>
<a id="pgfId-1184206"></a></p>
<div class="webflare-div-image">
<img width="613" height="401" src="images/Chap4-464.gif" /></div>

<p>
<a id="pgfId-1184197"></a>Note that the conversion gain is still relatively high near the third harmonic.</p>
<p>
<a id="pgfId-1180245"></a>Pxf can also be used to measure the conversion gain from the battery that supplies power to the output. All the gain and conversion gain terms should be below unity, or a potential oscillator is created. In the plot below, the gain from the bias source to the output at the IF frequency of 100MHz is above 0dB. This circuit is a potential oscillator.</p>

<p>
<a id="pgfId-1184264"></a></p>
<div class="webflare-div-image">
<img width="613" height="418" src="images/Chap4-465.gif" /></div>

<p>
<a id="pgfId-1180250"></a>Pxf is useful for up-conversion applications as well, with the limitation that a small-signal gain measurement is made. This is shown below.</p>

<p>
<a id="pgfId-1184314"></a></p>
<div class="webflare-div-image">
<img width="681" height="407" src="images/Chap4-466.gif" /></div>

<p>
<a id="pgfId-1180254"></a>The difference is that the output frequency is just above the first harmonic. The rules for the sidebands are the same. -1 means that the input frequency is shifted down from the output frequency by -1 * pss beat frequency.</p>
<p>
<a id="pgfId-1180258"></a>Usually, we think in terms of the positive frequency domain, which is shown below.</p>

<p>
<a id="pgfId-1184348"></a></p>
<div class="webflare-div-image">
<img width="683" height="408" src="images/Chap4-467.gif" /></div>
<h3>
<a id="pgfId-1180260"></a>AM to PM measurement (Specialized Analysis = Modulated)</h3>

<p>
<a id="pgfId-1180261"></a>This is used to measure the am to pm conversion. Normally, it is used for oscillators to measure the am to pm conversion from the power supply, but it can also be used for driven circuits. In both cases, remember that pxf is a small-signal analysis. If you need a large-signal measurement, use the transient, hb, or pss analysis.</p>
<p>
<a id="pgfId-1180262"></a>In modulated analysis, the output type should be <code>ssb</code>/<code>am</code>/<code>pm</code> so that all the gain terms can be calculated. Generally, the AM to PM gain is desired.</p>
<p>
<a id="pgfId-1180266"></a>Conceptually, if the output is ssb (single sideband) then the PM output cannot be measured.</p>

<p>
<a id="pgfId-1184387"></a></p>
<div class="webflare-div-image">
<img width="681" height="412" src="images/Chap4-468.gif" /></div>

<p>
<a id="pgfId-1180267"></a>The gain from SSB, AM, or PM inputs to the output frequency is the only gain measurement available.</p>
<p>
<a id="pgfId-1180268"></a>When the output is AM, both the sidebands above and below the chosen harmonic are calculated.</p>

<p>
<a id="pgfId-1184493"></a></p>
<div class="webflare-div-image">
<img width="678" height="417" src="images/Chap4-469.gif" /></div>

<p>
<a id="pgfId-1180272"></a>This can measure SSB, AM, or PM to an AM output.</p>

<p>
<a id="pgfId-1180276"></a></p>
<div class="webflare-div-image">
<img width="681" height="407" src="images/Chap4-470.gif" /></div>

<p>
<a id="pgfId-1180277"></a>When the output is PM, the SSB, AM, or PM to PM gain can be measured. Generally, the AM to PM gain is desired.</p>

<h3>
<a id="pgfId-1180278"></a>Sampled PXF</h3>

<p>
<a id="pgfId-1180279"></a>This analysis is seldom used.</p>
<p>
<a id="pgfId-1180280"></a>The basic idea is to measure the conversion gain as if the conversion gain was repeatedly measured at the same phase (instant in time) in the periodic large signal that is driving the circuit over an infinite number of cycles of the large signal. This measurement is impossible to duplicate in the lab. The primary application is for measuring the gain from the power supply to the output which is driving a digital circuit or a comparator that is triggered at a specific voltage level.</p>

<h2>
<a id="pgfId-1180284"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1180285"></a>This section jumps from the theoretical to the practical with examples of how to use the individual analysis types we just covered. The focus is only on the pxf <em>Choosing Analyses</em> form so you can see where the individual settings are made. For examples with all the steps shown, see the examples section that follows this section.</p>

<h3>
<a id="pgfId-1180286"></a>PXF for a Normal Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1180287"></a>Here is an example of the <em>Choosing Analyses</em> form for a normal conversion gain measurement.</p>

<p>
<a id="pgfId-1184588"></a></p>
<div class="webflare-div-image">
<img width="406" height="731" src="images/Chap4-471.gif" /></div>

<ol><li>
<a id="pgfId-1180291"></a>At the top of the form the PSS beat frequency of 1.9GHz is shown.</li><li>
<a id="pgfId-1180292"></a>Sweeptype can be relative or absolute. The default for driven circuits is absolute, and for oscillators it is relative. The selection that is being used is shown to the right of the sweeptype selection.</li><li>
<a id="pgfId-1180293"></a>The frequency sweep range is always an output frequency range. It is not a sweep in the traditional sense of connecting an input, sweeping over a frequency range, and measuring the output. Instead, it is an output frequency range to be analyzed. At each output frequency in the sweep, the input frequencies that will mix with the pss harmonics to cause that output frequency are calculated, and the forward conversion gain is calculated.</li><li>
<a id="pgfId-1180294"></a>Linear and log spacings are provided. Generally, <em>Auto</em> should be avoided because it will always calculate 50 frequency points. Usually, a much smaller number is needed, so it is recommended that you set <em>linear</em> or <em>log</em>, and control the resolution yourself.</li><li>
<a id="pgfId-1180295"></a>Although there are choices for the Sidebands selection, it is usually better to leave the setting at <em>Maximum sideband</em>, and if you need a small subset of the output results, use the <em>Direct Plot Form</em> to filter the results. For shooting, you can use up to 40 sidebands with no additional settings. If you need more than 40 sidebands, either set the number of pss harmonics to the number of sidebands divided by 4, or set the pss option <em>maxacfreq</em> to the pss beat frequency times the number of sidebands in pxf. For harmonic balance, choose a number of harmonics in the pss form, and leave the <em>Maximum sideband</em> field blank. This will calculate the conversion gain from all the harmonics in the pss analysis. For harmonic balance only, run the simulation, and make the measurement in pxf. Now increase the number of pss harmonics by about 50% and run again. If the pxf result changed significantly, then you need more harmonics in pss. If it did not change, use the smallest number of harmonics that results in an stable measurement.</li><li>
<a id="pgfId-1180296"></a>The output can measure either a voltage or a current. The voltage measurement is the default. Specify the output node or nodes in the circuit. If the output is a current select probe for the output, add an iprobe from analogLib (a current probe) in series with the output in the schematic, and specify the instance name in the <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1180297"></a>When <em>Specialized Analysis</em> is set to <em>None</em>, a normal conversion gain measurement is made.</li></ol>







<h3>
<a id="pgfId-1180298"></a>PXF Modulated (AM to PM Conversion)</h3>

<p>
<a id="pgfId-1180304"></a>Here is an example of a modulated <em>Choosing Analyses</em> form.</p>

<p>
<a id="pgfId-1184797"></a></p>
<div class="webflare-div-image">
<img width="384" height="762" src="images/Chap4-472.gif" /></div>

<ol><li>
<a id="pgfId-1180305"></a>The functions of the form above the <em>Specialized Analyses</em> section are the same as for a normal conversion gain measurement.</li><li>
<a id="pgfId-1180306"></a>In the <em>Specialized Analyses</em> section, select <em>Modulated</em>. The bottom part of the form redraws.</li><li>
<a id="pgfId-1180307"></a>In general, set the <em>Output Type</em> to <em>SSB/AM/PM</em>. This allows all the different transfer functions to be calculated, with only a small performance penalty.</li><li>
<a id="pgfId-1180308"></a>In modulated, the input and output frequencies need to be identified. The best way to do this is to click the <em>Choose</em> button to the right of the field, select the input frequency from the list of available frequencies, and click <em>OK</em>. Then repeat this action for the output frequency range, as shown below.<br />
<a id="pgfId-1180312"></a><div class="webflare-div-image">
<img width="436" height="278" src="images/Chap4-473.gif" /></div>
<a id="pgfId-1180316"></a><div class="webflare-div-image">
<img width="413" height="281" src="images/Chap4-474.gif" /></div></li></ol>








<h3>
<a id="pgfId-1180318"></a>PXF Sampled</h3>

<p>
<a id="pgfId-1180319"></a>Sampled pxf is used to measure the conversion gain at a specific point in time of the periodic signal during the pss analysis. In general, this analysis is applied to digital circuits so that the instantaneous conversion gain from the power supply to the output can be measured. Below is the time-domain waveform of a 3.3 volt digital logic circuit.</p>

<p>
<a id="pgfId-1185148"></a></p>
<div class="webflare-div-image">
<img width="659" height="446" src="images/Chap4-475.gif" /></div>

<p>
<a id="pgfId-1180323"></a>In this case, a threshold of 1.65 volts would be appropriate.</p>
<p>
<a id="pgfId-1180327"></a>Below is an example of a sampled setup for a 3.3 volt logic circuit.</p>

<p>
<a id="pgfId-1185215"></a></p>
<div class="webflare-div-image">
<img width="383" height="802" src="images/Chap4-476.gif" /></div>

<ol><li>
<a id="pgfId-1180328"></a>The functions of the form above the <em>Specialized Analyses</em> section are the same as for a normal conversion gain measurement.</li><li>
<a id="pgfId-1185323"></a>In the <em>Specialized Analyses</em> section, select <em>Sampled</em>. The bottom part of the form redraws. If your output is a current, add an iprobe (current probe) from analogLib in series with your output in the schematic, and select the iprobe as the probe selection. If you have a voltage, select voltage, and specify a node or nodes in the schematic.</li><li>
<a id="pgfId-1180330"></a>The normal use of the form is to specify a voltage threshold for the measurement in the threshold field, and not specify additional timepoints. The example above is for a 3.3 volt logic circuit where the switching threshold is 1.65 Volts.</li><li>
<a id="pgfId-1180331"></a>The <em>Crossing Direction</em> can be set to <em>all</em>, <em>rise</em>, or <em>fall</em>.</li><li>
<a id="pgfId-1180332"></a>In the case of multiple crossings, as shown in the first pss waveform shown above, all the crossings will be calculated with a maximum of 16 by default. If you have more than 16 crossing events, set the number of crossings you have in the <em>Maximum Samples</em> field. In this example, there are two crossing events, so no entries are required in the <em>Maximum Samples</em> field.</li><li>
<a id="pgfId-1180333"></a>If you have specific pss times you want to measure, specify a list of pss simulation times in the <em>Additional Timepoints</em> field. Separate the entries with a space. An example of using only the timepoints is shown below. A threshold of -10V is well outside the anticipated voltage on the output node which disables the timepoint selection using a voltage threshold.<br />
<a id="pgfId-1185388"></a><div class="webflare-div-image">
<img width="380" height="767" src="images/Chap4-477.gif" /></div></li></ol>








<h3>
<a id="pgfId-1180337"></a>PXF Opt<a id="pxf_options"></a>ions</h3>

<p>
<a id="pgfId-1180341"></a>Below is the Pxf options form.</p>

<p>
<a id="pgfId-1185479"></a></p>
<div class="webflare-div-image">
<img width="481" height="697" src="images/Chap4-478.gif" /></div>
<h4>
<a id="pgfId-1180342"></a>The below options are occasionally used.</h4>
<h4><em>
<a id="pgfId-1180343"></a>Solver</em></h4>

<p>
<a id="pgfId-1180344"></a>The solver option is used only for driven circuits. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1180345"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1180346"></a>When shooting is used, sometimes when the pxf output frequency is very close to the frequency of one of the harmonics in the pss result, warning messages will appear in the pxf output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but which takes longer to run than the <em>turbo</em> solver.</p>

<h4><em>
<a id="pgfId-1180347"></a>Oscsolver</em></h4>

<p>
<a id="pgfId-1180348"></a>The oscsolver option is used only for oscillators. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1180349"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1180350"></a>When shooting is used, sometimes when the pxf output frequency is very close to the frequency of one of the harmonics in the pss result, warning messages appear in the pxf output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but takes longer to run than the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1180351"></a>For very large oscillator designs, the <em>ira</em> oscsolver may take less memory and run faster with no loss in accuracy, however, it is less robust for convergence compared to <em>turbo</em> or <em>std</em>.</p>

<h4><em>
<a id="pgfId-1180352"></a>Hbprecond_solver </em></h4>
<h4>
<a id="pgfId-1180353"></a>This option is only available only when harmonic balance is selected in PSS and APS is used.</h4>

<p>
<a id="pgfId-1180354"></a>The basic solver is the only solver available in standard Spectre. <em>autoset</em> is the default solver when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window. If you have stagnation, it will save a small amount of time to set this option to <em>basicsolver</em>.</p>

<h4><em>
<a id="pgfId-1180355"></a>Freqaxis</em></h4>

<p>
<a id="pgfId-1180356"></a><em>freqaxis</em> specifies whether you want to see the negative frequency axis or not.</p>
<p>
<a id="pgfId-1180357"></a>The analysis calculates the input frequencies and forward conversion gain, so <em>in </em>and <em>absin</em> are reasonable choices. <em>in </em>displays the negative frequency axis. <em>absin</em> (absolute value of the input) displays positive input frequencies. This is the default.</p>

<p>
<a id="pgfId-1185613"></a></p>
<div class="webflare-div-image">
<img width="529" height="698" src="images/Chap4-479.gif" /></div>

<p>
<a id="pgfId-1180365"></a>The input frequencies are plotted on the positive frequency axis.</p>

<p>
<a id="pgfId-1185678"></a></p>
<div class="webflare-div-image">
<img width="613" height="400" src="images/Chap4-480.gif" /></div>

<p>
<a id="pgfId-1180366"></a>To read the conversion gain, go to the input frequency on the curve, and measure the conversion gain.</p>
<p>
<a id="pgfId-1180370"></a>Below is an example of <em>freqaxis</em> set to <em>in</em>.</p>
<p>
<a id="pgfId-1180371"></a>Note that the data is the same as before. It is just displayed with the negative frequency axis present. The negative frequencies have not been reflected up to the positive frequency domain. The waveform display shows the negative frequency axis now.</p>

<p>
<a id="pgfId-1185816"></a></p>
<div class="webflare-div-image">
<img width="637" height="422" src="images/Chap4-481.gif" /></div>

<p>
<a id="pgfId-1180375"></a>If you select <em>out</em>, all the inputs at the different frequencies are plotted on the same output frequency range scale. This is not recommended.</p>
<p>
<a id="pgfId-1180379"></a>The waveform tool shows all the different input frequencies on the same output frequency scale. Again, this is not recommended.</p>

<p>
<a id="pgfId-1185901"></a></p>
<div class="webflare-div-image">
<img width="665" height="415" src="images/Chap4-482.gif" /></div>
<h4>
<a id="pgfId-1180384"></a>The following options are not normally used.</h4>
<h4><em>
<a id="pgfId-1180385"></a>Tolerance</em></h4>

<p>
<a id="pgfId-1180386"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1180387"></a>Pxf uses an iterative solver to calculate the conversion gain terms. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough. The tolerance option specifies that accuracy for pxf. For shooting, the default tolerance is 1e-9. For driven circuits where HB is the pss engine, the default is 1e-6. For oscillators where hb is selected for the pss engine, the default is 1e-4.</p>

<h4><em>
<a id="pgfId-1180388"></a>Gear_order</em></h4>

<p>
<a id="pgfId-1180389"></a>Do not change this option.</p>

<h4><em>
<a id="pgfId-1180398"></a>Resgmrescycle</em></h4>

<p>
<a id="pgfId-1180399"></a>Leave this option at the default.</p>

<h4><em>
<a id="pgfId-1180400"></a>Annotate</em></h4>

<p>
<a id="pgfId-1180401"></a>This option controls the level of detail in the Spectre output log. Less detail is on the left. More detail is on the right.</p>

<h4><em>
<a id="pgfId-1180402"></a>Stimuli</em></h4>

<p>
<a id="pgfId-1180403"></a>This option is not implemented at the current time.</p>

<h4><em>
<a id="pgfId-1180404"></a>Save</em></h4>

<p>
<a id="pgfId-1180405"></a>This option is not implemented at the current time.</p>

<h4><em>
<a id="pgfId-1180406"></a>Nestlvl (Shooting and Harmonic Balance)</em></h4>

<p>
<a id="pgfId-1180407"></a>This option is not implemented at the current time.</p>

<h4><em>
<a id="pgfId-1180409"></a>AdditionalParams</em></h4>

<p>
<a id="pgfId-1180410"></a><em>In some cases when shooting pss is used for an oscillator, PXF results that are close to a pss harmonic may be questionable. In this case, type osc_version=dts in the additionalParams field to solve the issue.</em></p>
<p>
<a id="pgfId-1235112"></a><em>additionalParams</em> is typically used for new features that are being beta tested. This field expects <code>keyword=value</code> pairs.</p>
<p>
<a id="pgfId-1180411"></a>For more information about the other options, type <code>spectre -h pxf</code> at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1180413"></a>Examples for Driven Circuits</h2>
<h3>
<a id="pgfId-1180414"></a>PXF Normal Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1180415"></a>Consider the following circuit:</p>

<p>
<a id="pgfId-1180419"></a></p>
<div class="webflare-div-image">
<img width="668" height="565" src="images/Chap4-483.gif" /></div>

<p>
<a id="pgfId-1180420"></a>The circuit is a double-balanced down-conversion mixer with a 1.9GHz LO.</p>
<p>
<a id="pgfId-1180421"></a>The <em>Edit Object Properties</em> form for the input port is shown below.</p>

<p>
<a id="pgfId-1180425"></a></p>
<div class="webflare-div-image">
<img width="668" height="760" src="images/Chap4-484.gif" /></div>

<p>
<a id="pgfId-1186047"></a>Using variables to set the frequencies and amplitudes is suggested because you can change the circuit setup by changing variable values in ADE Explorer without needing to change the circuit itself.</p>
<p>
<a id="pgfId-1186048"></a>ADE Explorer has the variables set to appropriate values, as shown below.</p>

<p>
<a id="pgfId-1186054"></a></p>
<div class="webflare-div-image">
<img width="668" height="496" src="images/Chap4-485.gif" /></div>

<p>
<a id="pgfId-1180434"></a>This setup causes the LO to be driven, and both RF inputs to be turned off for the pss analysis by setting the RF frequencies to zero. You can disable a signal for the pss analysis by setting its frequency to zero.</p>

<h3>
<a id="pgfId-1180435"></a>Using PXF Analysis for Conversion Gain Measurement</h3>

<p>
<a id="pgfId-1180436"></a>Set up the pss analysis with just the large signal that causes the frequency translation to occur, which is generally the LO signal or the sample clock. For more information, refer to <em>Overview of Periodic Steady-State (pss) Analysis</em> section at the beginning of this chapter. Regarding whether to use shooting or harmonic balance, pick the analysis that produces the smallest runtime or best convergence. In general, shooting is recommended for systems that have sharp edges, and harmonic balance is recommended for systems that are more sinusoidal.</p>

<p>
<a id="pgfId-1180440"></a></p>
<div class="webflare-div-image">
<img width="668" height="774" src="images/Chap4-486.gif" /></div>

<p>
<a id="pgfId-1180441"></a>Set up the PXF analysis, as follows.</p>

<p>
<a id="pgfId-1180445"></a></p>
<div class="webflare-div-image">
<img width="668" height="710" src="images/Chap4-487.gif" /></div>

<ol><li>
<a id="pgfId-1180446"></a>Specify an appropriate output frequency range for your circuit. </li><li>
<a id="pgfId-1180447"></a>Generally, either linear or log spacing should be used. Auto usually takes more frequency point than are required, and thus extends the runtime.</li><li>
<a id="pgfId-1180448"></a>For the pxf analysis, as a general recommendation, set the <em>Maximum sideband</em> term to the same value you uses for the maximum number of pss harmonics. Alternatively, the <em>Maximum sideband</em> field could be set to the highest harmonic of the pss analysis that mixing products are desired to be calculated. This is generally determined by the application. If you only need one or two output mixing product, and you are using shooting in the pss analysis, choose <em>Select from range</em>, and highlight the sidebands you want to calculate. Setting <em>Maximum sideband</em> for pxf is usually not critical as long as enough sidebands are calculated to measure the desired input frequency and forward conversion gain (called a sideband). The <em>Direct Plot Form</em> allows the plotting of the individual input sidebands as will be shown later. </li><li>
<a id="pgfId-1186210"></a>Set the output nodes, as shown in the example. If the <em>Negative Output Node</em> field is left blank as shown above, the global ground node is used by the simulator for the reference node. If you have an output current, add an iprobe from analogLib in series with the output, and click probe in the output section. Then specify the iprobe in the <em>Output Probe Instance</em> field.</li><li>
<a id="pgfId-1186211"></a>Now run the simulation. </li><li>
<a id="pgfId-1186212"></a>After the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1180455"></a><div class="webflare-div-image">
<img width="668" height="507" src="images/Chap4-488.gif" /></div>
<a id="pgfId-1180456"></a>In the <em>Direct Plot Form</em>:</li><li>
<a id="pgfId-1180457"></a>Select <em>pxf</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1180458"></a>Select <em>dB20</em> from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1180459"></a>Select the voltage or current source from the schematic. Note that when you plot pxf results, you are selecting an instance, not a node. You will get the conversion gain results for the source you select in the circuit. The example below shows the conversion gain from the input source in the circuit.<br />
<a id="pgfId-1180460"></a>The waveform window is displayed, as shown below.<br />
<a id="pgfId-1180464"></a><div class="webflare-div-image">
<img width="668" height="417" src="images/Chap4-489.gif" /></div>
<a id="pgfId-1180465"></a>Since the <em>Sweeptype</em> was <em>log</em>, the data is displayed with a log axis in the waveform tool. In some cases, a linear X Axis is easier to read. To accomplish this, move the mouse cursor over one of the numbers on the X Axis and right-click. Move to Log Scale and click to deselect log. This is shown below.<br />
<a id="pgfId-1180470"></a><br /><div class="webflare-div-image">
<img width="668" height="423" src="images/Chap4-490.gif" /></div>
<a id="pgfId-1180471"></a>To read the conversion gain, move to the desired input frequency, and read the gain off the Y axis. The gain at 1.91GHz is about 15dB. The place to look is in the red rectangle above. Alternatively, position your mouse cursor on the trace at the input frequency, and read the value in the cursor readout. You can also place a marker at the input frequency to read out the conversion gain. To do this, move your mouse cursor near the trace at the input frequency, and type m.</li><li>
<a id="pgfId-1180472"></a>The conversion gain near the third and fifth harmonics of the LO is also reasonable high as well. The gain near the third harmonic is near -5dB, and the gain near the third harmonic is near -25 dB. See the red and blue boxes below.<br />
<a id="pgfId-1186358"></a><div class="webflare-div-image">
<img width="668" height="422" src="images/Chap4-491.gif" /></div></li><li>
<a id="pgfId-1180478"></a>In the <em>Direct Plot Form</em>, select <em>New Win</em> from the <em>Plotting mode</em> drop-down list and select the DC source that is supplying power to the circuit. <br />
<a id="pgfId-1180479"></a>The waveform window is displayed, as shown below.<br />
<a id="pgfId-1180483"></a><div class="webflare-div-image">
<img width="668" height="439" src="images/Chap4-492.gif" /></div>
<a id="pgfId-1180484"></a>Note that the gain is about +5dB at 150MHz. This circuit is a potential oscillator.</li></ol>





































<h3>
<a id="pgfId-1180485"></a>PXF Modulated (AM to PM conversion)</h3>

<p>
<a id="pgfId-1180489"></a>Consider the digital circuit below.</p>

<p>
<a id="pgfId-1186456"></a></p>
<div class="webflare-div-image">
<img width="662" height="534" src="images/Chap4-493.gif" /></div>

<ol><li>
<a id="pgfId-1282375"></a>The input source has variables to define the frequency. This allows the frequency to be changed from the ADE Explorer environment without needing to change the circuit. The properties list is shown below. The rise and fall times are set to a small fraction of the period of the signal. This is done so the rise and fall times do not produce nonphysical, excessively fast risetimes, which cannot be realistically produced in a circuit anyway. The pulse width is set to produce a 50% duty cycle square wave.<br />
<a id="pgfId-1282378"></a> <div class="webflare-div-image">
<img width="574" height="704" src="images/Chap4-494.gif" /></div></li><li>
<a id="pgfId-1282379"></a>The default values for the variables are set in ADE Explorer. The input frequency is 2.5GHz.<br />
<a id="pgfId-1186657"></a><div class="webflare-div-image">
<img width="607" height="414" src="images/Chap4-495.gif" /></div></li><li>
<a id="pgfId-1180500"></a>To run a pxf analysis, first a pss analysis needs to be run. For more information, see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1186693"></a><div class="webflare-div-image">
<img width="398" height="762" src="images/Chap4-496.gif" /></div></li><li>
<a id="pgfId-1180508"></a>Now set up the pxf modulated analysis.<br />
<a id="pgfId-1186763"></a><div class="webflare-div-image">
<img width="386" height="769" src="images/Chap4-497.gif" /></div></li><li>
<a id="pgfId-1180509"></a>First, select <em>Modulated</em> at the bottom of the <em>Choosing Analyses</em> form. This forces relative Sweeptype.</li><li>
<a id="pgfId-1180510"></a>The objective is to measure AM to PM conversion on the 2.5GHz output when there is power supply ripple. Remember that in pxf, the frequency range is an output frequency range. Accordingly, the relative harmonic is 1, and the output frequency is analyzed just above the output at 2.5GHz.</li><li>
<a id="pgfId-1180511"></a>Usually, it is better to select linear or log spacing, and set your own sweep resolution. Automatic usually takes more points than are needed, thus extending the runtime.</li><li>
<a id="pgfId-1180512"></a>Set the number of sidebands equal to the number of pss harmonics.</li><li>
<a id="pgfId-1180513"></a>Specify an output node or nodes, as usual in pxf. If you have an output current, add an iprobe in series with the output, and click probe in the <em>Output</em> section. Then specify the instance name of the iprobe in the <em>Output Probe Instance</em> field.</li><li>
<a id="pgfId-1180514"></a>Always set the <em>Output Type</em> to <em>SSB/AM/PM</em>. This allows all the SSB/AM/PM to SSB/AM/PM components to be plotted.</li><li>
<a id="pgfId-1180515"></a>Click the <em>Choose</em> button to the right of the <em>Input Modulated Harmonic List</em> field. Select the input frequency as shown below. This example measures the power supply ripple at low frequency to PM output near the 2.5GHz carrier, so the input frequency range is 1K to 100M.<br />
<a id="pgfId-1187050"></a><div class="webflare-div-image">
<img width="412" height="285" src="images/Chap4-498.gif" /></div></li><li>
<a id="pgfId-1180519"></a>Click the <em>Choose</em> button to the right of the <em>Output Modulated Harmonic</em> field. Select the output frequency, as shown below. This example measures the power supply ripple at low frequency to PM output near the 2.5GHz carrier, so the output frequency range is 2.5G to 2.6G.<br />
<a id="pgfId-1187091"></a><div class="webflare-div-image">
<img width="412" height="283" src="images/Chap4-499.gif" /></div></li><li>
<a id="pgfId-1180523"></a>Click <em>OK</em>, and run the simulation. When the analysis completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> from the ADE Explorer window. <br />
<a id="pgfId-1187168"></a><div class="webflare-div-image">
<img width="420" height="630" src="images/Chap4-500.gif" /></div></li></ol>








































<p>
<a id="pgfId-1187178"></a>In the <em>Direct Plot Form</em>:</p>
<ol><li>
<a id="pgfId-1187185"></a>Select <em>pxf modulated</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1187239"></a>At the current time, to measure AM to PM conversion when the input is near zero Hz, the <em>Input </em>option should be set to <em>SSB</em>.</li><li>
<a id="pgfId-1187240"></a>Set the <em>Output</em> option to <em>PM</em>.</li><li>
<a id="pgfId-1187241"></a>Select <em>Voltage Gain </em>from the <em>Function</em> section</li><li>
<a id="pgfId-1187319"></a>Select <em>Magnitude</em> from the <em>Modifier</em> section.</li><li>
<a id="pgfId-1180532"></a>Click the DC source in the circuit that supplies power to the circuit. The measurement plots.<br />
<a id="pgfId-1187363"></a><div class="webflare-div-image">
<img width="619" height="401" src="images/Chap4-501.gif" /></div></li><li>
<a id="pgfId-1180536"></a>Although the vertical axis is labeled mV/V, it is actually plotting milliRadians of phase change per volt of power supply change. 318 milliRadians is about 18 degrees of phase change for a 1 volt change on the power supply. [(0.318/6.28)*360] Note that pxf is a small-signal measurement, and this applies only for small variations of the power supply voltage.</li></ol>











<h3>
<a id="pgfId-1180537"></a>Sampled PXF</h3>

<p>
<a id="pgfId-1180538"></a>Sampled pxf is seldom used. It is provided so that conversion gain measurements from the power supply to a digital output that is periodic, and sampled at the threshold point every cycle. The typical threshold is the VDD/2 switching point for further logic circuits.</p>
<p>
<a id="pgfId-1180542"></a>Consider the digital circuit below.</p>

<p>
<a id="pgfId-1187418"></a></p>
<div class="webflare-div-image">
<img width="617" height="490" src="images/Chap4-502.gif" /></div>

<ol><li>
<a id="pgfId-1180543"></a>The input source has variables to define the frequency. This allows the frequency to be changed from the ADE Explorer environment without needing to change the circuit. The properties list is shown below. The rise and fall times are set to a small fraction of the period of the signal. This is done so the rise and fall times do not produce nonphysical, excessively fast risetimes, which cannot be realistically produced in a circuit anyway. The pulse width is set to produce a 50% duty cycle square wave.<br />
<a id="pgfId-1187517"></a><div class="webflare-div-image">
<img width="487" height="757" src="images/Chap4-503.gif" /></div></li><li>
<a id="pgfId-1180552"></a>The default values for the variables are set in ADE Explorer. The input frequency is 2.5GHz.<br />
<a id="pgfId-1187646"></a><div class="webflare-div-image">
<img width="596" height="415" src="images/Chap4-504.gif" /></div></li><li>
<a id="pgfId-1180553"></a>To run a pxf analysis, first a pss analysis needs to be run. For more information, see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1187763"></a><div class="webflare-div-image">
<img width="385" height="785" src="images/Chap4-505.gif" /></div></li><li>
<a id="pgfId-1180561"></a>Now set up the pxf sampled analysis.<br />
<a id="pgfId-1187827"></a><div class="webflare-div-image">
<img width="404" height="765" src="images/Chap4-506.gif" /></div></li><li>
<a id="pgfId-1180562"></a>First, select <em>Sampled</em> at the bottom of the <em>Choosing Analyses</em> form.</li><li>
<a id="pgfId-1180563"></a>The objective is to measure the conversion gain on the 2.5GHz output at the threshold crossing of the digital output when there is power supply ripple. Remember that in pxf, the frequency range is an output frequency range. Accordingly, the output frequency is analyzed just above the output at 2.5GHz.</li><li>
<a id="pgfId-1180564"></a>Usually, it is better to select linear or log spacing, and set your own sweep resolution. Automatic usually takes more points than are needed, thus extending the runtime.</li><li>
<a id="pgfId-1180565"></a>Set the number of sidebands equal to the number of pss harmonics.</li><li>
<a id="pgfId-1180566"></a>Specify an output node or nodes, as usual in pxf. If you have an output current, add an iprobe in series with the output, and click probe in the <em>Output</em> section. Then specify the instance name of the iprobe in the <em>Output Probe Instance</em> field.</li><li>
<a id="pgfId-1180567"></a>Click <em>Select</em> to the right of the <em>Net+</em> field and select the output net in the schematic.</li><li>
<a id="pgfId-1180568"></a>Type in the threshold voltage. In 3.3 volt logic, 1.65 volts is appropriate.</li><li>
<a id="pgfId-1180569"></a>Choose the crossing direction. Rising, falling, and all crossing events are selectable. This example shows all, which will calculate the transfer functions for both the rising and falling edges.</li><li>
<a id="pgfId-1180570"></a>If you want specific times in the pss waveform to be measured, type those times into the <em>Additional Timepoints</em> field. Separate the times with a space. This is not shown in the example.</li><li>
<a id="pgfId-1180571"></a>Click <em>OK</em> and run the simulation. When the analysis completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> from the ADE Explorer window.<br />
<a id="pgfId-1188045"></a><div class="webflare-div-image">
<img width="309" height="491" src="images/Chap4-507.gif" /></div></li><li>
<a id="pgfId-1180575"></a>Select pss results, and plot the time-domain waveform. This is shown in the previous graphic. Plotting the waveform establishes which time corresponds to which edge.<br />
<a id="pgfId-1188078"></a><div class="webflare-div-image">
<img width="634" height="455" src="images/Chap4-508.gif" /></div></li><li>
<a id="pgfId-1180579"></a>For this example, the rising edge is about 77nsec, and the falling edge is about 275nsec.</li><li>
<a id="pgfId-1180580"></a>Now select pxf results. If desired, select dB20. Select the crossing time from the list at the bottom. The example shows the rising edge.<br />
<a id="pgfId-1188124"></a><div class="webflare-div-image">
<img width="330" height="487" src="images/Chap4-509.gif" /></div></li><li>
<a id="pgfId-1180585"></a>Click the DC source in the circuit that supplies power to the circuit. The measurement plots.<br />
<a id="pgfId-1188169"></a><div class="webflare-div-image">
<img width="635" height="352" src="images/Chap4-510.gif" /></div></li><li>
<a id="pgfId-1180589"></a>To measure the conversion gain, go to the input frequency on the plot, and make the measurement. Below, the plot is zoomed in to the results from low frequency, like power supply ripple. At 2MHz, the gain is about -0.5dB.<br />
<a id="pgfId-1188259"></a><div class="webflare-div-image">
<img width="637" height="357" src="images/Chap4-511.gif" /></div></li></ol>





















































<h2>
<a id="pgfId-1180593"></a>Examples for Oscillators</h2>
<h3>
<a id="pgfId-1180594"></a>Conversion Gain From Power Supply to the Output Frequency</h3>

<p>
<a id="pgfId-1188397"></a>Consider the circuit shown below.</p>

<p>
<a id="pgfId-1188401"></a></p>
<div class="webflare-div-image">
<img width="641" height="542" src="images/Chap4-512.gif" /></div>

<p>
<a id="pgfId-1180605"></a>On the <em>Choosing Analyses</em> form:</p>
<ol><li>
<a id="pgfId-1180606"></a>Set up the pss analysis, as shown below. For more information, refer to <em>Overview of Periodic Steady-State (pss) Analysis</em> at the beginning of this chapter. <br />
<a id="pgfId-1180610"></a><div class="webflare-div-image">
<img width="442" height="764" src="images/Chap4-513.gif" /></div></li><li>
<a id="pgfId-1180614"></a>Set up the pxf analysis, as shown below.<br />
<a id="pgfId-1188502"></a><div class="webflare-div-image">
<img width="363" height="683" src="images/Chap4-514.gif" /></div></li><li>
<a id="pgfId-1180615"></a>R<em>elative</em> from the <em>Sweeptype</em> drop-down list is the default when an oscillator simulation is set in the pss analysis.</li><li>
<a id="pgfId-1180616"></a>Specify the output harmonic in the <em>Relative Harmonic</em> field.</li><li>
<a id="pgfId-1180617"></a>Set the frequency range to a frequency range that is relevant for your needs. In this example, the frequency range is from 100Hz to 100MHz above the first harmonic of the oscillator frequency.</li><li>
<a id="pgfId-1180618"></a>Select <em>logarithmic</em> from the <em>Sweep Type</em> drop-down list.</li><li>
<a id="pgfId-1180619"></a>Specify 3 to 5 in the <em>Points Per Decade</em> field.</li><li>
<a id="pgfId-1180620"></a>Set the <em>Maximum sideband</em> option to the same value as you have set for the maximum harmonics in the pss analysis.</li><li>
<a id="pgfId-1180621"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1180622"></a>Run the simulation.</li><li>
<a id="pgfId-1180623"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1188604"></a><div class="webflare-div-image">
<img width="313" height="525" src="images/Chap4-515.gif" /></div>
<a id="pgfId-1180627"></a>In the <em>Direct Plot Form</em>:</li><li>
<a id="pgfId-1180628"></a>Select <em>pxf </em>in the <em>Analysis</em> section.</li><li>
<a id="pgfId-1180629"></a>Select <em>sideband </em>from the <em>Sweep section</em>.</li><li>
<a id="pgfId-1180630"></a>Select dB20.</li><li>
<a id="pgfId-1180631"></a>Select your input frequency range in the list in the <em>Input Sideband</em> section.</li><li>
<a id="pgfId-1180632"></a>Select the power supply source in the Schematic window. <br />
<a id="pgfId-1180633"></a>The waveform is plotted, as shown below.<br />
<a id="pgfId-1180638"></a><div class="webflare-div-image">
<img width="619" height="404" src="images/Chap4-516.gif" /></div></li></ol>

































<p>
<a id="pgfId-1180639"></a>To read the gain, go to the input frequency, and read the gain from the Y axis. The gain is about 47dB at 100KHz in this example.</p>

<h3>
<a id="pgfId-1180643"></a>Modulated PXF; Measuring AM to PM Conversion and Controlling Spurious Response</h3>

<p>
<a id="pgfId-1180644"></a>The focus of this section is controlling the spurious response caused by the power supply ripple. Consider an oscillator shown below.</p>

<p>
<a id="pgfId-1188708"></a></p>
<div class="webflare-div-image">
<img width="654" height="508" src="images/Chap4-517.gif" /></div>

<p>
<a id="pgfId-1188734"></a>The first part of this section uses hb, which is equivalent to pss. The reason hb is used is because hb has the ability to run an oscillator with ripple so the spurious output of the oscillator can be measured. Pss does not have this capability. Using hb to solve for the spurious output usually takes longer than a pss with a modulated pxf analysis. Pss-pxf modulated will be used to measure the conversion gain from the power supply ripple to the output phase of the oscillator. Once the spurious output is measured with hb, then running pss and modulated pxf can be used to reduce the conversion gain from the power supply to the output, thus reducing the spurious output. Using this combination of analyses saves time.</p>
<ol><li>
<a id="pgfId-1180651"></a>On the left are two sources. The bottom source is the DC source that supplies power to the circuit. This source is in the yellow rectangle above. The upper source is a source that injects ripple into the simulation. This source is in the red rectangle above.</li><li>
<a id="pgfId-1180652"></a>The ripple frequency and amplitude are set using variable names so the values can be changed in the ADE Explorer environment without needing to change the circuit. The ripple source properties are shown below.<br />
<a id="pgfId-1188819"></a><div class="webflare-div-image">
<img width="488" height="693" src="images/Chap4-518.gif" /></div></li><li>
<a id="pgfId-1180661"></a>ADE Explorer sets the frequency to 1MHz and the amplitude to 30mV peak.<br />
<a id="pgfId-1188935"></a><div class="webflare-div-image">
<img width="667" height="440" src="images/Chap4-519.gif" /></div></li><li>
<a id="pgfId-1180662"></a>First, measure what is happening with the ripple applied in the circuit. See the hb section for more details. The hb setup is as below.<br />
<a id="pgfId-1188999"></a><div class="webflare-div-image">
<img width="418" height="767" src="images/Chap4-520.gif" /></div></li><li>
<a id="pgfId-1180670"></a>Run the simulation, and plot the output spectrum.<br />
<a id="pgfId-1189108"></a><div class="webflare-div-image">
<img width="619" height="422" src="images/Chap4-521.gif" /></div></li><li>
<a id="pgfId-1180671"></a>Place a marker by moving your mouse cursor over the tip of the oscillator frequency, and typing m. Now move your mouse cursor over one of the spurs, and type d. This places another marker, and causes the delta readout shown above to be displayed.<br />
<a id="pgfId-1180672"></a>The spurious output is about 33.3dB down from the oscillator output frequency.</li><li>
<a id="pgfId-1180673"></a>Now that we know what we really have, and how much this is above the specification, we can switch to a faster method to reduce the spurious output. This will be done using pss and modulated pxf.</li><li>
<a id="pgfId-1180674"></a>Now measure the AM to PM conversion using pss and pxf modulated. This will tell you the gain from the power supply to the PM output.</li><li>
<a id="pgfId-1180675"></a>First, disable the ripple source by setting its frequency to 0 in ADE Explorer, and disable the hb analysis used to measure the spurious response.<br />
<a id="pgfId-1189152"></a><div class="webflare-div-image">
<img width="657" height="449" src="images/Chap4-522.gif" /></div></li><li>
<a id="pgfId-1180681"></a>Set up a pss analysis with just the oscillator signal. For more information, see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1189205"></a><div class="webflare-div-image">
<img width="380" height="771" src="images/Chap4-523.gif" /></div></li><li>
<a id="pgfId-1180689"></a>Now set up a pxf modulated analysis, as follows:<br />
<a id="pgfId-1189345"></a><div class="webflare-div-image">
<img width="391" height="769" src="images/Chap4-524.gif" /></div></li><li>
<a id="pgfId-1180690"></a>At the bottom of the form, set <em>Specialized Analysis</em> to <em>Modulated</em>, and set the <em>Output Type</em> to <em>SSB/AM/PM</em>.</li><li>
<a id="pgfId-1180691"></a>At the top of the form, <em>Modulated</em> forces a relative frequency sweep. The frequency sweep range is always an output frequency range in pxf. Since the gain from the power supply ripple to the output above the oscillator frequency is desired, the output harmonic is 1 and the frequency range is just above the first harmonic.</li><li>
<a id="pgfId-1180692"></a>It is usually better to select either a linear or a log sweep, and define your own resolution because automatic usually takes more points and therefore a longer runtime than is usually needed.</li><li>
<a id="pgfId-1180693"></a>Set <em>Maximum sideband</em> to the same value that you used for harmonics in the pss analysis.</li><li>
<a id="pgfId-1180694"></a>Specify the output node or current as usual. If you have an output current, add an iprobe in series with the output, and click probe in the Output section. Then specify the instance name of the iprobe in the Output Probe Instance field.</li><li>
<a id="pgfId-1180695"></a>Now, set the input frequency by clicking <em>Choose</em> to the right of the <em>Input Modulated Harmonic List</em> field.<br />
<a id="pgfId-1189582"></a>The Choose Harmonic window is displayed. <br />
<a id="pgfId-1189546"></a> <div class="webflare-div-image">
<img width="431" height="281" src="images/Chap4-525.gif" /></div></li><li>
<a id="pgfId-1189559"></a>In the Choose Harmonic window, select the frequency range and click<em> OK</em>.</li><li>
<a id="pgfId-1189677"></a>To set the output frequency, click <em>Choose</em> to the right of the <em>Output Modulated Harmonic</em> field.<br />
<a id="pgfId-1189767"></a>The <em>Choose Harmonic</em> window is displayed.<br />
<a id="pgfId-1189697"></a><div class="webflare-div-image">
<img width="451" height="278" src="images/Chap4-526.gif" /></div></li><li>
<a id="pgfId-1189714"></a>In the <em>Choose Harmonic</em> window, select the output frequency range and click <em>OK</em>.</li><li>
<a id="pgfId-1180703"></a>Click <em>OK</em> in the <em>Choosing Analyses</em> form and run the simulation. </li><li>
<a id="pgfId-1189817"></a>When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.<br />
<a id="pgfId-1189855"></a><div class="webflare-div-image">
<img width="382" height="504" src="images/Chap4-527.gif" /></div></li><li>
<a id="pgfId-1180707"></a>Currently, to measure the AM to PM conversion, you set <em>Input</em> to <em>SSB</em>, and <em>Output</em> to <em>PM</em>. Select <em>dB20,</em> if desired. Select the ripple source in the schematic. The AM to PM gain is plotted.<br />
<a id="pgfId-1189972"></a><div class="webflare-div-image">
<img width="619" height="399" src="images/Chap4-528.gif" /></div></li><li>
<a id="pgfId-1180711"></a>Position a marker at the ripple frequency to measure the gain. The gain in this example is about 3.9dB. As you implement circuitry to reduce the ripple, you can run the pss-pxf modulated analysis in less time than it takes to run the hb analysis with both the oscillator and the ripple. When you have a ripple reduction circuit in place, you can re-run the two-tone hb analysis to verify the fix works.</li></ol>







































































<h3>
<a id="pgfId-1190065"></a>Sampled PXF: Measuring Conversion Gain at a Threshold Crossing in a Ring Oscillator</h3>

<p>
<a id="pgfId-1190066"></a>Sampled pxf can be used to calculate the gain from the power supply to the output when the output is defined as the periodic point where the gain is measured at the same phase (time) of the oscillator as if it were sampled repeatedly at exactly the same phase (time) over an infinite number of cycles. This is the conversion gain from the power supply to a single point in the output waveform, as opposed to the averaged measurements from before. Usually, this is applied to ring oscillators where relatively sharp edges are present in the output, and the output is driving some kind of digital logic. In this case, only the point where the threshold for the digital logic on the output matters. All the rest of the points in the waveform are either above or below the threshold, and thus do not influence the threshold event time.</p>
<ol><li>
<a id="pgfId-1180717"></a>Consider the 4-stage differential voltage-controlled ring oscillator below.<br />
<a id="pgfId-1190121"></a><div class="webflare-div-image">
<img width="617" height="506" src="images/Chap4-529.gif" /></div></li><li>
<a id="pgfId-1180718"></a>First, set initial conditions on one of the stages of the ring to force a DC operating point. In the ADE Explorer window, select <em>Simulation</em> - <em>Convergence Aids</em> - <em>Initial condition</em>.<br />
<a id="pgfId-1190157"></a><div class="webflare-div-image">
<img width="625" height="505" src="images/Chap4-530.gif" /></div></li><li>
<a id="pgfId-1180725"></a>The <em>Select Initial Condition Set</em> window appears. Since this is a differential oscillator, there are two outputs from one stage. One of those outputs is set low, and the other is set high. This forces a starting condition for the tstab interval.<br />
<a id="pgfId-1190199"></a><div class="webflare-div-image">
<img width="471" height="268" src="images/Chap4-531.gif" /></div></li><li>
<a id="pgfId-1180729"></a>When the <em>Select Initial Condition Set</em> window is displayed, the nodes with the IC defined are highlighted in the schematic, as shown below. The fourth stage output is set.<br />
<a id="pgfId-1190241"></a><div class="webflare-div-image">
<img width="606" height="473" src="images/Chap4-532.gif" /></div></li><li>
<a id="pgfId-1180733"></a>Now set up the pss analysis. For more information, please see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1190290"></a><div class="webflare-div-image">
<img width="460" height="775" src="images/Chap4-533.gif" /></div></li><li>
<a id="pgfId-1180740"></a>Set up the sampled pxf analysis, as shown below.<br />
<a id="pgfId-1190443"></a><div class="webflare-div-image">
<img width="426" height="799" src="images/Chap4-534.gif" /></div></li><li>
<a id="pgfId-1190444"></a>Select <em>Sampled</em> from the <em>Specialized Analyses</em> drop-down list.</li><li>
<a id="pgfId-1190445"></a>Because the pss is set for an oscillator, relative is set for pxf. The output frequency is just above the first harmonic of the oscillator in this example.</li><li>
<a id="pgfId-1180743"></a>Usually, it is better to select Linear or log, and define your own sweep. Auto usually takes more frequency point than are needed, thus extending the pxf runtime.</li><li>
<a id="pgfId-1180744"></a>Set <em>Maximum sideband</em> to the same value used for pss harmonics.</li><li>
<a id="pgfId-1180745"></a>Select the output net or current, as usual. If you have an output current, add an iprobe in series with the output, and click probe in the <em>Output</em> section. Then specify the instance name of the iprobe in the <em>Output Probe Instance</em> field.</li><li>
<a id="pgfId-1190649"></a>Below the <em>Sampled</em> selection, define the output type, and set the output again.</li><li>
<a id="pgfId-1190650"></a>Specify an appropriate threshold. This ring oscillator has a differential output, so 0 volts is an appropriate threshold.</li><li>
<a id="pgfId-1180748"></a>If desired, set the crossing direction. This example calculates all the crossings of 1.65 volts.</li><li>
<a id="pgfId-1180749"></a>Click <em>OK</em> in the <em>Choosing Analyses</em> form and run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em>. The <em>Direct Plot Form</em> appears.<br />
<a id="pgfId-1190708"></a><div class="webflare-div-image">
<img width="376" height="610" src="images/Chap4-535.gif" /></div></li><li>
<a id="pgfId-1180756"></a>Plot the pss time-domain output waveform(s) so you can see the times of the transitions<br />
<a id="pgfId-1190750"></a>.<div class="webflare-div-image">
<img width="588" height="448" src="images/Chap4-536.gif" /></div></li><li>
<a id="pgfId-1180757"></a>For the V4M signal, the rising edge is about 184psec, and the falling edge is about 445psec.</li><li>
<a id="pgfId-1180758"></a>Now plot the pxf sampled results.</li><li>
<a id="pgfId-1180762"></a>If desired, select <em>dB20</em>.<br />
<a id="pgfId-1190788"></a><div class="webflare-div-image">
<img width="504" height="611" src="images/Chap4-537.gif" /></div></li><li>
<a id="pgfId-1180763"></a>Select the event time.</li><li>
<a id="pgfId-1180767"></a>Now select the power supply source in the schematic. The results plot, as shown below.<br />
<a id="pgfId-1190836"></a><div class="webflare-div-image">
<img width="667" height="437" src="images/Chap4-538.gif" /></div></li><li>
<a id="pgfId-1180768"></a>To read the result, go to the input frequency on the pxf plot, and read the gain. This is the voltage gain from the power supply to the output just above the first harmonic of the oscillator at a single timepoint in the waveform. If there is voltage gain from the power supply to the output, it shows up as ripple on the output, which will affect the timing of the output crossing. The gain at 1MHz input frequency is shown below.<br />
<a id="pgfId-1190881"></a><div class="webflare-div-image">
<img width="619" height="401" src="images/Chap4-539.gif" /></div></li></ol>
































































<h2>
<a id="pgfId-1180772"></a>Pe<a id="PSTB"></a>riodic Stability Analysis (PSTB)</h2>

<p>
<a id="pgfId-1180773"></a>Pstb is provided to measure the small-signal loop gain in the presence of a large signal. As an example, think of an amplifier. When the input signal is small, the amplifier is largely linear, and stb and pstb should agree. However, when the input signal becomes large, the amplifier becomes more nonlinear. This will change the loop gain of the feedback system. Pstb measures the loop gain with the large signal present in the system.</p>
<p>
<a id="pgfId-1180774"></a>An additional application is for measuring the loop gain of oscillators. In most oscillators, the power supplies define the output level. The nonlinearities created by the oscillation cause the loop gain to shift slightly from the linear stb analysis results. We have seen cases where multiple stable oscillation frequencies resulted from the nonlinearities introduced by the oscillations themselves, and this showed up in the pstb result. The large signal oscillation is solved in the pss analysis, and the small-signal stability analysis is run in the pstb analysis.</p>

<h3>
<a id="pgfId-1180775"></a>Example: Variation in Loop Gain of an Opamp with Swept Input Signal Amplitude</h3>

<p>
<a id="pgfId-1180779"></a>Consider the opamp circuit below.</p>

<p>
<a id="pgfId-1190949"></a></p>
<div class="webflare-div-image">
<img width="625" height="498" src="images/Chap4-540.gif" /></div>

<p>
<a id="pgfId-1180780"></a>To use pstb, an <code>iprobe</code> from <code>analogLib</code> (single ended) or a <code>diffstbprobe</code> from <code>analogLib</code> (differential) needs to be added in series with the feedback path. Note the arrow in the current probe is in the same direction as the direction of the feedback.</p>
<p>
<a id="pgfId-1180781"></a>The input source to the circuit has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. This allows changes in frequency or amplitude from the ADE Explorer environment without needing to change the schematic itself.</p>
<p>
<a id="pgfId-1180782"></a>The property list for the input source is shown below.</p>

<p>
<a id="pgfId-1180787"></a></p>
<div class="webflare-div-image">
<img width="419" height="698" src="images/Chap4-541.gif" /></div>

<p>
<a id="pgfId-1180788"></a>The easiest way to get the variables list into the ADE Explorer is to select <em>Variables</em> -&gt; <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type in the desired value, and press <em>Enter. </em>When you have set the variables, if you want to add the values back into the cellview, in the ADE Explorer window, select <em>Variables</em> - <em>Copy To Cellview</em>, and then perform a <em>Check and Save</em> in the schematic.</p>

<p>
<a id="pgfId-1191035"></a></p>
<div class="webflare-div-image">
<img width="584" height="405" src="images/Chap4-542.gif" /></div>

<p>
<a id="pgfId-1180793"></a>The input frequency for this example is 100KHz and its amplitude is 100 millivolts peak.</p>
<p>
<a id="pgfId-1180794"></a>The basic strategy is to apply the signal that causes the distortion in the pss analysis, and then measure the loop gain using the pstb analysis.</p>
<p>
<a id="pgfId-1180795"></a>The pss analysis needs to be set up first. The example below shows a single input at 100KHz with 10 harmonics. The amplitude is swept from 0.1 volts to 1.5 volts peak with a step value of 0.2 volts. For more information, see the pss section at the beginning of this chapter. This will characterize the amplifier at a range of different input amplitudes. At each amplitude, both the pss and pstb analyses are run.</p>

<p>
<a id="pgfId-1191110"></a></p>
<div class="webflare-div-image">
<img width="464" height="808" src="images/Chap4-543.gif" /></div>

<p>
<a id="pgfId-1180801"></a>Next, the pstb analysis needs to be set up. The frequency range depends on your application. The <em>Probe Instance</em> is the iprobe from <code>analogLib</code> in the circuit. If you have a differential circuit, use <code>diffstbprobe</code> from <code>analogLib</code>. <code>diffstbprobe</code> allows the measurement of common-mode and differential-mode loop gain.</p>

<p>
<a id="pgfId-1191223"></a></p>
<div class="webflare-div-image">
<img width="381" height="568" src="images/Chap4-544.gif" /></div>

<p>
<a id="pgfId-1180805"></a>Once the analyses are set up, the simulation can be run. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1191308"></a>The example below shows the <em>Direct Plot Form</em>. If you want dB for the loop gain amplitude plot, plot the magnitude and phase separately This example shows dB for the loop gain magnitude plot.</p>

<p>
<a id="pgfId-1191325"></a></p>
<div class="webflare-div-image">
<img width="348" height="521" src="images/Chap4-545.gif" /></div>

<p>
<a id="pgfId-1191326"></a>If you select <em>Add To Outputs</em>, an expression is entered under the <em>Maestro</em> tab of ADE Explorer so that the next time you simulate your circuit, this measurement plots automatically.</p>
<p>
<a id="pgfId-1180811"></a>Here is the output voltage of the opamp versus input voltage for the sweep. The curve begins to compress at 1.1 volts peak.</p>

<p>
<a id="pgfId-1191366"></a></p>
<div class="webflare-div-image">
<img width="640" height="453" src="images/Chap4-546.gif" /></div>

<p>
<a id="pgfId-1180821"></a>Here is the loop gain and phase curve for the 0.1 volt input.</p>

<p>
<a id="pgfId-1191402"></a></p>
<div class="webflare-div-image">
<img width="662" height="417" src="images/Chap4-547.gif" /></div>

<p>
<a id="pgfId-1180822"></a>Note that the DC phase is 180, and not zero. From feedback theory, we would expect zero. So what causes this difference? In feedback theory, we always assume there is a forward and reverse transfer function, and an inverting summing junction with a gain of unity. In feedback theory, we plot the forward and reverse transfer functions only. When the phase is zero, and then applied through the inverting input, the phase becomes 180. In the circuit, we cannot separate out the summing junction. Thus, the condition of instability is a linear magnitude of 1 and a phase of zero, or multiples of 360 degrees.</p>
<p>
<a id="pgfId-1180823"></a>Vertical marker V2 has been placed at (nearly) unity gain (0dB). The phase is about 87.8 degrees. The distance to zero phase is 88 degrees. This is the phase margin for this circuit at low input amplitude. The unity gain frequency is about 800KHz</p>
<p>
<a id="pgfId-1180827"></a>Below is the plot with a 1.1 volt input.</p>

<p>
<a id="pgfId-1191482"></a></p>
<div class="webflare-div-image">
<img width="613" height="457" src="images/Chap4-548.gif" /></div>

<p>
<a id="pgfId-1180828"></a>The DC gain has dropped from about 66dB to about 42 dB. The unity gain frequency has dropped from about 800KHz to about 112KHz. The phase margin has actually improved.</p>

<h3>
<a id="pgfId-1180835"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1180836"></a>Pstb is used to measure the loop gain with a large signal applied to the circuit. First, the large signal is applied in pss. An <code>iprobe</code> (single-ended) or a <code>diffstbprobe</code> (differential) is placed in the circuit in series with the feedback path. Both probes are in <code>analogLib</code>. Pstb applies a voltage to the source(s) in the probe, and measures the amplitude and phase of the signal across the probe. This is the loop gain of the circuit. <code>diffstbprobe</code> allows the measurement of common-mode and differential-mode gain in the differential circuit.</p>
<p>
<a id="pgfId-1180837"></a>Pstb is supported for both shooting and harmonic balance pss.</p>
<p>
<a id="pgfId-1180838"></a>In some cases, placing the probe in the circuit can break some local feedback paths. If this happens, the loop gain calculation will be incorrect. If you are unsure if this could be happening in your circuit, place the probe in a different position in the loop. If the loop gain stays the same, both results are correct. If it changed, try a third point in the circuit. When the two points agree, you have the loop gain.</p>

<h4>
<a id="pgfId-1180839"></a>Setting Harmonics and Sidebands</h4>
<h4><em>
<a id="pgfId-1180840"></a>Shooting</em></h4>

<p>
<a id="pgfId-1180841"></a>The pss analysis, when shooting is selected, has a minimum of 200 timepoints, so it inherently has frequency domain content through the 100th harmonic of the pss beat frequency. Maximum harmonic is a pss post-processing property that specifies how many harmonics to calculate in the Fourier transform of the waveform in pss. If the number of harmonics is zero, it just means that no frequency domain information should be calculated in the simulation. If the number of harmonics is 10 or less, there is no effect on the PSS waveform. When the maximum harmonics gets larger than 10, the minimum number of timepoints in the pss analysis is increased. 20 timepoints in the period of the highest harmonic are forced. Thus, if the maximum harmonics is raised, the pss waveform gets more timepoints which improves the accuracy of the waveform at the cost of longer runtimes and more memory required to run the pss simulation.</p>
<p>
<a id="pgfId-1180842"></a>In order for the pstb analysis to correctly measure conversion gain, the wave shape at the highest analysis frequency needs to be accurate, so with the default settings in shooting pss, up to 40 times the pss beat frequency can be used as the maximum frequency in pstb. If you need a higher stop frequency, either set the number of harmonics to maximum frequency in pstb/4*pss beat frequency, or set the pss option <em>maxacfreq</em> to the stop frequency in pstb.</p>

<h4><em>
<a id="pgfId-1180843"></a>Harmonic Balance</em></h4>

<p>
<a id="pgfId-1180844"></a>When <em>Harmonic Balance</em> is selected in the pss analysis, only the harmonics specified in the pss <em>Choosing Analyses</em> form exist in the solution. In the pstb analysis, because only the harmonics specified in the pss-hb <em>Choosing Analyses</em> form exist, the maximum frequency term can only be as high as the highest frequency harmonic specified in the pss analysis. If you need a higher maximum frequency in pstb, you need to specify more harmonics in the pss analysis.</p>

<h2>
<a id="pgfId-1180846"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1180847"></a>This section jumps from the theoretical to the practical with examples of how to use pstb. The focus is only on the pstb <em>Choosing Analyses</em> form so you can see where the individual settings are made. For examples, with all the steps shown, see the examples section that follows this section.</p>

<h3>
<a id="pgfId-1180848"></a>PSTB Setup</h3>

<p>
<a id="pgfId-1180852"></a>Here is an example of the Choosing Analyses form for a normal loop gain measurement</p>

<p>
<a id="pgfId-1191628"></a>.</p>
<div class="webflare-div-image">
<img width="377" height="569" src="images/Chap4-549.gif" /></div>

<ol><li>
<a id="pgfId-1180853"></a>At the top of the form the PSS beat frequency of 100KHz is shown.</li><li>
<a id="pgfId-1180854"></a>The frequency sweep range specifies the limits and spacing of the loop gain measurement. Note that with this maximum frequency of 100M, either the pss option <em>maxacfreq</em> needs to be set to 100M, or the number of pss harmonics needs to be set to 250. <br /><div class="webflare-information-macro webflare-macro-tip">
<a id="pgfId-1180855"></a>
Maxacfreq forces 5 timepoints in the period of the frequency specified for maxacfreq. PSS harmonics above 10 forces 20 timepoints in the period of the highest harmonic. In this example, the pss beat frequency is 100K, and the highest frequency in pstb is 100M, or a ratio of 1000. Since pss harmonics force four times as many timepoints as maxacfreq does, to get equivalent runs, you need 1000/4 or 250 harmonics in pss.</div></li><li>
<a id="pgfId-1180856"></a>Linear and log sweeps are provided. Generally, log sweeps are used. The number of points depends on how rapidly the loop gain changes with frequency in your circuit. High Q circuits will need more resolution than shown in this example.</li><li>
<a id="pgfId-1180857"></a>A probe must be used in the circuit and specified in the <em>Probe Instance</em> field. For single-ended circuits, an <code>iprobe</code> from <code>analogLib</code> should be used. For differential circuits, a <code>diffstbprobe</code> should be used. When <code>diffstbprobe</code> is used, you will have an additional choice in the <em>Choosing Analyses</em> form that allows the selection of differential or common-mode measurements of loop gain.</li></ol>







<h3>
<a id="pgfId-1180859"></a>PSTB Op<a id="pstb_options"></a>tions</h3>

<p>
<a id="pgfId-1180863"></a>Below is the pstb options form.</p>

<p>
<a id="pgfId-1191699"></a></p>
<div class="webflare-div-image">
<img width="478" height="631" src="images/Chap4-551.gif" /></div>
<h4>
<a id="pgfId-1180864"></a>Solver</h4>

<p>
<a id="pgfId-1180865"></a>The solver option is used only for driven circuits. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1180866"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1180867"></a>When shooting is used, sometimes when the pstb analysis frequency is very close to the frequency of one of the harmonics in the pss result, warning messages will appear in the pstb output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but which takes longer to run than the turbo solver.</p>

<h4>
<a id="pgfId-1180868"></a>Oscsolver</h4>

<p>
<a id="pgfId-1180869"></a>The <em>oscsolver</em> option is used only for oscillators. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1180870"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1180871"></a>When shooting is used, sometimes when the pstb analysis frequency is very close to the frequency of one of the harmonics in the pss result, warning messages appear in the pstb output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but takes longer to run than the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1180872"></a>For very large oscillator designs, the ira oscsolver may take less memory and run faster with no loss in accuracy, however, it is less robust for convergence compared to <em>turbo</em> or <em>std</em>.</p>

<h4>
<a id="pgfId-1180873"></a>Hbprecond_solver </h4>
<h4>
<a id="pgfId-1180874"></a>This option is only available only when harmonic balance selected in PSS and APS is used.</h4>

<p>
<a id="pgfId-1180875"></a>The basic solver is the only solver available in standard Spectre when harmonic balance is selected. <em>autoset</em> is the default solver in harmonic balance when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window. If you have stagnation, it will save a small amount of time to set this option to <em>basicsolver</em>.</p>

<h3>
<a id="pgfId-1180876"></a>The following options are not commonly used:</h3>
<h4>
<a id="pgfId-1180877"></a>Tolerance</h4>

<p>
<a id="pgfId-1180878"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1180879"></a>Pstb uses an iterative solver to calculate the loop gain at the specified frequencies. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough. The tolerance option specifies that accuracy for pstb. For shooting, the default tolerance is 1e-9. For driven circuits where HB is the pss engine, the default is 1e-6. For oscillators where hb is selected for the pss engine, the default is 1e-4.</p>

<h4>
<a id="pgfId-1180880"></a>Gear_order</h4>

<p>
<a id="pgfId-1180881"></a>Do not change this option.</p>

<h4>
<a id="pgfId-1180890"></a>Resgmrescycle</h4>

<p>
<a id="pgfId-1180891"></a>Leave this option at the default.</p>

<h4>
<a id="pgfId-1180892"></a>Annotate</h4>

<p>
<a id="pgfId-1180893"></a>This option controls the level of detail in the Spectre output log. Selections to the left in the form produce less detail. Selections to the right in the form add increasing detail.</p>

<h4>
<a id="pgfId-1180897"></a>Save</h4>

<p>
<a id="pgfId-1180898"></a>This option is not implemented at the current time.</p>

<h4>
<a id="pgfId-1180899"></a>Nestlvl (Shooting and Harmonic Balance)</h4>

<p>
<a id="pgfId-1180900"></a>This option is not implemented at the current time.</p>

<h4>
<a id="pgfId-1180902"></a>AdditionalParams</h4>

<p>
<a id="pgfId-1180903"></a><em>In some cases, when shooting pss is used for an oscillator circuit, pstb results near a pss harmonic may be questionable. To solve this issue, type osc_version=dts in the additionalParams field.</em></p>
<p>
<a id="pgfId-1235244"></a><em>additionalParams</em> is typically used for new features that are being beta tested. <code>keyword=value</code> pairs are expected in this field.</p>
<p>
<a id="pgfId-1180904"></a>For more information about the other options, type <code>spectre -h pstb</code> at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1180906"></a>Oscillator Example</h2>

<p>
<a id="pgfId-1180907"></a>For the differential oscillator circuit below, a <code>diffstbprobe</code> has been placed at mirror locations in the differential circuit. This is shown in the red box below.</p>

<p>
<a id="pgfId-1191812"></a></p>
<div class="webflare-div-image">
<img width="611" height="542" src="images/Chap4-552.gif" /></div>

<ol><li>
<a id="pgfId-1180912"></a>First, a pss analysis needs to be set up. For more information, refer to the pss section at the beginning of this chapter.<br />
<a id="pgfId-1191873"></a><div class="webflare-div-image">
<img width="390" height="786" src="images/Chap4-553.gif" /></div></li><li>
<a id="pgfId-1180919"></a>Now set up the pstb analysis. The resolution of this sweep is quite high.<br />
<a id="pgfId-1191940"></a><div class="webflare-div-image">
<img width="492" height="544" src="images/Chap4-554.gif" /></div>
<a id="pgfId-1180920"></a>The frequency sweep range, and the number of points will be determined by your circuit. In this case, from linear stb analysis, all the interesting variations started at 1GHz. Narrow peaks were detected, which forced many points in order to resolve the amplitude of the peaks.</li><li>
<a id="pgfId-1180922"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</li><li>
<a id="pgfId-1180926"></a>Now the loop gain and phase are plotted using the <em>Direct Plot Form</em>.<br />
<a id="pgfId-1191983"></a><div class="webflare-div-image">
<img width="378" height="520" src="images/Chap4-555.gif" /></div></li><li>
<a id="pgfId-1180927"></a>Now, the plot of the loop gain and phase is shown. The red trace is loop gain, and the blue trace is the phase.<br />
<a id="pgfId-1192021"></a><div class="webflare-div-image">
<img width="632" height="398" src="images/Chap4-556.gif" /></div></li><li>
<a id="pgfId-1180931"></a>A vertical marker has been placed at the zero degree point on the phase curve. Note that the gain is very close to unity, and the phase is very close to zero. Remember that in pstb, the summing junction is included in the analysis, so the condition for oscillation is unity gain and zero or multiples of 360 degrees of phase. The frequency readout shows 5.1499GHz.</li><li>
<a id="pgfId-1180932"></a>For an oscillator, you should see almost exactly unity gain and a phase of almost exactly zero or multiples of 360 degrees. Small differences are to be expected because of finite resolution in the frequency sweep and/or interpolation error in the markers.</li><li>
<a id="pgfId-1180936"></a>The plot of the output spectrum is shown below.<br />
<a id="pgfId-1192066"></a><div class="webflare-div-image">
<img width="633" height="395" src="images/Chap4-557.gif" /></div>
<a id="pgfId-1289532"></a>Note that the frequency in the large-signal pss is the same as the small-signal pstb analysis. The nonlinearities of the oscillator are taken into account in the pstb simulation. </li></ol>






























<h2>
<a id="pgfId-1158320"></a><a id="33596"></a><a id="29491"></a><a id="20945"></a>Periodic S-parameter An<a id="psp"></a>alysis (PSP)</h2>

<p>
<a id="pgfId-1182071"></a>Psp is provided to measure S-Parameters for circuits that translate frequencies. All the basic assumptions of S-Parameters apply to psp, with the addition of having different input and output frequencies. Psp can be used for up or down-conversion applications.</p>

<h3>
<a id="pgfId-1182072"></a>Example: Down-Conversion Diode Mixer</h3>

<p>
<a id="pgfId-1182076"></a>Consider the double-balanced diode mixer circuit below.</p>

<p>
<a id="pgfId-1192207"></a></p>
<div class="webflare-div-image">
<img width="547" height="481" src="images/Chap4-558.gif" /></div>

<p>
<a id="pgfId-1182078"></a>The input source has the frequency and amplitude set to variable names in order to allow changing the test setup without needing to change the circuit. This is suggested for all the sources used in the circuit that might need to be changed. This allows changes in frequency or amplitude from the ADE Explorer environment without needing to change the schematic itself.</p>
<p>
<a id="pgfId-1182084"></a>The property list for the RF input port is shown below.</p>

<p>
<a id="pgfId-1192271"></a></p>
<div class="webflare-div-image">
<img width="528" height="782" src="images/Chap4-559.gif" /></div>

<p>
<a id="pgfId-1182086"></a>The same strategy is used for the LO port.</p>
<p>
<a id="pgfId-1182087"></a>The easiest way to get the variables list into ADE Explorer is to select <em>Variables</em> -&gt; <em>Copy From Cellview</em>. To set the values, select the value field to the right of the variable, type in the desired value, and press <em>Enter. </em>When you have set the variables, if you want to add the values back into the cellview, in the ADE Explorer window, select <em>Variables</em> - <em>Copy To Cellview</em>, and then perform a <em>Check and Save</em> in the schematic.</p>

<p>
<a id="pgfId-1192342"></a></p>
<div class="webflare-div-image">
<img width="579" height="422" src="images/Chap4-560.gif" /></div>

<p>
<a id="pgfId-1182092"></a>The RF input frequency is disabled (by setting the frequency to zero), and the LO is at 1GHz with a 1.4 volt peak signal. This is +13 dBm, which is a common drive level for a diode mixer.</p>
<p>
<a id="pgfId-1182093"></a>The basic strategy is to apply the signal that causes the frequency translation in the pss analysis, and then measure the frequency-shifted S-Parameters using psp. Doing this allows measuring the input match at the input frequency, and the output match at the output frequency in the same analysis. For the forward and reverse gain terms, the specified frequency translation is taken into account.</p>
<p>
<a id="pgfId-1182095"></a>The pss analysis needs to be set up first. The example below shows a single input at 1GHz with 10 harmonics. For more information, see the pss section at the beginning of this chapter.</p>

<p>
<a id="pgfId-1192380"></a></p>
<div class="webflare-div-image">
<img width="382" height="763" src="images/Chap4-561.gif" /></div>

<p>
<a id="pgfId-1182101"></a>Next, the psp analysis needs to be set up. The frequency range depends on your application, and can be either an input frequency range, or an output frequency range. The actual frequency for each port-frequency definition will be set up later. In this example, the frequency range is just above the LO frequency at 1GHz.</p>

<p>
<a id="pgfId-1192477"></a> </p>
<div class="webflare-div-image">
<img width="363" height="678" src="images/Chap4-562.gif" /></div>

<p>
<a id="pgfId-1182105"></a>Start with Port 1. In the <em>Port #</em> column, type 1. In the <em>Name</em> column, either type the instance name, or use the <em>Select Port</em> button just below the edit line to select the port in the circuit. In this case, Port 1 is the RF port.</p>

<p>
<a id="pgfId-1192571"></a></p>
<div class="webflare-div-image">
<img width="363" height="674" src="images/Chap4-563.gif" /></div>

<p>
<a id="pgfId-1182109"></a>Now click <em>Choose Harmonic</em>. In the <em>Choose Harmonic</em> window, select the frequency range you want associated with that port number. For the down-conversion application, The input is just above the LO frequency of 1GHz.</p>

<p>
<a id="pgfId-1192687"></a> </p>
<div class="webflare-div-image">
<img width="351" height="250" src="images/Chap4-564.gif" /></div>

<p>
<a id="pgfId-1192664"></a>Click OK.</p>
<p>
<a id="pgfId-1182113"></a>Click <em>Add</em> located to the right of the <em>Choose Harmonic</em> button. This adds that port and frequency definition to the list for the analysis. By convention, Port 1 defines the input frequency.</p>

<p>
<a id="pgfId-1192773"></a></p>
<div class="webflare-div-image">
<img width="355" height="680" src="images/Chap4-565.gif" /></div>

<p>
<a id="pgfId-1182119"></a>Note that Port 1 has both a port and a frequency definition associated with it. In psp, both are necessary for a port definition.</p>
<p>
<a id="pgfId-1182120"></a>In psp, multiple port-frequency definitions can be run at one time.</p>
<p>
<a id="pgfId-1182121"></a>The next step is to measure RF to IF conversion gain. Type 2 in the <em>Port #</em> column. Click <em>Select Port</em>, and select the IF port.</p>

<p>
<a id="pgfId-1192874"></a></p>
<div class="webflare-div-image">
<img width="364" height="672" src="images/Chap4-566.gif" /></div>

<p>
<a id="pgfId-1182126"></a>Now define the frequency range for that port. Click <em>Choose Harmonic</em>, and select the IF frequency from the list.</p>

<p>
<a id="pgfId-1192915"></a></p>
<div class="webflare-div-image">
<img width="349" height="252" src="images/Chap4-567.gif" /></div>

<p>
<a id="pgfId-1192939"></a>Click OK.</p>
<p>
<a id="pgfId-1182130"></a>Click <em>Add</em> located to the right of the <em>Choose Harmonic</em> button. The second port-frequency definition is added to the list. By convention, Port 2 defines the output frequency range.</p>

<p>
<a id="pgfId-1285271"></a></p>
<div class="webflare-div-image">
<img width="362" height="675" src="images/Chap4-568.gif" /></div>

<p>
<a id="pgfId-1182135"></a>Now measure the RF to IF isolation. Type 3 in the <em>Port #</em> column. Click <em>Select Port</em>, and again select the IF output port. Click <em>Choose Harmonic</em>, and select the input frequency range. </p>

<p>
<a id="pgfId-1193087"></a></p>
<div class="webflare-div-image">
<img width="363" height="254" src="images/Chap4-569.gif" /></div>

<p>
<a id="pgfId-1193106"></a>Click OK.</p>
<p>
<a id="pgfId-1182139"></a>Click <em>Add</em> located to the right of the <em>Choose Harmonic</em> button. The third port-frequency definition is added.</p>

<p>
<a id="pgfId-1193167"></a></p>
<div class="webflare-div-image">
<img width="364" height="674" src="images/Chap4-570.gif" /></div>

<p>
<a id="pgfId-1182143"></a>If a noise simulation is desired, set the <em>Maximum sideband</em> field to the same number of harmonics used in the pss analysis.</p>

<p>
<a id="pgfId-1193261"></a></p>
<div class="webflare-div-image">
<img width="363" height="674" src="images/Chap4-571.gif" /></div>

<p>
<a id="pgfId-1182148"></a>With the above port-frequency definitions, S11 measures the input match at the RF frequency. S22 measures the output match at the IF frequency. S31 measures the RF to IF isolation, and s21 measures the RF to IF conversion gain.</p>
<p>
<a id="pgfId-1182149"></a>Once the analyses are set up, the simulation can be run. When the simulation finishes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.</p>
<p>
<a id="pgfId-1182154"></a>The <em>Direct Plot Form</em> is displayed, as shown below.</p>

<p>
<a id="pgfId-1193328"></a></p>
<div class="webflare-div-image">
<img width="299" height="749" src="images/Chap4-572.gif" /></div>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1182155"></a>Many of the measurements in the <em>Direct Plot Form</em>, like Kf, and B1f are only defined for two-port networks. In the <em>Direct Plot Form</em>, if you select one of those items for plotting, you will see a message that says the data is not 2 X 2. Also note that Kf and B1f are only defined for amplifiers where there is no frequency translation. If you run a two-port simulation on a mixer like this, and you select Kf to be plotted, you will see a message that the harmonic of the two ports are not the same, and as a result, this cannot be plotted.</div>
<p>
<a id="pgfId-1182156"></a>If you click <em>Add To Outputs</em>, an expression is entered under the <em>Maestro</em> tab of the ADE Explorer window so that the next time you simulate your circuit, this measurement plots automatically.</p>
<p>
<a id="pgfId-1182160"></a>Here are the S11, S21, S31, and S33 plots.</p>

<p>
<a id="pgfId-1193478"></a></p>
<div class="webflare-div-image">
<img width="613" height="402" src="images/Chap4-573.gif" /></div>

<p>
<a id="pgfId-1182161"></a>The conversion loss is about 6.5 dB. The input match is about -7.9dB. The output match is about -9.8dB. The RF to IF isolation is about 84 dB.</p>
<p>
<a id="pgfId-1182162"></a>Note that these measurements can be plotted on a Smith Chart as well. The Smith Chart capability is only available from the <em>Direct Plot Form</em>. under the <em>Maestro</em> tab of the ADE Explorer window will always plot on a rectangular plot. The Smith Chart has not been shown here because this circuit is inherently very wide band. The curve on the Smith Chart would be tiny. An example using a Smith Chart is shown later on in the Examples section.</p>
<p>
<a id="pgfId-1182163"></a>Psp can be used for up conversion as well. To do that, just change the frequency definitions for the ports. Since IF to RF gain is usually not needed, only a two-port measurement has been set up. Note the frequency difference for Ports 1 and 2.</p>

<p>
<a id="pgfId-1193564"></a></p>
<div class="webflare-div-image">
<img width="361" height="676" src="images/Chap4-574.gif" /></div>

<p>
<a id="pgfId-1182171"></a>Now run the analysis. S11, S21, and S22 are plotted, as shown below.</p>

<p>
<a id="pgfId-1193618"></a></p>
<div class="webflare-div-image">
<img width="613" height="402" src="images/Chap4-575.gif" /></div>
<h3>
<a id="pgfId-1182179"></a>Overview of Simulation Capabilities</h3>

<p>
<a id="pgfId-1182180"></a>Psp is similar to sp in that power gain measurements are made. Sp is based on the DC operating point, so it can only produce results that are linear. All the frequencies are the same for all the S-Parameter measurements in the sp analysis.</p>
<p>
<a id="pgfId-1182181"></a>Psp uses the pss analysis results as the basis for making the S-Parameter measurement. Because the PSS result is the operating point solution for psp, the input can mix with any of the harmonics that are present in the pss analysis for the frequency-translated terms. The term SXX is not enough to describe the system. We need not only port numbers, but also the frequency needs to be defined for each port definition. </p>
<p>
<a id="pgfId-1182182"></a>In the example in the preceding section, the LO was at 1GHz and the specified frequency was just above the first harmonic of the LO. In the psp definition for each port, both the port name and the frequency that is associated with that measurement need to be defined.</p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1182183"></a>Some measurements like Kf are only defined for systems that do not translate frequency. In psp, because the calculation is based on the pss large-signal solution, you can sweep the input power to an amplifier, and measure the stability factor as it changes with the input amplitude. In this case, the input and output frequencies are the same, so Kf is defined. If you have different frequencies on the input and output, Kf cannot be plotted because it is not defined. The <em>Direct Plot Form</em> will say that term cannot be plotted. Otherwise, all the parameters that can be plotted in sp are available in psp. Also, note that Kf and B1f are only defined for 2-port networks.</div>
<p>
<a id="pgfId-1182185"></a>Noise analysis is available in psp, and is the same as pnoise. Please see the pnoise chapter for noise information.</p>

<h4>
<a id="pgfId-1182186"></a>Setting Harmonics and Sidebands</h4>
<h4><em>
<a id="pgfId-1182187"></a>Shooting</em></h4>

<p>
<a id="pgfId-1182188"></a>The pss analysis, when shooting is selected, has a minimum of 200 timepoints, so it inherently has the frequency domain content through the 100th harmonic of the pss beat frequency. Maximum harmonic is a pss post-processing property that specifies how many harmonics to calculate in the Fourier transform of the waveform in pss. If the number of harmonics is zero, it just means that no frequency domain information should be calculated in the simulation. If the number of harmonics is 10 or less, there is no effect on the PSS waveform. When maximum harmonics gets larger than 10, the minimum number of timepoints in the pss analysis is increased. 20 timepoints in the period of the highest harmonic are forced. Thus, if maximum harmonics is raised, the pss waveform gets more timepoints which increases the accuracy of the pss waveform at the cost of longer runtimes and more memory required to run the pss simulation.</p>
<p>
<a id="pgfId-1182189"></a>In order for the psp analysis to correctly measure conversion gain, the wave shape at the highest analysis frequency needs to be accurate, so with the default settings in shooting pss, up to 40 times the pss beat frequency can be used as the maximum frequency in psp. This will cover the vast majority of cases.</p>

<h4><em>
<a id="pgfId-1182190"></a>Harmonic Balance</em></h4>

<p>
<a id="pgfId-1182191"></a>When <em>Harmonic Balance</em> is selected in the pss analysis, only the harmonics specified in the pss <em>Choosing Analyses</em> form exist in the solution. If the harmonic balance analysis has enough harmonics to accurately capture the behavior of your circuit, the psp result will be accurate. To see if the result is accurate, increase the number of pss harmonics by about 50% and run again. If the psp result did not change, then you had enough harmonics to begin with, and might be able to be reduced. If it did change, add more harmonics and run again. For the fastest simulation, use the smallest number of harmonics that produce a stable psp result.</p>
<p>
<a id="pgfId-1182192"></a>In the psp analysis, because only the harmonics specified in the pss-hb <em>Choosing Analyses</em> form exist, the maximum frequency term can only be as high as the number of harmonics specified in the pss analysis times the pss beat frequency.</p>

<h2>
<a id="pgfId-1182194"></a>ADE Implementation</h2>

<p>
<a id="pgfId-1182195"></a>This section jumps from the theoretical to the practical with examples of how to use psp. The focus is only on the psp <em>Choosing Analyses</em> form so you can see where the individual settings are made. For examples with all the steps shown, see the examples section that follows this section.</p>

<h3>
<a id="pgfId-1182196"></a>PSP Setup</h3>

<p>
<a id="pgfId-1182200"></a>For this example, consider an LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1193741"></a></p>
<div class="webflare-div-image">
<img width="653" height="577" src="images/Chap4-576.gif" /></div>

<ol><li>
<a id="pgfId-1182201"></a>First, define either an input or output frequency range in the frequency sweep range fields. It is usually easier to define an input frequency range, as shown below for a 2.4GHz application.<br />
<a id="pgfId-1193781"></a><div class="webflare-div-image">
<img width="374" height="676" src="images/Chap4-577.gif" /></div></li><li>
<a id="pgfId-1182207"></a>The frequency sweep range specifies the limits and spacing for the input frequency.</li><li>
<a id="pgfId-1182208"></a>Linear and log sweeps are provided. It is usually better to select linear or log, and specify the number of steps instead of using automatic. Automatic will run 50 frequency points, which usually is not needed for most applications.</li><li>
<a id="pgfId-1182213"></a>Now port and frequency definitions need to be made.<br />
<a id="pgfId-1193864"></a><div class="webflare-div-image">
<img width="396" height="676" src="images/Chap4-578.gif" /></div></li><li>
<a id="pgfId-1182214"></a>In the text field just above the <em>Select Port</em> button, type 1 in the <em>Port #</em> field. Click <em>Select Port</em>, and select the input port.</li><li>
<a id="pgfId-1182215"></a>Click <em>Choose harmonic</em>. In the window that appears, select the input frequency range.<br />
<a id="pgfId-1193994"></a><div class="webflare-div-image">
<img width="374" height="248" src="images/Chap4-579.gif" /></div></li><li>
<a id="pgfId-1194007"></a>Click <em>OK</em>.</li><li>
<a id="pgfId-1194135"></a>Click <em>Add</em>. The port-frequency combination is added to the list. By convention, Port 1 sets the input frequency for psp.<br />
<a id="pgfId-1194152"></a><div class="webflare-div-image">
<img width="407" height="674" src="images/Chap4-580.gif" /></div></li><li>
<a id="pgfId-1194145"></a>Now define the output port-frequency combination as Port 2.<br />
<a id="pgfId-1194270"></a><div class="webflare-div-image">
<img width="437" height="761" src="images/Chap4-581.gif" /></div></li><li>
<a id="pgfId-1182240"></a>Repeat the process to define Port 3 as the gain from RF to IF with no frequency translation. (The RF to IF isolation.)<br />
<a id="pgfId-1194617"></a><div class="webflare-div-image">
<img width="379" height="675" src="images/Chap4-582.gif" /></div></li><li>
<a id="pgfId-1182245"></a>Click <em>Add</em> to add the last port-frequency definition to the list.</li><li>
<a id="pgfId-1182246"></a>If you want a noise simulation, set <em>Maximum sideband</em> to the number of LO or clock harmonics. This analysis is the same as pnoise. For more information, see the pnoise section in this chapter.</li></ol>




































<h3>
<a id="pgfId-1182251"></a>PSP Op<a id="psp_options"></a>tions</h3>

<p>
<a id="pgfId-1182255"></a>Below is the psp options form.</p>

<p>
<a id="pgfId-1194796"></a></p>
<div class="webflare-div-image">
<img width="475" height="700" src="images/Chap4-583.gif" /></div>

<p>
<a id="pgfId-1182256"></a>None of the options are commonly used.</p>

<h4>
<a id="pgfId-1182257"></a>Solver</h4>

<p>
<a id="pgfId-1182258"></a>The solver option is used only for driven circuits. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1182259"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1182260"></a>When shooting is used, sometimes when the psp analysis frequency is very close to the frequency of one of the harmonics in the pss, warning messages will appear in the psp output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but which takes longer to run than the <em>turbo</em> solver.</p>

<h4>
<a id="pgfId-1182261"></a>Oscsolver</h4>

<p>
<a id="pgfId-1182262"></a>The <em>oscsolver</em> option is used only for oscillators. The default solver is the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1182263"></a>When hb is used as the engine in pss, leave this option at the default.</p>
<p>
<a id="pgfId-1182264"></a>When shooting is used, sometimes when the psp analysis frequency is very close to the frequency of one of the harmonics in the pss, warning messages appear in the psp output warning that the accuracy might not be good enough. If you see these messages, select the <em>std</em> solver, which has better ability to handle frequencies that are very close to a harmonic in the pss, but takes longer to run than the <em>turbo</em> solver.</p>
<p>
<a id="pgfId-1182265"></a>For very large oscillator designs, the ira oscsolver may take less memory and run faster with no loss in accuracy, however, it is less robust for convergence compared to <em>turbo</em> or <em>std</em>.</p>

<h4>
<a id="pgfId-1182266"></a>Hbprecond_solver </h4>
<h4>
<a id="pgfId-1182267"></a>This option is only available only when harmonic balance is selected in PSS and APS is used.</h4>

<p>
<a id="pgfId-1182268"></a>The basic solver is the only solver available in standard Spectre when harmonic balance is selected. <em>autoset</em> is the default solver in harmonic balance when APS is used. This solver is faster, but occasionally stagnates. When stagnation is detected, APS automatically switches to the basic solver, and prints a message in the Spectre output window. If you have stagnation, it will save a small amount of time to set this option to <em>basicsolver</em>.</p>

<h4>
<a id="pgfId-1182269"></a>Tolerance</h4>

<p>
<a id="pgfId-1182270"></a>Leave this option at the default value.</p>
<p>
<a id="pgfId-1182271"></a>Psp uses an iterative solver to calculate the output amplitudes. Any iterative solver needs an error tolerance to specify when to stop iterating because the solution is accurate enough. The tolerance option specifies that accuracy for psp. For shooting, the default tolerance is 1e-9. For driven circuits where HB is the pss engine, the default is 1e-6. For oscillators where hb is selected for the pss engine, the default is 1e-4.</p>

<h4>
<a id="pgfId-1182272"></a>Gear_order</h4>

<p>
<a id="pgfId-1182273"></a>Do not change this option.</p>

<h4>
<a id="pgfId-1182282"></a>Resgmrescycle</h4>

<p>
<a id="pgfId-1182283"></a>Leave this option at the default. For the <em>resgmres</em> linear solver, there are several different options.</p>

<h4>
<a id="pgfId-1182284"></a>Annotate</h4>

<p>
<a id="pgfId-1182285"></a>This option controls the level of detail in the Spectre output log. Selections to the left in the form have less detail in the Spectre output log. Selections to the right in the form have increasing levels of detail in the output log.</p>

<h4>
<a id="pgfId-1182289"></a>Freqaxis</h4>

<p>
<a id="pgfId-1182290"></a>Psp displays all the results on the same frequency scale. The default is <em>absin</em> (absolute value of the input frequency) If there is a negative input frequency, <em>in</em> will show that frequency on the negative frequency axis. <em>out</em> shows the output frequency range on the X axis.</p>

<h4>
<a id="pgfId-1182291"></a>AdditionalParams</h4>

<p>
<a id="pgfId-1182292"></a><em>additionalParams</em> is typically used for new features that are being beta tested. Entries in this field are <code>keyword=value</code> pairs.</p>
<p>
<a id="pgfId-1182293"></a>For more information about the other options, type <code>spectre -h psp</code> at the command prompt in a Unix shell window.</p>

<h2>
<a id="pgfId-1182295"></a>Examples</h2>

<p>
<a id="pgfId-1182299"></a>For this example, consider an LNA-Mixer circuit shown below.</p>

<p>
<a id="pgfId-1194937"></a></p>
<div class="webflare-div-image">
<img width="653" height="614" src="images/Chap4-584.gif" /></div>

<ol><li>
<a id="pgfId-1182300"></a>Set up the pss analysis. For more detail, see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1194979"></a><div class="webflare-div-image">
<img width="427" height="765" src="images/Chap4-585.gif" /></div></li><li>
<a id="pgfId-1182304"></a>In the psp <em>Choosing Analyses</em> form, define either an input or output frequency range in the frequency sweep range fields. It is usually easier to define an input frequency range, as shown below for a 2.4GHz application.<br />
<a id="pgfId-1195056"></a><div class="webflare-div-image">
<img width="392" height="675" src="images/Chap4-586.gif" /></div></li><li>
<a id="pgfId-1182310"></a>It is usually easier to define the frequency sweep range to be the input frequency range.</li><li>
<a id="pgfId-1182311"></a>Linear and log sweeps are provided. It is usually better to select linear or log, and specify the number of steps instead of using automatic. Automatic will run 50 frequency points, which usually is not needed for most applications.</li><li>
<a id="pgfId-1182316"></a>Now port and frequency definitions need to be made.<br />
<a id="pgfId-1195115"></a><div class="webflare-div-image">
<img width="437" height="678" src="images/Chap4-587.gif" /></div></li><li>
<a id="pgfId-1182317"></a>In the field just above the <em>Select Port </em>button, type 1 in the <em>Port #</em> field. Click <em>Select Port</em>, and select the input port.</li><li>
<a id="pgfId-1182318"></a>Click <em>Choose harmonic</em>. In the window that appears, select the input frequency range. and click OK.<br />
<a id="pgfId-1195178"></a><div class="webflare-div-image">
<img width="379" height="248" src="images/Chap4-588.gif" /></div></li><li>
<a id="pgfId-1182322"></a>Click <em>Add</em>. The port-frequency combination is added to the list. By convention, Port 1 defines the input frequency range for the psp analysis.<br />
<a id="pgfId-1195225"></a><div class="webflare-div-image">
<img width="386" height="680" src="images/Chap4-589.gif" /></div></li><li>
<a id="pgfId-1182332"></a>Now define the output port-frequency combination as Port 2.<br />
<a id="pgfId-1195334"></a><div class="webflare-div-image">
<img width="393" height="674" src="images/Chap4-590.gif" /></div></li><li>
<a id="pgfId-1182333"></a>Note that the frequency was selected by clicking <em>Choose Harmonic</em>, and selecting the output frequency range as shown below.<br />
<a id="pgfId-1195402"></a><div class="webflare-div-image">
<img width="418" height="249" src="images/Chap4-591.gif" /></div></li><li>
<a id="pgfId-1182337"></a>Next, click <em>Add</em>. This adds the port-frequency combination as Port 2 in the list. By convention, Port 2 defines the output frequency range for the psp analysis<br />
<a id="pgfId-1195452"></a><div class="webflare-div-image">
<img width="458" height="681" src="images/Chap4-592.gif" /></div></li><li>
<a id="pgfId-1182343"></a>Repeat the process to define Port 3 as the gain from RF to IF with no frequency translation. (The RF to IF isolation).<br />
<a id="pgfId-1195543"></a><div class="webflare-div-image">
<img width="425" height="679" src="images/Chap4-593.gif" /></div></li><li>
<a id="pgfId-1182348"></a>If you want a noise simulation, set <em>Maximum sideband</em> to the same value that was used for the LO or clock harmonics in the pss analysis. This is the same analysis as pnoise. For more information about pnoise, see the pnoise section in this chapter.</li><li>
<a id="pgfId-1182353"></a>Now run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in the ADE Explorer window.<br />
<a id="pgfId-1195714"></a><div class="webflare-div-image">
<img width="308" height="764" src="images/Chap4-594.gif" /></div></li><li>
<a id="pgfId-1195735"></a>Select <em>psp</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1182358"></a>To plot S-Parameters, select <em>SP</em> from the <em>Function</em> section. In this case, Port 1 is the input port at the RF frequency, Port 2 is the output port at the IF frequency, and Port 3 is the output port at the RF frequency. </li><li>
<a id="pgfId-1286206"></a>In the <em>Plot Type</em> section, several choices are available. The input match (S11) can be plotted on the Smith Chart. Select <em>Z-Smith</em> from the <em>Plot Type</em> section.</li><li>
<a id="pgfId-1286217"></a>Now, click the <em>S11</em> button. S11 appears on the Smith Chart.<br />
<a id="pgfId-1195810"></a><div class="webflare-div-image">
<img width="653" height="399" src="images/Chap4-595.gif" /></div>
<a id="pgfId-1182363"></a>The length of the vector from the center of the circle to the curve is the magnitude of the reflection coefficient. In the above plot, the input match becomes better at high frequency because the vector is shorter. Most LNAs are deliberately mismatched because a lower noise figure can typically be obtained with a small mismatch.</li><li>
<a id="pgfId-1182364"></a>There are two useful zoom functions for the Smith Chart. typing the f key fits the actual data to the Smith Chart. &lt;Shift&gt;-F fits the unit circle, as shown above.</li><li>
<a id="pgfId-1182369"></a>Now plot S21 on the Smith Chart. It displays outside of the unit circle.<br />
<a id="pgfId-1195851"></a><div class="webflare-div-image">
<img width="649" height="391" src="images/Chap4-596.gif" /></div></li><li>
<a id="pgfId-1182370"></a>Now plot S11, S21, S22, and S31 on a rectangular plot. The conversion gain is about 19.1dB. The input match is questionable. The output match is not good, but it does not matter because the output is at low frequency. The RF to IF isolation is about 84dB.<br />
<a id="pgfId-1195953"></a><div class="webflare-div-image">
<img width="650" height="416" src="images/Chap4-597.gif" /></div></li><li>
<a id="pgfId-1196037"></a>When you select Kf, because this is a 3-port analysis, the <em>Direct Plot Form</em> shows that Kf can not be plotted. Kf is defined for a 2-port simulation only. If you removed the RF to IF S-parameter measurement in this example, and converted to a 2-port simulation, you still would not be able to plot the data. Kf and B1f are defined only for amplifiers where the input and output frequency are the same.<br />
<a id="pgfId-1196051"></a><div class="webflare-div-image">
<img width="422" height="564" src="images/Chap4-598.gif" /></div></li></ol>













































































<h3>
<a id="pgfId-1182379"></a>Swept Input Power In a PA</h3>

<p>
<a id="pgfId-1182383"></a>For the next example, consider a power amplifier.</p>

<p class="webflare-indent1">
<a id="pgfId-1196152"></a></p>
<div class="webflare-div-image">
<img width="572" height="462" src="images/Chap4-599.gif" /></div>

<ol><li>
<a id="pgfId-1182384"></a>First, set up the pss analysis. In this case, the input power is swept. For more information, see the pss section at the beginning of this chapter.<br />
<a id="pgfId-1196187"></a><div class="webflare-div-image">
<img width="421" height="783" src="images/Chap4-600.gif" /></div></li><li>
<a id="pgfId-1182388"></a>Now define the input frequency and input port for psp. When a sweep is run in pss, the psp frequency sweep will switch to single point automatically.<br />
<a id="pgfId-1196275"></a><div class="webflare-div-image">
<img width="383" height="674" src="images/Chap4-601.gif" /></div></li><li>
<a id="pgfId-1182392"></a>Click <em>Choose Harmonic</em>. In the window that appears, select the input frequency and click <em>OK</em>.<br />
<a id="pgfId-1196425"></a><div class="webflare-div-image">
<img width="380" height="248" src="images/Chap4-602.gif" /></div></li><li>
<a id="pgfId-1196431"></a>Click <em>Add</em>. The port/frequency combination is entered in the list.<br />
<a id="pgfId-1196459"></a><div class="webflare-div-image">
<img width="419" height="674" src="images/Chap4-603.gif" /></div></li><li>
<a id="pgfId-1196435"></a>Repeat for the output port/frequency combination.<br />
<a id="pgfId-1196551"></a><div class="webflare-div-image">
<img width="384" height="674" src="images/Chap4-604.gif" /></div></li><li>
<a id="pgfId-1182406"></a>If you want a noise analysis, set <em>Maximum sideband</em> to the same value used for pss harmonics. This analysis is the same as pnoise. Please refer to the pnoise section earlier in this chapter for details.<br />
<a id="pgfId-1196638"></a><div class="webflare-div-image">
<img width="386" height="674" src="images/Chap4-605.gif" /></div></li><li>
<a id="pgfId-1182410"></a>Click <em>OK</em>, and run the simulation. When the simulation completes, select <em>Results</em> - <em>Direct Plot</em> - <em>Main Form</em> in ADE Explorer. The <em>Direct Plot Form</em> is displayed.<br />
<a id="pgfId-1196831"></a><div class="webflare-div-image">
<img width="312" height="696" src="images/Chap4-606.gif" /></div></li><li>
<a id="pgfId-1196832"></a>Select <em>pss</em> from the <em>Analysis</em> section.</li><li>
<a id="pgfId-1196833"></a>Plot the compression curve for the amplifier.</li><li>
<a id="pgfId-1182418"></a>The compression point is shown below.<br />
<a id="pgfId-1196916"></a><div class="webflare-div-image">
<img width="660" height="464" src="images/Chap4-607.gif" /></div></li><li>
<a id="pgfId-1182422"></a>Now plot stability factor from the psp results (Kf).<br />
<a id="pgfId-1196974"></a><div class="webflare-div-image">
<img width="429" height="569" src="images/Chap4-608.gif" /></div></li><li>
<a id="pgfId-1182426"></a>The plot displayed, as shown below.<br />
<a id="pgfId-1197023"></a><div class="webflare-div-image">
<img width="619" height="370" src="images/Chap4-609.gif" /></div></li><li>
<a id="pgfId-1182427"></a>To make the plot more usable, move your mouse cursor over one of the numbers on the X Axis, and click the right mouse button and select <em>Swap Sweep Var</em> from the context menu.<br />
<a id="pgfId-1197062"></a><div class="webflare-div-image">
<img width="178" height="210" src="images/Chap4-610.gif" /></div></li><li>
<a id="pgfId-1182434"></a>A new window appears. Type the frequency value in the X Value field and click OK.<br />
<a id="pgfId-1197161"></a><div class="webflare-div-image">
<img width="320" height="206" src="images/Chap4-611.gif" /></div>
<a id="pgfId-1182435"></a>Kf is plotted. The amplifier is stable when the gain is greater than one and the stability factor is greater than one.<br />
<a id="pgfId-1197191"></a><div class="webflare-div-image">
<img width="615" height="380" src="images/Chap4-612.gif" /></div>
<a id="pgfId-1182439"></a>B1f is also available. When B1f is greater than zero, and the gain is greater than one, the system is stable.<br />
<a id="pgfId-1197232"></a><div class="webflare-div-image">
<img width="663" height="346" src="images/Chap4-613.gif" /></div>
<a id="pgfId-1182443"></a>Both plots show increasing stability as the signal amplitude gets larger.</li></ol>











































































<ol><li>
<a id="pgfId-1079990"></a>Reltol: This value is used as a maximum value in the shooting window. The value used in the tstab interval is set by the option reltol.</li><li>
<a id="pgfId-1080016"></a>Lteratio: For conservative, 10 is used in the shooting window unless the option reltol is set to 1e-4*10/3.5 or smaller. If reltol is set to 1e-4*10/3.5 or smaller, lteratio defaults to 3.5. The value used for lteratio in the tstab interval is the same as that used in the shooting window.</li><li>
<a id="pgfId-1080060"></a>Reltol: This value is used as a maximum value in the shooting window. The value used in the tstab interval is set by the option reltol.</li><li>
<a id="pgfId-1080070"></a>Lteratio: For conservative, 10 is used in the shooting window unless the option reltol is set to 2.85e-4 or smaller. If 2.85e-4 or smaller is used, lteratio defaults to 3.5. The value used in the tstab interval is the same as that used in the shooting window.</li></ol>











<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="Chap3.html" id="prev" title="Frequency Domain Analyses: Harmonic Balance">Frequency Domain Analyses: Har ...</a></em></b><b><em><a href="Chap5.html" id="nex" title="Multiple Input Large and Small-signal Analyses">Multiple Input Large and Small ...</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2020, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>