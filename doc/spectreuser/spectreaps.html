
<html><head><title>The Spectre APS Circuit Simulator</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="kamal" />
<meta name="CreateDate" content="2020-06-16" />
<meta name="CreateTime" content="1592307309" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes the Spectre Circuit Simulator." />
<meta name="DocTitle" content="Spectre Classic Simulator, Spectre APS, Spectre X, and Spectre XPS User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="The Spectre APS Circuit Simulator" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-3.2" />
<meta name="Keyword" content="spectreuser" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2020-06-16" />
<meta name="ModifiedTime" content="1592307309" />
<meta name="NextFile" content="spectrex.html" />
<meta name="Order" content="1" />
<meta name="Group" content="Spectre Simulator" />
<meta name="Platform" content="Custom IC Design" />
<meta name="PrevFile" content="chap2.html" />
<meta name="c_product" content="Spectre" />
<meta name="Product" content="Spectre" />
<meta name="ProductFamily" content="Spectre" />
<meta name="ProductVersion" content="19.1" />
<meta name="RightsManagement" content="Copyright 2012-2020 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre Classic Simulator, Spectre APS, Spectre X, and Spectre XPS User Guide -- The Spectre APS Circuit Simulator" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="Version" content="19.1" />
<meta name="SpaceKey" content="spectreuser191" />
<meta name="webflare-version" content="2.0" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" /></head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="spectreuserTOC.html">Contents</a></li><li><a class="prev" href="chap2.html" title="Getting Started with the Spectre Circuit Simulator">Getting Started with the Spect ...</a></li><li style="float: right;"><a class="viewPrint" href="spectreuser.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="spectrex.html" title="The Spectre X Circuit Simulator">The Spectre X Circuit Simulato ...</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre Classic Simulator, Spectre APS, Spectre X, and Spectre XPS User Guide<br />Product Version 19.1, June 2020</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>3
<a id="pgfId-1033873"></a> <a id="59805"></a></h1>
<h1>
<a id="pgfId-1033875"></a><hr />
<a id="31762"></a>The Spectre APS Circuit Simulator<hr />
</h1>

<p>
<a id="pgfId-1034210"></a>In addition to the baseline simulation functionalities, Spectre supports the APS technology that provides significant performance gain and simulation capacity over the baseline Spectre simulation with minimum or no accuracy degradation.</p>
<p>
<a id="pgfId-1058118"></a>The Spectre&#174; APS technology contains newer and better performance technologies to further speed up device evaluation, particularly speeding up the matrix solving part of computation that often dominates large and postlayout circuit simulation.</p>
<p>
<a id="pgfId-1058119"></a>The Spectre APS technology supports multithreading on multi-core computer platforms.</p>
<p>
<a id="pgfId-1021303"></a>This chapter discusses the following:</p>
<ul><li>
<a id="pgfId-1021320"></a><a href="spectreaps.html#41544">Starting Spectre APS Simulations</a></li><li>
<a id="pgfId-1056446"></a><a href="spectreaps.html#85768">Getting More Performance from Spectre APS Simulation</a></li><li>
<a id="pgfId-1058227"></a><a href="spectreaps.html#42043">Specifying Multithreading Options</a></li><li>
<a id="pgfId-1058246"></a><a href="spectreaps.html#27710">Simulation Diagnostics</a></li><li>
<a id="pgfId-1056514"></a><a href="spectreaps.html#82310">Spectre XPS Mixed-Signal Design Simulation</a></li></ul>





<h2>
<a id="pgfId-1023094"></a><a id="41544"></a>Starting Spectre APS Simulations </h2>

<p>
<a id="pgfId-1023095"></a>To start a Spectre APS simulation, type the following at the command line:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021068"></a>% spectre +aps <code><em>commandline_options</em></code> ...</pre>

<p>
<a id="pgfId-1021351"></a>You can specify an errpreset value with the <code>+aps</code> command-line option to override the errpreset value in all transient analyses in the netlist. When the errpreset value is not specified with the <code>+aps</code> command-line option, the errpreset value in the analysis statement is used.</p>
<p>
<a id="pgfId-1021352"></a>For more information on the errpreset parameter, see <a href="chap7.html#73500">The errpreset Parameter</a>.</p>

<h4>
<a id="pgfId-1021353"></a>To run Spectre baseline: </h4>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021354"></a>% spectre [+errpreset=liberal | moderate | conservative &#8230;] input.scs </pre>
<h4>
<a id="pgfId-1021077"></a>To run Spectre with APS: </h4>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021078"></a>% spectre +aps[=liberal|moderate|conservative] netlist </pre>

<p>
<a id="pgfId-1021079"></a>or </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021080"></a>% spectre +aps [+errpreset=liberal|moderate|conservative] netlist </pre>
<h4><em>
<a id="pgfId-1021081"></a>Example</em></h4>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021082"></a>% spectre +aps=liberal adc.scs </pre>

<p>
<a id="pgfId-1021083"></a>In the above example, Spectre APS is launched using the liberal setting.</p>

<h2>
<a id="pgfId-1033363"></a><a id="85768"></a>Getting More Perf<a id="lite"></a>ormance from Spectre APS Simulation</h2>

<p>
<a id="pgfId-1033385"></a>Spectre APS uses identical simulation algorithms (numerical tolerance control, time step control, Newton iteration control, analytical device model, and so on) as baseline Spectre. It is designed to produce identical simulation results as baseline Spectre. Spectre is known to focus and produce accurate simulation results. Spectre APS preserves all of these numerical simulation algorithms and it is expected to produce a near identical simulation numerical noise floor as baseline Spectre. This tight accuracy correlation between baseline Spectre and Spectre APS does restrict some additional simulation performance.</p>
<p>
<a id="pgfId-1033738"></a>To further speed up simulation, you can use the <code>++aps</code> simulation mode. The <code>++aps</code> simulation mode has exactly the same use model and simulation feature coverage as default Spectre APS. You can start a <code>++aps</code> simulation, as follows:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1033739"></a>% spectre ++aps ...</pre>

<p>
<a id="pgfId-1033740"></a><code>++aps</code> supports the same <code>errpreset</code> parameters and uses the same numerical tolerance controls as baseline Spectre and Spectre APS. However, it is not restricted to use the same time step and Newton iteration control algorithms. The <code>++aps</code> simulation produces a similar simulation numerical noise floor as baseline Spectre and Spectre APS. </p>
<p>
<a id="pgfId-1033393"></a>Postlayo<a id="postlayoutsimulation"></a>ut simulation often poses a severe simulation performance challenge. It makes DC analysis difficult to converge and transient simulation much longer to complete. There are many numerical techniques available in Spectre to address these challenges, such as parasitic RC reduction, effective and accurate coupling capacitor handling, and specific DC algorithm for postlayout simulation. A simple <code>+postlayout</code> command-line option is available in Spectre for maximizing postlayout simulation performance. You can start a Spectre APS simulation on a postlayout design, as shown below.</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1036227"></a>% spectre ++aps +postlayout ...</pre>

<p>
<a id="pgfId-1042619"></a>To speed up the tra<a id="lopt"></a>nsient simulation for circuits containing a large number of mutual inductors, use the <code>+lopt</code> command-line option, as shown below.</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1042813"></a>% spectre +aps +lopt...</pre>

<p>
<a id="pgfId-1033397"></a>Circuit simulation performance is directly related to the core simulation engine, but often can be heavily skewed due to certain computationally-intensive simulation features, such as device checking asserts, and large amount of current and power probing. To assist simulation performance debugging, a lightweight (<code>+lite</code>) simulation setting that automatically strips away all of these computationally-intensive peripheral simulation features is available. You can enable the lightweight simulation, as follows:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1033399"></a>% spectre +aps +lite ...</pre>

<p>
<a id="pgfId-1042250"></a>To improve the simulation accuracy of hig<a id="highvoltage"></a>h-voltage circuits (where the maximum voltage is greater than 10 volts), or circuits that have convergence issues and report large capacitance values in the log file, you can set the <code>highvoltage</code> parameter in the <code>options</code> statement to <code>yes</code>.</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1042506"></a>opt1 options highvoltage=yes</pre>

<p>
<a id="pgfId-1046181"></a>Use this option with <code>moderate</code>/<code>liberal</code> mode, if the original simulation needs <code>conservative</code> mode to get accurate results.</p>
<p>
<a id="pgfId-1052092"></a>Designs having different ground voltages may have an impact on the simulation accuracy. You can use the <code>vrefgnd</code> parameter in the <code>options</code> statement to make the default simulation tolerance criteria same for such designs. For example:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1052398"></a>Opt options vrefgnd=gnd_node_name subckt=[sub1]</pre>

<p>
<a id="pgfId-1052428"></a>or</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1052436"></a>Opt options vrefgnd=gnd_node_name inst=[sub_inst1]</pre>
<h2>
<a id="pgfId-1021084"></a><a id="42043"></a>Specifying <a id="lsfsupport1011"></a>Multithreading Options </h2>

<p>
<a id="pgfId-1021085"></a>Spectre baseline, Spectre APS, Spectre X, and Spectre XPS S-mode technologies support multi-threaded computation on multi-core computer platforms. Spectre APS/XPS and Spectre X have better multithreading scaling compared to Spectre baseline technology.</p>
<p>
<a id="pgfId-1020861"></a>The default settings for multithreading are given below: </p>

<p>
<a id="pgfId-1020895"></a></p>
<table class="webflareTable" id="#id1020862">
<tbody><tr>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037487"></a>Simulator</p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1034618"></a><strong>Default Multithreading</strong></p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1034620"></a><strong>Default number of threads when Multithreading is on</strong></p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1034622"></a><strong>Maximum number of threads allowed</strong></p>
</th>
</tr>
<tr>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037489"></a>Spectre</p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037481"></a>Off</p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037483"></a>4</p>
</th>
<th class="webflareTh" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037485"></a>4</p>
</th>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037491"></a>Spectre APS</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1034624"></a>On</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1034626"></a>8</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1034628"></a>64</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1053719"></a>Spectre X</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1053721"></a>On</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1053723"></a>8</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1053725"></a>128</p>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037566"></a>Spectre XPS S-mode</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037568"></a>On</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037570"></a>8</p>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<p>
<a id="pgfId-1037572"></a>64</p>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1034633"></a>To turn off multithreading, use the following commands: </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1037497"></a>% spectre -mt ...</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021144"></a>% spectre +aps -mt ...</pre>

<p>
<a id="pgfId-1037514"></a>To turn on the multithreading feature in baseline Spectre, use the following command:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1037535"></a>% spectre +mt ...</pre>

<p>
<a id="pgfId-1037545"></a>There is no need to specify <code>+mt</code> for Spectre APS run because multithreading is on by default.</p>
<p>
<a id="pgfId-1037524"></a>To manually specify the number of threads to be used, instead of the default maximum threads, use the following command: </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1037515"></a>% spectre +mt=4 ...</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1037516"></a>% spectre +aps +mt=4 ... </pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1053782"></a>% spectre +preset=ax +mt=4...</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1029026"></a>% spectre +xps=s +mt=4 ...</pre>

<p>
<a id="pgfId-1021152"></a>When running multiple multithreading simulation sessions on a single machine, it is recommended that you fix the simulation session to particular cores. Otherwise, different sessions can race against each other to get the available cores, resulting in non-optimum simulation performance. For example, when running two 4-thread simulation sessions on an 8-core machine, you can start the simulation sessions as: </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021154"></a>% spectre +aps -processor 0-3 +mt=4 ...&#160;&#160;</pre>

<p>
<a id="pgfId-1021155"></a>and </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1021169"></a>% spectre +aps -processor 4-7 +mt=4 ... </pre>

<p>
<a id="pgfId-1029304"></a>Spectre supports various computer farm management tools, such as LSF, Sungrid engine, NetworkComputer, LoadLeveler, and netbatch with the following statement:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1022402"></a>% spectre +aps +mt=lsf | sge | nc | loadleveler | farm | netbatch... </pre>

<p>
<a id="pgfId-1026731"></a>where the Spectre session will use the number of cores allocated by the farm tools.</p>
<p>
<a id="pgfId-1033468"></a>To benefit from multithreading technology, a circuit should have at least 250 devices. When a circuit is too small, the multithreading option is turned off automatically.</p>
<p>
<a id="pgfId-1034688"></a>By default, multithreading runs in passive mode, which means that if there is no job in the queue, a thread becomes inactive until a job is added to the queue. This may impact simulation performance. You can use the <code>+mtmode=active</code> command-line option to keep the threads active at all times so that there is no performance loss.</p>

<h4>
<a id="pgfId-1036259"></a>Using the qu<a id="+query"></a>ery Option</h4>

<p>
<a id="pgfId-1036260"></a>The <code>+query</code> command-line option with possible values of <code>mtinfo</code>, <code>meminfo</code>, <code>all</code>, <code>alllic</code>, and <code>tokenlic </code>(default) enables you to get an estimate of the number of threads or licenses required to run a simulation without actually running the simulation. </p>
<ul><li>
<a id="pgfId-1034153"></a><code>mtinfo</code> - prints the recommended number of threads required to run the simulation in a multi-threaded environment.</li><li>
<a id="pgfId-1036276"></a><code>meminfo</code> - prints an estimate of the memory that would be required to run a design</li><li>
<a id="pgfId-1036305"></a><code>all</code> - prints both the number of threads and the estimate of memory that would be required to run a design.</li><li>
<a id="pgfId-1034164"></a><code>alllic</code> - prints all possible combination of licenses required to run a design.</li><li>
<a id="pgfId-1034171"></a><code>tokenlic</code> - prints the number of Spectre MMSIM tokens required to run the design. </li></ul>




<p>
<a id="pgfId-1034040"></a>Example</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1034180"></a>% spectre +query=mtinfo +aps input.scs.....</pre>
<h2>
<a id="pgfId-1029092"></a><a id="27710"></a>Simulation Diag<a id="simulation_diagnostics"></a>nostics</h2>

<p>
<a id="pgfId-1029114"></a>At times, you need additional debugging information to investigate the performance or convergence-related simulation issues. By default, the simulation log file now contains a pre-simulation summary and a post-transient simulation summary with suggestions on how to speed up the simulation further. In addition, you can use the Spectre command-line option, <code>+diagnose</code>, to dump additional debugging information into the simulation log file. The following is an example of using the <code>+diagnose</code> option:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1029116"></a>% spectre +aps +diagnose input.scs </pre>

<p>
<a id="pgfId-1029118"></a>The <code>+diagnose</code> option automatically enables the AHDL linter feature, and outputs the following additional information to the log file:</p>
<ul><li>
<a id="pgfId-1029121"></a>Convergence-related information for time steps less than 1ps. This can be controlled by using the <code>warnminstep</code> option.</li><li>
<a id="pgfId-1029122"></a>A summary containing statistics about time steps, nodes with convergence issues, and node or device activity information.</li></ul>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1029125"></a>The <code>+diagnose</code> option has minimal impact on the simulation time, however, it generates a lot of information and may not be appropriate for general use.</div>

<h2>
<a id="pgfId-1031631"></a><a id="82310"></a>Spectre XPS Mixed-Sign<a id="msmode"></a>al Design Simulation</h2>

<p>
<a id="pgfId-1031832"></a>The Spectre XPS Mixed-Signal (MS) simulation mode delivers a high-performance transistor-level multi-rate simulation solution by combining a highly accurate SPICE engine (Spectre APS) together with a fast digital simulation engine (Spectre XPS). The identification between the analog and digital portions of the circuit is done automatically, with the added flexibility for advanced users to optimize it.</p>
<p>
<a id="pgfId-1034260"></a>The Spectre XPS MS is fully integrated into the Spectre binary sharing the same product infrastructure with Spectre, Spectre APS, and Spectre XPS. The use model is identical to that of Spectre, with the netlist syntax, device models, analysis setups, and output formats being fully compatible.</p>
<p>
<a id="pgfId-1034852"></a>Spectre XPS MS speeds up both pre-layout and postlayout simulations. The supported postlayout simulation flows are: Virtuoso extracted view, included DSPF, backannotated DSPF/SPEF, and flat postlayout SPICE and Spectre netlist files.</p>
<p>
<a id="pgfId-1034261"></a>Spectre XPS MS supports most Spectre transient features including save, ic, nodeset, measure, vec/vcd, asserts, static design checks, selective dynamic design checks, RC reduction, and EMIR. Spectre XPS MS also supports dynamic parameters. However, dynamic parameters are supported only for the analog partition (APS). For more information on dynamic parameters, refer to the <em><a actuate="user" class="URL" href="../spectreref/chap3.html#dynTran" show="replace" xml:link="simple">Dynamic Parameters during Transient Analysis</a></em> section in the <em>Spectre Circuit Simulator Reference</em> manual.</p>
<p>
<a id="pgfId-1058664"></a>Advanced simulation features, such as info, alter, device reliability, and monte carlo are currently not supported, however, support for these features will be added incrementally in future releases. </p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1031872"></a>The XPS MS mode has been integrated into the Analog Design Environment (ADE) and is available starting with the IC6.1.6 ISR6 release.</div>

<h3>
<a id="pgfId-1031634"></a>Starting an XPS MS Simulation Run</h3>

<p>
<a id="pgfId-1031635"></a>You can invoke the Spectre XPS MS mode using the Spectre binary with the following command:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031636"></a>% spectre +ms input.scs &#8230;</pre>

<p>
<a id="pgfId-1031637"></a>You can specify the <code>errpreset</code> setting at the command line, with <code>+aps=liberal</code> being the default setting.</p>
<p>
<a id="pgfId-1031638"></a>When the Spectre XPS MS mode is enabled, a message is displayed in the log file stating the same.</p>
<p>
<a id="pgfId-1040158"></a>When using a SPICE runset, add the <code>+spice</code> option to ensure that the netlist convention and device models are interpreted in a consistent manner as traditional SPICE, instead of Spectre. For large mixed signal applications, it is recommended to use the 64-bit version of the tool with the <code>-64</code> option.</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1040192"></a>% spectre +ms +spice -64 input.sp &#8230;</pre>

<p>
<a id="pgfId-1031641"></a>The Spectre XPS MS mode supports multithreading on multicore machines. The multithreading use model and behavior are identical to Spectre APS.</p>

<h3>
<a id="pgfId-1031642"></a>Adjusting XPS MS Speed and Accuracy</h3>

<p>
<a id="pgfId-1031643"></a>The Spectre XPS MS mode supports all performance and accuracy settings of Spectre APS for the analog portion simulation. The default <code>errpreset</code> setting is <code>liberal</code>, which is sufficient for the functional verification of most mixed-signal designs.</p>
<p>
<a id="pgfId-1031644"></a>The simulation speed and accuracy of digital portions in the Spectre XPS MS mode can be controlled by the command-line option <code>speed=0/1/2/3</code>. The default value is <code>2</code>, which is sufficient for most applications. Use <code>speed=0</code> for more accurate timing and power simulation of digital portions. <code>speed=1</code> is a little faster than <code>speed=0</code>. Use <code>speed=3</code> for fastest digital verification, however, this may have an impact on accuracy.</p>
<p>
<a id="pgfId-1031645"></a>The following example shows the combination of analog options (<code>++aps=liberal</code>) with digital options (<code>speed=3</code>):</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031646"></a>% spectre +ms ++aps=liberal +speed=3 input.scs</pre>
<h3>
<a id="pgfId-1031647"></a>Digital Partitioning and Virtual Power Nodes</h3>

<p>
<a id="pgfId-1031648"></a>The Spectre XPS MS mode automatically detects the digital functions in a given circuit. For cases where a design has explicit hierarchical digital or analog functions, you can manually identify the functional blocks (subcircuit, instance) by using the following Spectre options:</p>
<p>
<a id="pgfId-1038088"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031649"></a>optD options cktpreset=digital subckt=[dig_ctrl pll]</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031650"></a>optA options cktpreset=analog subckt=[opamp adc]</pre>

<p>
<a id="pgfId-1031651"></a>or</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031652"></a>optD options cktpreset=digital inst=[x1.xdig_ctrl x1.xpll]</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031653"></a>optA options cktpreset=analog inst=[x2.xopamp x2.xadc]</pre>

<p>
<a id="pgfId-1031654"></a>SPICE format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038114"></a>.options cktpreset=digital subckt=[dig_ctrl pll]</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038115"></a>.options cktpreset=analog subckt=[opamp adc]</pre>

<p>
<a id="pgfId-1038116"></a>or</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038117"></a>.options cktpreset=digital inst=[x1.xdig_ctrl x1.xpll]</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038118"></a>.options cktpreset=analog inst=[x2.xopamp x2.xadc]</pre>

<p>
<a id="pgfId-1038099"></a>Digital detection works seamlessly for digital circuitry with ideal DC power supplies or identified virtual power supplies. The MS mode not only detects the virtual power supplies (that is, internal VDD generator) in the design automatically, but also provides the flexibility to define the virtual power supply nodes manually. The log file provides information on the nodes that are identified as power/ground supplies and other nodes that are potential power/ground supplies. A sample log file report is shown below.</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035124"></a>Digital Detection Vsource and Virtual Power Supply Node Summary</pre>
<table class="webflareTable" id="#id1035027">
<tbody><tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035029"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035031"></a>Type</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035033"></a>#CC</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035035"></a>#Bulk</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035037"></a>Voltage</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035039"></a>Name</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035041"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035043"></a>GND</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035045"></a>17239</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035047"></a>34021</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035049"></a>0</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035051"></a>0</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035053"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035055"></a>VSOURCE</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035057"></a>16934</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035059"></a>20923</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035061"></a>3.3</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035063"></a>AVDD</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035065"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035067"></a>VPN</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035069"></a>3798</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035071"></a>2301</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035073"></a>1.9</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035075"></a>VDIG</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035077"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035079"></a>VGND</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035081"></a>3951</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035083"></a>342</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035085"></a>0</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035087"></a>VGND1</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035089"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035091"></a>Possible</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035093"></a>202</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035095"></a>50</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035097"></a>TBD</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035099"></a>I1.VDD_DIG</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035101"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035103"></a>Possible</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035105"></a>310</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035107"></a>23</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035109"></a>TBD</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035111"></a>I1.RF_VDD</pre>
</td>
</tr>
<tr>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035113"></a></pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035115"></a>Possible</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035117"></a>311</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035119"></a>31</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035121"></a>TBD</pre>
</td>
<td class="webflareTd" colspan="1" rowspan="1">
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035123"></a>I1.VSS</pre>
</td>
</tr>
</tbody></table>

<p>
<a id="pgfId-1035154"></a>For the detected nodes, the table reports the node type, the number of channel connections (#CC), the number of bulk connections (#Bulk), the node voltage, and the node name. The following node types are reported:</p>
<ul><li>
<a id="pgfId-1035155"></a>GND - ground node. </li><li>
<a id="pgfId-1035156"></a>VSOURCE - ideal power supply node. </li><li>
<a id="pgfId-1035157"></a>VPN - virtual power supply node</li><li>
<a id="pgfId-1035158"></a>VGND - virtual ground node. </li><li>
<a id="pgfId-1035159"></a>Possible - potential power/ground supplies </li></ul>




<p>
<a id="pgfId-1035146"></a>Nodes of type <code>GND</code>, <code>VSOURCE</code>, <code>VPN</code>, and <code>VGND</code> are used as power supply and ground nodes when detecting digital circuitry. The <code>Possible</code> type refers to potential power/ground supplies that are not used for digital circuit detection.</p>
<p>
<a id="pgfId-1031690"></a>You can define the virtual power supply nodes manually by using the <code>ms_vpn</code> option that defines the pairs of node names (wildcard is supported) and voltage values. The virtual ground nodes can be defined using the <code>ms_vgnd</code> option. The ground voltage is assumed to be 0V.</p>
<p>
<a id="pgfId-1038138"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031691"></a>opt1 options ms_vpn = [I1.VDD_DIG 1.8 I1.VDD_DIG1 3.3]</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031692"></a>opt3 options ms_vgnd = [I1.VSS]</pre>

<p>
<a id="pgfId-1038179"></a>SPICE format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038187"></a>.options ms_vpn = [I1.VDD_DIG 1.8 I1.VDD_DIG1 3.3]</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038188"></a>.options ms_vgnd = [I1.VSS]</pre>

<p>
<a id="pgfId-1038181"></a>If required, you can define the global virtual power supply voltage by using the <code>ms_vpnv</code> option, as shown below.</p>
<p>
<a id="pgfId-1038249"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031694"></a>opt2 options ms_vpnv = 1.2</pre>

<p>
<a id="pgfId-1038228"></a>SPICE format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038229"></a><code>.options ms_vpnv = 1.2</code></pre>

<p>
<a id="pgfId-1038216"></a>The default global value is 1.8V.</p>
<p>
<a id="pgfId-1034725"></a>In case the virtual power supply voltage is not known, you can use the <code>auto_vpn</code> option to enable Spectre to detect the voltage automatically, as shown below.</p>
<p>
<a id="pgfId-1038205"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1034727"></a>opt4 options ms_vpn = [I1.VDD_DIG auto_vpn I1.RF_VDD auto_vpn]</pre>

<p>
<a id="pgfId-1038283"></a>SPICE format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038284"></a>.options ms_vpn = [I1.VDD_DIG auto_vpn I1.RF_VDD auto_vpn]</pre>

<p>
<a id="pgfId-1038285"></a>The maximum voltage for the device models in the digital simulation engine is detected automatically. If required, it can be set using the <code>vdd</code> option, as shown below.</p>
<p>
<a id="pgfId-1032598"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038305"></a>opt4 options vdd = 1.8</pre>

<p>
<a id="pgfId-1032619"></a>SPICE format:</p>
<p>
<a id="pgfId-1038322"></a>.options vdd = 1.8</p>
<p>
<a id="pgfId-1038315"></a>The default value is 3.3V.</p>

<h3>
<a id="pgfId-1031696"></a>XPS XPS MS DC Operating Point Calculation</h3>

<p>
<a id="pgfId-1031697"></a>The Spectre XPS MS mode calculates the DC operating point before performing the transient simulation. By default, the DC operating point for the entire circuit is calculated by Spectre APS (<code>+msdc=aps</code>). For cases where the Spectre APS operating point calculation takes too long, you can enable the mixed-signal DC calculation &#8211; Spectre APS for the analog partition and Spectre XPS for the digital partition, by using the <code>+msdc=ms</code> command-line option, as shown below.</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031698"></a>% spectre +ms +msdc=aps input.scs </pre>

<p>
<a id="pgfId-1040711"></a>The above command calculates the DC operating point using Spectre APS.</p>
<p>
<a id="pgfId-1031699"></a>% spectre +ms +msdc=ms input.scs </p>
<p>
<a id="pgfId-1040727"></a>The above command enables the mixed-signal DC calculation.</p>

<h3>
<a id="pgfId-1040041"></a>Spectre XPS MS Current Accuracy</h3>

<p>
<a id="pgfId-1040753"></a>When using ideal or strong virtual power supplies, Spectre XPS MS properly calculates the current consumption based on the active and leakage currents of all driven analog and digital blocks. </p>
<p>
<a id="pgfId-1040754"></a>However, when the virtual power supplies are weak, the following time window-based options may be used to obtain accurate current values: </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1040774"></a>opt1 options ms_vpni_start=1u ms_vpni_stop=10u </pre>

<p>
<a id="pgfId-1040775"></a>Since these options significantly impact the simulation performance, it is recommended to define the time window as small as possible. In addition, it is recommended not to enable these options during the ramp-up period. </p>

<h3>
<a id="pgfId-1031700"></a>Handling Macro Device Models</h3>

<p>
<a id="pgfId-1035256"></a>The Spectre XPS MS mode, by default, effectively recognizes device models including BSIM3V3, BSIM4, BSIMCMG, BSIMSOI, PSP, and so on. Device recognition enables digital detection that is critical to ensure that the Spectre XPS MS mode gets the best possible simulation performance. Even complicated device macro models with more than four terminals and additional elements (resistors, capacitors, parasitic diodes, parasitic BJT&#39;s) are automatically handled, if the first four terminals are the primary MOSFET <code>d</code> <code>g</code> <code>s</code> <code>b</code> terminals. </p>
<p>
<a id="pgfId-1035257"></a>Complex elements with Verilog-A, behavior source (bsource), or multiple MOSFET elements inside require you to explicitly define the name of the macro model subcircuit, as follows:</p>
<p>
<a id="pgfId-1038341"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1031706"></a>opt1 options macro_mos=[mos1 mos2]</pre>

<p>
<a id="pgfId-1031708"></a>SPICE format:</p>
<p>
<a id="pgfId-1038368"></a>.options macro_mos=[mos1 mos2]</p>
<p>
<a id="pgfId-1038361"></a>Here, <code>mos1</code> and <code>mos2</code> are subcircuit definition names for macro device models.</p>
<p>
<a id="pgfId-1034017"></a>If the first four terminals of the macro model are not d g s b, then the default macro model handling does not work. The required port detection and handling for such macro models can be enabled with the following option:</p>
<p>
<a id="pgfId-1038387"></a>Spectre format:</p>
<p>
<a id="pgfId-1035274"></a>opt1 options macro_mos_wrapper=yes</p>
<p>
<a id="pgfId-1038422"></a>SPICE format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038423"></a>.options macro_mos_wrapper=yes</pre>
<h3>
<a id="pgfId-1038424"></a>XPS MS Postlayout Simulation</h3>

<p>
<a id="pgfId-1034283"></a>The Spectre XPS MS mode supports different postlayout simulation flows (Virtuoso extracted view, included DSPF files, and flat postlayout SPICE and Spectre netlist files), as well as DSPF/SPEF backannotation.</p>

<h4>
<a id="pgfId-1034286"></a>Non-backannotation Postlayout Simulation Flow</h4>

<p>
<a id="pgfId-1035302"></a>You can enable the Spectre XPS MS postlayout simulation by using the <code>+postlayout</code> command-line option, as follows:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1036158"></a>spectre +ms +postlayout input.scs</pre>

<p>
<a id="pgfId-1040215"></a>The flow automatically enables RC reduction, optimized RC element handling, and DC algorithms. You can set RC reduction in the analog portion simulation to be more conservative (<code>+postlayout=hpa</code>).</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1040217"></a>spectre +ms +postlayout=hpa input.scs</pre>
<h4>
<a id="pgfId-1036161"></a>DSPF/SPEF Backannotation</h4>

<p>
<a id="pgfId-1035350"></a>The alternative DSPF/SPEF backannotation flow is enabled with the DSPF/SPEF backannotation options. This flow does not require the <code>+postlayout</code> command-line option.</p>
<p>
<a id="pgfId-1038444"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035351"></a>Opt1 options spf=&#8221;I1 pll.spf</pre>
<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035352"></a>Opt2 options spef=&#8221;I1 pll.spef</pre>

<p>
<a id="pgfId-1035353"></a>SPICE format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1038466"></a>.options spf=&#8221;I1 pll.spf</pre>

<p>
<a id="pgfId-1038458"></a>.options spef=&#8221;I1 pll.spef</p>
<p>
<a id="pgfId-1038451"></a>All RC backannotation-related Spectre options, such as <code>spfscale</code>, <code>spfxtorprefix</code>, and <code>spfaliasterm</code> are supported. If RC reduction is required, it can be enabled as part of the backannotation process (<code>spfrcr</code>, <code>spfrcrfmax</code>). For more information on these options, refer to <a href="chap13.html#63139">Parsing Options Used in Backannotation</a>.</p>
<p>
<a id="pgfId-1035325"></a>The Spectre MS logfile provides two backannotation reports. The first report summarizes the RC elements backannotated to the digital partitions, while the second report summarizes the RC elements backannotated to the analog partitions.</p>
<p>
<a id="pgfId-1040265"></a>When using Spectre XPS MS for postlayout designs <code>+speed=3</code> is not recommended. For accuracy comparison Spectre APS without RC reduction is recommended as the golden reference. The performance of Spectre XPS with <code>+postlayout</code> should be compared against Spectre APS with <code>+postlayout</code>.</p>

<h3>
<a id="pgfId-1035403"></a>Spectre MS Partitioning Report</h3>

<p>
<a id="pgfId-1035417"></a>Spectre XPS MS provides the ability to print a partitioning report. The report provides information about the analog and digital portions of each subcircuit instance with more than 50 elements. </p>
<p>
<a id="pgfId-1035446"></a>To print the partitioning report, use the <code>ms_part_report=</code><span class="webflare-courier-new" style="white-space:pre"><em>depth</em></span> option as follows:</p>
<p>
<a id="pgfId-1038482"></a>Spectre format:</p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1035462"></a>opt1 options ms_part_report=10</pre>

<p>
<a id="pgfId-1035484"></a>SPICE format:</p>
<p>
<a id="pgfId-1038496"></a>.options ms_part_report=10</p>
<p>
<a id="pgfId-1038489"></a>Here, <span class="webflare-courier-new" style="white-space:pre"><em>depth</em></span> is the hierarchical depth counted from top level (<code>depth=0</code>). The partition report is written to a file with the extension <code>_partition.rpt</code>. </p>
<p>
<a id="pgfId-1035522"></a>The following is an example of the partitioning report:</p>

<p>
<a id="pgfId-1039270"></a></p>
<div class="webflare-div-image">
<img width="668" height="338" src="images/spectreaps-2.gif" /></div>

<p>
<a id="pgfId-1058187"></a></p>

<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="chap2.html" id="prev" title="Getting Started with the Spectre Circuit Simulator">Getting Started with the Spect ...</a></em></b><b><em><a href="spectrex.html" id="nex" title="The Spectre X Circuit Simulator">The Spectre X Circuit Simulato ...</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2020, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
</body></html>