
<html><head><title>Using the AMS Designer Simulator for Design Verification</title>
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jommy" />
<meta name="CreateDate" content="2019-11-04" />
<meta name="CreateTime" content="1572864911" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes the Virtuoso AMS Designer simulator, a mixed-signal simulator that supports the Verilog-AMS and VHDL-AMS language standards." />
<meta name="DocTitle" content="Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Using the AMS Designer Simulator for Design Verification" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="FileType" content="Chapter" />
<meta name="Keyword" content="amssimug" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2019-11-04" />
<meta name="ModifiedTime" content="1572864911" />
<meta name="NextFile" content="Designing_with_Multiple_Power_Supplies.html" />
<meta name="Group" content="Analog Mixed-Signal Simulation" />
<meta name="Platform" content="Functional Verification" />
<meta name="PrevFile" content="Using_xrun_for_AMS_Simulation.html" />
<meta name="Product" content="Xcelium" />
<meta name="ProductFamily" content="Functional Verification" />
<meta name="ProductVersion" content="19.09" />
<meta name="RightsManagement" content="Copyright 2012-2019 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide -- Using the AMS Designer Simulator for Design Verification" />
<meta name="Version" content="19.09" />
<meta name="Renderer" content="WIKI" />
<meta name="SpaceKey" content="amssimug2003" />
<meta name="confluence-version" content="6.13.3" />
<meta name="ecms-plugin-version" content="03.30.005" />
<script type="text/javascript" src="styles/shCore1.js">/*<![CDATA[*//*]]>*/</script><script type="text/javascript" src="styles/shCore.js">/*<![CDATA[*//*]]>*/</script><script type="text/javascript" src="styles/shBrushCpp.js">/*<![CDATA[*//*]]>*/</script><script type="text/javascript" src="styles/shBrushJava.js">/*<![CDATA[*//*]]>*/</script><link rel="stylesheet" href="styles/shCoreDefault.css" type="text/css" /><script type="text/javascript">/*<![CDATA[*/
SyntaxHighlighter.all();
/*]]>*/</script>
        
        <link href="styles/site.css" rel="stylesheet" type="text/css" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    

    </head><body style="background-color: #FFFFFF;"><!-- Begin Buttons --><header xmlns:html="http://www.w3.org/1999/xhtml"><div class="docHeadr">Product Documentation<img src="images/Cadence-Logo.jpg" /></div>
<nav class="blueHead"><ul><li><a class="content" href="amssimugTOC.html">Contents</a></li><li><a class="prev" href="Using_xrun_for_AMS_Simulation.html" title="Using_xrun_for_AMS_Simulation">Using_xrun_for_AMS_Simulation</a></li><li style="float: right;"><a class="viewPrint" href="amssimug.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="Designing_with_Multiple_Power_Supplies.html" title="Designing_with_Multiple_Power_Supplies">Designing_with_Multiple_Power_ ...</a></li></ul></nav></header><!-- End Buttons --><div xmlns:html="http://www.w3.org/1999/xhtml" style="font-size:14px;line-height:1.42857142857;margin:20px 0 0 0;font-weight:bold;"><center>Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide<br />Product Version 19.09, September 2019</center></div>
<div xmlns:html="http://www.w3.org/1999/xhtml" style="margin-left:5%;">
<p></p>

<p></p>
<div id="main-header">
                    
                    
                                                <div style="width: 100%; font-size: 32px; text-align: left;               font-weight: bold;">11</div>
<h1 style="margin: 4px 0 4px;"><span>Using the AMS Designer Simulator for Design Verification</span></h1>

                    
                </div>
<div class="wiki-content group" id="main-content">
                    
<p><span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1031602"></span></p>

<p>You can use the AMS Designer simulator for mixed-signal simulation in your system-on-chip (SoC) design verification process. You can run&#160;<code><a href="Using_xrun_for_AMS_Simulation.html">xrun</a></code>&#160;to simulate designs containing digital and analog design units. xrun supports hardware description languages such as Verilog and Verilog-AMS, and analog netlist formats such as SPICE and Spectre. You can incorporate SPICE blocks into otherwise Verilog-centric simulations. The program sends analog portions directly to the analog engine for parsing and elaboration. You can perform checks and measurements on design considerations such as dynamic power consumption and current leakage.</p>

<p>See the following topics for more information:</p>

<p></p>
<div class="toc-macro rbtoc1572864886127">
<ul class="toc-indentation">
<li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaTestbenchtestbenchcreation1039922">Creating a Testbench</a></li>
<li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaRunScriptforxrunirunScript1040114">Creating a Run Script for xrun &#160;</a></li>
<li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-BindingPortsbindingPortsportMapping1041471">Binding Ports &#160; &#160;</a></li>
<li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaCustomizedPort-BindFileportbindFile1041878">Creating a Customized Port-Bind File &#160;</a></li>
</ul>
</div>

<p>For better yield ratio during chip design, you might want to replace some Verilog modules with corresponding SPICE or Spectre subcircuits to achieve device-accurate simulation results during design verification. You can use a port-bind file to specify how you want the software to map port names (scalars and buses) when you replace a Verilog module with a SPICE or Spectre equivalent. You can also reference the original Verilog file so that the software can map the SPICE or Spectre ports by order.</p>

<p>See the following topics for more information:</p>
<ul><li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041471"> Binding Ports </a></li></ul><ul><li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041878"> Creating a Customized Port-Bind File </a></li></ul><h2 id="UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaTestbenchtestbenchcreation1039922">Creating a Testbench<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-testbenchcreation"></span> <span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1039922"></span></h2>

<p>The major tasks for creating a testbench are as follows:</p>
<ol><li>
<p>Create a top level for your design by connecting and instantiating the digital and analog components.<br />In the following excerpt, wires<code> vcoclk</code>, <code>clock_2</code>, <code>clock_1</code>, <code>clock_0</code>, <code>net036</code>, and <code>p0</code> connect to the digital instances (<code>counter</code> and <code>divider</code>) and the analog instance (<code>pll_top)</code>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">// Testbench` 
timescale 1ps/1ps 
module testbench (); 

... 
wire vcoclk, clock_2, clock_1, clock_0, net036, p0; 

... 
counter counter (reset, vcoclk, clock_2, clock_1, clock_0); 
divider divider (vcoclk, net036, p0, reset); 
pll_top pll_top (refclk, reset, vcoclk, clock_2, clock_1, clock_0, net036, p0, clk_p0_1x, clk_p0_4x); 

endmodule</pre>
</div>
</div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>In a testbench file, you do not have to declare the<code>&#160;electrical&#160;</code>discipline for any wires even when you use them to connect to the ports of analog instances. You therefore do not need to include the<code>&#160;disciplines.vams&#160;</code>file.</p>
</div>
</div>
</li><li>
<p>Create the stimuli to the device under test (<a href="Glossary.html#Glossary-1033769">DUT</a>).<br />In the following excerpt, we add reset and <code>refclk</code>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">// Testbench`
timescale 1ps/1ps


module testbench ();
reg reset;reg refclk;
...
wire vcoclk, clock_2, clock_1, clock_0, net036, p0;

initial begin
    reset=1;
    #200 reset=0;
end

initial begin
    refclk=0;
    #200 refclk=1;
end
always #2500 refclk=~refclk;
...                                           
counter counter (reset, vcoclk, clock_2, clock_1, clock_0);
divider divider (vcoclk, net036, p0, reset);
pll_top pll_top (refclk, reset, vcoclk, clock_2, clock_1, clock_0, net036, p0, clk_p0_1x, clk_p0_4x);

endmodule</pre>
</div>
</div>
</li><li>(Optional) Monitor or self-check the output.<br />You can monitor the output by adding<code> $monitor </code>to your module definition:<code> <br />initial begin<br />&#160;&#160;&#160;&#160;$monitor (y);<br />end<br /> </code>See also &quot;<a href="Preparing_the_Design__Using_Mixed_Languages.html">Reusing Mixed-Language Testbenches</a>&quot;.</li></ol><h2 id="UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaRunScriptforxrunirunScript1040114">Creating a Run Script for xrun<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-irunScript"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1040114"></span></h2>

<p>When creating an&#160;<span style="color: rgb(0,0,255);font-family: &quot;Courier New&quot;;font-size: small;"> <a href="Using_xrun_for_AMS_Simulation.html">xrun</a>&#160;</span>run script for design verification, you need to specify the following items on the<code> xrun </code>command line:</p>
<div class="table-wrap"><table border="0" cellpadding="4" cellspacing="0" class="wrapped confluenceTable" style="width: 648.0px;"><colgroup><col /><col /><col /></colgroup><tbody><tr><th class="confluenceTh" valign="middle" width="240">
<p>Item/Option</p>
</th><th class="confluenceTh" valign="middle" width="48">
<p><br /></p>
</th><th class="confluenceTh" valign="middle" width="360">
<p>Example</p>
</th></tr>
<tr><td class="confluenceTd" valign="top">
<p>Digital design inputs</p>
</td>
<td class="confluenceTd" valign="top">
<p><code> xrun </code></p>
</td>
<td class="confluenceTd" valign="top">
<p><code>./source/digital/*.v \ </code></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p><a href="Using_an_amsd_Block.html">AMS control file</a></p>
</td>
<td class="confluenceTd" valign="top">
<p><br /></p>
</td>
<td class="confluenceTd" valign="top">
<p><code>amsdcb.scs \ </code></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041177">Analog solver control file</a></p>
</td>
<td class="confluenceTd" valign="top">
<p><br /></p>
</td>
<td class="confluenceTd" valign="top">
<p><code>top.scs \ </code></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p>UltraSim solver switch</p>
</td>
<td class="confluenceTd" valign="top">
<p><br /></p>
</td>
<td class="confluenceTd" valign="top">
<p><a href="Using_the_AMS_Designer_Simulator_for_Design_Verification.html"> <code>-amsfastspice</code> </a> <span style="color: rgb(0,0,0);font-family: &quot;Courier New&quot;;font-size: small;">\</span></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p>Timescale for undefined Verilog modules</p>
</td>
<td class="confluenceTd" valign="top">
<p><br /></p>
</td>
<td class="confluenceTd" valign="top">
<p><code>-timescale 1ns/100ps \ </code></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1039705">Tcl probe on behavioral nodes</a></p>
</td>
<td class="confluenceTd" valign="top">
<p><br /></p>
</td>
<td class="confluenceTd" valign="top">
<p><code>-input probe.tcl </code></p>
</td>
</tr>
</tbody></table></div>

<p>Some things to note:</p>
<ul><li>You specify the AMS control file on the command line, just like any other input file.</li></ul><ul><li>You specify the analog control file on the command line, just like any other input file.</li></ul><ul><li>
<p>You do not need to specify any connect rules (<code>
        <a href="Using_xrun_for_AMS_Simulation.html#UsingxrunforAMSSimulation-1064061">-amsconnrules</a>
      </code>) when you have an&#160;<span style="color: rgb(0,0,255);font-family: &quot;Courier New&quot;;font-size: small;"> <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1051785">ie</a>&#160;</span>statement in an<code> amsd </code>block.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>If you do use a connect rules file, you can specify it as a regular input file, directly on the command line.</p>
</div>
</div>
</li></ul><ul><li>You include your model files in the AMS control file. For example:<code> <br />include &quot;./models/resistor.scs&quot; section=res <br />include &quot;./models/diode.scs&quot; section=dio <br />include &quot;./models/pmos1.scs&quot; section=nom <br />include &quot;./models/nmos1.scs&quot; section=nom </code></li></ul>
<p>See also</p>
<ul><li><a href="Using_an_amsd_Block.html#UsinganamsdBlock-1038666"> Using an amsd Block </a></li></ul><ul><li><a href="Using_xrun_for_AMS_Simulation.html#UsingxrunforAMSSimulation-1038257"> xrun Command Syntax </a></li></ul><ul><li><a href="Using_xrun_for_AMS_Simulation.html#UsingxrunforAMSSimulation-1044107"> xrun Command-Line Options for AMS </a></li></ul><ul><li><span style="color: rgb(0,0,255);"> <a class="message-url" href="../xrun/xrunTOC.html">xrun User Guide</a> </span></li></ul><h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaTclFiletoProbeBehavioralNodesTclProbeDigital1039705">Creating a Tcl File to Probe Behavioral Nodes<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-TclProbeDigital"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1039705"></span></h3>

<p>To probe behavioral nodes and save that information to a database file called<code> waves.shm </code>, you might create a Tcl file (<code> probe.tcl </code>) containing commands such as the following:</p>

<p><code> database -open waves -into waves.shm -defaultprobe -create -database waves -all -depth allprobe -create -database waves testbench.refclkprobe -create -database waves testbench.clk_p0_1xprobe -create -database waves testbench.clk_p0_4xprobe -create -database waves testbench.p0</code></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>You can also specify simulation control commands (such as <code><a href="Appendix_B__Tcl-Based_Debugging.html#AppendixB:Tcl-BasedDebugging-1033517">run</a></code>) in a Tcl file.</p>
</div>
</div>
<h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-CreatingAnalogProbesintheAnalogControlFileanalogProbes1041177">Creating Analog Probes in the Analog Control File<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-analogProbes"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041177"></span></h3>

<p>In addition to specifying&#160;<a href="Specifying_Controls_for_the_Analog_Solvers.html">analog simulation control statements</a>, you can use the UltraSim&#160;<span style="color: rgb(0,0,255);font-family: &quot;Courier New&quot;;font-size: small;"> <a href="Specifying_Controls_for_the_Analog_Solvers.html">.probe</a>&#160;</span>statement to specify analog probes. For example:</p>

<p><code> ***********************************<br />simulator lang=spice lookup=spectre<br />***********************************<br />*--------------------------------------------------------*<br />* UltraSim Analysis Options<br />*--------------------------------------------------------*<br />.tran 1ns 200ns<br />*--------------------------------------------------------*<br />* UltraSim Simulator Options<br />*--------------------------------------------------------*<br />*ultrasim: .usim_opt  method=gear2<br />*ultrasim: .usim_opt progress_p=10<br />
    <br />.probe v(*) depth=3 preserve=port<br />.probe v(testbench.p1.vcom) v(testbench.p1.vcop)<br />
    <br />.end </code></p>

<p>The simulator saves all analog waveforms into the same database that contains the digital waveforms (<code> waves.shm </code>), so you can display both analog and digital waveforms in the same waveform viewer.</p>
<h2 id="UsingtheAMSDesignerSimulatorforDesignVerification-BindingPortsbindingPortsportMapping1041471">Binding Ports<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-bindingPorts"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portMapping"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041471"></span></h2>

<p>Port-binding considerations include case mapping and bus connections between Verilog and SPICE. The following guidelines can help you choose which method to use for your design requirements:</p>
<div class="table-wrap"><table border="1" cellpadding="5" cellspacing="0" class="wrapped confluenceTable" style="width: 648.0px;"><tbody><tr><th class="confluenceTh" valign="middle" width="456">
<p>Design Requirements</p>
</th><th class="confluenceTh" valign="middle" width="192">
<p>Port-Binding Method</p>
</th></tr>
<tr><td class="confluenceTd" valign="top">
<p>All buses have uniform ascending/descending port order and all ports have uniform case mapping</p>
</td>
<td class="confluenceTd" valign="top">
<p><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041480"> autobus</a></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p>Customized port binding requirements</p>
</td>
<td class="confluenceTd" valign="top">
<p><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041478"> port-bind file</a></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p>You have a Verilog version of a SPICE block</p>
</td>
<td class="confluenceTd" valign="top">
<p><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041610"> portmap reffile</a></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p>You need to bind ports by name, rather than by order</p>
</td>
<td class="confluenceTd" valign="top">
<p><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1043899"> portmap porttype</a></p>
</td>
</tr>
</tbody></table></div>
<h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-BindingPortsusingautobusautobus1041480">Binding Ports using autobus<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-autobus"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041480"></span></h3>

<p>To bind Verilog to SPICE ports using&#160;<code>
    <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049895">autobus</a>
  </code>, do the following:</p>
<ol><li>Use an include statement to include the SPICE design file:<br />include &quot;analog_top.sp&quot;</li><li>
<p>Use&#160;<code>
        <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049882">portmap</a>
      </code>&#160;and&#160;<code>
        <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1050512">config</a>
      </code>&#160;cards in the<code> amsd </code>block to specify the SPICE file and subcircuits that you have instantiated in Verilog modules:<br />amsd{<br /> &#160;&#160;&#160;&#160;portmap subckt=analog_top autobus=yes busdelim=&quot;&lt;&gt;&quot;<br /> &#160;&#160;&#160;&#160;config cell=analog_top use=spice<br /> &#160;&#160;&#160;&#160;}</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The default value for&#160;<code><a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049895">autobus</a></code>&#160;on the<code>&#160;portmap&#160;</code>statement is<code>&#160;yes.</code></p>
</div>
</div>
</li><li>Specify the AMS control file directly on the <a href="Using_xrun_for_AMS_Simulation.html"> <code>xrun</code> </a>&#160;command line:<br /> <code>xrun ... amsdcb.scs</code></li></ol>
<p>Here is an example. The top module,<code> testbench</code>, instantiates one SPICE block,<code> pll_top</code>:</p>

<p><br /></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module testbench ();
reg myRESET;
reg refclk;
wire [1:0] clk_out;
.....
pll_top p1(refclk, myRESET, clk_out);
endmodule

//The SPICE subcircuit definition looks like this:

.subckt pll_top refclk reset P0_CLK[1] P0_CLK[0]
...
.ends pll_top

//You specify autobus port binding using the SPICE pll_top subcircuit in the amsd block as follows:

amsd{
&#160;&#160;&#160;&#160;portmap subckt=pll_top autobus=yes
&#160;&#160;&#160;&#160;config cell=pll_top use=spice
&#160;&#160;&#160;&#160;...
&#160;&#160;&#160;&#160;&#160;}

//The elaborator generates the following port-bind file:

//
//portmap file for spice subckt pll_top
refclk&#160;&#160;:&#160;&#160;&#160;&#160;&#160;&#160;&#160;refclk&#160;&#160;dir=inout
reset&#160;&#160;&#160;:&#160;&#160;&#160;&#160;&#160;&#160;&#160;reset&#160;&#160;&#160;dir=inout
{ P0_CLK[1], P0_CLK[0] }&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;:&#160;&#160;&#160;&#160;&#160;&#160;&#160;P0_CLK[1:0]&#160;&#160;&#160;&#160;&#160;dir=inout</pre>
</div>
</div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The<code>&#160;SPICEname&#160;</code>identifiers (on the left side of the colon) come from the SPICE subcircuit definition (such as<code>&#160;.subckt pll_top refclk reset P0_CLK[1] P0_CLK[0]</code>).&#160;</p>
</div>
</div>

<p><span style="color: rgb(51,51,51);">The</span> <code style="color: rgb(51,51,51);"> VerilogName </code> <span style="color: rgb(51,51,51);">identifiers (on the right side of the colon) represent the port names of the Verilog module that the software generates internally. These port names can be different from the actual interface signal names in the instantiation in the top-level testbench module. In this example, for instance, the interface signal names are</span> <code style="color: rgb(51,51,51);"> refclk</code> <span style="color: rgb(51,51,51);">,</span> <code style="color: rgb(51,51,51);"> myRESET</code> <span style="color: rgb(51,51,51);">, and</span> <code style="color: rgb(51,51,51);"> clk_out</code> <span style="color: rgb(51,51,51);">, while the port names in the port-bind file are</span> <code style="color: rgb(51,51,51);"> refclk</code> <span style="color: rgb(51,51,51);">,</span> <code style="color: rgb(51,51,51);"> reset</code> <span style="color: rgb(51,51,51);">,</span> <code style="color: rgb(51,51,51);"> P0_CLK[1]</code> <span style="color: rgb(51,51,51);">, and</span> <code style="color: rgb(51,51,51);"> P0_CLK[0].</code> <span style="color: rgb(51,51,51);"> For details about the format of the port-bind file, see &quot;</span> <a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041878">Creating a Customized Port-Bind File&quot;</a> <span style="color: rgb(51,51,51);">.</span></p>

<p><br /></p>

<p>You should change the port directions to match your design requirements (<code> dir=inout </code>is the default direction setting for SPICE ports).</p>

<p>The software maps<code> P0_CLK[1] </code>and<code> P0_CLK[0] </code>into a bus because<code> [] </code>is the default bus delimiter.</p>
<h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-port-bindfile1041478BindingPortsusingaPort-BindFile"><span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-port-bindfile"></span> <span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041478"></span>Binding Ports using a Port-Bind File</h3>

<p>Some designs require customized port binding, such as mixed-case mapping, more complicated bus forms such as those that include concatenations, and mixed ascending and descending bus orders. You can use a<a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041878"> port-bind file </a>to specify your customized port binding requirements. See<a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041878"> &quot;Creating a Customized Port-Bind File&quot; </a>for information about the format of the port-bind file.</p>

<p>You can use autobus to generate the initial port-bind file (<code>.pb</code>) automatically, then you can&#160;<a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041878">customize the mappings</a>&#160;in that file. The general steps you can follow are:</p>
<ol><li>Use autobus to generate the initial port-bind file (<code>.pb</code>).</li><li>Customize port mappings in the initial port-bind file.</li><li>Use<code> portmap &#8230; file= </code>to specify the port-bind file you customized.<br /> <code>include &quot;analog_top.sp&quot;</code> <br /> <code> amsd{ </code> <br /> <code>&#160;&#160;&#160;&#160;portmap subckt=analog_top file=&quot;analog_top.pb&quot;</code> <br /> <code> &#160;&#160;&#160;&#160;config cell=analog_top use=spice</code> <br /> <code> &#160;&#160;&#160;&#160;}</code></li></ol><h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-BindingPortsusingaVerilogFileportmapreffileportmapVerifile1041610">Binding Ports using a Verilog File<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portmapreffile"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portmapVerifile"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041610"></span></h3>

<p>If your design contains units for which you have both a Verilog and a SPICE version, you can use a Verilog file to specify your binding options. Perhaps you simulate a purely digital version of your design first, and then selectively replace some blocks with a SPICE version.</p>

<p>You can specify a file containing a Verilog module that defines the port mappings to use from a Verilog parent to a SPICE subcircuit instance using&#160;<code>
    <a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041610">portmap reffile</a>
  </code>&#160;in your AMS control file. This approach lets you replace the interface of a subcircuit with that of a Verilog module.</p>

<p>For example:</p>

<p><code> include &quot;analog_top.sp&quot;<br /> amsd{<br /> &#160;&#160;&#160;&#160; portmap subckt=analog_top reffile=&quot;analog_top.v&quot; refformat=verilog<br /> &#160;&#160;&#160;&#160; config cell=analog_top use=spice<br /> &#160;&#160;&#160;&#160;} </code></p>

<p>In this example,<code> analog_top.v </code>is the Verilog file that contains the port binding information your design requires. The software applies port bindings (interfaces) defined in<code> analog_top.v </code>to instances of<code> analog_top.</code> While the elaborator uses the port bindings you define for<code> analog_top </code>in<code> analog_top.v </code>to determine how to connect instances of<code> analog_top</code>, the simulator simulates the<code> analog_top </code>subcircuit you define in<code> analog_top.sp.</code></p>

<p>For example, <code>analog_top.v&#160;</code> might contain the following:</p>

<p><br /></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module analog_top (in1, itune, in2);
inout in1;
inout [0:1] itune;
inout in2;

analog beginend
end
module

//The analog_top subcircuit in analog_top.sp might look like this:

.subckt analog_top
+ in1 itune[0] itune[1] in2

...
.ends analog_top

//When you instantiate a subcircuit called analog_top in module top like this:

module top (ext_clk, pll_clk);
input ext_clk, pll_clk;

wire [0:1] itune;
wire res;

analog_top xana_top(
.in2(pll_clk),
.itune(itune),
.in1(ext_clk)
);

...
endmodule</pre>
</div>
</div>

<p><br /></p>

<p>Binding ports by order is not recommended when the ports in the Verilog reference file and the ports in the equivalent SPICE subcircuit do not match by order. In such situations, it is recommended that you bind ports by name using the<code> porttype=name </code>parameter. (See<a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1043899"> Binding Ports by Name</a>)</p>
<h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-BindingPortsbyNameportmapPorttype1043899">Binding Ports by Name<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portmapPorttype"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1043899"></span></h3>

<p>When you need to bind the ports in your&#160;<a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041610">reference file</a>&#160;by name, rather than by order, you can use the&#160;<code>
    <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1055571">porttype</a>
  </code>&#160;specifier in a&#160;<code>
    <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049882">portmap</a>&#160;</code>statement. For example:</p>

<p><code> amsd{<br />&#160;&#160;&#160;&#160;&#160;ie vsup=1.8<br />&#160;&#160;&#160;&#160;&#160;portmap module=counter reffile=&quot;./source/digital/counter.v&quot; porttype=name<br />&#160;&#160;&#160;&#160;&#160;config cell=counter use=hdl<br />&#160;&#160;&#160;&#160;&#160;} </code></p>

<p>The software uses this specifier when automatically generating a port-bind file. The&#160;default binding mechanism is by-order (<code> porttype=order </code>). However, if your design consists mostly of SPICE and Verilog ports that have the same name, but with mismatched port order, you might get a more accurate port-bind file by specifying<code> porttype=name.</code></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>If the software cannot match ports between Verilog and SPICE successfully, the elaborator writes &quot;&#160;not_found&#160;&quot; as a placeholder in the port-bind file it generates (in&#160;runDir&#160;/portmap_files&#160;; see &quot;<a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041919">Rules That Apply to Customized Port-Bind Files</a>&quot;). You can edit this file to change all&#160;not_found&#160;keywords to the correct Verilog port names, then use the <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1051620">file</a> parameter (instead of <code><a href="Using_an_amsd_Block.html#UsinganamsdBlock-1052218">reffile</a> </code>and <code><a href="Using_an_amsd_Block.html#UsinganamsdBlock-1055571">porttype</a></code>) in a<code> <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1055571">porttype</a></code> statement to specify the file you saved, and run the simulation again.</p>
</div>
</div>
<h2 id="UsingtheAMSDesignerSimulatorforDesignVerification-CreatingaCustomizedPort-BindFileportbindFile1041878">Creating a Customized Port-Bind File<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portbindFile"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041878"></span></h2>

<p>The port-bind file contains information about how you want the SPICE subcircuit ports mapped to Verilog buses. You can specify customized bus element mappings as well as port direction. The general format for port bindings is as follows:</p>

<p><code>
    <em> SPICEname</em> : VerilogName [ dir=input|output|inout]
  </code></p>

<p>where<code> SPICEname </code>and<code> VerilogName </code>are identifiers that do not have to match. Each<code> SPICEname </code>corresponds to a node name or bus in the SPICE subcircuit definition. Each<code> VerilogName </code>corresponds to a wire name or bus in the Verilog module. The port direction specifier is optional.</p>

<p>For scalar nodes, the format is as follows:</p>

<p><code> node1 : NODE1 </code></p>

<p>For a vector, the format is as follows:</p>

<p><code> { myBus_0, myBus_1 } : myBUS[0:1] </code></p>

<p>You can specify a range of bus elements as follows:</p>

<p><code> { busA[0]-busA[10] } : BusA[0:10] </code></p>

<p>You can specify a customized mapping of elements as follows:</p>

<p><code> { busA[10]-busA[5], busA[0]-busA[4] } : busA[0:10] </code></p>

<p>You can specify a customized mapping of random elements as follows:</p>

<p><code> { a_0, a_1, a_2, a_4, b, abc } : bus[0:5] </code></p>

<p>You might have specified a unary bus delimiter such as &amp; or # :</p>

<p><code> { uBus&amp;0, uBus&amp;1, uBus&amp;2, vBus#3, vBus#4, vBus#5 } : bus[0:5] </code></p>

<p>The following default rules apply to any node or bus that you do not explicitly specify in the port-bind file:</p>
<ul><li>Port names match exactly (name-to-name), including casing</li></ul><ul><li>Bus delimiters are<code> [] </code>and<code> &lt;&gt;</code></li></ul><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>These default rules are the same as those that apply when you use&#160;<code><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041480">autobus</a></code>.</p>
</div>
</div>

<p>See also:</p>
<ul><li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1042127"> Customized Port-Bind File Examples </a></li></ul><ul><li><a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041919"> Rules That Apply to Customized Port-Bind Files </a></li></ul><h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-CustomizedPort-BindFileExamplesportmapFileExamples1042127">Customized Port-Bind File Examples<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portmapFileExamples"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1042127"></span></h3>

<p>Here is an example that shows how you can use a port-bind file to define port binding between Verilog and SPICE blocks in a very general way. Study the port-bind file format carefully to understand how you can create custom port bindings according to your connection requirements.</p>

<p>You might instantiate subcircuit<code> analog_top </code>in module<code> top </code>as follows:</p>

<p><code> module top (ext_clk, pll_clk);<br />input ext_clk, pll_clk;<br />
    <br />wire [0:1] itune;<br />wire res;<br />
    <br />analog_top xana_top(.in2(pll_clk),<br />.itune(itune),<br />.in1(ext_clk));</code></p>

<p><code>...<br />endmodule </code></p>

<p>Subcircuit<code> analog_top </code>(in<code> analog_top.sp</code>) might look like this:</p>

<p><code> .subckt analog_to<br />p+ in1 itune[0] itune[1] in2<br />...<br />.ends analog_top </code></p>

<p>Your<code> amsd </code>block might contain the following:</p>

<p><code> include &quot;analog_top.sp&quot;<br /> amsd{<br /> &#160;&#160;&#160;&#160; portmap subckt=analog_top file=&quot;analog_top.pb&quot;<br /> &#160;&#160;&#160;&#160; config cell=analog_top use=spice<br /> &#160;&#160;&#160;&#160;} </code></p>

<p>If your port-bind file,<code> analog_top.pb </code>, contains the following:</p>

<p><code> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in1 : in2 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dir=inout<br /> { itune[1], itune[0] } : itune[0:1] &#160;&#160;dir=inout<br /> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in2 : in1 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dir=inout </code></p>

<p>the elaborator derives the following information from these port bindings:</p>
<ol><li>Port in1 of SPICE subcircuit analog_top connects to the net in module top that connects to formal port in2 in instance xana_top of analog_top.<br />The elaborator connects net pll_clk to port in1 of SPICE subcircuit analog_top.</li><li>Port itune[1] of SPICE subcircuit analog_top connects to the net in module top that connects to formal port itune[0] in the instance xana_top of analog_top.<br />The elaborator connects net itune[0] to port itune[1] of SPICE subcircuit analog_top and follows the same logic to connect net itune[1] to port itune[0] of SPICE subcircuit analog_top.</li><li>Port<code> in2 </code>of SPICE subcircuit<code> analog_top </code>connects to the net in module<code> top </code>that connects to formal port<code> in1 </code>in instance<code> xana_top </code>of<code> analog_top.<br />
    </code>The elaborator connects net<code> ext_clk </code>to port<code> in2 </code>of SPICE subcircuit<code> analog_top.</code></li></ol>
<p>Here is another example:</p>

<p><br /></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">// mrcg.v -- Verilog top
module mrcg (ext_clk, pll_clk);
ANALOG_TOP xana_top(.Q_1(Q_1), .Q_2(Q_2), .IN2(pll_clk), .ITUNE(ITUNE), .IN1(ext_clk));
endmodule

// analog_top.cir -- spice leaf 
.subckt analog_top q_1 q_2 IN1 itune_0 itune_1 in2
.ends analog_top

// analog_top.pb -- port-bind file
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;q_1 : Q_1 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dir=input
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;q_2 : Q_2 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dir=input
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;IN1 : in1 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dir=inout
{ itune[1], itune[0] } : ITUNE[0:1] &#160;&#160;dir=input
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in2 : IN2 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dir=inout

// amsd.scs
include &quot;analog_top.cir&quot;
amsd{
&#160;&#160;&#160;&#160;portmap subckt=analog_top file=&quot;analog_top.pb&quot;
&#160;&#160;&#160;&#160;config cell=ANALOG_TOP use=spice
&#160;&#160;&#160;&#160;}</pre>
</div>
</div>

<p><br /></p>
<h3 id="UsingtheAMSDesignerSimulatorforDesignVerification-RulesThatApplytoCustomizedPort-BindFilesportbindFileRules1041919">Rules That Apply to Customized Port-Bind Files<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-portbindFileRules"></span>&#160;<span class="confluence-anchor-link" id="UsingtheAMSDesignerSimulatorforDesignVerification-1041919"></span></h3>

<p>Here are some rules to remember when using port-bind files:</p>
<ul><li>The location where the elaborator generates the port-bind files is<span style="color: rgb(0,0,0);font-family: &quot;Courier New&quot;;font-size: small;"> <code> runDir </code>/portmap_files</span>where<code> runDir </code>is the directory where you run<code> xrun.</code></li></ul><ul><li>If a port-bind file for a certain subcircuit already exists in the default location (mentioned in the previous bullet), the elaborator will not overwrite the file and it will not generate a port-bind file for this case.</li></ul><ul><li>The elaborator will never use a port-bind file unless you specify it explicitly in the AMS control file using&#160;<code>
      <a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041478">portmap &hellip; file</a>
    </code>. The software will issue a message that clearly indicates whether the elaborator used a port-bind file.</li></ul><ul><li>The port-bind file you specify (using <code>
      <a href="#UsingtheAMSDesignerSimulatorforDesignVerification-1041478">portmap &hellip; file</a>
    </code>) must have a valid UNIX path, either absolute or relative to the directory where you run<code> xrun.</code></li></ul>
<p>Any mappings you specify in a port-bind file or in a Verilog module that defines port mappings take precedence over any options you specify explicitly using other options such as&#160;<code>
    <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049895">autobus</a>
  </code>,&#160;<code>
    <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049925">casemap</a>
  </code>, and&#160;<code>
    <a href="Using_an_amsd_Block.html#UsinganamsdBlock-1049919">busdelim</a>
  </code>.</p>

                    </div>
<br /><br /></div>
<footer xmlns:html="http://www.w3.org/1999/xhtml"><nav class="navigation"><b><em><a href="Using_xrun_for_AMS_Simulation.html" id="prev" title="Using_xrun_for_AMS_Simulation">Using_xrun_for_AMS_Simulation</a></em></b><b><em><a href="Designing_with_Multiple_Power_Supplies.html" id="nex" title="Designing_with_Multiple_Power_Supplies">Designing_with_Multiple_Power_ ...</a></em></b></nav><div>
          For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2019, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved.
        </div>
</footer><br xmlns:html="http://www.w3.org/1999/xhtml" /></body></html>