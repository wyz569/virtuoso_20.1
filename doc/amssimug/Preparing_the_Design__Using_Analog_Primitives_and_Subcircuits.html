
<html><head><title>Preparing the Design: Using Analog Primitives and Subcircuits</title>
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jaini" />
<meta name="CreateDate" content="2019-11-04" />
<meta name="CreateTime" content="1572864905" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes the Virtuoso AMS Designer simulator, a mixed-signal simulator that supports the Verilog-AMS and VHDL-AMS language standards." />
<meta name="DocTitle" content="Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Preparing the Design: Using Analog Primitives and Subcircuits" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="FileType" content="Chapter" />
<meta name="Keyword" content="amssimug" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2019-11-04" />
<meta name="ModifiedTime" content="1572864905" />
<meta name="NextFile" content="Preparing_the_Design__Using_Mixed_Languages.html" />
<meta name="Group" content="Analog Mixed-Signal Simulation" />
<meta name="Platform" content="Functional Verification" />
<meta name="PrevFile" content="Using_an_amsd_Block.html" />
<meta name="Product" content="Xcelium" />
<meta name="ProductFamily" content="Functional Verification" />
<meta name="ProductVersion" content="19.09" />
<meta name="RightsManagement" content="Copyright 2012-2019 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide -- Preparing the Design: Using Analog Primitives and Subcircuits" />
<meta name="Version" content="19.09" />
<meta name="Renderer" content="WIKI" />
<meta name="SpaceKey" content="amssimug2003" />
<meta name="confluence-version" content="6.13.3" />
<meta name="ecms-plugin-version" content="03.30.005" />

        
        <link href="styles/site.css" rel="stylesheet" type="text/css" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    

    </head><body style="background-color: #FFFFFF;"><!-- Begin Buttons --><header xmlns:html="http://www.w3.org/1999/xhtml"><div class="docHeadr">Product Documentation<img src="images/Cadence-Logo.jpg" /></div>
<nav class="blueHead"><ul><li><a class="content" href="amssimugTOC.html">Contents</a></li><li><a class="prev" href="Using_an_amsd_Block.html" title="Using_an_amsd_Block">Using_an_amsd_Block</a></li><li style="float: right;"><a class="viewPrint" href="amssimug.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="Preparing_the_Design__Using_Mixed_Languages.html" title="Preparing_the_Design__Using_Mixed_Languages">Preparing_the_Design__Using_Mi ...</a></li></ul></nav></header><!-- End Buttons --><div xmlns:html="http://www.w3.org/1999/xhtml" style="font-size:14px;line-height:1.42857142857;margin:20px 0 0 0;font-weight:bold;"><center>Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide<br />Product Version 19.09, September 2019</center></div>
<div xmlns:html="http://www.w3.org/1999/xhtml" style="margin-left:5%;">
<p></p>

<p></p>
<div id="main-header">
                    
                    
                                                <div style="width: 100%; font-size: 32px; text-align: left;               font-weight: bold;">7</div>
<h1 style="margin: 4px 0 4px;"><span>Preparing the Design: Using Analog Primitives and Subcircuits</span></h1>

                    
                </div>
<div class="wiki-content group" id="main-content">
                    
<p><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1031927"></span></p>

<p>See the following topics for information about how you can instantiate analog primitives and subcircuits in your design.</p>

<p></p>
<div class="toc-macro rbtoc1572864885322">
<ul class="toc-indentation">
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-InstantiatingAnalogPrimitives1035579">Instantiating Analog Primitives</a></li>
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-DeterminingtheDisciplineofAnalogPrimitivePorts1035670">Determining the Discipline of Analog Primitive Ports</a></li>
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-SpecifyingAnalogInstancesInsideGenerateStatementsanalog_instances1039900">Specifying Analog Instances Inside Generate Statements</a></li>
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-IncludingSubcircuitsandModelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingSPICEorSpectreusingsubcircuitsandmodelsus">Including Subcircuits and Models</a></li>
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-CompiledCFlowCDS_AHDLCMI_ENABLE1038003">Compiled C Flow</a></li>
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-Multi-Threading">Multi-Threading</a></li>
<li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-UsingthemtlineComponentwiththeAMSSimulator1035687">Using the mtline Component with the AMS Simulator</a></li>
</ul>
</div>

<p>See also<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1038003"> &quot;Compiled C Flow.&quot;</a></p>
<h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-InstantiatingAnalogPrimitives1035579">Instantiating Analog Primitives<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035579"></span></h2>

<p>The supported analog primitives for the Spectre AMS Designer Simulator include SPICE and Spectre subcircuits and Verilog-A modules that you bring into the design using <code>ahdl_include</code>&#160;statements in the Spectre language. The AMS Designer simulator also automatically recognizes and supports all the Spectre built-in primitives except</p>
<ul><li><code> a2ao </code></li></ul><ul><li><code> a2d </code></li></ul><ul><li><code> d2a </code></li></ul><ul><li><code> node </code></li></ul><ul><li><code> prst </code></li></ul>
<p>In the AMS Designer simulator, the maximum number of ports that can be used for primitives with infinite ports, such as <code>pvcvs</code>,&#160;<code>pvccs</code>, and <code>nport</code>, is 30.</p>

<p>For more information about the primitives, refer to the<span style="color: rgb(0,0,0);"> Circuit Components </span>chapter of the<span style="color: rgb(0,0,0);"> Spectre Simulator Components and Device Models Reference </span>manual.</p>

<p>You can instantiate these analog primitives with<span style="color: rgb(0,0,0);"> ports </span>that you bind either<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035614"> by name </a>or<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035631"> by order</a>. See&#160;<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035614">&quot;Binding Ports by Name&quot; </a>and&#160;<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035631">&quot;Binding Ports by Order&quot; </a>for more information. See also&#160;<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035635">&quot;Guidelines for Binding Ports by Name or Order.&quot;</a></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>You cannot mix these two types of port bindings for a particular analog primitive instantiation.</p>
</div>
</div>

<p>You must always bind the<span style="color: rgb(0,0,0);"> parameters </span>of an instantiated analog primitive by name. See&#160;<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035647">&quot;Binding Parameters.&quot;</a></p>
<h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-BindingPortsbyNamebindingPortsByName1035614">Binding Ports by Name<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-bindingPortsByName"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035614"></span></h3>

<p>You can connect an instance of an analog primitive by explicitly linking the formal port name of the Spectre or SPICE master with the actual name declared in the instantiating module. For example, in the following instantiations<code> 1 </code>and<code> 2 </code>are the formal port names for the Spectre built-in primitive <code>resistor</code>&#160;and <code>p</code>&#160;and <code>n</code>&#160;are formal port names for the Spectre subcircuit&#160;<code>my_subckt_cap.</code></p>

<p><code> resistor #(.r(100)) R1 (.1(src), .2(out));<br />my_subckt_cap #(.c(50n)) C1 (.p(out), .n(gnd)); </code></p>

<p>The formal names of the ports for Spectre built-in primitives can be found in the &quot;Component Statements&quot; chapter of<span style="color: rgb(0,0,0);"> Spectre Circuit Simulator Reference </span>manual.</p>

<p>The following capabilities apply to the port expressions of the instantiations of analog primitives when you are binding ports by name.</p>
<ul><li>Formal port names can appear in arbitrary order.<br /><code> module top;<br />&#160;&#160;electrical n1,n2,n3;<br />&#160;&#160;mysub sub1(.p3(n1), .p1(n2), .p2(n3)); // Arbitrary order<br />endmodule<br /> </code><code> subckt mysub(p1 p2 p3)<br />&#160;&#160;...<br />ends mysub </code></li></ul><ul><li>Master ports can be left unconnected. The unconnected ports are handled as unbound ports and are left as floating nodes.<br /><code> module top;<br />&#160;&#160;electrical n1,n2,n3;<br />&#160;&#160;mysub sub1(.p2(n3)); // p1 and p3 are unconnectedend<br />module </code><code> subckt mysub(p1 p2 p3)<br />&#160;&#160;...<br />ends mysub </code></li></ul><ul><li>Port lists can be used for documentation only, if desired.<br /><code> module top;<br />&#160;&#160;electrical n1,n2,n3;<br />&#160;&#160;mysub sub1(.p1(), .p2(), .p3()); // Used for documentation<br />endmodule<br /> </code><code> subckt mysub(p1 p2 p3)<br />&#160;&#160;...<br />ends mysub </code></li></ul><ul><li>The formal name of a node is not allowed to appear more than once in an instantiation. If a formal name appears more than once, an error occurs during elaboration.<br /><code> // Contains illegal code<br />module top;<br />&#160;&#160;electrical n1,n2,n3;<br />&#160;&#160;mysub sub1(.p1(n1), .p2(n2), .p2()); // This is an error<br />endmodule<br /> </code><code> subckt mysub(p1 p2 p3)<br />&#160;&#160;...<br />ends mysub </code></li></ul><h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-BindingPortsbyOrderbindingPortsByOrder1035631">Binding Ports by Order<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-bindingPortsByOrder"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035631"></span></h3>

<p>You can also connect an instance of an analog primitive by implicitly linking the formal port name of the Spectre or SPICE master with the actual name declared in the instantiating module. For example, the following instantiations omit the formal port names for the Spectre built-in primitive <code>resistor</code>&#160;and for the Spectre subcircuit <code>my_subckt_cap</code>&#160;but use the known ordering of those names to establish connections with the actual names used in the instantiating module.</p>

<p><code> resistor #(.r(100)) R1 (src, out);<br />my_subckt_cap #(.c(50n)) C1 (out, gnd); </code></p>
<h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-GuidelinesforBindingPortsbyNameorOrderguidelines1035635">Guidelines for Binding Ports by Name or Order<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-guidelines"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035635"></span></h3>

<p>Be aware of the following guidelines for port expressions which apply whether you bind ports by name or order.</p>
<ul><li>When a port expression has a range, only single bit selections are supported. For example:<br /><code> module top;<br />&#160;&#160;electrical [0:2]n;<br />&#160;&#160;mysub sub1(.p1(n[0]), .p2(n[1]), .p3(n[2])); // Single bit selections.<br />//mysub sub1( n[0], n[1], n[2] );&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// By order.<br />endmodule<br /> </code><code> subckt mysub(p1 p2 p3)<br />&#160;&#160;...<br />ends mysub </code></li></ul><ul><li>Out-of-module port expressions must be scalars.<br /><code> module cds_globals ( );<br /> &#160;&#160;electrical \vss! ;<br />&#160;&#160;electrical \gnd! ;<br />&#160;&#160;ground \gnd! ;<br />endmodule<br /> </code><code> module top;<br />&#160;&#160;electrical lgnd;<br />&#160;&#160;ground lgnd;<br />&#160;&#160;vsource&#160;&#160;#(.dc(5), .type(&quot;dc&quot;)) V0 (.p(cds_globals.\vss! )); // Scalars.<br />//vsource&#160;&#160;#(.dc(5), .type(&quot;dc&quot;)) V0 (cds_globals.\vss! ); // By order.<br />&#160;&#160;resistor #(.r(5K)) r1 (cds_globals.\vss! , lgnd); // Scalars only.<br />//resistor #(.r(5K)) r1 (.1(cds_globals.\vss! ), .2(lgnd)); // By name.<br />endmodule </code></li></ul><h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035647BindingParameters"><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035647"></span>Binding Parameters</h3>

<p>The parameters of analog and Spectre built-in primitives can be set only by name. For example, you can instantiate a resistor like this:</p>

<p><code> resistor #(.r(1K)) R1(pos,neg) ; </code></p>

<p>The formats used to set the parameters of some Spectre instantiations differ from the equivalent instantiations supported by the AMS Designer simulator. These differences are described in the following table:</p>
<div class="table-wrap"><table border="1" cellpadding="5" cellspacing="0" class="wrapped confluenceTable" style="width: 648.0px;"><tbody><tr><th class="confluenceTh" valign="middle" width="234">
<p>Difference in Instantiation</p>
</th><th class="confluenceTh" valign="middle" width="414">
<p>Examples of Equivalent Spectre and Verilog-AMS Instantiations</p>
</th></tr>
<tr><td class="confluenceTd" valign="top">
<p>Spectre-enumerated parameters are supported as strings in Verilog-AMS</p>
</td>
<td class="confluenceTd" valign="top">
<p><code>// Spectre</code><br /><code>V1 p n vsource type=dc ddc=5 </code></p>

<p><code>// Verilog-AMS</code><br /><code>vsource #(.type(&quot;dc&quot;),.ddc(5))V1(p,n);</code></p>

<p><code><span style="color: rgb(0,0,0);">// Spectre<br />N0 (in1 gnd in2 gnd) nport file=&quot;spiral.spdat&quot; interp=splinerelerr=0.01 abserr=5e-4 </span></code></p>

<p><span style="color: rgb(0,0,0);"><code>// Verilog-AMS</code><br /><code>nport #(.file(&quot;spiral.spdat&quot;), .interp(&quot;spline&quot;), .relerr(0.01),.abserr(5e-4)) N0 (.t1(in1), .b1(gnd), .t2(in2), .b2(gnd));</code> </span></p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p>Automatically-sized parameter arrays are passed differently</p>
</td>
<td class="confluenceTd" valign="top">
<p><code>// Spectre<br />Filter in gnd out gnd<br />svcvs poles=[1 0 5 0] </code></p>

<p><code>// Verilog-AMSsvcvs #(.poles({1,0,5,0}))<br />Filter(in,ground,out,ground); </code></p>
</td>
</tr>
</tbody></table></div>
<h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-InstantiatingAnalogPrimitives(UltraSimSolverOnly)">Instantiating Analog Primitives (UltraSim Solver Only)</h3>

<p>You can instantiate analog primitives in your structural Verilog-AMS modules. In this context, an analog primitive is defined as a SPICE or Spectre subcircuit, or as a Verilog-A component brought into the design by using an<code> ahdl_include.</code></p>

<p>The UltraSim solver supports and recognizes all Spectre built-in primitives except for the following ones:</p>
<p align="left"><br /></p>
<div class="table-wrap"><table border="1" cellpadding="5" cellspacing="0" class="wrapped confluenceTable" style="width: 650.0px;"><tbody><tr><th class="confluenceTh" valign="middle" width="325">
<p>Unsupported primitive</p>
</th><th class="confluenceTh" valign="middle" width="325">
<p>Reason the primitive is unsupported</p>
</th></tr>
<tr><td class="confluenceTd" valign="top">
<p><code> a2d </code></p>
</td>
<td class="confluenceTd" valign="top">
<p>For use only by verimix-mixsim application.</p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p><code> d2a </code></p>
</td>
<td class="confluenceTd" valign="top">
<p>For use only by verimix-mixsim application.</p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p><code> node </code></p>
</td>
<td class="confluenceTd" valign="top">
<p>Infinite number of ports.</p>
</td>
</tr>
<tr><td class="confluenceTd" valign="top">
<p><code> prst </code></p>
</td>
<td class="confluenceTd" valign="top">
<p>Infinite number of ports.</p>
</td>
</tr>
</tbody></table></div>

<p>The terminals of an analog component are always evaluated as<code> inout. </code></p>
<h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-DeterminingtheDisciplineofAnalogPrimitivePorts1035670">Determining the Discipline of Analog Primitive Ports<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035670"></span></h2>

<p>The elaborator assumes the discipline of an analog primitive port is always<code> electrical </code>, regardless of what you might actually have specified. This assumption affects the discipline resolution of nets attached to analog primitive ports.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The AMS Designer simulator does not support either port-discipline attributes or discipline resolution for analog primitives as described in the Verilog-AMS LRM 2.1.</p>
</div>
</div>
<h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-SpecifyingAnalogInstancesInsideGenerateStatementsanalog_instances1039900">Specifying Analog Instances Inside Generate Statements<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-analog_instances"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1039900"></span></h2>

<p>The AMS Designer Simulator supports analog instances instantiated inside the generate block hierarchy. The following generate statements are supported.</p>
<ul><li>generate-for - Also called for-generate, it enables the AMS module items to be instantiated multiple times using a for-loop construct. For example:<br /><code> module vs_vams ();<br /> </code><code> ... ... ...<br /> </code><code> genvar j;<br /> </code><code> generate<br /> </code><code> &#160;&#160;for (j=0; j&lt;3; j=j+1) begin<br /> </code><code> &#160;&#160;//Analog instance<br /> </code><code> &#160;&#160;&#160;beh_vsource  V1 (a[i],gnd);<br /> </code><code> &#160;&#160;//SPICE primitive<br /> </code><code> &#160;&#160;resistor #(.r(100k)) R1 (a[j], gnd);<br /> </code><code> &#160;&#160;end<br /> </code><code> &#160;endgenerate<br /> </code><code> endmodule </code></li></ul><ul><li>generate-if - Also called if-generate, it enables the AMS module items to be conditionally instantiated, based on the evaluation of an if-else condition.<br /><code> module vs_vams ()<br /> </code><code> &#160;&#160;&#160;... ... ...<br /> </code><code> &#160;&#160;generate<br /> </code><code> &#160;&#160;&#160;if ( behModel) begin:behmod<br /> </code><code> &#160;&#160;&#160;&#160;&#160;beh_vsource  V1 (in,gnd);<br /> </code><code> &#160;&#160;&#160;&#160;&#160;beh_resistor R1 (in, gnd);<br /> </code><code> &#160;&#160;&#160;end<br /> </code><code> &#160;&#160;&#160;else begin: spiprim<br /> </code><code> &#160;&#160;&#160;&#160;&#160;vsource #(.dc(5)) V1(in,gnd)<br /> </code><code> &#160;&#160;&#160;&#160;&#160;vsource #(.r(100k)) R1(in,gnd)<br /> </code><code> &#160;&#160;&#160;end<br /> </code><code> &#160;&#160;endgenerate<br /> </code><code> endmodule </code></li></ul><ul><li>generate-case - Also called case-generate, it enables the module items to be conditionally instantiated, based on a select one-on-many case construct.<br /><code> module vs_vams ()<br /> </code><code> &#160;&#160;&#160;... ... ...<br /> </code><code> &#160;&#160;generate<br /> </code><code> &#160;&#160;&#160;case: param<br /> </code><code> &#160;&#160;&#160;&#160;0:<br /> </code><code> &#160;&#160;&#160;&#160;&#160;begin:gen1<br /> </code><code> &#160;&#160;&#160;&#160;&#160;beh_vsource  V1 (in,gnd);<br /> </code><code> &#160;&#160;&#160;&#160;&#160;beh_resistor R1 (in, gnd);<br /> </code><code> &#160;&#160;&#160;&#160;end<br /> </code><code> &#160;&#160;&#160;&#160;1:<br /> </code><code> &#160;&#160;&#160;&#160;&#160;begin:gen1<br /> </code><code> &#160;&#160;&#160;&#160;&#160;&#160;vsource  #(.dc(5))   V1 (in,gnd);<br /> </code><code> &#160;&#160;&#160;&#160;&#160;&#160;resistor #(.r(100k)) R1 (in,gnd);<br /> </code><code> &#160;&#160;&#160;&#160;end<br /> </code><code> &#160;&#160;&#160;endcase<br /> </code><code> &#160;&#160;endgenerate<br /> </code><code> endmodule </code></li></ul>
<p>Currently, the following is not supported:</p>
<ul><li>Analog behavioral block inside the generate statement</li></ul><ul><li>Declaration of local parameters and nets</li></ul><ul><li>User-defined functions</li></ul><h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-IncludingSubcircuitsandModelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingsubcircuitsandmodelsusingSPICEorSpectreusingsubcircuitsandmodelsus">Including Subcircuits and Models<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingSPICEorSpectre"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingSPICEorSpectre"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingsubcircuitsandmodels"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-usingSPICEorSpectre"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1039833"></span></h2>

<p>To prepare to simulate using a SPICE or Spectre language model, you must give the elaborator the location of the model file. Two ways you can specify the location of model files are as follows:</p>
<ul><li>Define the<code> MODELPATH </code>variable in the<code> hdl.var </code>fileFor more information, see &quot;<a href="Elaborating.html#Elaborating-1034920">Using hdl.var Variables with xmelab</a>.&quot;</li></ul><ul><li>Use the<code> -modelpath </code>option for<code> xmelab </code>For more information, see &quot;<a href="Elaborating.html#Elaborating-1037512">-modelpath Option</a>.&quot;</li></ul>
<p>To include a subcircuit in your design, use an&#160;<code>amsd</code> block and reference subcircuit files.</p>

<p>If you have an undefined node in a subcircuit, you must declare that node using an explicit<code> global </code>statement in the top-level scope of your design. For example, the following statement declares two global signals:</p>

<p><code> global 0 gnd vdd! </code></p>
<h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-CompiledCFlowCDS_AHDLCMI_ENABLE1038003">Compiled C Flow<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-CDS_AHDLCMI_ENABLE"></span><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1038003"></span></h2>

<p>The compiled C flow is turned on by default in AMS for both Spectre and UltraSim solvers.</p>

<p>The AMS Designer simulator uses the compiled C flow for all analog and mixed-signal blocks implemented in Verilog-A or Verilog-AMS, including interface elements. The compiled C flow also supports VHDL-AMS modules for improved simulation performance.</p>

<p>The compiled C flow stores the compiled code and the shared objects in a new directory that gets created in the directory where the simulation runs. For more information, see<span style="color: rgb(0,0,255);"><a class="message-url" href="../veriaref/appG.html#compiledccodeflow">&quot;Using the Compiled C Code Flow&quot;</a></span>in the<span style="color: rgb(0,0,255);"> <a class="message-url" href="../veriaref/veriarefTOC.html">Cadence Verilog-A Language Reference</a>.</span></p>

<p>The compiled C flow is enabled by default and cannot be disabled. As a result, the<code> CDS_AHDLCMI_ENABLE </code>environment variable and the Spectre<code> -ahdlcom </code>option that were used to turn on/off the compiled C code flow have been removed.</p>
<h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-IncrementalCompilationofCCode">Incremental Compilation of C Code</h3>

<p>In normal Compiled-C flow, each behavioral module generates a C-code source file from bytecode. The C-code file is compiled and linked to a shared library (<code>*.so</code>). The shared library does not change if the behavioral module does not change between two runs.</p>

<p>The AMS Designer Simulator has been enhanced to reuse the existing shared library (<code>*.so</code>), instead of creating a new one, if the design does not change between two simulation runs.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The simulator recompiles the code under the following condition:</p>
<ol><li><code>%xrun test1.scs test2.scs test.vams</code></li><li><code>%xrun test2.scs test1.scs test.vams</code></li></ol></div>
</div>

<p>In the example above, even though #2 is the exact rerun of #1 with the SPICE file names interchanged, the simulator will start recompiling the code. This is because the simulator always uses the file name of the first<code> .scs </code>file as the design name and treats the #2 run as a change in the design. Therefore, incremental compilation will not take effect.</p>
<h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-DisablingtheCompileCFlow">Disabling the Compile C Flow</h3>

<p>Set the following environment variable to disable the VHDL-AMS compiled C flow:</p>

<p><code>setenv CDS_VHDLA_CC_FLOW&#160; NO</code></p>

<p>When the compiled C flow is disabled, the Byte code technology is used.</p>
<h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-Multi-Threading">Multi-Threading</h2>

<p>In the AMS Designer simulator, multi-threading is used to speed up the device evaluation and matrix solving part of computation that often dominates large and post-layout circuit simulation. Multi-threading enables the high performance simulation engine providing significant performance gain and high capacity SPICE simulation on single-core, multi-core, and multi-cpu shared memory systems. This enables you to quickly simulate large pre-layout and post-layout designs. This feature provides scalable multi-threading performance on up to 16 cores. Multithreading is supported when Spectre is chosen as the analog solver.</p>

<p>For more information, see<span style="color: rgb(0,0,0);"> Specifying Multi-Threading Options </span>in the<em><span style="color: rgb(0,0,0);"> Spectre Circuit Simulator </span>and<span style="color: rgb(0,0,0);"> Accelerated Parallel Simulator </span>User Guide</em>.</p>
<h2 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-UsingthemtlineComponentwiththeAMSSimulator1035687">Using the mtline Component with the AMS Simulator<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035687"></span></h2>

<p>AMS Designer supports using multiconduction transmission line (<a href="Glossary.html#Glossary-1035964">mtline</a>) components in your designs. (For information about the mtline component, see the<em><span style="color: rgb(0,0,0);"> Spectre Circuit Simulator Reference </span></em>manual). See the following topics for information about how to use the mtline component with the AMS Designer simulator:</p>
<ul><li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035689"> Using mtline in a Schematic </a></li></ul><ul><li><a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035722"> Using mtline in a SPICE or Spectre Subcircuit or Model </a></li></ul><h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-UsingmtlineinaSchematic1035689">Using mtline in a Schematic<span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035689"></span></h3>

<p>To prepare an mtline instance for use in a schematic, do the following:</p>
<ol><li>In the Virtuoso Schematic Editing window, select the placed mtline symbol in the schematic.</li><li>Choose<span style="color: rgb(0,0,0);"><em> Edit - Properties - Objects</em>.<br /></span>The Edit Object Properties form appears.</li><li>Click the<em><span style="color: rgb(0,0,0);"> Invoke &#39;LMG&#39; parameter extraction tool </span></em>button.<br />The Transmission Line Model Generator window appears.</li><li>Enter the parameters needed to characterize the mtline instance.<br />For guidance, see &quot;Modeling Transmission Lines Using the LMG&#160;<a href="Glossary.html#Glossary-1034594">GUI</a>,&quot; in chapter 7 of&#160;<span style="color: rgb(0,0,0);"><em>Spectre RF User Guide</em>.</span></li><li>In the Transmission Line Model Generator window, choose<span style="color: rgb(0,0,0);"><em> File - LRCG file name</em>.</span></li>The LRCG File Name form appears.<li><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035700"></span>In the<em><span style="color: rgb(0,0,0);"> LRCG Name </span></em>field, specify a name for the data file to be created.</li><li>Click<span style="color: rgb(0,0,0);"> OK.</span></li><li>In the Transmission Line Model Generator window, click<em><span style="color: rgb(0,0,0);"> Calculate Parameters.</span></em></li>The calculated parameters appear in the top of the window.<li>(Optional) Choose<span style="color: rgb(0,0,0);"><em> Options - Output file Control - RLCG file</em>.</span></li>This turns off the generation of a macromodel, which is not used in AMS Designer.<li>Click<span style="color: rgb(0,0,0);"><em> Create Macromodel</em>.<br /></span>The Macromodel Creation notice appears with a message similar to the following:<br /><code>Per-unit-length RLCG file is generated and written to the file myw_line.dat</code></li><li>Click<em><span style="color: rgb(0,0,0);"> OK</span></em>, in the Macromodel Creation notice.</li><li>(Optional) In the Transmission Line Model Generator window, choose<span style="color: rgb(0,0,0);"><em> File - Quit</em>.</span></li>The window closes.<li>In the Virtuoso Schematic Editing window, select the placed&#160;<a href="Glossary.html#Glossary-1035964">mtline</a>&#160;symbol in the schematic.</li><li>Choose<span style="color: rgb(0,0,0);"><em> Edit - Properties - Objects</em>.</span></li>The Edit Object Properties form appears.<li>In the<em><span style="color: rgb(0,0,0);"> RLCG data file </span></em>field, type the full absolute path to the data file that you specified in&#160;<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035700">step 6</a>.</li><li>Ensure that the<em><span style="color: rgb(0,0,0);"> use lmg subckt </span></em>button is not checked.</li><li>Click<span style="color: rgb(0,0,0);"><em> OK</em>.</span></li></ol>
<p>At this point, the mtline instance is ready for netlisting.</p>
<h3 id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035722UsingmtlineinaSPICEorSpectreSubcircuitorModel"><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035722"></span>Using mtline in a SPICE or Spectre Subcircuit or Model</h3>

<p>For this approach, you use LMG to create the data file for the mtline instance and then edit the model file mtline instance to point to the data file.</p>
<ol><li>Start LMG.<br /><code>lmg</code><br />The Transmission Line Model Generator window appears.</li><li>Specify the parameters that characterize the mtline instance.<br />For guidance, see &quot;Modeling Transmission Lines Using the LMG GUI&quot; in the <em>Spectre RF User Guide</em>.</li><li>In the Transmission Line Model Generator window, choose<span style="color: rgb(0,0,0);"><em> File - LRCG file name</em>.</span></li>The LRCG File Name form appears.<li><span class="confluence-anchor-link" id="PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035731"></span>In the<em><span style="color: rgb(0,0,0);"> LRCG Name </span></em>field, specify a data file name. The program creates this file.</li><li>Click<span style="color: rgb(0,0,0);"><em> OK</em>.</span></li><li>In the Transmission Line Model Generator window, click<span style="color: rgb(0,0,0);"> Calculate Parameters.</span></li>The calculated parameters appear in the top of the window.<li>(Optional) Choose<span style="color: rgb(0,0,0);"><em> Options - Output file Control - RLCG file</em>.</span></li>This turns off the generation of a macromodel that the AMS Designer simulator does not use.<li>Click<span style="color: rgb(0,0,0);"><em> Create Macromodel</em>.</span><br />The Macromodel Creation notice appears with a message similar to the following:<br /><code>Per-unit-length RLCG file is generated and written to the file myw_line.dat</code></li><li>Click<span style="color: rgb(0,0,0);"><em> OK</em>.</span></li><li>(Optional) In the Transmission Line Model Generator window, choose<span style="color: rgb(0,0,0);"><em> File - Quit</em>.<br /></span>The window closes.</li><li>Edit the model file (or files) that instantiates the&#160;<a href="Glossary.html#Glossary-1035964">mtline</a>&#160;device so that you specify the<code> file </code>parameter of the instance with the absolute path to the data file (from<a href="#PreparingtheDesign:UsingAnalogPrimitivesandSubcircuits-1035731"> step 4 </a>).</li></ol><p style="margin-left: 60.0px;">For example, the instance might look like this after editing:<br /><code> mline   (P_in P_out N_in N_out 0 0) mtline len=0.0762 romdatfile=&quot;&quot;<br />+ c=[1.600800e-10  -2.373800e-11  1.600800e-10]<br />+ file=&quot;/hm/tiegsc/work/mtline/line.data&quot; </code></p>

<p>At this point, the model file is ready for you to use.</p>

                    </div>
<br /><br /></div>
<footer xmlns:html="http://www.w3.org/1999/xhtml"><nav class="navigation"><b><em><a href="Using_an_amsd_Block.html" id="prev" title="Using_an_amsd_Block">Using_an_amsd_Block</a></em></b><b><em><a href="Preparing_the_Design__Using_Mixed_Languages.html" id="nex" title="Preparing_the_Design__Using_Mixed_Languages">Preparing_the_Design__Using_Mi ...</a></em></b></nav><div>
          For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2019, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved.
        </div>
</footer><br xmlns:html="http://www.w3.org/1999/xhtml" /></body></html>