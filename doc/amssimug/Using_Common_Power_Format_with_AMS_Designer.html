
<html><head><title>Using Common Power Format with AMS Designer</title>
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="jaini" />
<meta name="CreateDate" content="2019-11-04" />
<meta name="CreateTime" content="1572864941" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes the Virtuoso AMS Designer simulator, a mixed-signal simulator that supports the Verilog-AMS and VHDL-AMS language standards." />
<meta name="DocTitle" content="Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide" />
<meta name="DocType" content="User Guide" />
<meta name="FileTitle" content="Using Common Power Format with AMS Designer" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="FileType" content="Chapter" />
<meta name="Keyword" content="amssimug" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2019-11-04" />
<meta name="ModifiedTime" content="1572864941" />
<meta name="NextFile" content="Using_IEEE_1801_Standard__UPF__with_AMS_Designer.html" />
<meta name="Group" content="Analog Mixed-Signal Simulation" />
<meta name="Platform" content="Functional Verification" />
<meta name="PrevFile" content="Low_Power_and_Mixed-Signal_Verification.html" />
<meta name="Product" content="Xcelium" />
<meta name="ProductFamily" content="Functional Verification" />
<meta name="ProductVersion" content="19.09" />
<meta name="RightsManagement" content="Copyright 2012-2019 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide -- Using Common Power Format with AMS Designer" />
<meta name="Version" content="19.09" />
<meta name="Renderer" content="WIKI" />
<meta name="SpaceKey" content="amssimug2003" />
<meta name="confluence-version" content="6.13.3" />
<meta name="ecms-plugin-version" content="03.30.005" />

        
        <link href="styles/site.css" rel="stylesheet" type="text/css" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    

    </head><body style="background-color: #FFFFFF;"><!-- Begin Buttons --><header xmlns:html="http://www.w3.org/1999/xhtml"><div class="docHeadr">Product Documentation<img src="images/Cadence-Logo.jpg" /></div>
<nav class="blueHead"><ul><li><a class="content" href="amssimugTOC.html">Contents</a></li><li><a class="prev" href="Low_Power_and_Mixed-Signal_Verification.html" title="Low_Power_and_Mixed-Signal_Verification">Low_Power_and_Mixed-Signal_Ver ...</a></li><li style="float: right;"><a class="viewPrint" href="amssimug.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="Using_IEEE_1801_Standard__UPF__with_AMS_Designer.html" title="Using_IEEE_1801_Standard__UPF__with_AMS_Designer">Using_IEEE_1801_Standard__UPF_ ...</a></li></ul></nav></header><!-- End Buttons --><div xmlns:html="http://www.w3.org/1999/xhtml" style="font-size:14px;line-height:1.42857142857;margin:20px 0 0 0;font-weight:bold;"><center>Spectre AMS Designer and Xcelium Simulator Mixed-Signal User Guide<br />Product Version 19.09, September 2019</center></div>
<div xmlns:html="http://www.w3.org/1999/xhtml" style="margin-left:5%;">
<p></p>

<p></p>
<div id="main-header">
                    
                    
                                                <h1 style="margin: 4px 0 4px;"><span>Using Common Power Format with AMS Designer</span></h1>

                    
                </div>
<div class="wiki-content group" id="main-content">
                    
<p>If&#160;<span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-1075072"></span><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-CPF"></span>you have a digital design that uses Si2 Common Power Format (CPF) commands on some digital blocks, you can reuse the same CPF file when you reconfigure your design by replacing a digital block with an analog (SPICE) one. Using this feature, you can propagate the effect of power simulations onto your analog blocks in a direct way and measure analog effects, such as leakage current under power-shutoff. You can use this feature for any mixed-signal design, with the restriction that CPF constructs cannot be applied directly to the analog content of your design. Under these conditions, the AMS Designer simulator provides support for Common Power Format (CPF) and the following set of commands:</p>
<ul><li><code>set_cpf_version</code></li></ul><ul><li><code>set_design</code></li></ul><ul><li><code>set_hierarchy_separator</code></li></ul><ul><li><code>end_design</code></li></ul><ul><li><code>set_instance</code></li></ul><ul><li><code>set_macro_model</code></li></ul><ul><li><code>end_macro_model</code></li></ul><ul><li><code>create_isolation_rule</code></li></ul><ul><li><code>create_ground_nets</code></li></ul><ul><li><code>create_global_connection</code></li></ul><ul><li><code>create_power_mode</code></li></ul><ul><li><code>create_power_nets</code></li></ul><ul><li><code>create_power_domain</code></li></ul><ul><li><code>create_state_retention_rule</code></li></ul><ul><li><code>create_nominal_condition</code></li></ul><ul><li><code>create_mode_transition</code></li></ul><ul><li><code>define_always_on_cell</code></li></ul><ul><li><code>define_isolation_cell</code></li></ul><ul><li><code>define_state_retention_cell</code></li></ul><ul><li><code>update_power_domain</code></li></ul><ul><li><code>create_level_shifter_rule</code></li></ul><ul><li><code>update_isolation_rules</code></li></ul>
<p>CPF is a standard format, based on Tcl, for specifying all power-specific information and constraint requirements from design through verification and implementation.</p>

<p>See the following documents for detailed information about CPF and CPF commands:</p>
<ul><li><span style="color: rgb(0,0,255);"><a class="message-url" href="../cpf_user/cpf_userTOC.html">Common Power Format User Guide</a></span></li><li><span style="color: rgb(0,0,255);"><br /></span></li></ul><ul><li><span style="color: rgb(0,0,255);"><a class="message-url" href="../cpf_ref/cpf_refTOC.html">Common Power Format Language Reference</a></span></li></ul><ul><li><span style="color: rgb(0,0,255);"><a class="message-url" href="../LowPowerCPF/LowPowerCPFTOC.html">Low-Power Simulation Guide</a></span></li></ul><h3 id="UsingCommonPowerFormatwithAMSDesigner-Power-SmartConnectModulesPowerSmartConnectModules">Power-Smart Connect Modules<span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-PowerSmartConnectModules"></span></h3>

<p>The AMS Designer simulator supports CPF-influenced analog blocks by identifying them and inserting power-smart connect modules (<a href="Glossary.html#Glossary-1031358">CM</a>s) during elaboration. The selection and insertion of power-smart connect modules complies with the Verilog-AMS language semantics. The connect rules in the Cadence installation have been enhanced to include power-smart connect modules. The power awareness of a connect module is determined by the tool on the basis of the connect module name (that is, the name ending with &quot;LPS&quot;). The power-smart connect modules (L2E/R2E) use an additional parameter named&#160;<code>vpso.</code>&#160;This parameter is used to specify the voltage value, which must be passed to the analog block when the digital block driving it is shut off. The default value of the<code>&#160;vpso&#160;</code>parameter is 0.2.</p>

<p>You can also use the parameters&#160;<code>vtrlo</code>,&#160;<code>vtrhi</code>, and&#160;<code>vrtol</code>&#160;in power-smart connect modules to specify the ratio of low threshold, high threshold, and tolerance during value conversion.</p>

<p>Additionally, power-smart connect modules have been enhanced to support the current&#160;mode, in which electrical current is converted between wreal and electrical connection. When current mode processing is enabled for an LPS connect module, the behavior of the LPS connect modules is same as a regular connect module. And, the tool issues a warning that the current mode behavior is not low power aware though the connect module is *_LPS.</p>

<p><code>Info: Current mode processing enabled for this low power aware connect module (tb.topInst.connect__E2R_LPS__ddiscrete_1_8). Note that low power aspects are not expected to influence the current mode behavior</code></p>

<p>The following diagram illustrates how power-smart CMs carry the effect of digital power-shutoff (<a href="Glossary.html#Glossary-1034241">PSO</a>) to analog blocks:</p>
<p align="left"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" data-base-url="https://rdwiki.cadence.com" data-image-src="attachments/305236145/305236146.gif" data-linked-resource-container-id="305236145" data-linked-resource-container-version="2" data-linked-resource-content-type="image/gif" data-linked-resource-default-alias="CPFinAMS.gif" data-linked-resource-id="305236146" data-linked-resource-type="attachment" data-linked-resource-version="1" data-unresolved-comment-count="0" src="attachments/305236145/305236146.gif" width="640px" /></span></p>

<p>The design instances are&#160;<code>Inst_A</code>,<code>&#160;Inst_B</code>,<code>&#160;Inst_C</code>, and<code>&#160;PM.</code><code>&#160;Inst_B</code>&#160;is an analog block connected to&#160;<code>Inst_A.</code>&#160;The dotted outlines indicate the two power domains,&#160;<code>PD1</code>&#160;and&#160;<code>PD2.</code><code>&#160;Inst_A&#160;</code>belongs to power domain 1 (<code>PD1</code>) and&#160;<code>Inst_C</code>&#160;belongs to power domain 2 (<code>PD2</code>).<code>&#160;PM</code>&#160;is a power manager module. The power control signals,&#160;<code>PD1_ctrl</code>&#160;and&#160;<code>PD2_ctrl</code>, correspond to power domains 1 and 2, respectively.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The power-smart L2R/E2R CMs carry the effect of PSO to RNM blocks with <code>wrealXState</code> and the power-smart E2L/R2L CMs carry the effect of PSO to digital blocks with <code>X</code>.</p>
</div>
</div>

<p>The AMS Designer simulator allows the use of automatically inserted as well as manually inserted power-smart connect modules. The automatically inserted connect modules are selected by the tool based on the connect rules and connect libraries provided by the user. The manually inserted connect modules are explicitly instantiated by the user in the design and do not need any connect rules.</p>

<p>The AMS Designer simulator supports designs containing VHDL-D drivers that directly or indirectly impact power-smart connect modules in the low-power mixed-signal simulation. However, this support is currently not available for VHDL-SPICE cases where VHDL conversion elements (CEs) are used.</p>

<p>Also, the power-smart connect modules support advanced power-domain features like power modes and nominal conditions, resulting in improved digital-to-analog transition inside the modules in low power mixed-signal simulation. A power-smart connect module in AMS-CPF can:</p>
<ul><li>Identify and honor all possible methods of shutting off a power domain.</li></ul><ul><li>Identify a change in the active state of a power domain as soon as the power mode transition occurs and read the voltage value from the associated nominal condition.</li></ul><ul><li>Use the voltage value of a nominal condition associated with a power domain to perform the digital-to-analog transition.</li></ul><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>Refer to the connect library in the installation to see the power-smart connect module definitions.</p>
</div>
</div>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-SupportforMultipleDigitalDrivers">Support for Multiple Digital Drivers</h3>

<p>Consider a situation where an analog signal is driven by multiple digital drivers that take different nominal conditions from one or more power domains, such as the example shown below. Modules&#160;<code>dig_A</code>&#160;and&#160;<code>dig_B</code>&#160;belong to power domains&#160;<code>PD1</code>&#160;and&#160;<code>PD2</code>, both of which are switchable power domains with a nominal condition of&#160;<code>1.2V</code>&#160;and&#160;<code>2.5V</code>. When the two modules drive the same port of an analog block&#160;<code>ana_C</code>, it is the case of multiple digital drivers in AMS-CPF.</p>
<p align="left"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" data-base-url="https://rdwiki.cadence.com" data-image-src="attachments/305236145/305236147.png" data-linked-resource-container-id="305236145" data-linked-resource-container-version="2" data-linked-resource-content-type="image/png" data-linked-resource-default-alias="lpams.24.1.2.png" data-linked-resource-id="305236147" data-linked-resource-type="attachment" data-linked-resource-version="1" data-unresolved-comment-count="0" src="attachments/305236145/305236147.png" width="640px" /></span></p>

<p>When multiple digital drivers carrying CPF information drive a single analog port, the following describes how the multiple digital drivers are resolved:</p>
<ul><li>If all of these drivers belong to the same power domain: Continue the simulation without any warnings.</li></ul><ul><li>If there is one or more power domains in power on or standby state: Report a warning, select the maximum nominal on or standby voltage, and apply it on the analog side.</li></ul><ul><li>If there is one or more power domains in power off state: Report a warning, select the maximum nominal off voltage as the&#160;<code>vpso</code>, and apply it on the analog side.</li></ul><ul><li>If there is one or more power domains in power transition state: Report a warning and apply a random voltage on the analog side.</li></ul>
<p>Here is an example of a warning message:</p>

<p><code>AMSCPF_VPI WARNING (at simtime 900.000000ns) : Multiple digital drivers are not allowed with a power smart connect module (top.connect__L2E_LPS__ddiscrete_2_4.Din), only one will be used:</code></p>

<p><code>PowerDomain : PD_Dig1 - Voltage : 1.800000 (selected)</code><br /><code>PowerDomain : PD_Dig2 - Voltage : 1.600000</code></p>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-UsingtheieCardinAMS-CPFUsingtheieCardinAMSCPF">Using the ie Card in AMS-CPF<span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-UsingtheieCardinAMSCPF"></span></h3>

<p>The&#160;<code>ie</code>&#160;card supports parameters like X-voltage that are specific to the power-smart connect module. An additional parameter called&#160;<code>vpso</code>&#160;on the&#160;<code>ie</code>&#160;card can also be used to indicate the voltage value for power shut off voltage. You can also use the following parameters on the&#160;<code>ie</code>&#160;card:</p>
<ul><li><code>vpso</code>: Specifies the voltage value for power shut off voltage. The&#160;<code>vpso</code>&#160;value overrides the&#160;<code>vx_amscpf_poweroff</code>&#160;parameter in the power-smart connect module.</li><li><code>vtrlo</code>: Specifies the ratio of low threshold during value conversion. The default value is&#160;<code>vtlo</code>/<code>vsup</code>.</li><li><code>vtrhi</code>: Specifies the ratio of high threshold during value conversion. The default value is<code>&#160;vtrhi</code>/<code>vsup</code>.</li><li><code>vrtol</code>: Specifies the ratio of tolerance during value conversion. The default value is&#160;<code>vtlo</code>/<code>vsup</code>.</li><li><code>currentmode</code>: Enables wreal current mode processing for low power simulation. The default value is 1. The tool issues a warning that the current mode behavior is not low power aware though the connect module is&#160;<code>_LPS</code>.</li></ul>
<p>The threshold value and tolerance value are calculated based on the ratio and the supply voltage of power domain. You can specify either the ratio (<code>vtrhi=2/3 vtrlo=1/3 vrtol=1/12</code>) or the threshold directly (<code>vthi=1.2 vtlo=0.6 vtol=0.1</code>).</p>

<p>The following is an example of the parameters you can use in the ie card statement for power-smart connect modules:</p>

<p><code>amsd{</code><br /><code>ie vsup=1.8 instport=&quot;<a class="external-link" href="https://testbench.vlog_buf.I1.in" rel="nofollow">testbench.vlog_buf.I1.in</a>&quot; vpso=0.1, vthi=1.2 vtlo=0.6 vtol=0.1 currentmode=1,</code><br /><code>}</code></p>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-UsingPowerAwareModeling">Using Power Aware Modeling</h3>

<p>A set of built-in Verilog system tasks and VHDL procedures can be used in Verilog (-AMS) or VHDL(-AMS) code to obtain information about the low-power simulation. Most of the tasks / procedures link a Verilog register or a VHDL signal to some low-power information, such as the power-down state of a power domain, the name of the power mode that a domain has just entered, the voltage that a power domain is at after a nominal condition transition, and so on.</p>

<p>Following are the Verilog system tasks and functions:</p>

<p><code>$lps_get_power_domain(&lt;power_domain_register&gt;[, &lt;instance&gt;]);</code><br /><code>$lps_link_power_domain_powerdown(&lt;link_register&gt; [,&lt;power_domain&gt;);</code><br /><code>$lps_link_power_domain_standby(&lt;link_register&gt;[, &lt;power_domain&gt;]);</code><br /><code>$lps_link_power_domain_voltage(&lt;link_variable&gt;[, &lt;power_domain&gt;]);</code><br /><code>$lps_link_power_domain_gnd_voltage(&lt;link_variable&gt; [, &lt;power_domain&gt;]);</code><br /><code>$lps_link_power_domain_nmos_voltage(&lt;link_variable&gt; [, &lt;power_domain&gt;]);</code><br /><code>$lps_link_power_domain_pmos_voltage(&lt;link_variable&gt; [, &lt;power_domain&gt;]);</code><br /><code>$lps_link_power_domain_nominal_condition(&lt;link_register&gt; [, &lt;power_domain&gt;]);</code><br /><code>$lps_link_power_domain_power_mode(&lt;link_register&gt; [, &lt;power_domain&gt;]);</code><br /><code>$lps_enabled();</code><br /><code>$lps_get_stime();</code></p>

<p>To obtain more information about these system tasks, refer to the<span style="color: rgb(0,0,0);">&#160;Power-Aware Modeling&#160;</span>chapter of the<span style="color: rgb(0,0,0);"><em>&#160;Low-Power Simulation Guide</em>.</span></p>

<p>One limitation of low power system task is that you cannot use them inside an analog procedural block. For example, the following module definition will not work because the low-power system task&#160;<code>$lps_enabled()</code>&#160;is used inside the&#160;<code>analog</code>&#160;procedural block.</p>

<p><code>module top (out);</code><br /><code>&#160; inout&#160;&#160;&#160;&#160;&#160;&#160;out;</code><br /><code>&#160; reg&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;temp = 0;</code><br /><code>&#160; electrical out;</code><br /><code>&#160; real p;&#160;</code></p>

<p><code>&#160;&#160;initial</code><br /><code>&#160; &#160; begin</code><br /><code>&#160; &#160; &#160; #10 temp = 1;</code><br /><code>&#160; &#160; end&#160;</code></p>

<p><code>&#160;&#160;analog</code><br /><code>&#160; &#160; begin</code><br /><code>&#160; &#160; &#160; if (!$lps_enabled &amp;&amp; (temp == 0))</code><br /><code>&#160; &#160; &#160; &#160; p = 0.0;</code><br /><code>&#160; &#160; &#160; else</code><br /><code>&#160; &#160; &#160; &#160; p = 3.0;</code><br /><code>&#160; &#160; &#160; &#160; V(out) &lt;+ p;</code><br /><code>&#160; &#160; end&#160;</code></p>

<p><code><span style="color: rgb(0,0,0);">endmodule</span></code></p>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-cpf_power_domainConnectingDesignSupplyNettoCPFPowerDomainandDesignNet"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-cpf_power_domain"></span>Connecting Design Supply Net to CPF Power Domain and Design Net</h3>

<p>You can define a connection on mixed-signal power-supply nets based on the CPF command&#160;<code>create_global_connection</code>. The power net or hierarchical net is defined either in the CPF scope by using the&#160;<code>create_power_nets</code>&#160;command, or it is defined in HDL scope. And, the ground connections for the power domain net or hierarchical nets can be specified in the CPF scope using the&#160;<code>create_ground_nets</code>&#160;command.&#160;You can associate the power supply nets to the power domain by using the CPF command&#160;<code>update_power_domain.</code></p>

<p>This feature is enabled by using the&#160;<code>xrun</code>&#160;command-line option:<br /><code>-lps_ams_connect_supply</code></p>

<p>The following figure shows the connection between a design supply net and the CPF power domain and design net:</p>
<p align="left"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" data-base-url="https://rdwiki.cadence.com" data-image-src="attachments/305236145/305236148.png" data-linked-resource-container-id="305236145" data-linked-resource-container-version="2" data-linked-resource-content-type="image/png" data-linked-resource-default-alias="lpams.24.1.3.png" data-linked-resource-id="305236148" data-linked-resource-type="attachment" data-linked-resource-version="1" data-unresolved-comment-count="0" src="attachments/305236145/305236148.png" width="640px" /></span></p>

<p>In a digital instance, which is under a power domain driven by design supply net, the power aware connect module inserted on the instance port is aware of the design supply net value dynamically.</p>

<p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" data-base-url="https://rdwiki.cadence.com" data-image-src="attachments/305236145/305236149.png" data-linked-resource-container-id="305236145" data-linked-resource-container-version="2" data-linked-resource-content-type="image/png" data-linked-resource-default-alias="lpams.24.1.4.png" data-linked-resource-id="305236149" data-linked-resource-type="attachment" data-linked-resource-version="1" data-unresolved-comment-count="0" src="attachments/305236145/305236149.png" width="640px" /></span></p>

<p>You can also establish a connection on mixed-signal power-supply nets,&#160;including SV-UDN nets,&#160;by using the domain mapping between macro model instantiation.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>For SV-UDN power-supply nets, the UDNs connecting to the same supply net must have the same nettype. Also, for the electrical to UDN connections, you must provide the connect module specifications through <code>ie</code> card or connect rules.</p>
</div>
</div>

<p>The tool automatically creates the internal power nets if the power/ground pins of the power domains are specified using the CPF command&#160;<code>update_power_domain</code>, as shown below.</p>

<p><code>update_power_domain -name VREG_OUT -primary_power_net {out} -primary_ground_net {gnd}</code></p>

<p>The power net connection can be established by using the&#160;<code>-domain_mapping</code>&#160;command, as shown below.</p>

<p><code>set_instance top.vreg_inst25 -model VREG -domain_mapping { {VREG_OUT PD_25} }</code></p>

<p>Here is an example:</p>

<p><code>create_power_domain -name PD_25</code><br /><code>set_macro_model VREG</code><br /><code>&#160; &#160; create_power_domain -name VREG_OUT</code><br /><code>&#160; &#160; update_power_domain -name VREG_OUT -primary_power_net {out}-primary_ground_net {gnd}</code><br /><code>end_macro_model&#160;</code></p>

<p><code>set_macro_model DECODER</code><br /><code>&#160; &#160; create_power_domain -name PD_DECODER</code><br /><code>&#160; &#160; update_power_domain -name PD_DECODER -primary_power_net {vdd} -primary_ground_net {vss}</code><br /><code>end_macro_model&#160;</code></p>

<p><code>set_instance top.vreg_inst25 -model VREG -domain_mapping { {VREG_OUT PD_25} }</code><br /><code>set_instance top.dec_inst25 -model DECODER -domain_mapping {{PD_DECODER PD_25}}</code></p>

<p>Based on the above CPF definition, supply connection between&#160;<code>top.vreg_inst25.out-&gt;top.dec_inst25.vdd</code>&#160;and&#160;<code>top.vreg_inst25.out-&gt;top.dec_inst25.vss</code>&#160;is applied automatically.</p>

<p>For a demo on how CPF domain mapping helps in powering up analog blocks during mixed-signal simulation, see&#160;<a class="message-url" href="https://support.cadence.com/apex/ArticleAttachmentPortal?id=a1O0V000006AhXHUA0&pageName=ArticleContent&sq=005d0000001T3sVAAS_20179229492832">Using CPF Supply Connection in Mixed-Signal Simulation</a>.</p>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-SupportforTransitionSlopeofPowerSupplyinCPF-ControlledAnalogBlocktransition_slopetransition_slope">Support for Transition Slope of Power Supply in CPF-Controlled Analog Block&#160;<span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-transition_slope"></span><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-transition_slope"></span></h3>

<p>For CPF-aware mixed-signal simulation, AMS automatically provides a dynamic power supply for analog (electrical or wreal models) blocks that are controlled by CPF specification. The power supply value changes at the start point of power transition. For electrical power supply, the simulator models a transition slope and transition latency during the transition state with the&#160;<code>rise_time&#160;</code>and<code>&#160;fall_time</code>&#160;of transition statement, and applies the maximum slope and time value. For wreal or real power supply, the voltage changes at the end point of the transition, which enables you to determine whether the wreal power supply is in the transition period.</p>
<p align="left"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" data-base-url="https://rdwiki.cadence.com" data-image-src="attachments/305236145/305236150.png" data-linked-resource-container-id="305236145" data-linked-resource-container-version="2" data-linked-resource-content-type="image/png" data-linked-resource-default-alias="lpams.24.1.5.png" data-linked-resource-id="305236150" data-linked-resource-type="attachment" data-linked-resource-version="1" data-unresolved-comment-count="0" src="attachments/305236145/305236150.png" width="640px" /></span></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>If the power supply net is specified on a VHDL net, the net is removed from the auto supply net list. In addition, transition slope on real or wreal supply net is ignored.</p>
</div>
</div>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-create_level_shifterReferringtothePowerSupplyofSmartIEfromAnalogSideLocally"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-create_level_shifter"></span>Referring to the Power Supply of Smart IE from Analog Side Locally</h3>

<p>In AMS or DMS simulation, the reference voltage of analog-to-digital (A-to-D) or digital-to-analog (D-to-A) conversion is always determined by working voltage of digital side. In case if a voltage conflict is detected in the mixed boundary, the AMS Designer simulator automatically inserts a level shifter with the Interface Element (IE), based on the level shifter rules specified in CPF file (using the&#160;<code>create_level_shifter_rule</code>&#160;command) and the reference voltage of IE is automatically linked to nominal voltage of analog block.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>This feature is enabled by specifying the&#160;<code>-lps_ams_lsr</code>&#160;command-line option. In addition, it is not applicable for power-smart R2E CMs.</p>
</div>
</div>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-conflicting_power_domainCheckingConflictingPowerDomainsonMixed-SignalBoundary"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-conflicting_power_domain"></span>Checking Conflicting Power Domains on Mixed-Signal Boundary</h3>

<p>Multiple power domains connecting to the same connect module on the digital or analog side result in a voltage conflict. The AMS Designer simulator checks for such voltage conflicts during the elaboration stage and generates an error if:</p>
<ul><li>A power-smart IE connects to the digital drivers with different power domains.<br /><br /><code>xmelab: *E,PIEMLDR: [LPS] Multiple digital drivers from different power domains are connected to same mixed-signal net</code></li></ul><ul><li>
<p>A power-smart IE connects to the digital loads with different power domains.<br /><br /><code>xmelab: *E,PIEMLLD: [LPS] Multiple digital loads from different power domains are connected to same mixed-signal net</code></p>
</li></ul><ul><li>A power-smart IE connects to the analog signals (drivers or loads) with different power domains.<br /><br /><code>xmelab: *E,PIEMASG: [LPS] Multiple analog signals from different power domains are connected to same mixed-signal net</code></li></ul><ul><li>
<p>A power-smart IE connects to wreal or real signals (drivers and loads) with different power domains.<br /><br /><code>xmelab: *E,PIEMRSG: [LPS] Multiple real valued signals from different power domains are connected to same mixed-signal net</code></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">To downgrade these errors to a warning, you can use the <code>-xmwarn</code> option with the error message ID (<code>-xmwarn PIEMLLD</code>) and re-run the design.</div>
</div>
</li></ul><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The simulator does not generate an error if the digital driver and load belong to different power domains.</p>
</div>
</div>

<p>This feature works only when the nominal condition is specified in the CPF file and enabled for low power simulation. You must specify the following:</p>
<ul><li>-<code>lps_pmode</code>&#160;or -<code>lps_mvs</code></li></ul><ul><li><code>-lps_ams_sim</code>&#160;or the boundary port domain specified on the analog or wreal port</li></ul>
<p>In addition, you must specify the following in the CPF file:</p>
<ul><li><code>create_nominal_condition</code></li></ul><ul><li><code>create_power_domain -active_state_condition</code>&#160;or&#160;<code>create_power_mode</code></li></ul><h3 id="UsingCommonPowerFormatwithAMSDesigner-wreal_nocorruptUsingwrealDataType"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-wreal_nocorrupt"></span>Using wreal Data Type</h3>

<p>The&#160;<code>wreal</code>&#160;data type can be used in AMS design with CPF. When a wreal module is power-shut-off, the wreal signal in this module is forced to&#160;<code>wrealXState.</code></p>

<p>To change this behavior, following two options are supported:</p>
<ul><li><code>-lps_wreal_nocorrupt<br /></code>It prevents the forcing of the wreal signal and also prevents the original value from getting corrupted.</li></ul><ul><li><code>-lps_wreal_corrupt_value &lt;value&gt;<br /></code>This option is provided to make it consistent with the behavior of the analog signal from power smart<a href="Glossary.html#Glossary-1034481">&#160;IE</a>. The user can pick a value of choice, and also restore the backward compatible behavior of 0.0.</li></ul>
<p>You can also apply the power corruption value locally on wreal signals during the power-off state by adding the following options in the&#160;<code>user_attributes</code>&#160;argument of the&#160;<code>update_power_domain</code>&#160;CPF command:</p>
<ul><li><code>wreal_nocorrupt [&#160;</code><code>instance_name&#160;</code><code>|&#160;</code><code>wire_name&#160;</code><code>]<br /></code>This option specifies that the objects of a power domain are non-corrupt during simulation and maintains their values.</li></ul><ul><li><code>wreal_corrupt_value [&#160;</code><code>value&#160;</code><code>|&#160;</code><code>value@object&#160;</code><code>]<br /></code>This option specifies the corruption value of objects in the power domain.</li></ul><h3 id="UsingCommonPowerFormatwithAMSDesigner-boundary_portsSpecifyingBoundaryPortsandMacroModels"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-boundary_ports"></span>Specifying Boundary Ports and Macro Models</h3>

<p>Boundary ports are specified and applied to primary inputs or outputs of a top-level design or a macro model.</p>

<p>If a mixed-signal net is connected to a boundary port, AMS-CPF ensures that the:</p>
<ul><li>ISO device is inserted into the boundary port</li></ul><ul><li>ISO device correctly connects with the digital port of the connect module</li></ul>
<p>During the elaboration phase (<code>xmelab</code>), AMS-CPF:</p>
<ul><li>replaces the regular connect module with the power smart connect module if the digital side or the analog side is specified as a boundary port</li></ul><ul><li>creates an isolation device for the AMS Boundary port if the driver and load belong to different digital and electrical scopes</li></ul><ul><li>connects the ISO device with the digital side of the connect module during driver-receiver segregation</li></ul>
<p>During the simulation phase (<code>xmsim</code>), AMS-CPF checks the power status of the boundary port domain in the&#160;<code>amscpf-vpi</code>&#160;function.</p>

<p>Bus, bit-select, and part-select of an analog port, including the SPICE port, can be used in the boundary port while performing domain mapping, especially for macro model usage, as shown in the following example:</p>

<p><code>//SPICE block</code><br /><code>.subckt ana_inv in[3] in[2] in[1] in[0] out[3] out[2] out[1] out[0] vdd vss</code><br /><code>...</code><br /><code>.ends ana_inv</code><br /><code>//instantiation in top</code><br /><code>module top();</code><br /><code>...</code></p>

<p><code>wire [3:0]data1;</code><br /><code>wire [3:0]data2;</code><br /><code>wire [3:0]aout1;</code><br /><code>wire [3:0]aout2;&#160;</code></p>

<p><code>ana_inv anaInst1 (data1, aout1, vdd, gnd);</code><br /><code>...</code><br /><code>endmodule</code><br /><code>//Verilog ref block</code><br /><code>module ana_inv (in,out,vdd,vss);</code><br /><code>input [3:0]in;</code><br /><code>output [3:0]out;</code><br /><code>electrical [3:0]in;</code><br /><code>electrical [3:0]out;</code><br /><code>...</code><br /><code>endmodule</code></p>

<p>The boundary port of a SPICE instance can be defined in the CPF file as follows:</p>

<p><code># design ana_inv</code><br /><code>set_macro_model ams_inv</code><br /><code>create_power_domain -name PD_ON -boundary_ports { vdd vss } -default</code><br /><code>create_power_domain -name PD_SW -boundary_ports { in out[3] out[2:1] out[0] }</code><br /><code>end_macro_model</code></p>

<p>Here,</p>
<ul><li>The whole bus port, such as&#160;<code>in</code>, can be specified.</li></ul><ul><li>
<p>Part-select of a bus port is supported. For example,&#160;<code>out[2:1].</code></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The index order of the part-select expression should be in the same direction as the bus definition. <code>out[1:2]</code> would be illegal in the above example.</p>
</div>
</div>
</li></ul><ul><li>Bit-select of a bus port is supported. For example,&#160;<code>out[0].</code></li></ul><h3 id="UsingCommonPowerFormatwithAMSDesigner-wrealincpfWrealExpressionsinCPF"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-wrealincpf"></span>Wreal Expressions in CPF</h3>

<p>Wreal expressions are supported in the following CPF commands that require a control condition:</p>
<ul><li><code>create_power_domain</code></li></ul><ul><li><code>create_mode_transition</code></li></ul><ul><li><code>create_isolation_rule</code></li></ul><ul><li><code>create_state_retention_rule</code></li></ul><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The signal in the wreal expression must be real valued, otherwise, the simulator generates an error. Currently, only the wreal signal and the wire which is coerced as wreal in Verilog are supported. To enable the support for wreal expressions in CPF you must specify the <code>-lps_ams_sim</code> option.</p>
</div>
</div>

<p>The following operators are supported in a wreal expression:</p>
<ul><li><span style="color: rgb(0,0,0);">&lt;, &lt;=, &gt;, &gt;=</span></li></ul><ul><li><span style="color: rgb(0,0,0);">== and !=</span></li></ul><ul><li>
<p><span style="color: rgb(0,0,0);">=== and !==</span></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The case equality operators <code>===</code> and <code>!=</code> can only be followed by <code>wrealXState</code> and <code>wrealZState</code>. In addition, <code>wrealXState</code> and <code>wrealZState</code> can only be specified with the case equality operators. For example:</p>

<p><code>create_power_domain -name PD -shutoff_condition pmc.vsup===wrealXState</code></p>
</div>
</div>
</li></ul>
<p>The following conditions apply to wreal expressions:</p>
<ul><li>The reference value should be a real number,&#160;<code>wrealXState</code>&#160;or&#160;<code>wrealZState</code>. Variables or parameters are not supported.</li></ul><ul><li>The wreal expression returns the value zero if the specified relation is false or one if the specified relation is true.</li></ul><ul><li>The wreal expression can be combined with a boolean expression. For example:&#160;<code>pmc.pso&gt;=0.2&#160;</code><code>!(pmc.pso&gt;=0.2)&#160;</code><code>pmc.pso&amp;&amp;(pmc.pso&gt;=0.2)</code></li></ul><ul><li><code>wrealXState</code>&#160;or&#160;<code>wrealZState</code>&#160;on real valued signal is supported, and the expression is resolved as logic<code>&#160;X.</code>&#160;For example, in the example below, if&#160;<code>pmc.pso</code>&#160;is&#160;<code>wrealXState</code>&#160;or&#160;<code>wrealZState</code>, the shutoff condition signal is in&#160;<code>X</code>&#160;state.<br /><code>create_power_domain -name PD -shutoff_condition (pmc.pso&gt;=0.2)</code></li></ul><ul><li>The wreal expression can be specified in a virtual port using the&#160;<code>-port_mapping</code>&#160;argument of the&#160;<code>set_instance</code>&#160;command, as shown below.<br /><code>set_instance digInst -port_mapping {{virpso pmc.vsup&lt;0.2}}<br /></code><code>&#160; &#160; set_design dig_child -ports {virpso}<br /></code><code>&#160; &#160; create_power_domain -name PD0<br /></code><code>&#160; &#160; create_power_domain -name PD1<br />&#160; &#160; -shutoff_condition virpso<br /></code><code>end_design</code></li></ul><h3 id="UsingCommonPowerFormatwithAMSDesigner-powercorruptionPowerCorruptionontheBoundaryPortofaWrealModel"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-powercorruption"></span>Power Corruption on the Boundary Port of a Wreal Model</h3>

<p>Power corruption is applied on the wreal boundary port of a macro model specified in the CPF file, for both input and output ports. For example:</p>

<p><code>set_macro_model wrl</code><br /><code>create_power_domain -name pd1 -boundary_ports {rout1} -default</code><br /><code>create_power_domain -name pd2 -boundary_ports {rout2}</code><br /><code>end_macro_model</code></p>

<p>This feature is controlled by the option&#160;<code>-lps_wreal_bport_corruption.</code>&#160;If the&#160;<code>-lps_wreal_bport_corruption option</code>&#160;is specified, the wreal boundary ports that are specified in the CPF file and are associated with the power-shutoff domains are forced to the power corruption value.</p>

<p>The power corruption value in the power-shutoff state is determined by the&#160;<code>-lps_wreal_nocorrupt</code>&#160;or&#160;<code>-lps_wreal_corrupt_value</code>&#160;options, or the&#160;<code>wreal_nocorrupt</code>&#160;or&#160;<code>wreal_corrupt_value</code>&#160;options specified using the&#160;<code>user_attributes</code>&#160;argument of the&#160;<code>update_power_domain</code>&#160;CPF command, as shown below.</p>

<p><code>update_power_domain -name pd1 -user_attributes { wreal_corrupt_value 0.2 }</code><br /><code>update_power_domain -name pd2 -user_attributes { wreal_corrupt_value {0.5@inst1} \</code><br /><code>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wreal_corrupt_value&#160;</code><br /><code>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{wrealZState@inst2.rout} \</code><br /><code>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wreal_nocorrupt {inst3} }</code></p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>Wreal instances that are specified using the <code>create_power_domain</code> CPF command also have the power corruption value applied to them.</p>
</div>
</div>
<h3 id="UsingCommonPowerFormatwithAMSDesigner-feedthroughSupportforFeedthroughWireAnalysis"><span class="confluence-anchor-link" id="UsingCommonPowerFormatwithAMSDesigner-feedthrough"></span>Support for Feedthrough Wire Analysis</h3>

<p>Technology improvements--related to tracking the drivers and loads on a net more accurately, thus enabling more accurate low-power semantics for a net--have been enabled in feedthrough wire analysis for AMS Designs. The following are the consequences of the improved behavior:</p>
<ul><li>ISO devices are not created for a floating net, that is, a net without driver and load.</li></ul><ul><li>If logical expressions are embedded in a continuous assignment statement, both the driver and receiver of that assignment statement are corrupted when that block is in the power shut-off mode. This is different from the behavior in 11.1, where only the receiver was corrupted. Example:<br /><code>module dig_child (lin);<br /></code><code>inout lin;<br /></code><code>...<br /></code><code>assign ltmp = ~lin;<br /></code><code>endmodule<br /><br /></code>The continuous assignment statement&#160;<code>assign ltmp = ~lin;</code>&#160;contains a bitwise negation operator, based on which the nets&#160;<code>ltmp</code>&#160;and&#160;<code>lin</code>&#160;do not qualify as feedthrough wires. The nets are forced to&#160;<code>X</code>&#160;state when the&#160;<code>dig_child</code>&#160;block is in the power shut-off mode.</li></ul>
<p>For more information about feedthrough analysis, refer to the<span style="color: rgb(0,0,0);">&#160;Feedthrough Wires&#160;</span>section in the<span style="color: rgb(0,0,0);"><em>&#160;Low-Power Simulation Guide</em>.</span></p>

                    </div>
<br /><br /></div>
<footer xmlns:html="http://www.w3.org/1999/xhtml"><nav class="navigation"><b><em><a href="Low_Power_and_Mixed-Signal_Verification.html" id="prev" title="Low_Power_and_Mixed-Signal_Verification">Low_Power_and_Mixed-Signal_Ver ...</a></em></b><b><em><a href="Using_IEEE_1801_Standard__UPF__with_AMS_Designer.html" id="nex" title="Using_IEEE_1801_Standard__UPF__with_AMS_Designer">Using_IEEE_1801_Standard__UPF_ ...</a></em></b></nav><div>
          For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2019, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved.
        </div>
</footer><br xmlns:html="http://www.w3.org/1999/xhtml" /></body></html>